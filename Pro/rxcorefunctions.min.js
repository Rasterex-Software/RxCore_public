var RxCoreMulti=RxCore=function(){"use strict";var e,t,a,i,s,r,n,o,l,c,h,d,p,u,g,f,m,y,v,x,b,w,k,D=!1,C=RxConfig.xmlurl,R=RxConfig.xmlurldirect,P=RxConfig.xmlurlmarkup,S=(RxConfig.opensessionurl,RxConfig.openMsessionurl,RxConfig.openUsessionurlEx),M=RxConfig.openUsessionurl,T=RxConfig.closesessionurl,E=RxConfig.xmlurlmarkupsave,F=!1,I=RxConfig.serverComparefiles,j=(RxConfig.markupsave,RxConfig.savefile),A=RxConfig.FileuploadURL,O=RxConfig.WebClientPDFUpload,L=RxConfig.PenTableUpload,V=RxConfig.putSignature,N=RxConfig.getSignature,B=RxConfig.putInitial,U=RxConfig.getInitial,G=-1,z=null,H=!1,_=RxConfig.PDFExportURL,W=RxConfig.PDFExportPageURL,X=RxConfig.serverJSONcommand,Y=RxConfig.PDFPrintPrepare,q=RxConfig.PDFPrintCreate,Z=RxConfig.CanvasSaveUrl,J=RxConfig.UploadServerfolder,K=RxConfig.UploadServerfolderd,$=RxConfig.xmlurlrel,Q=RxConfig.xmlurlrelmarkup,ee=(RxConfig.uploadfolderURL,RxConfig.htmlviewerurl),te=RxConfig.splashscreen,ae=RxConfig.noteImgSrc,ie=RxConfig.bGetconfig,se=RxConfig.bUseID,re=RxConfig.configurationLocation,ne=!1,oe=null,le=!1,ce="",he=!1,de=!1,pe=!1,ue=!1,ge=null,fe="",me=!1,ye=!1,ve=!1,xe=!1,be=3,we=window.devicePixelRatio,ke=!1,De=void 0,Ce=void 0,Re=Object.freeze([]),Pe={offsetWidth:0,offsetHeight:0,absolute:!1},Se={width:225,height:150},Me=1920,Te=1080,Ee={x:50,y:50,w:50,h:100},Fe={consolidateonly:!1,format:"PDF",UPI:"0",paperSize:"A3",markupFlag:"1",overridefilename:"not used"},Ie=void 0,je=void 0,Ae=void 0,Oe=void 0,Le=void 0,Ve=void 0,Ne=void 0,Be=void 0,Ue=void 0,Ge=void 0,ze=void 0,He=void 0,_e=void 0,We=void 0,Xe=void 0,Ye=void 0,qe=void 0,Ze=void 0,Je=void 0,Ke=void 0,$e=void 0,Qe=void 0,et=void 0,tt=void 0,at=void 0,it=void 0,st=void 0,rt=void 0,nt=void 0,ot=void 0,lt=void 0,ct=void 0,ht=void 0,dt=void 0,pt=void 0,ut=void 0,gt=void 0,ft=void 0,mt=void 0,yt=void 0,vt=void 0,xt=void 0,bt=void 0,wt=void 0,kt=void 0,Dt=void 0,Ct=void 0,Rt=void 0,Pt=void 0,St=void 0,Mt=void 0,Tt=void 0,Et=void 0,Ft=void 0,It=void 0,jt=void 0,At=void 0,Ot=void 0,Lt=void 0,Vt=void 0,Nt=void 0,Bt=void 0,Ut=void 0,Gt=void 0,zt=void 0,Ht=void 0,_t=void 0,Wt=void 0,Xt=void 0,Yt=void 0,qt=void 0,Zt=void 0,Jt=void 0,Kt=void 0,$t=void(rt=void 0),Qt=void 0,ea=void 0,ta=void 0,aa=void 0,ia=void 0,sa=void 0,ra=void 0,na=void 0,oa=void 0,la=void 0,ca=void 0,ha=void 0,da=void 0,pa=void 0,ua=void 0,ga=void 0,fa=void 0,ma=void 0,ya=void 0,va=void 0,xa=void 0,ba=void 0,wa=void 0,ka=void 0,Da=void 0,Ca=void 0,Ra=void 0,Pa=void 0,Sa=void 0,Ma=void 0,Ta=void 0,Ea=void 0,Fa=void 0,Ia=void 0,ja=void 0,Aa=void 0,Oa=void 0,La=void 0,Va=void 0,Na=void 0,Ba=void 0,Ua=void 0,Ga=void 0,za=void 0,Ha=void 0,_a=void 0,Wa=void 0,Xa=void 0,Ya=void 0,qa=void 0,Za=void 0,Ja=void 0,Ka=!0,$a=.5,Qa=10,ei=!1,ti=0,ai=0,ii=0,si=0,ri=!1,ni=!1,oi=!1,li="initial",ci="",hi=0,di=0,pi=1.5,ui=!1,gi=!1,fi=!1,mi=!1,yi=!1,vi=!1,xi=!1,bi=0,wi=!1,ki=!1,Di=!1,Ci=!1,Ri=!1,Pi=!0,Si=!0,Mi=!0,Ti=!1,Ei=!1,Fi=!0,Ii=!1,ji=!1,Ai=!1,Oi=!1,Li=!1,Vi=!0,Ni=!1,Bi=!0,Ui=!0,Gi=!0,zi=!1,Hi=!1,_i=!0,Wi=!1,Xi=!1,Yi=!0,qi=!1,Zi=!1,Ji=!1,Ki=!1,$i=[],Qi=[],es=[],ts=!0,as=180,is=250,ss=100,rs=100,ns=void 0,os="",ls="",cs="#FFFFFF",hs="rgba(236, 236, 236, 0.5)",ds="rgba(0, 0, 0, 1)",ps=2,us="#FF0000",gs=!1,fs=!1,ms=!1,ys=!1,vs=!0,xs="rgb(62,62,62)",bs=17,ws=64e6,ks=30,Ds=30,Cs=!1,Rs="#0000ff",Ps="#ff8000",Ss={open:!1,url:"",custom:!1,filepath:"",mime:null,cacheid:null,displayname:null,openfileobj:null},Ms=!1,Ts=!1,Es=[],Fs=!1,Is=!1,js=!1,As=!1,Os=!1,Ls=!1,Vs=!1,Ns=!1,Bs=90,Us=-1,Gs=!1,zs=!1,Hs=!1,_s=!1,Ws=0,Xs=!1,Ys=1,qs="mm",Zs="mmÂ²",Js=1,Ks=1,$s=0,Qs=0,er=20,tr=50,ar=15,ir=12,sr=12,rr=210,nr=!1,or=!1,lr=!1,cr=!1,hr=1,dr=.95,pr=.35,ur=.5,gr=.5,fr=1,mr=!0,yr=[],vr=[],xr=[{name:"hide3d",cursor:"crosshair"},{name:"measure3D",cursor:"crosshair"},{name:"measurearc",cursor:"crosshair"},{name:"select3d",cursor:"crosshair"},{name:"Walkthrough3D",cursor:"default"},{name:"orbitControl",cursor:"default"},{name:"magnify",cursor:"default"},{name:"note",cursor:"default"},{name:"pencil",cursor:"crosshair"},{name:"rect",cursor:"crosshair"},{name:"count",cursor:"crosshair"},{name:"symbol",cursor:"default"},{name:"zoomwindow",cursor:"crosshair"},{name:"rectText",cursor:"default"},{name:"rectStamp",cursor:"default"},{name:"PickPolygon",cursor:"crosshair"},{name:"pan",cursor:"move"},{name:"selectText",cursor:"text"},{name:"markupedit",cursor:"default"},{name:"arrow",cursor:"crosshair"},{name:"callout",cursor:"default"},{name:"area",cursor:"crosshair"},{name:"measuretool",cursor:"crosshair"},{name:"measure",cursor:"crosshair"},{name:"calibrate",cursor:"crosshair"},{name:"link",cursor:"default"},{name:"interactiveStamp",cursor:"default"}],br=[],wr=[],kr=[],Dr=[],Cr=[],Rr=1,Pr="#FF0000",Sr="#FF0000",Mr="#FF0000",Tr="#FF0000",Er=100,Fr="Default",Ir="Default",jr=4,Ar=4,Or=0,Lr=0,Vr=0,Nr=!1,Br=!0,Ur=!1,Gr=!1,zr=!1,Hr=!1,_r=!1,Wr=!1,Xr="",Yr="",qr="",Zr="",Jr=!1,Kr=!1,$r=!1,Qr=!1,en=!1,tn="",an="",sn=[];const rn=.75;var nn={isactive:!1,consolidatelist:[],add:function(e,t,a){var i={markup:e,settings:t};if(this.consolidatelist.push(i),a)for(;this.consolidatelist.length>0;){var s=this.consolidatelist.pop();s.markup.Consolidate(s.settings)}}},on=!1,ln=new Image;ln.onload=function(){on=!0},ae&&(ln.src=ae),(new Image).src="";var cn,hn,dn,pn,un=document.createElement("canvas"),gn=document.createElement("img"),fn=0,mn={},yn=[],vn=[],xn=[];class bn{constructor(e){this.jsonmarkup=null,this.DocRef=e,this.pages=[],this.pcounter=0,this.bnotcomplete=!0,null!=e&&null!=e&&(e.markupsave=this),this.callback=void 0}setOncomplete(e){this.callback=e}setDocObj(e){null!=e&&null==e&&(this.DocRef=e)}oncomplete(){if("function"==typeof this.callback){var e=JSON.stringify(this.jsonmarkup);this.callback(e)}}createjsonexport(e,t,a){this.jsonmarkup=JSON.parse(ah(!1,a,Pi,e,0,this)),this.getnonloadedpages()}createjson(e,t){this.jsonmarkup=JSON.parse(ah(!0,!1,!0,e,0,this)),this.getnonloadedpages()}addpage(e){for(var t=!1,a=0;a<this.pages.length;a++)this.pages[a]==e&&(t=!0);t||this.pages.push(e)}getnonloadedpages(){if(this.pages.length>0){if(null!=this.DocRef){var e=this.pages.pop();null!=e&&this.DocRef.getPageObjectLoad(e)}}else this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}setpage(e){if(null!=this.DocRef&&null!=this.jsonmarkup)for(var t=0;t<this.DocRef.markuplist.length;t++)if(this.DocRef.markuplist[t].pagenumber==e.pagenumber&&!this.DocRef.markuplist[t].pdfannotproxy){if(this.DocRef.markuplist[t].bhasArrow&&null!=this.DocRef.markuplist[t].markupArrowConnected);else var a=JSON.parse(eh(this.DocRef.markuplist[t],this.DocRef,this.jsonmarkup,e,!1));null!=a&&this.jsonmarkup.push(a)}this.pages.length>0?this.getnonloadedpages():this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}}class wn{constructor(e){this.xmlmarkup=null,this.DocRef=e,this.pages=[],this.pcounter=0,this.bnotcomplete=!0,null!=e&&null!=e&&(e.markupsave=this),this.callback=void 0}setOncomplete(e){this.callback=e}setDocObj(e){null!=e&&null==e&&(this.DocRef=e)}oncomplete(){"function"==typeof this.callback&&this.callback(this.xmlmarkup)}createxmlexport(e,t,a){this.xmlmarkup=ih(!1,a,Pi,e,t,this),this.getnonloadedpages()}createxml(e,t){this.xmlmarkup=ih(!0,!1,!1,e,t,this),this.getnonloadedpages()}addpage(e){for(var t=!1,a=0;a<this.pages.length;a++)this.pages[a]==e&&(t=!0);t||this.pages.push(e)}getnonloadedpages(){if(this.pages.length>0){if(null!=this.DocRef){var e=this.pages.pop();null!=e&&this.DocRef.getPageObjectLoad(e)}}else this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}setpage(e){if(null!=this.DocRef&&null!=this.xmlmarkup)for(var t=0;t<this.DocRef.markuplist.length;t++)if(this.DocRef.markuplist[t].pagenumber==e.pagenumber){if(this.DocRef.markuplist[t].bhasArrow&&null!=this.DocRef.markuplist[t].markupArrowConnected);else var a=th(this.DocRef.markuplist[t],this.DocRef,this.xmlmarkup,e,!1);null!=a&&this.xmlmarkup.getElementsByTagName("Entities")[0].appendChild(a)}this.pages.length>0?this.getnonloadedpages():this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}}class kn{constructor(e,t,a,i){var s=this;this.color=i,this.imagesrc=e,this.w=t,this.h=a,this.width=t,this.height=a,this.imageloaded=!1,this.textureimage=new Image,this.threeTexture=null,this.threeTexture2=null,this.canvas2=null,this.context2=null,this.markupmaterial=null,this.markupmaterialblank=null,this.imageload=function(){s.imageloaded=!0},this.setimage=function(){s.textureimage.addEventListener("load",s.imageload,!1),s.textureimage.src=s.imagesrc},e&&s.setimage(e)}}class Dn{constructor(e,t,a,i){this.startx=e,this.starty=t,this.endx=a,this.endy=i,this.width=a-e,this.height=i-t;var s=e-a,r=t-i;this.angle=Math.atan2(this.height,this.width),this.reangle=Math.atan2(r,s),this.rehangle=Math.atan2(this.height,s),this.rewangle=Math.atan2(r,this.width)}}class Cn{constructor(e,t,a){this.pointID=e,this.x=t,this.y=a}}class Rn{constructor(e,t,a,i){var s=this;this.fontName=e,this.height=t,this.bold=a,this.italic=i,this.scale=1,this.scalepx=1;var r=this.height*this.scale;function n(){var e=s.height*s.scale;s.bold?(s.fontstring="bold "+s.height+"pt "+s.fontName,s.fontstringScaled="bold "+e+"pt "+s.fontName):s.italic?(s.fontstring="italic "+s.height+"pt "+s.fontName,s.fontstringScaled="italic "+e+"pt "+s.fontName):(s.fontstring="normal "+s.height+"pt "+s.fontName,s.fontstringScaled="normal "+e+"pt "+s.fontName)}a?(this.fontstring="bold "+this.height+"pt "+this.fontName,this.fontstringScaled="bold "+r+"pt "+this.fontName,this.fontstringpx="bold "+this.height+"px "+this.fontName):i?(this.fontstring="italic "+this.height+"pt "+this.fontName,this.fontstringScaled="italic "+r+"pt "+this.fontName,this.fontstringpx="italic "+this.height+"px "+this.fontName):(this.fontstring="normal "+this.height+"pt "+this.fontName,this.fontstringScaled="normal "+r+"pt "+this.fontName,this.fontstringpx="normal "+this.height+"px "+this.fontName),this.setFontname=function(e){this.fontName=e,n()},this.setHeight=function(e){this.height=e,n()},this.setBold=function(e){this.bold=e,e&&(this.italic=!1),n()},this.setItalic=function(e){this.italic=e,e&&(this.bold=!1),n()},this.setScale=function(e){var t=Hl();this.scale=e,this.scalepx=this.scale/t,n()},this.getScaledHeight=function(){return r}}}var Pn=new Rn("Arial",18,!1,!1);function Sn(e,t,a,i,s,r,n,o){if(e===a&&t===i||s===n&&r===o)return!1;var l=(o-r)*(a-e)-(n-s)*(i-t);if(0===l)return!1;var c=((n-s)*(t-r)-(o-r)*(e-s))/l,h=((a-e)*(t-r)-(i-t)*(e-s))/l;return!(c<0||c>1||h<0||h>1)&&{x:e+c*(a-e),y:t+c*(i-t)}}function Mn(e){var t=ti/2,a=ai/2,i=0,s={found:e.found,x:e.x,y:e.y},r=!1;switch(null!=hn.foxitdoc&&(r=!0),hn.getCurrentpage().getpageRotation()){case 0:i=hn.getCurrentpage().getpageRotation()*(Math.PI/180),r=!0;break;case 90:case 270:case 180:i=hn.getCurrentpage().getpageRotation()*(Math.PI/180)}var n=Math.cos(i),o=Math.sin(i),l=s.x-t,c=s.y-a,h=l*n-c*o,d=l*o+c*n;return r?s=e:(s.x=t+h,s.y=a+d),s}function Tn(e,t){var a=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(a.length!=i.length)return!1;for(var s=0;s<a.length;s++){var r=a[s];if(e[r]!==t[r])return!1}return!0}function En(e,t,a,i){var s=ti/2,r=ai/2,n=0,o={x1:e,x2:a,y1:t,y2:i};switch(hn.getCurrentpage().getpageRotation()){case 0:return n=hn.getCurrentpage().getpageRotation()*(Math.PI/180),o;case 90:n=(hn.getCurrentpage().getpageRotation()+180)*(Math.PI/180);break;case 270:n=(hn.getCurrentpage().getpageRotation()-180)*(Math.PI/180);break;case 180:n=hn.getCurrentpage().getpageRotation()*(Math.PI/180)}var l=Math.cos(n),c=Math.sin(n),h=e-s,d=t-r,p=a-s,u=i-r;switch((o={x1:h*l-d*c,y1:h*c+d*l,x2:p*l-u*c,y2:p*c+u*l}).x1=s+o.x1,o.y1=r+o.y1,o.x2=s+o.x2,o.y2=r+o.y2,hn.getCurrentpage().getpageRotation()){case 90:var g=o.y2;o.y2=o.y1,o.y1=g;break;case 270:var f=o.x2;o.x2=o.x1,o.x1=f;break;case 180:g=o.y2,o.y2=o.y1,o.y1=g,f=o.x2,o.x2=o.x1,o.x1=f}return o}function Fn(e,t){var a=ti/2,i=ai/2,s=0,r={x:e,y:t},n=hn.getCurrentpage().getpageRotation();switch(n){case 0:return s=n*(Math.PI/180),r;case 90:s=(n+180)*(Math.PI/180);break;case 270:s=(n-180)*(Math.PI/180);break;case 180:s=n*(Math.PI/180)}var o=Math.cos(s),l=Math.sin(s),c=e-a,h=t-i;return(r={x:c*o-h*l,y:c*l+h*o}).x=a+r.x,r.y=i+r.y,r}function In(e,t,a,i){return i=i*Math.PI/180,{x:Math.cos(i)*(e.x-t)-Math.sin(i)*(e.y-a)+t,y:Math.sin(i)*(e.x-t)+Math.cos(i)*(e.y-a)+a}}function jn(e){t=!1;var t=/^#[0-9A-F]{6}$/i.test(e);return 9==e.length&&(t=/^#[0-9A-F]{6}[0-9a-f]{0,2}$/i.test("#AABBCC80")),t}function An(e,t){var a=e.split(","),i=a[0].split("(");if(null!=i[1]){i=i[1].trim();var s=a[1].trim(),r=a[2].trim();return a[3].trim(),"rgba("+i+","+s+","+r+","+t/100+")"}}function On(e,t){var a=t.split("$").join("\\$").split("*").join(".*");return new RegExp("^"+a+"$","i").test(e)}function Ln(e){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function a(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+a(t[1])+a(t[2])+a(t[3])}function Vn(e,t){e=e.replace("#","");var a=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16);return 8==e.length&&(a=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16)),"rgba("+a+","+i+","+s+","+t/100+")"}function Nn(e){return e=e.replace("#",""),{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function Bn(e,t,a,i){for(var s=[0,-1,0,-1,5,-1,0,-1,0],r=Math.round(Math.sqrt(s.length)),n=.5*r|0,o=e.createImageData(t,a),l=o.data,c=e.getImageData(0,0,t,a).data,h=a,d=t;h--;)for(d=t;d--;){for(var p=h,u=d,g=4*(h*t+d),f=0,m=0,y=0,v=0;v<r;v++)for(var x=0;x<r;x++){var b=p+v-n,w=u+x-n;if(b>=0&&b<a&&w>=0&&w<t){var k=4*(b*t+w),D=s[v*r+x];f+=c[k]*D,m+=c[k+1]*D,y+=c[k+2]*D,c[k+3]}}l[g]=f*i+c[g]*(1-i),l[g+1]=m*i+c[g+1]*(1-i),l[g+2]=y*i+c[g+2]*(1-i),l[g+3]=c[g+3]}e.putImageData(o,0,0)}function Un(e,t){if(!(t<1&&t>0))throw"scale must be a positive number <1 ";var a=t*t,i=e.width,s=e.height,r=Math.ceil(i*t),n=Math.ceil(s*t),o=0,l=0,c=0,h=0,d=0,p=0,u=0,g=0,f=0,m=0,y=0,v=0,x=0,b=0,w=0,k=!1,D=!1,C=e.getContext("2d").getImageData(0,0,i,s).data,R=new Float32Array(4*i*s),P=0,S=0,M=0,T=0;for(l=0;l<s;l++)for(p=4*(f=0|(d=l*t))*r,(D=f!=(0|d+t))&&(b=f+1-d,w=d+t-f-1),o=0;o<i;o++,c+=4)u=p+4*(g=0|(h=o*t)),(k=g!=(0|h+t))&&(v=g+1-h,x=h+t-g-1),P=C[c],S=C[c+1],M=C[c+2],T=C[c+3],k||D?k&&!D?(m=v*t,R[u]+=P*m,R[u+1]+=S*m,R[u+2]+=M*m,R[u+3]+=T*m,y=x*t,R[u+4]+=P*y,R[u+5]+=S*y,R[u+6]+=M*y,R[u+7]+=T*y):D&&!k?(m=b*t,R[u]+=P*m,R[u+1]+=S*m,R[u+2]+=M*m,R[u+3]+=T*m,y=w*t,R[u+4*r]+=P*y,R[u+4*r+1]+=S*y,R[u+4*r+2]+=M*y,R[u+4*r+3]+=T*y):(m=v*b,R[u]+=P*m,R[u+1]+=S*m,R[u+2]+=M*m,R[u+3]+=T*m,y=x*b,R[u+4]+=P*y,R[u+5]+=S*y,R[u+6]+=M*y,R[u+7]+=T*y,y=v*w,R[u+4*r]+=P*y,R[u+4*r+1]+=S*y,R[u+4*r+2]+=M*y,R[u+4*r+3]+=T*y,y=x*w,R[u+4*r+4]+=P*y,R[u+4*r+5]+=S*y,R[u+4*r+6]+=M*y,R[u+4*r+7]+=T*y):(R[u]+=P*a,R[u+1]+=S*a,R[u+2]+=M*a,R[u+3]+=T*a);var E=document.createElement("canvas");E.width=r,E.height=n;var F=E.getContext("2d"),I=F.getImageData(0,0,r,n),j=I.data,A=0;for(c=0,u=0;A<r*n;c+=4,u+=4,A++)j[u]=Math.ceil(R[c]),j[u+1]=Math.ceil(R[c+1]),j[u+2]=Math.ceil(R[c+2]),j[u+3]=Math.ceil(R[c+3]);return F.putImageData(I,0,0),C=null,j=null,R=null,E}function Gn(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}function zn(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0);var a=t.toDataURL("image/png");return a="<![CDATA["+a+"]]>"}function Hn(e){return new Promise((function(t,a){const i=new Image;i.onload=function(e){const a=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}(e.currentTarget);t(a)},i.src=e}))}function _n(e,t,a,i){for(var s=t,r=!1,n=e.measureText(s);n.width>a&&s.length>1;)s=s.substring(0,s.length-1),n=e.measureText(s);if(t!=s){i.push(s);var o=t.substr(s.length);(n=e.measureText(o)).width>a?r=!0:(r=!1,i.push(o))}else i.push(s),r=!1;return{bNeedSplit:r,remainer:o,resultarray:i}}function Wn(e,t,a,i,s,r){var n,o,l="",c=t.split("\n"),h=[],d=[],p=[];s-=e.measureText(" ").width;for(var u=0;u<c.length;u++)l="",n=0,e.measureText(c[u]).width>s?(h=h.concat(c[u].split(" "))).push("\n"):(h.push(c[u]),h.push("\n"));for(n=0;n<h.length;n++)if("\n"!=h[n])for(var g=_n(e,h[n],s,d);g.bNeedSplit;)g=_n(e,g.remainer,s,d);else d.push(h[n]);for(n=0;n<d.length;n++)"\n"!=d[n]?(o=l+d[n]+" ",e.measureText(o).width>s&&n>0?(""!=l&&p.push(l),l=d[n]+" "):l=o):(""!=l&&p.push(l),l="");for(n=0;n<p.length;n++)"\n"!=p[n]&&(e.fillText(p[n],a,i),i+=r)}pn=function(e,t){this.x=e,this.y=t};class Xn{constructor(e,t){this.width=e,this.height=t}}class Yn{constructor(e,t,a,i){this.x=e,this.y=t,this.w=a,this.h=i}}class qn{constructor(e,t,a,i,s){this.Signature=e,this.DisplayName=t,this.Layer=a,this.Color=i,this.display=!0,this.default=s}}class Zn{constructor(e,t,a,i){this.Layer=e,this.Name=a,this.Color=t,this.display=i}}function Jn(e){for(var t=!1,a=0;a<wr.length;a++)wr[a].Signature==e&&(t=!0);return t}function Kn(e){for(var t="default user",a=0;a<wr.length;a++)wr[a].Signature==e&&(t=wr[a].DisplayName);return t}function $n(e){for(var t=!0,a=0;a<wr.length;a++)wr[a].Signature==e&&(t=wr[a].display);return t}function Qn(e){for(var t="#FF0000",a=0;a<Dr.length;a++)Dr[a].Layer==e&&(t=Dr[a].Color);return t}function eo(e){for(var t=!0,a=0;a<Dr.length;a++)Dr[a].Layer==e&&(t=Dr[a].display);return t}function to(e){return e%2==0}function ao(e){var t=Number(e).toString(16);return t="#"+(t=(t="000000".substr(0,6-t.length)+t).toUpperCase())}function io(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)}function so(e,t,a,i){if(a)var s=Pn.height*a/.75,r=100*a;else s=Pn.height/.75,r=100;return i&&(1==i?t-=.5*s:2==i?(e-=r,t-=.5*s):3==i?(e-=.5*r,t-=s):4==i&&(e-=.5*r)),{x:e,y:t,w:r,h:s}}function ro(e){var t={x:0,y:0},a=Hl();if(yd())return t;if(null!=e)var i=hn.getpage(e);else i=hn.getCurrentpage();return i.usevectorxml?(t.x=i.dxvector,t.y=i.dyvector):i.usepdfjs?(t.x=i.dxpdf,t.y=i.dypdf,t.x*=a,t.y*=a):(t.x=i.dx,t.y=i.dy),i.usevector3Dxml&&(t.x=.5*ti,t.y=.5*ai),t}function no(e){if(null!=e)var t=hn.getpage(e);else t=hn.getCurrentpage();return t.fixedScale}function oo(){var e=!1;return hn.getCurrentpage().usepdfjs&&null!=hn.getCurrentpage().DocRef.foxitdoc&&(e=!0),e}function lo(e){if(yd())return 1;var t=Hl();if(null!=e)var a=hn.getpage(e);else a=hn.getCurrentpage();var i=a.dscale;return a.usevectorxml?i=a.dscalevector:a.usepdfjs?(i=a.curpagescale*a.dscalepdf,i*=t):(i=a.dscale,0==hn.Type&&(i=hn.pages[0].dscale)),a.usevector3Dxml&&(i=1),i}function co(e){var t=!1;return null==e||(t=!e.usevectorxml&&!e.usepdfjs,e.usevector3Dxml&&(t=!0)),t}function ho(){var e=!1;return yd()||(e=!hn.getCurrentpage().usevectorxml&&!hn.getCurrentpage().usepdfjs,hn.getCurrentpage().usevector3Dxml&&(e=!0)),e}function po(e,t){var a=!1;if(yd())return a;var i=io(Math.max(e.x,t.x)-Math.min(e.x,t.x),Math.max(e.y,t.y)-Math.min(e.y,t.y)),s=e.x-i,r=e.x+i,n=e.y-i,o=e.y+i;if(0==hn.getCurrentpage().getpageRotation())s>hn.getCurrentpage().startx&&r<hn.getCurrentpage().endx&&n>hn.getCurrentpage().starty&&o<hn.getCurrentpage().endy&&(a=!0),a&&t.x>hn.getCurrentpage().startx&&t.x<hn.getCurrentpage().endx&&t.y>hn.getCurrentpage().starty&&t.y<hn.getCurrentpage().endy&&(a=!0);else{var l=hn.getCurrentpage().rotatedRect();s>l.x&&r<l.w&&n>l.y&&o<l.h&&(a=!0),a&&t.x>l.x&&t.x<l.w&&t.y>l.y&&t.y<l.h&&(a=!0)}return hn.getCurrentpage().usevector3Dxml&&(a=!0),a}function uo(e,t){var a=!1;if(yd())return a;var i=e.x,s=e.y,r=e.x+e.w,n=e.y+e.h;return hn.getCurrentpage().getpageRotation(),i>t.startx&&i<t.endx&&s>t.starty&&s<t.endy&&r>t.startx&&r<t.endx&&n>t.starty&&n<t.endy&&(a=!0),hn.getCurrentpage().usevector3Dxml&&(a=!0),a}function go(e){var t=!1;if(yd())return t;var a=e.x,i=e.y,s=e.x+e.w,r=e.y+e.h;hn.getCurrentpage().getpageRotation();var n=hn.getCurrentpage().getpagerectdirect(),o=n.x,l=n.w,c=n.y,h=n.h;if(n.usepixelscale){var d=Hl();o*=d,l*=d,c*=d,h*=d}return a>o&&a<l&&i>c&&i<h&&s>o&&s<l&&r>c&&r<h&&(t=!0),hn.getCurrentpage().usevector3Dxml&&(t=!0),t}function fo(e){var t=!1;if(yd())return t;var a=hn.getCurrentpage().getpagerectdirect(),i=a.x,s=a.w,r=a.y,n=a.h,o=e.x,l=e.y;if(a.usepixelscale&&(i*=h=Hl(),s*=h,r*=h,n*=h),e.busepadding&&(o=e.xpadding,l=e.ypadding),0==hn.getCurrentpage().getpageRotation())o>i&&o<s&&l>r&&l<n&&(t=!0);else if(hn.getCurrentpage().usepdfjs){var c=hn.getCurrentpage().getFoxitpageRect();if(a.usepixelscale){var h=Hl();c.x*=h,c.w*=h,c.y*=h,c.h*=h}o>c.x&&o<c.w&&l>c.y&&l<c.h&&(t=!0)}else{var d=hn.getCurrentpage().rotatedRect();o>d.x&&o<d.w&&l>d.y&&l<d.h&&(t=!0)}return hn.getCurrentpage().usevector3Dxml&&(t=!0),t}function mo(e){return e*e}function yo(e,t){return mo(e.x-t.x)+mo(e.y-t.y)}function vo(e){var t=[],a=(t=e.slice())[0],i=t[t.length-1];a.x==i.x&&a.y==i.y||t.push(a);for(var s,r,n,o=0,l=0,c=0,h=t.length,d=0,p=h-1;d<h;p=d++)s=t[d],r=t[p],o+=n=s.x*r.y-r.x*s.y,l+=(s.x+r.x)*n,c+=(s.y+r.y)*n;return{x:l/(n=3*o),y:c/n}}function xo(e,t,a,i,s,r,n){let o=e-s,l=t-r,c=a-s,h=i-r,d=Math.hypot(o,l),p=Math.hypot(c,h);if(0===d||0===p)return{x:s,y:r};o/=d,l/=d,c/=p,h/=p;let u=o+c,g=l+h,f=Math.hypot(u,g);return 0===f&&(u=-l,g=o,f=Math.hypot(u,g)),u/=f,g/=f,{x:s+u*n,y:r+g*n}}function bo(e,t,a,i,s,r,n){var o,l,c,h,d;if((c=Math.atan2(t-i,e-a))<0&&(c+=2*Math.PI),r<0&&(r+=2*Math.PI),(h=r+n)<r&&(d=r,r=h,h=d),function(e,t,a){e=(e+2*Math.PI)%(2*Math.PI);let i=((t=(t+2*Math.PI)%(2*Math.PI))+a+2*Math.PI)%(2*Math.PI);return a>=0?t<i?e>=t&&e<=i:e>=t||e<=i:t>i?e<=t&&e>=i:e<=t||e>=i}(c,r,n))o=a+s*Math.cos(c),l=i+s*Math.sin(c);else{let e=Math.abs((c-r+2*Math.PI)%(2*Math.PI))<Math.abs((c-(r+n)+2*Math.PI)%(2*Math.PI))?r:r+n;o=a+s*Math.cos(e),l=i+s*Math.sin(e)}return Math.sqrt(Math.pow(o-e,2)+Math.pow(l-t,2))}function wo(e,t,a){return Math.sqrt(function(e,t,a){var i=yo(t,a);if(0==i)return yo(e,t);var s=((e.x-t.x)*(a.x-t.x)+(e.y-t.y)*(a.y-t.y))/i;return yo(e,s<0?t:s>1?a:{x:t.x+s*(a.x-t.x),y:t.y+s*(a.y-t.y)})}(e,t,a))}function ko(e,t,a,i,s,r,n,o){var l=i-t,c=e-a,h=a*t-e*i,d=l*s+c*r+h,p=l*n+c*o+h;if(d>0&&p>0)return 0;if(d<0&&p<0)return 0;var u=o-r,g=s-n,f=n*r-s*o;return p=u*a+g*i+f,(d=u*e+g*t+f)>0&&p>0||d<0&&p<0?0:l*g-u*c==0?2:1}function Do(e,t,a,i,s,r,n,o,l){for(var c=0,h=l.x,d=l.y,p=o.x,u=o.y,g=0,f=0,m=0,y=0,v=0;v<n.points.length;v+=2)g=(n.points[v]-i)*e,f=(r-n.points[v+1])*e,v+3<n.points.length?(m=(n.points[v+2]-i)*e,y=(r-n.points[v+3])*e):(m=(n.points[0]-i)*e,y=(r-n.points[1])*e),c+=ko(h,d,p,u,g+=t,f+=a,m+=t,y+=a);if(n.gotsubpath)for(var x=0;x<n.subpaths.length;x++)for(v=0;v<n.subpaths[x].points.length;v+=2)g=(n.subpaths[x].points[v]-i)*e,f=(r-n.subpaths[x].points[v+1])*e,v+3<n.subpaths[x].points.length?(m=(n.subpaths[x].points[v+2]-i)*e,y=(r-n.subpaths[x].points[v+3])*e):(m=(n.subpaths[x].points[0]-i)*e,y=(r-n.subpaths[x].points[1])*e),c+=ko(h,d,p,u,g+=t,f+=a,m+=t,y+=a);return!to(c)}function Co(e,t,a,i,s,r,n,o){for(var l=0,c=o.x,h=o.y,d=n.x,p=n.y,u=0;u<r.length;u++){var g=(r[u].x1-i)*e;g+=t;var f=(r[u].y1-s)*e;f+=a;var m=(r[u].x2-i)*e;m+=t;var y=(r[u].y2-s)*e;l+=ko(c,h,d,p,g,f,m,y+=a)}return!to(l)}function Ro(e){var t=0,a=0,i=e.length;for(t=0;t<i-1;t++)a+=e[t].x*e[t+1].y-e[t+1].x*e[t].y;return a+=e[i-1].x*e[0].y-e[0].x*e[i-1].y,Math.abs(a/2)}function Po(){Dr[0]=new Zn(0,"#ffffff","Layer 0",!0),Dr[1]=new Zn(1,"#ff0000","Layer 1",!0),Dr[2]=new Zn(2,"#0000ff","Layer 2",!0),Dr[3]=new Zn(3,"#008000","Layer 3",!0),Dr[4]=new Zn(4,"#ffff00","Layer 4",!0),Dr[5]=new Zn(5,"#a52a2a","Layer 5",!0),Dr[6]=new Zn(6,"#ffd700","Layer 6",!0),Dr[7]=new Zn(7,"#fff5ee","Layer 7",!0),Dr[8]=new Zn(8,"#fff8dc","Layer 8",!0),Dr[9]=new Zn(9,"#fffacd","Layer 9",!0),Dr[10]=new Zn(10,"#ffffe0","Layer 10",!0),Dr[11]=new Zn(11,"#98fb98","Layer 11",!0),Dr[12]=new Zn(12,"#afeeee","Layer 12",!0),Dr[13]=new Zn(13,"#e0ffff","Layer 13",!0),Dr[14]=new Zn(14,"#e6e6fa","Layer 14",!0),Dr[15]=new Zn(15,"#dda0dd","Layer 15",!0),Dr[16]=new Zn(16,"#d3d3d3","Layer 16",!0),Dr[17]=new Zn(17,"#ffc0cb","Layer 17",!0),Dr[18]=new Zn(18,"#ffe4c4","Layer 18",!0),Dr[19]=new Zn(19,"#ffe4b5","Layer 19",!0),Dr[20]=new Zn(20,"#f0e68c","Layer 20",!0),Dr[21]=new Zn(21,"#90ee90","Layer 21",!0),Dr[22]=new Zn(22,"#20b2aa","Layer 22",!0),Dr[23]=new Zn(23,"#87cefa","Layer 23",!0),Dr[24]=new Zn(24,"#6495ed","Layer 24",!0),Dr[25]=new Zn(25,"#ee82ee","Layer 25",!0),Dr[26]=new Zn(26,"#c0c0c0","Layer 26",!0),Dr[27]=new Zn(27,"#f08080","Layer 27",!0),Dr[28]=new Zn(28,"#f4a460","Layer 28",!0),Dr[29]=new Zn(29,"#000000","Layer 29",!0)}function So(e){var t=null;if(window.DOMParser)t=(new DOMParser).parseFromString(e,"text/xml");else{if(!window.ActiveXObject)throw new Error("Cannot parse XML");(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)}return t}function Mo(e,t,a){Cr.push({type:"color",name:e,ptrn:null,tilesize:0,color:t,description:a,inuse:!1})}function To(e,t,a,i,s){Cr.push({type:"hatch",name:t,ptrn:e,tilesize:a,color:i,description:s,inuse:!1})}function Eo(){return Cr}function Fo(e,t){for(var a=0;a<Cr.length;a++)if(e==Cr[a].name){Cr[a].inuse=t,null!=Aa&&Aa.setHatchchange(Cr[a]);break}}function Io(e){for(var t=null,a=0;a<Cr.length;a++)if(e==Cr[a].name){t=Cr[a].type;break}return t}function jo(e){for(var t=null,a=0;a<Cr.length;a++)if(e==Cr[a].name){t=Cr[a].color;break}return t}function Ao(e,t){for(var a=null,i=0;i<Cr.length;i++)if(t==Cr[i].name&&"hatch"==Cr[i].type){null!=Cr[i].ptrn&&(a=e.createPattern(Cr[i].ptrn,"repeat"));break}return a}function Oo(e){return"diagonal-forward"==e?3:"diagonal-back"==e?2:"diagonal-cross"==e?5:"hatch-horizontal"==e?0:"hatch-vertical"==e?1:"hatch-cross"==e?4:-1}function Lo(e){var t="diagonal-forward";switch(e){case 0:t="hatch-horizontal";break;case 1:t="hatch-vertical";break;case 2:t="diagonal-back";break;case 3:t="diagonal-forward";break;case 4:t="hatch-cross";break;case 5:t="diagonal-cross"}return t}function Vo(e,t){var a=function(e){for(var t=null,a=0;a<Cr.length;a++)if(e==Cr[a].name){t=Cr[a];break}return t}(Lo(e));null!=a&&(function(e){return e instanceof HTMLCanvasElement}(a.ptrn)?a.color!=t&&No(a.ptrn.getContext("2d"),e,t):Bo(e,t))}function No(e,t,a){switch(e.strokeStyle=a,e.lineWidth=1,t){case 3:e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.moveTo(10,16),e.lineTo(16,10),e.moveTo(2,16),e.lineTo(16,2),e.moveTo(0,2),e.lineTo(2,0),e.stroke();break;case 2:e.beginPath(),e.moveTo(0,14),e.lineTo(2,16),e.moveTo(0,6),e.lineTo(10,16),e.moveTo(2,0),e.lineTo(16,14),e.moveTo(10,0),e.lineTo(16,6),e.stroke();break;case 5:e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.moveTo(10,16),e.lineTo(16,10),e.moveTo(2,16),e.lineTo(16,2),e.moveTo(0,2),e.lineTo(2,0),e.moveTo(0,14),e.lineTo(2,16),e.moveTo(0,6),e.lineTo(10,16),e.moveTo(2,0),e.lineTo(16,14),e.moveTo(10,0),e.lineTo(16,6),e.stroke();break;case 0:e.beginPath(),e.moveTo(0,4),e.lineTo(16,4),e.moveTo(0,12),e.lineTo(16,12),e.stroke();break;case 1:e.beginPath(),e.moveTo(4,0),e.lineTo(4,16),e.moveTo(12,0),e.lineTo(12,16),e.stroke();break;case 4:e.beginPath(),e.moveTo(0,4),e.lineTo(16,4),e.moveTo(0,12),e.lineTo(16,12),e.moveTo(4,0),e.lineTo(4,16),e.moveTo(12,0),e.lineTo(12,16),e.stroke()}}function Bo(e,t){var a=document.createElement("canvas");a.width=16,a.height=16;var i=a.getContext("2d"),s=Lo(e);No(i,e,t),To(a,s,{w:16,h:16},t,"no description")}function Uo(e,t,a){return(un=document.createElement("canvas")).width=16,un.height=16,No(un.getContext("2d"),t,a),e.createPattern(un,"repeat")}function Go(e){for(var t=e.split("/"),a=0;a<t.length-1;a++)t[a];return t[t.length-1]}function zo(e){var t="";if(e){for(var a=e.split("/"),i=0;i<a.length-1;i++)t+=a[i]+"/";se&&(t=$)}return t}function Ho(e){for(var t="",a=e.split("\\"),i=0;i<a.length-1;i++)t+=a[i]+"\\";return t||(t=e),t}function _o(e){var t="";if(e)if(e.indexOf("https://")>-1)t=Go(e);else if(e.indexOf("http://")>-1)t=Go(e);else{for(var a=e.split("\\"),i=0;i<a.length-1;i++)a[i];t=a[a.length-1]}return t}function Wo(e){for(var t="",a=e.split("\\"),i=0;i<a.length;i++)i<a.length-1&&(t+=a[i]+"\\\\");return t||(t=e),t}function Xo(e,t,a,i){var s=[{minX:e*Math.cos(Math.PI/180*22.5),maxX:e*Math.cos(0)},{minX:e*Math.cos(Math.PI/180*67.5),maxX:e*Math.cos(Math.PI/180*22.5)},{minX:e*Math.cos(Math.PI/180*112.5),maxX:e*Math.cos(Math.PI/180*67.5)},{minX:e*Math.cos(Math.PI/180*157.5),maxX:e*Math.cos(Math.PI/180*112.5)},{minX:e*Math.cos(Math.PI/180*180),maxX:e*Math.cos(Math.PI/180*157.5)},{minX:e*Math.cos(Math.PI/180*202.5),maxX:e*Math.cos(Math.PI/180*247.5)},{minX:e*Math.cos(Math.PI/180*247.5),maxX:e*Math.cos(Math.PI/180*292.5)},{minX:e*Math.cos(Math.PI/180*292.5),maxX:e*Math.cos(Math.PI/180*337.5)}],r=Math.sqrt(Math.abs(t)*Math.abs(t)+Math.abs(a)*Math.abs(a)),n=new THREE.Vector2(t,a).normalize().clone().multiplyScalar(e);n.x>=0&&n.y>=0?r>50?s[0].maxX>=n.x&&n.x>=s[0].minX?hn.getCurrentpage().walkthroughcontrol.movedirection(4,1==i):s[1].maxX>=n.x&&n.x>=s[1].minX||s[2].maxX>=n.x&&n.x>=s[2].minX&&hn.getCurrentpage().walkthroughcontrol.movedirection(1,1==i):hn.getCurrentpage().walkthroughcontrol.movedirection(5,1==i):n.x<=0&&n.y>=0?r>50?s[2].maxX>=n.x&&n.x>=s[2].minX?hn.getCurrentpage().walkthroughcontrol.movedirection(1,1==i):s[3].maxX>=n.x&&n.x>=s[3].minX||s[4].maxX>=n.x&&n.x>=s[4].minX&&hn.getCurrentpage().walkthroughcontrol.movedirection(3,1==i):hn.getCurrentpage().walkthroughcontrol.movedirection(5,1==i):n.x<=0&&n.y<=0?r>50?s[4].maxX>=n.x&&n.x>=s[4].minX?hn.getCurrentpage().walkthroughcontrol.movedirection(3,1==i):s[5].maxX>=n.x&&n.x>=s[5].minX||s[6].maxX>=n.x&&n.x>=s[6].minX&&hn.getCurrentpage().walkthroughcontrol.movedirection(2,1==i):hn.getCurrentpage().walkthroughcontrol.movedirection(6,1==i):n.x>=0&&n.y<=0&&(r>50?s[6].maxX>=n.x&&n.x>=s[6].minX?hn.getCurrentpage().walkthroughcontrol.movedirection(2,1==i):s[7].maxX>=n.x&&n.x>=s[7].minX||s[0].maxX>=n.x&&n.x>=s[0].minX&&hn.getCurrentpage().walkthroughcontrol.movedirection(4,1==i):hn.getCurrentpage().walkthroughcontrol.movedirection(6,1==i))}function Yo(){return hn.selectedmarkup}function qo(e){if(!yd()){var t=hn.getCurrentpage().scaleObject.Unitofmeasure;k&&(t=k.scaleObject.Unitofmeasure);var a=0,i=hn.getCurrentpage().DPI,s=i/25.4,r=i,n=hn.getCurrentpage().scaleObject.getMeasureScale();k&&(n=k.scaleObject.getMeasureScale()),null==n&&(n=Js),hn.getCurrentpage().usepdfjs&&(s=(i=72)/25.4,r=i);var o=s*s,l=r*r,c=n*n;if(hn.getCurrentpage().usevectorxml)var h=hn.getCurrentpage().OriginalScale*hn.getCurrentpage().OriginalScale;else h=hn.getCurrentpage().usepdfjs?hn.getCurrentpage().OriginalScale*hn.getCurrentpage().OriginalScale:hn.getCurrentpage().MainImageScaling*hn.getCurrentpage().MainImageScaling;hn.getCurrentpage().dscale,hn.getCurrentpage().dscale,hn.getCurrentpage().usevectorxml?(hn.getCurrentpage().dscalevector,hn.getCurrentpage().dscalevector):hn.getCurrentpage().usepdfjs&&(hn.getCurrentpage().curpagescale,hn.getCurrentpage().dscalepdf,hn.getCurrentpage().curpagescale,hn.getCurrentpage().dscalepdf);var d=hn.getCurrentpage().OriginalScale*hn.getCurrentpage().OriginalScale;a=e/h*c;var p=hn.getCurrentpage().scaleObject.getUnitScale();if(k&&(p=k.scaleObject.getUnitScale()),a/=p*p,0!=i)switch(t){case 1:a/=o;break;case 2:a/=l}else hn.getCurrentpage().usevectorxml||(a/=d);return a}}function Zo(e,t){var a=0;if(yd())return a;var i=hn.getCurrentpage().DPI,s=hn.getCurrentpage().scaleObject.Unitofmeasure,r=i/25.4,n=i;hn.getCurrentpage().usepdfjs&&(r=(i=72)/25.4,n=i),e*=hr;var o=hn.getCurrentpage().scaleObject.getMeasureScale();if(k&&(o=k.scaleObject.getMeasureScale()),null==o&&(o=Js),a=hn.getCurrentpage().usevectorxml||hn.getCurrentpage().usepdfjs||hn.getCurrentpage().usevector3Dxml?e/o*hn.getCurrentpage().OriginalScale:e/o*hn.getCurrentpage().MainImageScaling,0!=i)switch(s){case 1:a*=r;break;case 2:a*=n}return a}var Jo=function(e,t){return t<1e-7?e:Jo(t,Math.floor(e%t))};function Ko(e){var t=0,a=0,i=0;if(!yd()){var s=hn.getCurrentpage().DPI,r=s,n=hn.getCurrentpage().scaleObject.getMeasureScale();k&&(n=k.scaleObject.getMeasureScale()),null==n&&(n=Js),hn.getCurrentpage().usepdfjs&&(r=s=72),t=hn.getCurrentpage().usevectorxml||hn.getCurrentpage().usepdfjs||hn.getCurrentpage().usevector3Dxml?e/hn.getCurrentpage().OriginalScale*n:e/hn.getCurrentpage().MainImageScaling*n;var o=hn.getCurrentpage().scaleObject.getUnitScale();k&&(o=k.scaleObject.getUnitScale()),t/=o,0!=s?t/=r:hn.getCurrentpage().usevectorxml||(t/=hn.getCurrentpage().OriginalScale);var l=Math.floor(t/hr);a=t%hr,a*=o;var c=Math.floor(a);if(i=a-c,1==(i=Math.round(32*i)/32)&&(1==o?(l+=i,i=0):12==o&&(c+=i,i=0)),i>.03125){var h=i.toString().length-2,d=Math.pow(10,h),p=i*d,u=Jo(p,d);p/=u,d/=u;var g=Math.floor(p),f=Math.floor(d)}else g=0,f=0;return{quot:l,rem:c,remdec:i,numerator:g,denominator:f}}}function $o(e){var t=0;if(yd())return t;var a=hn.getCurrentpage().scaleObject.Unitofmeasure;k&&(a=k.scaleObject.Unitofmeasure);var i=hn.getCurrentpage().DPI,s=i/25.4,r=i,n=Js;if(null==n&&(n=Js),hn.getCurrentpage().usepdfjs&&(s=(i=72)/25.4,r=i),t=hn.getCurrentpage().usevectorxml||hn.getCurrentpage().usepdfjs||hn.getCurrentpage().usevector3Dxml?e/hn.getCurrentpage().OriginalScale*n:e/hn.getCurrentpage().MainImageScaling*n,t/=1,0!=i)switch(a){case 1:t/=s;break;case 2:t/=r}else hn.getCurrentpage().usevectorxml||(t/=hn.getCurrentpage().OriginalScale);return t}function Qo(e){var t=0;if(yd())return t;var a=hn.getCurrentpage().scaleObject.Unitofmeasure;k&&(a=k.scaleObject.Unitofmeasure);var i=hn.getCurrentpage().DPI,s=i/25.4,r=i,n=hn.getCurrentpage().scaleObject.getMeasureScale();k&&(n=k.scaleObject.getMeasureScale()),null==n&&(n=Js),hn.getCurrentpage().usepdfjs&&(s=(i=72)/25.4,r=i),t=hn.getCurrentpage().usevectorxml||hn.getCurrentpage().usepdfjs||hn.getCurrentpage().usevector3Dxml?e/hn.getCurrentpage().OriginalScale*n:e/hn.getCurrentpage().MainImageScaling*n;var o=hn.getCurrentpage().scaleObject.getUnitScale();if(k&&(o=k.scaleObject.getUnitScale()),t/=o,0!=i)switch(a){case 1:t/=s;break;case 2:t/=r}else hn.getCurrentpage().usevectorxml||(t/=hn.getCurrentpage().OriginalScale);return t}function el(e){var t=!1;if(e&&(e.bredoonly?(hn.markupredolist.push(e),e=function(e){var t,a=0;for(a=0;a<e.length;a++)if(e[a].bredoonly){t=e[a],e.splice(a,1);break}return t}(hn.markupredolist)):hn.markupundolist.push(e)),null!=e){e.markupnumber;var a=0;for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&hn.markuplist[a].markupnumber==e.markupnumber&&(e.PerformUndo(hn.markuplist[a],hn),t=!0);t||e.PerformUndo(void 0,hn)}}function tl(e){var t=function(e,t){var a=0,i=void 0,s=[];for(a=0;a<t.tempundolist.length;a++)null!=t.tempundolist[a]&&(t.tempundolist[a].markupnumber==e?i=t.tempundolist[a]:s.push(t.tempundolist[a]));return t.tempundolist=[],t.tempundolist=s,i}(e.markupnumber,hn);null!=t&&(function(e,t){var a=0,i=0;for(a=0;a<t.length;a++)t[a].markupnumber==e&&t[a].bmodify&&i++;return 0==i}(e.markupnumber,hn.markupundolist)&&(t.isfirstbmodify=!0),hn.markupundolist.push(t),function(e,t){var a=0,i=[],s=0;for(a=0;a<t.markupredolist.length;a++)null!=t.markupredolist[a]&&t.markupredolist[a].markupnumber==e&&(t.markupredolist[a].bredoonly||(i[s]=t.markupredolist[a],s++));t.markupredolist=[],t.markupredolist=i}(e.markupnumber,hn))}function al(e){var t=!1;if(e&&(e.bcreate||e.bdelete||(function(e,t){var a=0,i=!0;for(a=0;a<t.markupredolist.length;a++)null!=t.markupredolist[a]&&t.markupredolist[a].markupnumber==e&&t.markupredolist[a].bredoonly&&(i=!1);return i}(e.markupnumber,hn)&&function(e){var t,a=0;for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&hn.markuplist[a].markupnumber==e.markupnumber&&(t=new ll(e.markupnumber),e.bMultiOp&&t.setmultiValues(e.multiOpId),t.bmodify=!0,t.bredoonly=!0,t.SetUndoValues(hn.markuplist[a]),hn.markupredolist.unshift(t))}(e),function(e,t){var a=0;for(a=0;a<t.length;a++)t[a].markupnumber==e&&(t[a].bcurstate=!1)}(e.markupnumber,hn.markupredolist),e.bcurstate=!0),hn.markupredolist.push(e)),null!=e){var a=0;for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&hn.markuplist[a].markupnumber==e.markupnumber&&(e.PerformUndo(hn.markuplist[a],hn),t=!0);t||e.PerformUndo(void 0,hn)}}function il(){var e,t=0;for(br=[],t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&(hn.markuplist[t].drawn=!1,(e=new ll(hn.markuplist[t].markupnumber)).SetUndoValues(hn.markuplist[t]),br.push(e))}function sl(e,t){var a=0;for(a=0;a<hn.markuplist.length;a++)if(null!=hn.markuplist[a]&&hn.markuplist[a].markupnumber==e){if(hn.markuplist[a].bisTextArrow)continue;hn.markuplist[a].savemarkupstateChanged(hn,t)}}function rl(e,t){var a=0;for(a=0;a<hn.markuplist.length;a++)if(null!=hn.markuplist[a]&&hn.markuplist[a].markupnumber==e){if(hn.markuplist[a].bisTextArrow)continue;hn.markuplist[a].savemarkupstate(hn,t)}}function nl(e){var t=new ll(e.markupnumber);e.bMultiOp&&(t.setmultiValues(e.multiOpId),e.resetmultiValues()),t.SetUndoValues(e),hn.markupundolist.push(t)}class ol{static renderPoints=(e,t,a)=>{t.startX&&t.startY&&ol.renderPoint(e,{x:t.startXscaled,y:t.startYscaled},a),t.secondX&&t.secondY&&ol.renderPoint(e,{x:t.secondXscaled,y:t.secondYscaled},a),t.endX&&t.endY&&ol.renderPoint(e,{x:t.endXscaled,y:t.endYscaled},a)};static renderPoint=(e,t,a)=>{e.save(),e.fillStyle=a,e.beginPath(),e.arc(t.x,t.y,3,0,2*Math.PI),e.fill(),e.restore()};static isclose=(e,t,a,i,s)=>{const r=this.calculateCircumCircle(e,t,a);if(!r)return!1;const{center:n,radius:o}=r,l=Math.atan2(e.y-n.y,e.x-n.x),c=Math.atan2(t.y-n.y,t.x-n.x),h=Math.atan2(a.y-n.y,a.x-n.x),d=e=>(e+2*Math.PI)%(2*Math.PI),p=d(l),u=d(c),g=d(h),f=(u-p+2*Math.PI)%(2*Math.PI),m=(g-p+2*Math.PI)%(2*Math.PI),y=(u-g+2*Math.PI)%(2*Math.PI);let v=!1;f<Math.PI?(m>f||y>f)&&(v=!0):v=!(m<f&&y<f);const x=v?(p-u+2*Math.PI)%(2*Math.PI)*-1:(u-p+2*Math.PI)%(2*Math.PI);return bo(i.x,i.y,n.x,n.y,o,p,x)<=s};static autoPlaceThirdPoint(e,t,a=.5){const i=(e.x+t.x)/2,s=(e.y+t.y)/2,r=t.x-e.x,n=t.y-e.y,o=Math.hypot(r,n);return 0===o?{x:i,y:s}:{x:i+-n/o*o*a,y:s+r/o*o*a}}static drawInitialArc=(e,t,a,i=1.2,s,r)=>{e.save();const n=Math.hypot(a.x-t.x,a.y-t.y);if(0===n)return void e.restore();const o=i*n,l=(t.x+a.x)/2,c=(t.y+a.y)/2,h=a.x-t.x,d=a.y-t.y,p=Math.hypot(h,d),u=-d/p,g=h/p,f=n,m=Math.sqrt(o*o-f/2*(f/2)),y=l+u*m,v=c+g*m,x=Math.atan2(t.y-v,t.x-y),b=Math.atan2(a.y-v,a.x-y),w=e=>e<0?e+2*Math.PI:e,k=w(x),D=w(b),C=(D-k+2*Math.PI)%(2*Math.PI)>Math.PI;return e.beginPath(),e.strokeStyle=s,e.lineWidth=r,e.arc(y,v,o,k,D,C),e.stroke(),e.beginPath(),e.fillStyle=s,e.arc(y,v,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t.x,t.y,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a.x,a.y,3,0,2*Math.PI),e.fill(),e.restore(),{x:y+o*Math.cos((k+D)/2),y:v+o*Math.sin((k+D)/2),labelposx:l,labelposy:c}};static calculateArcMeasurements(e,t,a){const i=this.calculateCircumCircle(e,t,a);if(!i)return{radius:0,arcLength:0};const{center:s,radius:r}=i,n=Math.atan2(e.y-s.y,e.x-s.x),o=Math.atan2(t.y-s.y,t.x-s.x),l=Math.atan2(a.y-s.y,a.x-s.x),c=e=>(e+2*Math.PI)%(2*Math.PI),h=c(n),d=c(o),p=c(l),u=(d-h+2*Math.PI)%(2*Math.PI),g=(p-h+2*Math.PI)%(2*Math.PI),f=(d-p+2*Math.PI)%(2*Math.PI);let m=!1;return u<Math.PI?(g>u||f>u)&&(m=!0):m=!(g<u&&f<u),{radius:r,arcLength:r*(m?(h-d+2*Math.PI)%(2*Math.PI):(d-h+2*Math.PI)%(2*Math.PI))}}static drawArcLabelFromText(e,t,a,i,s){const r=i.split("\n"),n=14*s,o=16*s,l=4*s;e.save(),e.font=n+"px Arial",e.textAlign="center",e.textBaseline="middle";const c=Math.max(...r.map(t=>e.measureText(t).width)),h=16*r.length,d=t-c/2-4,p=a-h/2-4;e.fillStyle="white",e.strokeStyle="rgb(141, 147, 153)",e.lineWidth=1,e.beginPath(),e.rect(d,p,c+2*l,(h+8)*s),e.fill(),e.stroke(),e.fillStyle="rgb(80, 80, 80)",r.forEach((a,i)=>{const s=p+4+(i+.5)*o;e.fillText(a,t,s)}),e.restore()}static drawArcLabel(e,t,a,i,s,r=""){const n=`R${i.toFixed(3)}${r}\nL${s.toFixed(3)}${r}`.split("\n");e.save(),e.font="14px Arial",e.textAlign="center",e.textBaseline="middle";const o=Math.max(...n.map(t=>e.measureText(t).width)),l=16*n.length,c=t-o/2-4,h=a-l/2-4;e.fillStyle="white",e.strokeStyle="rgb(141, 147, 153)",e.lineWidth=1,e.beginPath(),e.rect(c,h,o+8,l+8),e.fill(),e.stroke(),e.fillStyle="rgb(80, 80, 80)",n.forEach((a,i)=>{const s=h+4+16*(i+.5);e.fillText(a,t,s)}),e.restore()}static calculateCircumCircle=(e,t,a)=>{const i=e.x,s=e.y,r=t.x,n=t.y,o=a.x,l=a.y,c=i*(n-l)-s*(r-o)+r*l-o*n;if(Math.abs(c)<1e-10){const a=Math.hypot(t.x-e.x,t.y-e.y),i=1.2*a,s=t.x-e.x,r=t.y-e.y,n=Math.hypot(s,r),o=-r/n,l=s/n,c=(e.x+t.x)/2,h=(e.y+t.y)/2,d=Math.sqrt(i*i-a/2*(a/2));return{center:{x:c+o*d,y:h+l*d},radius:i}}const h=(i*i+s*s)*(l-n)+(r*r+n*n)*(s-l)+(o*o+l*l)*(n-s),d=(i*i+s*s)*(r-o)+(r*r+n*n)*(o-i)+(o*o+l*l)*(i-r),p=(i*i+s*s)*(o*n-r*l)+(r*r+n*n)*(i*l-o*s)+(o*o+l*l)*(r*s-i*n);return{center:{x:-h/(2*c),y:-d/(2*c)},radius:Math.sqrt((h*h+d*d-4*c*p)/(4*c*c))}};static drawArc=(e,t,a,i,s,r,n)=>{e.save();const o=this.calculateCircumCircle(t,a,i);if(!o)return void e.restore();const{center:l,radius:c}=o,h=Math.atan2(t.y-l.y,t.x-l.x),d=Math.atan2(a.y-l.y,a.x-l.x),p=Math.atan2(i.y-l.y,i.x-l.x),u=e=>e<0?e+2*Math.PI:e,g=u(h),f=u(d),m=u(p),y=(f-g+2*Math.PI)%(2*Math.PI),v=(m-g+2*Math.PI)%(2*Math.PI),x=(f-m+2*Math.PI)%(2*Math.PI);let b=!1;y<Math.PI?(v>y||x>y)&&(b=!0):b=!(v<y&&x<y),e.beginPath(),e.strokeStyle=s,e.lineWidth=n,e.arc(l.x,l.y,c,g,f,b),e.stroke(),e.beginPath(),e.fillStyle=s,e.arc(l.x,l.y,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t.x,t.y,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(a.x,a.y,3,0,2*Math.PI),e.fill();const w=(t.x+a.x)/2,k=(t.y+a.y)/2;return e.restore(),{labelposx:w,labelposy:k}};static drawMultilineLabel=(e,t,a,i)=>{const s=t.split("\n");e.save(),e.font="14px Arial",e.textAlign="center",e.textBaseline="alphabetic";const r=s.map(t=>e.measureText(t).width),n=Math.max(...r),o=16*s.length,l=a-n/2-3,c=i-o/2-3;e.fillStyle="white",e.strokeStyle="rgb(141, 147, 153)",e.lineWidth=1,e.beginPath(),e.rect(l,c,n+6,o+6),e.fill(),e.stroke(),e.fillStyle="rgb(141, 147, 153)",s.forEach((t,i)=>{const s=c+3+16*(i+1)-4;e.fillText(t,a,s)}),e.restore()};static drawLabelWithBox=(e,t,a,i)=>{e.font="16px Arial",e.textAlign="center",e.textBaseline="middle";const s=e.measureText(t).width;e.fillStyle="white",e.strokeStyle="rgb(141, 147, 153)",e.lineWidth=1,e.beginPath(),e.rect(a-s/2-4,i-8-4,s+8,24),e.fill(),e.stroke(),e.fillStyle="rgb(141, 147, 153)",e.fillText(t,a,i)};static drawHollowCircle=(e,t,a,i)=>{e.save(),e.beginPath(),e.strokeStyle=i,e.lineWidth=2,e.arc(t.x,t.y,a,0,2*Math.PI),e.stroke(),e.beginPath(),e.fillStyle=i,e.arc(t.x,t.y,3,0,2*Math.PI),e.fill(),e.restore()}}class ll{constructor(e){var t=this;this.markupnumber=e,this.bMultiOp=!1,this.multiOpId=null,this.type=0,this.subtype=0,this.alternative=0,this.consolidated=!1,this.bRedact=!1,this.bdelete=!1,this.bmodify=!1,this.islastbmodify=!1,this.isfirstbmodify=!1,this.bcurstate=!1,this.bcreate=!1,this.bredoonly=!1,this.bhasArrow=!1,this.markupArrowConnected=null,this.bisTextArrow=!1,this.textBoxConnected=null,this.savetolist=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.rotatedrect=new Yn(0,0,0,0),this.timestamp=0,this.layer=0,this.pagenumber=0,this.layout="Default",this.signature="",this.color="",this.transparency=100,this.fillcolor="rgba(255,0,0,1.0)",this.strokecolor="rgba(255,0,0,1.0)",this.textcolor="rgba(255,0,0,1.0)",this.markercolor="rgba(255,0,0,1.0)",this.scaling=0,this.xoffset=0,this.yoffset=0,this.leaderoffset=0,this.scalingext=0,this.xoffsetext=0,this.yoffsetext=0,this.rotation=0,this.textrotate=0,this.dimtext="",this.dimtextx="",this.dimtexty="",this.linewidth=0,this.textheight=0,this.measuretextheight=0,this.textwidth=0,this.text="",this.font=new Rn("Helvetica",24,!1,!1),this.points=[],this.pointlist=[],this.countshapes=[],this.comments=[],this.customattributes=[],this.holes=[],this.holepointlist=[],this.innerRadius=1,this.outerRadius=1,this.startX=null,this.startY=null,this.secondX=null,this.secondY=null,this.endX=null,this.endY=null,this.image=void 0,this.restoreDeleted=function(){return new cl(t.type,t.subtype,t.alternative)},this.saverestoredtolist=function(e,a){e&&(e.savemetolistLoad(a),e.display=!0,e.markupnumber=t.markupnumber,e.drawmescaled(n),null!=$t&&$t.setMarkupSelected(e,{created:!0,modified:!1,deleted:!1}))},this.PerformUndoCommon=function(e,a){e.type=t.type,e.subtype=t.subtype,e.alternative=t.alternative,e.bRedact=t.bRedact,e.consolidated=t.consolidated,e.pagenumber=t.pagenumber,e.display=!0,e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e.xscaled=t.xscaled,e.yscaled=t.yscaled,e.wscaled=t.wscaled,e.hscaled=t.hscaled,e.timestamp=t.timestamp,e.layer=t.layer,e.signature=t.signature,e.color=t.color,e.fillcolor=t.fillcolor,e.strokecolor=t.strokecolor,e.textcolor=t.textcolor,e.scaling=t.scaling,e.xoffset=t.xoffset,e.yoffset=t.yoffset,e.docdx=t.docdx,e.docdy=t.docdy,e.docdscale=t.docdscale,e.scalingext=t.scalingext,e.xoffsetext=t.xoffsetext,e.yoffsetext=t.yoffsetext,e.rotation=t.rotation,e.textrotate=t.textrotate,e.dimtext=t.dimtext,e.leaderoffset=t.leaderoffset,e.linewidth=t.linewidth,e.textheight=t.textheight,e.measuretextheight=t.measuretextheight,e.textwidth=t.textwidth,e.text=t.text,e.parent=t.parent,e.font=t.font,e.editcurpoint=0,e.points=t.points.slice(),e.countshapes=t.countshapes.slice(),e.innerRadius=t.innerRadius,e.outerRadius=t.outerRadius,e.startX=t.startX,e.startY=t.startY,e.secondX=t.secondX,e.secondY=t.secondY,e.endX=t.endX,e.endY=t.endY,e.numpoints=t.points.length-1;for(var i=0;i<t.pointlist.length;i++)e.pointlist[i]=t.pointlist[i].slice();e.comments=t.comments.slice(),e.customattributes=t.customattributes.slice(),e.holes=t.holes.slice(),e.bhasArrow&&null!=e.markupArrowConnected&&e.markupArrowConnected.setTextboxConnectionPoint(e.x,e.y,e.w,e.h),e.findrectangle(),t.savetolist&&(t.saverestoredtolist(e,a),e.addsides(),t.savetolist=!1)},this.PerformRedo=function(e,a){t.bcreate,t.bdelete&&(t.bdelete=!1,t.bcreate=!0),t.PerformUndo(e,a)},this.PerformUndo=function(e,a){if(6!=t.type||6!=t.subtype){if(t.bcreate)return t.bhasArrow&&t.markupArrowConnected&&Sl(t.markupArrowConnected.markupnumber),e&&(11!=e.type&&20!=e.type||e.image&&(t.image=e.image)),Sl(t.markupnumber),t.bdelete=!0,void(t.bcreate=!1);t.bdelete&&(e=t.restoreDeleted(),t.bhasArrow&&t.markupArrowConnected&&(e.markupArrowConnected=t.markupArrowConnected.restoreDeleted(),e.bhasArrow=!0,e.markupArrowConnected.textBoxConnected=e,e.markupArrowConnected.bisTextArrow=!0,t.markupArrowConnected.savetolist=!0),8==e.type&&2==e.subtype&&t.parent.holes.push(e),11!=e.type&&20!=e.type||(e.image=t.image,e.imageloaded=!0),t.savetolist=!0,t.bdelete=!1,t.bcreate=!0,e.setfirstDraw()),e&&(t.PerformUndoCommon(e,a),t.bhasArrow&&t.markupArrowConnected&&null!=e.markupArrowConnected&&t.markupArrowConnected.PerformUndoCommon(e.markupArrowConnected,a))}},this.checkduplicate=function(e){var t=0,a=0,i=!0;if((i=this.type==e.type&&i)&&(i=this.subtype==e.subtype&&i),i&&(i=this.alternative==e.alternative&&i),i&&(i=this.bRedact==e.bRedact&&i),i&&(i=this.consolidated==e.consolidated&&i),i&&(i=this.display==e.display&&i),i&&(i=this.x==e.x&&i),i&&(i=this.y==e.y&&i),i&&(i=this.w==e.w&&i),i&&(i=this.h==e.h&&i),i&&(i=this.xscaled==e.xscaled&&i),i&&(i=this.yscaled==e.yscaled&&i),i&&(i=this.wscaled==e.wscaled&&i),i&&(i=this.hscaled==e.hscaled&&i),i&&(i=this.rotatedrect==e.rotatedrect&&i),i&&(i=this.timestamp==e.timestamp&&i),i&&(i=this.layer==e.layer&&i),i&&(i=this.pagenumber==e.pagenumber&&i),i&&(i=this.layout==e.layout&&i),i&&(i=this.signature==e.signature&&i),i&&(i=this.color==e.color&&i),i&&(i=this.transparency==e.transparency&&i),i&&(i=this.fillcolor==e.fillcolor&&i),i&&(i=this.strokecolor==e.strokecolor&&i),i&&(i=this.textcolor==e.textcolor&&i),i&&(i=this.markercolor==e.markercolor&&i),i&&(i=this.scaling==e.scaling&&i),i&&(i=this.xoffset==e.xoffset&&i),i&&(i=this.yoffset==e.yoffset&&i),i&&(i=this.scalingext==e.scalingext&&i),i&&(i=this.xoffsetext==e.xoffsetext&&i),i&&(i=this.yoffsetext==e.yoffsetext&&i),i&&(i=this.rotation==e.rotation&&i),i&&(i=this.textrotate==e.textrotate&&i),i&&(i=this.dimtext==e.dimtext&&i),i&&(i=this.linewidth==e.linewidth&&i),i&&(i=this.textheight==e.textheight&&i),i&&(i=this.measuretextheight==e.measuretextheight&&i),i&&(i=this.textwidth==e.textwidth&&i),i&&(i=this.text==e.text&&i),i&&(i=this.font==e.font&&i),i&&(i=this.innerRadius==e.innerRadius&&i),i&&(i=this.outerRadius==e.outerRadius&&i),i)for(a=0;a<this.countshapes.length;a++)i=e.countshapes[a].x==this.countshapes[a].x&&i,i=e.countshapes[a].y==this.countshapes[a].y&&i;if(i)for(t=0;t<this.points.length;t++)i=e.points[t].x==this.points[t].x&&i,i=e.points[t].y==this.points[t].y&&i;return i},this.setmultiValues=function(e){this.bMultiOp=!0,this.multiOpId=e},this.SetUndoValues=function(e){var t=0,a=0,i=0,s=0,r=0;for(this.image=e.image,this.parent=e.parent,this.type=e.type,this.subtype=e.subtype,this.alternative=e.alternative,this.bRedact=e.bRedact,this.consolidated=e.consolidated,this.display=e.display,this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this.xscaled=e.xscaled,this.yscaled=e.yscaled,this.wscaled=e.wscaled,this.hscaled=e.hscaled,this.rotatedrect=e.rotatedrect,this.timestamp=e.timestamp,this.layer=e.layer,this.pagenumber=e.pagenumber,this.viewname=e.viewname,this.bfor3D=e.bfor3D,this.layout=e.layout,this.signature=e.signature,this.color=e.color,this.transparency=e.transparency,this.fillcolor=e.fillcolor,this.strokecolor=e.strokecolor,this.textcolor=e.textcolor,this.markercolor=e.markercolor,this.scaling=e.scaling,this.xoffset=e.xoffset,this.yoffset=e.yoffset,this.leaderoffset=e.leaderoffset,this.scalingext=e.scalingext,this.xoffsetext=e.xoffsetext,this.yoffsetext=e.yoffsetext,this.rotation=e.rotation,this.textrotate=e.textrotate,this.dimtext=e.dimtext,this.linewidth=e.linewidth,this.textheight=e.textheight,this.measuretextheight=e.measuretextheight,this.textwidth=e.textwidth,this.text=e.text,this.font=e.font,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.startX=e.startX,this.startY=e.startY,this.secondX=e.secondX,this.secondY=e.secondY,this.endX=e.endX,this.endY=e.endY,a=0;a<e.countshapes.length;a++)this.countshapes[a]=new pn(e.countshapes[a].x,e.countshapes[a].y);if(e.bhasArrow&&null!=e.markupArrowConnected){this.bhasArrow=!0;var n=new ll(e.markupArrowConnected.markupnumber);n.SetUndoValues(e.markupArrowConnected),this.markupArrowConnected=n}for(t=0;t<e.points.length;t++)this.points[t]=new pn(e.points[t].x,e.points[t].y);for(var o=0;o<e.pointlist.length;o++){this.pointlist[o]=[];for(var l=0;l<e.pointlist[o].length;l++)this.pointlist[o][l]=new pn(e.pointlist[o][l].x,e.pointlist[o][l].y)}for(this.holes=[],r=0;r<e.holes.length;r++)this.holes.push(e.holes[r]);for(this.comments=[],i=0;i<e.comments.length;i++)this.comments.push(e.comments[i]);for(this.customattributes=[],s=0;s<e.customattributes.length;s++)this.customattributes.push(e.customattributes[i])}}}class cl{constructor(e,i,s){var r=this;this.markupnumber=0,this.type=e,this.subtype=i,this.alternative=s,this.bRedact=!1,this.aspectLock=!0,s>=3?this.hatchStyle=s-3:this.hatchprt=0,this.saved=!1,this.firstpointrotAdjusted=!1,this.markupID=0,this.uniqueID=0,this.locked=!1,this.pdfannot=!1,this.pdfannotref=void 0,this.pdfannotproxy=!1,this.pdfannotproxyType="rectangle",this.timestamp=(new Date).getTime(),this.layer=Rr,this.signature=Fr,this.color=Pr,this.transparency=Er,this.labeltransparency=100,this.showlabel=!0,this.consolidated=!1,this.linkURL="",this.actionName="",this.imagehref="",this.bhaveLink=!1,this.noDraw=!1,this.addedfoxit=!1,this.bCanHaveLink=1==r.type&&2==r.subtype||3==r.type||4==r.type||5==r.type||9==r.type||11==r.type||20==r.type,this.anglelengthsupport=6==r.type,this.widthHeightsupport=3==r.type,this.setRadiusSupport=4==r.type&&1==r.subtype,this.setPointSupport=1==r.type||8==r.type;var o=1==r.type&&r.subtype;this.editcurpoint=0,this.bpointEdit=!1,this.fillcolor=Vn(Sr,this.transparency),this.selectSpaceColor="rgba(191,58,209,0.6)",this.selectSpaceStopColor="rgba(255,255,255,0.3)",this.strokecolor=Vn(Mr,100),this.strokecolorSegment=Vn("#FFFF00",30),this.textcolor=Vn(Tr,100),this.markercolor=Vn(Sr,30),this.labelfillcolor="rgba(255,255,255,1)",this.orthoDrawAngle=0,this.orthoDrawAngledeg=0,this.pagenumber=0,this.viewname=null,this.bfor3D=!1,this.takeOffObject=void 0,this.bUseFixedScale=Mi,this.pagerotation=0,this.documentName=hn.OriginalURL,this.layout="Default",this.display=!0,this.relativeWH=!1,this.drawn=!1,this.imageloaded=!1,this.arrowTextPos=0,this.padding=void 0,this.labeltype=1,this.bmodyfied=!1,this.svgContent=void 0,this.x=0,this.y=0,this.w=0,this.h=0,this.origx=0,this.origy=0,this.origw=0,this.origh=0,this.origset=!1,this.radius=0,this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.startX=null,this.startY=null,this.secondX=null,this.secondY=null,this.endX=null,this.endY=null,this.startXscaled=null,this.startYscaled=null,this.secondXscaled=null,this.secondYscaled=null,this.endXscaled=null,this.endYscaled=null,this.setsecond=!1,this.setthird=!1,this.radiusScaled=0,this.leaderoffset=0,this.labelpos={x:this.x,y:this.y,w:this.w,h:this.h},this.labeloffsetx=0,this.labeloffsety=0,this.labelRect={x:0,y:0,w:0,h:0},this.transformobj={a:1,b:0,c:0,d:1,e:0,f:0},this.rotatedrect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerRightRect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerLeftRect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperLeftRect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperRightRect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.RotmarkerRect=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerRightRectRot=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerLeftRectRot=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperLeftRectRot=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperRightRectRot=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.RotmarkerRectRot=new Yn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.fixedscaleFactor=1,this.printscale=1,this.pageheight=0,this.pagewidth=0,this.scaling=1,this.loadscaling=1,this.xoffset=0,this.yoffset=0,this.scalingext=0,this.xoffsetext=0,this.yoffsetext=0,this.rotation=0,this.textrotate=0,this.bUsemouseinput=!0,this.docdx=hn.getCurrentpage().getdx(),this.docdy=hn.getCurrentpage().getdy(),this.docdscale=hn.getCurrentpage().getdscale(),this.dimtext="",this.dimtextx="",this.dimtexty="",this.dimradius="",this.dimlength="",this.dimarea=0,this.dimlength=0,this.hidevaluelabel=!1,this.parentmarkupnumber=0,this.parent=void 0,this.holes=[],this.dimtextangle="",this.customlabeltext="",this.linewidth=jr,this.linewidthSegment=Ar,this.linestyle=Vr,this.selected=!1,this.marked=!1,this.unselected=!1,this.spaceselected=!1,this.lastselected=!1,this.selectedit=!1,this.setmarkededit=!1,this.firstpointset=!1,this.lastpointset=!1,this.hasScale=!1,this.editaction=0,this.scalecorner=0,this.linesegment={p1:-1,p2:-1},this.multilinesegment={p1:[],p2:[]},this.selectedpoint=-1,this.selectedmultipoint=[],this.bispartofGroup=!1,this.groupRect={x:0,y:0,w:0,h:0},this.textheight=24,this.textwidth=0,this.textdim={width:0,height:0},this.stampsmalltwidth=0,this.stampsmalltheight=0,this.measuretextheight=ir,this.bhasArrow=!1,this.bisTextArrow=!1,this.markupArrowConnected=null,this.textBoxConnected=null,this.busecustomlabel=!1,this.carpos=0,this.text="",this.intialtextset=!1,this.smalltext="",this.cursorblink=!0,this.fontname="Helvetica",o=1==e&&3==i;var l=1==e&&(4==i||5==i),c=3==e&&6==i,h=8==e,d=7==e,p=1==e&&6==i,u=4==e&&1==i,g=13==e,f=14==e;this.ismeasure=o||l||h||c||d||p||u||g||f,this.font=new Rn("Helvetica",7==e||8==e||o||l||c?ir:24,!1,!1),this.renderUtils=14==e?new ol:null,this.arrowlength=er+this.linewidth,this.pointlist=[],this.points=[],this.sides=[],this.countshapes=[],this.innerRadius=1,this.outerRadius=1,this.numpoints=-1,this.customattributes=[],this.comments=[],this.delayedloadobj={DocRef:null,xmlDoc:null,fileVersion:null,pageobject:null},this.status="none",this.bMultiOp=!1,this.multiOpId=null;var m=!1,y=!1,v=!1,x=!1,b=!1,w=!1,D=20,R={w:0,h:0},P=22.5,S=(this.linewidth,Math.PI,.5522848);function M(){var e=t.getBoundingClientRect(),a=r.rotatedrect.x+e.left,i=r.rotatedrect.y+e.top,s=r.wscaled,n=r.hscaled,o=ti/2,l=ai/2,c=a+.5*s,h=i+.5*n,d=hn.getCurrentpage().getpageRotation()*(Math.PI/180);if(0!=hn.getCurrentpage().getpageRotation()){var p=r.getRotatedMarkup(o,l,c,h,d);c=p.x,h=p.y}c+=e.left,h+=e.top;var u=new Yn(a,i,s,n);return u.rotation=hn.getCurrentpage().getpageRotation(),u.rotation=r.pagerotation,u}this.scaleObject=new Tc,this.toggleAspectLock=function(){return this.aspectLock=!this.aspectLock,this.aspectLock},this.PerformUndo=function(e){this.type=e.type,this.subtype=e.subtype,this.alternative=e.alternative,this.bRedact=e.bRedact,this.consolidated=e.consolidated,this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this.xscaled=e.xscaled,this.yscaled=e.yscaled,this.wscaled=e.wscaled,this.hscaled=e.hscaled,this.timestamp=e.timestamp,this.layer=e.layer,this.signature=e.signature,this.color=e.color,this.fillcolor=e.fillcolor,this.strokecolor=e.strokecolor,this.textcolor=e.textcolor,this.scaling=e.scaling,this.xoffset=e.xoffset,this.yoffset=e.yoffset,this.docdx=e.docdx,this.docdy=e.docdy,this.docdscale=e.docdscale,this.scalingext=e.scalingext,this.xoffsetext=e.xoffsetext,this.yoffsetext=e.yoffsetext,this.rotation=e.rotation,this.textrotate=e.textrotate,this.dimtext=e.dimtext,this.linewidth=e.linewidth,this.textheight=e.textheight,this.measuretextheight=e.measuretextheight,this.textwidth=e.textwidth,this.text=e.text,this.font=e.font,this.editcurpoint=0,this.points=e.points.slice(),this.countshapes=e.countshapes.slice(),this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.numpoints=e.points.length-1;for(var t=0;t<e.pointlist.length;t++)this.pointlist[t]=e.pointlist[t].slice();e.bdelete&&(this.addsides(),Sl(e.markupnumber))},this.setmultiValues=function(e){this.bMultiOp=!0,this.multiOpId=e},this.resetmultiValues=function(){this.bMultiOp=!1,this.multiOpId=null},this.resetmarkupmodified=function(){r.bmodyfied=!1},this.getJSONUniqueID=function(e){if(!r.pdfannotproxy)return new Promise((function(t,a){Ze.connect((function(e,i,s){if(s){var n=eh(r,hn,hn.getPageObject(r.pagenumber),!1,i);t(n)}else a(e)})),function(e,t){if(e.created||0==t.uniqueID){var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetGUID</Command>",a+="<LicenseID>"+os+"</LicenseID>",Fh("POST",C,"",a+="</RxViewServer>").then((function(a){var i=a;t.setUniqueID(i),null!=Ze&&Ze.guidcomplete(i,e,!0)})).catch((function(t){t.status?console.log(t.status):console.log(t),null!=Ze&&Ze.guidcomplete(t,e,!1)}))}else null!=Ze&&Ze.guidcomplete(t.uniqueID,e,!0)}(e,r)}))},this.getJSON=function(e){var t=eh(r,hn,hn.getPageObject(r.pagenumber),!1,e);return r.pdfannotproxy&&(t=void 0),t},this.setmarkupmodified=function(e){r.bmodyfied||tl(r),r.bmodyfied=e},this.getmarkupmodified=function(){return r.bmodyfied},this.multipoint=function(){return 8==r.type||1==r.type||13==r.type||14==r.type},this.isSelected=function(e){var t=!1,a=r.selectedit&&9!=r.type,i=r.selected||a;return!(9==r.type&&r.bhasArrow)&&i&&r.pagenumber==e&&(t=!0),t},this.getselected=function(){return r.multipoint()?r.selectedit:r.selected},this.getmarked=function(){return r.marked},this.setselectedit=function(e){r.signature==Fr?r.selectedit=e:(r.setmarkededit=e,r.setmarked(e))},this.setTextBoxArrowSelect=function(e){r.selected=e},this.setmarked=function(e){r.marked=e},this.onselect=function(e,t){var a=!0;if(r.bhaveLink&&(hn.bMarkupLocked||r.locked)){var i={found:!1,blink:!0,id:r.markupnumber,locked:r.locked,index:e};return i}if(r.selectedit){if(r.setselect(!1),r.bUsemouseinput=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},4==r.editaction||8==r.editaction)return i}else{if(2==r.editaction||3==r.editaction)return a&&(r.setselect(!0),i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},a=!1,r.bUsemouseinput=!0),i;switch(fs||r.getselected()||(Dl(),a=!0),r.type){case 1:a&&(r.setselectedit(!0),r.setselect(!1),r.bUsemouseinput=!0,r.lastselected=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},r.lengthangleCallbackSelect(),a=!1);break;case 8:(t||1!=r.subtype)&&a&&(r.setselectedit(!0),r.setselect(!1),r.bUsemouseinput=!0,r.lastselected=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},r.lengthangleCallbackSelect(),a=!1);break;case 13:a&&(r.setselectedit(!0),r.setselect(!1),r.bUsemouseinput=!0,r.lastselected=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},a=!1);break;case 14:a&&(r.setselectedit(!0),r.setselect(!1),r.lastselected=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},a=!1);break;default:a&&(r.setselect(!0),r.lastselected=!0,i={found:!0,blink:!1,id:r.markupnumber,locked:!1,index:e},r.lengthangleCallbackSelect(),a=!1)}}return i},this.unselect=function(){r.selected&&(r.setselect(!1),r.bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(r)),r.selectedit&&(r.selectedit=!1,r.bpointEdit=!1,r.bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(r))},this.selectSet=function(){r.multipoint()?r.setselectedit(!0):r.setselect(!0),null!=$t&&(9==r.type&&r.subtype,$t.setMarkupSelected(r,{created:!1,modified:!1,deleted:!1}))},this.setselect=function(e){if(r.signature==Fr){if(r.selected=e,r.bhasArrow&&null!=r.markupArrowConnected)return void r.markupArrowConnected.setselect(e);r.bisTextArrow&&null!=r.textBoxConnected&&r.textBoxConnected.setTextBoxArrowSelect(e)}else if(r.setmarkededit&&!e)r.setmarked(r.setmarkededit),r.setmarkededit=!1;else{if(r.setmarked(e),r.bhasArrow&&null!=r.markupArrowConnected)return void r.markupArrowConnected.setmarked(e);r.bisTextArrow&&null!=r.textBoxConnected&&r.textBoxConnected.setmarked(e)}},this.getTextSize=function(){var e={numlines:0,textheight:0,rect:null};if(9==r.type){if(r.bUseFixedScale){var t=r.fixedscaleFactor;t*=dr}else t=scalefactor;var a=this.font.height*t,i=this.font.height/4*2*t;e.textheight=a+i,e.numlines=r.text.split("\n").length,e.rect=M()}return e},this.editTextmarkupRect=function(){if(null!=qt){qt.operation.start=!1,qt.operation.create=!1,qt.operation.edit=!0,qt.operation.save=!1,qt.operation.markup=r;var e=t.getBoundingClientRect(),a=r.rotatedrect.x+e.left,i=r.rotatedrect.y+e.top,s=r.wscaled,n=r.hscaled,o=ti/2,l=ai/2,c=a+.5*s,h=i+.5*n,d=hn.getCurrentpage().getpageRotation()*(Math.PI/180);if(0!=hn.getCurrentpage().getpageRotation()){var p=r.getRotatedMarkup(o,l,c,h,d);c=p.x,h=p.y}c+=e.left,h+=e.top;var u=new Yn(a,i,s,n);u.rotation=hn.getCurrentpage().getpageRotation(),u.rotation=r.pagerotation;var g=Hl();u.x=(u.x-e.left)/g+e.left,u.y=(u.y-e.top)/g+e.top,u.w=u.w/g,u.h=u.h/g,qt.setTextInput(u),hn.selectedmarkup.edit=!1}},this.ChangeMarkup=function(e){switch(e){case 0:r.savemarkupstate(hn,1),r.layer=Rr;break;case 1:r.savemarkupstate(hn,1),r.strokecolor=Vn(Mr,100);break;case 2:if(r.linewidth=jr,6==r.type||7==r.type){var t=er;t+=jr,r.arrowlength=t}r.setmarkupmodified(!0);break;case 3:r.savemarkupstate(hn,1),r.alternative=Lr,r.alternative>=3&&(r.hatchStyle=r.alternative-3);break;case 4:r.savemarkupstate(hn,1),r.font.setFontname(Pn.fontName),r.font.setHeight(Pn.height),r.font.setBold(Pn.bold),r.font.setItalic(Pn.italic);break;case 5:break;case 6:jn(r.fillcolor)&&(r.fillcolor=Vn(r.fillcolor,100)),jn(r.strokecolor)&&(r.strokecolor=Vn(r.strokecolor,100)),r.fillcolor=An(r.fillcolor,Er),r.strokecolor=An(r.strokecolor,100),r.transparency=Er,r.setmarkupmodified(!0);break;case 7:r.savemarkupstate(hn,1),r.fillcolor=Vn(Sr,r.transparency);break;case 8:r.savemarkupstate(hn,1),r.textcolor=Vn(Tr,100);break;case 9:r.savemarkupstate(hn,1),r.linestyle=Vr;break;case 10:r.savemarkupstate(hn,1),(6==r.type||7==r.type)&&(t=er,t+=r.linewidth,r.arrowlength=t);break;case 11:r.savemarkupstate(hn,1);var a=1==r.type&&3==r.subtype,i=1==r.type&&(4==r.subtype||5==r.subtype);(8==r.type||7==r.type||a||i)&&r.font.setHeight(ir);break;case 12:r.labelfillcolor=An(r.labelfillcolor,Er),r.labeltransparency=Er,r.setmarkupmodified(!0);break;case 13:r.savemarkupstate(hn,1),13==r.type&&r.setCountSize(sr);break;case 14:r.savemarkupstate(hn,1),r.setdisplay(!1);break;case 15:r.savemarkupstate(hn,1),r.setdisplay(!0);break;case 16:r.savemarkupstate(hn,1),r.showperimeter(!0);break;case 17:r.savemarkupstate(hn,1),r.showperimeter(!1);break;case 18:r.savemarkupstate(hn,1),1==r.type&&4==r.subtype?r.subtype=5:1==r.type&&5==r.subtype&&(r.subtype=4);break;case 19:r.linewidthSegment=Ar,r.setmarkupmodified(!0)}if(null!=Qt){var s=r.editaction;Qt.setMarkupSelected(r,s)}},this.settxtboxArrow=function(e){if(9==r.type||1==r.subtype){r.bhasArrow=!0,r.markupArrowConnected=e,e.bisTextArrow=!0;var t=lo(),a=no();if(r.fixedscaleFactor=t/a,r.bUseFixedScale){var i=r.fixedscaleFactor;i*=dr}else i=t;r.font.setScale(i),e.textBoxConnected=r}},this.setLink=function(e,t){r.linkURL=e,r.bhaveLink=t},this.setAction=function(e,t){r.actionName=e,r.bhaveLink=t},this.getLink=function(){return{bCanHaveLink:r.bCanHaveLink,link:r.linkURL,bhavelink:r.bhaveLink}},this.getUniqueID=function(){return r.uniqueID},this.setdelete=function(){w=!0},this.getdelete=function(){return w},this.setUniqueID=function(e){0==r.uniqueID&&function(e){for(var t=!0,a=0;a<yn.length;a++)for(var i=0;i<yn[a].markuplist.length;i++)null!=yn[a].markuplist[i]&&yn[a].markuplist[i].getUniqueID()==e&&(t=!1);return t}(e)&&(r.uniqueID=e)},this.setRxUniqueID=function(){Jc(r)},this.onRotate=function(){},this.SetFromStorage=function(){},this.calculateDrawAngle=function(e){var t=Math.atan2(e.h-e.y,e.w-e.x);t<0&&(t+=2*Math.PI),r.orthoDrawAngle=t,r.orthoDrawAngledeg=r.orthoDrawAngle*(180/Math.PI)},this.calculateLength=function(e){var t=Math.max(e[0].x,e[1].x)-Math.min(e[0].x,e[1].x),a=Math.max(e[0].y,e[1].y)-Math.min(e[0].y,e[1].y);return r.getdiag(t,a)},this.calculateOrthoPoints=function(e){return Math.atan2(-(e[1].y-e[0].y),e[1].x-e[0].x)},this.getClosestDegree=function(e,t){var a=0,i=!0,s=0,r=Math.abs(t-s);for(a=s;i;){s+=e;var n=Math.abs(t-s);n<r&&(r=n,a=s,360==s&&(a=0)),360==s&&(i=!1)}return a},this.calculateOrthoDraw=function(e,t){var a=r.calculateLength([{x:e.x,y:e.y},{x:t.x,y:t.y}]),i=r.calculateOrthoPoints([{x:e.x,y:e.y},{x:t.x,y:t.y}]);i<0&&(i+=2*Math.PI);var s=i*(180/Math.PI),n=r.getClosestDegree(Bs,s);return r.setAnglelengthUnscaled(e,a,n,void 0)},this.calculateOrtho=function(e,t,a){var i=r.calculateLength([{x:this.x,y:this.y},{x:a.x,y:a.y}]),s=r.calculateOrthoPoints([{x:this.x,y:this.y},{x:this.w,y:this.h}]);hn.getCurrentpage().getpageRotation(),Math.PI,s<0&&(s+=2*Math.PI);var n=s*(180/Math.PI),o=r.getClosestDegree(Bs,n);a=r.setAnglelengthUnscaled({x:this.x,y:this.y},i,o,void 0),e&&1==t?(this.x=a.w,this.y=a.h):(this.w=a.w,this.h=a.h)},this.ClearAttributes=function(){this.customattributes=[]},this.ClearComments=function(){this.comments=[]},this.ConsolidateList=function(e,t){nn.add(r,e,t)},this.Consolidate=function(e){nl(r),hn.bMarkupchanged=!0,r.bhasArrow&&null!=r.markupArrowConnected&&r.markupArrowConnected.Consolidate(e),r.consolidated=!0,r.setdisplay($n(Fr)),r.signature=Fr,e.changeStrokeColor&&(r.strokecolor=e.strokecolor),e.changeTexColort&&(r.textcolor=e.textcolor),e.changeLayer&&(r.layer=e.layer),Vl(n),Nl(a),null!=ya&&ya.Consolidatevt(r),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive)},this.AddAttribute=function(e,t){var a={name:e,value:t};r.customattributes.push(a)},this.CreateComment=function(e){9==r.type||10==r.type||(r.text=e)},this.AddCommentInternal=function(e,t,a,i){var s={id:e,signature:t,value:a,timestamp:"timestamp"};s.timestamp=null!=i?i:r.timestamp,r.comments.push(s)},this.AddComment=function(e,t,a,i){var s={id:e,signature:t,value:a,timestamp:"timestamp"};if(s.timestamp=null!=i?i:r.timestamp,r.comments.push(s),r.comments.length>0&&r.savemarkupstate(hn,1),null!=Qt){var n=r.editaction;Qt.setMarkupSelected(r,n)}},this.GetComments=function(){return r.comments},this.GetAttribute=function(e){for(var t=void 0,a=0;a<r.customattributes.length;a++)r.customattributes[a].name==e&&(t=r.customattributes[a]);return t},this.GetAttributes=function(){return r.customattributes},this.deleteAttribute=function(e){for(var t=-1,a=0;a<r.customattributes.length;a++)r.customattributes[a].name==e&&(t=a);-1!=t&&r.customattributes.splice(t,1)},this.deleteComment=function(e){for(var t=-1,a=0;a<r.comments.length;a++)r.comments[a].id==e&&(t=a);if(-1!=t&&r.comments.splice(t,1),null!=Qt){var i=r.editaction;Qt.setMarkupSelected(r,i)}},this.findAttribute=function(e,t){for(var a=!1,i=0;i<r.customattributes.length;i++)r.customattributes[i].name==e&&r.customattributes[i].value==t&&(a=!0);return a},this.updateAttribute=function(e,t){for(var a=0;a<r.customattributes.length;a++)r.customattributes[a].name==e&&(r.customattributes[a].name=e,r.customattributes[a].value=t)},this.editComment=function(e,t,a){for(var i=0;i<r.comments.length;i++)r.comments[i].id==e&&(r.comments[i].value=t,null!=r.comments[i].timestamp&&null!=a&&(r.comments[i].timestamp=a));if(null!=Qt){var s=r.editaction;Qt.setMarkupSelected(r,s)}},this.restorestampfontSize=function(){r.font.setHeight(.16*r.w),0==r.alternative?(r.stampsmalltheight=.08*r.w-4,r.stampsmalltheight<1&&(r.stampsmalltheight=1),r.textheight+r.stampsmalltheight+r.h/10*2>r.h&&(r.font.setHeight(r.h/2-r.h/10*2),r.stampsmalltheight=r.textheight/2-4,r.stampsmalltheight<1&&(r.stampsmalltheight=1))):.6*r.w>=r.h?r.font.setHeight(r.h/4):r.font.setHeight(.16*r.w)},this.updatePageMarkup=function(e){null!=r.delayedloadobj.DocRef&&null!=r.delayedloadobj.xmlDoc&&null!=r.delayedloadobj.fileVersion&&(r.delayedloadobj.pageobject=e,r.SetfromXML(r.delayedloadobj.DocRef,r.delayedloadobj.xmlDoc,r.delayedloadobj.fileVersion))},this.setfromJSON=function(e,t){b=!1;var a=JSON.parse(t);if(null!=a.Entity&&null!=a.Entity){null!=a.Entity.View?this.pagenumber=a.Entity.View:this.pagenumber=0,null!=a.Entity.ViewName3D?(this.viewname=a.Entity.ViewName3D,null!=a.Entity.For3DView&&(this.bfor3D=1==a.Entity.For3DView),null!=a.Entity.PageHeight3D&&(this.pageheight=PageHeight3D),null!=a.Entity.PageWidth3D&&(this.pagewidth=PageWidth3D)):(this.viewname=null,this.bfor3D=!1),y=!0,v=!0;var i=e.getPageObject(this.pagenumber);if(null!=a.Entity.Rect&&(this.x=a.Entity.Rect.x,this.y=a.Entity.Rect.y,this.w=a.Entity.Rect.w,this.h=a.Entity.Rect.h),isNaN(this.x)&&(this.x=10),isNaN(this.y)&&(this.y=10),isNaN(this.w)&&(this.w=100),isNaN(this.h)&&(this.h=100),null!=a.Entity.FixedScale&&(this.bUseFixedScale=1==a.Entity.FixedScale,m=1==a.Entity.FixedScale),null!=a.Entity.FixedScaleFactor&&(this.fixedscaleFactor=a.Entity.FixedScaleFactor),null!=a.Entity.Redaction?this.bRedact=1==a.Entity.Redaction:this.bRedact=!1,0==this.h&&0==this.w&&8!=this.type&&1!=this.type&&2!=this.type&&0!=this.type&&14!=this.type)return!1;if(8==this.type||1==this.type||this.type,this.bCanHaveLink=1==this.type&&2==this.subtype||3==this.type||4==this.type||5==this.type||9==this.type||11==this.type||20==this.type,null!=a.Entity.HaveLink&&(this.bhaveLink=1==a.Entity.HaveLink),null!=a.Entity.LinkURL&&(this.linkURL=a.Entity.LinkURL),null!=a.Entity.Layer?this.layer=a.Entity.Layer:this.layer=Rr,null!=a.Entity.TimeStamp&&(this.timestamp=a.Entity.TimeStamp),null!=a.Entity.Rotation&&(this.rotation=a.Entity.Rotation),null!=a.Entity.Extended)for(var s=0;s<a.Entity.Extended.length;s++);if(null!=a.Entity.Comments){r.comments=[];for(var n=0;n<a.Entity.Comments.length;n++)null!=a.Entity.Comments[n].timestamp?r.AddCommentInternal(a.Entity.Comments[n].id,a.Entity.Comments[n].signature,a.Entity.Comments[n].value,a.Entity.Comments[n].timestamp):r.AddCommentInternal(a.Entity.Comments[n].id,a.Entity.Comments[n].signature,a.Entity.Comments[n].value)}if(null!=a.Entity.Consolidated&&(this.consolidated=1==a.Entity.Consolidated),null!=a.Entity.TextRotation&&(this.textrotate=a.Entity.TextRotation),null!=a.Entity.PageRotation&&(this.pagerotation=a.Entity.PageRotation),null!=a.Entity.FileName&&(this.documentName=a.Entity.FileName),null!=a.Entity.Layout&&(this.layout=a.Entity.Layout),null!=a.Entity.Color&&(this.color=a.Entity.Color),null!=a.Entity.UniqueID&&(this.uniqueID=a.Entity.UniqueID),null!=a.Entity.DocOffsetX?this.docdx=a.Entity.DocOffsetX:this.docdx=null!=i?i.getdx():0,null!=a.Entity.DocOffsetY?this.docdy=a.Entity.DocOffsetY:this.docdy=null!=i?i.getdy():0,null!=a.Entity.DocScale?this.docdscale=a.Entity.DocScale:this.docdscale=null!=i?i.getdscale():1,null!=a.Entity.Transparency&&(this.transparency=a.Entity.Transparency),3==this.type&&3==this.subtype&&(this.transparency=30,this.fillcolor=An(this.fillcolor,this.transparency)),null!=a.Entity.LineColor&&(this.strokecolor=a.Entity.LineColor,jn(this.strokecolor)?this.strokecolor=Vn(this.strokecolor,100):this.strokecolor=An(this.strokecolor,100)),null!=a.Entity.TextColor&&(this.textcolor=a.Entity.TextColor,jn(this.textcolor)?this.textcolor=Vn(this.textcolor,100):this.textcolor=An(this.textcolor,100)),null!=a.Entity.Scaling&&(this.scaling=a.Entity.Scaling,isFinite(this.scaling)||(this.scaling=1),isNaN(this.scaling)&&(this.scaling=1)),null!=a.Entity.LoadScaling?(this.loadscaling=a.Entity.LoadScaling,isFinite(this.loadscaling)||(this.loadscaling=1),isNaN(this.loadscaling)&&(this.loadscaling=1)):this.loadscaling=this.scaling,null!=a.Entity.FillColor&&(this.fillcolor=a.Entity.FillColor,jn(this.fillcolor)?this.fillcolor=Vn(this.fillcolor,this.transparency):this.fillcolor=An(this.fillcolor,this.transparency)),null!=a.Entity.Font.Font.facename&&(this.fontname=a.Entity.Font.Font.facename),null!=a.Entity.Font.height&&(this.textheight=a.Entity.Font.Font.height),null==this.fontname&&null==this.textheight||(this.font=new Rn(this.fontname,this.textheight,!1,!1)),null!=a.Entity.Font){var o=a.Entity.Font.Font.facename,l=a.Entity.Font.Font.height,c=1==a.Entity.Font.Font.bold,h=1==a.Entity.Font.Font.italic;this.font=new Rn(o,l,c,h),this.textheight=l}if(a.Entity.HasScale&&null!=a.Entity.ScalingObject&&(this.scaleObject.measurescale=a.Entity.ScalingObject.Measurescale,this.scaleObject.scaleLabel=a.Entity.ScalingObject.ScaleLabel,this.scaleObject.Unitofmeasure=a.Entity.ScalingObject.Unitofmeasure,this.scaleObject.SubmeasureUnit=a.Entity.ScalingObject.SubmeasureUnit,this.scaleObject.Unitlabel=a.Entity.ScalingObject.Unitlabel,this.scaleObject.AreaUnitlabel=a.Entity.ScalingObject.AreaUnitlabel,this.scaleObject.unitscale=a.Entity.ScalingObject.Unitscale,this.scaleObject.scaleValue=a.Entity.ScalingObject.ScaleValue,this.scaleObject.ndimprecision=a.Entity.ScalingObject.Ndimprecision,this.hasScale=a.Entity.HasScale),null!=a.Entity.Signature&&(this.signature=a.Entity.Signature),null!=a.Entity.Xoffset&&(this.xoffset=a.Entity.Xoffset),null!=a.Entity.Yoffset&&(this.yoffset=a.Entity.Yoffset),isNaN(this.xoffset)&&(this.xoffset=0),isNaN(this.yoffset)&&(this.yoffset=0),7==this.type&&null!=a.Entity.LeaderLineOffset&&(this.leaderoffset=a.Entity.LeaderLineOffset),8==this.type&&(null!=a.Entity.LabelOffsetX&&(this.labeloffsetx=a.Entity.LabelOffsetX),null!=a.Entity.LabelOffsetY&&(this.labeloffsety=a.Entity.LabelOffsetY),null!=a.Entity.LabelColor&&(this.labelfillcolor=a.Entity.LabelColor)),null!=a.Entity.LineWidth&&(this.linewidth=a.Entity.LineWidth),null!=a.Entity.LineWidthSegment?this.linewidthSegment=a.Entity.LineWidthSegment:this.linewidthSegment=Ar,null!=a.Entity.ArrowSize&&(this.arrowlength=a.Entity.ArrowSize),null!=a.Entity.LineStyle&&(this.linestyle=a.Entity.LineStyle),null!=a.Entity.Text?(this.text=a.Entity.Text,"."==this.text&&(this.text="")):this.text="",null!=a.Entity.Status&&(this.status=a.Entity.Status),null!=a.Entity.SmallText&&(this.smalltext=a.Entity.SmallText,"."==this.smalltext&&(this.smalltext="")),null!=a.Entity.DimText?(this.dimtext=a.Entity.DimText,"."==this.dimtext&&(this.dimtext="")):this.dimtext="",null!=a.Entity.CustomLabelText?(this.customlabeltext=a.Entity.CustomLabelText,"."==this.customlabeltext&&(this.customlabeltext="")):this.customlabeltext="",null!=a.Entity.CustomLabelOn&&(this.busecustomlabel=1==a.Entity.CustomLabelOn),13==this.type&&(null!=a.Entity.innerRadius&&(this.innerRadius=a.Entity.innerRadius),null!=a.Entity.outerRadius&&(this.outerRadius=a.Entity.outerRadius),this.removepoints(),null!=a.Entity.Points)){if(0==(f=a.Entity.Points.Point).length)return!1;for(var d=0;d<f.length;d++){var p=f[d].x,u=f[d].y;r.addcountLoad({x:p,y:u})}}14==this.type&&(null!=a.Entity.startX&&(r.startX=a.Entity.startX),null!=a.Entity.startY&&(r.startY=a.Entity.startY),null!=a.Entity.secondX&&(r.secondX=a.Entity.secondX),null!=a.Entity.secondY&&(r.secondY=a.Entity.secondY),null!=a.Entity.endX&&(r.endX=a.Entity.endX),null!=a.Entity.endY&&(r.endY=a.Entity.endY));var g=1==this.type&&6==this.subtype;if((1==this.type||2==this.type||8==this.type)&&!g&&(this.removepoints(),null!=a.Entity.Points)){var f;if(0==(f=a.Entity.Points.Point).length)return!1;for(d=0;d<f.length;d++)p=f[d].x,u=f[d].y,r.addpoint(p,u);r.findrectangle()}if(0==this.type||g){if(this.removepoints(),null==a.Entity.Line||0==a.Entity.Line.length)return!1;var x=a.Entity.Line;for(d=0;d<x.length;d++){for(var w=x[d].Point,k=0;k<w.length;k++){p=w[k].x,u=w[k].y;var D=new pn(p,u);this.points.push(D)}this.pointlist.push(this.points),this.points=[]}}if(12==this.type&&(null==this.transparency&&(this.transparency=30,this.fillcolor=An(this.fillcolor,this.transparency)),100==this.subtype&&(this.text=a.Entity.Text),this.font.setFontname("Times New Roman"),this.font.setBold(!0)),11==this.type||20==this.type){var C=new Image;if(null!=a.Entity.SvgContent)r.svgContent=a.Entity.SvgContent,r.markupsvgload(a.Entity.SvgContent,C);else if(null!=a.Entity.Image){var R=a.Entity.Image.image;R=R.slice(9,R.length-3),r.markupcdataload(C,R)}else if(null!=a.Entity.Imagehref){var P=a.Entity.Imagehref;r.imagehref=P,r.markupimageload(P,C)}else this.type=3,this.subtype=0,this.alternative=0}}return!0},this.SetfromXML=function(e,t,a){null!=t.getElementsByTagName("View")[0]?this.pagenumber=parseInt(t.getElementsByTagName("View")[0].firstChild.nodeValue):this.pagenumber=0,null!=t.getElementsByTagName("ViewName3D")[0]?(this.viewname=t.getElementsByTagName("ViewName3D")[0].firstChild.nodeValue,null!=t.getElementsByTagName("For3DView")[0]&&(this.bfor3D=1==parseInt(t.getElementsByTagName("For3DView")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageHeight3D")[0]&&(this.pageheight=parseInt(t.getElementsByTagName("PageHeight3D")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageWidth3D")[0]&&(this.pagewidth=parseInt(t.getElementsByTagName("PageWidth3D")[0].firstChild.nodeValue))):(this.viewname=null,this.bfor3D=!1),y="C360"==a||"C365"==a||"C366"==a||"C370"==a,v="C370"==a;var i=e.getPageObject(this.pagenumber);if(this.x=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("x").value),this.y=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("y").value),this.w=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("w").value),this.h=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("h").value),isNaN(this.x)&&(this.x=10),isNaN(this.y)&&(this.y=10),isNaN(this.w)&&(this.w=100),isNaN(this.h)&&(this.h=100),null!=t.getElementsByTagName("FixedScale")[0]&&(m=1==parseFloat(t.getElementsByTagName("FixedScale")[0].firstChild.nodeValue),this.bUseFixedScale=1==parseFloat(t.getElementsByTagName("FixedScale")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("FixedScaleFactor")[0]&&(this.fixedscaleFactor=parseFloat(t.getElementsByTagName("FixedScaleFactor")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("Redaction")[0]&&(this.bRedact=1==parseInt(t.getElementsByTagName("Redaction")[0].firstChild.nodeValue)),0==this.h&&0==this.w&&8!=this.type&&1!=this.type&&2!=this.type&&0!=this.type)return!1;if(8==this.type||1==this.type||this.type,this.bCanHaveLink=1==this.type&&2==this.subtype||3==this.type||4==this.type||5==this.type||9==this.type||11==this.type||20==this.type,null!=t.getElementsByTagName("HaveLink")[0]&&(this.bhaveLink=1==parseInt(t.getElementsByTagName("HaveLink")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("LinkURL")[0]&&null!=t.getElementsByTagName("LinkURL")[0].firstChild&&(this.linkURL=t.getElementsByTagName("LinkURL")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Layer")[0]?this.layer=t.getElementsByTagName("Layer")[0].firstChild.nodeValue:this.layer=Rr,this.timestamp=parseInt(t.getElementsByTagName("TimeStamp")[0].firstChild.nodeValue),this.rotation=parseFloat(t.getElementsByTagName("Rotation")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Extended")[0]){var s=t.getElementsByTagName("Extended")[0].childNodes;this.customattributes=[];for(var n=0;n<s.length;n++)if(null!=s[n].firstChild){var o=s[n].nodeName,l=s[n].firstChild.nodeValue;this.AddAttribute(o,l)}}if(null!=t.getElementsByTagName("Comments")[0]){var c=t.getElementsByTagName("Comments")[0].childNodes;for(this.comments=[],n=0;n<c.length;n++)if(null!=c[n].firstChild){var h=c[n].nodeName,d=(l=c[n].firstChild.nodeValue,c[n].attributes.getNamedItem("Signature").value),p=c[n].attributes.getNamedItem("Time").value;null!=p?this.AddCommentInternal(h,d,l,p):this.AddCommentInternal(h,d,l)}}if(null!=t.getElementsByTagName("Consolidated")[0]&&(this.consolidated=1==parseInt(t.getElementsByTagName("Consolidated")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("TextRotation")[0]&&(this.textrotate=parseFloat(t.getElementsByTagName("TextRotation")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageRotation")[0]&&(this.pagerotation=parseFloat(t.getElementsByTagName("PageRotation")[0].firstChild.nodeValue)),this.documentName=t.getElementsByTagName("FileName")[0].firstChild.nodeValue,this.layout=t.getElementsByTagName("Layout")[0].firstChild.nodeValue,null!=t.getElementsByTagName("Color")[0]&&(this.color=t.getElementsByTagName("Color")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Handle")[0]&&(this.markupID=parseInt(t.getElementsByTagName("Handle")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("UniqueID")[0]&&(this.uniqueID=t.getElementsByTagName("UniqueID")[0].firstChild.nodeValue,"0"==this.uniqueID&&(this.uniqueID=parseInt(this.uniqueID))),ei&&0==r.uniqueID&&Jc(r),null!=t.getElementsByTagName("DocOffsetX")[0]?this.docdx=parseFloat(t.getElementsByTagName("DocOffsetX")[0].firstChild.nodeValue):this.docdx=null!=i?i.getdx():0,null!=t.getElementsByTagName("DocOffsetY")[0]?this.docdy=parseFloat(t.getElementsByTagName("DocOffsetY")[0].firstChild.nodeValue):this.docdy=null!=i?i.getdy():0,null!=t.getElementsByTagName("DocScale")[0]?this.docdscale=parseFloat(t.getElementsByTagName("DocScale")[0].firstChild.nodeValue):this.docdscale=null!=i?i.getdscale():1,null!=t.getElementsByTagName("Transparency")[0]&&(this.transparency=parseInt(t.getElementsByTagName("Transparency")[0].firstChild.nodeValue)),3==this.type&&3==this.subtype&&(this.transparency=30,this.fillcolor=An(this.fillcolor,this.transparency)),null!=t.getElementsByTagName("LineColor")[0]&&(this.strokecolor=t.getElementsByTagName("LineColor")[0].firstChild.nodeValue,jn(this.strokecolor)?this.strokecolor=Vn(this.strokecolor,100):this.strokecolor=An(this.strokecolor,100)),null!=t.getElementsByTagName("TextColor")[0]&&(this.textcolor=t.getElementsByTagName("TextColor")[0].firstChild.nodeValue,jn(this.textcolor)?this.textcolor=Vn(this.textcolor,100):this.textcolor=An(this.textcolor,100)),this.scaling=parseFloat(t.getElementsByTagName("Scaling")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LoadScaling")[0]?this.loadscaling=parseFloat(t.getElementsByTagName("LoadScaling")[0].firstChild.nodeValue):this.loadscaling=this.scaling,isFinite(this.scaling)||(this.scaling=1),isNaN(this.scaling)&&(this.scaling=1),null!=t.getElementsByTagName("FillColor")[0]&&(this.fillcolor=t.getElementsByTagName("FillColor")[0].firstChild.nodeValue,jn(this.textcolor)?this.fillcolor=Vn(this.fillcolor,this.transparency):this.fillcolor=An(this.fillcolor,this.transparency)),null!=t.getElementsByTagName("FontName")[0]&&(this.fontname=t.getElementsByTagName("FontName")[0].firstChild.nodeValue),null!=t.getElementsByTagName("FontHeight")[0]&&(this.textheight=t.getElementsByTagName("FontHeight")[0].firstChild.nodeValue),null==this.fontname&&null==this.textheight||(this.font=new Rn(this.fontname,this.textheight,!1,!1)),null!=t.getElementsByTagName("Font")[0]){var u=t.getElementsByTagName("Font")[0].attributes.getNamedItem("facename").value,g=parseFloat(t.getElementsByTagName("Font")[0].attributes.getNamedItem("height").value),f=1==parseInt(t.getElementsByTagName("Font")[0].attributes.getNamedItem("bold").value),x=1==parseInt(t.getElementsByTagName("Font")[0].attributes.getNamedItem("italic").value);this.font=new Rn(u,g,f,x),this.textheight=g}if(this.signature=t.getElementsByTagName("Signature")[0].firstChild.nodeValue,this.xoffset=parseFloat(t.getElementsByTagName("Xoffset")[0].firstChild.nodeValue),this.yoffset=parseFloat(t.getElementsByTagName("Yoffset")[0].firstChild.nodeValue),isNaN(this.xoffset)&&(this.xoffset=0),isNaN(this.yoffset)&&(this.yoffset=0),7==this.type&&null!=t.getElementsByTagName("LeaderLineOffset")[0]&&(this.leaderoffset=t.getElementsByTagName("LeaderLineOffset")[0].firstChild.nodeValue),8==this.type&&(null!=t.getElementsByTagName("LabelOffsetX")[0]&&(this.labeloffsetx=t.getElementsByTagName("LabelOffsetX")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LabelOffsetY")[0]&&(this.labeloffsety=t.getElementsByTagName("LabelOffsetY")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LabelColor")[0]&&(this.labelfillcolor=t.getElementsByTagName("LabelColor")[0].firstChild.nodeValue)),this.linewidth=parseFloat(t.getElementsByTagName("LineWidth")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LineWidthSegment")[0]?this.linewidthSegment=parseFloat(t.getElementsByTagName("LineWidthSegment")[0].firstChild.nodeValue):this.linewidthSegment=Ar,null!=t.getElementsByTagName("ArrowSize")[0]&&(this.arrowlength=parseInt(t.getElementsByTagName("ArrowSize")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("LineStyle")[0]&&(this.linestyle=parseFloat(t.getElementsByTagName("LineStyle")[0].firstChild.nodeValue)),(9==this.type||10==this.type||12==this.type)&&(this.text=t.getElementsByTagName("Text")[0].firstChild.nodeValue,"."==this.text&&(this.text="")),null!=t.getElementsByTagName("Status")[0]&&(this.status=t.getElementsByTagName("Status")[0].firstChild.nodeValue),null!=t.getElementsByTagName("SmallText")[0]&&(this.smalltext=t.getElementsByTagName("SmallText")[0].firstChild.nodeValue,"."==this.smalltext&&(this.smalltext="")),null!=t.getElementsByTagName("DimText")[0]&&null!=t.getElementsByTagName("DimText")[0].firstChild?(this.dimtext=t.getElementsByTagName("DimText")[0].firstChild.nodeValue,"."==this.dimtext&&(this.dimtext="")):this.dimtext="",null!=t.getElementsByTagName("CustomLabelText")[0]&&null!=t.getElementsByTagName("CustomLabelText")[0].firstChild?(this.customlabeltext=t.getElementsByTagName("CustomLabelText")[0].firstChild.nodeValue,"."==this.customlabeltext&&(this.customlabeltext="")):this.customlabeltext="",null!=t.getElementsByTagName("CustomLabelOn")[0]&&(this.busecustomlabel=1==parseInt(t.getElementsByTagName("CustomLabelOn")[0].firstChild.nodeValue)),13==this.type){if(this.innerRadius=parseFloat(t.getElementsByTagName("innerRadius")[0].firstChild.nodeValue),this.outerRadius=parseFloat(t.getElementsByTagName("outerRadius")[0].firstChild.nodeValue),this.removepoints(),0==t.getElementsByTagName("Point").length)return!1;for(var b=t.getElementsByTagName("Point"),w=0;w<b.length;w++){var k=parseFloat(b[w].attributes.getNamedItem("x").value),D=parseFloat(b[w].attributes.getNamedItem("y").value);r.addcountLoad({x:k,y:D})}}14==this.type&&(this.startX=parseFloat(t.getElementsByTagName("startX")[0].firstChild.nodeValue),this.startY=parseFloat(t.getElementsByTagName("startY")[0].firstChild.nodeValue),this.secondX=parseFloat(t.getElementsByTagName("secondX")[0].firstChild.nodeValue),this.secondY=parseFloat(t.getElementsByTagName("secondY")[0].firstChild.nodeValue),this.endX=parseFloat(t.getElementsByTagName("endX")[0].firstChild.nodeValue),this.endY=parseFloat(t.getElementsByTagName("endY")[0].firstChild.nodeValue));var C=1==this.type&&6==this.subtype;if((1==this.type||2==this.type||8==this.type)&&!C){if(this.removepoints(),0==t.getElementsByTagName("Point").length)return!1;for(b=t.getElementsByTagName("Point"),w=0;w<b.length;w++)k=parseFloat(b[w].attributes.getNamedItem("x").value),D=parseFloat(b[w].attributes.getNamedItem("y").value),r.addpoint(k,D);r.findrectangle()}if(0==this.type||C){if(this.removepoints(),0==t.getElementsByTagName("Line").length)return!1;var R=t.getElementsByTagName("Line");for(w=0;w<R.length;w++){for(var P=R[w].getElementsByTagName("Point"),S=0;S<P.length;S++){k=parseFloat(P[S].attributes.getNamedItem("x").value),D=parseFloat(P[S].attributes.getNamedItem("y").value);var M=new pn(k,D);this.points.push(M)}this.pointlist.push(this.points),this.points=[]}}if(12==this.type&&(null==this.transparency&&(this.transparency=30,this.fillcolor=An(this.fillcolor,this.transparency)),100==this.subtype&&(this.text=t.getElementsByTagName("Text")[0].firstChild.nodeValue),this.font.setFontname("Times New Roman"),this.font.setBold(!0)),11==this.type||20==this.type){var T=new Image;if(null!=t.getElementsByTagName("SvgContent")[0]&&null!=t.getElementsByTagName("SvgContent")[0].firstChild){var E=t.getElementsByTagName("SvgContent")[0].firstChild.nodeValue;r.svgContent=E,r.markupsvgload(E,T)}else if(null!=t.getElementsByTagName("Image")[0]&&null!=t.getElementsByTagName("Image")[0].firstChild){if(""!=t.getElementsByTagName("Image")[0].firstChild.nodeValue){if("\n"==t.getElementsByTagName("Image")[0].firstChild.nodeValue)var F=t.getElementsByTagName("Image")[0].firstChild.nextSibling.nodeValue;else F=(F=t.getElementsByTagName("Image")[0].firstChild.nodeValue).slice(9,F.length-3);r.markupcdataload(T,F)}}else if(null!=t.getElementsByTagName("Imagehref")[0]&&null!=t.getElementsByTagName("Imagehref")[0].firstChild){var I=t.getElementsByTagName("Imagehref")[0].firstChild.nodeValue;r.imagehref=I,r.markupimageload(I,T)}else this.type=3,this.subtype=0,this.alternative=0}return!0},this.markupcdataload=function(e,t){e.onload=function(t){r.image=e,r.imageloaded=!0,Vl(n),Nl(a)},e.src=t},this.markupcdataset=function(e,t,a){e.onload=function(t){r.image=e,r.imageloaded=!0,a(r.image)},e.src=t},this.markupimageblob=function(e,t){return new Promise((function(a,i){var s=(window.URL||window.webkitURL).createObjectURL(e);s&&r.markupcdataset(t,s,a)}))},this.markupimageload=function(e,t){Fh("GET",e,"blob").then((function(e){var a=URL.createObjectURL(e);a&&r.markupcdataload(t,a)})).catch((function(e){e.status?console.log("markupimageload",e.status):console.log("markupimageload",e)}))},this.markupsvgload=function(e,t){var a="data:image/svg+xml;base64,"+btoa(e);null!=at&&at.loadComplete(e,r),this.markupcdataload(t,a)},this.GetLinestyle=function(e,t,a){switch(e){case 0:break;case 1:t.setLineDash([10*a]);break;case 2:t.setLineDash([2*a,5*a]);break;case 3:t.setLineDash([10*a,5*a,2*a,5*a,2*a,5*a]);break;case 4:t.setLineDash([10*a,5*a,2*a,5*a]);break;case 5:t.setLineDash([0,15*a,15*a,0]);break;case 6:t.setLineDash([15*a,15*a])}},this.GetDateTime=function(e){var t=new Date(r.timestamp),a=t.getDate(),i=t.getMonth();i+=1;var s=t.getFullYear(),n=(t.getHours()<10?"0":"")+t.getHours(),o=(t.getMinutes()<10?"0":"")+t.getMinutes(),l=(t.getSeconds()<10?"0":"")+t.getSeconds();return e?a+"."+i+"."+s+" "+n+":"+o+":"+l:a+"."+i+"."+s},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.onPanScale=function(){},this.setDimDrawme=function(){if(6==this.type||7==this.type||3==this.type)var e={x:this.x,y:this.y,w:this.w,h:this.h};else if(1==this.type||8==this.type){if(!(t=this.getlastpoint()))return{x:0,y:0,w:0,h:0};e={x:t.x,y:t.y,w:t.x,h:t.y}}else if(13==this.type){var t;if(!(t=this.getlastcount()))return{x:0,y:0,w:0,h:0};e={x:t.x,y:t.y,w:t.x,h:t.y}}else 14==this.type&&(e={x:this.startX,y:this.startY,x2:this.secondX,y2:this.secondY,w:this.endX,h:this.endY});var a=hn.getCurrentpage().getpageRotation(),i=lo();i/=r.scaling;var s,n,o=ro(r.pagenumber),l=Kp({x:s=o.x,y:n=o.y}),c=Kp({x:this.xoffset,y:this.yoffset});switch(a){case 0:6==this.type||7==this.type?(e.x=(this.x-s)/i+this.xoffset,e.y=(this.y-n)/i+this.yoffset,e.w=(this.w-s)/i+this.xoffset,e.h=(this.h-n)/i+this.yoffset):1==this.type||8==this.type||13==this.type?(e.w=(t.x-s)/i+this.xoffset,e.h=(t.y-n)/i+this.yoffset):3==this.type?(e.x=(this.x-s)/i+this.xoffset,e.y=(this.y-n)/i+this.yoffset,e.w=(this.x+this.w-s)/i+this.xoffset,e.h=(this.y+this.h-n)/i+this.yoffset,e.w=e.w-this.x,e.h=e.h-this.y):14==this.type&&(null!=this.startX&&null!=this.startY&&(e.x=(this.startX-s)/i+this.xoffset,e.y=(this.startY-n)/i+this.yoffset),null!=this.secondX&&null!=this.secondY&&(e.x1=(this.secondX-s)/i+this.xoffset,e.y2=(this.secondY-n)/i+this.yoffset),null!=this.endX&&null!=this.endY&&(e.w=(this.endX-s)/i+this.xoffset,e.h=(this.endY-n)/i+this.yoffset));break;case 90:case 180:case 270:6==this.type||7==this.type?(e.x=(this.x-l.x)/i+c.x,e.y=(this.y-l.y)/i+c.y,e.w=(this.w-l.x)/i+c.x,e.h=(this.h-l.y)/i+c.y):1==this.type||8==this.type||13==this.type?(e.w=(t.x-l.x)/i+c.x,e.h=(t.y-l.y)/i+c.y):3==this.type?(e.x=(this.x-l.x)/i+c.x,e.y=(this.y-l.y)/i+c.y,e.w=(this.x+this.w-l.x)/i+c.x,e.h=(this.y+this.h-l.y)/i+c.y,e.w=e.w-this.x,e.h=e.h-this.y):14==this.type&&(null!=this.startX&&null!=this.startY&&(e.x=(this.startX-l.x)/i+c.x,e.y=(this.starty-l.y)/i+c.y),null!=this.secondX&&null!=this.secondY&&(e.x1=(this.secondX-l.x)/i+c.x,e.y2=(this.secondY-l.y)/i+c.y),null!=this.endX&&null!=this.endY&&(e.w=(this.endX-l.x)/i+c.x,e.h=(this.endY-l.y)/i+c.y))}return Math.PI,e},this.SetDim3D=function(e,t,a,i){switch(this.xscaled=(this.x-this.xoffset)*e,this.yscaled=(this.y-this.yoffset)*e,this.wscaled=this.w*e,this.hscaled=this.h*e,this.type){case 0:case 1:case 2:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i;break;case 3:this.xscaled+=a,this.yscaled+=i;break;case 4:this.xscaled+=a,this.yscaled+=i,1==this.subtype&&(this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i);break;case 5:this.xscaled+=a,this.yscaled+=i;break;case 6:case 7:case 8:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i;break;case 9:this.xscaled+=a,this.yscaled+=i,1!=this.subtype&&2!=this.subtype&&(this.wscaled=this.textwidth,this.hscaled=this.textheight*e);break;case 10:this.xscaled+=a,this.yscaled+=i,r.bUseFixedScale?(this.wscaled=this.w*r.fixedscaleFactor,this.hscaled=this.h*r.fixedscaleFactor):(this.wscaled=this.w*e,this.hscaled=this.h*e);break;case 11:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i;break;case 12:this.xscaled+=a,this.yscaled+=i;break;case 13:this.xscaled+=a,this.yscaled+=i,r.bUseFixedScale&&(this.wscaled=this.w*r.fixedscaleFactor,this.hscaled=this.h*r.fixedscaleFactor);break;case 20:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i}this.rotatedrect.x=this.xscaled,this.rotatedrect.y=this.yscaled,this.rotatedrect.w=this.wscaled,this.rotatedrect.h=this.hscaled},this.setFirstdrawDim=function(e,t,a){r.pdfannot&&null!=hn.getFoxitAnnot(r.pdfannotref)&&(e=1,(c=1==this.type||2==this.type||8==this.type)&&r.findrectangle()),0==e&&(e=1),0==t&&(t=1),isNaN(e)&&(e=1),isNaN(t)&&(t=1);var i=function(){if(yd())return 1;var e=1;return co(hn.getCurrentpage())&&(e=hn.getCurrentpage().MainImageScaling),e}(),s=e;v&&(s*=i);var n=r.font.height;if(Di&&(s=r.scaling),12!=r.type&&(n=a?m&&!Di?Math.round(n*t/r.scaling):r.font.height:m&&y&&!Di?Math.round(n*t):Math.round(n*s),isNaN(r.font.height)&&(n=11),r.textheight=n,r.font.setHeight(n)),y&&(a?(m&&!Di&&(r.linewidth=r.linewidth*t/s,r.linewidthSegment=r.linewidthSegment*t/s),r.arrowlength=r.arrowlength+r.linewidth):(m&&!Di?(r.linewidth*=t,r.linewidthSegment*=t):(r.linewidth*=s,r.linewidthSegment*=s),r.arrowlength=r.arrowlength+r.linewidth),isNaN(r.linewidth)&&(r.linewidth=1,r.linewidthSegment=Ar),isNaN(r.arrowlength)&&(r.arrowlength=er+r.linewidth)),y&&!a){this.x=(this.x+this.xoffset)*s,this.y=(this.y+this.yoffset)*s,14==r.type&&(r.startX=(r.startX+this.xoffset)*s,r.startY=(r.startY+this.yoffset)*s,r.secondX=(r.secondX+this.xoffset)*s,r.secondY=(r.secondY+this.yoffset)*s,r.endX=(r.endX+this.xoffset)*s,r.endY=(r.endY+this.yoffset)*s,r.setthird=!0);var o=4==this.type&&1==this.subtype&&v;0==this.type||1==this.type||2==this.type||6==this.type||7==this.type||8==this.type||o?(this.w=(this.w+this.xoffset)*s,this.h=(this.h+this.yoffset)*s):10==this.type&&m?(this.w*=t,this.h*=t):(this.w*=s,this.h*=s)}if(7==this.type&&y&&!a&&(r.leaderoffset*=s),8==this.type&&(y&&!a&&(r.labeloffsetx*=s),y&&!a&&(r.labeloffsety*=s)),13==this.type){y&&(a?m&&!Di&&(r.innerRadius=r.innerRadius*t/s,r.outerRadius=r.outerRadius*t/s):m&&!Di?(this.innerRadius*=t,this.outerRadius*=t):(this.innerRadius*=s,this.outerRadius*=s));for(var l=0;l<r.countshapes.length;l++)y&&!a&&(r.countshapes[l].x=(r.countshapes[l].x+this.xoffset)*s,r.countshapes[l].y=(r.countshapes[l].y+this.yoffset)*s);r.findrectangle()}var c,h=1==this.type&&6==this.subtype;if((c=1==this.type||2==this.type||8==this.type)&&this.subtype,c&&!h){for(var d=0;d<r.points.length;d++)y&&!a&&(r.points[d].x=(r.points[d].x+this.xoffset)*s,r.points[d].y=(r.points[d].y+this.yoffset)*s);r.findrectangle()}if(0==this.type||h){for(var p=0;p<this.pointlist.length;p++)for(var u=0;u<this.pointlist[p].length;u++)y&&!a&&(this.pointlist[p][u].x=(this.pointlist[p][u].x+this.xoffset)*s,this.pointlist[p][u].y=(this.pointlist[p][u].y+this.yoffset)*s);r.findrectangle()}y&&!a&&(this.xoffset*=s,this.yoffset*=s,isNaN(this.docdx)&&(this.docdx=hn.getCurrentpage().getdx()),isNaN(this.docdy)&&(this.docdy=hn.getCurrentpage().getdy()),isNaN(this.docdscale)&&(this.docdscale=hn.getCurrentpage().getdscale())),12==this.type&&(this.stampsmalltheight=.08*this.w-4,this.textheight+this.stampsmalltheight+this.h/10*2>this.h&&(this.textheight=this.h/2-this.h/10*2,this.stampsmalltheight=this.textheight/2-4)),12==this.type&&r.restorestampfontSize(),r.scaling=e},this.SetDimensions=function(e,t,a,i){if(this.bfor3D)r.SetDim3D(e,t,a,i);else{var s=Math.PI/180*360,n=!0;switch(this.xscaled=(this.x-this.xoffset)*e,this.yscaled=(this.y-this.yoffset)*e,this.wscaled=this.w*e,this.hscaled=this.h*e,0==hn.Type?hn.pages[0].dx:hn.getCurrentpage().dx,this.type){case 0:case 1:case 2:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0;break;case 3:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 4:this.xscaled+=a,this.yscaled+=i,1==this.subtype?(this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0):n=!1;break;case 5:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 6:case 7:case 8:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0;break;case 9:this.xscaled+=a,this.yscaled+=i,1==this.subtype||2==this.subtype?n=!1:(this.wscaled=this.textwidth,this.hscaled=this.textheight*e),n=!1;break;case 10:this.xscaled+=a,this.yscaled+=i,r.bUseFixedScale?(this.wscaled=this.w*r.fixedscaleFactor,this.hscaled=this.h*r.fixedscaleFactor):(this.wscaled=this.w*e,this.hscaled=this.h*e),n=!1;break;case 11:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i,n=!1;break;case 12:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 13:this.xscaled+=a,this.yscaled+=i,r.bUseFixedScale&&(this.wscaled=this.w*r.fixedscaleFactor,this.hscaled=this.h*r.fixedscaleFactor);break;case 14:null!=this.startX&&null!=this.startY&&(this.startXscaled=(this.startX-this.xoffset)*e,this.startYscaled=(this.startY-this.yoffset)*e,this.startXscaled+=a,this.startYscaled+=i),null!=this.secondX&&null!=this.secondY&&(this.secondXscaled=(this.secondX-this.xoffset)*e,this.secondYscaled=(this.secondY-this.yoffset)*e,this.secondXscaled+=a,this.secondYscaled+=i),null!=this.endX&&null!=this.endY&&(this.endXscaled=(this.endX-this.xoffset)*e,this.endYscaled=(this.endY-this.yoffset)*e,this.endXscaled+=a,this.endYscaled+=i),n=!0;break;case 20:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i,n=!1}var o=t*(Math.PI/180),l=ti/2,c=ai/2;if(this.rotatedrect.x=this.xscaled,this.rotatedrect.y=this.yscaled,this.rotatedrect.w=this.wscaled,this.rotatedrect.h=this.hscaled,0!=t&&r.setRotatedMarkuprect(l,c,n,o),9==this.type&&0==this.subtype&&0!=this.textrotate){Math.min(this.rotatedrect.x,this.rotatedrect.w),Math.max(this.rotatedrect.x,this.rotatedrect.w),Math.min(this.rotatedrect.y,this.rotatedrect.h),Math.max(this.rotatedrect.y,this.rotatedrect.h);var h=r.textrotate-s,d=r.getRotatedMarkup(this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.h,h);this.rotatedrect.w=d.x,this.rotatedrect.h=d.y,this.textrotate/(Math.PI/180)==180&&0==t&&(h=r.textrotate,d=r.getRotatedMarkup(this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.h,h),this.rotatedrect.w=d.x,this.rotatedrect.h=d.y)}9==this.type&&(1==this.subtype||this.subtype)}},this.SquareArea=function(){return Math.abs(this.w)*Math.abs(this.h)},this.PolygonHoleArea=function(e){var t=0,a=0,i=e.points.length;for(t=0;t<i-1;t++)a+=e.points[t].x*e.points[t+1].y-e.points[t+1].x*e.points[t].y;return a+=e.points[i-1].x*e.points[0].y-e.points[0].x*e.points[i-1].y,Math.abs(a/2)},this.PolygonArea=function(){var e=0,t=0,a=this.points.length;for(e=0;e<a-1;e++)t+=this.points[e].x*this.points[e+1].y-this.points[e+1].x*this.points[e].y;return t+=this.points[a-1].x*this.points[0].y-this.points[0].x*this.points[a-1].y,Math.abs(t/2)},this.PolygonCentre=function(e){var t,a=0,i=this.points.length;if("x"==e){if(i>0){for(t=0;t<i;t++)a+=this.points[t].x;a/=i}}else if(i>0){for(t=0;t<i;t++)a+=this.points[t].y;a/=i}return a},this.FindText=function(e,t){var a=!1;if(t)i=e,s=this.text;else var i=e.toLowerCase(),s=this.text.toLowerCase();var r=s.search(i);return-1==r?a=!1:r>=0&&(a=!0),a},this.RotateText=function(){},this.AdjustPointForRotation=function(e){var t=hn.getCurrentpage().getpageRotation()*(Math.PI/180);switch(hn.getCurrentpage().getpageRotation()){case 0:t=hn.getCurrentpage().getpageRotation()*(Math.PI/180);break;case 90:t=(hn.getCurrentpage().getpageRotation()+180)*(Math.PI/180);break;case 270:t=(hn.getCurrentpage().getpageRotation()-180)*(Math.PI/180);break;case 180:t=hn.getCurrentpage().getpageRotation()*(Math.PI/180)}var a=ti/2,i=ai/2;return new pn,r.getRotatedMarkup(a,i,e.x,e.y,t)},this.AdjustForRotation=function(e){var t=(360-hn.getCurrentpage().getpageRotation())*(Math.PI/180),a=hn.getCurrentpage().getpageRotation()*(Math.PI/180),i=hn.getCurrentpage().getpageRotation()*(Math.PI/180);switch(hn.getCurrentpage().getpageRotation()){case 0:i=hn.getCurrentpage().getpageRotation()*(Math.PI/180);break;case 90:i=(hn.getCurrentpage().getpageRotation()+180)*(Math.PI/180);break;case 270:i=(hn.getCurrentpage().getpageRotation()-180)*(Math.PI/180);break;case 180:i=hn.getCurrentpage().getpageRotation()*(Math.PI/180)}var s=ti/2,n=ai/2;if(oo()){var o=Hl();s*=o,n*=o}var l=0,c=0,h=new pn,d=0,p=0,u=0,g=0;if(0!=hn.getCurrentpage().getpageRotation()){switch(hn.getCurrentpage().getpageRotation()){case 0:return;case 90:d=this.x,p=this.y+this.h,u=this.x+this.w,g=this.y;break;case 180:d=this.x,p=this.y,u=this.x+this.w,g=this.y+this.h;break;case 270:d=this.x+this.w,p=this.y,u=this.x,g=this.y+this.h}switch(this.type){case 0:for(c=0;c<this.pointlist.length;c++)for(l=0;l<this.pointlist[c].length;l++)h=r.setinitRotatedMarkupPoint(s,n,this.pointlist[c][l].x,this.pointlist[c][l].y,t),this.pointlist[c][l].x=h.x,this.pointlist[c][l].y=h.y;r.findrectangle();break;case 1:r.firstpointset||(h=r.setinitRotatedMarkupPoint(s,n,this.points[0].x,this.points[0].y,t),this.points[0].x=h.x,this.points[0].y=h.y,r.firstpointset=!0);var f=this.points.length-1;h=r.setinitRotatedMarkupPoint(s,n,this.points[f].x,this.points[f].y,t),this.points[f].x=h.x,this.points[f].y=h.y,r.findrectangle();break;case 2:for(l=0;l<this.points.length;l++)h=r.setinitRotatedMarkupPoint(s,n,this.points[l].x,this.points[l].y,t),this.points[l].x=h.x,this.points[l].y=h.y;r.findrectangle();break;case 3:h=r.setinitRotatedMarkupPoint(s,n,u,g,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,d,p,t),this.w=h.x-this.x,this.h=h.y-this.y;break;case 4:1!=r.subtype?(h=r.setinitRotatedMarkupPoint(s,n,u,g,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,d,p,t),this.w=h.x-this.x,this.h=h.y-this.y):e?(h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,a),this.x=h.x,this.y=h.y):(h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,this.w,this.h,t),this.w=h.x,this.h=h.y);break;case 5:h=r.setinitRotatedMarkupPoint(s,n,u,g,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,d,p,t),this.w=h.x-this.x,this.h=h.y-this.y;break;case 6:case 7:e?(Ns&&(h=r.setinitRotatedMarkupPoint(s,n,this.w,this.h,a),this.w=h.x,this.h=h.y),h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,a),this.x=h.x,this.y=h.y):(h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,this.w,this.h,t),this.w=h.x,this.h=h.y);break;case 8:this.firstpointrotAdjusted||(h=r.setinitRotatedMarkupPoint(s,n,this.points[0].x,this.points[0].y,t),this.points[0].x=h.x,this.points[0].y=h.y,this.firstpointrotAdjusted=!0),this.points.length,(f=r.getlastpoint())&&(h=r.getRotatedMarkup(s,n,f.x,f.y,i),r.setlastpoint(h.x,h.y)),r.findrectangle();break;case 9:1==this.subtype||2==this.subtype?(h=r.setinitRotatedMarkupPoint(s,n,u,g,t),this.x=h.x,this.y=h.y,h=r.setinitRotatedMarkupPoint(s,n,d,p,t),this.w=h.x-this.x,this.h=h.y-this.y):(h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,t),this.x=h.x,this.y=h.y,this.textrotate=t);break;case 10:case 11:h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,t),this.x=h.x,this.y=h.y;break;case 12:h=r.setinitRotatedMarkupPoint(s,n,u,g,t),this.x=h.x,this.y=h.y,this.textrotate=t,h=r.setinitRotatedMarkupPoint(s,n,d,p,t),this.w=h.x-this.x,this.h=h.y-this.y;break;case 13:var m=this.countshapes.length>0;!this.firstpointrotAdjusted&&m&&(this.firstpointrotAdjusted=!0),(f=r.getlastcount())&&(h=r.getRotatedMarkup(s,n,f.x,f.y,i),r.setlastcount(h.x,h.y));break;case 14:e?null!=this.startX&&null!=this.startY&&(h=r.setinitRotatedMarkupPoint(s,n,this.startX,this.startY,a),this.startX=h.x,this.startY=h.y):(null!=this.startX&&null!=this.startY&&(h=r.setinitRotatedMarkupPoint(s,n,this.startX,this.startY,t),this.startX=h.x,this.startY=h.y),null!=this.secondX&&null!=this.secondY&&(h=r.setinitRotatedMarkupPoint(s,n,this.secondX,this.secondY,t),this.secondX=h.x,this.secondY=h.y),null!=this.endX&&null!=this.endY&&(h=r.setinitRotatedMarkupPoint(s,n,this.endX,this.endY,t),this.endX=h.x,this.endY=h.y));break;case 20:h=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,t),this.x=h.x,this.y=h.y}}},this.notify=function(){Nt.notify()},this.addsides=function(){if(this.sides=[],lo(),this.points.length>0){var e={x1:this.points[0].x,y1:this.points[0].y,x2:this.points[0].x,y2:this.points[0].y},t=0;for(t=0;t<this.points.length;t++)0==t?e={x1:this.points[t].x,y1:this.points[t].y,x2:this.points[t].x,y2:this.points[t].y}:t>0&&(e.x2=this.points[t].x,e.y2=this.points[t].y,this.sides.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),e.x1=this.points[t].x,e.y1=this.points[t].y);null!=this.sides[0]&&(e.x2=this.sides[0].x1,e.y2=this.sides[0].y1,this.sides.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}))}},this.savemarkupstateChanged=function(e,t){var a=new ll(r.markupnumber);r.bMultiOp&&(a.setmultiValues(r.multiOpId),r.resetmultiValues()),a.SetUndoValues(r),1==t?(a.bmodify=!0,a.bdelete=!1,a.bcreate=!1):2==t?(a.bmodify=!1,a.bdelete=!1,a.bcreate=!0):3==t&&(a.bmodify=!1,a.bdelete=!0,a.bcreate=!1),e.tempundolist.push(a),r.resetmarkupmodified()},this.savemarkupstate=function(e,t){var a=new ll(r.markupnumber);r.bMultiOp&&(a.setmultiValues(r.multiOpId),r.resetmultiValues()),a.SetUndoValues(r),1==t?(a.bmodify=!0,a.bdelete=!1,a.bcreate=!1):2==t?(a.bmodify=!1,a.bdelete=!1,a.bcreate=!0):3==t&&(a.bmodify=!1,a.bdelete=!0,a.bcreate=!1),e.markupundolist.push(a)},this.savemetolistLoadMulti=function(e,t){r.savemetolist(e,!0,!1,!1,t)},this.setfirstDraw=function(){b=!0},this.savemetolistLoad=function(e,t){r.savemetolist(e,!t,!1,t),r.setdisplay(H)},this.savemetolistDraw=function(){b=!0,r.noDraw=Ki,r.savemetolist(hn,!1,!0),ei&&0==r.uniqueID&&Jc(r)},this.savemetolist=function(e,t,a,i,s){if(!((1==r.type&&2==r.subtype||8==r.type)&&r.points.length<3)){r.saved=!0;var n=4==r.type&&1==r.subtype;(0==r.type||6==r.type||7==r.type||9==r.type||10==r.type||11==r.type||20==r.type||n)&&(a&&r.bUsemouseinput&&r.AdjustForRotation(!0),r.bUsemouseinput=!0),r.markupnumber=Al(),e.markupdraworder[e.markupdraworder.length]=e.markuplist.length,e.markuplist[e.markuplist.length]=r,a&&(r.bisTextArrow||r.savemarkupstate(e,2),null!=it&&Ki&&it.loadComplete(e.markuplist,e.fileindex,e.bActive)),e.nummarkups++,null!=Nt&&Nt.setMarkupList(e.getmarkuplist(),e.bActive,t),i&&null!=tt&&tt.loadComplete(e.markuplist,e.fileindex,e.bActive)}},this.zoomTo=function(e){hn.getcurPage()!=r.pagenumber?zd(r.pagenumber).then((function(t){hn.pages[r.pagenumber].MarkupZoombyMarkup(r,e)})):hn.pages[r.pagenumber].MarkupZoombyMarkup(r,e)},this.rotate=function(e,t,a){if(!r.pdfannotproxy&&r.getselected()&&!Ei){var i=e,s=t,n=hn.getCurrentpage().getpageRotation()*(Math.PI/180),o=ti/2,l=ai/2;oo()&&(o*=w=Hl(),l*=w);var c=Math.PI/180*360,h=Math.PI/180*-180,d=Math.PI/180*180,p=1;p=lo(),p/=r.scaling;var u=(this.x-this.xoffset)*p,g=(this.y-this.yoffset)*p,f=this.w*p,m=this.h*p,y=ro(r.pagenumber);u+=y.x,g+=y.y;var v=r.rotation,x=r.rotation,b=!0;if(r.bfor3D)D=0,C=ti,R=0,P=ai;else{var w,k=hn.getCurrentpage().getpagerectdirect(),D=k.x,C=k.w,R=k.y,P=k.h;k.usepixelscale&&(D*=w=Hl(),C*=w,R*=w,P*=w)}var S=u+f/2,M=g+m/2;if(9==this.type&&0==this.subtype){S=u+f/2,M=g-m/2;var T=0;if(0!=this.textrotate){T=c-this.textrotate;var E=this.textheight*p,F=this.textwidth*p,I=r.getMarkupSelectPointRot(F/2,-E/2,r.textrotate);S=u+I.x,M=g+I.y}}var j=S-i,A=M-s,O=Math.atan2(A,j);O<-.5*Math.PI&&(O+=2*Math.PI);var L=r.getRotatedMarkup(o,l,S,M,n);switch(r.getRotatedMarkup(o,l,u,g,n),hn.getCurrentpage().getpageRotation()){case 0:x=9==this.type&&0==this.subtype?O-.5*Math.PI+T:O-.5*Math.PI;break;case 90:j=i-L.x,A=s-L.y,O=Math.atan2(A,j),x=9==this.type&&0==this.subtype?O-.5*Math.PI+n+T:O-.5*Math.PI+n;break;case 180:j=i-L.x,A=s-L.y,O=Math.atan2(A,j),x=9==this.type&&0==this.subtype?O-.5*Math.PI+T:O-.5*Math.PI;break;case 270:j=i-L.x,A=s-L.y,O=Math.atan2(A,j),x=9==this.type&&0==this.subtype?O-.5*Math.PI+n+T:O-.5*Math.PI+n}switch(this.type){case 0:case 1:case 2:r.rotation=0;break;case 3:6==r.subtype&&(r.rotation=0);break;case 4:case 5:break;case 6:case 7:case 8:r.rotation=0}x<h&&(x+=c),x>d&&(x-=c);var V=r.rotrectrot(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,x);if((V.x<D||V.x>C)&&(b=!1),(V.y<R||V.y>P)&&(b=!1),(V.x+V.w<D||V.x+V.w>C)&&(b=!1),(V.y+V.h<R||V.y+V.h>P)&&(b=!1),r.rotation=b?x:v,r.setmarkupmodified(!0),null!=Qt){var N=r.editaction;Qt.setMarkupSelected(r,N)}}},this.withinboundspoint=function(e,t){var a=!1,i=hn.getCurrentpage().startx,s=hn.getCurrentpage().starty,r=hn.getCurrentpage().endx,n=hn.getCurrentpage().endy;return e>i&&t>s&&e<r&&t<n&&(a=!0),a},this.withinbounds=function(e,t){var a=!1,i=hn.getCurrentpage().startx,s=hn.getCurrentpage().starty,n=hn.getCurrentpage().endx,o=hn.getCurrentpage().endy,l=lo();l/=r.scaling;var c=this.x*l,h=this.y*l,d=this.w*l,p=this.h*l;switch(this.type){case 0:case 1:case 2:break;case 3:case 4:case 5:c=this.xscaled,h=this.yscaled,d=this.xscaled+this.wscaled,p=this.yscaled+this.hscaled;break;case 6:case 7:case 8:break;case 9:0==this.subtype?(c=this.xscaled,h=this.yscaled,d=this.xscaled+this.textwidth,p=this.yscaled-this.textheight):1!=this.subtype&&2!=this.subtype||(c=this.xscaled,h=this.yscaled,d=this.xscaled+this.wscaled,p=this.yscaled+this.hscaled);break;case 10:case 11:case 12:case 20:c=this.xscaled,h=this.yscaled,d=this.xscaled+this.wscaled,p=this.yscaled+this.hscaled}return c+e>i&&h+t>s&&d+e<n&&p+t<o&&(a=!0),a},this.rotrect=function(e,t,a,i){var s=e+(a-e)/2,n=t+(i-t)/2,o=r.getMarkupSelectPointRot(-(a-e)/2,-(i-t)/2,r.rotation),l=r.getMarkupSelectPointRot((a-e)/2,(i-t)/2,r.rotation),c=r.getMarkupSelectPointRot(-(a-e)/2,(i-t)/2,r.rotation),h=r.getMarkupSelectPointRot((a-e)/2,-(i-t)/2,r.rotation),d=Math.min(s+o.x,s+l.x,s+c.x,s+h.x),p=Math.min(n+o.y,n+l.y,n+c.y,n+h.y);return{x:d,y:p,w:Math.max(s+o.x,s+l.x,s+c.x,s+h.x)-d,h:Math.max(n+o.y,n+l.y,n+c.y,n+h.y)-p}},this.rotrectrot=function(e,t,a,i,s){var n=e+(a-e)/2,o=t+(i-t)/2,l=r.getMarkupSelectPointRot(-(a-e)/2,-(i-t)/2,s),c=r.getMarkupSelectPointRot((a-e)/2,(i-t)/2,s),h=r.getMarkupSelectPointRot(-(a-e)/2,(i-t)/2,s),d=r.getMarkupSelectPointRot((a-e)/2,-(i-t)/2,s),p=Math.min(n+l.x,n+c.x,n+h.x,n+d.x),u=Math.min(o+l.y,o+c.y,o+h.y,o+d.y);return{x:p,y:u,w:Math.max(n+l.x,n+c.x,n+h.x,n+d.x)-p,h:Math.max(o+l.y,o+c.y,o+h.y,o+d.y)-u}},this.setCurPoint=function(e){return 1!=r.type||1!=r.subtype&&3!=r.subtype?r.editcurpoint>=0&&(r.editcurpoint=e):r.editcurpoint>0&&(r.editcurpoint=e),r.editcurpoint},this.resetcupoint=function(){r.editcurpoint=0},this.movemultiPoints=function(e,t){if(!r.pdfannotproxy){var a=e,i=t,s=!0,n=!0;switch(hn.getCurrentpage().getpageRotation()){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var o=0,l=0,c=0;if(c=lo(),c/=r.scaling,r.bfor3D&&(c=ai/this.pageheight),this.x,this.y,this.w,this.h,r.bfor3D)d=0,p=ti,u=0,g=ai;else{var h=hn.getCurrentpage().getpagerectdirect(),d=h.x,p=h.w,u=h.y,g=h.h;if(h.usepixelscale){var f=Hl();d*=f,p*=f,u*=f,g*=f}}var m=0,y=0;if(0!=r.rotation)var v=r.rotrect(this.xscaled,this.yscaled,this.wscaled,this.hscaled);else v={x:this.xscaled,y:this.yscaled,w:this.wscaled-this.xscaled,h:this.hscaled-this.yscaled};if(this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),this.bispartofGroup)(this.groupRect.x-a<d||this.groupRect.x-a>p)&&(this.groupRect.x+=a,this.groupRect.w+=a,s=!1),(this.groupRect.y-i<u||this.groupRect.y-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1),(this.groupRect.w-a<d||this.groupRect.w-a>p)&&(this.groupRect.x+=a,this.groupRect.w+=a,s=!1),(this.groupRect.h-i<u||this.groupRect.h-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1);else{if(o=0,l=0,s=!1,n=!1,this.bispartofGroup?((this.groupRect.x-a<d||this.groupRect.x+a>p)&&(this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.y-i<u||this.groupRect.y-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i)):(s=!(v.x-a<d||v.x+a>p||v.x+v.w-a<d||v.x+v.w-a>p),n=!(v.y-i<u||v.y-i>g||v.y+v.h-i<u||v.y+v.h-i>g)),!n||!s)return;for(m=0;m<this.pointlist.length;m++)for(y=0;y<this.pointlist[m].length;y++)o=this.pointlist[m][y].x*c,o-=a,s&&(this.pointlist[m][y].x=o/c),l=this.pointlist[m][y].y*c,l-=i,n&&(this.pointlist[m][y].y=l/c)}if(this.findrectangle(),r.setmarkupmodified(!0),null!=Qt){var x=r.editaction;Qt.setMarkupSelected(r,x)}}},this.movePoints=function(e,t){if(!r.pdfannotproxy){var a=e,i=t,s=!0,n=!0;switch(hn.getCurrentpage().getpageRotation()){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var o=0,l=0,c=0;if(c=lo(),c/=r.scaling,r.bfor3D&&(c=ai/this.pageheight),this.x,this.y,this.w,this.h,r.bfor3D)d=0,p=ti,u=0,g=ai;else{var h=hn.getCurrentpage().getpagerectdirect(),d=h.x,p=h.w,u=h.y,g=h.h;if(h.usepixelscale){var f=Hl();d*=f,p*=f,u*=f,g*=f}}var m=0;if(this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),this.bispartofGroup)(this.groupRect.x-a<d||this.groupRect.x-a>p)&&(this.groupRect.x+=a,this.groupRect.w+=a,s=!1),(this.groupRect.y-i<u||this.groupRect.y-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1),(this.groupRect.w-a<d||this.groupRect.w-a>p)&&(this.groupRect.x+=a,this.groupRect.w+=a,s=!1),(this.groupRect.h-i<u||this.groupRect.h-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1);else{for(o=0,l=0,s=!1,n=!1,m=0;m<this.points.length;m++){if(o=(this.points[m].x-this.xoffset)*c,o+=d,!((o-=a)>d&&o<p)){s=!1;break}if(s=!0,l=(this.points[m].y-this.yoffset)*c,l+=u,!((l-=i)>u&&l<g)){n=!1;break}n=!0}if(!n||!s)return;for(m=0;m<this.points.length;m++)o=this.points[m].x*c,o-=a,s&&(this.points[m].x=o/c),l=this.points[m].y*c,l-=i,n&&(this.points[m].y=l/c)}if(this.findrectangle(),r.setmarkupmodified(!0),null!=Qt){var y=r.editaction;Qt.setMarkupSelected(r,y)}}},this.movedirect=function(e,t){if(!r.pdfannotproxy){var a=0;a=lo(),a/=r.scaling;var i=this.x,s=this.y;i=e,s=t,this.x=i/a,this.y=s/a}},this.moveShape=function(e,t){if(!r.pdfannotproxy){var a=e,i=t;switch(hn.getCurrentpage().getpageRotation()){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var s=0;s=lo(),s/=r.scaling,r.bfor3D&&(s=ai/this.pageheight);var n=this.x*s,o=this.y*s;if(this.w,this.h,r.bfor3D)c=0,h=ti,d=0,p=ai;else{var l=hn.getCurrentpage().getpagerectdirect(),c=l.x,h=l.w,d=l.y,p=l.h;if(l.usepixelscale){var u=Hl();c*=u,h*=u,d*=u,p*=u}}if(n-=a,o-=i,this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),0!=r.rotation)var g=r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled);else{var f=Math.min(this.xscaled,this.xscaled+this.wscaled),m=Math.min(this.yscaled,this.yscaled+this.hscaled);g={x:f,y:m,w:Math.max(this.xscaled,this.xscaled+this.wscaled)-f,h:Math.max(this.yscaled,this.yscaled+this.hscaled)-m}}var y=(11==this.type||20==this.type)&&2==this.subtype;if(y||(this.bispartofGroup?((this.groupRect.x-a<c||this.groupRect.x+a>h)&&(n+=a,this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.y-i<d||this.groupRect.y-i>p)&&(o+=i,this.groupRect.y+=i,this.groupRect.h+=i)):((g.x-a<c||g.x+a>h)&&(n+=a),(g.y-i<d||g.y-i>p)&&(o+=i))),this.x=n/s,this.y=o/s,y||(this.bispartofGroup?((this.groupRect.w-a<c||this.groupRect.w-a>h)&&(n+=a,this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.h-i<d||this.groupRect.h-i>p)&&(o+=i,this.groupRect.y+=i,this.groupRect.h+=i)):((g.x+g.w-a<c||g.x+g.w-a>h)&&(n+=a),(g.y+g.h-i<d||g.y+g.h-i>p)&&(o+=i)),this.x=n/s,this.y=o/s),r.setmarkupmodified(!0),null!=Qt){var v=r.editaction;Qt.setMarkupSelected(r,v)}}},this.move=function(e,t,a){if(!r.pdfannotproxy&&r.getselected())if(3==this.type||5==this.type||4==this.type&&0==this.subtype||10==this.type||11==this.type||12==this.type||20==this.type)r.moveShape(e,t);else{var i=8==this.type||1==this.subtype;if(1!=this.type&&8!=this.type)if(0!=this.type){var s=e,n=t,o=!0;switch(hn.getCurrentpage().getpageRotation()){case 0:s=e,n=t;break;case 90:s=t,n=-e;break;case 180:s=-e,n=-t;break;case 270:s=-t,n=e}var l=0,c=0,h=0;h=lo(),h/=r.scaling,r.bfor3D&&(h=ai/this.pageheight);var d=this.x*h,p=this.y*h,u=this.w*h,g=this.h*h;if(r.bfor3D)m=0,y=ti,v=0,x=ai;else{var f=hn.getCurrentpage().getpagerectdirect(),m=f.x,y=f.w,v=f.y,x=f.h;if(f.usepixelscale){var b=Hl();m*=b,y*=b,v*=b,x*=b}}switch(this.type){case 0:var w=0,k=0;if(d-=s,p-=n,u-=s,g-=n,this.transformobj)var D=this.transformobj.a,C=this.transformobj.d;else D=1,C=1;if(this.x=d/h,this.y=p/h,1==this.subtype||0==this.subtype)if(this.w=u/h,this.h=g/h,o)for(k=0;k<this.pointlist.length;k++)for(w=0;w<this.pointlist[k].length;w++)l=this.pointlist[k][w].x*h,c=this.pointlist[k][w].y*h,l*=D,c*=C,l-=s,c-=n,this.pointlist[k][w].x=l/h/D,this.pointlist[k][w].y=c/h/C;else this.findrectangle();break;case 2:var R=0;if(d-=s,p-=n,u-=s,g-=n,(this.xscaled-s<m||this.xscaled-s>y)&&(d+=s,u+=s,o=!1),(this.yscaled-n<v||this.yscaled-n>x)&&(p+=n,g+=n,o=!1),(u<m||u>y)&&(d+=s,u+=s,o=!1),(this.hscaled-n<v||this.hscaled-n>x)&&(p+=n,g+=n,o=!1),this.x=d/h,this.y=p/h,this.w=u/h,this.h=g/h,o)for(R=0;R<this.points.length;R++)l=this.points[R].x*h,c=this.points[R].y*h,l-=s,c-=n,this.points[R].x=l/h,this.points[R].y=c/h;else this.findrectangle();break;case 4:this.bispartofGroup&&(this.groupRect.x-=s,this.groupRect.y-=n,this.groupRect.w-=s,this.groupRect.h-=n),d-=s,p-=n;var P=(this.x-this.xoffset)*h,S=(this.y-this.yoffset)*h;if(P+=m,S+=v,P-=s,S-=n,1==this.subtype){u-=s,g-=n;var M=Math.max(d,u)-Math.min(d,u),T=Math.max(p,g)-Math.min(p,g),E=r.getdiag(M,T);this.bispartofGroup?((this.groupRect.x-s<m||this.groupRect.x-s>y)&&(d+=s,u+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.y-n<v||this.groupRect.y-n>x)&&(p+=n,g+=n,this.groupRect.y+=n,this.groupRect.h+=n),(this.groupRect.w-s<m||this.groupRect.w-s>y)&&(d+=s,u+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(p+=n,g+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((P-E<m||P+E>y)&&(d+=s,u+=s),(S-E<v||S+E>x)&&(p+=n,g+=n)),this.w=u/h,this.h=g/h,this.x=d/h,this.y=p/h}else{if(0!=r.rotation)var F=r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled);else F={x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled};this.bispartofGroup?((this.groupRect.x-s<m||this.groupRect.x+s>y)&&(d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.y-n<v||this.groupRect.y-n>x)&&(p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((F.x-s<m||F.x-s>y)&&(d+=s),(F.y-n<v||F.y-n>x)&&(p+=n)),this.x=d/h,this.y=p/h,this.bispartofGroup?((this.groupRect.w-s<m||this.groupRect.w-s>y)&&(d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((F.x+F.w-s<m||F.x+F.w-s>y)&&(d+=s),(F.y+F.h-n<v||F.y+F.h-n>x)&&(p+=n)),this.x=d/h,this.y=p/h}break;case 6:if(6==this.subtype)break;this.bispartofGroup&&(this.groupRect.x-=s,this.groupRect.y-=n,this.groupRect.w-=s,this.groupRect.h-=n),d-=s,p-=n,this.bispartofGroup?((this.groupRect.x-s<m||this.groupRect.x-s>y)&&(u+=s,d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.y-n<v||this.groupRect.y-n>x)&&(g+=n,p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.xscaled-s<m||this.xscaled-s>y)&&(u+=s,d+=s),(this.yscaled-n<v||this.yscaled-n>x)&&(g+=n,p+=n)),u-=s,g-=n,this.bispartofGroup?((this.groupRect.w-s<m||this.groupRect.w-s>y)&&(u+=s,d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(g+=n,p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.wscaled-s<m||this.wscaled-s>y)&&(u+=s,d+=s),(this.hscaled-n<v||this.hscaled-n>x)&&(g+=n,p+=n)),this.x=d/h,this.y=p/h,this.w=u/h,this.h=g/h;break;case 7:this.bispartofGroup&&(this.groupRect.x-=s,this.groupRect.y-=n,this.groupRect.w-=s,this.groupRect.h-=n),d-=s,p-=n,this.bispartofGroup?((this.groupRect.x-s<m||this.groupRect.x-s>y)&&(u+=s,d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.y-n<v||this.groupRect.y-n>x)&&(g+=n,p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.xscaled-s<m||this.xscaled-s>y)&&(u+=s,d+=s),(this.yscaled-n<v||this.yscaled-n>x)&&(g+=n,p+=n)),u-=s,g-=n,this.bispartofGroup?((this.groupRect.w-s<m||this.groupRect.w-s>y)&&(u+=s,d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(g+=n,p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.wscaled-s<m||this.wscaled-s>y)&&(u+=s,d+=s),(this.hscaled-n<v||this.hscaled-n>x)&&(g+=n,p+=n)),this.x=d/h,this.y=p/h,this.w=u/h,this.h=g/h;break;case 9:this.textwidth,this.bispartofGroup&&(this.groupRect.x-=s,this.groupRect.y-=n,this.groupRect.w-=s,this.groupRect.h-=n),d-=s,p-=n;var I=u;switch(this.textrotate/(Math.PI/180)){case 0:break;case 90:u=g,g=I;break;case 180:break;case 270:u=g,g=I}F=0!=r.rotation?r.rotrect(this.xscaled,this.yscaled,this.xscaled+u,this.yscaled+g):{x:this.xscaled,y:this.yscaled,w:u,h:g},this.bispartofGroup?((this.groupRect.x-s<m||this.groupRect.x+s>y)&&(d+=s,this.groupRect.x+=s,this.groupRect.w+=s),(this.groupRect.y-n<v||this.groupRect.y-n>x)&&(p+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((F.x-s<m||F.x-s>y)&&(d+=s),(F.y-n<v||F.y-n>x)&&(p+=n)),this.bispartofGroup?(this.groupRect.w-s<m||this.groupRect.w-s>y)&&(d+=s,this.groupRect.x+=s,this.groupRect.w+=s):(F.x+F.w-s<m||F.x+F.w-s>y)&&(d+=s),1==this.subtype||2==this.subtype?this.bispartofGroup?(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(p+=n,this.groupRect.y+=n,this.groupRect.h+=n):(F.y+F.h-n<v||F.y+F.h-n>x)&&(p+=n):this.bispartofGroup?(this.groupRect.h-n<v||this.groupRect.h-n>x)&&(p+=n,this.groupRect.y+=n,this.groupRect.h+=n):(F.y-F.h-n<v||F.y-F.h-n>x)&&(p+=n),this.x=d/h,this.y=p/h,this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h);break;case 10:case 11:d-=s,p-=n,((F=0!=r.rotation?r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled):{x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled}).x-s<m||F.x+s>y)&&(d+=s),(F.y-n<v||F.y-n>x)&&(p+=n),(F.x+F.w-s<m||F.x+F.w-s>y)&&(d+=s),(F.y+F.h-n<v||F.y+F.h-n>x)&&(p+=n),this.x=d/h,this.y=p/h;break;case 12:d-=s,p-=n,((F=0!=r.rotation?r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled):{x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled}).x-s<m||F.x-s>y)&&(d+=s),(F.y-n<v||F.y-n>x)&&(p+=n),(F.x+F.w-s<m||F.x+F.w-s>y)&&(d+=s),(F.y+F.h-n<v||F.y+F.h-n>x)&&(p+=n),this.x=d/h,this.y=p/h;break;case 20:d-=s,p-=n,((F=0!=r.rotation?r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled):{x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled}).x-s<m||F.x+s>y)&&(d+=s),(F.y-n<v||F.y-n>x)&&(p+=n),(F.x+F.w-s<m||F.x+F.w-s>y)&&(d+=s),(F.y+F.h-n<v||F.y+F.h-n>x)&&(p+=n),this.x=d/h,this.y=p/h}if(r.setmarkupmodified(!0),null!=Qt){var j=r.editaction;Qt.setMarkupSelected(r,j)}}else r.movemultiPoints(e,t);else i&&!Ji||r.movePoints(e,t)}},this.setArrowPoint=function(e){r.setTextboxConnectionPoint(e.x,e.y,e.w,e.h)},this.setTextboxConnectionPointDraw=function(){if(6==r.type&&6==r.subtype){var e=r.fixedscaleFactor;e*=dr,Pn.height;var t=so(r.w,r.h,e),a=r.w-.5*t.w,i=r.w+.5*t.w;switch(r.x>a&&r.x<i?t.y>r.y?r.arrowTextPos=4:t.y<r.y&&(r.arrowTextPos=3):r.x<a?r.arrowTextPos=1:r.x>i&&(r.arrowTextPos=2),r.pagerotation){case 90:switch(r.arrowTextPos){case 2:r.arrowTextPos=4;break;case 1:r.arrowTextPos=3;break;case 4:r.arrowTextPos=1;break;case 3:r.arrowTextPos=2}break;case 270:switch(r.arrowTextPos){case 2:r.arrowTextPos=3;break;case 1:r.arrowTextPos=4;break;case 4:r.arrowTextPos=2;break;case 3:r.arrowTextPos=1}}}},this.setTextboxConnectionPoint=function(e,t,a,i){6==r.type&&6==r.subtype&&(this.x<e?(r.w=e,r.h=t+.5*i,r.arrowTextPos=1):e<this.x&&this.x<e+a?t>this.y?(r.w=e+.5*a,r.h=t,r.arrowTextPos=4):t<this.y&&(r.w=e+.5*a,r.h=t+i,r.arrowTextPos=3):this.x>e&&(r.w=e+a,r.h=t+.5*i,r.arrowTextPos=2))},this.movelabel=function(e,t){var a=e,i=t;switch(hn.getCurrentpage().getpageRotation()){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var s=lo();s/=r.scaling;var n=r.labeloffsetx*s,o=r.labeloffsety*s,l=r.labeloffsetx<r.labeloffsetx-a,c=r.labeloffsetx>r.labeloffsetx-a,h=r.labeloffsety>r.labeloffsety-i,d=r.labeloffsety<r.labeloffsety-i,p=r.labelRect.x>r.xscaled,u=r.labelRect.x+r.labelRect.w<r.wscaled,g=r.labelRect.y>r.yscaled,f=r.labelRect.y+r.labelRect.h<r.hscaled;if((p||l)&&(u||c)&&(g||d)&&(f||h)&&(n-=a,o-=i,r.labeloffsetx=n/s,r.labeloffsety=o/s),r.setmarkupmodified(!0),null!=Qt){var m=r.editaction;Qt.setMarkupSelected(r,m)}},this.dimextend=function(e,t){var a=ti/2,i=ai/2,s=hn.getCurrentpage().getpageRotation(),n=hn.getCurrentpage().usepdfjs,o=s*(Math.PI/180);if(n){var l=Hl();switch(a*=l,i*=l,s){case 0:o=s*(Math.PI/180);break;case 90:o=(s+180)*(Math.PI/180);break;case 270:o=(s-180)*(Math.PI/180);break;case 180:o=s*(Math.PI/180)}}else switch(s){case 0:o=s*(Math.PI/180);break;case 90:o=(s+180)*(Math.PI/180);break;case 270:o=(s-180)*(Math.PI/180);break;case 180:o=s*(Math.PI/180)}if(0!=s){var c=r.getRotatedMarkup(a,i,e,t,o);e=c.x,t=c.y}var h=lo();h/=r.scaling;var d={x:e,y:t},p={x:this.xscaled,y:this.yscaled},u={x:this.wscaled,y:this.hscaled},g=(d.x-p.x)*(u.y-p.y)-(d.y-p.y)*(u.x-p.x),f=wo(d,p,u);if(r.leaderoffset=g>0?-f/h:f/h,f<1&&(r.leaderoffset=0),r.setmarkupmodified(!0),null!=Qt){var m=r.editaction;Qt.setMarkupSelected(r,m)}},this.setSize=function(e){wscaled=e.width,hscaled=e.height,(this.xscaled+wscaled<startx||this.xscaled+wscaled>endx)&&(wscaled=this.w*scalefactor),(this.yscaled+hscaled<starty||this.yscaled+hscaled>endy)&&(hscaled=this.h*scalefactor),this.w=wscaled/scalefactor,this.h=hscaled/scalefactor},this.setinitialtext=function(e){r.intialtextset=e},this.setText=function(e){if(r.text=e,null!=Qt){var t=r.editaction;Qt.setMarkupSelected(r,t)}r.savemarkupstate(hn,1)},this.getTextDim=function(){return r.textdim},this.setTextboxSize=function(e,t){if(9==this.type){var a=lo();a/=r.scaling;var i=e,s=t;if(r.bfor3D)n=0,o=ti,l=0,c=ai,a=ai/this.pageheight;else var n=hn.getCurrentpage().startx,o=hn.getCurrentpage().endx,l=hn.getCurrentpage().starty,c=hn.getCurrentpage().endy;this.x,this.y;var h=this.w*a,d=this.h*a;if(1==this.subtype||2==this.subtype)null!=i&&(h=i),null!=s&&(d=s),(this.xscaled+h<n||this.xscaled+h>o)&&(h=this.wscaled),(this.yscaled+d<l||this.yscaled+d>c)&&(d=this.hscaled),h<0&&(h=1),d<0&&(d=1),this.w=h/a,this.h=d/a;else{var p=this.textheight*a,u=this.textwidth*a;this.textrotate,Math.PI,this.font.setHeight(p/a),ctx.font=this.font.fontstring,ctx.measureText(this.text).width,(this.xscaled+h<n||this.xscaled+h>o)&&(h=this.wscaled),(this.yscaled-d<l||this.yscaled-d>c)&&(d=this.hscaled),this.w=h/a,this.h=d/a,this.textheight=p/a,this.textwidth=u/a}return this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h),M()}},this.scale=function(e,t,a,i){const s=this.w/this.h;if(!r.pdfannotproxy&&r.getselected()){var n=e,o=t,l=0,c=0;switch(hn.getCurrentpage().getpageRotation()){case 0:n=e,o=t;break;case 90:n=t,o=-e;break;case 180:n=-e,o=-t;break;case 270:n=-t,o=e}if(0!=r.rotation){l=n,c=o;var h=-r.rotation;n=l*Math.cos(h)-c*Math.sin(h),o=l*Math.sin(h)+c*Math.cos(h)}var d=lo();if(d/=r.scaling,r.bfor3D)u=0,g=ti,f=0,m=ai,d=ai/this.pageheight;else{var p=hn.getCurrentpage().getpagerectdirect(),u=p.x,g=p.w,f=p.y,m=p.h;if(p.usepixelscale){var y=Hl();u*=y,g*=y,f*=y,m*=y}}var v={startx:u,endx:g,starty:f,endy:m},x=this.x*d,b=this.y*d,w=this.w*d,k=this.h*d;if(0!=r.rotation)var D=r.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled);else D={x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled};var C=this.type;switch(20!=this.type&&21!=this.type||(C=11),C){case 0:case 1:case 2:break;case 3:switch(a){case 4:D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o),this.w=w/d,this.h=k/d;break;case 1:D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:D.x-=n,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,w+=n,k-=o),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o),this.y=b/d,this.w=w/d,this.h=k/d}break;case 4:switch(a){case 4:if(1==this.subtype){var R=(this.w-this.xoffset)*d,P=(this.h-this.yoffset)*d;R+=u,P+=f,R-=n,P-=o,w-=n,k-=o;var S=Math.max(this.xscaled,this.wscaled)-Math.min(this.xscaled,this.wscaled),M=Math.max(this.yscaled,this.hscaled)-Math.min(this.yscaled,this.hscaled),T=Math.max(this.xscaled,R)-Math.min(this.xscaled,R),E=Math.max(this.yscaled,P)-Math.min(this.yscaled,P),F=(r.getdiag(S,M),r.getdiag(T,E));(this.xscaled-F<u||this.xscaled+F>g)&&(w+=n,k+=o),(this.yscaled-F<f||this.yscaled+F>m)&&(w+=n,k+=o),r.radiusCallback(this.x,this.y,this.w,this.h,!0)}else D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o);this.w=w/d,this.h=k/d;break;case 1:D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:D.x-=n,D.w+=n,D.h-=o,uo(D,v)&&(x-=n,w+=n,k-=o),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:D.y-=o,D.w-=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o),this.y=b/d,this.w=w/d,this.h=k/d}break;case 5:switch(a){case 4:D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o),this.w=w/d,this.h=k/d;break;case 1:D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:D.x-=n,D.w+=n,D.h-=o,uo(D,v)&&(x-=n,w+=n,k-=o),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:D.y-=o,D.w-=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o),this.y=b/d,this.w=w/d,this.h=k/d}break;case 6:if(4==a){if(6==this.subtype)return;w-=n,k-=o,(this.wscaled-n<u||this.wscaled-n>g)&&(w+=n),(this.hscaled-o<f||this.hscaled-o>m)&&(k+=o),this.w=w/d,this.h=k/d}1==a&&(x-=n,b-=o,(this.xscaled-n<u||this.xscaled-n>g)&&(x+=n),(this.yscaled-o<f||this.yscaled-o>m)&&(b+=o),this.x=x/d,this.y=b/d),6==this.subtype&&null!=this.textBoxConnected&&this.setTextboxConnectionPoint(this.textBoxConnected.x,this.textBoxConnected.y,this.textBoxConnected.w,this.textBoxConnected.h),r.lengthangleCallback(this.x,this.y,this.w,this.h,hn.getCurrentpage().getpageRotation()),Ns&&r.calculateOrtho(!0,a,{x:n,y:o});break;case 7:4==a&&(w-=n,k-=o,(this.wscaled-n<u||this.wscaled-n>g)&&(w+=n),(this.hscaled-o<f||this.hscaled-o>m)&&(k+=o),this.w=w/d,this.h=k/d),1==a&&(x-=n,b-=o,(this.xscaled-n<u||this.xscaled-n>g)&&(x+=n),(this.yscaled-o<f||this.yscaled-o>m)&&(b+=o),this.x=x/d,this.y=b/d),Ns&&r.calculateOrtho(!0,a,{x:n,y:o}),r.setdimvalue(this.x,this.y,this.w,this.h);break;case 8:break;case 9:if(1==this.subtype||2==this.subtype)switch(a){case 4:D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o),w<0&&(w=1),k<0&&(k=1),this.w=w/d,this.h=k/d;break;case 1:D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o),w<0&&(w=1),k<0&&(k=1),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:D.x-=n,D.w+=n,D.h-=o,uo(D,v)&&(x-=n,w+=n,k-=o),w<0&&(w=1),k<0&&(k=1),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:D.y-=o,D.w-=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o),w<0&&(w=1),k<0&&(k=1),this.y=b/d,this.w=w/d,this.h=k/d}else{var I=this.textheight*d,j=this.textwidth*d;switch(this.textrotate/(Math.PI/180)){case 0:case 90:case 180:break;case 270:n=-t,o=e}I-=.25*o,j-=.25*n,w-=.25*n,k-=.25*o,this.font.setHeight(I/d),i.font=this.font.fontstring,i.measureText(this.text).width,(this.xscaled+this.wscaled-n<u||this.xscaled+this.wscaled-n>g)&&(w+=n,j+=n,I+=o),(this.yscaled-this.hscaled-o<f||this.yscaled-this.hscaled-o>m)&&(k+=o,I+=o),this.w=w/d,this.h=k/d,this.textheight=I/d,this.textwidth=j/d}this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h);break;case 11:switch(a){case 4:this.aspectLock?(D.w-=n,D.h=D.w/s,uo(D,v)&&(k=(w-=n)/s)):(D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o)),this.w=w/d,this.h=k/d;break;case 1:this.aspectLock?(D.x-=n,D.w+=n,D.h=D.w/s,D.y=D.y+(D.h-D.w/s),uo(D,v)&&(x-=n,b+=(k=(w+=n)/s)-w/s)):(D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o)),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:this.aspectLock?(D.w+=n,D.h=D.w/s,uo(D,v)&&(k=(w+=n)/s)):(D.x-=n,D.w+=n,D.h-=o,uo(D,v)&&(x-=n,w+=n,k-=o)),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:this.aspectLock?(D.w-=n,D.h=D.w/s,uo(D,v)&&(k=(w-=n)/s)):(D.y-=o,D.w-=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o)),this.y=b/d,this.w=w/d,this.h=k/d}break;case 12:switch(a){case 4:D.w-=n,D.h-=o,uo(D,v)&&(w-=n,k-=o),w<0&&(w=1),k<0&&(k=1),this.w=w/d,this.h=k/d;break;case 1:D.x-=n,D.y-=o,D.w+=n,D.h+=o,uo(D,v)&&(x-=n,b-=o,w+=n,k+=o),w<0&&(w=1),k<0&&(k=1),this.x=x/d,this.y=b/d,this.w=w/d,this.h=k/d;break;case 3:D.x-=n,D.w+=n,D.h-=o,uo(D,v)&&(x-=n,w+=n,k-=o),w<0&&(w=1),k<0&&(k=1),this.x=x/d,this.w=w/d,this.h=k/d;break;case 2:D.y-=o,D.w-=n,D.h+=o,uo(D,v)&&(b-=o,w-=n,k+=o),w<0&&(w=1),k<0&&(k=1),this.y=b/d,this.w=w/d,this.h=k/d}this.font.setHeight(.16*this.w),0==this.alternative?(this.stampsmalltheight=.08*this.w-4,this.stampsmalltheight<1&&(this.stampsmalltheight=1),this.textheight+this.stampsmalltheight+this.h/10*2>this.h&&(this.font.setHeight(this.h/2-this.h/10*2),this.stampsmalltheight=this.textheight/2-4,this.stampsmalltheight<1&&(this.stampsmalltheight=1))):.6*this.w>=this.h?this.font.setHeight(this.h/4):this.font.setHeight(.16*this.w)}if(r.setmarkupmodified(!0),null!=Qt){var A=r.editaction;Qt.setMarkupSelected(r,A)}}},this.rotatedRectangle=function(){this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.w},this.findrotatedrectangle=function(){if(0==this.type||1==this.type||13==this.type||8==this.type){var e=0,t=0;if(13==this.type)for(var a=r.getrotatedPoint(r.countshapes[0].x,r.countshapes[0].y),i=a.x,s=a.y,n=a.x,o=a.y,l=1;l<r.countshapes.length;l++)(a=r.getrotatedPoint(r.countshapes[l].x,r.countshapes[l].y)).x<i&&(i=a.x),a.y<s&&(s=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y);else if(0==this.type||1==this.type&&6==this.subtype){if(0!=this.pointlist.length)for(i=(a=r.getrotatedPoint(this.pointlist[0][0].x,this.pointlist[0][0].y)).x,s=a.y,n=a.x,o=a.y,t=0;t<this.pointlist.length;t++)for(e=0;e<this.pointlist[t].length;e++)(a=r.getrotatedPoint(this.pointlist[t][e].x,this.pointlist[t][e].y)).x<i&&(i=a.x),a.y<s&&(s=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y)}else if(this.points.length>0){var c=lo();this.points[0].scale;a=r.getrotatedPoint(this.points[0].x,this.points[0].y);var h=r.getrotatedPoint(this.points[0].offsetx,this.points[0].offsety);for(a.x,h.x,a.y,h.y,i=a.x,s=a.y,n=a.x,o=a.y,e=0;e<this.points.length;e++)c/this.points[e].scale,a=r.getrotatedPoint(this.points[e].x,this.points[e].y),h=r.getrotatedPoint(this.points[e].offsetx,this.points[e].offsety),a.x,h.x,a.y,h.y,a.x<i&&(i=a.x),a.y<s&&(s=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y)}return{x:i,y:s,w:n,h:o}}},this.findrectangle=function(){if(0==this.type||1==this.type||13==this.type||8==this.type){var e=0,t=0;if(13==this.type)for(var a=r.countshapes[0].x,i=r.countshapes[0].y,s=r.countshapes[0].x,n=r.countshapes[0].y,o=1;o<r.countshapes.length;o++)r.countshapes[o].x<a&&(a=r.countshapes[o].x),r.countshapes[o].y<i&&(i=r.countshapes[o].y),r.countshapes[o].x>s&&(s=r.countshapes[e].x),r.countshapes[o].y>n&&(n=r.countshapes[o].y);else if(0==this.type||1==this.type&&6==this.subtype){if(0!=this.pointlist.length)for(a=this.pointlist[0][0].x,i=this.pointlist[0][0].y,s=this.pointlist[0][0].x,n=this.pointlist[0][0].y,t=0;t<this.pointlist.length;t++)for(e=0;e<this.pointlist[t].length;e++)this.pointlist[t][e].x<a&&(a=this.pointlist[t][e].x),this.pointlist[t][e].y<i&&(i=this.pointlist[t][e].y),this.pointlist[t][e].x>s&&(s=this.pointlist[t][e].x),this.pointlist[t][e].y>n&&(n=this.pointlist[t][e].y)}else if(this.points.length>0){var l=lo();this.points[0].scale;for(this.points[0].x,this.points[0].offsetx,this.points[0].y,this.points[0].offsety,a=this.points[0].x,i=this.points[0].y,s=this.points[0].x,n=this.points[0].y,e=0;e<this.points.length;e++)l/this.points[e].scale,this.points[e].x,this.points[e].offsetx,this.points[e].y,this.points[e].offsety,this.points[e].x<a&&(a=this.points[e].x),this.points[e].y<i&&(i=this.points[e].y),this.points[e].x>s&&(s=this.points[e].x),this.points[e].y>n&&(n=this.points[e].y)}this.x=a,this.y=i,this.w=s,this.h=n,this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,0!=this.type||this.origset||(this.origx=a,this.origy=i,this.origw=s,this.origh=n,this.origset=!0),(1==this.type&&2==this.subtype||8==this.type)&&this.addsides()}},this.removepoints=function(){this.pointlist=[],this.points=[],this.sides=[],this.countshapes=[]},this.addpoint=function(e,t){if(1==this.type&&6==this.subtype&&0==this.points.length){this.points.push({x:e,y:t});var a=r.setDimDrawme();this.setlastpoint(a.w,a.h)}this.points.push({x:e,y:t})},this.addrectpoint=function(e,t){this.points.push({x:e,y:t})},this.hidelabelmarkupobj=function(){this.hidevaluelabel=!0},this.showlabelmarkupobj=function(){this.hidevaluelabel=!1},this.addline=function(){this.pointlist.push(r.points),this.points=[]},this.snapToCorner=function(e,t,a){var i=r.getsnappoint(e,t);1==a?(this.x=i.x,this.y=i.y):4==a&&(this.w=i.x,this.h=i.y),r.setmarkupmodified(!0)},this.snapTo=function(e,t,a){var i=r.getsnappoint(e,t);a>=0&&a<=this.points.length-1&&(this.points[a].x=i.x,this.points[a].y=i.y),r.setmarkupmodified(!0)},this.getsnappoint=function(e,t){var a,i,s=ro(r.pagenumber);a=s.x,i=s.y;var n=lo();return r.bfor3D&&(n=ai/this.pageheight),{x:(e-a)/(n/=r.scaling)+this.xoffset,y:(t-i)/n+this.yoffset}},this.getSelectedpoint=function(){var e=void 0;return-1!=r.selectedpoint&&(this.points[r.selectedpoint]&&r.selectedpoint>=0&&r.selectedpoint<=this.points.length-1&&(e=this.points[r.selectedpoint]),this.countshapes[r.selectedpoint]&&r.selectedpoint>=0&&r.selectedpoint<=this.countshapes.length-1&&(e=this.countshapes[r.selectedpoint])),0!=r.selectedmultipoint.length&&this.pointlist[r.selectedmultipoint[0]][r.selectedmultipoint[1]]&&r.selectedmultipoint[1]>=0&&r.selectedmultipoint[1]<=this.pointlist[r.selectedmultipoint[0]].length-1&&(e=this.pointlist[r.selectedmultipoint[0]][r.selectedmultipoint[1]]),e},this.editpoint=function(e,t,a){if(4==r.editaction){var i=this.getSelectedpoint(a),s=e,n=t,o=lo();if(r.bfor3D&&(o=ai/this.pageheight),o/=r.scaling,r.bfor3D);else{if(hn.getCurrentpage().usepdfjs)var l=hn.getCurrentpage().getFoxitpageRect();else l=hn.getCurrentpage().getpagerectdirect();if(l.x,l.w,l.y,l.h,l.usepixelscale)Hl()}switch(hn.getCurrentpage().getpageRotation()){case 0:s=e,n=t;break;case 90:s=t,n=-e;break;case 180:s=-e,n=-t;break;case 270:s=-t,n=e}if(14==r.type){if(1==r.selectedpoint){r.setsecond=!0,r.setthird=!1;var c=0,h=0;r.endXscaled=null,r.endYscaled=null,r.endX=null,r.endY=null,c=r.startX*o,h=r.startY*o,c-=s,h-=n,r.startX=c/o,r.startY=h/o}2==r.selectedpoint&&(r.setsecond=!0,r.setthird=!1,c=0,h=0,r.endXscaled=null,r.endYscaled=null,r.endX=null,r.endY=null,c=r.secondX*o,h=r.secondY*o,c-=s,h-=n,r.secondX=c/o,r.secondY=h/o),3==r.selectedpoint&&(r.setsecond=!1,r.setthird=!0,c=0,h=0,c=r.endX*o,h=r.endY*o,c-=s,h-=n,r.endX=c/o,r.endY=h/o)}if(null!=i&&(this.type,c=0,h=0,c=i.x*o,h=i.y*o,c-=s,h-=n,i.x=c/o,i.y=h/o,this.findrectangle()),r.setmarkupmodified(!0),null!=Qt){var d=r.editaction;Qt.setMarkupSelected(r,d)}}},this.deletepoint=function(e){(1!=this.type||4!=this.subtype&&5!=this.subtype)&&(e>=0&&e<=this.points.length-1&&this.points.splice(e,1),e>=0&&e<=this.countshapes.length-1&&this.countshapes.splice(e,1),this.selectedpoint=-1,r.setmarkupmodified(!0))},this.insertcount=function(e){r.addcount(e),r.findrectangle(),r.setmarkupmodified(!0)},this.insertpoint=function(){if(1!=this.type||4!=this.subtype&&5!=this.subtype){var e=r.linesegment.p1>=0&&r.linesegment.p1<=this.points.length-1,t=r.linesegment.p2>=0&&r.linesegment.p2<=this.points.length-1;if(e&&t)if(1==r.type&&6==r.subtype);else{var a=this.points[r.linesegment.p1].x,i=this.points[r.linesegment.p1].y,s=a+.5*(this.points[r.linesegment.p2].x-a),n=i+.5*(this.points[r.linesegment.p2].y-i);0!=r.linesegment.p2?this.points.splice(r.linesegment.p2,0,{x:s,y:n}):2==this.points.length?this.points.splice(-1,0,{x:s,y:n}):this.points.push({x:s,y:n})}r.setmarkupmodified(!0)}},this.movepoint=function(e,t,a){a>=0&&a<=this.points.length-1&&(this.points[a].x=e,this.points[a].y=t)},this.setlastcount=function(e,t){this.countshapes[this.countshapes.length-1]&&(this.countshapes[this.countshapes.length-1].x=e,this.countshapes[this.countshapes.length-1].y=t)},this.getnumpoints=function(){var e=this.points.length;if(1==this.type&&6==this.subtype)for(var t=0;t<this.pointlist.length;t++)e+=this.pointlist[t].length;return e},this.setlastpoint=function(e,t){this.points.length>0&&(this.points[this.points.length-1].x=e,this.points[this.points.length-1].y=t,this.findrectangle())},this.getprevpoint=function(){return this.points.length>1&&{x:this.points[this.points.length-2].x,y:this.points[this.points.length-2].y}},this.getlastcount=function(){return this.countshapes.length>0&&{x:this.countshapes[this.countshapes.length-1].x,y:this.countshapes[this.countshapes.length-1].y}},this.getlastpoint=function(){return this.points.length>0&&{x:this.points[this.points.length-1].x,y:this.points[this.points.length-1].y}},this.startdraw=function(e){1==this.type&&6==this.subtype||(e.beginPath(),e.moveTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y))},this.displayurl=function(e,t,a){if(11!=r.type&&20!=r.type||3!=r.subtype){var i=1,s=r.linkURL;e.save(),e.font="10pt Arial";var n=e.measureText(s).width;n>i&&(i=n),i+=10,e.strokeStyle="black",e.fillStyle="rgba(113, 114, 118, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,i,20),e.fillRect(t,a+30,i,20),e.fillStyle="white",e.fillText(s,t+3,a+42),e.restore()}},this.hide=function(){r.display=!1},this.show=function(){r.display=!0},this.showlabeltype=function(e){8==this.type&&(this.labeltype=e)},this.getMarkupProperties=function(){var e=this.getMarkupType();return xd({label:e.label,typename:e.type,type:this.type,subtype:this.subtype})},this.getMarkupType=function(){var e={label:"",type:"",groups:[]};switch(this.type){case 0:0==this.subtype&&(e.label="Freehand pen",e.type="PEN"),1==this.subtype&&(e.label="Eraser",e.type="ERASER");break;case 1:0==this.subtype&&(e.label="Polygon",e.type="POLYGON"),1==this.subtype&&(e.label="Polyline",e.type=["PEN","POLYLINE"]),2==this.subtype&&(e.label="Polygon",e.type="POLYGON"),3==this.subtype&&(e.label="Measure Path",e.type="PATH"),4==i&&(e.label="Measure angle",e.type="ANGLE"),5==i&&(e.label="Measure angle",e.type="ANGLEBCKWRD"),6==i&&(e.label="Measure segment",e.type="SEGMENT"),7==i&&(e.label="Revision Cloud",e.type="REVCLOUD");break;case 2:e.label="Polycurve",e.type=["SHAPE","POLYCURVE"];break;case 3:0==this.subtype&&(e.label="Rectangle",e.type=["SHAPE","RECTANGLE"]),1==this.subtype&&(e.label="Rounded Rectangle",e.type=["SHAPE","ROUNDED_RECTANGLE"]),3==this.subtype&&(e.label="Marker",e.type="MARKER"),6==this.subtype&&(e.label="Rectanglular Area",e.type="AREARECT");break;case 4:0==this.subtype&&(e.label="Oval",e.type=["SHAPE","ELLIPSE"]),1==this.subtype&&(e.label="Circle",e.type=["SHAPE","CIRCLE"]);break;case 5:e.label="Revision Cloud",e.type=["SHAPE","CLOUD"];break;case 6:9==this.subtype?(e.label="Line",e.type=["ARROW","NO_ENDS"]):6==this.subtype?(e.label="Callout",e.type="TEXTARROW"):0==this.subtype?(e.label="Arrow",e.type=["OPEN_SINGLE_END","ARROW"]):1==this.subtype?(e.label="Arrow",e.type=["FILLED_SINGLE_END","ARROW"]):2==this.subtype?(e.label="Arrow",e.type=["OPEN_BOTH_ENDS","ARROW"]):3==this.subtype?(e.label="Arrow",e.type=["FILLED_BOTH_ENDS","ARROW"]):e.label="Arrow";break;case 7:e.label="Dimension Line",0==this.subtype?e.type=["BAR","DIMENSION"]:1==this.subtype&&(e.type=["OPEN_ARROW","DIMENSION"]);break;case 8:1==this.subtype?(e.label="Space",e.type="SPACE"):(e.label="Area",e.type="AREA");break;case 9:this.bhasArrow?(e.label="Callout",e.type="TEXT"):(e.label="Text",e.type="TEXT");break;case 11:switch(i){case 0:e.label="Image",e.type="IMAGE";break;case 1:e.label="Symbol",e.type="SYMBOL";break;case 3:e.label="Button",e.type="BUTTON";break;case 4:e.label="Signature",e.type="SIGNATURE";break;case 5:e.label="Signature",e.type="SIGNATUREMOVEABLE";break;case 12:e.label="Stamp",e.type="IMAGESTAMP";break;case 13:e.label="QRCode",e.type="IMAGEQR";break;case 20:e.label="Link",e.type="Link";break;case 21:e.label="InteractiveStamp",e.type="InteractiveStamp"}break;case 10:e.label="Note",e.type="NOTE";break;case 12:e.label="Stamp",e.type="STAMP";break;case 13:e.label="Count",e.type="COUNT";break;case 14:e.label="MeasureArc",e.type="MEASUREARC"}return e},this.getDisplayName=function(){return Kn(r.signature)},this.getLayerName=function(){return Dr[r.layer].Name},this.replaceImageMovable=function(e){r.replaceImage(e,!0)},this.replaceImage=function(e,t){if(11!=r.type&&20!=r.type||2!=r.subtype){if((11==r.type||20==r.type)&&3==r.subtype){var a;r.w=e.width,r.h=e.height,(a=new Image).src=e.src,r.image=a,r.imageloaded=!0,r.subtype=null!=t&&t?5:4}}else r.w=e.width,r.h=e.height,(a=new Image).src=e.src,r.image=a,r.imageloaded=!0},this.displaylabel=function(e,t,a){if(null!=Ue&&Ue.setMarkupHover(r,t,a),Xi){var i=r.getMarkupType(),s=r.getDisplayName(),n=r.getLayerName(),o=r.GetDateTime(!0),l="",c=1,h=50,d=!1;switch(e.save(),e.font="10pt Arial",this.type){case 9:l=this.text;var p=e.measureText(l),u=p.width;break;case 10:var g=function(e,t){var a,i="\n",s=!1,r="";do{for(var n=!1,o=t-1;o>=0;o--)if(a=e.charAt(o),new RegExp(/^\s$/).test(a.charAt(0))){r+=[e.slice(0,o),i].join(""),e=e.slice(o+1),n=!0;break}n||(r+=[e.slice(0,t),i].join(""),e=e.slice(t)),e.length<t&&(s=!0)}while(!s);return r+e}(l=null!=this.text?this.text:"",30).split("\n");p=0;for(var f=0;f<g.length;f++)e.measureText(g[f])>p&&(p=e.measureText(g[f]));(u=p.width)>c&&(c=u),h=60,d=!0}var m=e.measureText(i).width;m>c&&(c=m);var y=e.measureText(s).width;y>c&&(c=y);var v=e.measureText(n).width;v>c&&(c=v);var x=e.measureText(o).width;if(x>c&&(c=x),10!=this.type)c+=10,e.strokeStyle="black",e.fillStyle="rgba(113, 114, 118, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,c,h),e.fillRect(t,a+30,c,h),e.fillStyle="white",e.fillText(i,t+3,a+42),e.fillText(s,t+3,a+54),e.fillText(n,t+3,a+66),e.fillText(o,t+3,a+78),d&&e.fillText(l,t+3,a+90);else{if(c<200?c=200:c+=10,h=150,e.strokeStyle="black",e.fillStyle="rgba(255, 255, 0, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,c,h),e.fillRect(t,a+30,c,h),e.fillStyle="black",e.save(),e.beginPath(),e.rect(t,a+30,c,h),e.clip(),e.fillText(s,t+5,a+46),e.fillText(o,t+5,a+60),e.fillText(n,t+5,a+74),d){var b=a+100;for(f=0;f<g.length;f++)e.fillText(g[f],t+5,b),b+=12}e.restore()}e.restore()}},this.Rect=function(e,t,a,i,s,n,o,l,c,h){if(e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n,0!=r.rotation&&9!=r.type){var d=t+i/2,p=a+s/2;e.translate(d,p),e.rotate(r.rotation),e.translate(-d,-p)}e.beginPath(),e.moveTo(t,a),e.lineTo(t+i,a),e.lineTo(t+i,a+s),e.lineTo(t,a+s),e.closePath(),o&&e.fill(),l&&e.stroke(),e.restore()},this.drawradius=function(e,t,a,i,s,n,o,l,c){e.save(),e.strokeStyle=l,e.lineWidth=2;var h=Math.max(t,i)-Math.min(t,i),d=Math.max(a,s)-Math.min(a,s);r.getdiag(h,d),e.beginPath(),e.moveTo(t-n,a),e.lineTo(t+n,a),e.moveTo(t,a-n),e.lineTo(t,a+n),e.stroke(),e.restore()},this.radiusDimLeader=function(e,t,a,i,s,r,n){},this.Circle=function(e,t,a,i,s,n,o,l,c,h){e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n;var d=Math.max(t,i)-Math.min(t,i),p=Math.max(a,s)-Math.min(a,s),u=r.getdiag(d,p);e.beginPath(),e.arc(t,a,u,0,2*Math.PI),o&&e.fill(),l&&e.stroke(),e.restore()},this.Oval=function(e,t,a,i,s,n,o,l,c,h){var d=i/2*S,p=s/2*S,u=t+i,g=a+s,f=t+i/2,m=a+s/2;if(e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n,0!=r.rotation){var y=t+i/2,v=a+s/2;e.translate(y,v),e.rotate(r.rotation),e.translate(-y,-v)}e.beginPath(),e.moveTo(t,m),e.bezierCurveTo(t,m-p,f-d,a,f,a),e.bezierCurveTo(f+d,a,u,m-p,u,m),e.bezierCurveTo(u,m+p,f+d,g,f,g),e.bezierCurveTo(f-d,g,t,m+p,t,m),e.closePath(),o&&e.fill(),l&&e.stroke(),e.restore()},this.addcountLoad=function(e){r.countshapes.push({x:e.x,y:e.y})},this.addcount=function(e){r.countshapes.push({x:e.x,y:e.y});var t=r.setDimDrawme();this.setlastcount(t.w,t.h)},this.getcount=function(){return r.dimtext=r.countshapes.length.toString(),r.countshapes.length},this.setCountSize=function(e){r.outerRadius=e,r.innerRadius=.4*e},this.shapes=function(e,t,a,i,s,n,o,l,c,h){if(0!=r.countshapes.length){var d=0,p=a*r.fixedscaleFactor,u=i*r.fixedscaleFactor;Ti&&(p=a,u=i);var g=0,f=0;for(d=0;d<r.countshapes.length;d++)switch(g=(r.countshapes[d].x-this.xoffset)*l,f=(r.countshapes[d].y-this.yoffset)*l,g+=c,f+=h,t){case 0:Sp(e,g,f,p,0,s,n,n);break;case 1:Ep(e,g,f,p,0,s,n,n);break;case 2:Tp(e,g,f,p,0,s,n,n);break;case 3:Mp(e,g,f,p,0,s,n,n);break;case 4:Ap(e,g,f,p,u=(i=.4*sr)*r.fixedscaleFactor,s,n,n);break;case 5:Ip(e,g,f,p,u=(i=.5*sr)*r.fixedscaleFactor,s=.8*u,0,n);break;case 6:jp(e,g,f,p,u=(i=.5*sr)*r.fixedscaleFactor,s=.8*u,0,n);break;case 7:Fp(e,g,f,p,u=(i=.5*sr)*r.fixedscaleFactor,s=.8*u,0,n)}}},this.polygoncloud=function(e,t,a,i,s,n,o,l,c,h,d,p){if(0!=this.points.length){var u=2*t,g=0,f=(this.points[0].x-this.xoffset)*l,m=(this.points[0].y-this.yoffset)*l;d&&(f+=c,m+=h);var y=f,v=m,x=f,b=m;for(e.save(),r.bUseFixedScale?e.lineWidth=a*r.fixedscaleFactor:e.lineWidth=a*l,Ti&&(e.lineWidth=a),e.fillStyle=n,e.strokeStyle=o,e.beginPath(),g=1;g<r.points.length;g++){y=f,v=m,f=(this.points[g].x-this.xoffset)*l,m=(this.points[g].y-this.yoffset)*l,d&&(f+=c,m+=h),x=f,b=m;const a=Math.sqrt((x-y)**2+(b-v)**2),i=Math.atan2(b-v,x-y);u=2*t;for(let s=0;s<=a;s+=u){const a=y+s*Math.cos(i),r=v+s*Math.sin(i);g>1&&0==s?e.arc(a,r,t,.5*Math.PI+i,0+i):e.arc(a,r,t,Math.PI+i,0+i)}s&&(e.stroke(),e.beginPath())}if(p&&r.points.length>2){y=x,v=b,f=(this.points[0].x-this.xoffset)*l,m=(this.points[0].y-this.yoffset)*l,d&&(f+=c,m+=h),x=f,b=m;const a=Math.sqrt((x-y)**2+(b-v)**2),i=Math.atan2(b-v,x-y);u=2*t;for(let s=0;s<=a;s+=u){const a=y+s*Math.cos(i),r=v+s*Math.sin(i);g>1&&0==s?e.arc(a,r,t,.5*Math.PI+i,0+i):e.arc(a,r,t,Math.PI+i,0+i)}s&&e.stroke()}i&&e.fill(),e.restore()}},this.polygonhole=function(e,t,a,i,s,r,n,o,l,c,h){if(0!=h.points.length){var d=h.points.length-1,p=d;for(n/=h.scaling,p=d;p>=0;p--){var u=(h.points[p].x-h.xoffset)*n,g=(h.points[p].y-h.yoffset)*n;c&&(u+=o,g+=l),p==d&&e.moveTo(u,g),e.lineTo(u,g)}e.closePath()}},this.polygon=function(e,t,a,i,s,n,o,l,c,h){if(0!=this.points.length){var d=0,p=(this.points[0].x-this.xoffset)*o,u=(this.points[0].y-this.yoffset)*o;for(h&&(p+=l,u+=c),e.save(),e.strokeStyle=n,r.bUseFixedScale?e.lineWidth=t*r.fixedscaleFactor:e.lineWidth=t*o,Ti&&(e.lineWidth=t),e.fillStyle=s,e.beginPath(),e.moveTo(p,u),d=1;d<r.points.length;d++)p=(this.points[d].x-this.xoffset)*o,u=(this.points[d].y-this.yoffset)*o,h&&(p+=l,u+=c),e.lineTo(p,u);e.closePath();var g=o*r.scaling;if(0!=this.holes.length)for(var f=0;f<this.holes.length;f++)this.polygonhole(e,t,a,i,s,n,g,l,c,h,this.holes[f]);a&&e.fill(),i&&e.stroke(),e.restore()}},this.getangleofline=function(e,t,a,i,s){var r=0,n=0;return s?(r=Math.abs(a-e),n=Math.abs(i-t)):(r=a-e,n=i-t),{angle:Math.atan2(n,r),pointx:a,pointy:i}},this.calculateAngleBetweenLines=function(e,t,a,i,s,r){let n=e-a,o=t-i,l=s-a,c=r-i,h=Math.hypot(n,o),d=Math.hypot(l,c);if(0===h||0===d)return 0;n/=h,o/=h,l/=d,c/=d;let p=n*l+o*c;return p=Math.max(-1,Math.min(1,p)),Math.acos(p)},this.polylineSegments=function(e,t,a,i,s,n,o){var l=0,c=0,h=0,d=0;for(e.save(),e.strokeStyle=a,r.bUseFixedScale?e.lineWidth=t*r.fixedscaleFactor:e.lineWidth=t*i,Ti&&(e.lineWidth=t),e.beginPath(),h=0;h<r.points.length;h++)l=(this.points[h].x-this.xoffset)*i,c=(this.points[h].y-this.yoffset)*i,o&&(l+=s,c+=n),0==h?e.moveTo(l,c):e.lineTo(l,c);for(e.stroke(),e.beginPath(),d=0;d<this.pointlist.length;d++)for(h=0;h<this.pointlist[d].length;h++)l=(this.pointlist[d][h].x-this.xoffset)*i,c=(this.pointlist[d][h].y-this.yoffset)*i,o&&(l+=s,c+=n),0==h?e.moveTo(l,c):e.lineTo(l,c);e.stroke(),e.restore()},this.polyline=function(e,t,a,i,s,n,o){if(0!=this.points.length){var l=0,c=(this.points[0].x-this.xoffset)*i,h=(this.points[0].y-this.yoffset)*i;for(o&&(c+=s,h+=n),e.save(),e.strokeStyle=a,r.bUseFixedScale?e.lineWidth=t*r.fixedscaleFactor:e.lineWidth=t*i,Ti&&(e.lineWidth=t),e.beginPath(),e.moveTo(c,h),l=1;l<r.points.length;l++)c=(this.points[l].x-this.xoffset)*i,h=(this.points[l].y-this.yoffset)*i,o&&(c+=s,h+=n),e.lineTo(c,h);e.stroke(),e.restore()}},this.drawangle=function(e,t,a,i,s,n,o,l){if(this.points.length<2)return;const c=2*Math.PI,h=e=>(e+c)%c,d=e=>({x:(e.x-this.xoffset)*i+(o?s:0),y:(e.y-this.yoffset)*i+(o?n:0)}),p=d(this.points[0]),u=d(this.points[1]),g=this.points.length>=3,f=g?d(this.points[2]):null;e.save(),e.strokeStyle=a;const m=r.bUseFixedScale?r.fixedscaleFactor:i;e.lineWidth=Ti?t:t*m;const y=tr*(Ti?1:m),v=85*(Ti?1:m);if(e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(u.x,u.y),g&&e.lineTo(f.x,f.y),e.stroke(),g){const t=Math.atan2(p.y-u.y,p.x-u.x),a=Math.atan2(f.y-u.y,f.x-u.x);let i=h(t),s=h(a),r=(s-i+c)%c,n=!1;(r>Math.PI&&!l||r<=Math.PI&&l)&&(n=!0);const o=Math.hypot(p.x-u.x,p.y-u.y),d=Math.hypot(f.x-u.x,f.y-u.y),g=Math.min(o,d),m=Math.min(y,g);e.beginPath(),e.arc(u.x,u.y,m,i,s,n),e.strokeStyle="blue",e.lineWidth=4,e.stroke();const x=xo(p.x,p.y,f.x,f.y,u.x,u.y,v);let b=this.calculateAngleBetweenLines(p.x,p.y,u.x,u.y,f.x,f.y)*(180/Math.PI);l&&(b=360-b);const w=b.toFixed(1)+"Â°";return e.restore(),{text:w,pos:x}}return e.restore(),{text:"",pos:{x:u.x,y:u.y}}},this.drawangleold=function(e,t,a,i,s,n,o,l){if(0==this.points.length)return;let c=0,h=0,d=0,p=0;var u=[],g=0,f=0,m=!1;let y=0;var v="",x=0,b=(this.points[0].x-this.xoffset)*i,w=(this.points[0].y-this.yoffset)*i;o&&(b+=s,w+=n);var k=b,D=w;if(e.save(),e.strokeStyle=a,Mi){e.lineWidth=t*r.fixedscaleFactor;var C=tr*r.fixedscaleFactor,R=85*r.fixedscaleFactor}else e.lineWidth=t*i,C=tr*i,R=85*i;Ti&&(e.lineWidth=t,C=tr,R=85),e.beginPath(),e.moveTo(b,w);let P={x1:b,y1:w,x2:b,y2:w,cx:b,cy:w,r:R};for(x=1;x<r.points.length;x++){b=(this.points[x].x-this.xoffset)*i,w=(this.points[x].y-this.yoffset)*i,o&&(b+=s,w+=n),u.push(r.getangleofline(k,D,b,w,!1));var S={x1:k,y1:D,x2:b,y2:w};e.lineTo(b,w),1==x?(P.cx=b,P.cy=w):2==x&&(P.x2=b,P.y2=w);var M=this.getlinelength(S.x1,S.y1,S.x2,S.y2);M<C&&(C=M),k=b,D=w}2==u.length&&(c=u[0].angle,c-=Math.PI,h=u[1].angle,g=u[0].pointx,f=u[0].pointy,m=!0),e.stroke();let T=xo(P.x1,P.y1,P.x2,P.y2,P.cx,P.cy,P.r);if(m){e.beginPath();let t=!1,a=(h-c)*(180/Math.PI);a<0&&(a+=360),(a>180&&!l||a<=180&&l)&&(t=!0),e.arc(g,f,C,c,h,t),e.strokeStyle="blue",e.lineWidth=4,e.stroke(),d=c<0?c+2*Math.PI:c,p=h<0?h+2*Math.PI:h;let i=d*(180/Math.PI);y=p*(180/Math.PI)-i,y<0&&(y+=360),!l&&y>180&&(y=360-y),v=y.toFixed(1)+"Â°"}return e.restore(),{text:v,pos:T}},this.polycurves=function(e,t,a,i){var s=0,n=new pn,o=new pn,l=(this.points[0].x-this.xoffset)*i,c=(this.points[0].y-this.yoffset)*i;for(hn.getCurrentpage().usevectorxml?(l+=hn.getCurrentpage().dxvector,c+=hn.getCurrentpage().dyvector):hn.getCurrentpage().usepdfjs?(l+=hn.getCurrentpage().dxpdf,c+=hn.getCurrentpage().dypdf):(l+=hn.getCurrentpage().dx,c+=hn.getCurrentpage().dy),e.save(),e.strokeStyle=a,e.lineWidth=t*i,e.beginPath(),e.moveTo(l,c),o.x=l,o.y=c,s=1;s<r.points.length;s++)l=(this.points[s].x-this.xoffset)*i,c=(this.points[s].y-this.yoffset)*i,hn.getCurrentpage().usevectorxml?(l+=hn.getCurrentpage().dxvector,c+=hn.getCurrentpage().dyvector):hn.getCurrentpage().usepdfjs?(l+=hn.getCurrentpage().dxpdf,c+=hn.getCurrentpage().dypdf):(l+=hn.getCurrentpage().dx,c+=hn.getCurrentpage().dy),to(s)?(e.moveTo(o.x,o.y),e.quadraticCurveTo(n.x,n.y,l,c),o.x=l,o.y=c):(s+1==r.points.length&&e.lineTo(l,c),n.x=l,n.y=c);e.stroke(),e.restore()},this.dimensionLeader=function(e,t,a,i,s,r,n,o,l,c,h,d){var p=i-t,u=s-a,g=90/(180/Math.PI),f=o/(180/Math.PI),m=Math.atan2(u,p),y=Math.abs(n/Math.cos(f)),v=n/2,x=Math.PI+m,b=x+f,w=x-f,k=x+g,D=x-g,C=i+Math.cos(b)*y,R=s+Math.sin(b)*y,P=i+Math.cos(w)*y,S=s+Math.sin(w)*y,M=i+Math.cos(k)*v,T=s+Math.sin(k)*v,E=i+Math.cos(D)*v,F=s+Math.sin(D)*v,I=i+Math.cos(D)*r,j=s+Math.sin(D)*r,A=t+Math.cos(m)*v,O=a+Math.sin(m)*v,L=i-Math.cos(m)*v,V=s-Math.sin(m)*v,N=m+f,B=m-f,U=m+g,G=m-g,z=t+Math.cos(N)*y,H=a+Math.sin(N)*y,_=t+Math.cos(B)*y,W=a+Math.sin(B)*y,X=t+Math.cos(U)*v,Y=a+Math.sin(U)*v,q=t+Math.cos(G)*v,Z=a+Math.sin(G)*v,J=t+Math.cos(U)*r,K=a+Math.sin(U)*r,$=I+Math.cos(b)*y,Q=j+Math.sin(b)*y,ee=I+Math.cos(w)*y,te=j+Math.sin(w)*y,ae=J+Math.cos(N)*y,ie=K+Math.sin(N)*y,se=J+Math.cos(B)*y,re=K+Math.sin(B)*y;if(e.save(),e.lineWidth=l,e.strokeStyle=d,e.fillStyle=h,9==this.subtype?e.lineCap="butt":e.lineCap="round",e.beginPath(),1==c||3==c?(1==c?e.moveTo(t,a):3==c&&e.moveTo(A,O),e.lineTo(L,V)):0==r?(e.moveTo(t,a),e.lineTo(i,s)):(e.moveTo(J,K),e.lineTo(I,j)),e.stroke(),0==c&&(e.beginPath(),e.moveTo(i,s),e.lineTo(C,R),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(P,S),e.stroke()),1==c&&(e.beginPath(),e.moveTo(i,s),e.lineTo(C,R),e.lineTo(P,S),e.closePath(),e.fill()),2==c&&(e.beginPath(),e.moveTo(t,a),e.lineTo(z,H),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(_,W),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(C,R),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(P,S),e.stroke()),3==c&&(e.beginPath(),e.moveTo(t,a),e.lineTo(z,H),e.lineTo(_,W),e.closePath(),e.fill(),e.lineCap="round",e.beginPath(),e.moveTo(i,s),e.lineTo(C,R),e.lineTo(P,S),e.closePath(),e.fill(),e.lineCap="round"),4==c&&(e.beginPath(),e.moveTo(t,a),0==r?e.lineTo(X,Y):e.lineTo(J,K),e.stroke(),0==r&&(e.beginPath(),e.moveTo(t,a),e.lineTo(q,Z),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(M,T),e.stroke()),e.beginPath(),e.moveTo(i,s),0==r?e.lineTo(E,F):e.lineTo(I,j),e.stroke()),5==c){if(0==r)var ne=t,oe=a,le=i,ce=s,he=z,de=H,pe=_,ue=W,ge=C,fe=R,me=P,ye=S;else ne=J,oe=K,le=I,ce=j,he=ae,de=ie,pe=se,ue=re,ge=$,fe=Q,me=ee,ye=te;e.beginPath(),e.moveTo(ne,oe),e.lineTo(he,de),e.stroke(),e.beginPath(),e.moveTo(ne,oe),e.lineTo(pe,ue),e.stroke(),e.beginPath(),e.moveTo(le,ce),e.lineTo(ge,fe),e.stroke(),e.beginPath(),e.moveTo(le,ce),e.lineTo(me,ye),e.stroke(),e.beginPath(),e.moveTo(t,a),0==r?e.lineTo(X,Y):e.lineTo(J,K),e.stroke(),0==r&&(e.beginPath(),e.moveTo(t,a),e.lineTo(q,Z),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(M,T),e.stroke()),e.beginPath(),e.moveTo(i,s),0==r?e.lineTo(E,F):e.lineTo(I,j),e.stroke()}return e.restore(),{x:J,y:K,w:I,h:j}},this.barhead=function(e,t,a,i,s,r,n,o,l){var c=i-t,h=s-a,d=90/(180/Math.PI),p=Math.atan2(h,c),u=n/2,g=Math.PI+p,f=g+d,m=g-d,y=i+Math.cos(f)*u,v=s+Math.sin(f)*u,x=i+Math.cos(m)*u,b=s+Math.sin(m)*u,w=(Math.cos(p),Math.sin(p),Math.cos(p),Math.sin(p),p+d),k=p-d,D=t+Math.cos(w)*u,C=a+Math.sin(w)*u,R=t+Math.cos(k)*u,P=a+Math.sin(k)*u;e.save(),e.lineCap="round",e.lineWidth=o,e.strokeStyle=l,r.start&&(e.beginPath(),e.moveTo(t,a),e.lineTo(D,C),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(R,P),e.stroke()),r.end&&(e.beginPath(),e.moveTo(i,s),e.lineTo(y,v),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(x,b),e.stroke()),e.restore()},this.getPadding=function(e){return r.padding&&(e.x>r.x?e.xpadding=e.x+r.padding.w:e.x<r.x&&(e.xpadding=e.x-r.padding.w),e.y>r.y?e.ypadding=e.y+r.padding.h:e.y<r.y&&(e.ypadding=e.y-r.padding.h),e.busepadding=!0),e},this.calloutbox=function(e,t,a,i,s,n){if(e.save(),e.lineWidth=s,e.strokeStyle=n,0!=r.pagerotation&&180!=r.pagerotation){var o=r.pagerotation*(Math.PI/180),l=a,c=i;e.translate(l,c),e.rotate(o),e.translate(-l,-c)}e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+t.w,t.y),e.lineTo(t.x+t.w,t.y+t.h),e.lineTo(t.x,t.y+t.h),e.closePath(),e.stroke(),e.restore()},this.arrowhead=function(e,t,a,i,s,r,n,o,l,c,h){var d=i-t,p=s-a,u=n/(180/Math.PI),g=Math.atan2(p,d),f=Math.abs(o/Math.cos(u)),m=Math.PI+g,y=m+u,v=m-u,x=i+Math.cos(y)*f,b=s+Math.sin(y)*f,w=i+Math.cos(v)*f,k=s+Math.sin(v)*f,D=g+u,C=g-u,R=t+Math.cos(D)*f,P=a+Math.sin(D)*f,S=t+Math.cos(C)*f,M=a+Math.sin(C)*f;e.save(),e.lineCap="round",e.lineWidth=l,e.strokeStyle=c,r.start&&(h?(e.beginPath(),e.moveTo(t,a),e.lineTo(R,P),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(S,M),e.closePath(),e.stroke()):(e.beginPath(),e.moveTo(t,a),e.lineTo(R,P),e.lineTo(S,M),e.closePath(),e.fill(),e.lineCap="round")),r.end&&(h?(e.beginPath(),e.moveTo(i,s),e.lineTo(x,b),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(w,k),e.closePath(),e.stroke()):(e.beginPath(),e.moveTo(i,s),e.lineTo(x,b),e.lineTo(w,k),e.closePath(),e.fill())),e.restore()},this.getdrawBox=function(e){var t=r.fixedscaleFactor;return Pn.height,e||(e={x:r.w,y:r.h}),so(e.x,e.y,t,r.arrowTextPos)},this.arrow=function(e,t,a,i,s,n,o,l,c,h,d){var p={repheight:s,repwidth:i,width:i,height:s,arrowl:n},u=i-t,g=s-a,f=Math.atan2(g,u),m=n/2,y=t+Math.cos(f)*m,v=a+Math.sin(f)*m,x=i-Math.cos(f)*m,b=s-Math.sin(f)*m,w={start:!1,end:!1};if(e.save(),e.lineWidth=l,e.strokeStyle=d,e.fillStyle=h,9==this.subtype?e.lineCap="butt":e.lineCap="round",e.beginPath(),1==c||3==c)1==c?e.moveTo(t,a):3==c&&e.moveTo(y,v),e.lineTo(x,b);else if(6==c){var k=r.fixedscaleFactor;k*=dr,Pn.height;var D=so(i,s,k,r.arrowTextPos);e.moveTo(t,a),p=function(e){if(r.saved)switch(r.arrowTextPos){case 1:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;case 2:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;case 3:e.repheight=e.height+e.arrowl,e.repwidth=e.width;break;case 4:e.repheight=e.height-e.arrowl,e.repwidth=e.width}else switch(r.arrowTextPos){case 1:switch(r.pagerotation){case 90:e.repwidth=e.width,e.repheight=e.height-e.arrowl;break;case 270:e.repwidth=e.width,e.repheight=e.height+e.arrowl;break;default:e.repwidth=e.width-e.arrowl,e.repheight=e.height}break;case 2:switch(r.pagerotation){case 90:e.repwidth=e.width,e.repheight=e.height+e.arrowl;break;case 270:e.repwidth=e.width,e.repheight=e.height-e.arrowl;break;default:e.repwidth=e.width+e.arrowl,e.repheight=e.height}break;case 3:switch(r.pagerotation){case 90:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;case 270:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;default:e.repheight=e.height+e.arrowl,e.repwidth=e.width}break;case 4:switch(r.pagerotation){case 90:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;case 270:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;default:e.repheight=e.height-e.arrowl,e.repwidth=e.width}}return e}(p),e.lineTo(p.repwidth,p.repheight),e.lineTo(i,s)}else e.moveTo(t,a),e.lineTo(i,s);e.stroke(),0==c&&(w.end=!0,w.start=!1,r.arrowhead(e,t,a,i,s,w,o,n,l,d,!0)),1==c&&(w.end=!0,w.start=!1,r.arrowhead(e,t,a,i,s,w,o,n,l,d,!1)),2==c&&(w.end=!0,w.start=!0,r.arrowhead(e,t,a,i,s,w,o,n,l,d,!0)),3==c&&(w.end=!0,w.start=!0,r.arrowhead(e,t,a,i,s,w,o,n,l,d,!1)),4==c&&(w.end=!0,w.start=!0,r.barhead(e,t,a,i,s,w,n,l,d)),5==c&&(w.end=!0,w.start=!0,r.arrowhead(e,t,a,i,s,w,o,n,l,d,!0),w.end=!0,w.start=!0,r.barhead(e,t,a,i,s,w,n,l,d)),6==c&&(w.end=!1,w.start=!0,r.arrowhead(e,t,a,p.repwidth,p.repheight,w,o,n,l,d,!0),r.saved?r.padding=void 0:(r.padding={maxx:D.x+D.w,maxy:D.y+D.h,minx:D.x,miny:D.y,w:D.w,h:D.h},r.calloutbox(e,D,i,s,l,d))),e.restore()},this.setdimvaluearea=function(){r.dimarea=0;var e=0,t=0,a="",i=hn.getCurrentpage().scaleObject.AreaUnitlabel,s=hn.getCurrentpage().scaleObject.ndimprecision;r.hasScale&&(i=r.scaleObject.AreaUnitlabel,s=r.scaleObject.ndimprecision,k=r);var n=this.scaling*this.scaling;if(3==this.type)r.dimarea=r.SquareArea(),a=(a=(a=qo(r.dimarea/n)).toFixed(s))+" "+i;else if(0==this.points.length)a="";else{if(r.dimarea=r.PolygonArea(),r.dimarea=qo(r.dimarea/n),r.holes.length>0)for(t=0;t<r.holes.length;t++){e=r.PolygonHoleArea(r.holes[t]);var o=r.holes[t].scaling*r.holes[t].scaling;r.holes[t].dimarea=e,e=qo(r.holes[t].dimarea/o),r.holes[t].dimarea=e,r.dimarea-=e}a=(a=r.dimarea.toFixed(s))+" "+i}return k=null,a},this.setdimvalueperimeter=function(){var e="",t=!1,a=hn.getCurrentpage().scaleObject.Unitofmeasure,i=hn.getCurrentpage().scaleObject.Unitlabel,s=hn.getCurrentpage().scaleObject.ndimprecision;r.hasScale&&(a=r.scaleObject.Unitofmeasure,i=r.scaleObject.Unitlabel,s=r.scaleObject.ndimprecision,k=r);for(var n=0,o=0;o<r.points.length;o++)if(o>0){var l=r.points[o].x-r.points[o-1].x,c=r.points[o].y-r.points[o-1].y;n+=r.getdiag(l,c)}if(l=r.points[0].x-r.points[r.points.length-1].x,c=r.points[0].y-r.points[r.points.length-1].y,n+=r.getdiag(l,c),2==a){mr&&(t=!0);var h=r.setfractionvalue(n)}return e=(e=(e=Qo(n/r.scaling)).toFixed(s))+" "+i,k=null,t&&(e=h),e},this.setdimvaluepolySegments=function(){for(var e=0,t="",a=!1,i=[],s=[],n=hn.getCurrentpage().scaleObject.Unitofmeasure,o=hn.getCurrentpage().scaleObject.Unitlabel,l=0,c=0,h=0,d=0;d<r.points.length;d++)if(d>0){var p=r.points[d].x-r.points[d-1].x,u=r.points[d].y-r.points[d-1].y;e+=r.getdiag(p,u)}for(c=0;c<this.pointlist.length;c++)for(l=0;l<this.pointlist[c].length;l++)l>0&&(p=r.pointlist[c][l].x-r.pointlist[c][l-1].x,u=r.pointlist[c][l].y-r.pointlist[c][l-1].y,i.push(r.getdiag(p,u)),e+=r.getdiag(p,u));for(h=0;h<i.length;h++)if(0==i[h])s.push("");else{if(2==n){mr&&(a=!0);var g=r.setfractionvalue(i[h])}t=(t=(t=Qo(i[h]/r.scaling)).toFixed(be))+" "+o,a&&(t=g),s.push(t)}return 0==e?t="":(2==n&&(mr&&(a=!0),g=r.setfractionvalue(e)),t=(t=(t=Qo(e/r.scaling)).toFixed(be))+" "+o,a&&(t=g)),s.push(t),s},this.getlinelength=function(e,t,a,i){var s=a-e,n=i-t;return r.getdiag(s,n)},this.setdimvaluepoly=function(){var e=0,t="",a=!1,i=hn.getCurrentpage().scaleObject.Unitofmeasure,s=hn.getCurrentpage().scaleObject.Unitlabel,n=hn.getCurrentpage().scaleObject.ndimprecision;r.hasScale&&(i=r.scaleObject.Unitofmeasure,s=r.scaleObject.Unitlabel,n=r.scaleObject.ndimprecision,k=r);for(var o=0;o<r.points.length;o++)if(o>0){var l=r.points[o].x-r.points[o-1].x,c=r.points[o].y-r.points[o-1].y;e+=r.getdiag(l,c)}if(0==e)t="";else{if(2==i){mr&&(a=!0);var h=r.setfractionvalue(e)}t=(t=(t=Qo(e/r.scaling)).toFixed(n))+" "+s,k=null,a&&(t=h)}return t},this.setfractionvalue=function(e){var t=hn.getCurrentpage().scaleObject.SubmeasureUnit;r.hasScale&&(t=r.scaleObject.SubmeasureUnit);var a=Ko(e/this.scaling),i=a.quot,s=a.rem;if(1==t){var n=i+'"';0!=a.numerator&&0!=a.denominator&&(n=a.numerator==a.denominator?i+'"':i+" "+a.numerator+"/"+a.denominator+'"')}return 2==t&&(n=0!=s?i+"' - "+s+'"':i+"'",0!=a.numerator&&0!=a.denominator&&(n=a.numerator==a.denominator?i+"' - "+s+'"':0!=s?i+"' - "+s+" "+a.numerator+"/"+a.denominator+'"':i+"' - "+a.numerator+"/"+a.denominator+'"')),n},this.getunitofmeasure=function(e){yd()||(hn.getCurrentpage().scaleObject.Unitofmeasure,hn.getCurrentpage().scaleObject.Unitlabel)},this.setarcvalue=function(e,t){let a=hn.getCurrentpage().scaleObject.Unitofmeasure,i=hn.getCurrentpage().scaleObject.Unitlabel,s=hn.getCurrentpage().scaleObject.ndimprecision;if(r.hasScale&&(a=r.scaleObject.Unitofmeasure,i=r.scaleObject.Unitlabel,s=r.scaleObject.ndimprecision,k=r),2===a&&mr)this.dimradius=r.setfractionvalue(e),this.dimlength=r.setfractionvalue(t);else{let a=Qo(e/this.scaling),r=Qo(t/this.scaling);this.dimradius=a.toFixed(s)+" "+i,this.dimlength=r.toFixed(s)+" "+i}k=null},this.setdimvalue=function(e,t,a,i){var s=Math.abs(a-e),n=Math.abs(i-t),o=r.getdiag(s,n),l=!1,c=hn.getCurrentpage().scaleObject.Unitofmeasure,h=hn.getCurrentpage().scaleObject.Unitlabel,d=hn.getCurrentpage().scaleObject.ndimprecision;if(r.hasScale&&(c=r.scaleObject.Unitofmeasure,h=r.scaleObject.Unitlabel,d=r.scaleObject.ndimprecision,k=r),2==c){mr&&(l=!0);var p=r.setfractionvalue(o),u=r.setfractionvalue(s),g=r.setfractionvalue(n)}this.dimtext=Qo(o/this.scaling),this.dimtext=this.dimtext.toFixed(d),this.dimtext=this.dimtext+" "+h,this.dimtextx=Qo(s/this.scaling),this.dimtextx=this.dimtextx.toFixed(d),this.dimtextx=this.dimtextx+" "+h,this.dimtexty=Qo(n/this.scaling),this.dimtexty=this.dimtexty.toFixed(d),this.dimtexty=this.dimtexty+" "+h,k=null,l&&(this.dimtext=p,this.dimtextx=u,this.dimtexty=g)},this.getUnitLength=function(e){var t="",a=!1,i=hn.getCurrentpage().scaleObject.Unitofmeasure,s=hn.getCurrentpage().scaleObject.Unitlabel,n=hn.getCurrentpage().scaleObject.ndimprecision;if(r.hasScale&&(i=r.scaleObject.Unitofmeasure,s=r.scaleObject.Unitlabel,n=r.scaleObject.ndimprecision,k=r),2==i){mr&&(a=!0);var o=r.setfractionvalue(e)}return t=(t=(t=Qo(e/this.scaling)).toFixed(n))+" "+s,a&&(t=o),k=null,t},this.customlabeldraw=function(e,t,a,i,s,n,o){e.textAlign="start",r.font.setScale(o),e.font=r.font.fontstringScaled;var l=e.measureText(dimtext).width,c=n;a+=r.labeloffsetx*o,i+=r.labeloffsety*o,a-=l/2,i+=c/2,e.lineWidth=1,e.strokeStyle=s,e.fillStyle="white",e.fillRect(a-10*o,i-20*o,l+20*o,n+15*o),e.strokeRect(a-10*o,i-20*o,l+20*o,n+15*o)},this.insidelabel=function(e,t){var a=!1;return!r.busecustomlabel&&1==r.subtype||$r||r.hidevaluelabel||e>r.labelRect.x&&e<r.labelRect.x+r.labelRect.w&&t>r.labelRect.y&&t<r.labelRect.y+r.labelRect.h&&(a=!0),a},this.areavaluedraw=function(e,t,a,i,s,n,o,l){e.textAlign="start",Ti&&(o=1),r.font.setScale(o),e.font=r.font.fontstringScaled;var c=r.font.height/12,h=10*c,d=20*c,p=20*c,u=15*c,g=e.measureText(t).width,f=n,m=r.font.height*o;Ti?(a+=1*r.labeloffsetx,i+=1*r.labeloffsety):(a+=r.labeloffsetx*l,i+=r.labeloffsety*l),a-=g/2,i+=f/2,e.lineWidth=1,e.strokeStyle=s,e.fillStyle=r.labelfillcolor,r.labelRect.x=a-h*o,r.labelRect.y=i-d*o,r.labelRect.w=g+p*o,r.labelRect.h=m+u*o,e.fillRect(a-h*o,i-d*o,g+p*o,m+u*o),e.strokeRect(a-h*o,i-d*o,g+p*o,m+u*o),e.fillStyle="black",e.fillText(t,a,i)},this.anglevaluedraw=function(e,t,a,i,s,n){if(!r.hidevaluelabel){e.save(),e.textAlign="start",r.font.setScale(n);var o=r.font.height*n;this.textheight=r.font.height;var l=r.font.height/12,c=10*l,h=5*l,d=20*l,p=10*l;e.font=r.font.fontstringScaled;var u=e.measureText(this.dimtext).width;if(r.saved)var g=t.x-u/2,f=t.y+o/2;else g=a+15*n,f=i;e.lineWidth=1;var m=f-o;e.fillStyle="white",e.strokeStyle=this.strokecolor,e.fillRect(g-c*n,m-h*n,u+d*n,o+p*n),e.strokeRect(g-c*n,m-h*n,u+d*n,o+p*n),R.w=u+d*n,R.h=o+p*n,e.fillStyle="black",e.fillText(this.dimtext,g,f),e.restore()}},this.dimvaluedraw=function(e,t,a,i,s,n,o,l){if(!r.hidevaluelabel){e.save(),Ti&&(o=1);var c=i-t,h=s-a;3==r.type&&(c=i,h=s),r.getdiag(c,h);var d=Math.atan2(h,c);e.textAlign="start",r.font.setScale(o);var p=r.font.height*o;this.textheight=r.font.height;var u=r.font.height/12,g=10*u,f=5*u,m=20*u,y=10*u;e.font=r.font.fontstringScaled;var v=e.measureText(this.dimtext).width;if(r.saved)var x=t+c/2-v/2,b=a+h/2+p/2;else x=i+15*o,b=s,3==r.type&&(x=i+t+15*o,b=s+a);if((d>.5*Math.PI||d<-.5*Math.PI)&&0==r.pagerotation&&(d+=Math.PI),l&&r.saved){var w=t+c/2,k=a+h/2;e.translate(w,k),e.rotate(d),e.translate(-w,-k)}e.lineWidth=1;var D=b-p;e.fillStyle="white",e.strokeStyle=this.strokecolor,e.fillRect(x-g*o,D-f*o,v+m*o,p+y*o),e.strokeRect(x-g*o,D-f*o,v+m*o,p+y*o),R.w=v+m*o,R.h=p+y*o,e.fillStyle="black",e.fillText(this.dimtext,x,b),e.restore()}},this.roundedRect=function(e,t,a,i,s,n,o,l,c,h,d,p){var u=Math.min(t,t+i),g=Math.min(a,a+s),f=Math.max(t,t+i),m=Math.max(a,a+s);if(e.save(),e.strokeStyle=p,e.fillStyle=d,e.lineWidth=l,0!=n){var y=t+i/2,v=a+s/2;e.translate(y,v),e.rotate(r.rotation),e.translate(-y,-v)}e.beginPath(),e.moveTo(u+o,g),e.lineTo(f-o,g),e.arcTo(f,g,f,g+o,o),e.lineTo(f,m-o),e.arcTo(f,m,f-o,m,o),e.lineTo(u+o,m),e.arcTo(u,m,u,m-o,o),e.lineTo(u,g+o),e.arcTo(u,g,u+o,g,o),c&&e.fill(),h&&e.stroke(),e.restore()},this.newcloud=function(e,t,a,i,s,n,o,l,c,h,d){if(0!=i&&0!=s){(i<=0||s<=0)&&(i<0&&(t+=i,i=Math.abs(i)),s<0&&(a+=s,s=Math.abs(s)));var p,u,g=2*n,f=Math.floor(i/g),m=Math.floor(s/g),y=!1,v=1,x=1,b=8,w=i/b,k=s/w;k<6&&(k=6,b=i/(w=s/6));var D=w,C=2*D;if(p=C*(f=Math.floor(i/C)),u=C*(m=Math.floor(s/C)),e.save(),e.strokeStyle=d,e.fillStyle=h,e.lineWidth=o,0!=r.rotation){var R=t+i/2,P=a+s/2;e.translate(R,P),e.rotate(r.rotation),e.translate(-R,-P)}i>p&&(v=i/p,y=!0),s>u&&(x=s/u,y=!0),y&&(e.translate(t,a),e.scale(v,x),e.translate(-t,-a)),e.beginPath(),e.arc(t+D,a+D,D,.5*Math.PI,0,!1);for(var S=2;S<f;S++){var M=t+D+C*(S-1);e.arc(M,a+D,D,Math.PI,0,!1)}for(e.arc(t+p-D,a+D,D,Math.PI,.5*Math.PI,!1),S=2;S<m;S++){var T=a+D+C*(S-1);e.arc(t+p-D,T,D,1.5*Math.PI,.5*Math.PI,!1)}for(e.arc(t+p-D,a+u-D,D,1.5*Math.PI,Math.PI,!1),S=f-1;S>1;S--){var E=t+D+C*(S-1);e.arc(E,a+u-D,D,0,Math.PI,!1)}for(e.arc(t+D,a+u-D,D,0,1.5*Math.PI,!1),S=m-1;S>1;S--){var F=a+D+C*(S-1);e.arc(t+D,F,D,.5*Math.PI,1.5*Math.PI,!1)}l&&e.fill(),c&&e.stroke(),e.restore()}},this.cloud=function(e,t,a,i,s,n,o,l,c,h,d){var p=2*n,u=Math.floor(i/p),g=Math.floor(s/p),f=p*u,m=p*g;if(e.save(),e.strokeStyle=d,e.fillStyle=h,e.lineWidth=o,0!=r.rotation){var y=t+i/2,v=a+s/2;e.translate(y,v),e.rotate(r.rotation),e.translate(-y,-v)}if(e.beginPath(),i<2*p&&s<2*p)e.arc(t+n,a+n,i/2,0,2*Math.PI,!1);else{if(e.moveTo(t+n,a+p),e.arc(t+n,a+n,n,.5*Math.PI,0,!1),u>2)for(var x=2;x<u;x++){var b=t+n+p*(x-1);e.arc(b,a+n,n,Math.PI,0,!1)}if(e.arc(t+f-n,a+n,n,Math.PI,.5*Math.PI,!1),g>2)for(x=2;x<g;x++){var w=a+n+p*(x-1);e.arc(t+f-n,w,n,1.5*Math.PI,.5*Math.PI,!1)}if(e.arc(t+f-n,a+m-n,n,1.5*Math.PI,Math.PI,!1),u>2)for(x=u-1;x>1;x--){var k=t+n+p*(x-1);e.arc(k,a+m-n,n,0,Math.PI,!1)}if(e.arc(t+n,a+m-n,n,0,1.5*Math.PI,!1),g>2)for(x=g-1;x>1;x--){var D=a+n+p*(x-1);e.arc(t+n,D,n,.5*Math.PI,1.5*Math.PI,!1)}}l&&e.fill(),c&&e.stroke(),e.restore()},this.markpolygon=function(e,t){var a=0;e.save(),e.fillStyle="rgba(236, 236, 236, 0.5)";var i=0,s=0,n=ro(r.pagenumber);if(13==r.type)for(a=0,a=0;a<r.countshapes.length;a++){i=(r.countshapes[a].x-this.xoffset)*t,s=(r.countshapes[a].y-this.yoffset)*t,i+=n.x,s+=n.y;var o=r.outerRadius*r.fixedscaleFactor;Ti&&(o=r.outerRadius),e.beginPath(),e.arc(i,s,o+3,0,2*Math.PI,!1),e.closePath(),e.fill()}e.restore()},this.editpolygonhole=function(e,t,a){var i=0;e.save(),e.strokeStyle="red",e.fillStyle="white",e.lineWidth=1;var s=0,n=0,o=ro(r.pagenumber);for(i=0;i<a.points.length;i++){s=(a.points[i].x-a.xoffset)*t,n=(a.points[i].y-a.yoffset)*t,s+=o.x,n+=o.y;var l=a.editcurpoint+1>a.points.length-1&&0==i;a.bpointEdit&&(a.editcurpoint==i||a.editcurpoint+1==i||l)?(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10),e.restore()):(e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10))}e.restore()},this.editpolygon=function(e,t){var a=0,i=0;e.save(),e.strokeStyle="red",e.fillStyle="white",e.lineWidth=1;var s=0,n=0,o=0,l=0,c=0,h=0,d=0,p=0,u=ro(r.pagenumber);if(14==r.type){o=(r.startX-this.xoffset)*t,l=(r.startY-this.yoffset)*t,o+=u.x,l+=u.y,c=(r.secondX-this.xoffset)*t,h=(r.secondY-this.yoffset)*t,c+=u.x,h+=u.y;var g=null==r.endX&&null==r.endY;g||(d=(r.endX-this.xoffset)*t,p=(r.endY-this.yoffset)*t,d+=u.x,p+=u.y),e.fillRect(o-5,l-5,10,10),e.strokeRect(o-5,l-5,10,10),e.fillRect(c-5,h-5,10,10),e.strokeRect(c-5,h-5,10,10),g||(e.fillRect(d-5,p-5,10,10),e.strokeRect(d-5,p-5,10,10))}for(a=0;a<r.points.length;a++){s=(this.points[a].x-this.xoffset)*t,n=(this.points[a].y-this.yoffset)*t,s+=u.x,n+=u.y;var f=1==this.type&&(1==this.subtype||3==this.subtype),m=(r.points.length,r.editcurpoint+1>r.points.length-1),y=!f&&m&&0==a,v=f&&m;!r.bpointEdit||r.editcurpoint!=a&&r.editcurpoint+1!=a&&!y||v?(e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10)):(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10),e.restore())}if(1==this.type&&6==this.subtype)for(i=0;i<this.pointlist.length;i++)for(a=0;a<this.pointlist[i].length;a++)s=(this.pointlist[i][a].x-this.xoffset)*t,n=(this.pointlist[i][a].y-this.yoffset)*t,s+=u.x,n+=u.y,y=(m=r.editcurpoint+1>this.pointlist[i].length-1)&&0==a,v=m,!r.bpointEdit||r.editcurpoint!=a&&r.editcurpoint+1!=a&&!y||v?(e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10)):(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(s-5,n-5,10,10),e.strokeRect(s-5,n-5,10,10),e.restore());if(13==r.type)for(a=0,a=0;a<r.countshapes.length;a++){s=(r.countshapes[a].x-this.xoffset)*t,n=(r.countshapes[a].y-this.yoffset)*t,s+=u.x,n+=u.y;var x=r.outerRadius*r.fixedscaleFactor;Ti&&(x=r.outerRadius),e.strokeStyle="blue",e.beginPath(),e.arc(s,n,x+3,0,2*Math.PI,!1),e.closePath(),e.stroke()}e.restore()},this.selectLabel=function(e,t,a,i,s,r,n){e.save(),e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,e.beginPath();var o=t+(i-t)/2,l=a+(s-a)/2;e.arc(o,l,10,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),e.restore()},this.mark=function(e,t,a,i,s,n,o){var l=t+(i-t)/2,c=a+(s-a)/2;e.save(),e.fillStyle=hs,0!=r.rotation&&(e.translate(l,c),e.rotate(r.rotation),e.translate(-l,-c)),e.beginPath(),e.moveTo(t,a),e.lineTo(i,a),e.lineTo(i,s),e.lineTo(t,s),e.closePath(),e.fill(),e.restore()},this.select=function(e,t,a,i,s,n,o){Ei&&(o=!Ei);var l=Math.min(t,i),c=Math.min(a,s),h=Math.max(t,i),d=Math.max(a,s),p=ti/2,u=ai/2;if(oo()){var g=Hl();p*=g,u*=g}var f=hn.getCurrentpage().getpageRotation()*(Math.PI/180),m=(Math.PI,10),y=new pn,v=new pn;y.x=t,y.y=a,v.x=i,v.y=s;var x=t+(i-t)/2,b=a+(s-a)/2;if(0!=hn.getCurrentpage().getpageRotation()&&(y=r.getRotatedMarkup(p,u,t,a,f),v=r.getRotatedMarkup(p,u,i,s,f)),e.save(),n){if(0!=r.textrotate&&9==r.type&&0==r.subtype&&(e.translate(t,a),e.rotate(r.textrotate),e.translate(-t,-a)),0!=r.rotation){if(e.translate(x,b),e.rotate(r.rotation),e.translate(-x,-b),9==r.type&&0==r.subtype){b=a-(a-s)/2;var w=(s-a)/2;if(0!=r.textrotate){var k=r.getMarkupSelectPointRot((i-t)/2,-(s-a)/2,r.rotation),D=r.getMarkupSelectPointRot(k.x,k.y,r.textrotate),C=r.getMarkupSelectPointRot((i-t)/2,w,r.textrotate);x=t+C.x,b=a+C.y,this.LowerRightRectRot.x=x+D.x-m,this.LowerRightRectRot.y=b+D.y-m,this.LowerRightRectRot.w=x+D.x+m,this.LowerRightRectRot.h=b+D.y+m}else{var R=r.getMarkupSelectPointRot(-(i-t)/2,- -(s-a)/2,r.rotation);this.UpperLeftRectRot.x=x+R.x-m,this.UpperLeftRectRot.y=b+R.y-m,this.UpperLeftRectRot.w=x+R.x+m,this.UpperLeftRectRot.h=b+R.y+m,k=r.getMarkupSelectPointRot((i-t)/2,-(s-a)/2,r.rotation),this.LowerRightRectRot.x=x+k.x-m,this.LowerRightRectRot.y=b+k.y-m,this.LowerRightRectRot.w=x+k.x+m,this.LowerRightRectRot.h=b+k.y+m}}else{R=r.getMarkupSelectPointRot(-(i-t)/2,-(s-a)/2,r.rotation),this.UpperLeftRectRot.x=x+R.x-m,this.UpperLeftRectRot.y=b+R.y-m,this.UpperLeftRectRot.w=x+R.x+m,this.UpperLeftRectRot.h=b+R.y+m,k=r.getMarkupSelectPointRot((i-t)/2,(s-a)/2,r.rotation),this.LowerRightRectRot.x=x+k.x-m,this.LowerRightRectRot.y=b+k.y-m,this.LowerRightRectRot.w=x+k.x+m,this.LowerRightRectRot.h=b+k.y+m;var P=r.getMarkupSelectPointRot(-(i-t)/2,(s-a)/2,r.rotation);this.LowerLeftRectRot.x=x+P.x-m,this.LowerLeftRectRot.y=b+P.y-m,this.LowerLeftRectRot.w=x+P.x+m,this.LowerLeftRectRot.h=b+P.y+m;var S=r.getMarkupSelectPointRot((i-t)/2,-(s-a)/2,r.rotation);this.UpperRightRectRot.x=x+S.x-m,this.UpperRightRectRot.y=b+S.y-m,this.UpperRightRectRot.w=x+S.x+m,this.UpperRightRectRot.h=b+S.y+m}if(0!=hn.getCurrentpage().getpageRotation()){var M=r.getRotatedMarkup(p,u,this.UpperLeftRectRot.x,this.UpperLeftRectRot.y,f),T=r.getRotatedMarkup(p,u,this.UpperLeftRectRot.w,this.UpperLeftRectRot.h,f);this.UpperLeftRectRot.x=Math.min(M.x,T.x),this.UpperLeftRectRot.y=Math.min(M.y,T.y),this.UpperLeftRectRot.w=Math.max(M.x,T.x),this.UpperLeftRectRot.h=Math.max(M.y,T.y);var E=r.getRotatedMarkup(p,u,this.UpperRightRectRot.x,this.UpperRightRectRot.y,f),F=r.getRotatedMarkup(p,u,this.UpperRightRectRot.w,this.UpperRightRectRot.h,f);this.UpperRightRectRot.x=Math.min(E.x,F.x),this.UpperRightRectRot.y=Math.min(E.y,F.y),this.UpperRightRectRot.w=Math.max(E.x,F.x),this.UpperRightRectRot.h=Math.max(E.y,F.y);var I=r.getRotatedMarkup(p,u,this.LowerLeftRectRot.x,this.LowerLeftRectRot.y,f),j=r.getRotatedMarkup(p,u,this.LowerLeftRectRot.w,this.LowerLeftRectRot.h,f);this.LowerLeftRectRot.x=Math.min(I.x,j.x),this.LowerLeftRectRot.y=Math.min(I.y,j.y),this.LowerLeftRectRot.w=Math.max(I.x,j.x),this.LowerLeftRectRot.h=Math.max(I.y,j.y);var A=r.getRotatedMarkup(p,u,this.LowerRightRectRot.x,this.LowerRightRectRot.y,f),O=r.getRotatedMarkup(p,u,this.LowerRightRectRot.w,this.LowerRightRectRot.h,f);this.LowerRightRectRot.x=Math.min(A.x,O.x),this.LowerRightRectRot.y=Math.min(A.y,O.y),this.LowerRightRectRot.w=Math.max(A.x,O.x),this.LowerRightRectRot.h=Math.max(A.y,O.y)}if(o){if(w=(d-c)/2,9==r.type&&0==r.subtype)if(0==r.textrotate)var L=r.getMarkupSelectPointRot(0,- -(w-20),r.rotation);else{L=r.getMarkupSelectPointRot(0,- -(w-20),r.rotation),L=r.getMarkupSelectPointRot(L.x,L.y,r.textrotate);var V=r.getMarkupSelectPointRot((h-l)/2,w,r.textrotate);r.getMarkupSelectPointRot((h-l)/2,w,r.rotation),x=l+V.x,b=c+V.y}else L=r.getMarkupSelectPointRot(0,-((d-c)/2+20),r.rotation);if(this.RotmarkerRectRot.x=x+L.x-m,this.RotmarkerRectRot.y=b+L.y-m,this.RotmarkerRectRot.w=x+L.x+m,this.RotmarkerRectRot.h=b+L.y+m,0!=hn.getCurrentpage().getpageRotation()){var N=r.getRotatedMarkup(p,u,this.RotmarkerRectRot.x,this.RotmarkerRectRot.y,f),B=r.getRotatedMarkup(p,u,this.RotmarkerRectRot.w,this.RotmarkerRectRot.h,f);this.RotmarkerRectRot.x=Math.min(N.x,B.x),this.RotmarkerRectRot.y=Math.min(N.y,B.y),this.RotmarkerRectRot.w=Math.max(N.x,B.x),this.RotmarkerRectRot.h=Math.max(N.y,B.y)}}}if(9==r.type&&0==r.subtype?0==r.textrotate?(this.LowerLeftRect.x=t-m,this.LowerLeftRect.y=a-m,this.LowerLeftRect.w=t+m,this.LowerLeftRect.h=a+m,this.LowerRightRect.x=i-m,this.LowerRightRect.y=a-m,this.LowerRightRect.w=i+m,this.LowerRightRect.h=a+m,this.UpperRightRect.x=i-m,this.UpperRightRect.y=s-m,this.UpperRightRect.w=i+m,this.UpperRightRect.h=s+m,this.UpperLeftRect.x=t-m,this.UpperLeftRect.y=s-m,this.UpperLeftRect.w=t+m,this.UpperLeftRect.h=s+m):(k=r.getMarkupSelectPointRot(i-t,0,r.textrotate),this.LowerRightRect.x=t+k.x-m,this.LowerRightRect.y=a+k.y-m,this.LowerRightRect.w=t+k.x+m,this.LowerRightRect.h=a+k.y+m,0!=hn.getCurrentpage().getpageRotation()&&(this.LowerRightRect.x=this.rotatedrect.w-m,this.LowerRightRect.y=this.rotatedrect.y-m,this.LowerRightRect.w=this.rotatedrect.w+m,this.LowerRightRect.h=this.rotatedrect.y+m)):(this.UpperLeftRect.x=y.x-m,this.UpperLeftRect.y=y.y-m,this.UpperLeftRect.w=y.x+m,this.UpperLeftRect.h=y.y+m,this.LowerLeftRect.x=y.x-m,this.LowerLeftRect.y=v.y-m,this.LowerLeftRect.w=y.x+m,this.LowerLeftRect.h=v.y+m,this.UpperRightRect.x=v.x-m,this.UpperRightRect.y=y.y-m,this.UpperRightRect.w=v.x+m,this.UpperRightRect.h=y.y+m,this.LowerRightRect.x=v.x-m,this.LowerRightRect.y=v.y-m,this.LowerRightRect.w=v.x+m,this.LowerRightRect.h=v.y+m),e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,10!=r.type&&(11!=r.type&&20!=r.type||3!=r.subtype&&5!=r.subtype?(e.beginPath(),e.arc(t,a,m,0,2*Math.PI,!1),e.moveTo(t+m,s),e.arc(t,s,m,0,2*Math.PI,!1),e.moveTo(i+m,a),e.arc(i,a,m,0,2*Math.PI,!1),e.moveTo(i+m,s),e.arc(i,s,m,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()):(e.lineWidth=3,e.beginPath(),e.moveTo(t-3,a-3),e.lineTo(i+3,a-3),e.lineTo(i+3,s+3),e.lineTo(t-3,s+3),e.closePath(),e.stroke())),e.strokeStyle="red",e.strokeRect((t+i)/2-3,a-3,6,6),e.strokeRect(t-3,(s+a)/2-3,6,6),e.strokeRect(i-3,(s+a)/2-3,6,6),e.strokeRect((i+t)/2-3,s-3,6,6),o&&(9==r.type&&0==r.subtype?(e.beginPath(),e.moveTo(h/2,d-3),e.lineTo(h/2,d-15),e.closePath(),e.stroke(),e.strokeStyle="blue",e.lineWidth=1,e.beginPath(),e.arc(h/2,d-20,m,0,2*Math.PI,!1),e.stroke(),0==r.textrotate?(this.RotmarkerRect.x=h/2-m,this.RotmarkerRect.y=d-20-m,this.RotmarkerRect.w=h/2+m,this.RotmarkerRect.h=d-20+m):(L=r.getMarkupSelectPointRot((h-l)/2,-(c-d+20),r.textrotate),this.RotmarkerRect.x=l+L.x-m,this.RotmarkerRect.y=c+L.y-m,this.RotmarkerRect.w=l+L.x+m,this.RotmarkerRect.h=c+L.y+m)):(e.beginPath(),e.moveTo((l+h)/2,c-3),e.lineTo((l+h)/2,c-15),e.closePath(),e.stroke(),e.strokeStyle="blue",e.lineWidth=1,e.beginPath(),e.arc((l+h)/2,c-20,m,0,2*Math.PI,!1),e.fill(),e.stroke(),this.RotmarkerRect.x=(l+h)/2-m,this.RotmarkerRect.y=c-20-m,this.RotmarkerRect.w=(l+h)/2+m,this.RotmarkerRect.h=c-20+m),0!=hn.getCurrentpage().getpageRotation())){var U=r.getRotatedMarkup(p,u,this.RotmarkerRect.x,this.RotmarkerRect.y,f),G=r.getRotatedMarkup(p,u,this.RotmarkerRect.w,this.RotmarkerRect.h,f);this.RotmarkerRect.x=Math.min(U.x,G.x),this.RotmarkerRect.y=Math.min(U.y,G.y),this.RotmarkerRect.w=Math.max(U.x,G.x),this.RotmarkerRect.h=Math.max(U.y,G.y)}}else e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,e.beginPath(),e.arc(t,a,m,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),6==this.type&&6==this.subtype||(e.beginPath(),e.arc(i,s,m,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.fill());e.restore()},this.setAnglelengthPoints=function(e,t){var a=r.points.length-2;return r.setAngleLengthinternalPoints(e,t,!0,a)},this.setWidthHeight=function(e,t){var a=e*r.scaling,i=t*r.scaling;return{w:Zo(a),h:Zo(i)}},this.setWidthHeightEdit=function(e,t){return r.setWidthHeight(e,t)},this.setAnglelengthUnscaled=function(e,t,a,i){return r.setAngleLengthinternalUnscaled(e,t,a,i,!0)},this.setAnglelength=function(e,t,a){return r.setAngleLengthinternal(e,t,a,!0)},this.setAngleLenghtEdit=function(e,t,a){return r.setAngleLengthinternal(e,t,a,!1)},this.setAngleLengthPointsEdit=function(e,t){var a=r.editcurpoint;return r.bpointEdit=!0,r.setAngleLengthinternalPoints(e,t,!1,a)},this.setAngleLengthinternalPoints=function(e,t,a,i){if(i>=0&&i<=this.points.length-1){var s=1==this.type&&(1==this.subtype||3==this.subtype),n=ti/2,o=ai/2,l=(360-hn.getCurrentpage().getpageRotation())*(Math.PI/180);hn.getCurrentpage().getpageRotation(),Math.PI,t>0?t*=-1:t=360-t,a||(t+=360-hn.getCurrentpage().getpageRotation())>360&&(t-=360);var c=Zo(e*r.scaling),h=t*(Math.PI/180),d=r.points[0].x,p=r.points[0].y,u=r.points[i].x+c*Math.cos(h),g=r.points[i].y+c*Math.sin(h);if(r.bUsemouseinput=!1,0!=hn.getCurrentpage().getpageRotation()&&a){var f=r.setinitRotatedMarkupPoint(n,o,r.points[i].x,r.points[i].y,l);r.points[i].x=f.x,r.points[i].y=f.y,u=(f=r.setinitRotatedMarkupPoint(n,o,u,g,l)).x,g=f.y}return i==r.points.length-1?(r.editcurpoint=0,s&&(u=d,g=p)):r.editcurpoint=i+1,{w:u,h:g,p:r.editcurpoint}}},this.setAngleLengthinternalUnscaled=function(e,t,a,i,s){hn.getCurrentpage().getpageRotation(),Math.PI,hn.getCurrentpage().getpageRotation(),Math.PI,a>0?a*=-1:a=360-a,s||(a+=360-hn.getCurrentpage().getpageRotation())>360&&(a-=360);var r=a*(Math.PI/180);return{w:e.x+t*Math.cos(r),h:e.y+t*Math.sin(r)}},this.setAngleLengthinternal=function(e,t,a,i){var s=ti/2,n=ai/2,o=(360-hn.getCurrentpage().getpageRotation())*(Math.PI/180);hn.getCurrentpage().getpageRotation(),Math.PI,t>0?t*=-1:t=360-t,i||(t+=360-hn.getCurrentpage().getpageRotation())>360&&(t-=360);var l=Zo(e*r.scaling),c=t*(Math.PI/180),h=this.x+l*Math.cos(c),d=this.y+l*Math.sin(c);if(r.bUsemouseinput=!1,0!=hn.getCurrentpage().getpageRotation()&&i){var p=r.setinitRotatedMarkupPoint(s,n,this.x,this.y,o);this.x=p.x,this.y=p.y,h=(p=r.setinitRotatedMarkupPoint(s,n,h,d,o)).x,d=p.y}return{w:h,h:d}},this.lengthangleCallbackSelect=function(){r.anglelengthsupport&&r.lengthangleCallback(this.x,this.y,this.w,this.h,hn.getCurrentpage().getpageRotation()),r.setRadiusSupport&&r.radiusCallback(this.x,this.y,this.w,this.h,!0),r.setPointSupport&&r.lengthangleCallbackPointSelect(),r.widthHeightsupport&&r.widthHeightCallback(this.w,this.h)},this.lengthangleCallbackPointSelect=function(){if(!(this.points.length<2)){var e=hn.getCurrentpage().getpageRotation();if(0==r.editcurpoint?r.points.length:r.editcurpoint,r.editcurpoint==r.points.length-1)var t=0;else t=r.editcurpoint+1;var a=this.points[r.editcurpoint].x,i=this.points[r.editcurpoint].y,s=this.points[t].x,n=this.points[t].y,o=r.anglelength(a,i,s,n,!1);o.length=Qo(o.length/r.scaling),null!=Ya&&(r.bUsemouseinput||(o.angle-=e),Ya.onDrawEvent(o))}},this.lengthangleCallbackPoints=function(e){if(!(this.points.length<2)){var t=this.points[this.points.length-2].x,a=this.points[this.points.length-2].y,i=this.points[this.points.length-1].x,s=this.points[this.points.length-1].y,n=r.anglelength(t,a,i,s,!1);n.length=Qo(n.length/r.scaling),null!=Ya&&(r.bUsemouseinput||(n.angle-=e),Ya.onDrawEvent(n))}},this.widthHeightCallback=function(e,t){var a={width:e,height:t};a.width=Qo(e/r.scaling),a.height=Qo(t/r.scaling),null!=Ya&&Ya.onDrawEvent(a)},this.lengthangleCallback=function(e,t,a,i,s){var n=r.anglelength(e,t,a,i,!1);n.length=Qo(n.length/r.scaling),null!=Ya&&(r.bUsemouseinput||(n.angle-=s),Ya.onDrawEvent(n))},this.radiusCallback=function(e,t,a,i,s){var n=r.anglelength(e,t,a,i,s);n.length=Qo(n.length/r.scaling),null!=Ya&&Ya.onDrawEvent(n)},this.anglelength=function(e,t,a,i,s){var r=0,n=0;r=Math.abs(a-e),n=Math.abs(i-t);var o=Math.pow(r,2),l=Math.pow(n,2),c=Math.sqrt(o+l);s?(r=Math.abs(a-e),n=Math.abs(i-t)):(r=a-e,n=i-t);var h=Math.atan2(n,r)*(180/Math.PI);return h<0?h*=-1:h=360-h,{length:c,angle:h}},this.drawme=function(e){var t=lo();switch(b=!0,r.fixedscaleFactor=t/hn.getCurrentpage().fixedScale,r.bUseFixedScale?(this.linewidth,r.fixedscaleFactor):this.linewidth,r.bUseFixedScale?(this.arrowlength,r.fixedscaleFactor):this.arrowlength,Ti&&(this.linewidth,this.arrowlength),this.type){case 0:this.drawmescaled(e);break;case 1:var a=r.setDimDrawme();if(this.setlastpoint(a.w,a.h),r.bUsemouseinput&&this.AdjustForRotation(!1),Vs){var i=r.getlastpoint(),s=r.getprevpoint();if(i&&s){var n=r.calculateOrthoDraw({x:s.x,y:s.y},{x:i.x,y:i.y});r.setlastpoint(n.w,n.h)}}r.lengthangleCallbackPoints(hn.getCurrentpage().getpageRotation()),this.drawmescaled(e);break;case 2:switch(this.subtype){case 1:r.polycurves(e,r.linewidth,r.color,1)}break;case 3:a=r.setDimDrawme(),6==this.subtype&&(this.w=a.w,this.h=a.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),r.widthHeightCallback(this.w,this.h),this.drawmescaled(e);break;case 4:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),1==this.subtype&&r.radiusCallback(this.x,this.y,this.w,this.h,!0),this.drawmescaled(e);break;case 5:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),this.drawmescaled(e);break;case 6:a=r.setDimDrawme(),this.w=a.w,this.h=a.h,r.bUsemouseinput&&this.AdjustForRotation(!1),Vs&&(i=r.calculateOrthoDraw({x:this.x,y:this.y},{x:this.w,y:this.h}),this.w=i.w,this.h=i.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,r.lengthangleCallback(this.x,this.y,this.w,this.h,hn.getCurrentpage().getpageRotation()),this.setTextboxConnectionPointDraw(),this.drawmescaled(e);break;case 7:a=r.setDimDrawme(),this.w=a.w,this.h=a.h,r.bUsemouseinput&&this.AdjustForRotation(!1),Vs&&(i=r.calculateOrthoDraw({x:this.x,y:this.y},{x:this.w,y:this.h}),this.w=i.w,this.h=i.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,r.lengthangleCallback(this.x,this.y,this.w,this.h,hn.getCurrentpage().getpageRotation()),this.drawmescaled(e);break;case 8:a=r.setDimDrawme(),this.setlastpoint(a.w,a.h),r.bUsemouseinput&&this.AdjustForRotation(!1),Vs&&(i=r.getlastpoint(),s=r.getprevpoint(),i&&s&&(n=r.calculateOrthoDraw({x:s.x,y:s.y},{x:i.x,y:i.y}),r.setlastpoint(n.w,n.h))),r.lengthangleCallbackPoints(hn.getCurrentpage().getpageRotation()),this.drawmescaled(e);break;case 9:e.font=this.font.fontstring;var o=e.measureText(this.text);this.textwidth=o.width,this.w=this.textwidth,this.h=this.textheight,e.textAlign="start",e.fillStyle=r.fillcolor,1==this.subtype||2==this.subtype?(r.Rect(e,this.x,this.y,this.w,this.h,this.linewidth,!0,!0,r.fillcolor,r.strokecolor),e.fillText(this.text,this.x+10,this.y+this.h+10)):(e.fillText(this.text,this.x,this.y),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h);break;case 10:on&&(this.w=ln.width,this.h=ln.height,r.bUseFixedScale?e.drawImage(ln,this.x,this.y,this.w*r.fixedscaleFactor,this.h*r.fixedscaleFactor):e.drawImage(ln,this.x,this.y,this.w,this.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h);break;case 11:this.w=this.image.width,this.h=this.image.height,r.imageloaded&&e.drawImage(this.image,this.x,this.y,this.w,this.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h;break;case 12:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),this.drawmescaled(e);break;case 13:this.AdjustForRotation(!1),this.drawmescaled(e);break;case 14:a=r.setDimDrawme(),this.endX=a.w,this.endY=a.h,this.AdjustForRotation(!1),this.drawmescaled(e)}},this.isdrawn=function(){return b},this.offscreendrawdim=function(e){if(!b){x=co(e),x=!1;var t=function(e){if(null==e)return 1;var t=e.dscale;return e.usevectorxml?t=e.dscalevector:e.usepdfjs?t=e.curpagescale*e.dscalepdf:(t=e.dscale,0==hn.Type&&(t=e.dscale)),e.usevector3Dxml&&(t=1),t}(e),a=function(e){return e.fixedScale}(e);r.setFirstdrawDim(t,a,x),b=!0}},this.getrect=function(){var e=hn.getPageObject(this.pagenumber),t=(this.x-e.dxpdf)/(e.curpagescale*e.dscalepdf),a=-((this.y-e.dypdf)/(e.curpagescale*e.dscalepdf)-e.pdfpageheight),i=(this.w-e.dxpdf)/(e.curpagescale*e.dscalepdf),s=(e.pdfpageheight-this.h)*(e.curpagescale*e.dscalepdf)+e.dypdf,r=i-t,n=s-a;if(0==this.type)var o={top:a,right:r,bottom:n,left:t};else 9==this.type&&(o={top:a,right:i=t+(r=this.w/(e.curpagescale*e.dscalepdf)),bottom:s=a+(n=this.h/(e.curpagescale*e.dscalepdf)),left:t});return o},this.getinklist=function(){var e=0,t=0,a=[];if(0==this.type)for(t=0;t<this.pointlist.length;t++)for(e=0;e<this.pointlist[t].length;e++){var i=hn.getPageObject(this.pagenumber);if(0==i.getpageRotation())var s=(this.pointlist[t][e].x-i.dxpdf)/(i.curpagescale*i.dscalepdf),r=-((this.pointlist[t][e].y-i.dypdf)/(i.curpagescale*i.dscalepdf)-i.pdfpageheight);else s=(this.pointlist[t][e].x-i.dxpdf)/(i.curpagescale*i.dscalepdf),r=-((this.pointlist[t][e].y-i.dypdf)/(i.curpagescale*i.dscalepdf)-i.pdfpageheight);0==e?a.push({x:s,y:r,type:1}):a.push({x:s,y:r,type:2})}return a},this.getpagexy=function(){var e=0,t=0;if(0==hn.Type)var a=hn.pages[0].dx;else a=hn.getCurrentpage().dx;return hn.getCurrentpage().usevectorxml?(e=hn.getCurrentpage().dxvector,t=hn.getCurrentpage().dyvector):hn.getCurrentpage().usepdfjs?null!=hn.foxitdoc?(e=hn.getCurrentpage().foxitdx,t=hn.getCurrentpage().foxitdy):(e=hn.getCurrentpage().dxpdf,t=hn.getCurrentpage().dypdf):(e=a,t=hn.getCurrentpage().dy),{pagedx:e,pagedy:t}},this.setDrawdim=function(){x=ho(),x=!1;var e=no(),t=lo();r.setFirstdrawDim(t,e,x),b=!0},this.drawmescaled=function(e){x=ho(),x=!1;var t,a=no(r.pagenumber),i=lo(r.pagenumber),s=i,n=(t=!0,hn.getCurrentpage().usevectorxml&&(t=hn.getCurrentpage().vectorloaded),t),o=hn.getpage(r.pagenumber).getpageRotation();if(0==o||90==o||180==o||270==o){var l=oo();if(!r.noDraw){!b&&n&&(r.setFirstdrawDim(i,a,x),b=!0),r.fixedscaleFactor=i/a,i/=r.scaling,s/=r.loadscaling;var c,h,d=ro(r.pagenumber);if(hn.currentpage==r.pagenumber||0!=d.y){c=d.x,h=d.y,r.bfor3D&&(i=ai/this.pageheight);var p=0,u=0;if(r.bUseFixedScale)var g=this.arrowlength*r.fixedscaleFactor;else g=this.arrowlength*s;if(r.bUseFixedScale)var f=10*r.fixedscaleFactor;else f=10*i;if(this.h,r.bUseFixedScale)var m=this.linewidth*r.fixedscaleFactor,y=5*r.fixedscaleFactor;else m=this.linewidth*s,y=5*i;var v=this.leaderoffset*i,w=0,k=0;Ti&&(g=this.arrowlength,m=this.linewidth,f=10);var D=null;if(null!=r.hatchStyle&&(Vo(r.hatchStyle,this.color),D=Ao(e,Lo(r.hatchStyle))),0!=o){var C=ti/2,R=ai/2,S=Hl();l&&(C*=S,R*=S),e.save(),e.translate(C,R),e.rotate(o*(Math.PI/180)),e.translate(-C,-R)}switch(this.type){case 0:m=r.bUseFixedScale?this.linewidth*r.fixedscaleFactor:this.linewidth*i;var M=0,T=0;if(r.SetDimensions(i,o,c,h),!r.pdfannotproxy){if(e.save(),1==this.subtype?(null!=hn.backgroundColor?e.strokeStyle=hn.backgroundColor:e.strokeStyle="white",e.lineWidth=10*m):(e.strokeStyle=this.strokecolor,e.lineWidth=m,r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor)),e.beginPath(),this.points.length>0)for(M=0;M<this.points.length;M++)p=(this.points[M].x-this.xoffset)*i,u=(this.points[M].y-this.yoffset)*i,p+=c,u+=h,0==M?e.moveTo(p,u):e.lineTo(p,u);for(T=0;T<this.pointlist.length;T++)for(M=0;M<this.pointlist[T].length;M++)p=(this.pointlist[T][M].x-this.xoffset)*i,u=(this.pointlist[T][M].y-this.yoffset)*i,p+=c,u+=h,0==M?e.moveTo(p,u):e.lineTo(p,u);e.stroke(),e.restore()}r.selected&&r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);break;case 1:if(r.SetDimensions(i,o,c,h),!r.pdfannotproxy)switch(this.subtype){case 1:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polyline(e,r.linewidth,r.strokecolor,i,c,h,!0),e.restore();break;case 2:0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!1,!0,r.fillcolor,r.strokecolor,i,c,h,!0),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!0,!0,r.fillcolor,r.strokecolor,i,c,h,!0),e.restore()),2==this.alternative&&r.polygon(e,r.linewidth,!0,!0,"white",r.color,i,c,h,!0),this.alternative>=3&&(null!=D?r.polygon(e,r.linewidth,!0,!0,D,r.color,i,c,h,!0):r.polygon(e,r.linewidth,!0,!0,"white",r.color,i,c,h,!0));break;case 3:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polyline(e,r.linewidth,r.strokecolor,i,c,h,!0),e.restore(),r.dimtext=r.setdimvaluepoly(),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||r.hidevaluelabel||(r.bUseFixedScale?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,i,!1));break;case 4:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor);var E=r.drawangle(e,r.linewidth,r.strokecolor,i,c,h,!0,!1);r.dimtext=E.text,e.restore(),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||r.hidevaluelabel||(r.bUseFixedScale?""!=r.dimtext&&r.anglevaluedraw(e,E.pos,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor):""!=r.dimtext&&r.anglevaluedraw(e,E.pos,this.wscaled,this.hscaled,this.strokecolor,i));break;case 5:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),E=r.drawangle(e,r.linewidth,r.strokecolor,i,c,h,!0,!0),r.dimtext=E.text,e.restore(),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||r.hidevaluelabel||(r.bUseFixedScale?""!=r.dimtext&&r.anglevaluedraw(e,E.pos,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor):""!=r.dimtext&&r.anglevaluedraw(e,E.pos,this.wscaled,this.hscaled,this.strokecolor,i));break;case 6:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polylineSegments(e,r.linewidth,r.strokecolor,i,c,h,!0),r.polylineSegments(e,r.linewidthSegment,r.strokecolorSegment,i,c,h,!0),e.restore(),r.dimtext=r.setdimvaluepolySegments(),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||r.hidevaluelabel||r.bUseFixedScale;break;case 7:e.save(),r.polygoncloud(e,f,r.linewidth,!1,!0,r.fillcolor,r.strokecolor,i,c,h,!0,!0),e.restore()}r.selected&&r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),r.selectedit&&r.editpolygon(e,i),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);break;case 2:if(r.SetDimensions(i,o,c,h),!r.pdfannotproxy)switch(this.subtype){case 1:r.polycurves(e,r.linewidth,r.color,i)}r.selected&&r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),r.selectedit&&r.editpolygon(e,i);break;case 3:r.SetDimensions(i,o,c,h);var F=Math.min(this.xscaled,this.xscaled+this.wscaled),I=Math.min(this.yscaled,this.yscaled+this.hscaled),j=Math.max(this.xscaled,this.xscaled+this.wscaled),A=Math.max(this.yscaled,this.yscaled+this.hscaled);if(F=this.xscaled,I=this.yscaled,j=this.xscaled+this.wscaled,A=this.yscaled+this.hscaled,6==this.subtype&&(r.dimtext=r.setdimvaluearea()),!r.pdfannotproxy){if(2==this.subtype){if(null!=hn.backgroundColor)var O=hn.backgroundColor;else O="white";r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,O,O)}if(4==this.subtype&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,1,!0,!0,r.fillcolor,r.fillcolor),3==this.subtype&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,r.fillcolor,r.fillcolor),1==this.subtype&&(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,m,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,m,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=D?r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,m,!0,!0,D,this.color):r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,m,!0,!0,"white",this.color))),0==this.subtype&&(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=D?r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,D,this.color):r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color))),6==this.subtype){var L=1==r.alternative;r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,L,!0,r.fillcolor,r.strokecolor),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||r.hidevaluelabel||(r.bUseFixedScale?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,i,!1))}}if(r.selected&&5!=r.subtype){var V=!r.pdfannotproxy;6==r.subtype?r.select(e,F,I,j,A,!0,!1):r.select(e,F,I,j,A,!0,V)}r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 4:r.SetDimensions(i,o,c,h),r.pdfannotproxy||(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),1==this.subtype?(r.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,r.fillcolor,r.strokecolor),r.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,y,m,r.strokecolor,!1)):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),1==this.subtype?(r.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,r.fillcolor,r.strokecolor),r.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,y,m,r.strokecolor,!1)):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=D?r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,D,this.color):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color))),r.selected&&(1==this.subtype?r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1):r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 5:r.SetDimensions(i,o,c,h),r.pdfannotproxy||(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=D?r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,!0,!0,D,this.color):r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,!0,!0,"white",this.color))),r.selected&&r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 6:r.SetDimensions(i,o,c,h),r.pdfannotproxy||(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.arrow(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,P,m,this.subtype,r.strokecolor,r.strokecolor),e.restore()),r.selected&&r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1);break;case 7:r.SetDimensions(i,o,c,h);var N=this.subtype+4;r.setdimvalue(this.x,this.y,this.w,this.h),r.pdfannotproxy||(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),this.labelpos=r.dimensionLeader(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,v,g,P,m,N,r.strokecolor,r.strokecolor),e.restore(),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),r.bUseFixedScale?0==this.leaderoffset?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!0):r.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,r.fixedscaleFactor,!0):0==this.leaderoffset?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,i,!0):r.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,i,!0)),r.selected&&(r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1),0==this.leaderoffset?r.selectLabel(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1):r.selectLabel(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,!1,!1)),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1);break;case 8:if(0==r.points.length)break;if(r.SetDimensions(i,o,c,h),r.bUseFixedScale)var B=r.fixedscaleFactor;else B=i;if(r.bshowperimeter?r.dimtext=r.setdimvalueperimeter():(r.dimtext=r.setdimvaluearea(),1==r.subtype&&r.updateAttribute("Rx_Area",this.dimtext)),!r.pdfannotproxy){if(r.spaceselected||1!=r.subtype||(r.linestyle=0),r.spaceselected&&1==r.subtype){e.save();var U=e.createLinearGradient(this.xscaled,this.yscaled,this.wscaled,this.hscaled);U.addColorStop(0,r.selectSpaceColor),U.addColorStop(.5,r.selectSpaceStopColor),U.addColorStop(1,r.selectSpaceColor),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!0,!0,U,r.strokecolor,i,c,h,!0),e.restore()}else 2==r.subtype&&r.saved||(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!1,!0,r.fillcolor,r.strokecolor,i,c,h,!0),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!0,!0,r.fillcolor,r.strokecolor,i,c,h,!0),e.restore()),2==this.alternative&&r.polygon(e,r.linewidth,!0,!0,"white",r.color,i,c,h,!0),this.alternative>=3&&(null!=D?r.polygon(e,r.linewidth,!0,!0,D,r.color,i,c,h,!0):r.polygon(e,r.linewidth,!0,!0,"white",r.color,i,c,h,!0)));var G=vo(this.points);1==r.subtype&&r.updateAttribute("Rx_Area",this.dimtext);var z=G.x,H=G.y,_=(z-this.xoffset)*i,W=(H-this.yoffset)*i,X=ro(r.pagenumber),Y=(_+=X.x,W+=X.y,this.measuretextheight*i);r.bUseFixedScale&&(Y=this.measuretextheight*r.fixedscaleFactor),Ti&&(Y=1*this.measuretextheight),r.saved||(null!=ia&&ia.setdimtext(r.dimtext),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),$r||!r.busecustomlabel||r.hidevaluelabel||2==r.subtype||r.areavaluedraw(e,r.customlabeltext,_,W,r.strokecolor,Y,B,i),$r||r.busecustomlabel||1==r.subtype||r.hidevaluelabel||2==r.subtype||r.areavaluedraw(e,r.dimtext,_,W,r.strokecolor,Y,B,i)}if(r.selected&&r.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),r.selectedit&&2!=r.subtype&&r.editpolygon(e,i),r.holes.length>0)for(var q=0;q<r.holes.length;q++)r.holes[q].selectedit&&(i=i*r.scaling/r.holes[q].scaling,r.holes[q].editpolygon(e,i));r.marked&&r.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);break;case 9:if(r.SetDimensions(i,o,c,h),r.selectedit)break;if(r.bUseFixedScale){var Z=r.fixedscaleFactor;Z*=dr}else Z=i;if(!r.pdfannotproxy){this.font.setScale(Z);var J=this.font.height*Z;e.font=this.font.fontstringScaled;var K=e.measureText(this.text);if(this.textwidth=K.width,e.save(),w=this.xscaled,k=this.yscaled,0!=r.textrotate&&0==r.subtype&&(e.translate(w,k),e.rotate(r.textrotate),e.translate(-w,-k)),0!=r.rotation&&(w=this.xscaled+this.wscaled/2,k=0==r.subtype?this.yscaled-this.hscaled/2:this.yscaled+this.hscaled/2,e.translate(w,k),e.rotate(r.rotation),e.translate(-w,-k)),e.textAlign="start",e.fillStyle=r.textcolor,1==this.subtype||2==this.subtype){var $=this.font.height*gr*i,Q=this.font.height*pr*Z,ee=this.font.height*ur*i;0==r.linewidth?r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,r.fillcolor,r.strokecolor):(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,r.fillcolor,r.strokecolor),e.restore()),e.save(),e.beginPath(),e.rect(this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.clip(),this.text.split("\n");var te=this.yscaled+J+ee,ae=this.xscaled,ie=this.yscaled;switch(r.textrotate,Math.PI,r.pagerotation){case 0:var se=this.xscaled+$,re=this.wscaled;break;case 90:se=this.xscaled+$-this.hscaled,e.translate(ae,ie),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-ae,-ie),re=this.hscaled;break;case 270:se=this.xscaled+$,te=this.yscaled+J+ee-this.wscaled,e.translate(ae,ie),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-ae,-ie),re=this.hscaled;break;case 180:se=this.xscaled+$,ae=this.xscaled+this.wscaled/2,ie=this.yscaled+this.hscaled/2,e.translate(ae,ie),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-ae,-ie),re=this.wscaled}re-=5,Wn(e,this.text,se,te,re,J+Q),r.textdim=function(e,t,a,i,s,r){var n,o,l="",c=0,h=0,d=t.split("\n"),p=[],u=[],g=[];s-=e.measureText(" ").width;for(var f=0;f<d.length;f++){var m;l="",c=0,n=0,(m=e.measureText(d[f])).width>s?(p=p.concat(d[f].split(" "))).push("\n"):(p.push(d[f]),p.push("\n"),m.width>h&&(h=m.width))}for(n=0;n<p.length;n++)if("\n"!=p[n])for(var y=_n(e,p[n],s,u);y.bNeedSplit;)y=_n(e,y.remainer,s,u);else u.push(p[n]);for(n=0;n<u.length;n++)"\n"!=u[n]?(o=l+u[n]+" ",(m=e.measureText(o)).width>s&&n>0?(""!=l&&g.push(l),l=u[n]+" ",m.width>h&&(h=m.width)):l=o):(""!=l&&g.push(l),m.width>h&&(h=m.width),l="");for(n=0;n<g.length;n++)"\n"!=g[n]&&c++;return{width:h,height:(c+1)*r}}(e,this.text,0,0,re,J+Q),e.restore()}else e.fillText(this.text,this.xscaled,this.yscaled);e.restore()}r.selected&&(1==this.subtype||2==this.subtype?this.bhasArrow?r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1):r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0):r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled-this.hscaled,!0,!0)),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 10:if(!on)break;r.SetDimensions(i,o,c,h),r.pdfannotproxy||(e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),Ti?e.drawImage(ln,this.xscaled,this.yscaled,this.w,this.h):e.drawImage(ln,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore()),r.selected&&(Ti?r.select(e,this.xscaled,this.yscaled,this.xscaled+this.w,this.yscaled+this.h,!0,!1):r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1)),r.marked&&(Ti?r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.w,this.yscaled+this.h,!0,!1):r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1));break;case 11:if(!r.imageloaded)break;r.SetDimensions(i,o,c,h),r.pdfannotproxy||(1==this.subtype?(e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),r.imageloaded&&e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore()):2==this.subtype||(3==this.subtype||5==this.subtype||4==this.subtype||12==this.subtype||20==this.subtype)&&(e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),r.imageloaded&&e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore())),1==this.subtype?(r.selected&&r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)):2==this.subtype||(3==this.subtype||5==this.subtype?(r.selected&&r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1)):4==this.subtype||(12==this.subtype||20==this.subtype)&&(r.selected&&r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)));break;case 12:r.SetDimensions(i,o,c,h);var ne=this.font.height*i;this.font.setScale(i);var oe=r.stampsmalltheight*i;r.bUseFixedScale?r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,3*r.fixedscaleFactor,!0,!0,r.fillcolor,r.strokecolor):r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,f,3*i,!0,!0,r.fillcolor,r.strokecolor),r.selected&&r.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),r.marked&&r.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);var le=Kn(r.signature),ce=r.GetDateTime(!1);this.smalltext="By "+le+", ",this.smalltext+=ce,e.save(),0!=r.rotation&&(w=this.xscaled+this.wscaled/2,k=this.yscaled+this.hscaled/2,e.translate(w,k),e.rotate(r.rotation),e.translate(-w,-k)),e.fillStyle=r.strokecolor,e.font=this.font.fontstringScaled;var he=e.measureText(this.text);this.textwidth=he.width,w=this.xscaled+this.wscaled/2,0==this.alternative?k=this.yscaled+(this.hscaled/4+ne/2):(k=this.yscaled+this.hscaled/2,k+=ne/4),0!=r.textrotate&&(k=this.yscaled+this.hscaled/2,e.translate(w,k),e.rotate(r.textrotate),e.translate(-w,-k),w=this.xscaled+this.wscaled/2,0==this.alternative?k=this.yscaled+(this.hscaled/4+ne/2):(k=this.yscaled+this.hscaled/2,k+=ne/4)),e.textAlign="center",e.fillText(this.text,w,k),0==this.alternative&&(e.fillStyle=this.color,e.font="bold "+oe+"pt Times New Roman",k=this.yscaled+this.hscaled/4*3,e.fillText(this.smalltext,w,k)),e.restore();break;case 13:r.SetDimensions(i,o,c,h),r.pdfannotproxy||r.shapes(e,r.subtype,r.outerRadius,r.innerRadius,r.linewidth,r.fillcolor,r.strokecolor,i,c,h),r.saved||(null!=ia&&ia.setdimtext(r.getcount()),null!=Ja&&Ja.setMarkupMeasureRealTimeData(r)),r.selectedit&&r.editpolygon(e,i),r.marked&&r.markpolygon(e,i);break;case 14:r.SetDimensions(i,o,c,h),null!=r.startX&&null!=r.startY&&null!=r.secondX&&null!=r.secondY&&(r.xscaled=Math.min(r.startXscaled,r.secondXscaled),r.yscaled=Math.min(r.startYscaled,r.secondYscaled),r.wscaled=Math.max(r.startXscaled,r.secondXscaled),r.hscaled=Math.max(r.startYscaled,r.secondYscaled));var de={x:r.startXscaled,y:r.startYscaled},pe={x:r.secondXscaled,y:r.secondYscaled},ue={x:r.endXscaled,y:r.endYscaled},ge={x:r.startX,y:r.startY},fe={x:r.secondX,y:r.secondY},me={x:r.endX,y:r.endY};const t="rgb(109, 166, 209)";if(ol.renderPoints(e,r,t),r.setsecond){var ye=ol.drawInitialArc(e,de,pe,1.2,r.strokecolor,m);if(4==r.editaction){r.endX=(ye.x-c)/i+r.xoffset,r.endY=(ye.y-h)/i+r.yoffset,me={x:r.endX,y:r.endY};var ve=ol.calculateArcMeasurements(ge,fe,me);r.setarcvalue(ve.radius,ve.arcLength);const t=`R${r.dimradius}\nL${r.dimlength}`;ol.drawArcLabelFromText(e,ye.labelposx,ye.labelposy,t,i)}}else if(r.setthird){let t=ol.drawArc(e,de,pe,ue,r.strokecolor,r.scaling,m);ve=ol.calculateArcMeasurements(ge,fe,me),r.setarcvalue(ve.radius,ve.arcLength);const a=`R${r.dimradius}\nL${r.dimlength}`;ol.drawArcLabelFromText(e,t.labelposx,t.labelposy,a,i)}r.selectedit&&r.editpolygon(e,i)}0!=o&&e.restore()}}}},this.rotatecnvs=function(e,t,a,i,s,n){var o,l;0!=n&&(o=t+i/2,l=a+s/2,e.translate(o,l),e.rotate(r.rotation),e.translate(-o,-l))},this.drawbirdseye=function(e){if(null!=e.birdseyemarkupctx&&null!=e.birdseyeobj.birdseye&&!r.bfor3D){var t=0,a=0;if(0!=e.birdseyeobj.rotation){var i=e.birdseyeobj.birdseye.width/2,s=e.birdseyeobj.birdseye.height/2;90==e.birdseyeobj.rotation?(t=i-s,a=i-s):270==e.birdseyeobj.rotation&&(t=s-i,a=s-i),e.birdseyeobj.ignorerotation&&(t=0,a=0,90==e.birdseyeobj.rotation?(t=i-s,a=s-i):270==e.birdseyeobj.rotation&&(t=i-s,a=-(i-s))),e.birdseyemarkupctx.save(),e.birdseyemarkupctx.translate(i,s),e.birdseyemarkupctx.rotate(e.birdseyeobj.rotation*(Math.PI/180)),e.birdseyemarkupctx.translate(-i,-s)}this.drawprint(e.birdseyemarkupctx,t,a,e.birdseyeobj.dscalebirdseye,e.birdseyeobj.rotation,!0),0!=e.birdseyeobj.rotation&&e.birdseyemarkupctx.restore()}},this.drawfloorplan=function(e,t,a,i){this.drawprint(e,a,i,t,0,!1)},this.drawWidthHeight=function(e,t,a){if(r.bfor3D){var i=a/r.pageheight;r.pagewidth}var s=.5*t,n=.5*a;9==this.type&&this.selectedit||this.drawprint(e,s,n,i,0,!0)},this.drawthumb=function(e){if(hn.getpageThumb(r.pagenumber)){var t=hn.getpageThumb(r.pagenumber),a=t.thumbnailobj.rotation,i=t.dxthumb,s=t.dythumb,n=t.thumbcanvas.width,o=t.thumbcanvas.height;if(0!=a){var l=n/2,c=o/2;(90==a||270==a)&&(i=l-c,s=c-l),e.save(),e.translate(l,c),e.rotate(a*(Math.PI/180)),e.translate(-l,-c)}this.drawprint(e,i,s,t.dscalethumb,a,!0),0!=a&&e.restore()}},this.drawprint=function(e,t,a,i,s,n){if(!r.noDraw&&!r.pdfannotproxy){r.fixedscaleFactor=i/hn.getCurrentpage().fixedScale;var o=i/r.scaling,l=t,c=a,h=0,d=0;if(r.bUseFixedScale&&!n)var p=this.arrowlength*r.fixedscaleFactor;else p=this.arrowlength*o;if(r.bUseFixedScale&&!n)var u=10*r.fixedscaleFactor;else u=10*o;if(this.h,r.bUseFixedScale&&!n)var g=this.linewidth*r.fixedscaleFactor;else g=this.linewidth*o;var f=this.leaderoffset*o,m=0,y=0,v=null;if(null!=r.hatchStyle&&(Vo(r.hatchStyle,this.color),v=Ao(e,Lo(r.hatchStyle))),r.bUseFixedScale&&!n){g=this.linewidth*r.fixedscaleFactor;var x=5*r.fixedscaleFactor}else g=this.linewidth*o,x=5*o;switch(this.type){case 0:var b=0,w=0;for(r.SetDimensions(o,s,l,c),e.save(),1==this.subtype?(e.strokeStyle="white",e.lineWidth=10*this.linewidth*o):(e.strokeStyle=this.strokecolor,e.lineWidth=this.linewidth*o,r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor)),e.beginPath(),w=0;w<this.pointlist.length;w++)for(b=0;b<this.pointlist[w].length;b++)h=(this.pointlist[w][b].x-this.xoffset)*o,d=(this.pointlist[w][b].y-this.yoffset)*o,h+=t,d+=a,0==b?e.moveTo(h,d):e.lineTo(h,d);e.stroke(),e.restore();break;case 1:switch(r.SetDimensions(o,s,l,c),this.subtype){case 1:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polyline(e,r.linewidth,r.strokecolor,o,t,a,!0),e.restore();break;case 2:0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!1,!0,r.fillcolor,r.strokecolor,o,t,a,!0),e.restore()),1==this.alternative&&r.polygon(e,r.linewidth,!0,!0,r.fillcolor,r.strokecolor,o,t,a,!0),2==this.alternative&&r.polygon(e,r.linewidth,!0,!0,"white",r.color,o,t,a,!0),this.alternative>=3&&(null!=v?r.polygon(e,r.linewidth,!0,!0,v,r.color,o,t,a,!0):r.polygon(e,r.linewidth,!0,!0,"white",r.color,o,t,a,!0));break;case 3:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polyline(e,r.linewidth,r.strokecolor,o,t,a,!0),e.restore(),r.dimtext=r.setdimvaluepoly(),r.bUseFixedScale&&!n?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1);break;case 4:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.dimtext=r.drawangle(e,r.linewidth,r.strokecolor,o,l,c,!0,!1),e.restore(),$r||r.hidevaluelabel||(r.bUseFixedScale?""!=r.dimtext&&r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):""!=r.dimtext&&r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1));break;case 5:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.dimtext=r.drawangle(e,r.linewidth,r.strokecolor,o,l,c,!0,!0),e.restore(),$r||r.hidevaluelabel||(r.bUseFixedScale?""!=r.dimtext&&r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):""!=r.dimtext&&r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1));break;case 6:e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polylineSegments(e,r.linewidth,r.strokecolor,o,l,c,!0),r.polylineSegments(e,r.linewidthSegment,r.strokecolorSegment,o,l,c,!0),e.restore(),r.dimtext=r.setdimvaluepolySegments(),$r||r.hidevaluelabel||r.bUseFixedScale}break;case 2:switch(r.SetDimensions(o,s,l,c),this.subtype){case 1:r.polycurves(e,r.linewidth,r.color,o)}break;case 3:if(r.SetDimensions(o,s,l,c),2==this.subtype){if(null!=hn.backgroundColor)var k=hn.backgroundColor;else k="white";r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,k,k)}4==this.subtype&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,r.fillcolor,r.fillcolor),3==this.subtype&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,r.fillcolor,r.fillcolor),1==this.subtype&&(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,g,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,g,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,g,!0,!0,v,this.color):r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,g,!0,!0,"white",this.color))),0==this.subtype&&(0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,v,this.color):r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color))),6==this.subtype&&(r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,r.fillcolor,r.strokecolor),r.dimtext=r.setdimvaluearea(),$r||r.hidevaluelabel||(r.bUseFixedScale?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!1):r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1)));break;case 4:r.SetDimensions(o,s,l,c),0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),1==this.subtype?(r.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,r.fillcolor,r.strokecolor),r.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,x,g,r.strokecolor,!1)):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),1==this.subtype?(r.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,r.fillcolor,r.strokecolor),r.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,x,g,r.strokecolor,!1)):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,v,this.color):r.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color));break;case 5:r.SetDimensions(o,s,l,c),0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,u,g,!1,!0,r.fillcolor,r.strokecolor),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,u,g,!0,!0,r.fillcolor,r.strokecolor),e.restore()),2==this.alternative&&r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,u,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,u,g,!0,!0,v,this.color):r.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,u,g,!0,!0,"white",this.color));break;case 6:r.SetDimensions(o,s,l,c),e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.arrow(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,P,g,this.subtype,r.strokecolor,r.strokecolor),e.restore();break;case 7:r.SetDimensions(o,s,l,c);var D=this.subtype+4;e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.labelpos=r.dimensionLeader(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,p,P,g,D,r.strokecolor,r.strokecolor),e.restore(),r.setdimvalue(this.x,this.y,this.w,this.h),r.bUseFixedScale&&!n?0==this.leaderoffset?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r.fixedscaleFactor,!0):r.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,r.fixedscaleFactor,!0):0==this.leaderoffset?r.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!0):r.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,o,!0);break;case 8:if(r.SetDimensions(o,s,l,c),r.bUseFixedScale&&!n)var C=r.fixedscaleFactor;else C=o;if(r.spaceselected||1!=r.subtype||(r.linestyle=0),r.spaceselected&&1==r.subtype){e.save();var R=e.createLinearGradient(this.xscaled,this.yscaled,this.wscaled,this.hscaled);R.addColorStop(0,r.selectSpaceColor),R.addColorStop(.5,r.selectSpaceStopColor),R.addColorStop(1,r.selectSpaceColor),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!0,!0,R,r.strokecolor,o,l,c,!0),e.restore()}0==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!1,!0,r.fillcolor,r.strokecolor,o,l,c,!0),e.restore()),1==this.alternative&&(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.polygon(e,r.linewidth,!0,!0,r.fillcolor,r.strokecolor,o,l,c,!0),e.restore()),2==this.alternative&&r.polygon(e,r.linewidth,!0,!0,"white",r.color,o,l,c,!0),this.alternative>=3&&(null!=v?r.polygon(e,r.linewidth,!0,!0,v,r.color,o,l,c,!0):r.polygon(e,r.linewidth,!0,!0,"white",r.color,o,l,c,!0)),r.bshowperimeter?r.dimtext=r.setdimvalueperimeter():(r.dimtext=r.setdimvaluearea(),1==r.subtype&&r.updateAttribute("Rx_Area",this.dimtext));var S=vo(this.points),M=S.x,T=S.y,E=(M-this.xoffset)*o,F=(T-this.yoffset)*o;E+=t,F+=a;var I=this.measuretextheight*o;r.bUseFixedScale&&!n&&(I=this.measuretextheight*r.fixedscaleFactor),$r||!r.busecustomlabel||r.hidevaluelabel||r.areavaluedraw(e,r.customlabeltext,E,F,r.strokecolor,I,C,o),$r||1==r.subtype||r.hidevaluelabel||r.areavaluedraw(e,r.dimtext,E,F,r.strokecolor,I,C,o);break;case 9:if(r.SetDimensions(o,s,l,c),r.selectedit)break;if(r.bUseFixedScale&&!n)var j=r.fixedscaleFactor;else j=o;this.font.setScale(j);var A=this.font.height*j;e.font=this.font.fontstringScaled;var O=e.measureText(this.text);if(this.textwidth=O.width,e.save(),m=this.xscaled,y=this.yscaled,0!=r.textrotate&&0==r.subtype&&(e.translate(m,y),e.rotate(r.textrotate),e.translate(-m,-y)),0!=r.rotation&&(m=this.xscaled+this.wscaled/2,y=0==r.subtype?this.yscaled-this.hscaled/2:this.yscaled+this.hscaled/2,e.translate(m,y),e.rotate(r.rotation),e.translate(-m,-y)),e.textAlign="start",e.fillStyle=r.textcolor,1==this.subtype||2==this.subtype){var L=4*j,V=this.font.height*pr*j,N=this.font.height/10*2*j;0==r.linewidth?r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,r.fillcolor,r.strokecolor):(e.save(),r.GetLinestyle(r.linestyle,e,r.fixedscaleFactor),r.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,r.fillcolor,r.strokecolor),e.restore()),e.save(),e.beginPath(),e.rect(this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.clip(),this.text.split("\n");var B=this.yscaled+A+N,U=this.xscaled,G=this.yscaled;switch(r.textrotate,Math.PI,r.pagerotation){case 0:var z=this.xscaled+L,H=this.wscaled;break;case 90:z=this.xscaled+L-this.hscaled,e.translate(U,G),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-U,-G),H=this.hscaled;break;case 270:z=this.xscaled+L,B=this.yscaled+A+N-this.wscaled,e.translate(U,G),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-U,-G),H=this.hscaled;break;case 180:z=this.xscaled+L,U=this.xscaled+this.wscaled/2,G=this.yscaled+this.hscaled/2,e.translate(U,G),e.rotate(-r.pagerotation*(Math.PI/180)),e.translate(-U,-G),H=this.wscaled}Wn(e,this.text,z,B,H,A+V),e.restore()}else e.fillText(this.text,this.xscaled,this.yscaled);e.restore();break;case 10:if(!on)return;r.SetDimensions(o,s,l,c),e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),e.drawImage(ln,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore();break;case 11:if(!r.imageloaded)break;r.SetDimensions(o,s,l,c),e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore();break;case 12:r.SetDimensions(o,s,l,c);var _=this.font.height*o;this.font.setScale(o);var W=r.stampsmalltheight*o;r.bUseFixedScale&&!n?r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,3*r.fixedscaleFactor,!0,!0,r.fillcolor,r.strokecolor):r.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,r.rotation,u,3*o,!0,!0,r.fillcolor,r.strokecolor);var X=Kn(r.signature),Y=r.GetDateTime(!1);this.smalltext="By "+X+", ",this.smalltext+=Y,e.save(),0!=r.rotation&&(m=this.xscaled+this.wscaled/2,y=this.yscaled+this.hscaled/2,e.translate(m,y),e.rotate(r.rotation),e.translate(-m,-y)),e.fillStyle=r.strokecolor,e.font=r.font.fontstringScaled;var q=e.measureText(this.text);this.textwidth=q.width,m=this.xscaled+this.wscaled/2,0==this.alternative?y=this.yscaled+(this.hscaled/4+_/2):(y=this.yscaled+this.hscaled/2,y+=_/4),0!=r.textrotate&&(e.translate(m,y),e.rotate(r.textrotate),e.translate(-m,-y),m=this.xscaled+this.wscaled/2,0==this.alternative?y=this.yscaled+(this.hscaled/4+_/2):(y=this.yscaled+this.hscaled/2,y+=_/4)),e.textAlign="center",e.fillText(this.text,m,y),0==this.alternative&&(e.fillStyle=this.color,e.font="bold "+W+"pt Times New Roman",y=this.yscaled+this.hscaled/4*3,e.fillText(this.smalltext,m,y)),e.restore();break;case 13:r.SetDimensions(o,s,l,c),r.shapes(e,r.subtype,r.outerRadius,r.innerRadius,r.linewidth,r.fillcolor,r.strokecolor,o,l,c);break;case 20:if(!r.imageloaded)break;r.SetDimensions(o,s,l,c),e.save(),r.rotatecnvs(e,r.xscaled,r.yscaled,r.wscaled,r.hscaled,r.rotation),e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore()}}},this.setinitRotatedMarkupPoint=function(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c},this.setRotatedMarkuprect=function(e,t,a,i){var s=this.rotatedrect.x,n=this.rotatedrect.y,o=this.rotatedrect.w,l=this.rotatedrect.h,c=Math.cos(i),h=Math.sin(i),d=s-e,p=n-t,u=d*c-p*h,g=d*h+p*c;u=e+u,g=t+g,this.rotatedrect.x=u,this.rotatedrect.y=g,a?(d=o-e,p=l-t):9==this.type&&0==this.subtype?(d=s+o-e,p=n-l-t):(d=s+o-e,p=n+l-t);var f=d*c-p*h,m=d*h+p*c;f=e+f,m=t+m,0!=r.textrotate&&(c=Math.cos(r.textrotate),h=Math.sin(r.textrotate)),this.rotatedrect.w=f,this.rotatedrect.h=m},this.getRotatedMarkup=function(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c},this.getMarkupSelectPointRot=function(e,t,a){var i=e,s=t,r=Math.cos(a),n=Math.sin(a);return new pn(i*r-s*n,i*n+s*r)},this.getTopLeftRot=function(e,t,a){var i=-e/2,s=-t/2,r=Math.cos(a),n=Math.sin(a);return new pn(i*r-s*n,i*n+s*r)},this.getBottomRightRot=function(e,t,a){var i=e/2,s=t/2,r=Math.cos(a),n=Math.sin(a);return new pn(i*r-s*n,i*n+s*r)},this.getRotSelectRot=function(e,t,a){var i=-t/2-15,s=Math.cos(a),r=Math.sin(a);return new pn(0*s-i*r,0*r+i*s)},this.seteditaction=function(e){r.signature==Fr&&(r.editaction=e)},this.GetwithinCorner=function(e,t){var a=!1,i=0,s=0,n=hn.getCurrentpage().getpageRotation();if(0!=r.rotation){var o=this.LowerRightRectRot.x,l=this.LowerRightRectRot.w,c=this.LowerRightRectRot.y,h=this.LowerRightRectRot.h;r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=4,s=2),o=this.UpperLeftRectRot.x,l=this.UpperLeftRectRot.w,c=this.UpperLeftRectRot.y,h=this.UpperLeftRectRot.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=1,s=2),o=this.UpperRightRectRot.x,l=this.UpperRightRectRot.w,c=this.UpperRightRectRot.y,h=this.UpperRightRectRot.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=2,s=2),o=this.LowerLeftRectRot.x,l=this.LowerLeftRectRot.w,c=this.LowerLeftRectRot.y,h=this.LowerLeftRectRot.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=3,s=2),o=this.RotmarkerRectRot.x,l=this.RotmarkerRectRot.w,c=this.RotmarkerRectRot.y,h=this.RotmarkerRectRot.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=5,s=3)}else o=this.LowerRightRect.x,l=this.LowerRightRect.w,c=this.LowerRightRect.y,h=this.LowerRightRect.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=4,s=2),o=this.UpperLeftRect.x,l=this.UpperLeftRect.w,c=this.UpperLeftRect.y,h=this.UpperLeftRect.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=1,s=2),o=this.UpperRightRect.x,l=this.UpperRightRect.w,c=this.UpperRightRect.y,h=this.UpperRightRect.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=90==n||270==n?3:2,s=2),o=this.LowerLeftRect.x,l=this.LowerLeftRect.w,c=this.LowerLeftRect.y,h=this.LowerLeftRect.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=90==n||270==n?2:3,s=2),o=this.RotmarkerRect.x,l=this.RotmarkerRect.w,c=this.RotmarkerRect.y,h=this.RotmarkerRect.h,r.Getwithin(e,t,o,l,c,h)&&(a=!0,i=5,s=3);return{within:a,scalecorner:i,editaction:s}},this.Getwithin=function(e,t,a,i,s,r){var n=!1;return e>Math.min(a,i)&&e<Math.max(a,i)&&t>Math.min(s,r)&&t<Math.max(s,r)&&(n=!0),n},this.normalizeRect=function(e){var t={x:e.x,y:e.y,w:e.w,h:e.h};return t.x=Math.min(e.x,e.w),t.y=Math.min(e.y,e.h),t.w=Math.max(e.x,e.w),t.h=Math.max(e.y,e.h),t},this.GetwithinRect=function(e,t,a){var i=!1;return e>a.x&&e<a.w&&t>a.y&&t<a.h&&(i=!0),i},this.getrotatedPoint=function(e,t){var a=ti/2,i=ai/2;if(oo()){var s=Hl();a*=s,i*=s}var r=hn.getCurrentpage().getpageRotation(),n=r*(Math.PI/180);switch(hn.getCurrentpage().getpageRotation()){case 0:case 90:case 270:case 180:n=r*(Math.PI/180)}if(0!=hn.getCurrentpage().getpageRotation()){var o=Jp(a,i,e,t,n);e=o.x,t=o.y}return{x:e,y:t}},this.iswithin=function(e,t){if(r.noDraw)return!1;if(hn.getcurPage()!=r.pagenumber)return!1;var a=ti/2,i=ai/2;if(oo()){var s=Hl();a*=s,i*=s}var n=hn.getCurrentpage().getpageRotation(),o=n*(Math.PI/180);switch(hn.getCurrentpage().getpageRotation()){case 0:o=n*(Math.PI/180);break;case 90:o=(n+180)*(Math.PI/180);break;case 270:o=(n-180)*(Math.PI/180);break;case 180:o=n*(Math.PI/180)}var l=ro(r.pagenumber),c=l.x,h=l.y,d=lo();d/=r.scaling;this.xscaled,this.wscaled,this.yscaled,this.hscaled;var p=0,u=0,g=0,f=0,m=0;if(0!=r.rotation){m=r.rotation;var y=r.getBottomRightRot(this.wscaled,this.hscaled,m);y.x,y.y,(y=r.getRotSelectRot(this.wscaled,this.hscaled,m)).x,y.y}var v=!1,x={x:e,y:t};if(0!=hn.getCurrentpage().getpageRotation()){var b=r.getRotatedMarkup(a,i,e,t,o);e=b.x,t=b.y}var w=Math.min(this.xscaled,this.xscaled+this.wscaled),k=Math.max(this.xscaled,this.xscaled+this.wscaled),C=Math.min(this.yscaled,this.yscaled+this.hscaled),P=Math.max(this.yscaled,this.yscaled+this.hscaled),S=(Math.min(this.xscaled,this.wscaled),Math.max(this.xscaled,this.wscaled),Math.min(this.yscaled,this.hscaled),Math.max(this.yscaled,this.hscaled),this.type);switch(r.linesegment={p1:-1,p2:-1},r.multilinesegment={p1:[],p2:[]},r.selectedpoint=-1,r.selectedmultipoint=[],S){case 0:e>this.xscaled&&e<this.wscaled&&t>this.yscaled&&t<this.hscaled&&(v=!0,r.seteditaction(1)),e>this.wscaled-D&&e<this.wscaled+D&&t>this.hscaled-D&&t<this.hscaled+D&&(v=!0);break;case 1:var M=5==r.subtype||4==r.subtype,T=6==r.subtype,E=1==r.subtype||3==r.subtype||7==r.subtype;r.bfor3D&&(d=ai/r.pageheight);var F={x:e,y:t},I={x:this.xscaled,y:this.yscaled},j={x:this.wscaled,y:this.hscaled},A={x:I.x-(j.x-I.x)/10,y:j.y-(j.y-I.y)/2};if(2==r.subtype)v=Co(d,c,h,r.xoffset,r.yoffset,r.sides,F,A),r.seteditaction(1);else if(T){var O=0;for(B=0,O=0;O<r.pointlist.length;O++)for(B=0;B<r.pointlist[O].length;B++){if(p=(r.pointlist[O][B].x-r.xoffset)*d,u=(r.pointlist[O][B].y-r.yoffset)*d,p+=c,u+=h,B==r.pointlist[O].length-1){g=(r.pointlist[O][0].x-r.xoffset)*d,f=(r.pointlist[O][0].y-r.yoffset)*d;var L=[O,B],V=[O,0]}else g=(r.pointlist[O][B+1].x-r.xoffset)*d,f=(r.pointlist[O][B+1].y-r.yoffset)*d,L=[O,B],V=[O,B+1];if(F={x:e,y:t},I={x:p,y:u},j={x:g+=c,y:f+=h},7==r.subtype)var N=15;else N=5;wo(F,I,j)<N&&(v=!0,r.seteditaction(1),r.multilinesegment={p1:L,p2:V})}}else if(E||M){var B=0;for(B=0;B<r.points.length;B++)p=(r.points[B].x-this.xoffset)*d,u=(r.points[B].y-this.yoffset)*d,p+=c,u+=h,B==r.points.length-1?(g=(r.points[0].x-this.xoffset)*d,f=(r.points[0].y-this.yoffset)*d,g+=c,f+=h,L=B,V=0):(g=(r.points[B+1].x-this.xoffset)*d,f=(r.points[B+1].y-this.yoffset)*d,g+=c,f+=h,L=B,V=B+1),F={x:e,y:t},I={x:p,y:u},j={x:g,y:f},N=7==r.subtype?15:5,wo(F,I,j)<N&&(v=!0,r.seteditaction(1))}if(r.selectedit){if(6==r.subtype){for(O=0,B=0,O=0;O<r.pointlist.length;O++)for(B=0;B<r.pointlist[O].length;B++)if(p=(r.pointlist[O][B].x-r.xoffset)*d,u=(r.pointlist[O][B].y-r.yoffset)*d,p+=c,u+=h,B==r.pointlist[O].length-1?(g=(r.pointlist[O][0].x-r.xoffset)*d,f=(r.pointlist[O][0].y-r.yoffset)*d,L=[O,B],V=[O,0]):(g=(r.pointlist[O][B+1].x-r.xoffset)*d,f=(r.pointlist[O][B+1].y-r.yoffset)*d,L=[O,B],V=[O,B+1]),wo(F={x:e,y:t},I={x:p,y:u},j={x:g+=c,y:f+=h})<5&&(v=!0,v=!0,r.seteditaction(7),r.multilinesegment={p1:L,p2:V}),e>p-8&&e<p+8&&t>u-8&&t<u+8){v=!0,r.selectedmultipoint=[O,B],r.seteditaction(4);break}}else for(B=0;B<r.points.length;B++)if(p=(r.points[B].x-this.xoffset)*d,u=(r.points[B].y-this.yoffset)*d,p+=c,u+=h,B==r.points.length-1?(g=(r.points[0].x-this.xoffset)*d,f=(r.points[0].y-this.yoffset)*d,g+=c,f+=h,L=B,V=0):(g=(r.points[B+1].x-this.xoffset)*d,f=(r.points[B+1].y-this.yoffset)*d,g+=c,f+=h,L=B,V=B+1),wo(F={x:e,y:t},I={x:p,y:u},j={x:g,y:f})<5&&(v=!0,r.seteditaction(7),r.linesegment={p1:L,p2:V}),e>p-8&&e<p+8&&t>u-8&&t<u+8){v=!0,r.selectedpoint=B,r.seteditaction(4);break}return v}break;case 2:if(e>this.xscaled&&e<this.wscaled&&t>this.yscaled&&t<this.hscaled&&(v=!0,r.seteditaction(1)),e>this.wscaled-D&&e<this.wscaled+D&&t>this.hscaled-D&&t<this.hscaled+D&&(v=!0),r.selectedit)for(B=0,B=0;B<r.points.length;B++)p=(r.points[B].x-this.xoffset)*d,u=(r.points[B].y-this.yoffset)*d,u+=h,e>(p+=c)-8&&e<p+8&&t>u-8&&t<u+8&&(v=!0,r.selectedpoint=B,r.seteditaction(4));break;case 3:r.Getwithin(e,t,w,k,C,P)&&(v=!0,r.seteditaction(1));var U=r.GetwithinCorner(x.x,x.y);U.within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner);break;case 4:if(1==this.subtype){var G=Math.max(this.xscaled,this.wscaled)-Math.min(this.xscaled,this.wscaled),z=Math.max(this.yscaled,this.hscaled)-Math.min(this.yscaled,this.hscaled),H=r.getdiag(G,z);Math.sqrt((e-this.xscaled)*(e-this.xscaled)+(t-this.yscaled)*(t-this.yscaled))<H&&(v=!0,r.seteditaction(1));var _=this.wscaled,W=this.hscaled;e>_-D&&e<_+D&&t>W-D&&t<W+D&&(v=!0,r.seteditaction(2),this.scalecorner=4)}else r.Getwithin(e,t,w,k,C,P)&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner);break;case 5:r.Getwithin(e,t,w,k,C,P)&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner);break;case 6:wo(F={x:e,y:t},I={x:this.xscaled,y:this.yscaled},j={x:this.wscaled,y:this.hscaled})<10&&(v=!0,r.seteditaction(1)),e>this.wscaled-D&&e<this.wscaled+D&&t>this.hscaled-D&&t<this.hscaled+D&&6!=this.subtype&&(v=!0,r.seteditaction(2),this.scalecorner=4),e>this.xscaled-D&&e<this.xscaled+D&&t>this.yscaled-D&&t<this.yscaled+D&&6!=this.subtype&&(v=!0,r.seteditaction(2),this.scalecorner=4),e>this.xscaled-D&&e<this.xscaled+D&&t>this.yscaled-D&&t<this.yscaled+D&&(v=!0,r.seteditaction(2),this.scalecorner=1);break;case 7:if(wo(F={x:e,y:t},I={x:this.xscaled,y:this.yscaled},j={x:this.wscaled,y:this.hscaled})<10&&(v=!0,r.seteditaction(1)),e>this.wscaled-D&&e<this.wscaled+D&&t>this.hscaled-D&&t<this.hscaled+D&&(v=!0,r.seteditaction(2),this.scalecorner=4),e>this.xscaled-D&&e<this.xscaled+D&&t>this.yscaled-D&&t<this.yscaled+D&&(v=!0,r.seteditaction(2),this.scalecorner=4),e>this.xscaled-D&&e<this.xscaled+D&&t>this.yscaled-D&&t<this.yscaled+D&&(v=!0,r.seteditaction(2),this.scalecorner=1),0==this.leaderoffset)var X=this.xscaled+(this.wscaled-this.xscaled)/2,Y=this.yscaled+(this.hscaled-this.yscaled)/2;else X=this.labelpos.x+(this.labelpos.w-this.labelpos.x)/2,Y=this.labelpos.y+(this.labelpos.h-this.labelpos.y)/2;if(0!=R.w&&0!=R.h){var q=.5*R.w;e>X-q&&e<X+q&&t>Y-q&&t<Y+q&&(v=!0,r.seteditaction(6))}else e>X-D&&e<X+D&&t>Y-D&&t<Y+D&&(v=!0,r.seteditaction(6));break;case 8:if(F={x:e,y:t},I={x:this.xscaled,y:this.yscaled},j={x:this.wscaled,y:this.hscaled},A={x:I.x-(j.x-I.x)/10,y:j.y-(j.y-I.y)/2},v=Co(d,c,h,r.xoffset,r.yoffset,r.sides,F,A),this.holes.length>0)for(var Z=0;Z<this.holes.length;Z++)this.holes[Z].selectedit&&(v=!1);if(v&&r.seteditaction(1),r.selectedit){var J=0;for(J=0;J<r.points.length;J++)if(p=(r.points[J].x-this.xoffset)*d,u=(r.points[J].y-this.yoffset)*d,p+=c,u+=h,J==r.points.length-1?(g=(r.points[0].x-this.xoffset)*d,f=(r.points[0].y-this.yoffset)*d,g+=c,f+=h,L=J,V=0):(g=(r.points[J+1].x-this.xoffset)*d,f=(r.points[J+1].y-this.yoffset)*d,g+=c,f+=h,L=J,V=J+1),wo(F={x:e,y:t},I={x:p,y:u},j={x:g,y:f})<5&&(v=!0,r.seteditaction(7),r.linesegment={p1:L,p2:V}),e>p-8&&e<p+8&&t>u-8&&t<u+8){v=!0,r.selectedpoint=J,r.seteditaction(4);break}return r.insidelabel(e,t)&&(v=!0,r.seteditaction(8)),v}break;case 9:if(1==this.subtype||2==this.subtype)r.Getwithin(e,t,w,k,C,P)&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner);else if(0==this.subtype){this.hscaled=this.textheight*d,this.wscaled=this.textwidth;var K=this.wscaled,$=this.hscaled,Q=K;switch(this.textrotate/(Math.PI/180)){case 0:0==this.subtype?r.Getwithin(e,t,this.xscaled,this.xscaled+K,this.yscaled-$,this.yscaled)&&(v=!0,r.seteditaction(1)):1!=this.subtype&&2!=this.subtype||r.Getwithin(e,t,this.xscaled,this.xscaled+K,this.yscaled+$,this.yscaled)&&(v=!0,r.seteditaction(1));break;case 90:K=$,$=Q;var ee=Math.min(this.xscaled,this.xscaled+K),te=Math.max(this.xscaled,this.xscaled+K),ae=Math.min(this.yscaled,this.yscaled+$),ie=Math.max(this.yscaled,this.yscaled+$);r.Getwithin(e,t,ee,te,ae,ie)&&(v=!0,r.seteditaction(1));break;case 180:ee=Math.min(this.xscaled,this.xscaled-K),te=Math.max(this.xscaled,this.xscaled-K),ae=Math.min(this.yscaled,this.yscaled+$),ie=Math.max(this.yscaled,this.yscaled+$),r.Getwithin(e,t,ee,te,ae,ie)&&(v=!0,r.seteditaction(1));break;case 270:K=$,$=Q,ee=Math.min(this.xscaled,this.xscaled-K),te=Math.max(this.xscaled,this.xscaled-K),ae=Math.min(this.yscaled,this.yscaled-$),ie=Math.max(this.yscaled,this.yscaled-$),r.Getwithin(e,t,ee,te,ae,ie)&&(v=!0,r.seteditaction(1))}(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner)}break;case 10:Ti?e>this.xscaled&&e<this.xscaled+this.w&&t>this.yscaled&&t<this.yscaled+this.h&&(v=!0,r.seteditaction(1)):e>this.xscaled&&e<this.xscaled+this.wscaled&&t>this.yscaled&&t<this.yscaled+this.hscaled&&(v=!0,r.seteditaction(1));break;case 11:(1==r.subtype||3==r.subtype||5==r.subtype||12==r.subtype||20==r.subtype||21==r.subtype)&&(r.Getwithin(e,t,this.xscaled,this.xscaled+this.wscaled,this.yscaled,this.yscaled+this.hscaled)&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner));break;case 12:e>this.xscaled&&e<this.xscaled+this.wscaled&&t>this.yscaled&&t<this.yscaled+this.hscaled&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner);break;case 13:r.bfor3D&&(d=ai/r.pageheight);var se=0;for(se=0;se<r.countshapes.length;se++)if(p=(r.countshapes[se].x-this.xoffset)*d,u=(r.countshapes[se].y-this.yoffset)*d,F={x:e,y:t},I={x:p+=c,y:u+=h},e>p-8&&e<p+8&&t>u-8&&t<u+8){v=!0,r.selectedpoint=se,r.seteditaction(4);break}break;case 14:var re={x:r.startXscaled,y:r.startYscaled},ne={x:r.secondXscaled,y:r.secondYscaled},oe={x:r.endXscaled,y:r.endYscaled};if((v=ol.isclose(re,ne,oe,{x:e,y:t},5))&&r.seteditaction(1),e>re.x-8&&e<re.x+8&&t>re.y-8&&t<re.y+8){v=!0,r.selectedpoint=1,r.seteditaction(4);break}if(e>ne.x-8&&e<ne.x+8&&t>ne.y-8&&t<ne.y+8){v=!0,r.selectedpoint=2,r.seteditaction(4);break}if(e>oe.x-8&&e<oe.x+8&&t>oe.y-8&&t<oe.y+8){v=!0,r.selectedpoint=3,r.seteditaction(4);break}break;case 20:1!=r.subtype&&3!=r.subtype||(r.Getwithin(e,t,this.xscaled,this.xscaled+this.wscaled,this.yscaled,this.yscaled+this.hscaled)&&(v=!0,r.seteditaction(1)),(U=r.GetwithinCorner(x.x,x.y)).within&&(v=!0,r.seteditaction(U.editaction),this.scalecorner=U.scalecorner))}return v},this.ispointwithinarea=function(e,t){if(r.noDraw)return!1;var a=ro(r.pagenumber),i=a.x,s=a.y,n=lo();n/=r.scaling;var o=!1,l={x:e,y:t},c=Math.min(this.xscaled,this.xscaled+this.wscaled),h=Math.max(this.xscaled,this.xscaled+this.wscaled),d=Math.min(this.yscaled,this.yscaled+this.hscaled),p=Math.max(this.yscaled,this.yscaled+this.hscaled);switch(this.type){case 3:r.Getwithin(e,t,c,h,d,p)&&(o=!0),r.GetwithinCorner(l.x,l.y).within&&(o=!0);break;case 8:var u={x:e,y:t},g={x:this.xscaled,y:this.yscaled},f={x:this.wscaled,y:this.hscaled},m={x:g.x-(f.x-g.x)/10,y:f.y-(f.y-g.y)/2};o=Co(n,i,s,r.xoffset,r.yoffset,r.sides,u,m)}return o},this.setdisplay=function(e){if(0!=r.type||1!=r.subtype){if(r.holes.length>0)for(var t=0;t<r.holes.length;t++){var a=hn.getmarkupobjbynumber(r.holes[t].markupnumber);null!=a&&(a.display=e)}r.display=e}},this.showperimeter=function(e){r.bshowperimeter=e}}}function hl(e,t){var a=0,i=!1,s=-1;for(a=hn.markupdraworder.length;a>0;a--){var r=hn.markupdraworder[a-1];if(null!=hn.markuplist[r]){var n=Ol(hn.markuplist[r]);if(hn.markuplist[r].iswithin(e,t)&&hn.markuplist[r].signature==Fr&&hn.markuplist[r].display&&n)switch(hn.markuplist[r].type){case 9:Dl(),bl(),hn.markuplist[r].setselectedit(!0),hn.markuplist[r].setselect(!1),i=!0,s=hn.markuplist[r].markupnumber}}if(i)break}return s}function dl(e){var t=0;if(null!=hn&&null!=hn){var a=e.pagenumber;for(t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&hn.markuplist[t].pagenumber==a&&hn.markuplist[t].updatePageMarkup(e)}}function pl(e,t){var a=0,i=-1;if(!Yi)return i;for(a=0;a<hn.markuplist.length;a++)if(hn.markupdraworder[a],null!=hn.markuplist[a]){var s=Ol(hn.markuplist[a]);hn.markuplist[a].iswithin(e,t)&&hn.markuplist[a].display&&s&&(i=hn.markuplist[a].markupnumber)}return i}function ul(){var e=0;for("undefined"!=typeof Storage&&(localStorage.clear(),hh(os),ch(0,"",!1)),e=0;e<hn.markuplist.length;e++)(1==hn.markuplist[e].selected||hn.markuplist[e].selectedit)&&(fs||hn.getMarkupMultiselected()?qc(hn.markuplist[e],!0):Yc(hn.markuplist[e]))}function gl(){for(var e={isempty:!0},t=0;t<hn.markuplist.length;t++)(hn.markuplist[t].selected||hn.markuplist[t].selectedit)&&(e=hn.markuplist[t].bhasArrow&&null!=hn.markuplist[t].markupArrowConnected?hn.markuplist[t].markupArrowConnected:hn.markuplist[t]);return e}function fl(e,t){var a=0;for(a=0;a<hn.markuplist.length;a++)hn.markuplist[a].markupnumber==e&&ml(hn.markuplist[a],t)}function ml(e,t){e&&null!=e.ChangeMarkup&&"function"==typeof e.ChangeMarkup&&e.ChangeMarkup(t)}function yl(e,t){var i=0;if(fs)var s=bi+=1;for(i=0;i<hn.markuplist.length;i++)(hn.markuplist[i].selected||hn.markuplist[i].selectedit||t)&&(fs&&hn.markuplist[i].setmultiValues(s),ml(hn.markuplist[i],e));4==e&&-1!=hn.selectedmarkup.id&&hn.selectedmarkup.edit&&hn.selectedmarkup.selected&&ml(hn.markuplist[hn.selectedmarkup.id],e),Vl(n),Nl(a)}function vl(e){for(var t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&hn.markuplist[t].markupnumber==e&&(hn.markuplist[t].selected&&(hn.markuplist[t].setselect(!1),hn.markuplist[t].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[t])),hn.markuplist[t].selectedit&&(hn.markuplist[t].setselectedit(!1),hn.markuplist[t].bpointEdit=!1,hn.markuplist[t].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[t])))}function xl(e){for(var t=0;t<yn.length;t++)for(var a=0;a<yn[t].markuplist.length;a++)null!=yn[t].markuplist[a]&&yn[t].markuplist[a].getUniqueID()==e&&(yn[t].markuplist[a].bhasArrow&&null!=yn[t].markuplist[a].markupArrowConnected&&yn[t].markuplist[a].markupArrowConnected.setdelete(),yn[t].markuplist[a].setdelete());Fl()}function bl(){if(null!=hn){for(var e=0;e<hn.markuplist.length;e++)null!=hn.markuplist[e]&&hn.markuplist[e].selectedit&&(hn.markuplist[e].setselectedit(!1),hn.markuplist[e].bpointEdit=!1,null!=aa&&aa.setMarkupunSelected(hn.markuplist[e]));Vl(n),Nl(a)}}function wl(e){for(var t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&hn.markuplist[t].selectedit&&13==hn.markuplist[t].type&&(hn.markuplist[t].insertcount(e),"markupedit"==cn.name&&cn.disablePointInsert())}function kl(){hn.unselectallBlocks()}function Dl(){if(null!=hn){for(var e=0;e<hn.markuplist.length;e++)null!=hn.markuplist[e]&&(hn.markuplist[e].selected&&(hn.markuplist[e].setselect(!1),hn.markuplist[e].bUsemouseinput=!0,hn.markuplist[e].unselected=!0),hn.markuplist[e].marked&&hn.markuplist[e].setmarked(!1));Vl(n),Nl(a)}}function Cl(e){var t=0,a=void 0;for(t=hn.markuplist.length;t>0;t--)if(null!=hn.markuplist[t-1]&&hn.markuplist[t-1].display&&hn.markuplist[t-1].pagenumber==hn.getcurPage()&&8==hn.markuplist[t-1].type&&1==hn.markuplist[t-1].subtype){var i=e.toString();hn.markuplist[t-1].findAttribute("SpaceID",i)&&(a=hn.markuplist[t-1])}return a}function Rl(e,t,i){var s=0,r=!1;for(s=hn.markuplist.length;s>0;s--)if(null!=hn.markuplist[s-1]&&hn.markuplist[s-1].display&&hn.markuplist[s-1].pagenumber==hn.getcurPage()&&8==hn.markuplist[s-1].type&&1==hn.markuplist[s-1].subtype){var o=e.toString();hn.markuplist[s-1].findAttribute("SpaceID",o)&&(r=!0,i?(hn.markuplist[s-1].alternative=1,hn.markuplist[s-1].fillcolor=t):hn.markuplist[s-1].alternative=0)}return Vl(n),Nl(a),r}function Pl(e,t,i){var s=0,r=[],o={found:!1,blink:!1,id:-1,locked:!1,index:-1};if(null==hn||null==hn)return;hn.setMarkupMultiselected(),fs||hn.getMarkupMultiselected()||Dl();let l=[];for(s=hn.markupdraworder.length;s>0;s--){var c=hn.markupdraworder[s-1];if(null!=hn.markuplist[c]){var h=Ol(hn.markuplist[c]);if(hn.markuplist[c].display&&h&&hn.markuplist[c].iswithin(e,t)){var d=s-1;if(hn.markuplist[c].holes.length>0)for(var p=0;p<hn.markuplist[c].holes.length;p++)if(hn.getmarkupobjbynumber(hn.markuplist[c].holes[p].markupnumber).iswithin(e,t)){var u=hn.getmarkupbynumber(hn.markuplist[c].holes[p].markupnumber);d=u,c=u}if(r.push(d),o=hn.markuplist[c].onselect(c,i),l.push(c),!D){o=hn.markuplist[c].onselect(c,i),hn.markupdraworderChange=!1;break}o=hn.markuplist[c].onselect(c,i)}}}if(hn.markupdraworderChange){for(var g=0;g<r.length;g++){var f=hn.markupdraworder[r[g]],m=hn.markupdraworder[hn.markupdraworder.length-1];hn.markupdraworder[hn.markupdraworder.length-1]=f,hn.markupdraworder[r[g]]=m}r.length>0&&(hn.markupdraworderChange=!1)}else r.length>0&&D&&(hn.markupdraworderChange=!0);if(fs||hn.getMarkupMultiselected()||function(e){for(var t=!1,i=!1,s=0;s<hn.markuplist.length;s++)t=hn.markuplist[s].markupnumber!=e,hn.markuplist[s].bhasArrow&&null!=hn.markuplist[s].markupArrowConnected&&(i=e==hn.markuplist[s].markupArrowConnected.markupnumber),hn.markuplist[s].bisTextArrow&&null!=hn.markuplist[s].textBoxConnected&&(i=e==hn.markuplist[s].textBoxConnected.markupnumber),t=!i&&hn.markuplist[s].markupnumber!=e,null!=hn.markuplist[s]&&t&&(hn.markuplist[s].selected&&(hn.markuplist[s].setselect(!1),hn.markuplist[s].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[s])),hn.markuplist[s].selectedit&&(hn.markuplist[s].setselectedit(!1),hn.markuplist[s].bpointEdit=!1,hn.markuplist[s].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[s])));Vl(n),Nl(a)}(o.id),!o.found)for(s=0;s<hn.markuplist.length;s++)null!=hn.markuplist[s]&&(hn.markuplist[s].setselect(!1),hn.markuplist[s].bUsemouseinput=!0,hn.markuplist[s].setselectedit(!1),hn.markuplist[s].bpointEdit=!1,hn.markuplist[s].resetcupoint());return hn.setMarkupMultiselected(),function(){for(var e=0;e<hn.markuplist.length;e++)null!=hn.markuplist[e]&&!hn.markuplist[e].selected&&hn.markuplist[e].unselected&&(hn.markuplist[e].unselected=!1,null!=aa&&aa.setMarkupunSelected(hn.markuplist[e]))}(),function(e,t,a){a?null!=$t&&null!=t&&(9==t.type&&t.subtype,$t.setMarkupSelected(t,{created:!1,modified:!0,deleted:!1})):null!=$t&&(-1==e?$t.setMarkupSelected(e,{created:!1,modified:!1,deleted:!1}):(9==t.type&&t.subtype,$t.setMarkupSelected(t,{created:!1,modified:!1,deleted:!1})))}(o.id,hn.markuplist[o.index],o.found),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),{id:o.id,blink:o.blink,index:o.index,locked:o.locked}}function Sl(e){var t=0,i=0,s=[];for(t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&(hn.markuplist[t].signature,e==hn.markuplist[t].markupnumber?(8==hn.markuplist[t].type&&2==hn.markuplist[t].subtype&&Tl(hn.markuplist[t].parent,e),null!=$t&&$t.setMarkupSelected(hn.markuplist[t],{created:!1,modified:!1,deleted:!0})):(s[i]=hn.markuplist[t],i++));hn.markuplist=s,hn.nummarkups=hn.markuplist.length,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Vl(n),Nl(a)}function Ml(e){var t=0,i=0,s=[];for(hn.markupdraworder=[],fs&&(bi+=1),t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&(hn.markuplist[t].markupID==e||(s[i]=hn.markuplist[t],hn.markupdraworder[i]=i,i++));hn.markuplist=s,hn.nummarkups=hn.markuplist.length,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Vl(n),Nl(a)}function Tl(e,t){var a=0,i=0,s=(t=-1,[]),r=!0;for(a=0;a<e.holes.length;a++)(e.holes[a].id=t)?(t=e.markupnumber,r=!1,null!=$t&&$t.setMarkupSelected(e.holes[a],{created:!1,modified:!1,deleted:!0})):(s[i]=e.holes[a],i++);return e.holes=s,r}function El(e){var t=0,a=0,i=[],s=!0;for(t=0;t<e.holes.length;t++)e.holes[t].selectedit?(e.markupnumber,s=!1,null!=$t&&$t.setMarkupSelected(e.holes[t],{created:!1,modified:!1,deleted:!0})):(i[a]=e.holes[t],a++);return e.holes=i,s}function Fl(){var e=0,t=0,i=-1,s=[];if(hn.markupdraworder=[],fs)var r=bi+=1;for(e=0;e<hn.markuplist.length;e++)if(null!=hn.markuplist[e]){var o=hn.markuplist[e].signature==Fr,l=8==hn.markuplist[e].type&&2==hn.markuplist[e].subtype,c=hn.markuplist[e].getdelete(),h=hn.markuplist[e].selected||hn.markuplist[e].selectedit;o&&h||c?(i=hn.markuplist[e].markupnumber,fs&&hn.markuplist[e].setmultiValues(r),l&&hn.markuplist[e].parent.holes.length>0&&(h=El(hn.markuplist[e].parent)),rl(i,3),null!=$t&&$t.setMarkupSelected(hn.markuplist[e],{created:!1,modified:!1,deleted:!0})):(s[t]=hn.markuplist[e],hn.markupdraworder[t]=t,t++)}hn.markuplist=s,hn.nummarkups=hn.markuplist.length,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Vl(n),Nl(a)}function Il(e,t,a,i,s,r){if(null!=hn&&null!=hn){var n=0;if(hn.Drawmarkup)for(n=0;n<hn.markuplist.length;n++)null!=hn.markuplist[n]&&hn.markuplist[n].pagenumber==t&&hn.markuplist[n].display&&hn.markuplist[n].drawprint(e,a,i,s,r,!1)}}function jl(e,t,a,i,s){var r=0;if(null!=uu().docObj){for(r=0;r<uu().docObj.markuplist.length;r++){var n=Ol(hn.markuplist[r]);null!=uu().docObj.markuplist[r]&&uu().docObj.markuplist[r].pagenumber==t&&uu().docObj.markuplist[r].display&&(uu().docObj.markuplist[r].bfor3D?n&&uu().docObj.markuplist[r].drawprint(e,a,i,s,0,!1):uu().docObj.markuplist[r].drawprint(e,a,i,s,0,!1))}null!=za&&(null!=uu().docObj.pages[t]?(uu().docObj.foxitdoc,za.printpageComplete(uu().docObj.pages[t].printobj)):Qi[t]=!0)}}function Al(){var e=0,t=function(){var e=0,t=0,a=0,i=0;for(e=0;e<hn.markuplist.length;e++)null!=hn.markuplist[e]&&(a=t,(t=hn.markuplist[e].markupnumber)>a&&(i=t));return i}();t>e&&(e=t);var a=function(){var e=0,t=0,a=0,i=0;for(e=0;e<hn.markupundolist.length;e++)null!=hn.markupundolist[e]&&(a=t,(t=hn.markupundolist[e].markupnumber)>a&&(i=t));return i}();a>e&&(e=a);var i=function(){var e=0,t=0,a=0,i=0;for(e=0;e<hn.markupredolist.length;e++)null!=hn.markupundolist[e]&&(a=t,(t=hn.markupredolist[e].markupnumber)>a&&(i=t));return i}();return i>e&&(e=i),e+1}function Ol(e){return e.bfor3D?e.viewname==hn.getcur3DView():hn.visiblepage(e.pagenumber)}function Ll(e){var t=0;for(t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&hn.markuplist[t].setdisplay(e)}function Vl(e){if(null!=hn&&null!=hn){var t=Bl();if(xi&&t)e.clearRect(0,0,ti,ai);else{var a=0,i=!0;if(e.clearRect(0,0,ti,ai),null!=hn.getCurrentThumb()&&(hn.getCurrentThumb().draw_thumbnail(),hn.getCurrentThumb().clearBirdseyeMarkupctx()),hn.drawHoverSpace(e),!Ni&&hn.getCurrentpage()){if(hn.getCurrentpage().Vector3DPageObj&&(hn.getCurrentpage().Vector3DPageObj.renderMarkupPoints(n),i=!1),hn.Drawmarkup)for(a=0;a<hn.markupdraworder.length;a++){var s=hn.markuplist[hn.markupdraworder[a]];if(null!=s){if(!s.selected&&!s.selectedit&&s.display&&null!=s.pagenumber&&i){var r=hn.getThumb(s.pagenumber);s.bfor3D&&(r=void 0),null!=r&&s.drawbirdseye(r)}if(Ol(s)){var o=!1;if(s.holes.length>0)for(var l=0;l<s.holes.length;l++)(s.holes[l].selected||s.holes[l].selectedit)&&(o=!0);s.selected||s.selectedit||o||!s.display||(r=hn.getThumb(s.pagenumber),s.drawthumb(r.thumbctx),s.drawmescaled(e))}}}else for(a=0;a<hn.markupdraworder.length;a++)null!=(s=hn.markuplist[hn.markupdraworder[a]])&&Ol(s)&&0==s.type&&1==s.subtype&&s.display&&(i&&null!=hn.getCurrentThumb()&&(s.drawthumb(hn.getCurrentThumb().thumbctx),s.drawbirdseye(hn.getCurrentThumb())),s.drawmescaled(e));Yd(),yd()||mi||hn.drawselectedBlocks()}}}}function Nl(e){if(null!=hn&&null!=hn&&null!=cn&&null!=cn){var t=Bl();if(xi&&t)e.clearRect(0,0,ti,ai);else{var a=0;if(e.clearRect(0,0,ti,ai),cn.refreshSupport&&cn.refreshDraw(),hn)if(hn.Drawmarkup)for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&Ol(hn.markuplist[a])&&(hn.markuplist[a].selected||hn.markuplist[a].selectedit)&&hn.markuplist[a].display&&(null!=hn.getCurrentThumb()&&(hn.markuplist[a].drawbirdseye(hn.getCurrentThumb()),hn.markuplist[a].drawthumb(hn.getCurrentThumb().thumbctx)),8==hn.markuplist[a].type&&2==hn.markuplist[a].subtype?hn.markuplist[a].parent&&hn.markuplist[a].parent.drawmescaled(e):hn.markuplist[a].drawmescaled(e));else for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&Ol(hn.markuplist[a])&&0==hn.markuplist[a].type&&1==hn.markuplist[a].subtype&&hn.markuplist[a].display&&(null!=hn.getCurrentThumb()&&(hn.markuplist[a].drawbirdseye(hn.getCurrentThumb()),hn.markuplist[a].drawthumb(hn.getCurrentThumb().thumbctx)),8==hn.markuplist[a].type&&2==hn.markuplist[a].subtype?hn.markuplist[a].parent&&hn.markuplist[a].parent.drawmescaled(e):hn.markuplist[a].drawmescaled(e))}}}function Bl(){return null==hn||null==hn||null==hn.getcur3DView()}function Ul(e){for(var t=0,a=0;a<e.length;a++)t+=e[a],a<e.length-1&&(t<<=8);return t}function Gl(e,t){for(var a=0;a<e.chunks.length;a++)if(e.chunks[a].name=t)return e.chunks[a];return null}function zl(e,t){var a=Ul(e.slice(t,t+4)),i="";i+=String.fromCharCode(e[t+4]),i+=String.fromCharCode(e[t+5]),i+=String.fromCharCode(e[t+6]),i+=String.fromCharCode(e[t+7]);for(var s=[],r=t+8;r<a+t+8;r++)s.push(e[r]);return{start:t,end:Number(t)+Number(a)+12,length:a,name:i,data:s,crc:[e[a+t+8],e[a+t+9],e[a+t+10],e[a+t+11]],crcChecked:!1}}function Hl(){var e=window.devicePixelRatio||1;return e!=we&&(ke||(ke=!0,alert("the browser window scaling has changed, restart the viewer"))),e/1}function _l(e){Hl();e.transform(1,0,0,1,.5,.5)}function Wl(e){return e+(e>0?.5:-.5)<<0}class Xl{constructor(e,t,a,i,s){var r=this;this.type="text",this.textwidthset=!1,this.textwidth=a.height,this.parent=t,this.blockname=i,this.index=s,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.height=a.height,this.fontname=a.name,this.weight=a.weight,this.rotation=-a.rotation*(Math.PI/180),this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.text=e.text,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.selected=!1,this.hasArea=!1,this.entityType=e.entityType,this.role=e.role,this.mouseon=!1,this.mouseover=!1;var n=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1,d=r.getRectangle(a,i,s,n,o,l);return e>d.x&&e<d.x+d.w&&t>d.y&&t<d.y+d.h&&(h=!0),h},this.getArea=function(){var e=r.x1,t=r.y1,a=t+r.height,i=e+r.textwidth;if(e>i){var s=e;e=i,i=s}if(t>a){var n=t;t=a,a=n}return(i-e)*(a-t)},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x1-i)*e,l=(n-r.y1)*e,c=l+r.height*e,h=o+r.textwidth*e;if((o+=t)>(h+=t)){var d=o;o=h,h=d}if((l+=a)>(c+=a)){var p=l;l=c,c=p}var u={x:o,y:l};if(0!=r.rotation){var g=function(e,t,a){var i=e.x,s=e.y,r=e.w,n=e.h,o=t,l=Math.cos(o),c=Math.sin(o),h=a.x,d=a.y,p=i-h,u=s-d,g=p*l-u*c,f=p*c+u*l;g=h+g,f=d+f;var m=(p=r-h)*l-(u=n-d)*c,y=p*c+u*l;return m=h+m,y=d+y,{x:Math.min(g,m),y:Math.min(f,y),w:Math.max(m,g),h:Math.max(y,f)}}({x:o,y:l,w:h,h:c},r.rotation,u);o=g.x,l=g.y,h=g.w,c=g.h}return{found:!0,x:o,y:l,w:h-o,h:c-l,wp:(h-o)/10,hp:(c-l)/10}},this.findsnapPoint=function(e,t,a,i,s,r,n,o){return{found:!1,x:0,y:0,type:1}},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),a=t=r.stroketempcolor,r.stroketempcolor=a):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor,r.filltempcolor=r.fillcolor,a=r.filltempcolor):(r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),this.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor))),e&&"#FFFFFF"==r.strokecolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),e&&"#FFFFFF"==r.fillcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?(t=r.parent.backgroundColor,a=r.parent.backgroundColor):2==r.role&&(t=r.parent.overlayColor,a=r.parent.overlayColor)),n&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.setTextWidth=function(e){if(!r.textwidthset){var t="normal "+r.height+"px "+r.fontname+", Helvetica";r.textwidth=function(e,t,a){e.save(),e.font=a;const i=e.measureText(t);return e.restore(),i.width}(e,r.text,t),r.textwidthset=!0}},this.highlight=function(e,t,a,i,s,o,l){n=!0,r.drawme(e,t,a,i,s,o,l,1,1,!1,!1),n=!1},this.drawme=function(e,t,a,i,s,o,l,c,h,d,p){var u=(r.x1-s)*t,g=(l-r.y1)*t,f=r.height*t;if(g+=f,0!=c&&0!=h&&hn){var m=r.getdrawColors(d);if(e.fillStyle=m.fillcolor,e.strokeStyle=m.linecolor,f<5)var y="normal "+f+"px "+r.fontname+", Helvetica";else y="normal "+f+"px "+r.fontname+", Helvetica";n&&(y="normal "+f+"1px "+r.fontname+", Helvetica"),e.font=y,g+=i,u=Wl(u+=a),g=Wl(g),e.save(),0!=r.rotation&&(e.translate(u,g-f),e.rotate(r.rotation),e.translate(-u,-(g-f))),e.fillText(r.text,u,g),e.restore(),r.setTextWidth(e),r.drawcompare=!1}},this.Close=function(){}}}class Yl{constructor(e,t,a,i,s){var r=this;this.parent=t,this.index=s,this.type="image",this.magnify=e.magnify,this.pagenumber=0,this.pdfisrendered=!1,this.pdfpagewidth=0,this.pdfpageheight=0,this.cleanupAfterRender=!0,this.pageRendering=!1,this.pdfrenderopque=0,this.dimset=!1,this.bMaxzoom=!1,this.nPDFMaxFactor=4,this.viewport=null,this.dscalepdf=1,this.pdfpagescale=1,this.image=void 0,this.blockname=a,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this.width=this.x2-t.x-(this.x1-t.x),this.height=t.h-this.y1-(t.h-this.y2),this.role=e.role,this.isoverlay=!1,this.isbackground=!1,this.bdrawn=!1,this.numcolors=0,this.mouseon=!1,this.mouseover=!1,this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.selected=!1,this.hasArea=!1,this.imageloaded=!1,this.invertible=!1,this.imagecnv=document.createElement("canvas"),this.imagectx=this.imagecnv.getContext("2d",{willReadFrequently:!0}),1!=e.role&&2!=e.role||(this.invertible=!0),this.setpdfScale=function(e,t){r.dscalepdf=e,r.pdfpagescale=t},this.setPageBitmap=function(e){e.error?r.pdfisrendered=!1:0!=e.width&&0!=e.height&&t&&(0==t.comparemode?(1==r.role&&r.invert(e,t.backgroundColor),2==r.role&&r.invert(e,t.overlayColor)):1==t.comparemode&&(1==r.role&&r.invert(e),2==r.role&&r.invert(e)),1!=r.role&&2!=r.role||r.imageloaded||(r.imageloaded=!0,t.imageloadcomplete(r.role)),r.pdfrenderopque-=1,r.pdfrenderopque<=0&&(r.pdfrenderopque=0),r.pdfisrendered=!0,r.pageRendering=!1,t.refreshdraw())},this.getfoxitbitmap=function(e){if(!r.pageRendering){var t={x:r.x1,y:r.parent.h-r.y1-r.height,w:r.width,h:r.height};if(1==r.role){var a=r.parent.bgDocObjref,i=r.parent.bgpageindex;r.pdfpagewidth=a.pages[i].originalPDFwidth,r.pdfpageheight=a.pages[i].originalPDFheight}else 2==r.role&&(a=r.parent.fgDocObjref,i=r.parent.fgpageindex,r.pdfpagewidth=a.pages[i].originalPDFwidth,r.pdfpageheight=a.pages[i].originalPDFheight);if(t={x:r.x1,y:r.pdfpageheight-r.y1-r.height,w:r.width,h:r.height},null!=a&&null!=i&&(r.pageRendering=!0,(1==r.role||2==r.role)&&null!=a.foxitdoc)){if(r.nPDFMaxFactor=Math.sqrt(ws/(r.pdfpagewidth*r.pdfpageheight)),e>r.nPDFMaxFactor){var s=e/r.nPDFMaxFactor;e=r.nPDFMaxFactor,r.bMaxzoom=!0}else s=1,r.bMaxzoom=!1;r.setpdfScale(s,e),t.x=t.x*e,t.y=t.y*e,t.w=t.w*e,t.h=t.h*e,a.foxitdoc.getBitmapRect(i,e,t,r.setPageBitmap)}}},this.imageload=function(e){r.image=e.currentTarget,r.imagectx.drawImage(r.image,0,0),r.imageloaded=!0,t&&(1!=r.role&&2!=r.role||t.imageloadcomplete(r.role),t.refreshdraw())},this.getnumColors=function(){var e=r.imagectx.getImageData(0,0,r.imagecnv.width,r.imagecnv.height);r.numcolors=function(e){for(var t=1,a={r:e[0],g:e[1],b:e[2]},i={r:e[0],g:e[1],b:e[2]},s=0;s<e.length;s+=4)(i={r:e[s],g:e[s+1],b:e[s+2]}).r==a.r&&i.g==a.g&&i.b==a.b||(t++,a.r=i.r,a.g=i.g,a.b=i.b);return t}(e)},this.invert=function(e,a){if(r.bdrawn&&r.invertible){var i=new Uint8ClampedArray(e.buffer),s=new ImageData(i,e.width,e.height);a?function(e,t){for(var a=Nn(t),i=0;i<e.length;i+=4)255==e[i]&&255==e[i+1]&&255==e[i+2]||254==e[i]&&254==e[i+1]&&254==e[i+2]?e[i+3]=100:(e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b)}(s.data,a):1==t.comparemode&&2==r.role&&function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]&&(e[t+3]=100)}(s.data),r.imagecnv.width=e.width,r.imagecnv.height=e.height,r.imagectx.putImageData(s,0,0)}},this.countColors=function(e){},this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1,d=r.getRectangle(a,i,s,n,o,l);return e>d.x&&e<d.x+d.w&&t>d.y&&t<d.y+d.h&&(h=!0),h},this.getArea=function(){var e=r.x1,t=r.y1,a=r.x2,i=r.y2;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x1-i)*e,l=(n-r.y1)*e,c=(r.x2-i)*e,h=(n-r.y2)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.findsnapPoint=function(e,t,a,i,s,r,n,o){return{found:!1,x:0,y:0,type:1}},this.highlight=function(e,t,a,i,s,n,o){r.drawme(e,t,a+2,i+2,s,n,o,1,1,!1,!1)},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=(r.x1-s)*t,u=(o-r.y1)*t,g=(r.x2-s)*t,f=(o-r.y2)*t;if(0!=l&&0!=c&&hn&&(r.magnify||!d)&&(!r.magnify||d)){var m=(u+=i)-(f+=i),y=(g+=a)-(p+=a);if(p=Wl(p),f=Wl(f),(!r.parent.backgroundrender||d)&&!h){var v=ti,x=ai;if(d&&(v=Se.width,x=Se.height),p<0&&g<0)return;if(u<0&&f<0)return;if(p>v&&g>v)return;if(u>x&&f>x)return}r.imageloaded&&(r.pdfpagescale!=t&&(r.pdfrenderopque+=1,r.getfoxitbitmap(t)),e.drawImage(r.imagecnv,p,f,y,m),this.bdrawn=!0)}},this.Close=function(){},r.getfoxitbitmap(1)}}class ql{constructor(e,t,a,i,s){var r=this;this.parent=t,this.index=s,this.type="image",this.image=void 0,this.blockname=a,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this.width=this.x2-t.x-(this.x1-t.x),this.height=t.h-this.y1-(t.h-this.y2),this.entityType=e.entityType,this.entityType.type=18,this.role=e.role,this.isoverlay=!1,this.isbackground=!1,this.bdrawn=!1,this.numcolors=0,this.mouseon=!1,this.mouseover=!1,this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.selected=!1,this.hasArea=!1,this.imageloaded=!1,this.invertible=!1,this.imagecnv=document.createElement("canvas"),this.imagectx=this.imagecnv.getContext("2d",{willReadFrequently:!0});var n=new Image;function o(e){var t,a,i=function(e){var t={};if(t.headerIsValid=137==e[0]&&80==e[1]&&78==e[2]&&71==e[3]&&13==e[4]&&10==e[5]&&26==e[6]&&10==e[7],!t.headerIsValid)return console.warn("Provided data does not belong to a png"),t;var a=[],i=zl(e,8);for(a.push(i);"IEND"!==i.name;)i=zl(e,i.end),a.push(i);return t.chunks=a,t}(function(e){e=e.split("base64,")[1];for(var t=atob(e),a=new Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Uint8Array(a)}(e)),s=(a=Gl(t=i,"IDHR"),t.width=Ul(a.data.slice(0,4)),t.height=Ul(a.data.slice(4,8)),t.bitDepth=Ul(a.data.slice(8,9)),t.colorType=Ul(a.data.slice(9,10)),t.compressionMethod=Ul(a.data.slice(10,11)),t.filterMethod=Ul(a.data.slice(11,12)),t.interlaceMethod=Ul(a.data.slice(12,13)),t.isGreyScale=0==t.colorType||4==t.colorType,t.isRgb=2==t.colorType||6==t.colorType,t.hasAlpha=4==t.colorType||6==t.colorType,t.hasPaletteMode=3==t.colorType&&null!=Gl(t,"PLTE"),t);r.imagecnv.width=s.width,r.imagecnv.height=s.height,1==s.bitDepth&&(r.invertible=!0),n.onload=r.imageload,n.src=e}if(1!=e.role&&2!=e.role||(r.invertible=!0),this.imageload=function(e){r.image=e.currentTarget,r.imagectx.drawImage(r.image,0,0),r.imageloaded=!0,t&&(1!=r.role&&2!=r.role||t.imageloadcomplete(r.role),t.refreshdraw())},this.getnumColors=function(){var e=r.imagectx.getImageData(0,0,r.imagecnv.width,r.imagecnv.height);r.numcolors=function(e){for(var t=1,a={r:e[0],g:e[1],b:e[2]},i={r:e[0],g:e[1],b:e[2]},s=0;s<e.length;s+=4)(i={r:e[s],g:e[s+1],b:e[s+2]}).r==a.r&&i.g==a.g&&i.b==a.b||(t++,a.r=i.r,a.g=i.g,a.b=i.b);return t}(e)},this.invert=function(e){if(r.imageloaded&&r.invertible){var t=r.imagectx.getImageData(0,0,r.imagecnv.width,r.imagecnv.height);!function(e){for(var t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]}(t.data),r.imagectx.putImageData(t,0,0)}},this.countColors=function(e){},this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1,d=r.getRectangle(a,i,s,n,o,l);return e>d.x&&e<d.x+d.w&&t>d.y&&t<d.y+d.h&&(h=!0),h},this.getArea=function(){var e=r.x1,t=r.y1,a=r.x2,i=r.y2;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x1-i)*e,l=(n-r.y1)*e,c=(r.x2-i)*e,h=(n-r.y2)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.findsnapPoint=function(e,t,a,i,s,r,n,o){return{found:!1,x:0,y:0,type:1}},this.highlight=function(e,t,a,i,s,n,o){var l=r.getRectangle(t,a,i,s,n,o);e.strokeRect(l.x,l.y,l.w,l.h)},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=(r.x1-s)*t,u=(o-r.y1)*t,g=(r.x2-s)*t,f=(o-r.y2)*t;if(0!=l&&0!=c&&hn){var m=(u+=i)-(f+=i),y=(g+=a)-(p+=a);if(p=Wl(p),f=Wl(f),(!r.parent.backgroundrender||d)&&!h){var v=ti,x=ai;if(d&&(v=Se.width,x=Se.height),p<0&&g<0)return;if(u<0&&f<0)return;if(p>v&&g>v)return;if(u>x&&f>x)return}r.imageloaded&&(e.drawImage(r.imagecnv,p,f,y,m),this.bdrawn=!0)}},this.Close=function(){},e.useref){if(e.addcache)var l=zo(hn.FileNameSRC)+e.image;else l=e.image;Hn(l).then((function(e){o(e)}))}else o(e.image)}}function Zl(e,t,a,i,s,r,n,o,l,c,h,d){var p=(e.x1-r)*a,u=(o-e.y1)*a,g=(e.x2-r)*a,f=(o-e.y2)*a;if(0!=l&&0!=c&&hn&&(p+=i,u+=s,g+=i,f+=s,!(io(Math.max(p,g)-Math.min(p,g),Math.max(u,f)-Math.min(u,f))<.5))){if((!e.parent.backgroundrender||d)&&!h){var m=ti,y=ai;if(d&&(m=Se.width,y=Se.height),p<0&&g<0)return;if(u<0&&f<0)return;if(p>m&&g>m)return;if(u>y&&f>y)return}t.lineCap="round",t.strokeStyle=e.getlineColor(h),t.lineWidth=e.getlinewidth(a,h),p=Wl(p),u=Wl(u),g=Wl(g),f=Wl(f),t.beginPath(),t.moveTo(p,u),t.lineTo(g,f),t.stroke(),e.drawcompare=!1}}class Jl{constructor(e,t,a,i,s){var r=this;this.parent=t,this.index=s,this.type="line",this.blockname=a,this.blockstate=1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.entityType=e.entityType,this.role=e.role,this.hasArea=!1,this.selected=!1,this.linewidth=e.linewidth,this.originallinewidth=e.linewidth,this.mouseon=!1,this.mouseover=!1;var n=e.linewidth;this.linewidth=0==n?1:n,this.layerstate=e.layerstate,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2;var o=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x1-i)*e,l=(n-r.y1)*e,c=(r.x2-i)*e,h=(n-r.y2)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.findInterSections=function(e){return Sn(this.x1,this.y1,this.x2,this.y2,e.x1,e.y1,e.x2,e.y2)},this.getInterSection=function(e,t,a,i,s,n,o,l,c){var h=(r.x1-o)*i,d=(c-r.y1)*i,p=(r.x2-o)*i,u=(c-r.y2)*i;h+=s,d+=n,p+=s,u+=n;var g=(a.x1-o)*i,f=(c-a.y1)*i,m=(a.x2-o)*i,y=(c-a.y2)*i,v=Sn(h,d,p,u,g+=s,f+=n,m+=s,y+=n);return!!(v&&v.x>e-10&&v.x<e+10&&v.y>t-10&&v.y<t+10)&&v},this.iswithin=function(e,t,a,i,s,n,o,l,c){return r.closeToMouse(e,t,a,i,s,n,o,l)},this.closeToMouse=function(e,t,a,i,s,n,o,l){var c=!1,h=(r.x1-n)*a,d=(l-r.y1)*a,p=(r.x2-n)*a,u=(l-r.y2)*a;return wo({x:e,y:t},{x:h+=i,y:d+=s},{x:p+=i,y:u+=s})<5&&(c=!0),c},this.getArea=function(){var e=r.x1,t=r.y1,a=r.x2,i=r.y2;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return 0},this.findsnapPoint=function(e,t,a,i,s,n,o,l){var c=(r.x1-n)*a,h=(l-r.y1)*a,d=(r.x2-n)*a,p=(l-r.y2)*a,u=10,g=.5*((c+=i)+(d+=i)),f=.5*((h+=s)+(p+=s));return c>e-u&&c<e+u&&h>t-u&&h<t+u?{found:!0,x:c,y:h,type:1}:d>e-u&&d<e+u&&p>t-u&&p<t+u?{found:!0,x:d,y:p,type:1}:g>e-u&&g<e+u&&f>t-u&&f<t+u?{found:!0,x:g,y:f,type:3}:{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth*e<1?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),o&&(a=ps),a},this.getlineColor=function(e){var t=r.stroketempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor):r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),e&&"#FFFFFF"==r.stroketempcolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?t=r.parent.backgroundColor:2==r.role&&(t=r.parent.overlayColor)),o&&(t=ds),t},this.highlight=function(e,t,a,i,s,n,l){o=!0,r.drawme(e,t,a,i,s,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=(r.x1-s)*t,u=(o-r.y1)*t,g=(r.x2-s)*t,f=(o-r.y2)*t;if(0!=l&&0!=c&&hn){if(p+=a,u+=i,g+=a,f+=i,!r.parent.backgroundrender||d){var m=ti,y=ai;if(d&&(m=Se.width,y=Se.height),p<0&&g<0)return;if(u<0&&f<0)return;if(p>m&&g>m)return;if(u>y&&f>y)return}e.lineCap="round",e.strokeStyle=r.getlineColor(h),e.lineWidth=r.getlinewidth(t,h),e.beginPath(),e.moveTo(p,u),e.lineTo(g,f),e.stroke(),r.drawcompare=!1}},this.Close=function(){}}}class Kl{constructor(e,t,a,i,s){var r=this;this.type="linesArray",this.parent=t,this.index=s,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1,this.mouseover=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.linesarray=e.lines,this.x=0,this.y=0,this.w=0,this.h=0;var o=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.closeToMouse=function(e,t,a,i,s,n,o,l){var c=r.getRectangle(a,i,s,n,o,l),h=!1;return wo({x:e,y:t},{x:c.x,y:c.y},{x:c.x+c.w,y:c.y+c.h})<5&&(h=!0),h},this.findrectangle=function(){for(var e=Math.min(r.linesarray[0].x1,r.linesarray[0].x2),t=Math.min(r.linesarray[0].y1,r.linesarray[0].y2),a=e,i=t,s=1;s<r.linesarray.length;s++){var n=Math.min(r.linesarray[s].x1,r.linesarray[s].x2),o=Math.min(r.linesarray[s].y1,r.linesarray[s].y2);n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}this.x=e,this.y=t,this.w=a,this.h=i},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1;if(0==r.entityType.type)h=r.closeToMouse(e,t,a,i,s,n,o,l);else if(17==r.entityType.type){var d=r.getRectangle(a,i,s,n,o,l);e>d.x&&e<d.x+d.w&&t>d.y&&t<d.y+d.h&&(h=!0)}return h},this.getArea=function(){var e=r.x,t=r.y,a=r.w,i=r.h;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x-i)*e,l=(n-r.y)*e,c=(r.w-i)*e,h=(n-r.h)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.findsnapPoint=function(e,t,a,i,s,r,n,o){return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth*e<1?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),o&&(a=ps),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor,r.filltempcolor=r.fillcolor,a=r.filltempcolor):(r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),this.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor))),e&&"#FFFFFF"==r.strokecolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),e&&"#FFFFFF"==r.fillcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?(t=r.parent.backgroundColor,a=r.parent.backgroundColor):2==r.role&&(t=r.parent.overlayColor,a=r.parent.overlayColor)),o&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,s,n,l){o=!0,r.drawme(e,t,a,i,s,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=0,u=0,g=0,f=0;if(0!=l&&0!=c&&hn){r.render=!0;var m=(r.x-s)*t,y=(o-r.y)*t,v=(r.w-s)*t,x=(o-r.h)*t;if(m+=a,v+=a,y+=i,x+=i,io(Math.max(m,v)-Math.min(m,v),Math.max(y,x)-Math.min(y,x))<20)r.render=!1;else{if((!r.parent.backgroundrender||d)&&!h){var b=ti,w=ai;if(d&&(b=Se.width,w=Se.height),m<0&&v<0||y<0&&x<0)return void(r.render=!1);if(m>b&&v>b||y>w&&x>w)return void(r.render=!1)}var k=r.getdrawColors(h);e.fillStyle=k.fillcolor,e.strokeStyle=k.linecolor,e.lineWidth=r.getlinewidth(t,h),e.beginPath();for(var D=0;D<r.linesarray.length;D++)p=(r.linesarray[D].x1-s)*t,u=(o-r.linesarray[D].y1)*t,g=(r.linesarray[D].x2-s)*t,f=(o-r.linesarray[D].y2)*t,p+=a,u+=i,g+=a,f+=i,e.moveTo(p,u),e.lineTo(g,f);e.stroke(),r.drawcompare=!1}}},this.Close=function(){},this.findrectangle()}}class $l{constructor(e,t,a,i,s){var r=this;this.type="dotArray",this.parent=t,this.index=s,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1,this.mouseover=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.dotarray=e.dots,this.r=this.linewidth,this.x=0,this.y=0,this.w=0,this.h=0;var o=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.closeToMouse=function(e,t,a,i,s,n,o,l){var c=r.getRectangle(a,i,s,n,o,l),h=!1;return wo({x:e,y:t},{x:c.x,y:c.y},{x:c.x+c.w,y:c.y+c.h})<5&&(h=!0),h},this.findrectangle=function(){for(var e=r.dotarray[0].x,t=r.dotarray[0].y,a=r.dotarray[0].x,i=r.dotarray[0].y,s=2;s<r.dotarray.length;s++){var n=r.dotarray[s].x,o=r.dotarray[s].y;n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}this.x=e,this.y=t,this.w=a,this.h=i},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1;if(0==r.entityType.type)h=r.closeToMouse(e,t,a,i,s,n,o,l);else if(17==r.entityType.type){var d=r.getRectangle(a,i,s,n,o,l);e>d.x&&e<d.x+d.w&&t>d.y&&t<d.y+d.h&&(h=!0)}return h},this.getArea=function(){var e=r.x,t=r.y,a=r.w,i=r.h;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x-i)*e,l=(n-r.y)*e,c=(r.w-i)*e,h=(n-r.h)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.findsnapPoint=function(e,t,a,i,s,r,n,o){return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth*e<1?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor,r.filltempcolor=r.fillcolor,a=r.filltempcolor):(r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),this.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor))),e&&"#FFFFFF"==r.strokecolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),e&&"#FFFFFF"==r.fillcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?(t=r.parent.backgroundColor,a=r.parent.backgroundColor):2==r.role&&(t=r.parent.overlayColor,a=r.parent.overlayColor)),o&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,s,n,l){o=!0,r.drawme(e,t,a,i,s,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){r.dotarray[0].x,r.dotarray[0].y;var p=0,u=0;if(0!=l&&0!=c&&hn){r.render=!0;var g=(r.x-s)*t,f=(o-r.y)*t,m=(r.w-s)*t,y=(o-r.h)*t;if(g+=a,m+=a,f+=i,y+=i,io(Math.max(g,m)-Math.min(g,m),Math.max(f,y)-Math.min(f,y))<20)r.render=!1;else if(0!=l&&0!=c&&hn){if((!r.parent.backgroundrender||d)&&!h){var v=ti,x=ai;if(d&&(v=Se.width,x=Se.height),g<0&&m<0||f<0&&y<0)return void(r.render=!1);if(g>v&&m>v||f>x&&y>x)return void(r.render=!1)}var b=r.getdrawColors(h),w=r.getlinewidth(t,h);e.fillStyle=b.fillcolor,e.strokeStyle=b.linecolor,e.lineWidth=w;for(var k=0;k<r.dotarray.length;k++)p=(r.dotarray[k].x-s)*t,u=(o-r.dotarray[k].y)*t,p+=a,u+=i,e.beginPath(),e.arc(p,u,w,0,2*Math.PI,!1),e.fill(),e.stroke();r.drawcompare=!1}}},this.Close=function(){},this.findrectangle()}}class Ql{constructor(e,t,a,i,s){var r=this;this.type="circle",this.parent=t,this.index=s,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1,this.mouseover=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.cx=e.cx,this.cy=e.cy,this.r=e.cr,this.fullcircle=2*Math.PI;var o=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.getdisttoArc=function(e,t,a,i,s,n,o,l){var c=(r.cx-n)*a,h=(l-r.cy)*a,d=r.r*a;c+=i,h+=s;let p,u=.5*Math.PI;return p=(r.fullcircle-0+r.fullcircle)%r.fullcircle,bo(e,t,c,h,d,0+u,p)},this.getlength=function(){return{radius:r.r,length:2*Math.PI*r.r,Area:2*Math.PI*(r.r*r.r)}},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1;return r.getdisttoArc(e,t,a,i,s,n,o,l)<10&&(h=!0),h},this.getRectangle=function(e,t,a,i,s,n){var o=(r.cx-i)*e,l=(n-r.cy)*e,c=r.r*e,h=o-c,d=l-c,p=o+c,u=l+c;if((h+=t)>(p+=t)){var g=h;h=p,p=g}if((d+=a)>(u+=a)){var f=d;d=u,u=f}return{found:!0,x:h,y:d,w:p-h,h:u-d,wp:(p-h)/10,hp:(u-d)/10}},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.findsnapPoint=function(e,t,a,i,s,r,n,o){var l=(this.cx-r)*a,c=(o-this.cy)*a;return c+=s,(l+=i)>e-10&&l<e+10?c>t-10&&c<t+10?{found:!0,x:l,y:c,type:1}:void 0:{found:!1,x:0,y:0,type:1}},this.getArea=function(){return r.r*r.r*Math.PI},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth*e<1?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),o&&(a=ps),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor,r.filltempcolor=r.fillcolor,a=r.filltempcolor):(r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),this.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor))),e&&"#FFFFFF"==r.strokecolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),e&&"#FFFFFF"==r.fillcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?(t=r.parent.backgroundColor,a=r.parent.backgroundColor):2==r.role&&(t=r.parent.overlayColor,a=r.parent.overlayColor)),o&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,s,n,l){o=!0,r.drawme(e,t,a,i,s,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,a,i,s,n,o,l,c,h,d,p){var u=(r.cx-n)*a,g=(l-r.cy)*a,f=r.r*a;if(0!=c&&0!=h&&hn){if(u+=i,g+=s,(!r.parent.backgroundrender||p)&&!d){var m=ti,y=ai;if(p&&(m=Se.width,y=Se.height),u<0&&u+f<0)return;if(g<0&&g+f<0)return;if(u>m&&u-f>m)return;if(g>y&&g-f>y)return}var v=r.getdrawColors(d);if(e.fillStyle=v.fillcolor,e.strokeStyle=v.linecolor,e.lineCap="round",e.lineWidth=r.getlinewidth(a,d),e.beginPath(),e.arc(u,g,f,0,2*Math.PI,!1),1==this.filled){if(r.drawcompare)e.fillStyle=r.comparecolor;else if(t.blocklist[r.blockname].overridecolor)e.fillStyle=t.blocklist[r.blockname].color;else if(r.selected){var x=this.getRectangle(a,i,s,n,o,l),b=x.x,w=x.y,k=rext.w+x.x,D=rext.h+x.y,C=e.createLinearGradient(k,w,b,D);C.addColorStop(0,t.selectColor),C.addColorStop(.5,t.gradientStop),C.addColorStop(1,t.selectColor),e.fillStyle=C}else e.fillStyle=r.filltempcolor;e.fill()}e.stroke(),r.drawcompare=!1}},this.Close=function(){}}}class ec{constructor(e,t,a,i,s){var r=this;this.type="arc",this.parent=t,this.index=s,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.sweepAngle=void 0,this.sweepAngle=void 0,this.selected=!1,this.mouseon=!1,this.mouseover=!1,this.hasArea=!1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.clockwise=e.clockwise,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.cx=e.ax,this.cy=e.ay,this.r=e.ar,this.sa=e.asa,this.ea=e.aea,this.fullcircle=2*Math.PI,this.length=0;var o=!1;this.insidePolygon=function(e,t,a,i,s,r,n,o){return!1},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h=!1;return r.getdisttoArc(e,t,a,i,s,n,o,l)<10&&(h=!0),h},this.getArea=function(){var e=r.cx,t=r.cy,a=r.r,i=e-a,s=t-a,n=e+a,o=t+a;if(i>n){var l=i;i=n,n=l}if(s>o){var c=s;s=o,o=c}return{area:(n-i)*(o-s),x:i,y:s,w:n-i,h:o-s,wp:(n-i)/10,hp:(o-s)/10}},this.getlength=function(){Math.PI;let e,t=r.fullcircle-r.sa,a=r.fullcircle-r.ea;return e=r.clockwise?-(t-a+r.fullcircle)%r.fullcircle:(a-t+r.fullcircle)%r.fullcircle,{sweep:(i=e,i*(180/Math.PI)),radius:r.r,length:e*r.r};var i},this.getdisttoArc=function(e,t,a,i,s,n,o,l){const c=(r.cx-n)*a+i,h=(l-r.cy)*a+s,d=r.r*a,p=2*Math.PI,u=r.sa,g=r.ea,f=r.clockwise;let m,y=p-u,v=p-g;return y%=p,v%=p,m=f?-(y-v+p)%p:(v-y+p)%p,(Math.abs(Math.abs(m)-p)<1e-4||Math.abs(m)<1e-4)&&(m=f?-p:p),bo(e,t,c,h,d,y+.5*Math.PI,m)},this.getdisttoArcold=function(e,t,a,i,s,n,o,l){var c=(r.cx-n)*a,h=(l-r.cy)*a,d=r.r*a;c+=i,h+=s;let p=.5*Math.PI,u=r.fullcircle-r.sa,g=r.fullcircle-r.ea,f=r.ea-r.sa;return f=r.clockwise?-(u-g+r.fullcircle)%r.fullcircle:(g-u+r.fullcircle)%r.fullcircle,bo(e,t,c,h,d,u+p,f)},this.getcenterandradius=function(e,t,a,i,s,n){var o=(r.cx-i)*e,l=(n-r.cy)*e;return{x:o+=t,y:l+=a,r:r.r*e}},this.getRectangle=function(e,t,a,i,s,n){var o=(r.cx-i)*e,l=(n-r.cy)*e,c=r.r*e,h=o-c,d=l-c,p=o+c,u=l+c;if((h+=t)>(p+=t)){var g=h;h=p,p=g}if((d+=a)>(u+=a)){var f=d;d=u,u=f}return{found:!0,x:h,y:d,w:p-h,h:u-d,wp:(p-h)/10,hp:(u-d)/10}},this.toggleselect=function(){var e=!r.selected;r.selected=e},this.findsnapPoint=function(e,t,a,i,s,r,n,o){var l=(this.cx-r)*a,c=(o-this.cy)*a;return c+=s,(l+=i)>e-10&&l<e+10?c>t-10&&c<t+10?{found:!0,x:l,y:c,type:1}:void 0:{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth*e<1?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),o&&(a=ps),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,r.filltempcolor=r.fillcolor,t=r.stroketempcolor,a=r.filltempcolor):(r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor)),this.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor))),e&&"#FFFFFF"==r.strokecolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor,a=r.filltempcolor),e&&"#FFFFFF"==r.fillcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(t="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(t="#FFFFFF")):t=r.stroketempcolor,0==r.parent.comparemode&&(1==r.role?(a=r.parent.backgroundColor,t=r.parent.backgroundColor):2==r.role&&(a=r.parent.overlayColor,t=r.parent.overlayColor)),o&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,s,n,l){o=!0,r.drawme(e,t,a,i,s,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=(r.cx-s)*t,u=(o-r.cy)*t,g=r.r*t;if(0!=l&&0!=c&&hn){if(p+=a,u+=i,(!r.parent.backgroundrender||d)&&!h){var f=ti,m=ai;if(d&&(f=Se.width,m=Se.height),p<0&&p+g<0)return;if(u<0&&u+g<0)return;if(p>f&&p-g>f)return;if(u>m&&u-g>m)return}var y=r.getdrawColors(h);e.fillStyle=y.fillcolor,e.strokeStyle=y.linecolor,e.lineCap="round",e.lineWidth=r.getlinewidth(t,h),e.beginPath(),e.arc(p,u,g,r.fullcircle-r.sa,r.fullcircle-r.ea,r.clockwise),e.stroke(),r.drawcompare=!1}},this.Close=function(){}}}class tc{constructor(e,t,a,i,s){var r=this;this.type="subpath",this.precision=i,this.parentpath=t,this.blockname=t.blockname,this.blockstate=t.blockstate,this.layer=t.layer,this.layerstate=t.layerstate,this.drawmode=t.drawmode,this.strokecolor=t.strokecolor,this.fillcolor=t.fillcolor,this.stroketempcolor=t.strokecolor,this.filltempcolor=t.fillcolor,this.filled=t.filled,this.selected=!1,this.pen=t.pen,this.penarrindex=t.penarrindex,this.linewidth=t.linewidth,this.originallinewidth=t.originallinewidth,this.linestyle=t.linestyle,this.role=t.role,this.svgpathstr="",0==r.precision?this.points=new Float32Array(e.length):1==r.precision&&(this.points=new Float64Array(e.length));var n=e.length;this.last=a;for(var o=0;o<n;)this.points[o]=e[o],o++;this.findsnapPoint=function(e,t,a,i,s,r,n,o){var l=(this.points[0]-r)*a,c=(o-this.points[1])*a,h=0,d=0;c+=s;var p=10;if((l+=i)>e-p&&l<e+p&&c>t-p&&c<t+p)return{found:!0,x:l,y:c,type:1};for(var u=2;u<this.points.length;u+=2)if(h=(this.points[u]-r)*a,d=(o-this.points[u+1])*a,d+=s,(h+=i)>e-p&&h<e+p&&d>t-p&&d<t+p)return{found:!0,x:h,y:d,type:1};return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parentpath.parent.applypentable&&r.parent.pentable.changed?(null!=r.parentpath.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parentpath.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth||(a=1),r.linewidth*e<1&&0==r.filled?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parentpath.parent.applypentable&&r.parentpath.parent.pentable.changed?r.parentpath.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parentpath.parent.applypentable&&(a=$a),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return 0==r.filled&&(r.parentpath.parent.applypentable&&r.parent.pentable.changed?null!=r.parentpath.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parentpath.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor)),Ai?(r.stroketempcolor=r.strokecolor,r.filltempcolor=r.fillcolor,t=r.stroketempcolor,a=r.filltempcolor):r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",r.filltempcolor="#000000",t=r.stroketempcolor,a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",r.filltempcolor="#FFFFFF",t=r.stroketempcolor,a=r.filltempcolor)),e&&"#FFFFFF"==r.stroketempcolor&&(r.stroketempcolor="#000000",r.filltempcolor="#000000",t=r.stroketempcolor,a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parentpath.viewmode?("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",t="#000000",a="#000000"),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",t="#FFFFFF",a="#FFFFFF")):t=r.stroketempcolor,0==r.parentpath.parent.comparemode&&(1==r.role?(t=r.parentpath.parent.backgroundColor,a=r.parentpath.parent.backgroundColor):2==r.role&&(t=r.parentpath.parent.overlayColor,a=r.parentpath.parent.overlayColor)),{linecolor:t,fillcolor:a}},this.drawme=function(e,t,a,i,s,n,o,l,c,h,d){var p=(r.points[0]-s)*t,u=(o-r.points[1])*t,g=0,f=0;if(0!=l&&0!=c&&hn&&(p+=a,u+=i,r.parentpath.render)){e.lineWidth=r.getlinewidth(t,h),p=Wl(p),u=Wl(u),e.moveTo(p,u);for(var m=2;m<this.points.length;m+=2)g=(r.points[m]-s)*t,f=(o-r.points[m+1])*t,f+=i,g=Wl(g+=a),f=Wl(f),e.lineTo(g,f);e.closePath(),this.drawcompare=!1}},this.Close=function(){this.points=null}}}class ac{constructor(e,t,a,i,s){var r=this;if(this.type="path",this.precision=e.precision,this.parent=t,this.index=s,this.x=0,this.y=0,this.w=0,this.h=0,this.centroid={x:0,y:0},this.render=!0,this.selected=!1,this.hasArea=!0,this.Area=void 0,this.Length=void 0,this.svgpathstr="",this.drawcompare=!1,this.comparecolor=this.fillcolor,this.shape=e.shape,this.blockname=a,this.blockstate=1,this.closed=!1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.entityType=e.entityType,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.role=e.role,this.overridefill=!1,this.drawoverride=!1,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.filled=e.filled,this.gotsubpath=e.gotsubpath,this.subpaths=[],this.linestyle=0,this.mouseover=!1,this.linewidth=e.linewidth,this.originallinewidth=e.linewidth,0==e.linewidth&&(this.linewidth=1,this.originallinewidth=1),e.gotsubpath){this.gotsubpath=!0,0==this.precision?this.points=new Float32Array(e.numpoints):1==this.precision&&(this.points=new Float64Array(e.numpoints));for(var n=0,o=e.numpoints,l=e.points[0];n<o;)this.points[n]=l[n],n++;for(var c=e.points.length,h=1,d=!1;h<c;)l=e.points[h],h==c-1&&(d=!0),h++,this.subpaths.push(new tc(l,r,d,r.precision,!0))}else for(0==this.precision?this.points=new Float32Array(e.numpoints):1==this.precision&&(this.points=new Float64Array(e.numpoints)),n=0,o=e.numpoints;n<o;)this.points[n]=e.points[n],n++;2==this.shape&&this.points[0]==this.points[this.points.length-2]&&this.points[1]==this.points[this.points.length-1]&&(this.closed=!0);var p=!1;this.mouseoff=function(){r.mouseover=!1},this.mouseon=function(){r.mouseover=!0},this.toggleselect=function(){var e=!r.selected;r.selected=e;for(var t=0;t<r.subpaths.length;t++)r.subpaths[t].selected=e},this.unselect=function(){r.selected=!1;for(var e=0;e<r.subpaths.length;e++)r.subpaths[e].selected=!1},this.select=function(){r.selected=!0;for(var e=0;e<r.subpaths.length;e++)r.subpaths[e].selected=!0},this.findcentroid=function(){for(var e=[],t=0,a=0;a<this.points.length;a+=2)e[t]={x:this.points[a],y:this.points[a+1]},t++;if(this.gotsubpath)for(var i=0;i<r.subpaths.length;i++)for(a=0;a<r.subpaths[i].points.length;a+=2)e[t]={x:r.subpaths[i].points[a],y:r.subpaths[i].points[a+1]},t++;r.centroid=vo(e)},this.getcentroid=function(e,t,a,i,s,n){0==r.centroid.x&&0==r.centroid.y&&r.findcentroid();var o=(r.centroid.x-i)*e,l=(n-r.centroid.y)*e;return{x:o+=t,y:l+=a}},this.findrectangle=function(){for(var e=this.points[0],t=this.points[1],a=this.points[0],i=this.points[1],s=2;s<this.points.length;s+=2){var n=this.points[s],o=this.points[s+1];n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}if(this.gotsubpath)for(var l=0;l<r.subpaths.length;l++)for(s=0;s<r.subpaths[l].points.length;s+=2)(n=r.subpaths[l].points[s])<e&&(e=n),(o=r.subpaths[l].points[s+1])<t&&(t=o),n>a&&(a=n),o>i&&(i=o);this.x=e,this.y=t,this.w=a,this.h=i},this.getblockPath=function(){return r},this.getblockPathPoints=function(){return r.points},this.getRectangle=function(e,t,a,i,s,n){var o=(r.x-i)*e,l=(n-r.y)*e,c=(r.w-i)*e,h=(n-r.h)*e;if((o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.getpath=function(e,t,a,i,s,n,o,l){return r.insidePolygon(e,t,a,i,s,n,o,l)?r:null},this.getpathPoints=function(e,t,a,i,s,n,o,l){return r.insidePolygon(e,t,a,i,s,n,o,l)?r.points:[]},this.iswithin=function(e,t,a,i,s,n,o,l,c){var h={x:e,y:t},d=(r.x-n)*a,p=(l-r.y)*a,u=(r.w-n)*a,g=(l-r.h)*a;if((d+=i)>(u+=i)){var f=d;d=u,u=f}if((p+=s)>(g+=s)){var m=p;p=g,g=m}return!(d<0&&u<0||p<0&&g<0)&&(!(d>ti&&u>ti||p>ai&&g>ai)&&(!(h.x<d||h.x>u||h.y<p||h.y>g)&&Do(a,i,s,n,0,l,r,h,{x:d-(u-d)/100,y:g-(g-p)/2})))},this.insidePolygon=function(e,t,a,i,s,n,o,l,c){var h=3==r.shape||6==r.shape||23==r.shape||26==r.shape,d=2==r.shape&&r.closed;if(r.shape,!h&&!d)return r.unselect(),!1;var p={x:e,y:t},u=(r.x-n)*a,g=(l-r.y)*a,f=(r.w-n)*a,m=(l-r.h)*a;if((u+=i)>(f+=i)){var y=u;u=f,f=y}if((g+=s)>(m+=s)){var v=g;g=m,m=v}return p.x<u||p.x>f||p.y<g||p.y>m?(r.parent.multiselect||c||r.unselect(),!1):Do(a,i,s,n,0,l,r,p,{x:u-(f-u)/100,y:m-(m-g)/2})?(r.mouseon(),!0):(r.parent.multiselect||c||r.unselect(),r.mouseoff(),!1)},this.findsnapPoint=function(e,t,a,i,s,r,n,o){var l=(this.points[0]-r)*a,c=(o-this.points[1])*a,h=0,d=0;c+=s;var p=10;if((l+=i)>e-p&&l<e+p&&c>t-p&&c<t+p)return{found:!0,x:l,y:c,type:1};for(var u=2;u<this.points.length;u+=2)if(h=(this.points[u]-r)*a,d=(o-this.points[u+1])*a,d+=s,(h+=i)>e-p&&h<e+p&&d>t-p&&d<t+p)return{found:!0,x:h,y:d,type:1};return{found:!1,x:0,y:0,type:1}},this.getLength=function(){if(null==r.Length){var e=[],t=r.points[0]-r.parent.x,a=r.parent.h-r.points[1];e.push({x:t,y:a});for(var i=0,s=0,n=2;n<r.points.length;n+=2)i=r.points[n]-r.parent.x,s=r.parent.h-r.points[n+1],e.push({x:i,y:s});for(var o=0,l=0;l<e.length;l++)if(l>0){var c=e[l].x-e[l-1].x,h=e[l].y-e[l-1].y;o+=io(c,h)}o+=io(c=e[0].x-e[e.length-1].x,h=e[0].y-e[e.length-1].y),r.Length=o}return r.Length},this.getArea=function(){if(null==r.Area){var e=[],t=r.points[0]-r.parent.x,a=r.parent.h-r.points[1];e.push({x:t,y:a});for(var i=0,s=0,n=2;n<r.points.length;n+=2)i=r.points[n]-r.parent.x,s=r.parent.h-r.points[n+1],e.push({x:i,y:s});var o=Ro(e),l=[];if(r.gotsubpath)for(var c=0;c<r.subpaths.length;c++){for(n=0;n<r.subpaths[c].points.length;n+=2)i=r.subpaths[c].points[n]-r.parent.x,s=r.parent.h-r.subpaths[c].points[n+1],l.push({x:i,y:s});var h=Ro(l);h>o&&(e=l.slice(),l=[],o=h)}r.Area=o}return r.Area},this.setoverridepathlist=function(e){e&&(r.overridefill?r.parent.adddrawfirstlist(r):r.parent.removedrawfirstlist(r))},this.checkoverrideChange=function(e){var t=!1;return e&&(t=!1,e.overridefill||e.overridecolor?r.overridefill?t=!1:(r.overridefill=!0,t=!0):r.overridefill?(r.overridefill=!1,t=!0):t=!1),t},this.getlinewidth=function(e,t){var a=r.linewidth;return r.parent.applypentable&&r.parent.pentable.changed?(null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.linewidth=r.parent.pentable.getPendirect(r.penarrindex).getwidth()),a=r.linewidth):(r.linewidth=r.originallinewidth,a=r.linewidth),r.linewidth||(r.linewidth=1,a=1),r.linewidth*e<1&&0==r.filled?(a=r.parent.pentable.getscaled()?1:r.linewidth,t&&(a=4)):(a=r.parent.applypentable&&r.parent.pentable.changed?r.parent.pentable.getscaled()?r.linewidth*e:r.linewidth:r.linewidth*e,t&&(a=4)),Ka&&!r.parent.applypentable&&(a=$a),p&&(a=ps),a},this.getdrawColors=function(e){var t=r.stroketempcolor,a=r.filltempcolor;return r.parent.applypentable&&r.parent.pentable.changed?null!=r.parent.pentable.getPendirect(r.penarrindex)&&(r.stroketempcolor=r.parent.pentable.getPendirect(r.penarrindex).getcolor(),t=r.stroketempcolor):(r.stroketempcolor=r.strokecolor,t=r.stroketempcolor),Ai?(r.stroketempcolor=r.strokecolor,r.filltempcolor=r.fillcolor,t=r.stroketempcolor,a=r.filltempcolor):(r.filltempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",a=r.filltempcolor),"#000000"==hn.backgroundColor&&(r.filltempcolor="#FFFFFF",a=r.filltempcolor)),r.stroketempcolor==hn.backgroundColor&&("#FFFFFF"==hn.backgroundColor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),"#000000"==hn.backgroundColor&&(r.stroketempcolor="#FFFFFF",t=r.stroketempcolor))),e&&"#FFFFFF"==r.stroketempcolor&&(r.stroketempcolor="#000000",t=r.stroketempcolor),e&&"#FFFFFF"==r.filltempcolor&&(r.filltempcolor="#000000",a=r.filltempcolor),r.drawcompare?t=r.comparecolor:1==r.parent.viewmode?("#FFFFFF"==hn.backgroundColor&&(r.filltempcolor="#000000",t="#000000",a="#000000"),"#000000"!=hn.backgroundColor&&"#A0A0A0"!=hn.backgroundColor||(r.filltempcolor="#FFFFFF",t="#FFFFFF",a="#FFFFFF")):(0==r.parent.viewmode&&(r.filltempcolor=r.fillcolor,a=r.filltempcolor),t=r.stroketempcolor),0==r.parent.comparemode&&(1==r.role?(t=r.parent.backgroundColor,a=r.parent.backgroundColor):2==r.role&&(t=r.parent.overlayColor,a=r.parent.overlayColor)),p&&(a=ds,t=ds),{linecolor:t,fillcolor:a}},this.drawmefirst=function(e,t,a,i,s,n,o,l,c,h,d){r.drawoverride=!0,r.drawme(e,t,a,i,s,n,o,l,c,h,d),r.drawoverride=!1},this.highlight=function(e,t,a,i,s,n,o){p=!0,r.drawme(e,t,a,i,s,n,o,1,1,!1,!1),p=!1},this.drawme=function(e,a,i,s,n,o,l,c,h,d,p){var u=(r.points[0]-n)*a,g=(l-r.points[1])*a,f=0,m=0;if(0!=c&&0!=h&&hn){var y=r.checkoverrideChange(t.blocklist[r.blockname]);if(r.setoverridepathlist(y),!r.overridefill||r.drawoverride){u+=i,g+=s,r.render=!0;var v=(r.x-n)*a,x=(l-r.y)*a,b=(r.w-n)*a,w=(l-r.h)*a;if(v+=i,b+=i,x+=s,w+=s,io(Math.max(v,b)-Math.min(v,b),Math.max(x,w)-Math.min(x,w))<.5)r.render=!1;else{if((!r.parent.backgroundrender||p)&&!d){var k=ti,D=ai;if(p&&(k=Se.width,D=Se.height),v<0&&b<0||x<0&&w<0)return void(r.render=!1);if(v>k&&b>k||x>D&&w>D)return void(r.render=!1)}var C=r.getdrawColors(d);e.fillStyle=C.fillcolor,e.strokeStyle=C.linecolor,e.lineWidth=r.getlinewidth(a,d),e.beginPath(),u=Wl(u),g=Wl(g),e.moveTo(u,g);for(var R=2;R<this.points.length;R+=2)f=(r.points[R]-n)*a,m=(l-r.points[R+1])*a,m+=s,f=Wl(f+=i),m=Wl(m),e.lineTo(f,m);var P=!1,S=!1;if(null!=t.blocklist[r.blockname]&&(P=t.blocklist[r.blockname].overridecolor,S=t.blocklist[r.blockname].overridefill),1==r.filled||r.selected||P||S){if(e.lineWidth=1,e.closePath(),r.drawcompare)e.fillStyle=r.comparecolor;else if(r.selected){var M=e.createLinearGradient(b,x,v,w);M.addColorStop(0,t.selectColor),M.addColorStop(.5,t.gradientStop),M.addColorStop(1,t.selectColor),e.fillStyle=M}else if(null!=t.blocklist[r.blockname])if(t.blocklist[r.blockname].overridecolor)e.fillStyle=t.blocklist[r.blockname].color;else if(t.blocklist[r.blockname].overridefill&&null!=t.blocklist[r.blockname].fillstyle){if(3==t.blocklist[r.blockname].fillstyle&&null!=t.blocklist[r.blockname].hatchstyle){var T=Ao(e,t.blocklist[r.blockname].hatchstyle);null!=T&&(e.fillStyle=T)}}else e.fillStyle=r.filltempcolor;0==r.parent.comparemode&&(1==r.role?e.fillStyle=r.parent.backgroundColor:2==r.role&&(e.fillStyle=r.parent.overlayColor))}if(e.lineCap="round",e.lineJoin="round",r.gotsubpath)for(var E=0;E<r.subpaths.length;E++)r.subpaths[E].drawme(e,a,i,s,n,o,l,c,h,d,!1);r.filled&&e.fill(),e.stroke(),r.drawcompare=!1}}}},this.Close=function(){if(r.gotsubpath)for(;0!=r.subpaths.length;)r.subpaths.pop();r.points=null},this.findrectangle()}}class ic{pens=[];curindex=0;constructor(){this.pens=[]}unit=1;scaled=!0;changed=!1;setunit(e){this.unit=e}setscaled(e){this.scaled=e}getscaled(){return this.scaled}getunit(){return this.unit}add(e){this.pens.push(e),this.curindex=this.pens.length-1}getcurIndex(){return this.pens.length}setcurIndex(e){for(var t=0;t<this.pens.length;t++)if(this.pens[t].penindex==e){this.curindex=t;break}}exists(e){for(var t=!1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=!0;break}return t}existSetcurrent(e){for(var t=!1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=!0,this.curindex=a;break}return t}getPen(e){for(var t=void 0,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=this.pens[a];break}return t}getPenArrindex(e){for(var t=-1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=this.pens[a].getarrindex();break}return t}getPendirect(e){return this.pens[e]}getCurrentPen(){return this.pens[this.curindex]}}class sc{penindex=0;arrayindex=0;originalcolor="#FFFFFF";color="#FFFFFF";originalstyle=0;style=0;penwidth=0;originalpenwidth=0;displaywidth=0;unitwidth=0;constructor(e){this.penindex=e}setOriginalwidth(e){this.penwidth=e,this.originalpenwidth=e}setdisplaywidth(e){this.displaywidth=e}setOriginalcolor(e){this.color=e,this.originalcolor=e}setOriginalStyle(e){this.style=e,this.originalstyle=e}resetwidth(){this.penwidth=this.originalpenwidth,this.displaywidth=this.penwidth}resetcolor(){this.color=this.originalcolor}resetstyle(){this.style=this.originalstyle}setcolor(e){this.color=e}getcolor(){return this.color}setwidth(e){this.penwidth=e}getwidth(){return this.penwidth}getdisplaywidth(){return this.displaywidth}setstyle(e){this.style=e}setarrayindex(e){this.arrayindex=e}setunitwidth(e){this.unitwidth=e}getarrindex(){return this.arrayindex}}class rc{constructor(e,t){if(t){this.index=parseInt(e.getInt32(0,!0));var a=parseInt(e.getInt32(4,!0));this.color=ao(a);var i=parseInt(e.getInt32(8,!0));this.state=i,this.isplottable=parseInt(e.getInt32(12,!0)),this.defaultstate=i;for(var s=e.getUint16(16,!0),r=0==s?" ":String.fromCharCode(s),n=18;n<=128;)r+=0==(s=e.getUint16(n,!0))?" ":String.fromCharCode(s),n+=2;this.name=r}else this.index=e.index,this.color=e.color,this.state=e.state,this.isplottable=!0,this.defaultstate=e.state,this.name=e.name;this.turnLayerOnOff=function(e){}}}class nc{constructor(e,t,a,i,s){var r=this;this.index=e,this.name=t,this.state=a,this.defaultstate=a,this.defaultcolor=i,this.color=i,this.fillstyle=null,this.defaultfillstyle=null,this.overridecolor=!1,this.overridefill=!1,this.hatchstyle=null,this.selected=!1,this.listed=s,this.insert=void 0,this.drawn=!1,this.mouseon=!1,this.iswithin=function(e,t,a,i,s,n,o,l){var c=!1;if(null!=r.insert){var h=r.getRectangle(a,i,s,n,o,l);e>h.x&&e<h.x+h.w&&t>h.y&&t<h.y+h.h&&(c=!0)}return c},this.getArea=function(){if(null!=r.insert){var e=r.insert.MinX,t=r.insert.MinY,a=r.insert.MaxX,i=r.insert.MaxY;if(e>a){var s=e;e=a,a=s}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)}return 0},this.select=function(){r.selected?r.selected=!1:r.selected=!0},this.unselect=function(){r.selected=!1},this.setselect=function(e){r.selected=e},this.highlight=function(e,t,a,i,s,n,o){if(null!=r.insert){var l=r.getRectangle(t,a,i,s,n,o);e.save(),e.lineWidth=2,e.fillStyle="rgba(255,0,0,0.5)",e.fillRect(l.x,l.y,l.w,l.h),e.restore(),r.drawn=!0}},this.getRectangle=function(e,t,a,i,s,n){var o=0,l=0,c=0,h=0;if(null!=r.insert){if(o=(r.insert.MinX-i)*e,l=(n-r.insert.MinY)*e,c=(r.insert.MaxX-i)*e,h=(n-r.insert.MaxY)*e,(o+=t)>(c+=t)){var d=o;o=c,c=d}if((l+=a)>(h+=a)){var p=l;l=h,h=p}}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}}}}class oc{constructor(e,t,a){var i,s,r,n,o,l,c=this,h=void 0,d=0,p=0,u=void 0,g=0,f=void 0,m=0,y=0,v=0,x=0,b=void 0,w=0,k="",D=void 0,C=0,R=!0,P=void 0,S=P,M=-1,T=1,E=0,F=0,I=0,j={height:10,rotation:0,weight:100,italic:0,underline:0,name:"Arial"};this.role=0,this.x=0,this.y=0,this.w=0,this.h=0,this.scale=1,this.offsetx=0,this.offsety=0,this.numlayers=0,this.flag=-1,this.fileversion="",this.layerlist=[],this.penlist=[],this.bnameunique=!0,this.pathlist=[],this.numpaths=0,a&&(this.role=a.role),function(e,t,a){h=new DataView(t),String.fromCharCode(h.getUint8(0));for(var i=1;i<=15;)String.fromCharCode(h.getUint8(i)),i++;c.fileversion=parseInt(h.getInt32(16,!0)),c.flag=h.getInt32(20,!0);var s=52;if(0==c.flag?(c.x=h.getFloat32(24,!0),c.y=h.getFloat32(28,!0),c.w=h.getFloat32(32,!0),c.h=h.getFloat32(36,!0),c.scale=h.getFloat32(40,!0),c.offsetx=h.getFloat32(44,!0),c.offsety=h.getFloat32(48,!0),s=52):1==c.flag?(c.x=h.getFloat64(24,!0),c.y=h.getFloat64(32,!0),c.w=h.getFloat64(40,!0),c.h=h.getFloat64(48,!0),c.scale=h.getFloat64(56,!0),c.offsetx=h.getFloat64(64,!0),c.offsety=h.getFloat64(72,!0),s=80):console.log("no flag in binary file"),e.setdim(c,a),c.numlayers=parseInt(h.getInt32(s,!0)),d=144,p=s+4,c.numlayers,0!=c.numlayers){for(u=new DataView(t,p,d),g=0;g<c.numlayers;){var r=new rc(u,!0);c.layerlist.push(r),g++,p+=d,g<c.numlayers&&(u=new DataView(t,p,d))}e.setlayers(c,a)}if(e.initpath(a),f=new DataView(t,p),m=0,32768!=parseInt(f.getInt32(0,!0))){for(y=parseInt(f.getInt32(4,!0)),v=parseInt(f.getInt32(8,!0)),R=128!=v,c.bnameunique=1==v,x=parseInt(f.getInt32(12,!0)),b=new DataView(t,p+16,2*x),w=0,k=String.fromCharCode(b.getUint16(w,!0)),w+=2;w<2*x;)k+=String.fromCharCode(b.getUint16(w,!0)),w+=2;D=new DataView(t,p+16+2*x),e.updateblocks(new nc(y,k,1,cs,R),a),C=0,P=parseInt(D.getInt32(C,!0)),S=P,M=-1,T=1,E=0,F=0,I=0,j={height:10,rotation:0,weight:100,italic:0,underline:0,name:"Arial"}}}(e,t,c.role),i=c.role,l={objectid:P,prevobjectid:S,blockpart:m,maindvpos:C,dlayer:M,lstate:T,dpen:E,scolor:ao(0),fcolor:ao(0),lwidth:F,font:j,drawmode:13,transparency:1,role:i,entityType:{type:0,handleLow:0,handleHigh:0}},s=l,r=1e3,n=function(){l=function(t){switch(t.objectid){case 1:t.maindvpos+=4;var a=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var i=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var s=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var r=D.getFloat32(t.maindvpos,!0),n={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,x1:a,y1:i,x2:s,y2:r,entityType:t.entityType,role:t.role},o=new Jl(n,e,t.blockpart,!0,c.numpaths);c.numpaths++,e.updatepathlist(o,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 2:t.maindvpos+=4,I=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0);var l=[];l.push(a),l.push(i);for(var h=1;h<I;)t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),h++;var d={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*I,points:l,filled:0,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths);c.numpaths++,e.updatepathlist(p,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 3:for(t.maindvpos+=4,I=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<I;)t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),h++;d={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*I,points:l,filled:1,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths),c.numpaths++,e.updatepathlist(p,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 13:t.maindvpos+=4;var u=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var g=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var f=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var m=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var y=D.getFloat32(t.maindvpos,!0),b={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,clockwise:y>0,ax:u,ay:g,ar:f,asa:m,aea:m+y,entityType:t.entityType,role:t.role},C=new ec(b,e,t.blockpart,!0,c.numpaths);e.updatepathlist(C,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 4:t.maindvpos+=4;var P=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var S=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var M=D.getFloat32(t.maindvpos,!0),T={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:P,cy:S,cr:M,filled:0,entityType:t.entityType,role:t.role},E=new Ql(T,e,t.blockpart,!0,c.numpaths);e.updatepathlist(E,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 5:t.maindvpos+=4,P=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,S=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,M=D.getFloat32(t.maindvpos,!0),T={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:P,cy:S,cr:M,filled:1,entityType:t.entityType,role:t.role},E=new Ql(T,e,t.blockpart,!0,c.numpaths),e.updatepathlist(E,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 6:var F=[],j=[],A=[];t.maindvpos+=4;for(var O=D.getInt32(t.maindvpos,!0),L=0;L<O;)t.maindvpos+=4,F.push(D.getInt32(t.maindvpos,!0)),L++;for(L=0;L<O;){for(var V=0;V<F[L];V++)t.maindvpos+=4,j.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,j.push(D.getFloat32(t.maindvpos,!0));A.push(j),j=[],L++}d={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F[0],points:A,filled:1,gotsubpath:!0,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths),e.updatepathlist(p,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 7:t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,s=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,r=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4;var N=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;for(var B="",U=t.maindvpos;U<N+t.maindvpos;)B+=String.fromCharCode(D.getUint8(U)),U++;t.maindvpos=U;var G={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:s,y2:r,image:B,useref:!1,entityType:t.entityType,role:t.role},z=new ql(G,e,t.blockpart,!0,c.numpaths);e.updatepathlist(z,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 8:t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,s=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,r=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4;var H=D.getInt32(t.maindvpos,!0);for(t.maindvpos+=4,B="",U=t.maindvpos;U<H+t.maindvpos;)B+=String.fromCharCode(D.getUint8(U)),U++;t.maindvpos=U,G={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:s,y2:r,image:B,useref:!0,entityType:t.entityType,role:t.role},z=new ql(G,e,t.blockpart,!0,c.numpaths),e.updatepathlist(z,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 10:t.maindvpos+=4;var _=parseInt(D.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var W=t.maindvpos,X="";W<t.maindvpos+2*_;)X+=String.fromCharCode(D.getUint16(W,!0)),W+=2;t.maindvpos=W;var Y=parseInt(D.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var q=t.maindvpos,Z="";q<t.maindvpos+2*Y;)Z+=String.fromCharCode(D.getUint16(q,!0)),q+=2;t.maindvpos=q;var J={name:X,value:Z,blockref:t.blockpart};e.updateAttributes(J,t.role),t.prevobjectid=t.objectid,t.objectid=parseInt(D.getInt32(t.maindvpos,!0));break;case 11:t.maindvpos+=4;var K=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var $=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Q=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var ee=D.getFloat32(t.maindvpos,!0);if(t.maindvpos+=4,c.fileversion>=2){var te=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4}else te=0;var ae=D.getInt32(t.maindvpos,!0);ae*=2,t.maindvpos+=4;for(var ie=t.maindvpos,se="";ie<t.maindvpos+ae;)se+=String.fromCharCode(D.getUint16(ie,!0)),ie+=2;t.maindvpos=ie;var re={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:K,y1:$,x2:Q,y2:ee,rot:te,text:se,draw:!1};e.updatetextlist(re,t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 12:t.maindvpos+=4;var ne=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var oe=D.getFloat32(t.maindvpos,!0);for(t.maindvpos+=4,ae=D.getInt32(t.maindvpos,!0),ae*=2,t.maindvpos+=4,ie=t.maindvpos,se="";ie<t.maindvpos+ae;)se+=String.fromCharCode(D.getUint16(ie,!0)),ie+=2;t.maindvpos=ie;var le={strokecolor:t.scolor,fillcolor:t.fcolor,layer:t.dlayer,pen:t.dpen,drawmode:t.drawmode,layerstate:t.lstate,x1:ne,y1:oe,text:se,entityType:t.entityType,role:t.role},ce=new Xl(le,e,t.font,t.blockpart,c.numpaths);e.updatepathlist(ce,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 14:t.maindvpos+=4;var he=D.getInt32(t.maindvpos,!0),de=[];t.maindvpos+=4;for(var pe=0;pe<he;pe++){var ue=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var ge=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var fe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var me=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4,de.push({x1:ue,y1:ge,x2:fe,y2:me})}var ye={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,lines:de,entityType:t.entityType,role:t.role},ve=new Kl(ye,e,t.blockpart,!0,c.numpaths);e.updatepathlist(ve,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 15:t.maindvpos+=4,he=D.getInt32(t.maindvpos,!0);var xe=[];for(t.maindvpos+=4,pe=0;pe<he;pe++){var be=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var we=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4,xe.push({x:be,y:we})}var ke={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,dots:xe,entityType:t.entityType,role:t.role},De=new $l(ke,e,t.blockpart,!0,c.numpaths);e.updatepathlist(De,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 16:t.maindvpos+=4;var Ce=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Re=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Pe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Se=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Me=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Te=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ee=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Fe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ie=D.getFloat32(t.maindvpos,!0);if(t.maindvpos+=4,c.fileversion>=5){var je=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ae=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Oe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Le=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4}else je=0,Ae=0,Oe=0,Le=0;var Ve={blockhandleLow:Ce,blockhandleHigh:Re,insertX:Pe,insertY:Se,insertZ:Me,insertRot:Te,insertscaleX:Ee,insertscaleY:Fe,insertscaleZ:Ie,blockref:t.blockpart,MinX:je,MinY:Ae,MaxX:Oe,MaxY:Le,type:"float"};e.updateBlockInsert(t.blockid,Ve),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 21:t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),n={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,x1:a,y1:i,x2:s,y2:r,entityType:t.entityType,role:t.role},o=new Jl(n,e,t.blockpart,!0,c.numpaths),e.updatepathlist(o,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 22:for(t.maindvpos+=4,I=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<I;)t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),h++;d={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*I,points:l,filled:0,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths),e.updatepathlist(p,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 23:for(t.maindvpos+=4,I=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<I;)t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),h++;d={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*I,points:l,filled:1,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths),e.updatepathlist(p,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 24:t.maindvpos+=4,P=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,S=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,M=D.getFloat64(t.maindvpos,!0),T={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:P,cy:S,cr:M,filled:0,entityType:t.entityType,role:t.role},E=new Ql(T,e,t.blockpart,!0,c.numpaths),e.updatepathlist(E,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 34:t.maindvpos+=4,u=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,g=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,f=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,m=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,y=D.getFloat64(t.maindvpos,!0),b={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,clockwise:y>0,ax:u,ay:g,ar:f,asa:m,aea:m+y,entityType:t.entityType,role:t.role},C=new ec(b,e,t.blockpart,!0,c.numpaths),e.updatepathlist(C,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 25:t.maindvpos+=4,P=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,S=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,M=D.getFloat64(t.maindvpos,!0),T={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:P,cy:S,cr:M,filled:1,entityType:t.entityType,role:t.role},E=new Ql(T,e,t.blockpart,!0,c.numpaths),e.updatepathlist(E,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 26:for(F=[],j=[],A=[],t.maindvpos+=4,O=D.getInt32(t.maindvpos,!0),L=0;L<O;)t.maindvpos+=4,F.push(D.getInt32(t.maindvpos,!0)),L++;for(t.maindvpos+=4,L=0;L<O;){for(V=0;V<F[L];V++)j.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,j.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8;A.push(j),j=[],L++}d={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F[0],points:A,filled:1,gotsubpath:!0,shape:t.objectid,entityType:t.entityType,role:t.role},p=new ac(d,e,t.blockpart,!0,c.numpaths),e.updatepathlist(p,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 27:for(t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,N=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,B="",U=t.maindvpos;U<N+t.maindvpos;)B+=String.fromCharCode(D.getUint8(U)),U++;t.maindvpos=U,G={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:s,y2:r,image:B,useref:!1,entityType:t.entityType,role:t.role},z=new ql(G,e,t.blockpart,!0,c.numpaths),e.updatepathlist(z,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 28:for(t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,H=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,B="",U=t.maindvpos;U<H+t.maindvpos;)B+=String.fromCharCode(D.getUint8(U)),U++;t.maindvpos=U,G={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:s,y2:r,image:B,useref:!0,entityType:t.entityType,role:t.role},z=new ql(G,e,t.blockpart,!0,c.numpaths),e.updatepathlist(z,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 31:for(t.maindvpos+=4,K=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,$=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Q=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ee=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,c.fileversion>=2?(te=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8):te=0,ae=D.getInt32(t.maindvpos,!0),ae*=2,t.maindvpos+=4,ie=t.maindvpos,se="";ie<t.maindvpos+ae;)se+=String.fromCharCode(D.getUint16(ie,!0)),ie+=2;t.maindvpos=ie,re={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:K,y1:$,x2:Q,y2:ee,rot:te,text:se,draw:!1},e.updatetextlist(re,t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 32:for(t.maindvpos+=4,ne=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,oe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ae=D.getInt32(t.maindvpos,!0),ae*=2,t.maindvpos+=4,ie=t.maindvpos,se="";ie<t.maindvpos+ae;)se+=String.fromCharCode(D.getUint16(ie,!0)),ie+=2;t.maindvpos=ie,le={strokecolor:t.scolor,fillcolor:t.fcolor,layer:t.dlayer,pen:t.dpen,drawmode:t.drawmode,layerstate:t.lstate,x1:ne,y1:oe,text:se,entityType:t.entityType,role:t.role},ce=new Xl(le,e,t.font,t.blockpart,c.numpaths),e.updatepathlist(ce,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 35:for(t.maindvpos+=4,he=D.getInt32(t.maindvpos,!0),de=[],t.maindvpos+=4,pe=0;pe<he;pe++)ue=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ge=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,fe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,me=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,de.push({x1:ue,y1:ge,x2:fe,y2:me});ye={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,lines:de,entityType:t.entityType,role:t.role},ve=new Kl(ye,e,t.blockpart,!0,c.numpaths),e.updatepathlist(ve,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 36:for(t.maindvpos+=4,he=D.getInt32(t.maindvpos,!0),xe=[],t.maindvpos+=4,pe=0;pe<he;pe++)be=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,we=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,xe.push({x:be,y:we});ke={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,dots:xe,entityType:t.entityType,role:t.role},De=new $l(ke,e,t.blockpart,!0,c.numpaths),e.updatepathlist(De,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 37:t.maindvpos+=4,Ce=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,Re=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,Pe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Se=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Me=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Te=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Ee=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Fe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Ie=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,c.fileversion>=5?(je=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Ae=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Oe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Le=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8):(je=0,Ae=0,Oe=0,Le=0),Ve={blockhandleLow:Ce,blockhandleHigh:Re,insertX:Pe,insertY:Se,insertZ:Me,insertRot:Te,insertscaleX:Ee,insertscaleY:Fe,insertscaleZ:Ie,blockref:t.blockpart,MinX:je,MinY:Ae,MaxX:Oe,MaxY:Le,type:"dobule"},e.updateBlockInsert(t.blockid,Ve),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 64:t.maindvpos+=4;var Ne=D.getInt32(t.maindvpos,!0);t.scolor=ao(Ne),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 65:t.maindvpos+=4;var Be=D.getInt32(t.maindvpos,!0);t.fcolor=ao(Be),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 66:t.maindvpos+=4,t.lwidth=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 67:t.maindvpos+=4,D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 68:t.maindvpos+=4,t.dlayer=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 69:t.maindvpos+=4,t.dpen=D.getInt32(t.maindvpos,!0),e.pentable.existSetcurrent(t.dpen)?(e.pentable.getCurrentPen().setOriginalwidth(t.lwidth),e.pentable.getCurrentPen().setdisplaywidth(t.lwidth),e.pentable.getCurrentPen().setOriginalcolor(t.scolor)):t.dpen>=0&&(e.pentable.add(new sc(t.dpen,e.pentable.getcurIndex())),e.pentable.getCurrentPen().setOriginalwidth(t.lwidth),e.pentable.getCurrentPen().setdisplaywidth(t.lwidth),e.pentable.getCurrentPen().setOriginalcolor(t.scolor)),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 70:t.maindvpos+=4,D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 71:case 72:t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 73:t.maindvpos+=4;var Ue=D.getInt32(t.maindvpos,!0);t.drawmode=Ue,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 76:t.maindvpos+=4;var Ge=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var ze=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var He=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var _e=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var We=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Xe=D.getInt32(t.maindvpos,!0);Xe*=2,t.maindvpos+=4;for(var Ye=t.maindvpos,qe="";Ye<t.maindvpos+Xe;)0!=D.getUint16(Ye,!0)&&(qe+=String.fromCharCode(D.getUint16(Ye,!0))),Ye+=2;t.maindvpos=Ye,t.font={height:Ge,rotation:ze,weight:He,italic:_e,underline:We,name:qe},t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 77:t.maindvpos+=4;var Ze=D.getFloat32(t.maindvpos,!0);t.transparency=Ze,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 78:t.maindvpos+=4;var Je=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Ke=D.getInt32(t.maindvpos,!0);t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 79:t.maindvpos+=4;var $e=D.getInt32(t.maindvpos,!0);t.maindvpos+=4,Je=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,Ke=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.entityType={type:$e,handleLow:Je,handleHigh:Ke},t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 12288:t.objectid=12288,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 4096:for(t.objectid=4096,t.blockpart++,t.maindvpos+=4,t.blockid=parseInt(D.getInt32(t.maindvpos,!0)),t.maindvpos+=4,v=parseInt(D.getInt32(t.maindvpos,!0)),c.bnameunique=1==v,R=128!=v,t.maindvpos+=4,x=parseInt(D.getInt32(t.maindvpos,!0)),t.maindvpos+=4,w=t.maindvpos,k="";w<t.maindvpos+2*x;)k+=String.fromCharCode(D.getUint16(w,!0)),w+=2;t.maindvpos=w;var Qe=!1;if(c.bnameunique){var et=e.getblocklistlength(t.role,k,t.blockpart);Qe=et.bexist,t.blockpart=et.count}Qe||e.updateblocks(new nc(t.blockid,k,1,t.fcolor,R),t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 32768:t.objectid=32768;break;default:console.log("default"),e.invalid=!0,console.log(t.objectid),console.log(t.prevobjectid),console.log(t.maindvpos),t.objectid=32768}return t}(l)},o=function(){!function(t){e.readbinarycomplete(t)}(l.role)},function e(){for(var t=0;t<r&&(n.call(null,s),32768!=s.objectid);++t);32768!=s.objectid?setTimeout(e,0):o.call(null)}(),function e(){D&&32768!=l.objectid&&setTimeout(e,10)}()}}class lc{constructor(e,t,i,s){var r=this;this.parent=e,this.firstdraw=!1,this.firstdrawcompare=!1,this.offscreen=document.createElement("canvas"),this.offscreenctx=this.offscreen.getContext("2d"),this.offscreenprint=document.createElement("canvas"),this.offscreenprintctx=this.offscreenprint.getContext("2d"),this.thumboffscreen=document.createElement("canvas"),this.thumboffscreenctx=this.offscreen.getContext("2d"),this.renderinprogress=!1,this.backgroundrender=!0,this.docompare=!1,this.dooverlay=!1,this.bcompare=e.DocRef.bcompare,this.comparemode=e.OverlayComparemode,this.isbackground=!1,this.comparecolor="red",this.novectors=!1,this.bgimage=!1,this.ovimage=!1,this.layerlist=[],this.pentable=new ic;var o=r.parent.Unitofmeasure;this.pentable.setunit(o),this.pentable.setscaled(!0),this.layerlistbg=[],this.layerlistfg=[],this.vectorpagetime=0,this.textlayerset=!1,this.blocklist=[],this.filterblocklist=[],this.filterAttributelist=[],this.blocklistbg=[],this.filterblocklistbg=[],this.filterAttributelistbg=[],this.blocklistfg=[],this.filterblocklistfg=[],this.filterAttributelistfg=[],this.numblocks=-1,this.bnameunique=!1,this.selectedobject=void 0,this.selectColor="rgba(191,58,209,0.6)",this.gradientStop="rgba(255,255,255,0.3)",this.viewmode=0,this.applypentable=!1,this.multiselect=!1,this.selectedblocks=[],this.fileversion="",this.flag=-1,this.compare=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.width=0,this.height=0,this.scale=1,this.offsetx=0,this.offsety=0,this.numlayers=0,this.overlayscale=1,this.overlayoffsetx=0,this.overlayoffsety=0,this.nudgeScalefactor=0,this.overlayrotation=0,this.fgdrawangle=0,this.bnudgeangleused=!1,this.nOffsetX=0,this.nOffsetY=0,this.backupoverlayscale=1,this.backupoverlayoffsetx=0,this.backupoverlayoffsety=0,this.backupoverlayrotation=0,this.blocklistovoffset=0,this.layerlistovoffset=0,this.pathlist=[],this.pathlistoverride=[],this.textlist=[],this.attributes=[],this.intersections=[],this.pathlistbg=[],this.pathlistoverridebg=[],this.textlistbg=[],this.attributesbg=[],this.intersectionsbg=[],this.pathlistfg=[],this.pathlistoverridefg=[],this.textlistfg=[],this.attributesfg=[],this.intersectionsfg=[],this.numpaths=0,this.vectorloader=void 0,this.addvectorloader=void 0,this.bgDocObjref=void 0,this.fgDocObjref=void 0,this.bgpageindex=void 0,this.fgpageindex=void 0,this.cmprimagestoload=0,this.cmprvctrsrctoload=0;var l,c=[];if(s){this.backgroundColor=s.bgColor,this.overlayColor=s.fgColor,this.bgpageindex=r.parent.comparebgpageindex,this.fgpageindex=r.parent.comparefgpageindex;for(var h=0;h<yn.length;h++)yn[h].fileindex==r.parent.comparebgdocindex&&(this.bgDocObjref=yn[h],this.bgDocObjref.setComparelink=new pd(this.parent.DocRef.bgFileClosed)),yn[h].fileindex==r.parent.comparefgdocindex&&(this.fgDocObjref=yn[h],this.fgDocObjref.setComparelink=new pd(this.parent.DocRef.fgFileClosed));r.parent.loadbackgroundimage&&(this.cmprimagestoload+=1),r.parent.loadoverlayimage&&(this.cmprimagestoload+=1),r.parent.loadbackgroundpdf&&(this.cmprimagestoload+=1),r.parent.loadoverlaypdf&&(this.cmprimagestoload+=1),r.parent.loadbackgroundvectors&&(this.cmprvctrsrctoload+=1),r.parent.loadoverlayvectors&&(this.cmprvctrsrctoload+=1)}function d(e,t){var a={index:0,color:e.bgColor,state:1,name:"backgroundlayer"},i={index:1,color:e.fgColor,state:1,name:"overlaylayer"},s=0;return t?(r.layerlist.push(new rc(a,!1)),s=0):(r.layerlist.push(new rc(i,!1)),s=1),s}function p(e,t){var a=0;return t?(r.blocklist.push(new nc(0,"backgroundblock",1,e.bgColor,!0)),a=0):(r.blocklist.push(new nc(1,"overlayblock",1,e.fgColor,!0)),a=1),a}function u(e){var t=!0;return r.blocklist.length>0&&null!=r.blocklist[r.pathlist[e].blockname]&&(2==r.pathlist[e].role?null!=r.blocklist[r.pathlist[e].blockname+r.blocklistovoffset]&&(t=1==r.blocklist[r.pathlist[e].blockname+r.blocklistovoffset].state):t=1==r.blocklist[r.pathlist[e].blockname].state),t}function g(e){var t=!0;return r.layerlist.length>0&&-1!=r.pathlist[e].layer&&null!=r.layerlist[r.pathlist[e].layer]&&(2==r.pathlist[e].role?null!=r.layerlist[r.pathlist[e].layer+r.layerlistovoffset]&&(t=1==r.layerlist[r.pathlist[e].layer+r.layerlistovoffset].state):t=1==r.layerlist[r.pathlist[e].layer].state),t}function f(e){for(var t=-1,a=0;a<r.blocklist.length;a++)if(r.blocklist[a].index==e){t=a;break}return t}function m(e){for(var t=void 0,a=0;a<r.blocklist.length;a++)if(r.blocklist[a].index==e){t=r.blocklist[a];break}return t}function y(e){for(var t=[],a=0;a<r.attributes.length;a++)r.attributes[a].blockref==e&&t.push(r.attributes[a]);return t}function v(e,t,a,i){e.x1,e.y1;var s=e.x2,r=1/i,n=e.y2*r,o=s*r;return e.x1=o*t,e.y1=n*a,e.x2=o*(t+1),e.y2=n*(a+1),e}function x(e,t,a,i,s){return new Yl(e,t,a,i,s)}function b(e){var t="no type";switch(e){case 0:t="LINE";break;case 1:t="LWPOLYLINE";break;case 2:t="POLYLINE";break;case 3:t="SOLID";break;case 4:t="ARC";break;case 5:t="CIRCLE";break;case 6:t="TEXT";break;case 7:t="DIMENSION";break;case 8:t="MTEXT";break;case 9:t="VERTEX";break;case 10:t="ELLIPSE";break;case 11:t="POINT";break;case 12:t="3DFACE";break;case 13:t="3DSOLID";break;case 14:t="BODY";break;case 15:t="ATTDEF";break;case 16:t="ATTRIB";break;case 17:t="HATCH";break;case 18:t="IMAGE";break;case 19:t="INSERT";break;case 20:t="LEADER";break;case 21:t="MLINE";break;case 22:t="OLEFRAME";break;case 23:t="OLE2FRAME";break;case 24:t="RAY";break;case 25:t="REGION";break;case 26:t="SHAPE";break;case 27:t="SPLINE";break;case 28:t="TOLERANCE";break;case 29:t="TRACE";break;case 30:t="ACAD_PROXY_ENTITY";break;case 31:t="VIEWPORT";break;case 32:t="WIPEOUT";break;case 33:t="XLINE";break;default:t="other type"}return t}function w(e,t,a){e.save(),e.font=a;const i=e.measureText(t);return e.restore(),i.width}this.addpdfimage=function(e,t,a){var i=d(a,t),s=p(a,t),n=0,o=e.x1,l=e.y1,c=e.x2,h=e.y2;if(e={layer:i,drawmode:e.drawmode,layerstate:e.lstate,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,magnify:!1,useref:!0,addcache:!1,role:n},t){n=1,e.magnify=!0;for(var u=0;u<4;u++)for(var g=0;g<4;g++)e.role=1,(f=x(e=v(e,u,g,4),r,s,!0,r.pathlist.length)).isbackground=!0,r.pathlistbg.unshift(f),e.x1=o,e.y1=l,e.x2=c,e.y2=h;for(e.magnify=!1,u=0;u<4;u++)for(g=0;g<4;g++){var f;e.role=1,(f=x(e=v(e,u,g,4),r,s,!0,r.pathlist.length)).isbackground=!0,r.pathlistbg.unshift(f),e.x1=o,e.y1=l,e.x2=c,e.y2=h}r.bgimage=!0}else{for(n=2,e.magnify=!0,u=0;u<4;u++)for(g=0;g<4;g++)e.role=2,(f=x(e=v(e,u,g,4),r,s,!0,r.pathlist.length)).isoverlay=!0,r.pathlistfg.push(f),e.x1=o,e.y1=l,e.x2=c,e.y2=h;for(e.magnify=!1,u=0;u<4;u++)for(g=0;g<4;g++)e.role=2,(f=x(e=v(e,u,g,4),r,s,!0,r.pathlist.length)).isoverlay=!0,r.pathlistfg.push(f),e.x1=o,e.y1=l,e.x2=c,e.y2=h;r.ovimage=!0}var m={x:o,y:l,w:c,h:h,scale:r.scale,offsetx:r.offsetx,offsety:r.offsety,fileversion:r.fileversion,flag:r.flag};r.novectors,r.pathlist=r.pathlistbg.concat(r.pathlistfg),r.setdim(m,n)},this.addimage=function(e,t,a){var i,s=d(a,t),n=p(a,t),o=0;e={layer:s,drawmode:e.drawmode,layerstate:e.lstate,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,image:e.imagestr,useref:!0,addcache:!1,role:o},t?(e.role=1,o=1,(i=new ql(e,r,n,!0,r.pathlist.length)).isbackground=!0,r.pathlistbg.unshift(i),r.bgimage=!0):(e.role=2,o=2,(i=new ql(e,r,n,!0,r.pathlist.length)).isoverlay=!0,r.pathlistfg.push(i),r.ovimage=!0);var l={x:e.x1,y:e.y1,w:e.x2,h:e.y2,scale:r.scale,offsetx:r.offsetx,offsety:r.offsety,fileversion:r.fileversion,flag:r.flag};r.novectors,r.pathlist=r.pathlistbg.concat(r.pathlistfg),r.setdim(l,o)},this.initpath=function(e){switch(r.pathlistoverride=[],r.intersections=[],e){case 0:r.pathlist=[],r.textlist=[],r.attributes=[],r.numpaths=0;break;case 1:r.pathlistbg=[],r.textlistbg=[],r.attributesbg=[],r.numpathsbg=0;break;case 2:r.pathlistfg=[],r.textlistfg=[],r.attributesfg=[],r.numpathsfg=0}},this.getblocklistlength=function(e,t,a){var i=!1,s=0;if(0==e){for(s=0;s<r.blocklist.length;s++)if(t==r.blocklist[s].name){a=s,i=!0;break}}else if(1==e){for(s=0;s<r.blocklistbg.length;s++)if(t==r.blocklistbg[s].name){a=s,i=!0;break}}else if(2==e)for(s=0;s<r.blocklistfg.length;s++)if(t==r.blocklistfg[s].name){a=s,i=!0;break}return{bexist:i,count:a}},this.updateBlockInsert=function(e,t){for(var a=0;a<r.blocklist.length;a++)r.blocklist[a].index==e&&(r.blocklist[a].insert=t)},this.updateblocks=function(e,t){0==t?r.blocklist.push(e):1==t?r.blocklistbg.push(e):2==t&&r.blocklistfg.push(e)},this.updatepentTable=function(e){r.pentable.add(e)},this.getpenTable=function(){return r.pentable},this.setpentableUnit=function(e){r.pentable.setunit(e)},this.setpentableScaled=function(e){r.pentable.setscaled(e)},this.setPenwidth=function(e){var t=r.pentable.getPen(e.penindex),a=r.pentable.getscaled(),i=r.pentable.getunit(),s=parseFloat(t.getdisplaywidth());if(a){if(NaN!=s){var n=r.parent.fixedScale,o=r.getScreenDim(parseFloat(e.penwidth));o*=n,t.setwidth(o)}}else NaN!=s&&(1==i&&t.setwidth(s/25.4*96),2==i&&t.setwidth(96*s))},this.setPenTablepen=function(e){var t=r.pentable.getPen(e.penindex);if(t.setcolor(e.color),NaN!=parseFloat(e.penwidth)){var a=r.parent.fixedScale,i=r.getScreenDim(parseFloat(e.penwidth));i*=a,t.setwidth(i),t.setdisplaywidth(e.penwidth)}NaN!=parseInt(e.style)&&-1!=parseInt(e.style)&&t.setstyle(e.style)},this.resetPenTablepen=function(e){var t=r.pentable.getPen(e.penindex);t.resetcolor(),t.resetwidth(),t.resetstyle()},this.setpencolor=function(e,t){r.pentable.getPen(e).setcolor(t)},this.resetpencolor=function(e){r.pentable.getPen(e).resetcolor()},this.resetpenwidth=function(e){r.pentable.getPen(e).resetwidth()},this.updatepathlist=function(e,t){switch(t){case 0:r.pathlist.push(e),r.numpaths++;break;case 1:r.pathlistbg.push(e),r.numpathsbg++;break;case 2:r.pathlistfg.push(e),r.numpathsfg++}},this.setlayers=function(e,t){switch(t){case 0:r.layerlist=e.layerlist.slice(),r.numlayers=e.numlayers,null!=yt&&yt.setVectorLayers(r.layerlist);break;case 1:r.layerlistbg=e.layerlist.slice();break;case 2:r.layerlistovoffset=r.layerlistbg.length,r.layerlistfg=e.layerlist.slice(),r.layerlist=r.layerlistbg.concat(r.layerlistfg),null!=yt&&yt.setVectorLayers(r.layerlist)}},this.getScreenDim=function(e,t){var a=0,i=r.parent.DPI,s=r.parent.Unitofmeasure,n=i/25.4,o=i;e*=hr;var l=r.parent.getMeasureScale();if(null==l&&(l=Js),a=e/l*r.parent.OriginalScale,0!=i)switch(s){case 1:a*=n;break;case 2:a*=o}return a},this.setdim=function(e,t){if(0==t&&(r.x=e.x,r.y=e.y,r.w=e.w,r.h=e.h,r.scale=e.scale,r.offsetx=e.offsetx,r.offsety=e.offsety,r.fileversion=e.flag,r.flag=e.flag,r.width=r.w-r.x,r.height=r.h-r.y),2==t)if(r.parent.loadbackgroundvectors){var a=e.w-e.x,i=e.h-e.y;r.overlayscale=Math.min(r.width/a,r.height/i),r.backupoverlayscale=r.overlayscale,r.overlayoffsetx=e.x,r.overlayoffsety=e.h,r.backupoverlayoffsetx=r.overlayoffsetx,r.backupoverlayoffsety=r.overlayoffsety,r.overlayrotation=0,r.backupoverlayrotation=r.overlayrotation}else r.parent.loadoverlayvectors?(r.x=e.x,r.y=e.y,r.w=e.w,r.h=e.h,r.scale=e.scale,r.offsetx=e.offsetx,r.offsety=e.offsety,r.fileversion=e.flag,r.flag=e.flag,r.width=r.w-r.x,r.height=r.h-r.y,a=e.w-e.x,i=e.h-e.y,r.overlayscale=Math.min(a/r.width,i/r.height),r.backupoverlayscale=r.overlayscale,r.overlayrotation=0,r.backupoverlayrotation=r.overlayrotation):(a=e.w-e.x,i=e.h-e.y,r.overlayscale=Math.min(r.width/a,r.height/i),r.backupoverlayscale=r.overlayscale,r.overlayoffsetx=e.x,r.overlayoffsety=e.h,r.backupoverlayoffsetx=r.overlayoffsetx,r.backupoverlayoffsety=r.overlayoffsety,r.overlayrotation=0,r.backupoverlayrotation=r.overlayrotation);1==t&&(r.parent.loadoverlayvectors&&!r.parent.loadbackgroundvectors?(a=e.w-e.x,i=e.h-e.y,r.overlayscale=Math.min(r.width/a,r.height/i),r.backupoverlayscale=r.overlayscale,r.overlayoffsetx=e.x,r.overlayoffsety=e.h,r.backupoverlayoffsetx=r.overlayoffsetx,r.backupoverlayoffsety=r.overlayoffsety,r.overlayrotation=0,r.backupoverlayrotation=r.overlayrotation):(r.x=e.x,r.y=e.y,r.w=e.w,r.h=e.h,r.scale=e.scale,r.offsetx=e.offsetx,r.offsety=e.offsety,r.fileversion=e.flag,r.flag=e.flag,r.width=r.w-r.x,r.height=r.h-r.y,a=e.w-e.x,i=e.h-e.y,r.overlayscale=Math.min(a/r.width,i/r.height),r.backupoverlayscale=r.overlayscale,r.overlayrotation=0,r.backupoverlayrotation=r.overlayrotation))},this.updateAttributes=function(e,t){switch(t){case 0:r.attributes.push(e);break;case 1:r.attributesbg.push(e);break;case 2:r.attributesfg.push(e)}},this.updatetextlist=function(e,t){switch(t){case 0:r.textlist.unshift(e);break;case 1:r.textlistbg.unshift(e);break;case 2:r.textlistfg.unshift(e)}},this.imageloadcomplete=function(e){r.parent.loadbackgroundimage&&1==e&&(r.setcompareColors(),r.parent.redraw(),r.cmprimagestoload>0&&(r.cmprimagestoload-=1)),r.parent.loadoverlayimage&&2==e&&(r.setcompareColors(),r.parent.redraw(),r.cmprimagestoload>0&&(r.cmprimagestoload-=1)),r.parent.loadbackgroundpdf&&1==e&&(r.parent.redraw(),r.cmprimagestoload>0&&(r.cmprimagestoload-=1)),r.parent.loadoverlaypdf&&2==e&&(r.parent.redraw(),r.cmprimagestoload>0&&(r.cmprimagestoload-=1));var t=0==r.cmprimagestoload,a=0==r.cmprvctrsrctoload;r.bcompare&&t&&a&&null!=Xe&&Xe.compareComplete(r.parent.DocRef.fileindex)},this.readbinarycomplete=function(e){r.pathlistoverride=[],r.intersections=[],0==e||(1==e||2==e)&&(r.blocklistovoffset=r.blocklistbg.length,r.blocklist=r.blocklistbg.concat(r.blocklistfg),r.pathlist=r.pathlistbg.concat(r.pathlistfg),r.textlist=r.textlistbg.concat(r.textlistfg),r.attributes=r.attributesbg.concat(r.attributesfg),r.cmprvctrsrctoload>0&&(r.cmprvctrsrctoload-=1)),r.filterblocklist=r.blocklist.filter((function(e){return e.listed})),r.filterAttributelist=r.attributes.slice(),null!=xt&&xt.setVectorBlocks(r.filterblocklist),null!=bt&&bt.setVectorBlocks(r.filterblocklist),r.docompare||(r.parent.redraw(),r.setcompareColors()),r.textlist.length>0?(null!=ja&&(ja.hastext=!0,r.parent.DocRef.hastext=!0,ja.hasText(r.parent.DocRef.hastext,r.parent.DocRef.bActive)),r.parent.DocRef.pages[r.parent.DocRef.currentpage]&&null!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].VectorPageObj&&r.parent.DocRef.pages[r.parent.DocRef.currentpage].settextdivs(!0)):null!=ja&&(ja.hastext=!1,r.parent.DocRef.hastext=!1,ja.hasText(r.parent.DocRef.hastext,r.parent.DocRef.bActive));var t=0==r.cmprimagestoload,a=0==r.cmprvctrsrctoload;if(r.bcompare&&t&&a&&null!=Xe&&Xe.compareComplete(r.parent.DocRef.fileindex),Ts&&Es.length>0&&(null!=Oe&&Oe.setPentablelist(Es,r.parent.DocRef.bActive),null!=RxCore_GUI_autopenTable&&RxCore_GUI_autopenTable.setAutoPenLoad()),ki){var i={iscompare:mi,numOpenFiles:yn.length,isPDF:!1,is3D:!1,is2D:!0,numpages:parent.DocRef.pages.length,currentpage:parent.DocRef.getcurPage(),activefile:parent.DocRef.bActive,source:"vectorbinaryloadcomplete"};null!=Jt&&Jt.setGUIState(i);var s={numpages:parent.DocRef.pages.length,currentpage:parent.DocRef.getcurPage()};null!=Kt&&Kt.pageEvent(s),ki=!1}},this.addvectors=function(e,t){t&&(r.addvectorloader=new oc(r,e,t))},this.refreshdraw=function(){r.parent.redraw()},this.resetCompare=function(){r.overlayscale=r.backupoverlayscale,r.overlayoffsetx=r.backupoverlayoffsetx,r.overlayoffsety=r.backupoverlayoffsety,r.overlayrotation=r.backupoverlayrotation,r.nOffsetX=0,r.nOffsetY=0,r.refreshdraw()},this.setcomparescale=function(e){r.nudgeScale(2),r.resetCompare();var t=r.overlayscale,a=r.overlayoffsetx,i=r.overlayoffsety,s=r.overlayrotation,n=0;if(n=r.parent.loadbackgroundvectors?2:r.parent.loadoverlayvectors?1:2,2==e.length){if(1==n){if(t=e[1].scaleinfo.scaledDistance/e[0].scaleinfo.scaledDistance,a=e[1].offset.x/t-e[0].offset.x,i=e[1].offset.y/t-e[0].offset.y,s=e[0].angle-e[1].angle,r.overlayscale=t,a>0){r.overlayoffsetx=r.overlayoffsetx-a;var o=e[1].scaleinfo.pagedim.origw,l=e[0].scaleinfo.pagedim.origw*r.overlayscale+a*r.overlayscale}else r.x=r.x- -a*r.overlayscale,o=e[1].scaleinfo.pagedim.origw+-a*r.overlayscale,l=e[0].scaleinfo.pagedim.origw*r.overlayscale;if(i>0){r.overlayoffsety=r.overlayoffsety+i;var c=e[1].scaleinfo.pagedim.origh,h=e[0].scaleinfo.pagedim.origh*r.overlayscale+i*r.overlayscale}else r.h=r.h+-i*r.overlayscale,c=e[1].scaleinfo.pagedim.origh+-i*r.overlayscale,h=e[0].scaleinfo.pagedim.origh*r.overlayscale;if(r.overlayscale<1){var d=o-l;d=d>0?l+d:l}else r.overlayscale>1&&(d=(d=l-o)>0?o+d:o);if(r.overlayscale<1){var p=c-h;p=p>0?h+p:h}else r.overlayscale>1&&(p=(p=h-c)>0?c+p:c);d>r.width&&(r.width=d),p>r.height&&(r.height=p),r.overlayrotation=s}2==n&&(t=e[0].scaleinfo.scaledDistance/e[1].scaleinfo.scaledDistance,a=e[0].offset.x/t-e[1].offset.x,i=e[0].offset.y/t-e[1].offset.y,s=e[1].angle-e[0].angle,r.overlayscale=t,a>0?(r.overlayoffsetx=r.overlayoffsetx-a,o=e[0].scaleinfo.pagedim.origw,l=e[1].scaleinfo.pagedim.origw*r.overlayscale+a*r.overlayscale):(r.x=r.x- -a*r.overlayscale,o=e[0].scaleinfo.pagedim.origw+-a*r.overlayscale,l=e[1].scaleinfo.pagedim.origw*r.overlayscale),i>0?(r.overlayoffsety=r.overlayoffsety+i,c=e[0].scaleinfo.pagedim.origh,h=e[1].scaleinfo.pagedim.origh*r.overlayscale+i*r.overlayscale):(r.h=r.h+-i*r.overlayscale,c=e[0].scaleinfo.pagedim.origh+-i*r.overlayscale,h=e[1].scaleinfo.pagedim.origh*r.overlayscale),r.overlayscale<1?d=(d=l-o)>0?o+d:o:r.overlayscale>1&&(d=(d=o-l)>0?l+d:l),r.overlayscale<1?p=(p=h-c)>0?c+p:c:r.overlayscale>1&&(p=(p=c-h)>0?h+p:h),d>r.width&&(r.width=d),p>r.height&&(r.height=p),r.overlayrotation=s)}},this.nudgeRotate=function(e){e?r.fgdrawangle-=.001:r.fgdrawangle+=.001,r.bnudgeangleused=!0,r.refreshdraw()},this.nudgeScale=function(e){var t=r.overlayscale/5e3;switch(e){case 0:r.nudgeScalefactor+=t;break;case 1:r.nudgeScalefactor-=t;break;case 2:r.nudgeScalefactor=0}r.refreshdraw()},this.offsetdirect=function(e,t){r.nOffsetX=e,r.nOffsetY=t,r.refreshdraw()},this.nudgeoffset=function(e){if(null!=r.parent.fixedScale)var t=.1*r.parent.fixedScale;else t=.1;switch(e){case 0:r.nOffsetX+=t;break;case 1:r.nOffsetX-=t;break;case 2:r.nOffsetY-=t;break;case 3:r.nOffsetY+=t}r.refreshdraw()},this.scalecomparefinish=function(){Hd(),Dd(r.parent.DocRef.fileindex),null!=Ie&&Ie.setActiveFile(r.parent.DocRef.fileindex)},this.alignpage=function(e){0==e&&(Dd(r.parent.comparebgdocindex),r.bgDocObjref.GotoPage(r.bgpageindex),r.bgDocObjref.pages[r.bgpageindex].enableSnap(!0),null!=Ie&&Ie.setActiveFile(r.parent.comparebgdocindex),null!=r.bgpageindex&&eu("getoverlayscale",{p1:r.bgDocObjref.pages[r.bgpageindex],p2:0})),1==e&&(Dd(r.parent.comparefgdocindex),r.fgDocObjref.GotoPage(r.fgpageindex),r.fgDocObjref.pages[r.fgpageindex].enableSnap(!0),null!=Ie&&Ie.setActiveFile(r.parent.comparefgdocindex),null!=r.fgpageindex&&eu("getoverlayscale",{p1:r.fgDocObjref.pages[r.fgpageindex],p2:1}))},this.scalecomparepage=function(e){var t=0;0==e.length?(r.resetCompare(),t=0,r.alignpage(t)):1==e.length?(t=1,r.alignpage(t)):2==e.length&&(r.setcomparescale(e),r.scalecomparefinish())},this.scalecompare=function(){r.resetCompare(),Dd(r.parent.comparebgdocindex),r.bgDocObjref.GotoPage(r.bgpageindex),r.bgDocObjref.pages[r.bgpageindex].enableSnap(!0),null!=fa&&fa.AlignComplete(0),eu("overlayscale",{p1:r})},this.setColors=function(e,t){r.backgroundColor=e,r.overlayColor=t,r.setcompareColors(),r.parent.redraw(),null!=pa&&pa.CompareDialog()},this.getColors=function(){return{bg:r.backgroundColor,fg:r.overlayColor}},this.getInterSections=function(){this.intersections=[];for(var e=0;e<this.pathlist.length;e++){var t=g(e),a=u(e);if(t&&a&&"line"==this.pathlist[e].type)for(var i=0;i<this.pathlist.length;i++)if(e!=i&&(t=g(i),a=u(i),t&&a&&"line"==this.pathlist[i].type)){var s=this.pathlist[i].findInterSections(this.pathlist[e]);s&&this.intersections.push(s)}}},this.getBlockswFill=function(){for(var e=[],t=0;t<r.blocklist.length;t++)(r.blocklist[t].overridecolor||r.blocklist[t].overridefill)&&e.push(r.blocklist[t]);return e},this.getBlocks=function(){return r.filterblocklist},this.getFilteredAttributes=function(){return r.filterAttributelist},this.restoreBlockStates=function(){for(var e=0;e<r.blocklist.length;e++)r.blocklist[e].overridecolor=!1,r.blocklist[e].color=r.blocklist[e].defaultcolor},this.setBlockColor=function(e,t,a){var i=f(e);r.blocklist[i].overridecolor=a,r.blocklist[i].color=a?t:r.blocklist[i].defaultcolor},this.adddrawfirstlist=function(e){r.pathlistoverride.push(e),r.parent.refresh_vectorPath(e)},this.removedrawfirstlist=function(e){for(var t=void 0,a=0;a<r.pathlistoverride.length;a++)e.index==r.pathlistoverride[a].index&&(t=a);null!=t&&r.pathlistoverride.splice(t,1),r.parent.refresh_vectorPath(e)},this.setBlockHatch=function(e,t,a){var i=f(e);r.blocklist[i].overridefill=a,a?(r.blocklist[i].fillstyle=3,r.blocklist[i].hatchstyle=t,Fo(t,!0)):(r.blocklist[i].fillstyle=r.blocklist[i].defaultfillstyle,Fo(t,!1))},this.hasAttribute=function(e,t){for(var a=f(e),i=!1,s=0;s<r.attributes.length;s++)if(r.attributes[s].name.toUpperCase()==t.toUpperCase()&&r.attributes[s].blockref==a){i=!0;break}return i},this.updateAttribute=function(e,t,a){for(var i=f(e),s=0;s<r.attributes.length;s++)if(r.attributes[s].name.toUpperCase()==t.toUpperCase()&&r.attributes[s].blockref==i){r.attributes[s].value=a;break}},this.appendCustomBlockAttribute=function(e,t,a){var i={name:t,value:a,blockref:f(e)};r.attributes.push(i)},this.deleteAttribute=function(e){for(var t=[],a=0;a<r.attributes.length;a++)r.attributes[a].name.toUpperCase()!=e.toUpperCase()&&t.push(r.attributes[a]);r.attributes=t.slice()},this.FindBlockByAttr=function(e,t){for(var a=-1,i=-1,s=0;s<r.attributes.length;s++)if(r.attributes[s].name.toUpperCase()==e.toUpperCase()&&r.attributes[s].value==t){a=r.attributes[s].blockref;break}return-1!=a&&(i=r.blocklist[a].index),i},this.ViewMode=function(e){r.viewmode=e},this.setPenTable=function(e){r.applypentable=e},this.getPenTableState=function(){return r.applypentable},this.unSelectAllBlockInserts=function(){for(var e=0;e<r.blocklist.length;e++)r.blocklist[e].unselect(),r.blocklist[e].mouseon=!1;null!=Vt&&Vt.unselectAll()},this.selectBlockInsert=function(e,t){var a=m(e);a&&(a.setselect(t),null!=Ot&&Ot.set2DBlockID(a))},this.unSelectAllBlocks=function(e){for(var t=0;t<r.pathlist.length;t++)"path"==r.pathlist[t].type&&r.pathlist[t].unselect();e&&null!=Ft&&Ft.set2DBlockInfo([])},this.blockAttributes=function(e){return y(f(e))},this.selectBlockPath=function(e,t){for(var a=0;a<r.pathlist.length;a++){var i=g(a),s=u(a);i&&s&&r.pathlist[a].blockname==t&&"path"==r.pathlist[a].type&&(e?r.pathlist[a].select():r.pathlist[a].unselect())}},this.selectBlock=function(e){for(var t=[],a=f(e),i=0;i<r.pathlist.length;i++){var s=g(i),n=u(i);s&&n&&(r.pathlist[i].blockname==a?("path"==r.pathlist[i].type&&r.pathlist[i].toggleselect(),t=r.pathlist[i].selected?y(a):[]):"path"==r.pathlist[i].type&&r.pathlist[i].unselect())}null!=Ot&&Ot.set2DBlockID(r.blocklist[a]),null!=Et&&Et.set2DBlockID([r.blocklist[a].index]),null!=Ft&&Ft.set2DBlockInfo(t)},this.getblockcentroid=function(e,t,a,i){for(var s=f(e),n={},o=0;o<r.pathlist.length;o++){var l=g(o),c=u(o);if(l&&c&&r.pathlist[o].blockname==s){n=r.pathlist[o].getcentroid(t,a,i,r.x,r.y,r.h);break}}return n},this.getBlockRect=function(e,t,a,i){for(var s=f(e),n={found:!1,x:0,y:0,w:0,h:0,wp:0,hp:0},o=0;o<r.pathlist.length;o++){var l=g(o),c=u(o);if(l&&c&&r.pathlist[o].blockname==s){n=r.pathlist[o].getRectangle(t,a,i,r.x,r.y,r.h);break}}return n},this.getBlockInsertRect=function(e,t,a,i){f(e);for(var s={found:!1,x:0,y:0,w:0,h:0,wp:0,hp:0},n=0;n<r.blocklist.length;n++)if(r.blocklist[n].index==e){r.blocklist[n].state,r.blocklist[n]&&(s=r.blocklist[n].getRectangle(t,a,i,r.x,r.y,r.h));break}return s},this.setcompareColors=function(){for(var e=0;e<r.pathlist.length;e++){var t=g(e),a=u(e);t&&a&&"image"==r.pathlist[e].type&&(0==r.comparemode?(1==r.pathlist[e].role&&null!=r.pathlist[e].image&&r.pathlist[e].invert(r.backgroundColor),2==r.pathlist[e].role&&null!=r.pathlist[e].image&&r.pathlist[e].invert(r.overlayColor)):1==r.comparemode&&2==r.pathlist[e].role&&null!=r.pathlist[e].image&&r.pathlist[e].invert())}},this.setimageColor=function(e){for(var t=0;t<r.pathlist.length;t++){var a=g(t),i=u(t);a&&i&&"image"==r.pathlist[t].type&&r.pathlist[t].invert(e)}},this.getpathbyindex=function(e){var t=null,a=g(e),i=u(e);return a&&i&&(t=r.pathlist[e].getblockPath()),t},this.getpathbybId=function(e){for(var t=null,a=f(e),i=0;i<r.pathlist.length;i++){var s=g(i),n=u(i);if(s&&n&&r.pathlist[i].blockname==a){t=r.pathlist[i].getblockPath();break}}return t},this.getpathPointsBybId=function(e){for(var t=[],a=f(e),i=0;i<r.pathlist.length;i++){var s=g(i),n=u(i);if(s&&n&&r.pathlist[i].blockname==a){t=r.pathlist[i].getblockPathPoints();break}}return t},this.getpath=function(e,t,a,i,s){var n={x:e,y:t};0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(n=Fn(e,t)),e=n.x,t=n.y;for(var o=0;o<r.pathlist.length;o++){var l=g(o),c=u(o);if(l&&c&&r.pathlist[o].getpath&&"function"==typeof r.pathlist[o].getpath){var h=r.pathlist[o].getpath(e,t,a,i,s,r.x,r.y,r.h);if(null!=h)return h}}return null},this.getpathPoints=function(e,t,a,i,s){var n={x:e,y:t};0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(n=Fn(e,t)),e=n.x,t=n.y;for(var o=0;o<r.pathlist.length;o++){var l=g(o),c=u(o);if(l&&c&&r.pathlist[o].getpathPoints&&"function"==typeof r.pathlist[o].getpathPoints){var h=r.pathlist[o].getpathPoints(e,t,a,i,s,r.x,r.y,r.h);if(h.length>0)return h}}return[]},this.setBlockArea=function(e,t,a){var i=r.pathlist[e].getArea(),s=r.parent.scaleObject.AreaUnitlabel,n=r.parent.scaleObject.ndimprecision,o=qo(i);o=(o=o.toFixed(n))+" "+s,r.hasAttribute(t,a)?r.updateAttribute(t,a,o):r.appendCustomBlockAttribute(t,a,o)},this.createAreaAttributes=function(e){for(var t=0;t<r.pathlist.length;t++)r.pathlist[t].hasArea&&r.setBlockArea(t,r.pathlist[t].blockname,e)},this.getvectorinformation=function(e,t,a,i,s,o){var l={x:e,y:t},h={x:e,y:t},d=[],p={index:null},f=void 0,y=void 0,v=void 0,x=void 0;c=[];var w=void 0;0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(h=Fn(e,t)),e=h.x,t=h.y;for(var k=0;k<r.pathlist.length;k++){var D=g(k),C=u(k);D&&C&&(r.pathlist[k].mouseover=!1,r.pathlist[k].iswithin(e,t,a,i,s,r.x,r.y,r.h,o)&&c.push(r.pathlist[k]))}if(c.length>0){var R=function(e){for(var t=e[0].getArea(),a=e[0].getArea(),i=0,s=0;s<e.length;s++)(a=e[s].getArea())<t&&(i=s,t=a);return{path:e[i],area:t}}(c);f=R.path;var P=R.area;if(f&&(f.mouseover=!0,Vl(n)),w=f.index,y=m(f.blockname),null!=r.layerlist[f.layer]&&(v=r.layerlist[f.layer].name),5==f.entityType.type)S=f.getlength(),I=Math.abs(S.length)/r.parent.OriginalScale,T=Math.abs(S.radius)/r.parent.OriginalScale,P=Math.abs(S.Area)/(r.parent.OriginalScale*r.parent.OriginalScale),x={type:f.entityType.type,handle:f.entityType.handleLow,typename:b(f.entityType.type),length:I,radius:T,area:P};else if(4==f.entityType.type){var S=f.getlength();I=Math.abs(S.length)/r.parent.OriginalScale;var M=Math.abs(S.sweep),T=Math.abs(S.radius)/r.parent.OriginalScale;x={type:f.entityType.type,handle:f.entityType.handleLow,typename:b(f.entityType.type),length:I,sweep:M,radius:T}}else if(0==f.entityType.type){var E={x:f.x1,y:f.y1},F={x:f.x2,y:f.y2},I=io(Math.max(E.x,F.x)-Math.min(E.x,F.x),Math.max(E.y,F.y)-Math.min(E.y,F.y))/r.parent.OriginalScale;x={type:f.entityType.type,handle:f.entityType.handleLow,typename:b(f.entityType.type),startp:E,endp:F,length:I}}else 1==f.entityType.type?(I=f.getLength()/r.parent.OriginalScale,P/=r.parent.OriginalScale*r.parent.OriginalScale,x={type:f.entityType.type,handle:f.entityType.handleLow,typename:b(f.entityType.type),area:P,length:I}):x={type:f.entityType.type,handle:f.entityType.handleLow,typename:b(f.entityType.type)};d={Index:w,Block:y,Layername:v,Entity:x},p.index=w}else Vl(n);o?null!=jt&&jt.set2DBlockInfo(d,l,p):null!=At&&At.set2DBlockInfo(d,l,p)},this.getinsidePolygon=function(e,t,a,i,s,n,o){r.multiselect=n;var l=!1,c={x:e,y:t},h={x:e,y:t},d=[],p=[],f=[],m=[],v={index:null},x=void 0,b=0,w=0,k=void 0;0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(h=Fn(e,t)),e=h.x,t=h.y;for(var D=0;D<r.pathlist.length;D++){var C=g(D),R=u(D);if(C&&R)if(l=r.pathlist[D].insidePolygon(e,t,a,i,s,r.x,r.y,r.h,o))b=w,w=r.pathlist[D].getArea(),x&&w<b?(x=r.pathlist[D].blockname,k=D,m.unshift({foundblock:x,partindex:k,area:w})):(x=r.pathlist[D].blockname,k=D,m.push({foundblock:x,partindex:k,area:w}));else if(n&&r.pathlist[D].selected){var P=r.pathlist[D].blockname;f.push(r.blocklist[P].index)}}if(x)if(o){if(!r.pathlist[k].selected)if(m.length>1){v.index=m[0].partindex;for(var S=0;S<m.length;S++){var M=y(m[S].foundblock);M.push({index:m[S].partindex}),p.push(M)}}else p=y(x),v.index=k,p.push(v)}else r.pathlist[k].selected?r.selectBlockPath(!1,r.pathlist[k].blockname):r.selectBlockPath(!0,r.pathlist[k].blockname),r.pathlist[k].selected?(f.push(r.blocklist[x].index),n||(d=y(x),v.index=k,d.push(v))):n||(d=[]);return o||null!=Et&&Et.set2DBlockID(f),n||(o||null!=Ft&&Ft.set2DBlockInfo(d),o&&null!=It&&It.set2DBlockInfo(p,c,v)),l},this.markblockinsert=function(e,t,a,i){var s,r=void 0,o=no();(ps=t/o*2)>4&&(ps=4),Vl(n),s=(r=m(e)).insert,r&&s?(r.mouseon=!0,Vl(n)):Vl(n)},this.rendermouseonVectors=function(e,t,a,i){var s=ti/2,o=ai/2,l=no();(ps=e/l*2)>4&&(ps=4),n.save(),n.translate(s,o),n.rotate(i*(Math.PI/180)),n.translate(-s,-o);for(var h=0;h<c.length;h++)c[h].mouseover&&c[h].highlight(n,e,t,a,r.x,r.y,r.h);n.restore()},this.renderSelectedBlocks=function(e,t,a,i){var s=ti/2,o=ai/2,l=no();(ps=e/l*2)>4&&(ps=4),n.save(),n.translate(s,o),n.rotate(i*(Math.PI/180)),n.translate(-s,-o);for(var c=0;c<r.blocklist.length;c++)1==r.blocklist[c].state&&null!=r.blocklist[c].insert&&(r.blocklist[c].selected||r.blocklist[c].mouseon)&&r.blocklist[c].highlight(n,e,t,a,r.x,r.y,r.h);n.restore()},this.getinsideblockinsert=function(e,t,a,i,s,o,l){var c={x:e,y:t},h={x:e,y:t},d=[],p=void 0,u=no();(ps=a/u*2)>4&&(ps=4),0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(h=Fn(e,t)),e=h.x,t=h.y;for(var g=0;g<r.blocklist.length;g++)r.blocklist[g].mouseon=!1,1==r.blocklist[g].state&&null!=r.blocklist[g].insert&&r.blocklist[g].iswithin(e,t,a,i,s,r.x,r.y,r.h)&&d.push(r.blocklist[g]);d.length>0?(p=function(e){for(var t=e[0].getArea(),a=e[0].getArea(),i=0,s=0;s<e.length;s++)(a=e[s].getArea())<t&&(i=s,t=a);return e[i]}(d))&&l&&!p.selected&&(p.mouseon=!0,Vl(n)):Vl(n),l?null!=Lt&&(p&&Lt.set2DBlockID(p,c),Lt.onBlockHover(p,c)):null!=Ot&&p&&(p.select(),Ot.set2DBlockID(p))},this.resetLayers=function(){for(var e=0;e<this.layerlist.length;e++)null!=this.layerlist[e]&&(this.layerlist[e].state=this.layerlist[e].defaultstate);null!=yt&&yt.setVectorLayers(this.layerlist)},this.filterAttributes=function(e){r.filterAttributelist=r.attributes.filter((function(t){return On(t.name,e)}))},this.filterBlocks=function(e){r.filterblocklist=r.blocklist.filter((function(t){return On(t.name,e)&&t.listed})),null!=xt&&xt.setVectorBlocks(r.filterblocklist)},this.turnBlockAllOnOff=function(e){for(var t=0;t<r.filterblocklist.length;t++)null!=r.filterblocklist[t]&&(r.filterblocklist[t].state=e?1:0);null!=xt&&xt.setVectorBlocks(r.filterblocklist)},this.turnLayerAllOnOff=function(e){for(var t=0;t<this.layerlist.length;t++)null!=this.layerlist[t]&&(this.layerlist[t].state=e?1:0);null!=yt&&yt.setVectorLayers(r.layerlist)},this.setActive=function(){null!=yt&&yt.setVectorLayers(r.layerlist),null!=xt&&xt.setVectorBlocks(r.filterblocklist)},this.getlayerlist=function(){return r.layerlist},this.turnLayerOnOff=function(e){for(var t=0;t<this.layerlist.length;t++)this.layerlist[t].index==e&&(1==this.layerlist[t].state?this.layerlist[t].state=0:this.layerlist[t].state=1,null!=vt&&vt.setVectorLayer(this.layerlist[t]))},this.changeLayerOnOff=function(e,t){for(var a=0;a<this.layerlist.length;a++)this.layerlist[a].index==e&&(this.layerlist[a].state=t?1:0,null!=vt&&vt.setVectorLayer(this.layerlist[a]))},this.resetBlocks=function(){for(var e=0;e<r.filterblocklist.length;e++)null!=r.filterblocklist[e]&&(r.filterblocklist[e].state=r.filterblocklist[e].defaultstate);for(e=0;e<r.blocklist.length;e++)null!=r.blocklist[e]&&(r.blocklist[e].state=r.blocklist[e].defaultstate);null!=xt&&xt.setVectorBlocks(r.filterblocklist)},this.turnBlockOnOff=function(e){for(var t=0;t<r.filterblocklist.length;t++)if(e==r.filterblocklist[t].index){var a=1==r.filterblocklist[t].state?0:1;r.filterblocklist[t].state=a}for(t=0;t<r.blocklist.length;t++)e==r.blocklist[t].index&&(a=1==r.blocklist[t].state?0:1,r.blocklist[t].state=a,null!=wt&&wt.setVectorBlock(r.blocklist[t]))},this.changeBlockOnOff=function(e,t){for(var a=0;a<r.filterblocklist.length;a++)e==r.filterblocklist[a].index&&(r.filterblocklist[a].state=t?1:0,null!=wt&&wt.setVectorBlock(r.filterblocklist[a]))},this.rotate_point=function(e,t,a,i,s){return s=s*Math.PI/180,{x:Math.cos(s)*(e-a)-Math.sin(s)*(t-i)+a,y:Math.sin(s)*(e-a)+Math.cos(s)*(t-i)+i}},this.gettextpos=function(e,t,a,i){var s=Math.min((e.x1-r.x)*t,(e.x2-r.x)*t),n=Math.min((r.h-e.y1)*t,(r.h-e.y2)*t),o=Math.max((e.x1-r.x)*t,(e.x2-r.x)*t),l=Math.max((r.h-e.y1)*t,(r.h-e.y2)*t),c=s+(o-s)/2,h=n+(l-n)/2,d=r.rotate_point(s,n,c,h,e.rot),p=r.rotate_point(o,l,c,h,e.rot);s=Math.min(d.x,p.x),n=Math.min(d.y,p.y),o=Math.max(d.x,p.x),l=Math.max(d.y,p.y);const u=Hl();var g=(l-n)/u;return{top:n/u,left:s/u,width:Math.abs(o-s)/u,height:Math.abs(l-n)/u,fontsize:g}},this.TextLayerClear=function(e){if(null!=e.textLayerDiv)for(;e.textLayerDiv.firstChild;)e.textLayerDiv.removeChild(e.textLayerDiv.firstChild);r.textlayerset=!1},this.TextLayerBuilder=function(e){if(!r.textlayerset){for(var t=0;t<r.textlist.length;t++){var i=r.gettextpos(r.textlist[t],e.scale,e.dx,e.dy),s=document.createElement("div"),n=i.fontsize+"px sans-serif",o=w(a,r.textlist[t].text,n),l=(i.width-o)/(r.textlist[t].text.length-1);l<1&&(l=1);var c=l+"px",h=i.left,d=i.top;if(r.textlist[t].rot,s.style.left=h+"px",s.style.top=d+"px",s.style.width=i.width+"px",s.style.height=i.height+"px",s.style.fontFamily="sans-serif",s.style.fontSize=i.fontsize+"px",s.style.letterSpacing=c,s.textContent=r.textlist[t].text,0!=r.textlist[t].rot){s.style.transformOrigin="50% 50%";var p="scale(1.3) rotate("+-r.textlist[t].rot+"deg)";s.style.transform=p}e.textLayerDiv.appendChild(s)}r.textlayerset=!0}},this.clearSearchAll=function(){for(var e=0;e<r.textlist.length;e++)r.textlist[e].draw=!1},this.textSearch=function(e,t){for(var a=t;a<r.textlist.length;a++)if(r.textlist[a].text==e)return{numtexts:r.textlist.length,position:a,textobject:r.textlist[a]};return{numtexts:r.textlist.length,position:a,textobject:r.textlist[a-1]}},this.highlightText=function(e){r.textlist[e].draw=!0},this.getsnapPoint=function(e,t,a,i,s){var n={found:!1,change:!1,x:0,y:0},o=[],l={x:e,y:t};0!=r.parent.DocRef.pages[r.parent.DocRef.currentpage].getpageRotation()&&(l=Fn(e,t)),e=l.x,t=l.y;for(var c=[],h=0;h<this.pathlist.length;h++){var d=g(h),p=u(h);d&&p&&(null==(n=this.pathlist[h].findsnapPoint(e,t,a,i,s,this.x,this.y,this.h))&&(n={found:!1,x:0,y:0,type:1}),n.found&&c.push(n),"line"==this.pathlist[h].type&&this.pathlist[h].closeToMouse(e,t,a,i,s,this.x,this.y,this.h)&&o.push(h))}for(var f=0;f<o.length;f++)for(var m=0;m<o.length;m++)if(f!=m){var y=this.pathlist[o[m]].getInterSection(e,t,this.pathlist[o[f]],a,i,s,this.x,this.y,this.h);y&&c.push({found:!0,x:y.x,y:y.y,type:2})}if(c.length>0){var v=e-c[0].x,x=t-c[0].y,b=Math.sqrt(v*v+x*x),w=Math.sqrt(v*v+x*x),k=0;for(h=0;h<c.length;h++)c[h].found&&(v=e-c[h].x,x=t-c[h].y,(w=Math.sqrt(v*v+x*x))<b&&(b=w,k=h));n=c[k]}else n={found:!1,change:!1,x:0,y:0};return n},this.offscreenscale=function(e){return this.backgroundrender?this.offscreen.width/(this.width*e):1},this.invert_images=function(e){if(!r.docompare)for(var t=0;t<r.pathlist.length;)"image"==r.pathlist[t].type&&r.pathlist[t].invert(e),t++},this.drawallmagnify=function(e,t,a,i){r.drawDirect(e,t,a,i,!0,!1,!0)},this.drawallmagnifyold=function(e,t,a,i){for(var s=1,n=1,o=0;o<r.pathlistoverride.length;o++)s=g(r.pathlistoverride[o].index)?1:0,n=u(r.pathlistoverride[o].index)?1:0,r.pathlistoverride[o]&&r.pathlistoverride[o].drawmefirst(e,t,a,i,r.x,r.y,r.h,s,n,!1,!1);for(var l=0;l<r.pathlist.length;l++)s=g(h)?1:0,n=u(h)?1:0,r.docompare?r.dooverlay?r.pathlist[l].drawemeoverlay(e,t,a,i,r.x,r.y,r.h,s,n):r.pathlist[l].drawemecompare(e,t,a,i,r.x,r.y,r.h,r.comparecolor,s,n):r.pathlist[l]&&("line"==r.pathlist[l].type?Zl(r.pathlist[l],e,t,a,i,r.x,r.y,r.h,s,n,!1,!0):r.pathlist[l].drawme(e,t,a,i,r.x,r.y,r.h,s,n,!1,!0))},this.drawallnew=function(e,t,a,i,s,n){Hl(),r.parent.DocRef.bRenderinProgress=!0;var o=(new Date).getTime();if(r.width*t*(r.height*t)>ws)r.backgroundrender=!1,r.drawDirect(e,t,a,i,s,n,!1);else{if(e.globalCompositeOperation="source-over",r.backgroundrender=!0,s){var l=1,c=1;l=r.width*t<1?1:r.width*t,c=r.height*t<1?1:r.height*t,l=Math.ceil(l+.5),c=Math.ceil(c+.5),n?(r.offscreenprint.width=l,r.offscreenprint.height=c,ru(!1,r.offscreenprintctx),r.offscreenprintctx.save(),_l(r.offscreenprintctx),r.drawDirect(r.offscreenprintctx,t,0,0,!0,n,!1),r.offscreenprintctx.restore()):(r.offscreen.width=l,r.offscreen.height=c,ru(!1,r.offscreenctx),r.offscreenctx.save(),_l(r.offscreenctx),r.drawDirect(r.offscreenctx,t,0,0,!0,n,!1),r.offscreenctx.restore())}n?r.offscreenprint.width>=1&&r.offscreenprint.height>=1&&e.drawImage(r.offscreenprint,a,i,this.width*t,this.height*t):r.offscreen.width>=1&&r.offscreen.height>=1&&e.drawImage(r.offscreen,a,i,this.width*t,this.height*t)}r.firstdraw=!0,r.docompare&&(r.firstdrawcompare=!0);var h=(new Date).getTime();r.vectorpagetime=h-o,s&&r.vectorpagetime>r.parent.vectorpagetime&&r.parent.changeinterval(r.vectorpagetime),r.parent.DocRef.bRenderinProgress=!1,null!=Ke&&Ke.renderComplete(r.parent.DocRef.fileindex)},this.drawDirect=function(e,t,a,i,s,n,o){var l=1,c=1,h=r.x,d=r.h,p=t,f=0;if(f=r.parent.loadbackgroundvectors?2:r.parent.loadoverlayvectors?1:2,!r.docompare){e.fillStyle=n?"white":r.parent.DocRef.backgroundColor,e.globalCompositeOperation="source-over";var m=r.width*t,y=r.height*t;m<1&&(m=1),y<1&&(y=1),e.fillRect(a,i,m,y)}for(var v=0;v<r.pathlistoverride.length;v++)l=g(r.pathlistoverride[v].index)?1:0,c=u(r.pathlistoverride[v].index)?1:0,r.pathlistoverride[v]&&r.pathlistoverride[v].drawmefirst(e,t,a,i,r.x,r.y,r.h,l,c,n,o);r.bcompare?(0==r.comparemode&&(e.globalCompositeOperation="multiply"),1==r.comparemode&&(e.globalCompositeOperation="source-over")):e.globalCompositeOperation="source-over";for(var x=0;x<r.pathlist.length;x++)l=g(x)?1:0,c=u(x)?1:0,r.pathlist[x]&&(r.pathlist[x].role==f?(h=r.overlayoffsetx+r.nOffsetX,d=r.overlayoffsety+r.nOffsetY,p=t*(r.overlayscale+r.nudgeScalefactor)):(h=r.x,d=r.h,p=t),"line"==r.pathlist[x].type?Zl(r.pathlist[x],e,p,a,i,h,r.y,d,l,c,n,o):r.pathlist[x].drawme(e,p,a,i,h,r.y,d,l,c,n,o))},this.refreshPath=function(e,t,a,i,s){var n=1,o=1;r.width*a*(r.height*a)>ws?(r.backgroundrender=!1,r.layerlist.length>0&&-1!=e.layer&&null!=r.layerlist[e]&&(n=r.layerlist[e.layer].state),r.blocklist.length>0&&(o=r.blocklist[e.blockname].state),e&&e.drawmefirst(t,a,i,s,r.x,r.y,r.h,n,o)):(r.backgroundrender=!0,r.layerlist.length>0&&-1!=e.layer&&null!=r.layerlist[e.layer]&&(n=r.layerlist[e.layer].state),r.blocklist.length>0&&(o=r.blocklist[e.blockname].state),"line"==e.type?Zl(e,r.offscreenctx,a,0,0,r.x,r.y,r.h,n,o,!1):e.drawmefirst(r.offscreenctx,a,0,0,r.x,r.y,r.h,n,o,!1),t.drawImage(r.offscreen,i,s,this.width*a,this.height*a))},this.drawSelected=function(e,t,a,i){if(null!=r.selectedobject){var s=1,n=1;r.width*t*(r.height*t)>ws?(r.backgroundrender=!1,r.layerlist.length>0&&-1!=r.selectedobject.layer&&null!=r.layerlist[r.selectedobject.layer]&&(s=r.layerlist[r.selectedobject.layer].state),r.blocklist.length>0&&(n=r.blocklist[r.selectedobject.blockname].state),r.selectedobject&&r.selectedobject.drawme(e,t,a,i,r.x,r.y,r.h,s,n)):(r.backgroundrender=!0,r.layerlist.length>0&&-1!=r.selectedobject.layer&&null!=r.layerlist[r.selectedobject.layer]&&(s=r.layerlist[r.selectedobject.layer].state),r.blocklist.length>0&&(n=r.blocklist[r.selectedobject.blockname].state),"line"==r.selectedobject.type?Zl(r.selectedobject,r.offscreenctx,t,0,0,r.x,r.y,r.h,s,n,drawprint):r.selectedobject.drawme(r.offscreenctx,t,0,0,r.x,r.y,r.h,s,n,drawprint),e.drawImage(r.offscreen,a,i,this.width*t,this.height*t))}},this.Close=function(){for(r.bgDocObjref&&(r.bgDocObjref.setComparelink=void 0,r.bgDocObjref=void 0),r.fgDocObjref&&(r.fgDocObjref.setComparelink=void 0,r.fgDocObjref=void 0),r.layerlist=[],r.blocklist=[],r.filterblocklist=[];0!=this.pathlist.length;)this.pathlist[this.pathlist.length-1].Close(),this.pathlist.pop();r.pathlist=[]},i?r.vectorloader=s?new oc(r,t,s):new oc(r,t):t.iscompare&&(l=t,r.flag=1,r.novectors=!0,r.x=l.x,r.y=l.y,r.w=l.w,r.h=l.h,r.scale=l.scale,r.offsetx=l.offsetx,r.offsety=l.offsety,r.width=r.w-r.x,r.height=r.h-r.y,r.fileversion=1,r.flag=1,r.bcompare=!0)}}class cc{constructor(){var e=this;this.camera=hn.getCurrentpage().camera,this.domElement=d.domElement,this.position0=this.camera.position.clone(),this.movementSpeed=1,this.upmovementSpeed=1,this.resetmovementSpeed=1,this.autoSpeedFactor=0,this.quickSpeed=!1,this.autoForward=!1,this.lookdirection=new THREE.Vector3,this.modelCenter=new THREE.Vector3(0,0,0),this.isLocked=!1,this.walkheight=1.8,this.tempWalkheight=1.8,this.walkspeed=10,this.vectorup=new THREE.Vector3(0,0,0),this.unit=1,this.maxfloordist=1.8,this.mouseDragOn=!1,this.reversemouse=!1;var t,a=performance.now(),i=!1,s=!1,r=!1,n=!1,o=!1,l=!1,c=!1,h=0,p=0,u={degrees:0,radians:0},g=new THREE.Vector3,f=new THREE.Vector3,m=(new THREE.Vector3,new THREE.Vector3),y=[],v=new THREE.Euler(0,0,0,"ZYX"),x=(Math.PI,Math.PI,new THREE.Vector3);this.setinitial=function(t,a){e.modelCenter.copy(t),e.position0.copy(t),e.position0.z=0,e.maxfloordist=hn.getCurrentpage().Vector3DPageObj.getfloorheight()},this.setDimPos=function(t,a,i){e.vectorup=t.clone(),e.update()},this.quickspeed=function(t){e.quickSpeed=t},this.movedirection=function(t,a){switch(t){case 1:i=a,a?(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y)):e.updatebirdseye();break;case 2:s=a,a?(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y)):e.updatebirdseye();break;case 3:r=a,a||(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 4:n=a,a||(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 5:o=a,a||(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 6:l=a,a||(y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),e.updatebirdseye())}},this.checkMoveToFloorDown=function(){var e=hn.getCurrentpage().Vector3DPageObj.checkcurfloor();if(hn.getCurrentpage().Vector3DPageObj.firstfloor(e))var t=e;else t=e-1;var a=hn.getCurrentpage().Vector3DPageObj.getfloorElevation(t);return l=!1,a},this.checkMoveToFloorUp=function(){var e=hn.getCurrentpage().Vector3DPageObj.checkcurfloor();if(hn.getCurrentpage().Vector3DPageObj.lastfloor(e))var t=e;else t=e+1;return hn.getCurrentpage().Vector3DPageObj.getfloorElevation(t)},this.checkmoveup=function(t){var a=hn.getCurrentpage().Vector3DPageObj.checkNewHeight(t);if(null!=a.vec){var i=a.dist;h=i,e.tempWalkheight=a.vec.z+e.maxfloordist,e.tempWalkheight=Math.round(100*(e.tempWalkheight+Number.EPSILON))/100,(i=Math.round(100*(i+Number.EPSILON))/100)<e.maxfloordist?(e.movementSpeed=e.upmovementSpeed,e.jumpup()):e.movementSpeed=e.resetmovementSpeed}},this.setCameraXYPos=function(t){var a=new THREE.Vector3(0,0,0);a.x=t.x,a.y=t.y,null==t.z?a.z=e.camera.position.z:a.z=t.z,e.tempWalkheight=a.z,e.position0.copy(a),e.camera.position.copy(a),m.copy(e.camera.position),y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),e.setbirdseye(a,u),e.updatebirdseye()},this.setbirdseye=function(t,a){null!=na&&na.cameraPos(t,a,e.modelCenter),hn.setthumcamerapos(t,a)},this.updatebirdseye=function(){hn.draw3DNav(),null!=oa&&oa.drawbirdseye()},this.getObject=function(){return e.camera},this.setTempWalkHeight=function(t){e.tempWalkheight=t},this.setwalkHeight=function(t){e.walkheight=t},this.setwalkSpeed=function(t){e.walkspeed=t},this.setwalkUnit=function(t){e.unit=t,e.movementSpeed=4*t,e.upmovementSpeed=.25*e.movementSpeed,e.resetmovementSpeed=e.movementSpeed},this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),this.mouseDragOn=!0},this.onMouseUp=function(e){this.mouseDragOn=!1,t=void 0},this.onMouseMove=function(a){if(!1!==this.mouseDragOn){var i=a.movementX||a.mozMovementX||a.webkitMovementX||0,s=a.movementY||a.mozMovementY||a.webkitMovementY||0;if(0==i&&0==s&&null!=a.touches&&null!=a.touches[0]){const e=a.touches[0];null!=t&&(i=e.pageX-t.pageX,s=e.pageY-t.pageY),t=e}v.setFromQuaternion(e.camera.quaternion),Zi?(v.z-=-.002*i,v.x-=-.002*s):(v.z-=.002*i,v.x-=.002*s),u.radians=v.z,u.radians+=.5*Math.PI,u.radians<0&&(u.radians+=2*Math.PI),e.updatebirdseye(),v.x=Math.max(-0,Math.min(Math.PI,v.x)),e.camera.quaternion.setFromEuler(v)}},this.getDirection=function(){var t=new THREE.Vector3(0,-1,0);return function(a){return a.copy(t).applyQuaternion(e.camera.quaternion)}}(),this.scrollbackward=function(t){t*=.5;var a=y.length>0,i=e.camera.position.z;e.camera.translateZ(t*e.unit),a?e.camera.position.z=i:e.tempWalkheight=e.camera.position.z,y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),g=e.camera.position.clone(),e.setbirdseye(g,u),e.updatebirdseye()},this.scrollforward=function(t){t*=.5;var a=y.length>0,i=e.camera.position.z;e.camera.translateZ(-t*e.unit),a?e.camera.position.z=i:e.tempWalkheight=e.camera.position.z,y=hn.getCurrentpage().Vector3DPageObj.getBelowIntersections(m,e.walkheight),e.checkmoveup(y),g=e.camera.position.clone(),e.setbirdseye(g,u),e.updatebirdseye()},this.moveUp=function(e){},this.moveDown=function(e){},this.jumpup=function(){!0===c&&(f.z+=30),c=!1},this.moveForward=function(t){x.setFromMatrixColumn(e.camera.matrix,0),x.crossVectors(e.camera.up,x),t*=e.unit,e.camera.position.addScaledVector(x,t)},this.moveRight=function(t){x.setFromMatrixColumn(e.camera.matrix,0),t*=e.unit,e.camera.position.addScaledVector(x,t)},this.update=function(){if(!0===e.isLocked){m.copy(e.camera.position);var t=y.length>0,d=performance.now(),v=(d-a)/1e3;f.z-=9.8*100*v*e.unit;var x=v*e.movementSpeed,b=v*e.movementSpeed*.8;if(e.quickSpeed&&(x=v*e.movementSpeed*10,b=v*e.movementSpeed*.8*10),i||e.autoForward&&!s){var w=e.camera.position.z;e.camera.translateZ(-(x+e.autoSpeedFactor)),t?e.camera.position.z=w:e.tempWalkheight=e.camera.position.z}s&&(w=e.camera.position.z,e.camera.translateZ(x),t?e.camera.position.z=w:e.tempWalkheight=e.camera.position.z),r&&e.camera.translateX(-b),n&&e.camera.translateX(b),o&&(e.camera.position.z=e.checkMoveToFloorUp(),e.tempWalkheight=e.camera.position.z,e.updatebirdseye()),l&&(e.camera.position.z=e.checkMoveToFloorDown(),e.tempWalkheight=e.camera.position.z,e.updatebirdseye()),!0===t&&h<=e.maxfloordist&&(f.z=Math.max(0,f.z),c=!0),o||(e.camera.position.z+=f.z*v),e.camera.position.z<e.tempWalkheight&&!l&&(f.z=0,e.camera.position.z=e.tempWalkheight,c=!0),e.camera.position.z<e.walkheight&&!l&&(f.z=0,e.camera.position.z=e.walkheight,c=!0),(p+=1)>10&&(g=e.camera.position.clone(),e.setbirdseye(g,u),p=0),e.position0.copy(e.camera.position),a=d}}}}class hc{constructor(){var e=this;this.object=hn.getCurrentpage().camera,this.modelCenter=new THREE.Vector3(0,0,0),this.domElement=d.domElement,this.target=new THREE.Vector3(0,0,0),this.vectorup=new THREE.Vector3(0,0,0),this.enabled=!1,this.firstxyrecieved=!1,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=90,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.mouseMove=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.target0=this.target.clone(),this.position0=this.object.position.clone();var t=10;this.setinitial=function(t,a){e.movementSpeed=Math.round(.075*a),e.lookSpeed=.125,e.lookVertical=!0,e.modelCenter.copy(t),e.position0.copy(t)},this.domElement,document,this.setPartPos=function(t,a){e.target0.copy(t),e.position0.copy(a)},this.setPos=function(){e.target.set(0,5,0),e.update()},this.setCameraXYPos=function(t){var a=new THREE.Vector3(0,0,0);a.x=t.x,a.y=t.y,null==t.z?a.z=e.object.position.z:a.z=t.z,e.position0.copy(a),e.object.position.copy(a)},this.setDimPos=function(t,a,i){e.firstxyrecieved=!1,e.vectorup=t.clone(),e.target.copy(e.target0),e.object.position.copy(e.position0),e.update()},this.reset=function(){this.lat=0,this.lon=90,this.phi=0,this.theta=0},this.setInitial=function(e,t,a,i){this.lat=e,this.lon=t,this.phi=a,this.theta=i},this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.updatebirdseye=function(){hn.draw3DNav(),null!=oa&&oa.drawbirdseye()},this.movedirection=function(t,a){switch(t){case 1:e.moveForward=a,a&&e.updatebirdseye();break;case 2:e.moveBackward=a,a&&e.updatebirdseye();break;case 3:e.moveLeft=a,a&&e.updatebirdseye();break;case 4:e.moveRight=a,a&&e.updatebirdseye();break;case 5:e.moveUp=a;break;case 6:e.moveDown=a}},this.onMouseDown=function(t){if(e.firstxyrecieved||(e.firstxyrecieved=!0),this.domElement!==document&&this.domElement.focus(),this.activeLook&&this.mouseMove)switch(t){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(this.activeLook&&this.mouseMove)switch(e){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(t,a){e.firstxyrecieved&&(this.domElement===document?(e.mouseX=-(t-e.viewHalfX),e.mouseY=-(a-e.viewHalfY)):e.mouseDragOn?(e.mouseX=t-e.domElement.offsetLeft-e.viewHalfX,e.mouseY=a-e.domElement.offsetTop-e.viewHalfY,e.updatebirdseye()):(e.mouseX=0,e.mouseY=0))},this.update=function(a){if(!1!==this.enabled&&!1!==e.firstxyrecieved){if(this.heightSpeed){if(1==e.vectorup.z)var i=THREE.Math.clamp(this.object.position.z,this.heightMin,this.heightMax),s=i-this.heightMin;else s=1==e.vectorup.y?THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin:(i=THREE.Math.clamp(this.object.position.z,this.heightMin,this.heightMax))-this.heightMin;this.autoSpeedFactor=a*(s*this.heightCoef)}else this.autoSpeedFactor=0;var r=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);var n=a*this.lookSpeed;this.activeLook||(n=0);var o=1;e.constrainVertical&&(o=Math.PI/(e.verticalMax-e.verticalMin)),e.lon-=e.mouseX*n,e.lookVertical&&(e.lat-=e.mouseY*n*o),e.lat=Math.max(-85,Math.min(85,e.lat)),e.phi=THREE.Math.degToRad(90-e.lat),e.theta=THREE.Math.degToRad(e.lon),e.constrainVertical&&(e.phi=THREE.Math.mapLinear(e.phi,0,Math.PI,e.verticalMin,e.verticalMax));var l=e.target,c=e.object.position;if(1==e.vectorup.z?(l.x=c.x+Math.sin(e.phi)*Math.cos(e.theta)*100,l.y=c.y+100*Math.sin(e.phi)*Math.sin(e.theta),l.z=c.z+100*Math.cos(e.phi)):1==e.vectorup.y?(l.x=-(c.x+Math.sin(e.phi)*Math.cos(e.theta)*100),l.y=c.y+100*Math.cos(e.phi),l.z=c.z+100*Math.sin(e.phi)*Math.sin(e.theta)):(l.x=-(c.x+Math.sin(e.phi)*Math.cos(e.theta)*100),l.y=c.y+100*Math.sin(e.phi)*Math.sin(e.theta),l.z=c.z+100*Math.cos(e.phi)),this.object.lookAt(l),(t+=1)>2){var h={degrees:e.lon,radians:e.theta};null!=na&&na.cameraPos(c,h,e.modelCenter),hn.setthumcamerapos(c,h),t=0}e.target0.copy(l),e.position0.copy(c)}},this.handleResize()}}class dc{constructor(e,t,a,i){var s=this;function r(e,t,a){s.maxx<e&&(s.maxx=e),s.maxy<t&&(s.maxy=t),s.maxz<a&&(s.maxz=a),s.minx>e&&(s.minx=e),s.miny>t&&(s.miny=t),s.minz>a&&(s.minz=a)}function n(e,t,i,n){for(;e<i;){var o=t.getFloat32(e,!0)-a.x;e+=4;var l=t.getFloat32(e,!0)-a.y;e+=4;var c=t.getFloat32(e,!0)-a.z;r(o,l,c),s.tarray[n].vectors[s.tarray[n].vindex]=o,s.tarray[n].vectors[s.tarray[n].vindex+1]=l,s.tarray[n].vectors[s.tarray[n].vindex+2]=c,s.tarray[n].vindex+=3,e+=4,o=t.getFloat32(e,!0)-a.x,e+=4,l=t.getFloat32(e,!0)-a.y,e+=4,r(o,l,c=t.getFloat32(e,!0)-a.z),s.tarray[n].vectors[s.tarray[n].vindex]=o,s.tarray[n].vectors[s.tarray[n].vindex+1]=l,s.tarray[n].vectors[s.tarray[n].vindex+2]=c,s.tarray[n].vindex+=3,e+=4,o=t.getFloat32(e,!0)-a.x,e+=4,l=t.getFloat32(e,!0)-a.y,e+=4,c=t.getFloat32(e,!0)-a.z,e+=4,r(o,l,c),s.tarray[n].vectors[s.tarray[n].vindex]=o,s.tarray[n].vectors[s.tarray[n].vindex+1]=l,s.tarray[n].vectors[s.tarray[n].vindex+2]=c,s.tarray[n].vindex+=3}}this.id=t,this.selected=!1,this.hasmesh=!1,this.attributes=[],this.format=hn.Format.substring(0,3),this.meshcolors=[],this.meshrefs=[],this.meshref=0,this.openmesh=!1,this.curTrset=0,this.isLastBlock=!1,this.isLoadComplete=!1,this.vcentroid=new THREE.Vector3,this.minx=1e6,this.maxx=0,this.miny=1e6,this.maxy=0,this.minz=1e6,this.maxz=0,this.id=e.id,this.name=e.name,this.visible=e.visible,this.transparent=e.transparent,this.defaultcolor=ao(e.color),this.facecolor=ao(e.color),this.curColor=ao(e.color),this.tempvisible=1==this.visible,this.tarray=[],this.addline=function(e,t){var i=ao(t),s=e.X1-a.x,r=e.Y1-a.y,n=e.Z1-a.z,o=e.X2-a.x,l=e.Y2-a.y,c=e.Z2-a.z,h=new Float32Array([s,r,n,o,l,c]),d=new THREE.BufferGeometry;d.setAttribute("position",new THREE.BufferAttribute(h,3)),d.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var p=new THREE.LineBasicMaterial({color:i,linewidth:2}),u=new THREE.LineSegments(d,p);u.scale.x=a.scale,u.scale.y=a.scale,u.scale.z=a.scale,a.scene.add(u)},this.appendtriangles=function(e,t,a,i){var r=s.tarray[s.curTrset].vectors.length,n=9*t;s.tarray[s.curTrset].vectors=new Float32Array(r+n),s.tarray[s.curTrset].dv.push(e),s.tarray[s.curTrset].triangles.push(t)},this.addtriangles=function(e,t,a,i){var r=[],n=[];r.push(e),n.push(t);var o={dv:r,triangles:n,color:i,vindex:0,dvpos:0,geometry:new THREE.BufferGeometry,vectors:new Float32Array(9*t)};s.tarray.push(o),this.curTrset=s.tarray.length-1},this.addpart=function(e,t,a,i,r){if(e){var n=ao(i);s.tarray.length>0?s.tarray[s.curTrset].color==n?(s.facecolor=n,s.appendtriangles(e,t,a,i)):s.addtriangles(e,t,a,n):(this.curColor=n,s.addtriangles(e,t,a,n))}},this.processmesh=function(){s.curTrset=0;for(var e=0;e<s.tarray.length;e++)for(var t=0;t<s.tarray[e].triangles.length;t++){var a=9*s.tarray[e].triangles[t]*4;n(0,s.tarray[e].dv[t],a,e)}s.addmesh(),Hs=!0},this.resetvisible=function(){s.tempvisible=1==s.visible},this.addmesh=function(){for(this.curTrset=0;0!=s.tarray.length;){s.hasmesh=!0;var e=s.tarray[s.curTrset].color;s.material=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide,shininess:20,shading:THREE.SmoothShading}),0!=s.transparent&&(s.material.transparent=!0,s.material.opacity=.3),s.tarray[s.curTrset].geometry.setAttribute("position",new THREE.BufferAttribute(s.tarray[s.curTrset].vectors,3)),s.tarray[s.curTrset].geometry.computeVertexNormals(),s.tarray[s.curTrset].geometry.computeBoundingSphere(),s.center=s.tarray[s.curTrset].geometry.boundingSphere.center.clone(),s.vcentroid.set(s.minx,s.miny,s.minz);var t=new THREE.Vector3(.5*(s.maxx-s.minx),.5*(s.maxy-s.miny),.5*(s.maxz-s.minz));s.vcentroid.add(t);var i=new THREE.Mesh(s.tarray[s.curTrset].geometry,s.material);i.name=s.id,i.scale.x=a.scale,i.scale.y=a.scale,i.scale.z=a.scale,0==this.visible&&(i.visible=!1,s.tempvisible=!1),a.scene.add(i),s.tarray.shift()}s.isLoadComplete=!0,s.isLastBlock&&a.blockreadComplete()},this.setlastblock=function(){s.isLastBlock=!0,!s.isLoadComplete&&s.hasmesh||a.blockreadComplete()},this.addAtrib=function(e,t){var a={name:e,value:t};this.attributes.push(a),"IfcSpace"==e.substring(0,8)&&(this.isSpace=!0)}}}class pc{constructor(e,t,a,i){var s=this;function r(e,t,a){s.maxx<e&&(s.maxx=e),s.maxy<t&&(s.maxy=t),s.maxz<a&&(s.maxz=a),s.minx>e&&(s.minx=e),s.miny>t&&(s.miny=t),s.minz>a&&(s.minz=a)}this.id=t,this.selected=!1,this.isSpace=!1,this.ifctype=0,this.hasmesh=!1,this.attributes=[],this.format=hn.Format.substring(0,3),this.meshcolors=[],this.meshrefs=[],this.meshref=0,this.openmesh=!1,this.curTrset=0,this.isLastBlock=!1,this.isLoadComplete=!1,this.centroid=new THREE.Vector3,this.vcentroid=new THREE.Vector3,this.minx=1e6,this.maxx=0,this.miny=1e6,this.maxy=0,this.minz=1e6,this.maxz=0,this.tempz=0,this.id=e.id,this.name=e.name,this.visible=e.visible,this.transparent=e.transparent,this.defaultcolor=ao(e.color),this.facecolor=ao(e.color),this.tempvisible=1==this.visible,this.tarray=[],this.addline=function(e,t){var i=ao(t),s=e.X1-a.x,r=e.Y1-a.y,n=e.Z1-a.z,o=e.X2-a.x,l=e.Y2-a.y,c=e.Z2-a.z,h=new Float32Array([s,r,n,o,l,c]),d=new THREE.BufferGeometry;d.setAttribute("position",new THREE.BufferAttribute(h,3)),d.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var p=new THREE.LineBasicMaterial({color:i,linewidth:2}),u=new THREE.LineSegments(d,p);u.scale.x=a.scale,u.scale.y=a.scale,u.scale.z=a.scale,a.scene.add(u)},this.addpart=function(e,t,a,i,r){if(e){var n=ao(i),o=(s.getmeshstatus(),{dv:e,triangles:t,color:n,vindex:0,dvpos:0,geometry:new THREE.BufferGeometry,vectors:new Float32Array(9*t)});s.tarray.push(o)}},this.addAtrib=function(e,t){var a={name:e,value:t};this.attributes.push(a),"IfcSpace"==e.substring(0,8)&&(this.isSpace=!0)},this.getmeshstatus=function(){return{meshexist:this.hasmesh,color:this.facecolor,open:this.openmesh}},this.appendmesh=function(e,t,a,i){},this.createmesh=function(e,t,a,i){this.openmesh=!0,this.hasmesh=!0,this.facecolor=a,this.meshcolors.push(a),this.meshref++,this.meshrefs.push(this.meshref),"IFC"==this.format?this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:5,shading:THREE.SmoothShading}):(this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:40,shading:THREE.SmoothShading}),this.material.metal=!0),0!=this.transparent&&(this.material.transparent=!0,this.material.opacity=.3)},this.processmesh=function(){s.curTrset=0,null!=s.tarray[s.curTrset]&&function(e,t,a,i){var s=0;!function r(){for(var n=Math.min(s+t,e);s<n;++s)a.call(null,s);s<e?setTimeout(r,0):i.call(null)}()}(9*s.tarray[s.curTrset].triangles*4,1332,(function(){Hs=!1,function(){var e=s.tarray[s.curTrset];if(e.dvpos<9*e.triangles*4){var t=e.dv.getFloat32(e.dvpos,!0)-a.x;e.dvpos+=4;var i=e.dv.getFloat32(e.dvpos,!0)-a.y;e.dvpos+=4;var n=e.dv.getFloat32(e.dvpos,!0)-a.z;r(t,i,n),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3,e.dvpos+=4,t=e.dv.getFloat32(e.dvpos,!0)-a.x,e.dvpos+=4,i=e.dv.getFloat32(e.dvpos,!0)-a.y,e.dvpos+=4,r(t,i,n=e.dv.getFloat32(e.dvpos,!0)-a.z),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3,e.dvpos+=4,t=e.dv.getFloat32(e.dvpos,!0)-a.x,e.dvpos+=4,i=e.dv.getFloat32(e.dvpos,!0)-a.y,e.dvpos+=4,n=e.dv.getFloat32(e.dvpos,!0)-a.z,e.dvpos+=4,r(t,i,n),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3}s.tarray[s.curTrset]=e,e.dvpos}()}),(function(){s.addmesh(),Hs=!0})),function e(){Hs=!0,null!=s.tarray[s.curTrset]&&s.tarray[s.curTrset].dvpos<9*s.tarray[s.curTrset].triangles*4&&setTimeout(e,10)}()},this.addmesh=function(){this.openmesh=!0,this.hasmesh=!0,this.facecolor=s.tarray[s.curTrset].color,this.meshcolors.push(s.tarray[s.curTrset].color),this.meshref++,this.meshrefs.push(this.meshref),"IFC"==this.format?this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:5,shading:THREE.SmoothShading}):this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:20,shading:THREE.SmoothShading}),0!=this.transparent&&(this.material.transparent=!0,this.material.opacity=.3),s.tarray[s.curTrset].geometry.setAttribute("position",new THREE.BufferAttribute(s.tarray[s.curTrset].vectors,3)),s.tarray[s.curTrset].geometry.computeVertexNormals();var e=new THREE.Mesh(s.tarray[s.curTrset].geometry,s.material);e.name=s.id,e.scale.x=a.scale,e.scale.y=a.scale,e.scale.z=a.scale,e.geometry.computeBoundingSphere(),e.geometry.computeBoundingBox(),0==this.visible&&(e.visible=!1,s.tempvisible=!1),a.scene.add(e),s.center=e.geometry.boundingSphere.center.clone(),s.radius=e.geometry.boundingSphere.radius,s.boxmax=e.geometry.boundingBox.max.clone(),s.vcentroid.set(s.minx,s.miny,s.minz);var t=new THREE.Vector3(.5*(s.maxx-s.minx),.5*(s.maxy-s.miny),.5*(s.maxz-s.minz));s.vcentroid.add(t),a.blockadded(),s.isLoadComplete=!0,s.isLastBlock&&a.blockreadComplete(),s.tarray.length,s.tarray.shift(),s.tarray.length>0&&s.processmesh()},this.setlastblock=function(){s.isLastBlock=!0,!s.isLoadComplete&&s.hasmesh||a.blockreadComplete()},this.resetvisible=function(){s.tempvisible=1==s.visible}}}class uc{constructor(e,t,a,i,s){var r=this;this.name=e,this.index=t,this.state=a,this.level=i,this.position=s,this.selected=!1,this.setSelected=function(e){r.selected=e}}}class gc{constructor(e,t){var a=this;this.parent=t,this.scene=null;var i=new THREE.ObjectLoader;this.markuploaded=function(e){a.parent.setMarkupScene(e)},this.markupProgress=function(e){console.log(e.loaded/e.total*100+"% loaded")},this.markupError=function(e){console.log("An error happened ",e)},i.load(e,a.markuploaded,a.markupProgress,a.markupError)}}class fc{constructor(e,t,a){var i=this;this.parent=t,this.scene=null;var s=a,r=new THREE.GLTFLoader;if(this.addScene=function(e,t){s=t,fi=!0,r.load(e,i.gltfloaded,i.gltfprogress,i.gltferror)},this.gltfloaded=function(e){d.domElement.style.visibility="visible",fi=!1,s?i.parent.setAddtoScene(e.scene):i.parent.setScene(e.scene),null!=sa&&sa.setUpload("hide")},this.gltfprogress=function(e){null!=sa&&sa.setUpload(Math.round(e.loaded/e.total*100))},this.gltferror=function(e){console.log("An error happened",e)},_r){var n=Th();if(n.authset)var o={Authorization:n.authString+n.baseuserstring}}else o=void 0;r.load(e,i.gltfloaded,i.gltfprogress,i.gltferror,o)}}class mc{constructor(e,i){var s=this,r=i;this.countparts=0,this.selectedpart=-1,this.clippingOn=!1,this.box=null,this.boxSize=null,this.boxCenter=null,this.navbox=null,this.navboxSize=null,this.navboxCenter=null,this.unit=1,this.pointTreshold=1,this.pointSize=1,this.explodebox=null,this.explodeboxSize=null,this.explodeboxCenter=null,this.modeluuid=null,this.modelidx=null,this.markupidx=null,this.hasmarkup=!1,this.markuplistknown=!1,this.markuploaded=!1,this.modelLoaded=!1,this.orbitcampos=null,this.shadowspotLight=null,this.orbitcamtarget=null,this.effectComposer=null,this.renderPass=null,this.saoPass=null,this.startcampos=null,this.originalpos=new THREE.Vector3,this.navboxmin=new THREE.Vector3,this.navboxmax=new THREE.Vector3,this.geometryutil=THREE.BufferGeometryUtils,i.clock=new THREE.Clock,this.gltfobject=new fc(e,s,!1),this.scene=new THREE.Scene,this.navscene=new THREE.Scene,this.markupscene=new THREE.Scene,this.markupuuid=this.markupscene.uuid,this.floorplanTextures=[],this.filterAttributelist=[],this.addedScenes=[],this.MarkupPoints=[],this.storeys=[],this.temp2DPoints=[],this.addedMetaData=[],this.cameraSaves=[],this.viewattributes=[],this.cur3Dview=null,this.active3DView=!1,this.topView=null,this.isbim=!0,this.initialwalkthroughPosSet=!1,this.curfloor=0,this.floorelevation={min:null,max:null,index:0},this.curwidth=0,this.curdepth=0,this.curheight=0,this.curminx=0,this.curmaxx=0,this.curminy=0,this.curmaxy=0,this.curminz=0,this.curmaxz=0,this.font=new Rn("Helvetica",12,!1,!1);var o=hn.Format.substring(0,3);"Autodesk Revit"==hn.Format&&(o="RVT");var l=new THREE.Euler(0,0,0,"ZYX"),c=new THREE.Vector3;const h=new THREE.DirectionalLight(16777215,2.5),p=new THREE.DirectionalLight(16777215,1),u=new THREE.DirectionalLight(16777215,.05),g=new THREE.HemisphereLight(16777215,16777215,1.5),f=new THREE.HemisphereLight(16777215,4210752,1),m=new THREE.AmbientLight(4210752,4);function y(e){for(var t=null,a=0;a<s.cameraSaves.length;a++)s.cameraSaves[a].name==e&&(t=a);return t}function v(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e}function x(e){if("Group"==e.type)for(var t=0;t<e.children.length;t++)"Mesh"!=e.children[t].type&&"LineSegments"!=e.children[t].type||(e.children[t].position.x=0,e.children[t].position.y=0,e.children[t].position.z=0);else"Mesh"==e.type&&(e.position.x=0,e.position.y=0,e.position.z=0)}function b(e,t,a){var i=[];if("Group"==e.type){for(var r=0;r<e.children.length;r++)if(("Mesh"==e.children[r].type||"LineSegments"==e.children[r].type)&&null!=e.children[r].geometry.boundingSphere.center){var n=e.children[r].geometry.boundingSphere.center.clone();if(i=s.getAttachedMarkups(e.children[r].uuid),0!=a){var o=(h=n.clone()).multiplyScalar(a);if(h.multiplyScalar(s.scale),e.children[r].position.sub(o),i.length>0)for(var l=0;l<i.length;l++)i[l].position.sub(o)}if((c=n.multiplyScalar(t)).multiplyScalar(s.scale),e.children[r].position.add(c),i.length>0)for(l=0;l<i.length;l++)i[l].position.add(c)}}else if("Mesh"==e.type){if(""===e.name)return!1;if(null!=e.geometry.boundingSphere.center){var c,h;if(n=e.geometry.boundingSphere.center.clone(),i=s.getAttachedMarkups(e.uuid),0!=a)if(o=(h=n.clone()).multiplyScalar(a),h.multiplyScalar(s.scale),e.position.sub(o),i.length>0)for(l=0;l<i.length;l++)i[l].position.sub(o);if((c=n.multiplyScalar(t)).multiplyScalar(s.scale),e.position.add(c),i.length>0)for(l=0;l<i.length;l++)i[l].position.add(c)}}return!1}function w(e,t){var a=t.clone();return null==e.userData.originalpositionX&&(e.userData.originalpositionX=t.x),null==e.userData.originalpositionY&&(e.userData.originalpositionY=t.y),null==e.userData.originalpositionZ&&(e.userData.originalpositionZ=t.z),a.set(e.userData.originalpositionX,e.userData.originalpositionY,e.userData.originalpositionZ),a}function k(e,t){var a=t.clone();return null==e.userData.centerPosX&&(e.userData.centerPosX=t.x),null==e.userData.centerPosY&&(e.userData.centerPosY=t.y),null==e.userData.centerPosZ&&(e.userData.centerPosZ=t.z),a.set(e.userData.centerPosX,e.userData.centerPosY,e.userData.centerPosZ),a}function D(e,t,a){var i=[];if("Group"==e.type){for(var r=0;r<e.children.length;r++)if(("Mesh"==e.children[r].type||"LineSegments"==e.children[r].type)&&null!=e.children[r].geometry.boundingSphere.center){var n=k(e.children[r],e.children[r].geometry.boundingSphere.center);i=s.getAttachedMarkups(e.children[r].uuid);var o=n.sub(s.boxCenter);if(o.multiplyScalar(t),e.children[r].position.copy(o),i.length>0)for(var l=0;l<i.length;l++){var c=w(i[l],i[l].position);c.add(o),i[l].position.copy(c)}}}else if("Mesh"==e.type){if(""===e.name)return!1;if(null!=e.geometry.boundingSphere.center){var h=k(e,e.geometry.boundingSphere.center);i=s.getAttachedMarkups(e.uuid);var d=h.sub(s.boxCenter);if(d.multiplyScalar(t),e.position.copy(d),i.length>0)for(l=0;l<i.length;l++){var p=w(i[l],i[l].position);p.add(d),i[l].position.copy(p)}}}return!1}new THREE.HemisphereLight(16777215,16777215,1),s.isbim="IFC"==o||"RVT"==o,h.position.set(-500,-500,500),s.isbim?h.position.set(-500,-500,500):(h.position.set(-500,500,-500),p.position.set(500,500,-500),this.scene.add(p)),this.scene.add(h),s.isbim?u.position.set(0,0,-1e3):u.position.set(0,-1e3,0),this.scene.add(u),s.isbim?i.camera=new THREE.PerspectiveCamera(70,ti/ai,.1,1e4):i.camera=new THREE.PerspectiveCamera(45,ti/ai,.1,1e4),this.explodefactor=0,this.pxplodefactor=0,this.sceneoffset=void 0,this.sceneoffsetset=!1,this.partlist=[],this.blocklist=[],this.navlist=[],this.blocklistquick=[],this.globalPlaneX=new THREE.Plane(new THREE.Vector3(1,0,0),0),this.globalPlaneY=new THREE.Plane(new THREE.Vector3(0,1,0),0),this.globalPlaneZ=new THREE.Plane(new THREE.Vector3(0,0,-1),0),this.globalPlanes=[this.globalPlaneX,this.globalPlaneY,this.globalPlaneZ],Re=Object.freeze([]),this.xPlaneconst=null,this.xPlaneEnd=null,this.xPlaneStart=null,this.yPlaneconst=null,this.yPlaneEnd=null,this.yPlaneStart=null,this.zPlaneconst=null,this.zPlaneEnd=null,this.zPlaneStart=null,this.markupLoad=function(e){this.markupobject=new gc(e,s)},this.setOrientationScene=function(e){s.navscene.up.set(e.x,e.y,e.z),i.navcamera.up.set(e.x,e.y,e.z);const t=new THREE.BoxGeometry(1,1,1),a=new THREE.BoxGeometry(2,2,2),r=new THREE.EdgesGeometry(t),n=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:16777215}));s.navscene.add(n);var o=(new THREE.TextureLoader).load("images/top.png"),l=(new THREE.TextureLoader).load("images/front.png"),c=(new THREE.TextureLoader).load("images/right.png"),h=(new THREE.TextureLoader).load("images/back.png"),d=(new THREE.TextureLoader).load("images/left.png"),p=(new THREE.TextureLoader).load("images/bottom.png"),u=[new THREE.MeshStandardMaterial({color:16777215,map:c}),new THREE.MeshStandardMaterial({color:16777215,map:d}),new THREE.MeshStandardMaterial({color:16777215,map:h}),new THREE.MeshStandardMaterial({color:16777215,map:l}),new THREE.MeshStandardMaterial({color:16777215,map:o}),new THREE.MeshStandardMaterial({color:16777215,map:p})];const g=new THREE.MeshStandardMaterial({color:16711680}),f=new THREE.Mesh(a,g),m=new THREE.Mesh(t,u);var y=new THREE.MeshBasicMaterial({color:13882323,opacity:.8}),v=new THREE.CircleGeometry(1,32),x=new THREE.Mesh(v,y);x.position.x=0,x.position.y=0,x.position.z=-.8,s.navscene.add(m),s.navscene.add(x);var b=new THREE.HemisphereLight(16777215,16777215,1);s.navscene.add(b),s.navbox=(new THREE.Box3).setFromObject(f),s.navboxSize=s.navbox.getSize(new THREE.Vector3).length(),s.navboxCenter=s.navbox.getCenter(new THREE.Vector3),s.framenavArea()},this.setMarkupScene=function(e){s.markupscene=e,s.markupuuid=s.markupscene.uuid,s.scene.add(s.markupscene),s.markupidx=null;for(var t=0;t<s.markupscene.children.length;t++)"camera"==s.markupscene.children[t].userData.type&&(s.markupscene.children[t].visible=!1),"resetView"==s.markupscene.children[t].userData.name&&(s.markupscene.children[t].geometry.dispose(),s.markupscene.children[t].material.dispose(),s.markupscene.remove(s.markupscene.children[t]));s.createsymbolTextures(),s.markuploaded=!0,s.load3Dmarkupcheck(),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)},this.load3Dmarkupcheck=function(){var e=i.DocRef.getmarkupfilesread();s.hasmarkup=i.DocRef.getnummarkupfiles()>0,e&&s.hasmarkup?s.markuploaded&&s.modelLoaded&&null!=Ye&&Ye.readComplete():e&&s.modelLoaded&&null!=Ye&&Ye.readComplete()},this.addToScene=function(e,t){s.gltfobject.addScene(e,!0),s.addedMetaData.push({metasrc:t,added:!1})},this.setAddtoScene=function(e){s.addedScenes.push({modeluuid:e.uuid,modelidx:null});var t=hn.Format.substring(0,3);"Autodesk Revit"==hn.Format&&(t="RVT"),"IFC"==t||"RVT"==t?e.up.set(0,0,1):this.scene.up.set(0,1,0),s.scene.add(e);for(var a=null,r=0;r<s.addedMetaData.length;r++)s.addedMetaData[r].added||(a=s.addedMetaData[r].metasrc,s.addedMetaData[r].added=!0);i.gltfAddLoadComplete(a)},this.getmodelUnit=function(){return s.unit},this.getmodelBox=function(){return s.box},this.setLightintensity=function(e,t){switch(e){case 1:h.intensity=t;break;case 2:u.intensity=t;break;case 3:g.intensity=t;break;case 4:f.intensity=t;break;case 5:m.intensity=t}},this.setCADmaterial=function(e){for(var t=s.getMeshChildren(),a=35/(180/Math.PI),i=0;i<t.length;i++){if("Group"==t[i].type)for(var r=0;r<t[i].children.length;r++)"Mesh"==t[i].children[r].type&&"MeshStandardMaterial"==t[i].children[r].material.type&&(e&&null!=s.geometryutil&&(t[i].children[r].geometry=s.geometryutil.toCreasedNormals(t[i].children[r].geometry,a)),t[i].children[r].material.flatShading=!1,s.isbim||(t[i].children[r].material.metalness=.1,t[i].children[r].material.roughness=.5),t[i].children[r].material.needsUpdate=!0,t[i].children[r].updateMatrixWorld());"Mesh"==t[i].type&&"MeshStandardMaterial"==t[i].material.type&&(e&&null!=s.geometryutil&&(t[i].geometry=s.geometryutil.toCreasedNormals(t[i].geometry,a)),t[i].material.flatShading=!1,s.isbim||(t[i].material.metalness=.1,t[i].material.roughness=.5),t[i].material.needsUpdate=!0,t[i].updateMatrixWorld())}},this.setScene=function(e){var t=new THREE.Vector3;s.modeluuid=e.uuid;var a=hn.Format.substring(0,3);if("Autodesk Revit"==hn.Format&&(a="RVT"),"IFC"==a||"RVT"==a?(s.isbim=!0,e.up.set(0,0,1)):(s.isbim=!1,e.up.set(0,1,0)),t.x=e.up.x,t.y=e.up.y,t.z=e.up.z,s.scene.up.set(t.x,t.y,t.z),s.scene.add(e),s.scene.add(s.markupscene),s.box=(new THREE.Box3).setFromObject(e),s.boxSize=s.box.getSize(new THREE.Vector3).length(),s.boxCenter=s.box.getCenter(new THREE.Vector3),s.isbim?(s.setLightintensity(5,4),s.setLightintensity(3,1)):(s.setLightintensity(4,2),s.setLightintensity(2,1),s.setLightintensity(1,1.2)),s.setCADmaterial(!0),s.scene.add(h.target),s.isbim?(s.scene.add(g),s.scene.add(m),d.toneMapping=THREE.NoToneMapping):(s.scene.add(f),d.toneMapping=THREE.NoToneMapping),u.position.set(s.boxCenter.x,s.boxCenter.y,s.boxCenter.z),s.isbim?u.translateZ(2*-s.boxSize):u.translateY(2*-s.boxSize),u.target.position.set(s.boxCenter.x,s.boxCenter.y,s.boxCenter.z),u.target.updateMatrixWorld(),s.isbim?(h.position.set(s.box.min.x,s.box.min.y,s.box.max.z),h.translateZ(s.boxSize),h.translateY(-s.boxSize),h.translateX(-s.boxSize)):(h.position.set(s.box.min.x,s.box.max.y,s.box.min.z),h.translateZ(-s.boxSize),h.translateY(s.boxSize),h.translateX(-s.boxSize),p.position.set(s.box.max.x,s.box.max.y,s.box.max.z),p.translateZ(s.boxSize),p.translateY(s.boxSize),p.translateX(s.boxSize),p.target.position.set(s.boxCenter.x,s.boxCenter.y,s.boxCenter.z),p.target.updateMatrixWorld()),s.boxSize<1e3?this.unit=1:this.unit=0,2==r.Unitofmeasure&&(this.unit=2),NaN!=parseFloat(r.DPI)){var n=Math.round(100*(1/parseFloat(r.DPI)*25.4+Number.EPSILON))/100;1e3==n&&0==this.unit&&(n=1)}else n=1e3;switch(n){case 1e3:this.unit=1,this.pointSize=.02,this.pointTreshold=.2,gp(1),vp("Meter");break;case 1:this.unit=0,this.pointSize=20,this.pointTreshold=200,gp(1),vp("Millimeter");break;case 304.8:this.unit=2,this.pointSize=.16,this.pointTreshold=1.6,gp(2),xp("Feet");break;case 25.4:this.unit=3,this.pointSize=1,this.pointTreshold=10,gp(2),xp("Inch");break;case 10:this.unit=4,this.pointSize=2,this.pointTreshold=20,gp(1),vp("Centimeter")}s.originalpos=new THREE.Vector3,s.originalpos=s.scene.position.clone(),i.camera.up.set(t.x,t.y,t.z),s.frameArea();var o=Math.max(s.box.max.x-s.box.min.x,s.box.max.y-s.box.min.y);i.glTFloadComplete(o,s.boxCenter,s.unit,s.box.min.z)},this.setCamera=function(){if(null==s.boxSize||null==s.boxCenter)return;const e=new THREE.Vector3(0,0,0),t=.5*s.boxSize*.5,a=THREE.MathUtils.degToRad(.5*i.camera.fov),r=t/Math.tan(a);(new THREE.Vector3).subVectors(e,s.boxCenter).multiply(new THREE.Vector3(0,1,-1)).normalize(),s.isbim?(i.camera.position.set(s.box.max.x,s.box.min.y,s.box.max.z),i.camera.translateY(-r)):(i.camera.position.set(s.box.max.x,s.box.max.y,s.box.min.z),i.camera.translateZ(2*-r)),i.camera.lookAt(s.boxCenter.x,s.boxCenter.y,s.boxCenter.z)},this.setnavCamera=function(){if(null==s.navboxSize||null==s.navboxCenter)return;new THREE.Vector3(0,0,0);const e=.5*s.navboxSize*.5,t=THREE.MathUtils.degToRad(.5*i.navcamera.fov),a=e/Math.tan(t);i.navcamera.position.set(s.navbox.max.x,s.navbox.min.y,s.navbox.max.z),i.navcamera.translateY(-a),i.navcamera.lookAt(s.navboxCenter.x,s.navboxCenter.y,s.navboxCenter.z)},this.framenavArea=function(){null!=s.navboxSize&&null!=s.navboxCenter&&(i.navcamera.near=s.navboxSize/1e3,i.navcamera.far=300*s.navboxSize,i.navcamera.updateProjectionMatrix(),s.setnavCamera())},this.frameArea=function(){if(null!=s.boxSize&&null!=s.boxCenter){i.camera.near=s.boxSize/1e3,i.camera.far=300*s.boxSize,i.camera.updateProjectionMatrix(),s.setCamera();var e=s.box.max.x-s.box.min.x,t=s.box.max.y-s.box.min.y,a=s.box.max.z-s.box.min.z,r=s.box.min.x,n=s.box.max.x,o=s.box.min.y,l=s.box.max.y,c=s.box.min.z,h=s.box.max.z;s.curwidth=e,s.curdepth=t,s.curheight=a,s.curminx=r,s.curmaxx=n,s.curminy=o,s.curmaxy=l,s.curminz=c,s.curmaxz=h,s.setClippingPlanes(e,t,a,r,n,o,l,c,h)}},this.setClippingPlanes=function(e,t,a,i,r,n,o,l,c){var h=d.domElement.width/e,p=d.domElement.height/a;this.scale=Math.min(h,p),s.xPlaneconst=e;var u=s.xPlaneconst/20;s.xPlaneconst+=u,s.xPlaneEnd=-i-e,s.xPlaneStart=r,s.xPlaneEnd-=u/2,s.yPlaneconst=t,u=s.yPlaneconst/20,s.yPlaneconst+=u,s.yPlaneEnd=-n-t,s.yPlaneStart=o,s.yPlaneEnd-=u/2,s.zPlaneconst=a,u=s.zPlaneconst/20,s.zPlaneconst+=u,s.zPlaneEnd=l,s.zPlaneStart=c,s.zPlaneEnd-=u/2,s.globalPlaneX.constant=s.xPlaneEnd+s.xPlaneconst,s.globalPlaneY.constant=s.yPlaneEnd+s.yPlaneconst,s.globalPlaneZ.constant=s.zPlaneEnd+s.zPlaneconst},this.setlightPosition=function(e,t,a){h.position.set(e,t,a)},this.closestVertex=function(e,t){var a=t.geometry.getAttribute("position");if(!(a.count<4)){var i=e.point,r=new THREE.Vector3(a.array[0],a.array[1],a.array[2]),n=new THREE.Vector3(a.array[3],a.array[4],a.array[5]),o=new THREE.Vector3(a.array[6],a.array[7],a.array[8]);r.sub(s.boxCenter),n.sub(s.boxCenter),o.sub(s.boxCenter);var l,c=i.distanceTo(r),h=i.distanceTo(n),d=i.distanceTo(o),p=Math.min(c,h);switch(p=Math.min(d,p)){case c:l=r,r.add(s.boxCenter);break;case h:l=n,n.add(s.boxCenter);break;case d:l=o,o.add(s.boxCenter)}return a=r=n=o=i=null,{vertex:l,distance:p}}},this.add2DPoints=function(e,t){if(!(t>2)){var a=[],i=e[0].point.clone();if(e[1]){var n=e[1].point.clone(),o=i.distanceTo(n),l=new THREE.Vector3;l.subVectors(i,n).setLength(.5*o).add(n)}for(var c=0;c<e.length;c++){var h=e[c].point.clone();a.push(h.x,h.y,h.z)}e[1]&&a.push(l.x,l.y,l.z);var d,p=new THREE.BufferGeometry;p.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),d=s.pointSize;var u=new THREE.PointsMaterial({color:8947848,size:d}),g=new THREE.Points(p,u);g.userData.pointx=h.x,g.userData.pointy=h.y,g.userData.pointz=h.z,e[1]&&(g.userData.dimtext=s.setdimvalue(o),g.userData.distance=o,g.userData.Unit=r.Unitofmeasure,g.userData.SubUnit=r.SubmeasureUnit),g.userData.type="dimension",g.userData.signature=Fr,g.userData.id=g.uuid,s.markupscene.add(g),e[1]&&s.addDimLine(i,n,g.uuid),null!=Tt&&Tt.setMarkupSelected(g.userData,{created:!0,modified:!1,deleted:!1}),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)}},this.dimvaluedraw=function(e,t,a,i,r){t.save();var n={w:0,h:0};t.textAlign="start";var o=1*s.font.height;this.textheight=s.font.height;var l=s.font.height/12,c=10*l,h=5*l,d=20*l,p=10*l;t.font=s.font.fontstringScaled;var u=t.measureText(i).width;if(r)var g=e.x+15,f=e.y;else g=e.x-u/2,f=e.y+o/2;t.lineWidth=1;var m=f-o;t.fillStyle="white",t.strokeStyle=a,t.fillRect(g-1*c,m-1*h,u+1*d,o+1*p),t.strokeRect(g-1*c,m-1*h,u+1*d,o+1*p),n.w=u+1*d,n.h=o+1*p,t.fillStyle="black",t.fillText(i,g,f),t.restore()},this.draw2DPoints=function(e){if(n.save(),n.strokeStyle="black",n.fillStyle="rgba(0, 0, 255, 0.5)",n.beginPath(),n.arc(e[0].x,e[0].y,8,0,2*Math.PI),n.closePath(),n.arc(e[0].x,e[0].y,4,0,2*Math.PI,!0),n.closePath(),n.arc(e[1].x,e[1].y,8,0,2*Math.PI),n.closePath(),n.arc(e[1].x,e[1].y,4,0,2*Math.PI,!0),n.closePath(),e.length>1){n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.closePath();var t=!0}t&&n.stroke(),n.fill(),n.restore()},this.inViewCheck=function(e){i.camera.updateMatrix(),i.camera.updateMatrixWorld(),parseInt(THREE.REVISION)<=127?i.camera.matrixWorldInverse.getInverse(i.camera.matrixWorld):i.camera.matrixWorldInverse.copy(i.camera.matrixWorld).invert();var t=new THREE.Frustum;return t.setFromProjectionMatrix((new THREE.Matrix4).multiplyMatrices(i.camera.projectionMatrix,i.camera.matrixWorldInverse)),!!t.containsPoint(e.pos)},this.addDimLine=function(e,t,a){var i=new Float32Array([e.x,e.y,e.z,t.x,t.y,t.z]),r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.BufferAttribute(i,3)),r.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var n=new THREE.LineBasicMaterial({color:255,linewidth:2}),o=new THREE.LineSegments(r,n);o.userData.type="dimension",o.userData.parentref=a,s.markupscene.add(o)},this.draw2DLine=function(e){n.save(),n.strokeStyle="black",n.beginPath(),n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.closePath(),n.stroke()},this.draw2DPoint=function(e,t){t.save(),t.strokeStyle="black",e.selected?t.fillStyle="rgba(255, 0, 0, 0.5)":t.fillStyle="rgba(0, 0, 255, 0.5)",t.beginPath(),t.arc(e.pos.x,e.pos.y,8,0,2*Math.PI),t.closePath(),t.arc(e.pos.x,e.pos.y,4,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()},this.setdimvalue=function(e){var t=e,a=!1;if(2==r.Unitofmeasure){mr&&(a=!0);var i=Ko(t),s=i.quot,n=i.rem;if(1==r.SubmeasureUnit){var o=s+'"';0!=i.numerator&&0!=i.denominator&&(o=i.numerator==i.denominator?s+'"':s+" "+i.numerator+"/"+i.denominator+'"')}2==r.SubmeasureUnit&&(o=0!=n?s+"' - "+n+'"':s+"'",0!=i.numerator&&0!=i.denominator&&(o=i.numerator==i.denominator?s+"' - "+n+'"':0!=n?s+"' - "+n+" "+i.numerator+"/"+i.denominator+'"':s+"' - "+i.numerator+"/"+i.denominator+'"'))}var l=Qo(t);return l=(l=(l=Qo(t)).toFixed(be))+" "+r.Unitlabel,a&&(l=o),l},this.renderMarkupPoints=function(e){if(null!=i.DocRef&&null!=i.DocRef){var a=s.getMarkupChildren(),n=[],o=[];if(e.clearRect(0,0,t.width,t.height),a.length>0&&i.DocRef.Drawmarkup)for(var l=0;l<a.length;l++){a[l].updateMatrixWorld();var c=a[l].geometry.getAttribute("position");if("Points"==a[l].type&&c.count>1){for(var h=0;h<c.count;h++){var d=h*c.itemSize,p=c.array[d],u=c.array[d+1],g=c.array[d+2],f=new THREE.Vector3(p,u,g);a[l].localToWorld(f),o.push({pos:f,selected:a[l].userData.selected}),n.push({pos:s.posToScreen(f),selected:a[l].userData.selected})}null!=a[l].userData.Unit&&a[l].userData.Unit!=r.Unitofmeasure&&null!=a[l].userData.distance&&(a[l].userData.dimtext=s.setdimvalue(a[l].userData.distance),a[l].userData.Unit=r.Unitofmeasure),null!=a[l].userData.SubUnit&&a[l].userData.SubUnit!=r.SubmeasureUnit&&null!=a[l].userData.distance&&(a[l].userData.dimtext=s.setdimvalue(a[l].userData.distance),a[l].userData.SubUnit=r.SubmeasureUnit);var m=a[l].userData.dimtext;!!s.inViewCheck(o[0])&&s.draw2DPoint(n[0],e),!!s.inViewCheck(o[1])&&s.draw2DPoint(n[1],e),!!s.inViewCheck(o[2])&&s.dimvaluedraw(n[2].pos,e,"black",m,!1),n=[],o=[]}}}},this.posToScreen=function(e){var a=e.clone().project(r.camera);return a.x=(a.x+1)/2*t.width,a.y=-(a.y-1)/2*t.height,a},this.pointToScreen=function(e){var a=e.point.clone().project(r.camera);return a.x=(a.x+1)/2*t.width,a.y=-(a.y-1)/2*t.height,a},this.storeCamera=function(e,t){var a=new THREE.Vector3;a.copy(t);var i=new THREE.Vector3;i.copy(e),s.orbitcampos=a,s.orbitcamtarget=i},this.getfloorElevation=function(e){return i.floorplans.length>0?i.floorplans[e].Elevation:s.box.min.z},this.firstfloor=function(e){return 0==e},this.lastfloor=function(e){return e==i.floorplans.length-1},this.checkcurfloor=function(){if(!s.isbim)return 0;var e=0,t=0;s.floorelevation.max=null,s.floorelevation.min=null;for(var a=null,r=0;r<i.floorplans.length;r++)i.camera.position.z>i.floorplans[r].Elevation&&(s.floorelevation.min=r,a=i.floorplans[r].index),i.camera.position.z<i.floorplans[r].Elevation&&(s.floorelevation.max=r,i.floorplans[r].index);return null==s.floorelevation.max&&null!=s.floorelevation.min&&(s.floorelevation.max=s.floorelevation.min),null==s.floorelevation.max||null==s.floorelevation.min?(e=0,t=i.floorplans[0].index):(e=s.floorelevation.min,t=a),s.curfloor!=e&&null!=et&&et.setFloorLevel({floorindex:e,storeyindex:t}),s.curfloor=e,s.curfloor},this.setControl=function(e){null!=s.boxSize&&null!=s.boxCenter&&("orbitControl"==e.name?null==s.orbitcampos?e.setDimensions(10*s.boxSize,s.boxCenter,s.orbitcamtarget,i.camera.position):e.setDimensions(10*s.boxSize,s.boxCenter,s.orbitcamtarget,s.orbitcampos):"Walkthrough3D"==e.name&&i.walkthroughcontrol.setDimPos(s.scene.up,10*s.boxSize,s.boxCenter))},this.blockreadComplete=function(){null!=Dt&&Dt.readComplete(),i.DocRef.SetActive()},this.getModelCenter=function(){return{unit:s.unit,boxCenter:s.boxCenter}},this.filterAttributes=function(e){s.filterAttributelist=s.blocklist.filter((function(t){return On(t.name,e)}))},this.addstoreys=function(e,t,a,r,n){s.storeys.push({name:t,id:a,attributes:e.ID,index:r,Elevation:n}),s.storeys.length==i.StoreyMetadata.length&&i.glTFstoreyLoadComplete()},this.getstoreyNames=function(){var e=[];s.storeys[0].Elevation?s.storeys.sort((function(e,t){return e.Elevation-t.Elevation})):s.storeys.sort((e,t)=>e.index>t.index?1:t.index>e.index?-1:0);for(var t=0;t<s.storeys.length;t++)e.push(s.storeys[t].name);return e},this.addblockscombine=function(e){var t=e.BlockAttributes;s.blocklist=s.blocklist.concat(t);for(var a=0;a<t.length;a++)s.blocklistquick.push(t[a].GlobalID)},this.addNavlist=function(e){s.navlist=[],s.navlist=e,null!=kt&&(kt.isupdate=!0,kt.set3DParts(s.navlist))},this.addblocks=function(e){s.blocklist=[],s.blocklist=e.BlockAttributes;for(var t=0;t<s.blocklist.length;t++)s.blocklistquick.push(s.blocklist[t].GlobalID);null!=We&&We.loadComplete(i.DocRef.OriginalURL,i.DocRef.bActive)},this.updateblocklist=function(){var e=s.getMeshChildren();if(0!=e.length){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)e[t].children[a].type;e[t].type}var i=s.getAddedMeshChildren();for(t=0;t<i.length;t++)for(a=0;a<i[t].length;a++){if("Group"==i[t][a].type)for(var r=0;r<i[t][a].children.length;r++)i[t][a].children[r].type;i[t][a].type}null!=kt&&(kt.isupdate=!0,kt.set3DParts(this.navlist))}},this.getarrayMeshIDs=function(e,t,a){for(var i=0;i<t.length;i++)for(var s=0;s<e.length;s++)if("Group"===e[s].type)for(var r=0;r<e[s].children.length;r++){var n=v(e[s].children[r].name,e[s].children[r].type),o=e[s].children[r].name;t[i]==n&&a.push(o)}else{if(""===e[s].name)continue;t[i]==e[s].name&&a.push(e[s].name)}return a},this.getMeshIDs=function(e){var t=s.getMeshChildren(),a=s.getAddedMeshChildren(),i=[];i=s.getarrayMeshIDs(t,e,i);for(var r=0;r<a.length;r++)i=s.getarrayMeshIDs(a[r],e,i);return i},this.getmeshUserDataAll=function(e,t,a,i){for(var s=0;s<e.length;s++)if("Group"===e[s].type)for(var r=0;r<e[s].children.length;r++){var n=v(e[s].children[r].name,e[s].children[r].type);if(i){null==e[s].children[r].userData.visible&&(e[s].children[r].userData.visible=e[s].children[r].visible?1:0),null==e[s].children[r].userData.facecolor&&(e[s].children[r].userData.facecolor=e[s].children[r].material.color.getHex()),null==e[s].children[r].userData.tempvisible&&(e[s].children[r].userData.tempvisible=1==e[s].children[r].userData.visible),null==e[s].children[r].userData.transparent&&(e[s].children[r].userData.transparent=e[s].children[r].material.transparent?1:0),null==e[s].children[r].userData.opacity&&(e[s].children[r].userData.opacity=e[s].children[r].material.opacity),null==e[s].children[r].userData.uuid&&(e[s].children[r].userData.uuid=e[s].children[r].uuid),null==e[s].children[r].userData.name&&(e[s].children[r].userData.name=e[s].children[r].name);var o={name:n,userData:e[s].children[r].userData};t.push(o)}else for(var l=0;l<a.length;l++)a[l].GlobalID==n&&(null==e[s].children[r].userData.visible&&(e[s].children[r].userData.visible=e[s].children[r].visible?1:0),null==e[s].children[r].userData.facecolor&&(e[s].children[r].userData.facecolor=e[s].children[r].material.color.getHex()),null==e[s].children[r].userData.tempvisible&&(e[s].children[r].userData.tempvisible=1==e[s].children[r].userData.visible),null==e[s].children[r].userData.uuid&&(e[s].children[r].userData.uuid=e[s].children[r].uuid),null==e[s].children[r].userData.name&&(e[s].children[r].userData.name=e[s].children[r].name),o={name:a[l].GlobalID,userData:e[s].children[r].userData,attributes:a[l]},t.push(o))}else{if(""===e[s].name)continue;for(i&&(null==e[s].userData.visible&&(e[s].userData.visible=e[s].visible?1:0),null==e[s].userData.facecolor&&(e[s].userData.facecolor=e[s].material.color.getHex()),null==e[s].userData.tempvisible&&(e[s].userData.tempvisible=1==e[s].userData.visible),null==e[s].userData.uuid&&(e[s].userData.uuid=e[s].uuid),null==e[s].userData.name&&(e[s].userData.name=e[s].name),o={name:e[s].name,userData:e[s].userData},t.push(o)),l=0;l<a.length;l++)a[l].GlobalID==e[s].name&&(null==e[s].userData.visible&&(e[s].userData.visible=e[s].visible?1:0),null==e[s].userData.facecolor&&(e[s].userData.facecolor=e[s].material.color.getHex()),null==e[s].userData.tempvisible&&(e[s].userData.tempvisible=1==e[s].userData.visible),null==e[s].userData.uuid&&(e[s].userData.uuid=e[s].uuid),null==e[s].userData.name&&(e[s].userData.name=e[s].name),o={name:a[l].GlobalID,userData:e[s].userData,attributes:a[l]},t.push(o))}return t},this.getSelectedMesh=function(){for(var e=[],t=s.getMeshChildren(),a=s.getAddedMeshChildren(),i=0;i<t.length;i++)if("Group"===t[i].type)for(var r=0;r<t[i].children.length;r++)t[i].children[r].userData.selected&&e.push(t[i].children[r].name);else{if(""===t[i].name)continue;t[i].userData.selected&&e.push(t[i].name)}for(var n=0;n<a.length;n++)if("Group"===a[n].type)for(r=0;r<a[n].children.length;r++)a[n].children[r].userData.selected&&e.push(a[n].children[r].name);else{if(""===a[n].name)continue;a[n].userData.selected&&e.push(a[n].name)}return e},this.getmeshUserData=function(e,t){var a=s.getMeshChildren(),i=s.getAddedMeshChildren(),r=[];if(0==a.length)return r;r=s.getmeshUserDataAll(a,r,e,t);for(var n=0;n<i.length;n++)r=s.getmeshUserDataAll(i[n],r,e,t);return r},this.getStoreyRealIDs=function(e){for(var t=null,a=0;a<s.storeys.length;a++)s.storeys[a].name==e&&(t=a);return null!=t?(s.storeys[t].idreplaced||(s.storeys[t].attributes=s.getMeshIDs(s.storeys[t].attributes),s.storeys[t].idreplaced=!0),s.storeys[t].attributes):[]},this.getStoreyIDs=function(e){for(var t=null,a=0;a<s.storeys.length;a++)s.storeys[a].name==e&&(t=a);return null!=t?s.storeys[t].attributes:[]},this.getAttributeStorey=function(e){for(var t=[],a=null,i=0;i<s.storeys.length;i++)s.storeys[i].name==e&&(a=i);if(null!=a)for(var r=0;r<s.storeys[a].attributes.length;r++)t.push(s.storeys[a].attributes[r]);return s.getmeshUserData(t,!1)},this.searchAttributeStoreyEx=function(e,t){for(var a=[],i=null,r=0;r<s.storeys.length;r++)s.storeys[r].name==e&&(i=r);if(null!=i)for(var n=0;n<s.storeys[i].attributes.length;n++)for(let[e,r]of Object.entries(s.storeys[i].attributes[n]))if(r==t){a.push(s.storeys[i].attributes[n]);break}return s.getmeshUserData(a,!1)},this.searchAttributeStorey=function(e,t){for(var a=[],i=null,r=0;r<s.storeys.length;r++)s.storeys[r].name==e&&(i=r);if(null!=i)for(var n=0;n<s.storeys[i].attributes.length;n++)for(let[e,r]of Object.entries(s.storeys[i].attributes[n]))On(r,t)&&a.push(s.storeys[i].attributes[n]);return s.getmeshUserData(a,!1)},this.searchAttributeJSONEx=function(e){var t=[];if(null!=e)for(var a=0;a<s.blocklist.length;a++)for(let[i,r]of Object.entries(s.blocklist[a]))if(r==e){t.push(s.blocklist[a]);break}return s.getmeshUserData(t,!1)},this.searchAttributeJSON=function(e){var t=[];if(null!=e)for(var a=0;a<s.blocklist.length;a++)for(let[i,r]of Object.entries(s.blocklist[a]))if(On(r,e)){t.push(s.blocklist[a]);break}return s.getmeshUserData(t,!1)},this.searchAttribute=function(e){for(var t=-1,a=0;a<s.partlist.length;a++)for(var i=s.partlist[a],r=0;r<i.attributes.length;r++)i.attributes[r].value==e&&(t=s.partlist[a].id);return t},this.restoreClipping=function(e){if(null!=e){var t=e.x>0&&e.x<100,a=e.y>0&&e.y<100,i=e.z>0&&e.z<100;t||a||i?(s.clipping(0,e.x,!0),s.clipping(1,e.y,!0),s.clipping(2,e.z,!0)):s.clipping(-1,0,!1)}else s.clipping(-1,0,!1)},this.getClipfactor=function(){var e=(s.globalPlaneX.constant-s.xPlaneEnd)/s.xPlaneconst,t=(s.globalPlaneY.constant-s.yPlaneEnd)/s.yPlaneconst,a=(s.globalPlaneZ.constant-s.zPlaneEnd)/s.zPlaneconst;return{xplane:e,yplane:t,zplane:a,xplaneconst:100*e,yplaneconst:100*t,zplaneconst:100*a}},this.clipping=function(e,t,a){if(!s.active3DView)if(s.clippingOn=a,a){d.clippingPlanes=s.globalPlanes;var i=t/100;switch(e){case 0:var r=s.xPlaneEnd+s.xPlaneconst*i;s.globalPlaneX.constant=r;break;case 1:r=s.yPlaneEnd+s.yPlaneconst*i,s.globalPlaneY.constant=r;break;case 2:r=s.zPlaneEnd+s.zPlaneconst*i,s.globalPlaneZ.constant=r}}else d.clippingPlanes=Re},this.doexplode=!1,this.getCameraView=function(e){for(var t=null,a=0;a<s.cameraSaves.length;a++)s.cameraSaves[a].name==e&&(t=s.cameraSaves[a]);return t},this.deleteCameraView=function(e){for(var t=null,r=0;r<s.cameraSaves.length;r++)s.cameraSaves[r].name==e&&(t=r);s.cameraSaves.splice(t,1),i.delete3DMarkupbyName(e),function(e){var t=0,i=0,s=[];for(hn.markupdraworder=[],t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&(hn.markuplist[t].signature==Fr&&hn.markuplist[t].bfor3D&&hn.markuplist[t].viewname==e||(s[i]=hn.markuplist[t],hn.markupdraworder[i]=i,i++));hn.markuplist=s,hn.nummarkups=hn.markuplist.length,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Vl(n),Nl(a)}(e),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)},this.addCameraViews=function(e){for(var t=0;t<e.length;t++){if(null==e[t].explodefactor)var a=0;else a=e[t].explodefactor;if(null==e[t].clipping)var i={x:0,y:0,z:0};else i={x:e[t].clipping.x,y:e[t].clipping.y,z:e[t].clipping.z};if(null==e[t].attributes)var r=[];else r=e[t].attributes;var n={position:e[t].position,name:e[t].name,tool:e[t].tool,explodefactor:a,clipping:i,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:e[t].selectedmesharray,attributes:r};n.image.src=e[t].image,Op(n,rr).then((function(e){s.cameraSaves.push(e)}))}},this.getCameraSaves=function(){return s.cameraSaves},this.get3DResetView=function(){return s.topView},this.saveResetCam=function(){if(null==s.topView){var e=s.getmminUnit(200),t=new THREE.SphereBufferGeometry(e,32,32),a=new THREE.MeshBasicMaterial({color:16776960}),i=new THREE.Mesh(t,a);i.name="resetView";var n=d.domElement.toDataURL();s.topView={position:r.camera.matrix.toArray(),name:"resetView",tool:"orbitControl",explodefactor:0,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:[],attributes:[]},s.topView.image.src=n,Op(s.topView,rr).then((function(e){s.cameraSaves.unshift(e)}));var o=new THREE.Vector3;o.copy(r.camera.position),o.sub(s.scene.position),i.position.copy(o),i.userData.type="camera",i.userData.name=i.name,i.userData.signature=Fr,i.visible=!1,s.markupscene.add(i),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)}},this.refreshCameraImage=function(e){var t=s.getCameraView(e),a=d.domElement.toDataURL();t.image.src=a,Op(t,rr).then((function(e){console.log("3D view thumbnail updated"),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)}))},this.findViewAttribute=function(e,t,a){var i=y(a),r=!1;if(null!=i&&null!=s.cameraSaves[i].attributes)for(var n=0;n<s.cameraSaves[i].attributes.length;n++)s.cameraSaves[i].attributes[n].name==e&&s.cameraSaves[i].attributes[n].value==t&&(r=!0);return r},this.updateViewAttribute=function(e,t,a){var i=y(a);if(null!=i&&null!=s.cameraSaves[i].attributes)for(var r=0;r<s.cameraSaves[i].attributes.length;r++)s.cameraSaves[i].attributes[r].name==e&&(s.cameraSaves[i].attributes[r].name=e,s.cameraSaves[i].attributes[r].value=t)},this.deleteViewAttribute=function(e,t){var a=y(t);if(null!=a&&null!=s.cameraSaves[a].attributes){for(var i=-1,r=0;r<s.cameraSaves[a].attributes.length;r++)s.cameraSaves[a].attributes[r].name==e&&(i=r);-1!=i&&s.cameraSaves[a].attributes.splice(i,1)}},this.getViewAttributes=function(e){var t=y(e);return null!=t&&null!=s.cameraSaves[t].attributes?s.cameraSaves[t].attributes:[]},this.addViewAttribute=function(e,t,a){var i={name:e,value:t},r=y(a);null!=r&&null!=s.cameraSaves[r].attributes&&s.cameraSaves[r].attributes.push(i)},this.getViewAttribute=function(e,t){var a=void 0,i=y(t);if(null!=i&&null!=s.cameraSaves[i].attributes)for(var r=0;r<s.cameraSaves[i].attributes.length;r++)s.cameraSaves[i].attributes[r].name==e&&(a=s.cameraSaves[i].attributes[r]);return a},this.saveCamera=function(){var e=s.getmminUnit(200),t=new THREE.SphereBufferGeometry(e,32,32),a=new THREE.MeshBasicMaterial({color:16776960}),i=new THREE.Mesh(t,a),n=s.cameraSaves.length+1;i.name="markuppos_"+i.uuid+n;var o=new THREE.Vector3;o.copy(r.camera.position),o.sub(s.scene.position),i.position.copy(o),i.userData.type="camera",i.userData.name=i.name,i.userData.signature=Fr,i.visible=!0;var l=d.domElement.toDataURL();if(0!=s.pxplodefactor)var c=s.pxplodefactor/.2;else c=0;var h=s.getClipfactor();if(s.clippingOn)var p={x:h.xplaneconst,y:h.yplaneconst,z:h.zplaneconst};else p={x:0,y:0,z:0};var u={position:r.camera.matrix.toArray(),name:i.name,tool:r.DocRef.curcontrol3D,explodefactor:c,clipping:p,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:[],attributes:[]};u.selectedmesharray=s.getSelectedMesh(),u.image.src=l,Op(u,rr).then((function(e){s.cameraSaves.push(e),null!=Ct&&Ct.setCameraSave(e,hn.bActive)})),s.markupscene.add(i),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)},this.getCameraimage=function(e){for(var t=null,a=0;a<s.cameraSaves.length;a++)s.cameraSaves[a].name==e&&(t={thumbnail:s.cameraSaves[a].thumbnail,width:s.cameraSaves[a].width,height:s.cameraSaves[a].height});return t},this.setcur3DViewnull=function(){for(var e=r.DocRef.curcontrol3D,t=0;t<s.cameraSaves.length;t++)s.cameraSaves[t].name==s.cur3Dview&&(e=s.cameraSaves[t].tool);r.DocRef.curcontrol3D=e,s.cur3Dview=null;var a={iscompare:!1,numOpenFiles:yn.length,isPDF:!1,is3D:!0,markupOn3D:!1,is2D:!1,numpages:r.DocRef.pages.length,currentpage:0,activefile:r.DocRef.bActive,source:"setcur3DViewnull"};s.active3DView=!1,null!=Jt&&Jt.setGUIState(a),null!=rt&&rt.viewEvent(s.cur3Dview)},this.getcur3DView=function(){return s.cur3Dview},this.getRestoreControl=function(){for(var e=void 0,t=0;t<s.cameraSaves.length;t++)s.cameraSaves[t].name==s.cur3Dview&&(e=s.cameraSaves[t].tool);return e},this.updatebirdseye=function(){hn.draw3DNav(),null!=oa&&oa.drawbirdseye()},this.setbirdseye=function(e,t){null!=na&&na.cameraPos(e,t,s.getModelCenter()),hn.setthumcamerapos(e,t)},this.setbirdseyecamera=function(e){var t={degrees:0,radians:0};l.setFromQuaternion(e.quaternion),t.radians=l.z,t.radians+=.5*Math.PI,t.radians<0&&(t.radians+=2*Math.PI),c=e.position.clone(),s.setbirdseye(c,t),s.updatebirdseye()},this.saveresetCamera=function(){s.startcampos=r.camera.matrix.toArray()},this.restoreresetCam=function(){null!=s.startcampos&&(r.camera.matrix.fromArray(s.startcampos),r.camera.matrix.decompose(r.camera.position,r.camera.quaternion,r.camera.scale))},this.restorestartcam=function(){null!=s.startcampos&&(r.camera.matrix.fromArray(s.startcampos),r.camera.matrix.decompose(s.startcampos,r.camera.quaternion,r.camera.scale),s.orbitcampos=null,s.orbitcamtarget=s.boxCenter.clone())},this.set3DViewPos=function(e){for(var t=0;t<s.cameraSaves.length;t++)s.cameraSaves[t].name==e.userData.name&&(e.matrix.fromArray(s.cameraSaves[t].position),e.matrix.decompose(e.position,e.quaternion,e.scale))},this.restoreCameraName=function(e){for(var t=0;t<s.cameraSaves.length;t++)if(s.cameraSaves[t].name==e){if(s.cur3Dview=null,r.unselect3DBlockAll(),s.cur3Dview=e,s.active3DView=!1,eu("markupedit",{p1:!1}),r.DocRef.curcontrol3D="markupedit",r.camera.matrix.fromArray(s.cameraSaves[t].position),r.camera.matrix.decompose(r.camera.position,r.camera.quaternion,r.camera.scale),s.setbirdseyecamera(r.camera),s.cameraSaves[t].selectedmesharray)for(var a=0;a<s.cameraSaves[t].selectedmesharray.length;a++)if(s.cameraSaves[t].selectedmesharray[a]){var i=s.cameraSaves[t].selectedmesharray[a].substr(s.cameraSaves[t].selectedmesharray[a].length-2);"_0"==i&&r.select3DBlock(s.cameraSaves[t].selectedmesharray[a],!1),"_0"!=i&&"_1"!=i&&r.select3DBlock(s.cameraSaves[t].selectedmesharray[a],!1)}s.doexplode=!0,s.newExplode(0),s.doexplode=!1,null!=s.cameraSaves[t].explodefactor&&(s.doexplode=!0,s.newExplode(s.cameraSaves[t].explodefactor),s.doexplode=!1),s.restoreClipping(s.cameraSaves[t].clipping),s.active3DView=!0;var n={iscompare:!1,numOpenFiles:yn.length,isPDF:!1,is3D:!0,markupOn3D:!0,is2D:!1,numpages:r.DocRef.pages.length,currentpage:0,activefile:r.DocRef.bActive,source:"restoreCameraName"};null!=Jt&&Jt.setGUIState(n),null!=rt&&rt.viewEvent(e);break}},this.set3DViewSelectedMesh=function(e){for(var t=0;t<s.cameraSaves.length;t++)s.cameraSaves[t].name==e&&(s.cameraSaves[t].selectedmesharray=s.getSelectedMesh(),s.refreshCameraImage(e))},this.restoreCamera=function(){if(s.cameraSaves.length>=1){var e=s.cameraSaves.pop();r.camera.matrix.fromArray(e.position),r.camera.matrix.decompose(r.camera.position,r.camera.quaternion,r.camera.scale)}},this.getmarkupScene=function(){if(null!=s.markupidx)return s.markupidx;for(var e=0;e<s.scene.children.length;e++)s.scene.children[e].uuid===s.markupuuid&&(s.markupidx=e);return s.markupidx},this.getmodelGroup=function(){if(null!=s.modelidx)return s.modelidx;for(var e=0;e<s.scene.children.length;e++)s.scene.children[e].uuid===s.modeluuid&&(s.modelidx=e);return s.modelidx},this.getAddeddScenes=function(){if(s.addedScenes.length>0)for(var e=0;e<s.addedScenes.length;e++)if(null==s.addedScenes[e].modelidx)for(var t=0;t<s.scene.children.length;t++)s.scene.children[t].uuid===s.addedScenes[e].modeluuid&&(s.addedScenes[e].modelidx=t);return s.addedScenes},this.getMarkupChildren=function(){return null==s.getmarkupScene()?[]:s.scene.children[s.markupidx].children},this.setAddedMeshUserData=function(e,t,a,i){null==a?s.getAddedMeshChildren()[e][t].userData=i:s.getAddedMeshChildren()[e][t].children[a]=i},this.setMeshUserData=function(e,t,a){null==t?s.getMeshChildren()[e].userData=a:s.getMeshChildren()[e].children[t]=a},this.getAddedMeshChildren=function(){var e=[];if(0==s.getAddeddScenes().length)return e;if(0==s.addedScenes.length)return e;for(var t=0;t<s.addedScenes.length;t++)e.push(s.scene.children[s.addedScenes[t].modelidx].children);return e},this.getModelScene=function(){return null==s.getmodelGroup()?[]:s.scene.children[s.modelidx]},this.getMeshByNameLoop=function(e){for(var t=null,a=0;a<mesharray.length;a++)if("Group"==mesharray[a].type){for(var i=0;i<mesharray[a].children.length;i++)if("Mesh"==mesharray[a].children[i].type&&mesharray[a].children[i].name==e)return t=mesharray[a].children[i]}else if("Mesh"==mesharray[a].type){if(""===mesharray[a].name)continue;if(mesharray[a].name==e)return t=mesharray[a]}return t},this.getmarkupMeshByName=function(e){var t=null;return null==s.getmodelGroup()||null==s.getmarkupScene()?t:t=s.scene.children[s.markupidx].getObjectByName(e,!0)},this.getMeshByName=function(e){var t=null;return null==s.getmodelGroup()?t:t=s.scene.children[s.modelidx].getObjectByName(e,!0)},this.getMeshChildren=function(){return null==s.getmodelGroup()?[]:s.scene.children[s.modelidx].children},this.getAttachedMarkups=function(e){for(var t=[],a=s.getMarkupChildren(),i=0;i<a.length;i++)a[i].userData.connectedMesh==e&&t.push(a[i]);return t},this.getBelowIntersections=function(e,t){var a=[],i=[],r=s.getfloorheight(),n=t-r,o=e.z-n;o>r&&(r=o+.1*o);var l=new THREE.Vector3(0,0,-1).normalize(),c=(new THREE.Vector3(0,0,1).normalize(),s.getMeshChildren()),h=s.getAddedMeshChildren(),d=new THREE.Raycaster(e,l,0,r);i=d.intersectObjects(c,!0);for(var p=0;p<i.length;p++)i[p].object.visible&&null!=i[p].face&&i[p].distance<r&&a.push(i[p]);for(var u=0;u<h.length;u++)for(i=d.intersectObjects(h[u],!0),p=0;p<i.length;p++)i[p].object.visible&&null!=i[p].face&&i[p].distance<r&&a.push(i[p]);return a},this.getmeterunit=function(){return 1==s.unit?1:0==s.unit?1e3:2==s.unit?3.3:3==s.unit?39.37:4==s.unit?100:void 0},this.getmminUnit=function(e){return 1==s.unit?e/1e3:0==s.unit?e:2==s.unit?e/25.4/12:3==s.unit?e/25.4:4==s.unit?e/10:void 0},this.getfloorheight=function(){return 1==s.unit?1.8:0==s.unit?1800:2==s.unit?5.9:3==s.unit?69:4==s.unit?180:void 0},this.setBlockRef=function(e){if(24==e.name.length){var t=v(e.name,e.type);-1!=(a=s.blocklistquick.indexOf(t))&&(e.userData.blockRef=a)}else if(22==e.name.length)-1!=(a=s.blocklistquick.indexOf(e.name))&&(e.userData.blockRef=a);else if(6==e.name.length){var a;-1!=(a=s.blocklistquick.indexOf(e.name))&&(e.userData.blockRef=a)}},this.checkNewHeight=function(e){var t=null,a=(s.getfloorheight(),0),i=null;if(e.length>0){for(var r=0;r<e.length;r++)if(e[r].object.visible&&null!=e[r].face){if(null==e[r].object.userData.blockRef&&s.setBlockRef(e[r].object),!e[r].object.userData.blockRef){a=e[r].distance,i=e[r].point.clone();break}var n=Number(s.blocklist[e[r].object.userData.blockRef].RxBimType);if(n>=31&&n<=36||23==n||3==n){a=e[r].distance,i=e[r].point.clone();break}}null!=i&&(t=i)}return{vec:t,dist:a}},this.checkfloorheightAll=function(e,t,a,i,r){var n=0,o=0,l=null;if(e.length>0){for(var c=0;c<e.length;c++)if(e[c].object.visible&&null!=e[c].face&&(null==e[c].object.userData.blockRef&&s.setBlockRef(e[c].object),e[c].object.userData.blockRef)){var h=Number(s.blocklist[e[c].object.userData.blockRef].RxBimType);if(h>=31&&h<=36||23==h||3==h){n=e[c].distance,l=e[c].point.clone();break}}o=Math.abs(t-n),null!=l&&(r=(new THREE.Vector3).copy(i.multiplyScalar(o).add(a)))}return r},this.checkfloorheight=function(){var e=null,t=s.getfloorheight(),a=s.getMeshChildren(),r=s.getAddedMeshChildren(),n=new THREE.Raycaster,o=i.camera.position.clone(),l=new THREE.Vector3(0,0,-1).normalize(),c=new THREE.Vector3(0,0,1).normalize();n.set(o,l);var h=n.intersectObjects(a,!0);e=s.checkfloorheightAll(h,t,o,c,e);for(var d=0;d<r.length;d++)h=n.intersectObjects(r[d],!0),e=s.checkfloorheightAll(h,t,o,c,e);return e},this.explode=function(e){if(s.doexplode){var t=s.getMeshChildren();if(0!=t.length){var a=s.getMarkupChildren(),i=s.getAddedMeshChildren(),r=s.originalpos.clone();if(0!=e){var n,o=Math.round(s.boxSize);for(e*=o*=15e-5,l=0;l<t.length;l++)b(t[l],e,this.pxplodefactor);if(i.length>0)for(h=0;h<i.length;h++)for(d=0;d<i[h].length;d++)b(i[h][d],e,this.pxplodefactor);s.explodebox=(new THREE.Box3).setFromObject(s.scene),s.explodeboxSize=s.explodebox.getSize(new THREE.Vector3).length(),s.explodeboxCenter=s.explodebox.getCenter(new THREE.Vector3),0!=this.pxplodefactor&&(u=(p=s.originalpos.clone()).multiplyScalar(this.pxplodefactor),s.scene.position.sub(u)),r.multiplyScalar(e),s.scene.updateMatrix(),s.pxplodefactor=e}else{if(t.length>0)for(var l=0;l<t.length;l++)x(t[l]);if(a.length>0)for(var c=0;c<a.length;c++)"Mesh"==(n=a[c]).type&&(n.position.x=n.userData.originalpositionX,n.position.y=n.userData.originalpositionY,n.position.z=n.userData.originalpositionZ);if(i.length>0)for(var h=0;h<i.length;h++)for(var d=0;d<i[h].length;d++)x(i[h][d]);if(0!=this.pxplodefactor){var p=s.originalpos.clone(),u=p.multiplyScalar(this.pxplodefactor);s.scene.position.sub(u)}this.pxplodefactor=0}}}},this.newExplode=function(e){if(s.doexplode&&!s.active3DView){var t=s.getMeshChildren();if(0!=t.length){var a=s.getAddedMeshChildren(),i=s.getMarkupChildren();if(0!=e){for(e*=.2,r=0;r<t.length;r++)D(t[r],e,s.pxplodefactor);if(a.length>0)for(l=0;l<a.length;l++)for(c=0;c<a[l].length;c++)D(a[l][c],e,s.pxplodefactor);s.scene.updateMatrix(),this.pxplodefactor,s.pxplodefactor=e}else{if(t.length>0)for(var r=0;r<t.length;r++){if("Group"==t[r].type)for(var n=0;n<t[r].children.length;n++)"Mesh"!=t[r].children[n].type&&"LineSegments"!=t[r].children[n].type||(t[r].children[n].position.x=0,t[r].children[n].position.y=0,t[r].children[n].position.z=0);"Mesh"==t[r].type&&(t[r].position.x=0,t[r].position.y=0,t[r].position.z=0)}if(i.length>0)for(var o=0;o<i.length;o++)"Mesh"==i[o].type&&(i[o].position.x=i[o].userData.originalpositionX,i[o].position.y=i[o].userData.originalpositionY,i[o].position.z=i[o].userData.originalpositionZ);if(a.length>0)for(var l=0;l<a.length;l++)for(var c=0;c<a[l].length;c++)x(a[l][c]);this.pxplodefactor=0}}}},this.setmeshTranspEx=function(e,t,a,i){a?i?("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.parent.userData.transparent,e.material.opacity=e.parent.userData.opacity):("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.userData.transparent,e.material.opacity=e.userData.opacity):"LineSegments"==e.type&&t<1?e.visible=!1:(e.userData.transparent,e.material.transparent=!0,e.material.opacity=t)},this.setintialTransp=function(e,t){null==e.userData.transparent&&(e.userData.transparent=t.material.transparent?1:0),null==e.userData.opacity&&(e.userData.opacity=t.material.opacity)},this.setmeshNoSelect=function(e,t){e.userData.temptransparent=!t},this.setmeshTransp=function(e,t,a,i){a?i?("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.parent.userData.transparent,e.userData.temptransparent=!1,e.material.opacity=e.parent.userData.opacity):("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.userData.transparent,e.userData.temptransparent=!1,e.material.opacity=e.userData.opacity):i?0==e.parent.userData.transparent&&("LineSegments"==e.type&&t<1?e.visible=!1:(e.material.transparent=!0,e.userData.temptransparent=!0,e.material.opacity=t)):0==e.userData.transparent&&("LineSegments"==e.type&&t<1?e.visible=!1:(e.material.transparent=!0,e.userData.temptransparent=!0,e.material.opacity=t))},this.setBlockTransparencyOld=function(e,t,a){var i=s.getMeshChildren();if(0!=i.length){for(var r=0;r<i.length;r++){if("Group"==i[r].type)for(var n=0;n<i[r].children.length;n++)"Mesh"!=i[r].children[n].type&&"LineSegments"!=i[r].children[n].type||i[r].children[n].name==e&&(s.setintialTransp(i[r],i[r].children[n]),a?s.setmeshTranspEx(i[r].children[n],t,!1,!0):s.setmeshTranspEx(i[r].children[n],null,!0,!0));"Mesh"!=i[r].type&&"LineSegments"!=i[r].type||i[r].name==e&&(s.setintialTransp(i[r],i[r]),a?s.setmeshTranspEx(i[r],t,!1,!1):s.setmeshTranspEx(i[r],null,!0,!1))}s.doexplode=!0,0==t?s.explode(0):s.explode(.001),s.doexplode=!1,s.scene.updateMatrix()}},this.setBlockNoSelect=function(e,t){var a=s.getMeshByName(e);null!=a&&(t?s.setmeshNoSelect(a,!1):s.setmeshNoSelect(a,!0))},this.setBlockTransparency=function(e,t,a){var i=s.getMeshByName(e);null!=i&&("Group"==i.parent.type&&i.parent.uuid!=s.modeluuid?(s.setintialTransp(i.parent,i),a?s.setmeshTranspEx(i,t,!1,!0):s.setmeshTranspEx(i,null,!0,!0)):(s.setintialTransp(i,i),a?s.setmeshTranspEx(i,t,!1,!1):s.setmeshTranspEx(i,null,!0,!1)))},this.setTransparencyEx=function(e){s.setTransparency(e,!0)},this.setNoSelectAll=function(e){s.setNoSelect(e)},this.setNoSelectArray=function(e,t){for(var a=0;a<e.length;a++){if("Group"==e[a].type)for(var i=0;i<e[a].children.length;i++)"Mesh"!=e[a].children[i].type&&"LineSegments"!=e[a].children[i].type||(t?s.setmeshNoSelect(e[a].children[i],!1):s.setmeshNoSelect(e[a].children[i],!0));"Mesh"!=e[a].type&&"LineSegments"!=e[a].type||(t?s.setmeshNoSelect(e[a],!1):s.setmeshNoSelect(e[a],!0))}},this.setTransparencyArray=function(e,t,a){for(var i=0;i<e.length;i++){if("Group"==e[i].type)for(var r=0;r<e[i].children.length;r++)"Mesh"!=e[i].children[r].type&&"LineSegments"!=e[i].children[r].type||(s.setintialTransp(e[i],e[i].children[r]),a?s.setmeshTranspEx(e[i].children[r],t,!1,!0):s.setmeshTransp(e[i].children[r],t,!1,!0));"Mesh"!=e[i].type&&"LineSegments"!=e[i].type||(s.setintialTransp(e[i],e[i]),a?s.setmeshTranspEx(e[i],t,!1,!1):s.setmeshTransp(e[i],t,!1,!1))}},this.setExplodeTransparency=function(e){e?(s.doexplode=!0,0==value?s.newExplode(0):s.newExplode(.001),s.doexplode=!1):(s.doexplode=!0,s.newExplode(0),s.doexplode=!1)},this.setNoSelect=function(e){var t=s.getMeshChildren();if(0!=t.length){s.setNoSelectArray(t,e);for(var a=s.getAddedMeshChildren(),i=0;i<a.length;i++)s.setNoSelectArray(a[i],e)}},this.setTransparency=function(e,t){if(1!=e){var a=s.getMeshChildren();if(0!=a.length){s.setTransparencyArray(a,e,t);for(var i=s.getAddedMeshChildren(),r=0;r<i.length;r++)s.setTransparencyArray(i[r],e,t);s.scene.updateMatrix()}}else s.resetTransparency()},this.resetTransparencyArr=function(e){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"!=e[t].children[a].type&&"LineSegments"!=e[t].children[a].type||(s.setintialTransp(e[t],e[t].children[a]),s.setmeshTransp(e[t].children[a],null,!0,!0));"Mesh"!=e[t].type&&"LineSegments"!=e[t].type||(s.setintialTransp(e[t],e[t]),s.setmeshTransp(e[t],null,!0,!1))}},this.resetTransparency=function(){var e=s.getMeshChildren();if(0!=e.length){s.resetTransparencyArr(e);for(var t=s.getAddedMeshChildren(),a=0;a<t.length;a++)s.resetTransparencyArr(t[a]);s.scene.updateMatrix()}},this.createsymbolTextures=function(){for(var e=0;e<sn.length;e++)sn[e].canvas2=document.createElement("canvas"),sn[e].canvas2.width=128,sn[e].canvas2.height=128,sn[e].context2=sn[e].canvas2.getContext("2d"),"red"==sn[e].color||"blue"==sn[e].color||"green"==sn[e].color?sn[e].context2.drawImage(sn[e].textureimage,15,0):sn[e].context2.drawImage(sn[e].textureimage,0,0),sn[e].threeTexture=new THREE.Texture(sn[e].canvas2),sn[e].threeTexture.needsUpdate=!0,sn[e].markupmaterial=new THREE.MeshBasicMaterial({map:sn[e].threeTexture,side:THREE.DoubleSide}),sn[e].markupmaterial.transparent=!0,sn[e].markupmaterialblank=new THREE.MeshBasicMaterial({side:THREE.DoubleSide}),sn[e].markupmaterialblank.transparent=!0},this.getfloorplantexture=function(e){for(var t=null,a=0;a<s.floorplanTextures.length;a++)s.floorplanTextures[a].floornum==e&&(t=s.floorplanTextures[a]);return t},this.addfloorplanTexture=function(e,t,a){if(0!=t.width&&0!=t.height){s.floorplanTextures=[];var i=t.width/t.height,r=t.width,n=t.height;t.width>t.height?(r=4096,n=2048):(r=2048,n=4096);var o=new kn(null,r,n,"floor"+e);o.canvas2=document.createElement("canvas"),o.canvas2.width=t.width,o.canvas2.height=t.height,o.context2=o.canvas2.getContext("2d"),o.context2.drawImage(t,0,0),o.threeTexture=new THREE.CanvasTexture(o.canvas2),o.threeTexture.needsUpdate=!0,o.threeTexture.minFilter=THREE.LinearFilter,o.markupmaterial=new THREE.MeshBasicMaterial({map:o.threeTexture,side:THREE.DoubleSide}),o.markupmaterial.transparent=!1,o.markupmaterial.opacity=1,s.floorplanTextures.push({texture:o,floornum:e}),s.addfloorplanPlane(e,i,a)}else console.log("invalid canvas")},this.addfloorplanPlane=function(e,t,a){var r=s.box.max.x-s.box.min.x,n=s.box.max.y-s.box.min.y,o=r,l=n,c=0,h=0,d=s.box.max.z-s.box.min.z,p=o/l,u=i.floorplans[e].Scale,g=p/t;if(t>p?o=g>1?r*g:r/g:l=g>1?n*g:n/g,a){var f=a[1].dist/a[1].pwidth/(a[0].dist/a[0].pwidth),m=a[0].scaleinfo.scaledDistance,y=a[1].scaleinfo.scaledDistance;a[0].scaleinfo.curscale,a[1].scaleinfo.curscale,c=-.5*(r-(o/=f)),h=.5*(n-(l/=f));var v=m/y,x=a[1].offset.x*v,b=a[1].offset.y*v;c-=(x-a[0].offset.x)/u,h+=(b-a[0].offset.y)/u}for(var w=new THREE.PlaneBufferGeometry(o,l,4),k=0;k<s.floorplanTextures.length;k++)if(s.floorplanTextures[k].floornum==e)var D=s.floorplanTextures[k].texture;var C=s.getmminUnit(1),R=new THREE.Mesh(w,D.markupmaterial);R.position.copy(s.boxCenter),i.floorplans[e]&&(R.position.z=i.floorplans[e].Elevation+C),R.position.x+=c,R.position.y+=h;var P=R.position.x-.5*o,S=R.position.x+.5*o,M=R.position.y-.5*l,T=R.position.y+.5*l,E=s.box.min.z,F=s.box.max.z;s.curwidth<o&&(s.curwidth=o),s.curdepth<l&&(s.curdepth=l),s.curheight<d&&(s.curheight=d),s.curminx>P&&(s.curminx=P),s.curmaxx<S&&(s.curmaxx=S),s.curminy>M&&(s.curminy=M),s.curmaxy<T&&(s.curmaxy=T),s.curminz>E&&(s.curminz=E),s.curmaxz<F&&(s.curmaxz=F),s.setClippingPlanes(s.curwidth,s.curdepth,s.curheight,s.curminx,s.curmaxx,s.curminy,s.curmaxy,s.curminz,s.curmaxz),R.userData.signature=Fr,R.userData.id=R.uuid,R.userData.type="floorplan",R.userData.floornum=e,s.markupscene.add(R),s.scene.updateMatrix()},this.scaleSymbol=function(){},this.add3DSymbol=function(e,t){var a=s.getmminUnit(400),r=new THREE.Vector3(0,0,0).sub(e.object.position),n=a,o=a/10,l=0,c=e.point,h=new THREE.Vector3;h.copy(s.scene.up),s.createsymbolTextures();for(var d=0;d<sn.length;d++)sn[d].color==t&&(l=d);e.object.up.set(h.x,h.y,h.z),e.object.geometry.computeVertexNormals();var p=e.face.normal.clone(),u=new THREE.Object3D;u.up.set(h.x,h.y,h.z),u.position.copy(c),p.transformDirection(e.object.matrixWorld),p.multiplyScalar(1),p.add(c),u.lookAt(p);var g=new THREE.BoxBufferGeometry(a,n,o),f=[sn[l].markupmaterialblank,sn[l].markupmaterialblank,sn[l].markupmaterialblank,sn[l].markupmaterialblank,sn[l].markupmaterial,sn[l].markupmaterial],m=new THREE.Mesh(g,f);m.userData.actionStatus=t,m.userData.signature=Fr,m.userData.id=m.uuid,m.userData.type="symbol",m.userData.connectedMesh=e.object.uuid;var y=16776960;"red"==t?y=16711680:"blue"==t?y=255:"green"==t&&(y=65280),new THREE.MeshBasicMaterial({color:y,side:THREE.DoubleSide}),(new THREE.Vector3).copy(i.camera.position),m.rotation.copy(u.rotation),m.position.copy(c),m.geometry.computeBoundingSphere(),r=r.add(m.position.clone()),m.userData.originalpositionX=r.x,m.userData.originalpositionY=r.y,m.userData.originalpositionZ=r.z,s.markupscene.add(m),s.scene.updateMatrix(),null!=Tt&&Tt.setMarkupSelected(m.userData,{created:!0,modified:!1,deleted:!1}),null!=Mt&&Mt.setMarkupList(s.markupscene.children,hn.bActive)},this.setSelectedPart=function(e){this.selectedpart=e},this.getPartAttributes=function(e){for(var t=void 0,a=0;a<s.blocklist.length;a++)s.blocklist[a].GlobalID===e&&(t=s.blocklist[a]);return t},this.getSelectedPart=function(){return this.selectedpart},this.Close=function(){for(d.clippingPlanes=Re;0!=this.partlist.length;)this.partlist.pop();for(;0!=this.blocklist.length;)this.blocklist.pop();for(;0!=this.scene.children.length;){var e=this.scene.children[this.scene.children.length-1];this.scene.remove(e),e=null}d.render(this.scene,i.camera)}}}class yc{constructor(e,t,a){for(var i=this,s=!1,r=a,n=new DataView(e),o=(String.fromCharCode(n.getUint8(0)),1);o<=15;)String.fromCharCode(n.getUint8(o)),o++;this.countparts=0,this.binaryreadcomplete=!1,this.selectedpart=-1,this.version=parseInt(n.getInt32(16,!0)),this.clippingOn=!1,this.x=parseFloat(n.getFloat32(24,!0)),this.y=parseFloat(n.getFloat32(28,!0)),this.z=parseFloat(n.getFloat32(32,!0)),this.w=parseFloat(n.getFloat32(36,!0))-this.x,this.h=parseFloat(n.getFloat32(40,!0))-this.y,this.d=parseFloat(n.getFloat32(44,!0))-this.z,this.w<1e3?this.unit=1:this.unit=0,this.orignalscale=parseFloat(n.getFloat32(48,!0)),n=null;var l=d.domElement.width/this.w,c=d.domElement.height/this.h;this.scale=Math.min(l,c),a.clock=new THREE.Clock,this.scene=new THREE.Scene;var h=hn.Format.substring(0,3);"IFC"==h?this.scene.up.set(0,0,1):this.scene.up.set(0,1,0),this.explodefactor=0,this.pxplodefactor=0,this.partlist=[],this.blocklist=[];var p=this.scene.position.x,u=this.scene.position.y,g=this.scene.position.z;p+=-this.w/2*this.scale,u+=-this.h/2*this.scale,g+=-this.d/2*this.scale,this.scene.position.set(p,u,g),this.originalpos=new THREE.Vector3,this.originalpos=this.scene.position.clone(),this.scene.updateMatrix(),this.globalPlaneX=new THREE.Plane(new THREE.Vector3(1,0,0),0),this.globalPlaneY=new THREE.Plane(new THREE.Vector3(0,1,0),0),this.globalPlaneZ=new THREE.Plane(new THREE.Vector3(0,0,-1),0),this.globalPlanes=[this.globalPlaneX,this.globalPlaneY,this.globalPlaneZ],Re=Object.freeze([]),this.xPlaneconst=this.w*this.scale;var f=this.xPlaneconst/20;this.xPlaneconst+=f,this.xPlaneEnd=p,this.xPlaneStart=this.xPlaneconst-p,this.xPlaneEnd-=f/2,this.yPlaneconst=this.h*this.scale,f=this.yPlaneconst/20,this.yPlaneconst+=f,this.yPlaneEnd=u,this.yPlaneStart=this.yPlaneconst-u,this.yPlaneEnd-=f/2,this.zPlaneconst=this.d*this.scale,f=this.zPlaneconst/20,this.zPlaneconst+=f,this.zPlaneEnd=g,this.zPlaneStart=this.zPlaneconst-g,this.zPlaneEnd-=f/2,this.globalPlaneX.constant=this.xPlaneStart,this.globalPlaneY.constant=this.yPlaneStart,this.globalPlaneZ.constant=this.zPlaneStart,this.cameraSaves=[];var m=new THREE.DirectionalLight(16777215,1.2);m.position.set(-500,-500,500),this.scene.add(m);var y=new THREE.DirectionalLight(16777215,1);y.position.set(1e3,1e3,1e3),this.scene.add(y);var v=new THREE.DirectionalLight(16777215,.3);if(v.position.set(0,0,-1e3),this.scene.add(v),a.camera=new THREE.PerspectiveCamera(45,ti/ai,.1,1e4),"IFC"==hn.Format.substring(0,3)){var x=i.w/2*i.scale,b=-i.h*i.scale,w=i.d/2*i.scale;x=0,b*=2,w=0,a.camera.up.set(0,0,1)}else x=i.w/2*i.scale,b=i.h/2*i.scale,w=i.d*i.scale,x=0,b=0,w*=2,a.camera.up.set(0,1,0);a.camera.position.set(x,b,w),a.camera.lookAt(new THREE.Vector3(0,0,0)),this.scene.updateMatrix(),Hs=!1;var k=new DataView(e,52),D=parseInt(k.getInt32(0,!0)),C=-1;function R(){var t,a,s,r,n={objectid:D,blockpart:-1,bnewblock:!1,maindvpos:0,facecolor:0};t=n,a=200,s=function(){n=function(t){switch(t.objectid){case 9:t.maindvpos+=4;var a=k.getInt32(t.maindvpos,!0);t.maindvpos+=4;var s=36*a,r=new DataView(e,52+t.maindvpos,s);null!=i.partlist[t.blockpart]&&(i.partlist[t.blockpart].addpart(r,a,t.blockpart,t.facecolor,t.bnewblock),i.countparts++),t.maindvpos+=s,t.bnewblock=!1,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 10:t.maindvpos+=4;var n=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var o=t.maindvpos,l="";o<t.maindvpos+2*n;)0!=k.getUint8(o)&&(l+=String.fromCharCode(k.getUint16(o,!0))),o+=2;t.maindvpos=o;var c=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var d=t.maindvpos,p="";d<t.maindvpos+2*c;)0!=k.getUint8(d)&&(p+=String.fromCharCode(k.getUint16(d,!0))),d+=2;t.maindvpos=d,i.partlist[t.blockpart].addAtrib(l,p),t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 33:t.maindvpos+=4;var u=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var g=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var f=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var m=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var y=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var v={X1:u,Y1:g,Z1:f,X2:m,Y2:y,Z2:k.getFloat32(t.maindvpos,!0)};null!=i.partlist[t.blockpart]&&(i.partlist[t.blockpart].addline(v,t.facecolor),i.countparts++),t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 74:t.maindvpos+=4,t.facecolor=parseInt(k.getInt32(t.maindvpos,!0)),t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 75:t.maindvpos+=4,C=parseInt(k.getInt32(t.maindvpos,!0)),i.partlist[t.blockpart].ifctype=C,t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 12288:if(t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0)),i.partlist.length>0&&"IFC"==h)switch(i.partlist[t.blockpart].ifctype){case 34:i.partlist[t.blockpart].visible=0;break;case 21:i.partlist[t.blockpart].tarray[i.partlist[t.blockpart].curTrset].triangles>5e3&&(i.partlist[t.blockpart].visible=0,i.partlist[t.blockpart].tempvisible=!1)}-1!=t.blockpart&&i.partlist.length>0&&i.partlist[t.blockpart].tarray.length>0&&i.partlist[t.blockpart].processmesh();break;case 4096:t.maindvpos+=4,t.blockpart=parseInt(k.getInt32(t.maindvpos,!0)),t.bnewblock=!0,t.maindvpos+=4,t.maindvpos+=4;var x=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var b=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var w=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var D=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var R=t.maindvpos,P="";R<t.maindvpos+2*D;)0!=k.getUint8(R)&&(P+=String.fromCharCode(k.getUint16(R,!0))),R+=2;t.maindvpos=R;var S={id:t.blockpart,visible:x,transparent:b,color:w,name:P};if("IFC"==h)var M=new pc(S,t.blockpart,i,!0);else(M=new dc(S,t.blockpart,i,!0)).addAtrib("Part name",P);i.partlist[t.blockpart]=M,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 32768:i.partlist[i.partlist.length-1].setlastblock();break;default:t.objectid=32768,console.error("Failed!",t.objectid,t.maindvpos)}return t}(n)},r=function(){i.partlist[i.partlist.length-1].isLastBlock=!0,i.binaryreadcomplete=!0,k=null,Hs=!0,null!=la&&la.setDownload("hide"),i.partlist[i.partlist.length-1].isLoadComplete&&i.blockreadComplete(),i.updateblocklist()},function e(){for(var i=0;i<a;++i)s.call(null,t);32768!=t.objectid?setTimeout(e,0):r.call(null)}(),function e(){k&&32768!=n.objectid&&setTimeout(e,10)}()}r.has3Dnav?r.load3dnavigator():s=!0,this.blockadded=function(){i.countparts--,i.binaryreadcomplete&&0==i.countparts&&(i.blockreadComplete(),i.updateblocklist())},this.blockreadComplete=function(){null!=Dt&&Dt.readComplete(),a.DocRef.SetActive()},this.addblocks=function(e){this.blocklist=[],e.getElementsByTagName("navigator");for(var t=0,a=e.getElementsByTagName("partref"),i=0;i<a.length;i++){var s=a[i];for(t=0;"partref"==s.parentNode.nodeName;)s=s.parentNode,t++;if(null!=kt)var r=i*kt.listheight;else r=0;var n=a[i].attributes.getNamedItem("name").value,o=a[i].attributes.getNamedItem("index").value,l=a[i].attributes.getNamedItem("state").value,c=new uc(n,o,l,t,r);this.blocklist.push(c)}R()},this.updateblocklist=function(){for(var e=0;e<this.blocklist.length;e++){var t=this.blocklist[e].index;null!=this.partlist[t]?this.blocklist[e].state=this.partlist[t].tempvisible:this.blocklist[e].state=!1,this.partlist[t].selected?this.blocklist[e].setSelected(!0):this.blocklist[e].setSelected(!1)}null!=kt&&(kt.isupdate=!0,kt.set3DParts(this.blocklist))},this.searchAttribute=function(e){for(var t=-1,a=0;a<i.partlist.length;a++)for(var s=i.partlist[a],r=0;r<s.attributes.length;r++)s.attributes[r].value==e&&(t=i.partlist[a].id);return t},this.addpartbinary=function(e,t){},this.addpart=function(e,t){var a=e.getElementsByTagName("part"),s=0;function r(e){setTimeout((function(){if(null!=e.attributes.getNamedItem("id"))var a=e.attributes.getNamedItem("id").value;var s=new pc(e,a,i);i.partlist[a]=s,s.hasmesh,Hs=t}),10)}for(;s<a.length;)r(a[s]),s++},this.clipping=function(e,t,a){if(i.clippingOn=a,a){d.clippingPlanes=i.globalPlanes;var s=t/100;switch(e){case 0:var r=i.xPlaneEnd+i.xPlaneconst*s;i.globalPlaneX.constant=r;break;case 1:r=i.yPlaneEnd+i.yPlaneconst*s,i.globalPlaneY.constant=r;break;case 2:r=i.zPlaneEnd+i.zPlaneconst*s,i.globalPlaneZ.constant=r}}else d.clippingPlanes=Re},this.doexplode=!1,this.saveCamera=function(){var e=new THREE.SphereBufferGeometry(10,32,32),t=new THREE.MeshBasicMaterial({color:16776960}),a=new THREE.Mesh(e,t),s=i.cameraSaves.length+1;a.name="markuppos_"+s,i.cameraSaves.push({position:r.camera.matrix.toArray(),name:a.name});var n=new THREE.Vector3;n.copy(r.camera.position),n.sub(i.scene.position),a.position.copy(n),i.scene.add(a)},this.restoreCameraName=function(e){for(var t=0;t<i.cameraSaves.length;t++)i.cameraSaves[t].name==e&&(r.camera.matrix.fromArray(i.cameraSaves[t].position),r.camera.matrix.decompose(r.camera.position,r.camera.quaternion,r.camera.scale))},this.restoreCamera=function(){if(i.cameraSaves.length>=1){var e=i.cameraSaves.pop();r.camera.matrix.fromArray(e.position),r.camera.matrix.decompose(r.camera.position,r.camera.quaternion,r.camera.scale)}},this.explode=function(e){if(i.doexplode){var t=i.originalpos.clone();if(0!=e){for(e/=10,l=0;l<i.scene.children.length;l++)if(""!==i.scene.children[l].name&&"Mesh"==i.scene.children[l].type&&null!=i.partlist[i.scene.children[l].name].center){var a=i.partlist[i.scene.children[l].name].vcentroid.clone();if(0!=this.pxplodefactor){var s=a.clone(),r=s.multiplyScalar(this.pxplodefactor);s.multiplyScalar(i.scale),i.scene.children[l].position.sub(r)}var n=a.multiplyScalar(e);n.multiplyScalar(i.scale),i.scene.children[l].position.add(n)}0!=this.pxplodefactor&&(h=(c=i.originalpos.clone()).multiplyScalar(this.pxplodefactor),i.scene.position.sub(h));var o=t.multiplyScalar(e);i.scene.position.add(o),i.scene.updateMatrix(),i.pxplodefactor=e}else{for(var l=0;l<i.scene.children.length;l++)"Mesh"==i.scene.children[l].type&&(i.scene.children[l].position.x=0,i.scene.children[l].position.y=0,i.scene.children[l].position.z=0);if(0!=this.pxplodefactor){var c=i.originalpos.clone(),h=c.multiplyScalar(this.pxplodefactor);i.scene.position.sub(h)}this.pxplodefactor=0}}},this.setTransparency=function(e){for(var t=0;t<i.scene.children.length;t++)"Mesh"==i.scene.children[t].type&&0==i.partlist[i.scene.children[t].name].transparent&&(i.scene.children[t].material.transparent=!0,i.scene.children[t].material.opacity=e);i.doexplode=!0,0==e?i.explode(0):i.explode(.001),i.doexplode=!1},this.resetTransparency=function(){for(var e=0;e<i.scene.children.length;e++)"Mesh"==i.scene.children[e].type&&0==i.partlist[i.scene.children[e].name].transparent&&(i.scene.children[e].material.transparent=!1,i.scene.children[e].material.opacity=1)},this.add3DSymbol=function(e,t){var a=new THREE.PlaneGeometry(5,20,32),i=new THREE.MeshBasicMaterial({color:16776960,side:THREE.DoubleSide});new THREE.Mesh(a,i)},this.setSelectedPart=function(e){this.selectedpart=e},this.getSelectedPart=function(){return this.selectedpart},this.Close=function(){for(;0!=this.partlist.length;)this.partlist.pop();for(;0!=this.blocklist.length;)this.blocklist.pop();for(;0!=this.scene.children.length;){var e=this.scene.children[this.scene.children.length-1];this.scene.remove(e),e=null}d.render(this.scene,a.camera)},s&&R()}}class vc{constructor(e){var t=this;this.cx=0,this.cy=0,this.x=0,this.y=0,this.r=0,this.w=e.width,this.h=e.height,this.boxcenter=null,this.camerapos=null,this.cameraset=!1,this.canvas=e,this.strokecolor="rgba(211, 211, 211, 0.5)",this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.pagerotation=0,this.linewidth=Math.max(this.w,this.h),this.selected=!1,this.editaction=0,this.setpageRotation=function(e){t.pagerotation=e},this.getcamera=function(e,t,a){var i=e.x-t,s=e.y-a;return i/=e.scale,s/=e.scale,{x:i=e.boxcenter.x-i,y:s=e.boxcenter.y+s,z:null}},this.setcamera=function(e){t.cx=e.x,t.cy=e.y,t.x=e.x,t.y=e.y,t.r=e.r,t.rotation=e.rotation;var a=e.boxcenter.x-e.camerapos.x,i=e.boxcenter.y-e.camerapos.y;t.x=e.x-a*e.scale,t.y=e.y+i*e.scale,t.cameraset=!0},this.setSize=function(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h},this.getRotatedMarkup=function(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c},this.eye=function(e,a,i,s,r,n,o,l){if(t.cameraset){e.save(),e.strokeStyle="black",e.fillStyle="rgba(0, 0, 255, 0.5)",e.lineWidth=1,t.canvas.width,t.canvas.height;var c=Math.PI+.375*Math.PI;(c-=(r.radians>0?r.radians:2*Math.PI+r.radians)-.5*Math.PI)<0?c+=2*Math.PI:c>2*Math.PI&&(c-=2*Math.PI);var h=c+.25*Math.PI;e.beginPath(),e.moveTo(a,i),e.arc(a,i,s,c,h),e.lineTo(a,i),e.arc(a,i,.25*s,0,2*Math.PI),e.fill(),e.restore()}},this.Rect=function(e,a,i,s,r,n,o){e.save(),e.strokeStyle="black",e.fillStyle=o,e.lineWidth=1;var l=t.canvas.width,c=t.canvas.height;e.beginPath(),e.moveTo(0,0),e.lineTo(l,0),e.lineTo(l,c),e.lineTo(0,c),e.lineTo(0,0),e.closePath(),e.moveTo(a,i),e.lineTo(a,i+r),e.lineTo(a+s,i+r),e.lineTo(a+s,i),e.lineTo(a,i),e.closePath(),e.fill(),e.stroke(),e.restore()},this.drawoffset=function(e,t,a){},this.drawme=function(e,a){var i=t.canvas.width,s=t.canvas.height;if(0!=t.pagerotation){var r=i/2,n=s/2;e.save(),e.translate(r,n),e.rotate(t.pagerotation*(Math.PI/180)),e.translate(-r,-n)}e.save(),a?t.eye(e,this.x,this.y,this.r,this.rotation,this.distancefromCenter,t.linewidth,t.strokecolor):t.Rect(e,this.x,this.y,this.w,this.h,t.linewidth,t.strokecolor),e.restore(),0!=t.pagerotation&&e.restore()},this.moveShape=function(e,a){var i=e,s=a;switch(t.pagerotation){case 0:i=e,s=a;break;case 90:i=a,s=-e;break;case 180:i=-e,s=-a;break;case 270:i=-a,s=e}var r=t.canvas.width,n=t.canvas.height;this.x=this.x-i,this.y=this.y-s;var o=this.x,l=this.y,c=this.w,h=this.h;(o-i<0||o+i>r)&&(this.x=this.x+i),(l-s<0||l-s>n)&&(this.y=this.y+s),(o+c-i<0||o+c-i>r)&&(this.x=this.x+i),(l+h-s<0||l+h-s>n)&&(this.y=this.y+s)},this.Getwithin=function(e,t,a,i,s,r){var n=!1;return e>a&&e<i&&t>s&&t<r&&(n=!0),n},this.GetwithinRect=function(e,t,a){var i=!1;return e>a.x&&e<a.w&&t>a.y&&t<a.h&&(i=!0),i},this.iswithin=function(e,a){var i=(p=t.canvas.width)/2,s=(u=t.canvas.height)/2,r=t.pagerotation*(Math.PI/180);switch(t.pagerotation){case 0:r=t.pagerotation*(Math.PI/180);break;case 90:r=(t.pagerotation+180)*(Math.PI/180);break;case 270:r=(t.pagerotation-180)*(Math.PI/180);break;case 180:r=t.pagerotation*(Math.PI/180)}var n=!1;if(0!=t.pagerotation){var o=t.getRotatedMarkup(i,s,e,a,r);e=o.x,a=o.y}var l=Math.min(this.x,this.x+this.w),c=Math.max(this.x,this.x+this.w),h=Math.min(this.y,this.y+this.h),d=Math.max(this.y,this.y+this.h);t.Getwithin(e,a,l,c,h,d)&&(n=!0,this.editaction=1);var p=t.canvas.width-2,u=t.canvas.height-2;return t.h>=u&&t.w>=p&&(n=!1),n}}}class xc{constructor(e){var t=this;this.thumb=e,this.x0=0,this.y0=0;var a=0,i=0,s=0,r=0,n=0,o=0;function l(e){if(t.thumb.DocRef.pages[0].usevector3DGLTF&&t.thumb.floorplans.length>0)if("Walkthrough3D"==t.thumb.DocRef.curcontrol3D){var a=t.thumb.checkcurfloor(),i=t.thumb.getCurfloorElevation(a),s=t.thumb.birdseyemarker.getcamera(t.thumb.birdseyedispeye,e.xus,e.yus);s.z=i,t.thumb.set3dcamerapos(s),t.thumb.enableFloorcheck()}else"markupedit"==t.thumb.DocRef.curcontrol3D||(eu("Walkthrough3D",{}),a=t.thumb.checkcurfloor(),i=t.thumb.getCurfloorElevation(a),t.thumb.setbirdseyecamera(null,null,null),(s=t.thumb.birdseyemarker.getcamera(t.thumb.birdseyedispeye,e.xus,e.yus)).z=i,t.thumb.set3dcamerapos(s),t.thumb.enableFloorcheck(),t.thumb.DocRef.curcontrol3D="Walkthrough3D")}this.started=!1,this.operation=1,this.zoomUpdate=function(e,a,i,s){t.thumb.DocRef.bActive&&t.thumb.zoom_update(e,a,i,s)},this.panupdate=function(e,a){t.thumb.DocRef.bActive&&t.thumb.pan_update(e,a)},this.pointermove=function(e){t.MSPointerMove(e)},this.pointerdown=function(e){t.MSPointerDown(e)},this.pointerup=function(e){t.MSPointerUp(e)},this.MSPointerDown=function(e){if(t.thumb.birdseyeGUIindcnv&&t.thumb.DocRef.bActive){e.stopPropagation();var a=Zp(t.thumb.birdseyeGUIindcnv,e);t.x0=a.xus,t.y0=a.yus,2==e.button?(t.started=!0,t.operation=2,e.target.style.cursor="crosshair"):(t.thumb.birdseyemarker&&t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(a),n=t.x0,o=t.y0)}},this.mousedown=function(e){if(t.thumb.birdseyeGUIindcnv&&t.thumb.DocRef.bActive){e.preventDefault(),e.stopPropagation();var a=Zp(t.thumb.birdseyeGUIindcnv,e);t.x0=a.xus,t.y0=a.yus,2==e.button?(e.target.style.cursor="crosshair",t.started=!0,t.operation=2):(t.thumb.birdseyemarker&&(t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(a)),n=t.x0,o=t.y0)}},this.touchstart=function(e){if(t.thumb.DocRef.bActive){e.preventDefault(),t.started=!0;var a=qp(t.thumb.birdseyeGUIindcnv,e);t.operation=1,t.thumb.birdseyemarker&&(t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(mousePos)),t.x0=a.xus,t.y0=a.yus,n=t.x0,o=t.y0}},this.MSPointerMove=function(e){if(t.thumb.DocRef.bActive&&(e.preventDefault(),e.stopPropagation(),2==t.operation&&(e.target.style.cursor="crosshair"),t.started)){var l=Zp(t.thumb.birdseyeGUIindcnv,e);if(a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),s=Math.abs(l.xus-t.x0),r=Math.abs(l.yus-t.y0),s&&r)if(2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF){if(1==t.operation){var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&t.panupdate(c,h),n=l.xus,o=l.yus}}else{var d="rgba(175, 175, 175, 0.3)";t.thumb.birdseyeGUIindctx.lineWidth=1,t.thumb.birdseyeGUIindctx.strokeStyle=d,t.thumb.birdseyeGUIindctx.fillStyle=d,t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height),t.thumb.birdseyeGUIindctx.fillRect(a,i,s,r)}}},this.mousemove=function(e){if(t.thumb.DocRef.bActive&&(e.stopPropagation(),t.started)){2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF||(e.target.style.cursor="crosshair");var l=Zp(t.thumb.birdseyeGUIindcnv,e);if(a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),s=Math.abs(l.xus-t.x0),r=Math.abs(l.yus-t.y0),s&&r)if(2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF){if(1==t.operation){var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&t.panupdate(c,h),n=l.xus,o=l.yus}}else{var d="rgba(175, 175, 175, 0.3)";t.thumb.birdseyeGUIindctx.lineWidth=1,t.thumb.birdseyeGUIindctx.strokeStyle=d,t.thumb.birdseyeGUIindctx.fillStyle=d,t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height),t.thumb.birdseyeGUIindctx.fillRect(a,i,s,r)}}},this.touchmove=function(e){if(t.thumb.DocRef.bActive&&(e.preventDefault(),t.started)){var l=qp(t.thumb.birdseyeGUIindcnv,e);a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),s=Math.abs(l.xus-t.x0),r=Math.abs(l.yus-t.y0);var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&1==t.operation&&t.panupdate(c,h),n=l.xus,o=l.yus}},this.mouseout=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height)))},this.MSPointerOut=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height)))},this.MSPointerUp=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.zoomUpdate(a,i,s,r)))},this.mouseup=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.zoomUpdate(a,i,s,r)))},this.touchcancel=function(e){t.thumb.DocRef.bActive&&t.started&&(t.started=!1)},this.touchend=function(e){t.thumb.DocRef.bActive&&t.started&&(t.started=!1)}}}class bc{constructor(e,t,a,i){var s=this,r=$;this.DocRef=a,this.pagenumber=i,this.dxthumb=0,this.dythumb=0,this.dxthumbtemp=0,this.dythumbtemp=0,this.pageRendering=!1,this.dscalethumb=1,this.bserverthumbnail=!1,this.dscalebirdseye=1,this.pdftempthumbscale=1,this.pdfpagewidth=1,this.pdfpageheight=1,this.usefoxitthumb=!1,this.bautoloadthumbnails=_i,this.bfinalsize=!1,this.floorplanWidth=4096,this.floorplanHeight=2048,this.birdseyeWidth=350,this.birdseyeHeight=275,this.floorplanimageWidth=1e3,this.floorplanimageHeight=1e3,this.floorplanreplaceScale=1,this.nav3dSize={width:0,height:0},this.birdseyeGUIimgcnv=null,this.birdseyeGUIindcnv=null,this.birdseyemarkupcnv=null,this.birdseyeGUIimgctx=null,this.birdseyeGUIindctx=null,this.birdseyemarkupctx=null,this.birdseyemarker=null,this.beventsSet=!1,this.birdseyedrawn=!1,this.floorplandrawn=!1,this.birdseyeEvents=void 0,this.floorelevation={min:null,max:null,index:0},this.camerapos=new THREE.Vector3(0,0,0),this.camerarot=new THREE.Euler(0,1,1.57,"XYZ"),this.boxcenter=new THREE.Vector3(0,0,0),this.floorplans=[],this.floorplanCallback=null,this.replacefloornavCallback=null,this.targetfloor=null,this.alignarray=null,this.floorplan3dobject=null,this.usefloorcheck=!0,this.birdseyedisprect={x:0,y:0,w:0,h:0},this.birdseyedispeye={x:0,y:0,r:0,scale:1,boxcenter:null,camerapos:null,rotation:0},this.birdseyeEventStates={started:!1,operation:1},this.birdseyeviewport=null,this.thumbnailviewport=null,this.floorplanviewport=null,this.floorplanrepviewport=null,this.LayoutName=t,this.title=this.LayoutName,null!=e.getElementsByTagName("PageName")[0]?this.PageName=e.getElementsByTagName("PageName")[0].firstChild.nodeValue:this.PageName=LayoutName,null!=e.getElementsByTagName("ThumbnailImageSRC")[0]&&null!=e.getElementsByTagName("ThumbnailImageSRC")[0].firstChild?(this.ThumbnailImageSRC=r+e.getElementsByTagName("ThumbnailImageSRC")[0].firstChild.nodeValue,this.bserverthumbnail=!0,this.bautoloadthumbnails=!0):this.bautoloadthumbnails=!1,null!=e.getElementsByTagName("VectorGLTF3DSRC")[0]&&(this.Vector3DSRC=encodeURI(r+e.getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue),this.usevector3Dxml=!0),null!=e.getElementsByTagName("Vector3DSRC")[0]&&(this.Vector3DSRC=encodeURI(r+e.getElementsByTagName("Vector3DSRC")[0].firstChild.nodeValue),this.usevector3Dxml=!0),null!=e.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailWidth=e.getElementsByTagName("ThumbnailWidth")[0].firstChild.nodeValue:this.ThumbnailWidth=as,null!=e.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailHeight=e.getElementsByTagName("ThumbnailHeight")[0].firstChild.nodeValue:this.ThumbnailHeight=is,"Adobe PDF"==s.DocRef.Format.substring(0,9)&&(this.bautoloadthumbnails=!1),this.thumbcanvas=document.createElement("canvas"),this.thumbcanvas.width=parseInt(this.ThumbnailWidth),this.thumbcanvas.height=parseInt(this.ThumbnailHeight),this.thumbctx=this.thumbcanvas.getContext("2d",{willReadFrequently:!0}),this.thumbloaded=this.bautoloadthumbnails,this.thumbnailobj={created:!1,thumbnail:document.createElement("canvas"),ctx:null,rotation:0,image:document.createElement("img"),imageData:null,canvasSource:document.createElement("img"),source:this.bautoloadthumbnails?this.ThumbnailImageSRC:null,name:this.PageName,number:i,displaynum:i+1,draw:function(e){s.thumbctx=e,s.draw_thumbnail()}},this.thumbnailobj.thumbnail.width=parseInt(this.ThumbnailWidth),this.thumbnailobj.thumbnail.height=parseInt(this.ThumbnailHeight),this.thumbnailobj.ctx=this.thumbnailobj.thumbnail.getContext("2d",{willReadFrequently:!0}),this.birdseyeobj={created:!1,birdseye:document.createElement("canvas"),imageData:null,ctx:null,rotation:0,ignorerotation:!1,dscalebirdseye:1,number:i},this.birdseyeobj.ctx=this.birdseyeobj.birdseye.getContext("2d"),this.floorplanobj={created:!1,floorplan:document.createElement("canvas"),ctx:null,rotation:0,dscalefloorplan:1,number:i},this.floorplanobj.ctx=this.floorplanobj.floorplan.getContext("2d"),this.ev_birdseye=function(e){if(e.layerX||0==e.layerY?(e._x=e.layerX,e._y=e.layerY):(e.offsetX||0==e.offsetY)&&(e._x=e.offsetX,e._y=e.offsetY),null!=s.birdseyeEvents){var t=s.birdseyeEvents[e.type];t&&t(e)}},this.disableFloorcheck=function(){s.usefloorcheck=!1},this.enableFloorcheck=function(){s.usefloorcheck=!0},this.connectCampos=function(e){e.walkthroughcontrol},this.setBirdseyeFloor=function(e){s.floorelevation.index!=e&&(s.floorelevation.index=e,s.birdseyedrawn=!1,s.set3DNavImage(2,!0)),s.disableFloorcheck()},this.setbirdseyecamera=function(e,t,a){if(s.birdseyeGUIindcnv&&s.DocRef.bActive&&0!=s.floorplans.length&&!(null==a&&null==(a=s.DocRef.getBoxcenter())||null==e&&null==(e=s.DocRef.getBoxcenter()))){null==t&&(t={degrees:90,radians:.5*Math.PI}),s.birdseyedispeye.distance=e.distanceTo(a),s.birdseyedispeye.rotation=t;var i=s.birdseyeGUIindcnv.width,r=s.birdseyeGUIindcnv.height;s.birdseyedispeye.r=32,s.birdseyedispeye.x=.5*i,s.birdseyedispeye.y=.5*r,s.birdseyedispeye.scale=s.birdseyeobj.dscalebirdseye*s.floorplans[s.floorelevation.index].Scale,s.floorplans[s.floorelevation.index].replaced&&(s.birdseyedispeye.scale*=s.floorplans[s.floorelevation.index].replaceScale,s.birdseyedispeye.x+=-s.floorplans[s.floorelevation.index].offsetX,s.birdseyedispeye.y-=-s.floorplans[s.floorelevation.index].offsetY),s.birdseyedispeye.boxcenter=a,s.birdseyedispeye.camerapos=e,s.birdseyemarker.setcamera(s.birdseyedispeye);var n=s.checkcurfloor();s.floorelevation.index!=n&&(s.floorelevation.index=n,s.birdseyedrawn=!1,s.set3DNavImage(2,!1))}},this.birdseyecamera=function(){s.birdseyeGUIindcnv&&s.DocRef.bActive&&s.birdseyeGUIindctx&&(s.birdseyeGUIindctx.clearRect(0,0,s.birdseyeGUIindcnv.width,s.birdseyeGUIindcnv.height),s.birdseyemarker.drawme(s.birdseyeGUIindctx,!0))},this.birdseyerect=function(e){if(s.birdseyeGUIindcnv&&s.DocRef.bActive){var t=s.birdseyeGUIindcnv.width/e.w,a=s.birdseyeGUIindcnv.width,i=s.birdseyeGUIindcnv.height,r=ti,n=ai;s.DocRef.pages[s.pagenumber].usepdfjs&&(r=ii,n=si),s.birdseyedisprect.w=r>0?a:a-Math.abs(r)*t,s.birdseyedisprect.w=r*t,s.birdseyedisprect.h=n>0?i:i-Math.abs(n)*t,s.birdseyedisprect.h=n*t,e.x>0?(s.birdseyedisprect.x=0,s.birdseyedisprect.w=s.birdseyedisprect.w-Math.abs(e.x)*t):s.birdseyedisprect.x=Math.abs(e.x)*t,e.y>0?(s.birdseyedisprect.y=0,s.birdseyedisprect.h=s.birdseyedisprect.h-Math.abs(e.y)*t):s.birdseyedisprect.y=Math.abs(e.y)*t,e.w<ti&&(s.birdseyedisprect.w=a),e.h<ai&&(s.birdseyedisprect.h=i),s.birdseyemarker.setSize(s.birdseyedisprect),s.birdseyeGUIindctx&&(s.birdseyeGUIindctx.clearRect(0,0,s.birdseyeGUIindcnv.width,s.birdseyeGUIindcnv.height),s.birdseyemarker.drawme(s.birdseyeGUIindctx,!1))}},this.set3dcamerapos=function(e){0!=s.DocRef.pages.lenght&&null!=s.DocRef.pages[s.pagenumber]&&s.DocRef.bActive&&s.DocRef.pages[0].usevector3DGLTF&&s.DocRef.pages[s.pagenumber].walkthroughcontrol.setCameraXYPos(e)},this.pan_update=function(e,t){if(0!=s.DocRef.pages.lenght&&null!=s.DocRef.pages[s.pagenumber]&&s.DocRef.bActive){if(s.DocRef.pages[s.pagenumber].usepdfjs){var a=s.DocRef.pages[s.pagenumber].getpagerectdirect();a.w=a.w-a.x}else a=s.DocRef.pages[s.pagenumber].getpagerect();var i=a.w/s.birdseyeGUIindcnv.width;null!=s.DocRef.foxitdoc&&(i/=rn),e*=i,t*=i,s.DocRef.pages[s.pagenumber].pan_update(-e,-t)}},this.zoom_update=function(e,t,a,i){if(0!=s.DocRef.pages.lenght&&null!=s.DocRef.pages[s.pagenumber]&&s.DocRef.bActive){if(s.DocRef.pages[s.pagenumber].usepdfjs){var r=s.DocRef.pages[s.pagenumber].getpagerectdirect();r.w=r.w-r.x}else r=s.DocRef.pages[s.pagenumber].getpagerect();var n=r.w/s.birdseyeGUIindcnv.width;e*=n,t*=n,a*=n,i*=n,e+=r.x,t+=r.y,s.DocRef.pages[s.pagenumber].zoom_update(e,t,a,i)}},this.setEventlisteners=function(){var e,t;null!=s.birdseyeGUIindcnv&&(s.birdseyeEvents=new xc(s),e=s.birdseyeGUIindcnv,t=s.ev_birdseye,e.addEventListener("touchstart",t,!1),e.addEventListener("touchmove",t,!0),e.addEventListener("touchend",t,!1),e.addEventListener("touchcancel",t,!1),e.oncontextmenu=function(){return!1},Hi?(e.addEventListener("mousemove",t,!1),e.addEventListener("mousedown",t,!1),e.addEventListener("mouseup",t,!1),e.addEventListener("mouseout",t,!1)):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerMove",t,!1),e.addEventListener("MSPointerDown",t,!1),e.addEventListener("MSPointerUp",t,!1),e.addEventListener("MSPointerOut",t,!1)):(e.addEventListener("mousemove",t,!1),e.addEventListener("mousedown",t,!1),e.addEventListener("mouseup",t,!1),e.addEventListener("mouseout",t,!1)),s.beventsSet=!0)},this.setBirdseyeTool=function(){null!=s.birdseyeGUIindcnv&&(s.beventsSet||s.setEventlisteners())},this.setGUIbirdseyeCnv=function(e,t,a){null==s.birdseyeGUIimgcnv&&(s.birdseyeGUIimgcnv=e,s.birdseyeGUIindcnv=t,s.birdseyemarkupcnv=a,s.birdseyeGUIimgctx=s.birdseyeGUIimgcnv.getContext("2d"),s.birdseyeGUIindctx=s.birdseyeGUIindcnv.getContext("2d"),s.birdseyemarkupctx=s.birdseyemarkupcnv.getContext("2d")),s.setBirdseyeTool(),null==s.birdseyemarker&&(s.birdseyemarker=new vc(s.birdseyeGUIindcnv))},this.getThumbnail=function(){return s.thumbnailobj},this.imageloadevent=function(e){s.thumbloaded=!0,s.bfinalsize=!0,s.thumbnailobj.ctx.drawImage(s.thumbnailobj.image,0,0),s.draw_thumbnail()},this.thumbload=function(){if(this.thumbnailobj.source){var e=new XMLHttpRequest;e.withCredentials=ji,e.open("GET",this.thumbnailobj.source,!0),e.responseType="blob",e.onload=function(t){var a=URL.createObjectURL(e.response);a&&(s.thumbnailobj.image.addEventListener("load",s.imageloadevent,!1),s.thumbnailobj.image.src=a)},e.send(null)}},this.setPDFdim=function(e,t){s.DocRef.getfoxitThumbnail(s.pagenumber),s.pdfpagewidth=e,s.pdfpageheight=t;var a=s.thumbnailobj.thumbnail.width/e,i=s.thumbnailobj.thumbnail.height/t;s.pdftempthumbscale=Math.min(a,i),s.setthumbnail(0,0,s.pdftempthumbscale)},this.setthumbnail=function(e,t,a){s.dxthumb=e,s.dythumb=t,s.dscalethumb=a,s.usevector3Dxml},this.drawcamerapos=function(){s.birdseyecamera()},this.camdirection=function(e){},this.setcamerapos=function(e,t,a){s.camerapos=e.clone(),s.boxcenter=a.clone(),s.setbirdseyecamera(s.camerapos,t,s.boxcenter)},this.getCurfloorElevation=function(e){if(null!=s.DocRef.pages[s.pagenumber].floorplans){var t=s.DocRef.getCurrentpage().Vector3DPageObj.getfloorheight();return s.floorplans[e].Elevation+t}return null},this.checkcurfloor=function(){var e=0;return s.DocRef.pages[s.pagenumber].Vector3DPageObj&&s.DocRef.pages[s.pagenumber].usevector3DGLTF&&(e=s.usefloorcheck?s.DocRef.pages[s.pagenumber].Vector3DPageObj.checkcurfloor():s.floorelevation.index),e},this.getfloor=function(e){null!=e&&0!=e.length&&(s.floorplans=e.slice(),s.floorelevation.index=s.checkcurfloor())},this.getfloorplanBsale=function(e,t,a,i){if(a>i)var s=e/a,r=t/i;else s=t/a,r=e/i;return Math.max(s,r),Math.max(s,r)},this.setFloorNavScaleOffset=function(e,t){s.getfloor(s.DocRef.pages[s.pagenumber].floorplans),s.floorplans[e].alignarray=t.slice();var a=t[0].dist/t[0].pwidth*s.floorplans[e].originalWidth,i=t[1].dist/t[1].pwidth*s.floorplans[e].width,r=(t[1].dist,t[1].pwidth,t[0].dist,t[0].pwidth,i/a),n=t[1].offset.x*s.floorplans[e].RScale,o=t[1].offset.y*s.floorplans[e].RScale;s.floorplans[e].BScale=s.getfloorplanBsale(s.birdseyeWidth,s.birdseyeHeight,s.floorplans[e].originalWidth,s.floorplans[e].originalHeight);var l=-(n-t[0].offset.x*r),c=-(o-t[0].offset.y*r);s.floorplans[e].offsetX=l,s.floorplans[e].offsetY=c,s.floorplans[e].replaceScale=r},this.setfloorplanreplace=function(e){s.floorplan3dobject=e},this.removefloorplanobject=function(){s.floorplan3dobject=null},this.setreplacefloornavCallback=function(e,t){s.replacefloornavCallback=e,s.targetfloor=t},this.removereplacefloornavCallback=function(){s.replacefloornavCallback=null,s.targetfloor=null},this.setfloorplanCallback=function(e,t,a){s.floorplanCallback=e,s.targetfloor=t,s.alignarray=a},this.removefloorplanCallback=function(){s.floorplanCallback=null,s.targetfloor=null,s.alignarray=null},this.set3DNavImage=function(e,t){if(null!=s.DocRef.pages[s.pagenumber].floorplans&&0!=s.DocRef.pages[s.pagenumber].floorplans.length&&(t||s.getfloor(s.DocRef.pages[s.pagenumber].floorplans),null!=s.floorplans[s.floorelevation.index])){if(2==e)var a=s.birdseyeWidth,i=s.birdseyeHeight;else 4==e&&(a=s.floorplans[s.floorelevation.index].width,i=s.floorplans[s.floorelevation.index].height);var r=s.floorplans[s.floorelevation.index].height,n=s.floorplans[s.floorelevation.index].width;if(n>r)var o=a/n,l=i/r;else o=i/n,l=a/r;var c=Math.max(o,l);s.birdseyeobj.dscalebirdseye=c,s.DocRef.pages[s.pagenumber].floorplans[s.floorelevation.index].BScale=c,2==e?s.birdseyedrawn||(s.birdseyeobj.birdseye.width=n*c,s.birdseyeobj.birdseye.height=r*c,s.birdseyeobj.ctx.drawImage(s.floorplans[s.floorelevation.index].canvas,0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyedrawn=!0):4==e&&(s.birdseyeobj.birdseye.width=n,s.birdseyeobj.birdseye.height=r,s.birdseyeobj.ctx.drawImage(s.floorplans[s.floorelevation.index].canvas,0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyedrawn=!0),s.drawGUIBirdseye(e)}},this.renderImage=function(e){if(2==e)var t=s.birdseyeWidth,a=s.birdseyeHeight;else 1==e?(t=s.ThumbnailWidth,a=s.ThumbnailHeight):3==e?(t=s.floorplanWidth,a=s.floorplanHeight):4==e&&(t=s.birdseyeWidth,a=s.birdseyeHeight);var i=s.DocRef.pages[s.pagenumber].MainImageHeight,r=s.DocRef.pages[s.pagenumber].MainImageWidth;if(s.birdseyeobj.rotation=s.DocRef.pages[s.pagenumber].getpageRotation(),r>i)var n=t/r,o=a/i;else n=a/r,o=t/i;var l=Math.max(n,o);s.birdseyeobj.dscalebirdseye=l,2==e?s.birdseyedrawn||(s.birdseyeobj.birdseye.width=r*l,s.birdseyeobj.birdseye.height=i*l,s.birdseyeobj.ctx.drawImage(s.DocRef.pages[s.pagenumber].smallimagecnv,0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyedrawn=!0):1==e?(l=a/i,s.bserverthumbnail||(l=t/r,s.thumbnailobj.thumbnail.width=r*l,s.thumbnailobj.thumbnail.height=i*l,s.thumbnailobj.ctx.drawImage(s.DocRef.pages[s.pagenumber].smallimagecnv,0,0,s.thumbnailobj.thumbnail.width,s.thumbnailobj.thumbnail.height)),s.dxthumb=0,s.dythumb=0,s.dscalethumb=l,s.bfinalsize=!0,s.thumbloaded=!0,s.draw_thumbnail()):3==e?(s.floorplanobj.floorplan.width=r*l,s.floorplanobj.floorplan.height=i*l,s.floorplanobj.ctx.drawImage(s.DocRef.pages[s.pagenumber].smallimagecnv,0,0,s.floorplanobj.floorplan.width,s.floorplanobj.floorplan.height),s.floorplandrawn=!0):4==e&&(s.birdseyedrawn||(s.birdseyeobj.birdseye.width=r*l,s.birdseyeobj.birdseye.height=i*l,s.birdseyeobj.ctx.drawImage(s.DocRef.pages[s.pagenumber].smallimagecnv,0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyedrawn=!0,s.floorplanreplaceScale=l)),s.drawGUIBirdseye(e)},this.refreshbirdseye=function(){s.birdseyedrawn=!1},this.renderVector=function(e){if(null!=s.DocRef.pages[s.pagenumber]){switch(e){case 1:var t=s.ThumbnailWidth,a=s.ThumbnailHeight;break;case 2:t=s.birdseyeWidth,a=s.birdseyeHeight;break;case 3:t=s.floorplanWidth,a=s.floorplanHeight;break;case 4:t=s.birdseyeWidth,a=s.birdseyeHeight}if(s.DocRef.pages[s.pagenumber].VectorPageObj){var i=s.DocRef.pages[s.pagenumber].VectorPageObj.height,r=s.DocRef.pages[s.pagenumber].VectorPageObj.width;if(s.birdseyeobj.rotation=s.DocRef.pages[s.pagenumber].getpageRotation(),r>i)var n=t/r,o=a/i;else n=a/r,o=t/i;var l=Math.max(n,o);if(s.birdseyeobj.dscalebirdseye=l,2==e)s.birdseyedrawn||(s.birdseyeobj.birdseye.width=r*l,s.birdseyeobj.birdseye.height=i*l,s.DocRef.pages[s.pagenumber].VectorPageObj.drawDirect(s.birdseyeobj.ctx,l,0,0,!1,!1),s.birdseyedrawn=!0);else if(1==e){if(l=a/i,!s.bserverthumbnail){if(l=t/r,s.thumbnailobj.thumbnail.width=r*l,s.thumbnailobj.thumbnail.height=i*l,0!=s.thumbnailobj.rotation){var c=s.thumbnailobj.thumbnail.width/2,h=s.thumbnailobj.thumbnail.height/2;s.thumbnailobj.ctx.save(),s.thumbnailobj.ctx.translate(c,h),s.thumbnailobj.ctx.rotate(s.thumbnailobj.rotation*(Math.PI/180)),s.thumbnailobj.ctx.translate(-c,-h)}s.DocRef.pages[s.pagenumber].VectorPageObj.drawDirect(s.thumbnailobj.ctx,l,0,0,!1,!1),0!=s.thumbnailobj.rotation&&s.thumbnailobj.ctx.restore()}s.dxthumb=0,s.dythumb=0,s.dscalethumb=l,s.bfinalsize=!0,s.thumbloaded=!0,s.draw_thumbnail()}else 3==e?(s.floorplanobj.floorplan.width=r*l,s.floorplanobj.floorplan.height=i*l,s.DocRef.pages[s.pagenumber].VectorPageObj.drawDirect(s.floorplanobj.ctx,l,0,0,!1,!1),function(e,t,a,i){var s=0;for(s=0;s<hn.markuplist.length;s++)null!=hn.markuplist[s]&&(hn.markuplist[s].selected||hn.markuplist[s].selectedit||hn.markuplist[s].display&&null!=hn.pages[hn.markuplist[s].pagenumber]&&hn.markuplist[s].drawfloorplan(e,t,a,i))}(s.floorplanobj.ctx,l,0,0),s.floorplandrawn=!0):4==e&&(s.birdseyedrawn||(s.birdseyeobj.birdseye.width=r*l,s.birdseyeobj.birdseye.height=i*l,s.DocRef.pages[s.pagenumber].VectorPageObj.drawDirect(s.birdseyeobj.ctx,l,0,0,!1,!1),s.birdseyedrawn=!0,s.floorplanreplaceScale=l));s.drawGUIBirdseye(e)}}},this.drawGUIBirdseye=function(e){2==e?null!=ft&&ft.setThumbnail(s.pagenumber,s):1==e?(null!=dt&&dt.setThumbnail(s.pagenumber,s),s.DocRef.refreshThumbnails()):3==e?s.floorplanCallback&&null!=s.targetfloor&&s.floorplanCallback(s.targetfloor,s.floorplanobj.floorplan,s.alignarray):4==e&&s.replacefloornavCallback&&null!=s.targetfloor&&s.replacefloornavCallback(s.targetfloor,s)},this.getBirdseyeDim=function(e,t){var a=s.birdseyeWidth,i=s.birdseyeHeight;if(e>t)var r=a/e,n=i/t;else r=i/e,n=a/t;var o=Math.max(r,n);return{width:e*o,height:t*o,birdscale:o}},this.foxitcreateBirdseye=function(e){if(!s.birdseyedrawn){s.birdseyeobj.rotation=s.DocRef.pages[s.pagenumber].getpageRotation(),s.birdseyeobj.birdseye.width=e.width,s.birdseyeobj.birdseye.height=e.height,s.birdseyeobj.ignorerotation=!0;var t=new Uint8ClampedArray(e.buffer);const r=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height);t&&(r.data.set(t),s.birdseyeobj.imageData=r);var a=s.birdseyeobj.birdseye.width/s.pdfpagewidth,i=s.birdseyeobj.birdseye.height/s.pdfpageheight;s.birdseyeobj.dscalebirdseye=Math.min(a,i),s.birdseyeobj.ctx.clearRect(0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyeobj.ctx.putImageData(s.birdseyeobj.imageData,0,0,0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height),s.birdseyedrawn=!0}this.drawGUIBirdseye(2)},this.foxitcreatethumb=function(e){var t=document.createElement("canvas");t.width=parseInt(e.width),t.height=parseInt(e.height),t.getContext("2d"),s.thumbnailobj.thumbnail.width=e.width,s.thumbnailobj.thumbnail.height=e.height,s.thumbcanvas.width=e.width,s.thumbcanvas.height=e.height;var a=new Uint8ClampedArray(e.buffer);const i=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height);a&&(i.data.set(a),s.thumbnailobj.imageData=i),s.usefoxitthumb=!0,s.thumbloaded=!0,s.thumbnailobj.created=!0;var r=s.thumbnailobj.thumbnail.width/s.pdfpagewidth,n=s.thumbnailobj.thumbnail.height/s.pdfpageheight;s.pdftempthumbscale=Math.min(r,n),s.setthumbnail(0,0,s.pdftempthumbscale),s.bfinalsize=!0,s.draw_thumbnail(),null!=dt&&dt.setThumbnail(s.pagenumber,s)},this.clearBirdseyeMarkupctx=function(){null!=s.birdseyemarkupctx&&s.birdseyemarkupctx.clearRect(0,0,s.birdseyeobj.birdseye.width,s.birdseyeobj.birdseye.height)},this.draw_thumbnail=function(){if(s.thumbloaded)if(s.usefoxitthumb&&null!=s.thumbnailobj.imageData)s.thumbctx.clearRect(0,0,s.thumbnailobj.thumbnail.width,s.thumbnailobj.thumbnail.height),s.thumbctx.putImageData(s.thumbnailobj.imageData,0,0,0,0,s.thumbnailobj.thumbnail.width,s.thumbnailobj.thumbnail.height);else{if(!s.thumbnailobj.image.complete)return;if(s.thumbnailobj.thumbnail.width>0&&s.thumbnailobj.thumbnail.height>0){var e=0,t=0;if(0!=s.thumbnailobj.rotation){var a=s.thumbnailobj.thumbnail.width/2,i=s.thumbnailobj.thumbnail.height/2;90==s.thumbnailobj.rotation?(e=a-i,t=a-i):270==s.thumbnailobj.rotation&&(e=i-a,t=i-a),s.thumbctx.save(),s.thumbctx.translate(a,i),s.thumbctx.rotate(s.thumbnailobj.rotation*(Math.PI/180)),s.thumbctx.translate(-a,-i)}s.thumbctx.clearRect(0,0,s.thumbnailobj.thumbnail.width,s.thumbnailobj.thumbnail.height),s.thumbctx.drawImage(s.thumbnailobj.thumbnail,e,t),0!=s.thumbnailobj.rotation&&s.thumbctx.restore()}}},this.bautoloadthumbnails&&s.thumbload()}}function wc(e,t,a){setTimeout((function(){for(var i=0;i<t.length;i++)for(var s=0;s<t[i].length;s++)if(1!=a&&!t[i][s].sharpend){var r=t[i][s].cnv.height,n=t[i][s].cnv.width;Bn(t[i][s].ctx,n,r,.5),t[i][s].sharpend=!0}e()}),0)}function kc(e,t,a){a.annotArray=[],setTimeout((function(){if(t.annots&&t.annots.length>0)for(var i=0;i<t.annots.length;i++)a.annotArray.push({cnv:document.createElement("canvas"),pos:t.annots[i].pos}),a.annotArray[i].cnv.width=t.annots[i].tiles[0].width,a.annotArray[i].cnv.height=t.annots[i].tiles[0].height,a.annotArray[i].cnv.getContext("2d").drawImage(t.annots[i].tiles[0],0,0);e()}),0)}function Dc(e,t,a){var i=0,s=0,r=0;setTimeout((function(){if(t.canvases&&t.canvases.length>0)for(var n=0,o=0;o<a.length;o++){"canvas"==t.canvases[n].tagName.toLowerCase()&&(o<a.length-1?(s+=t.tileSize,r=t.tileSize):(s+=t.canvases[n].height,r=t.canvases[n].height),i=0);for(var l=0;l<a[o].length;l++)t.canvases[n]&&"canvas"==t.canvases[n].tagName.toLowerCase()&&(l<a[o].length-1?(i+=t.tileSize,t.tileSize):(i+=t.canvases[n].width,t.canvases[n].width),r<t.canvases[n].height&&(s+=t.canvases[n].height-r),1==t.transScale?(a[o][l].cnv.height=t.canvases[n].height,a[o][l].cnv.width=t.canvases[n].width,a[o][l].tilenumber=n,a[o][l].xoffset=t.tileSize,a[o][l].yoffset=t.tileSize):(a[o][l].cnv.height=Math.round(t.canvases[n].height*t.transScale),a[o][l].cnv.width=Math.round(t.canvases[n].width*t.transScale),a[o][l].tilenumber=n,a[o][l].xoffset=t.tileSize*t.transScale,a[o][l].yoffset=t.tileSize*t.transScale),n++)}i*=t.transScale,s*=t.transScale,e({width:i,height:s},t)}),0)}function Cc(e,t,a,i){i&&i.length>0||setTimeout((function(){for(var i=a.rows,s=a.columns,r=0;r<i;r++){t.push([]);for(var n=0;n<s;n++)t[r].push({cnv:document.createElement("canvas"),ctx:null,tilenumber:0,visible:!1,xoffset:0,yoffset:0,sharpend:!1}),t[r][n].ctx=t[r][n].cnv.getContext("2d")}e(t,a)}),10)}function Rc(e,t,a,i){!function(){var s=!1,r=!1;a.canvases&&(s=!0,a.canvases.length>0&&(r=!0));var n,o,l,c,h={tilerow:0,tilecolumn:0,bcanvasvalid:s,bmulticanvas:r,bdraw:!0,scaleupdate:a.scaleupdate,page:i,drawntiles:t,nondrawtilecount:0,transScale:a.transScale,canvtileArray:i.canvtileArray};a.scrollupdate&&(h.canvtileArray=i.bgCanvtileArray),a.scaleupdate&&(h.canvtileArray=i.canvtileArray),n=h,o=1,l=function(){(h=function(e){if(!e.bcanvasvalid||!e.bmulticanvas)return e;for(var i=0;i<t.length;i++)e.tilerow==t[i].r&&e.tilecolumn==t[i].c&&(bdraw=!1);if(e.bdraw)if(1==a.transScale)e.canvtileArray[e.tilerow][e.tilecolumn].ctx.drawImage(a.canvases[e.canvtileArray[e.tilerow][e.tilecolumn].tilenumber],0,0);else{var s=Un(a.canvases[e.canvtileArray[e.tilerow][e.tilecolumn].tilenumber],e.transScale);e.canvtileArray[e.tilerow][e.tilecolumn].ctx.drawImage(s,0,0),s=null}return e}(h)).bdraw=!0,h.tilerow<h.canvtileArray.length&&(h.tilecolumn<h.canvtileArray[h.tilerow].length?h.tilecolumn++:(h.tilecolumn=0,h.tilerow++))},c=function(){e(a)},function e(){for(var t=0;t<o;++t)l.call(null,n);n.tilerow<n.canvtileArray.length&&n.tilecolumn<n.canvtileArray[n.tilerow].length&&n.bcanvasvalid&&n.bmulticanvas?setTimeout(e,0):c.call(null)}(),function e(){setTimeout(e,10)}()}()}class Pc{constructor(i,r,o,l,c,h){var p=this,u=$;if(he&&(u=fe),this.DocRef=h,this.pagenumber=c,this.firstpage=o,this.camera=null,this.navcamera=null,this.birdseyemarker=null,this.bis3Dnavigator=!1,this.navfloorplan=null,this.camerapos=new THREE.Vector3(0,0,0),this.camerarot=new THREE.Euler(0,1,1.57,"XYZ"),this.boxcenter=new THREE.Vector3(0,0,0),this.birdseyedispeye={x:0,y:0,r:0,scale:1,boxcenter:null,camerapos:null,rotation:0},this.currentimage=1,this.dx=0,this.dy=0,this.dscale=1,this.initialscale=1,this.scaleObject=new Tc,this.invalid=!1,this.dxvector=0,this.dyvector=0,this.dxpdf=0,this.dypdf=0,this.dxpdfnonrot=0,this.dypdfnonrot=0,this.dxpdfrot=0,this.dypdfrot=0,this.dxpdfzerorot=0,this.dypdfzerorot=0,this.pdfstartx=0,this.pdfstarty=0,this.pdfendx=0,this.pdfendy=0,this.foxitdx=0,this.foxitdy=0,this.dscalepdf=1,this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.curpagescale=1,this.curfoxitpagescale=1,this.foxitpagerot=0,this.foxitpageorigrot=0,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.originalPDFwidth=0,this.originalPDFheight=0,this.bpagesizeupdated=!1,this.curzoomfunction=0,this.role=0,this.bgpagewidth=0,this.bgpageheight=0,this.ovpageheight=0,this.ovpagewidth=0,this.overlayScale=1,this.overlayOffsetX=0,this.overlayOffsetY=0,this.backgroundScale=1,this.backgroundOffsetX=0,this.backgroundOffsetY=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.iscollapsed=!0,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=_i,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.PDFSnapArray=[],this.PDFSnapPoint=void 0,this.pdfsnapready=!0,this.textselectobj={rectarray:void 0,start:-1,end:-1,bstart:!1,bend:!1,startpos:null,endpos:null,$handler:null,complete:!1},this.StoreyMetadata=[],this.visibleTiles=[],this.tilevisibiltychanged=!1,this.PDFsnapTransform=null,this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.dscalevector=1,this.fixedScale=1,this.vectorisrendered=!1,this.vectorischanged=!1,this.vectorstartrender=-1,this.vectorendrender=-1,this.vectorpagetime=-1,this.vectortimervar=null,this.bDorescaleonsizeChange=Vi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.usedincomposite=!1,this.compositereference=void 0,this.compositePrintreference=void 0,this.isbackground=!1,this.isoverlay=!1,this.dxextent=0,this.dyextent=0,this.startx=0,this.starty=0,this.endx=0,this.endy=0,this.dscaleextent=1,this.bitmapratio=1,this.pagedimset=!1,this.dxprint=0,this.dyprint=0,this.dscaleprint=1,this.dxthumb=0,this.dythumb=0,this.dxthumbtemp=0,this.dythumbtemp=0,this.dscalethumb=1,this.pdftempthumbscale=1,this.drotation=0,this.pagelockrotation=0,this.textsearchindx=0,this.usevectorxml=!1,this.usevectorbinary=!1,this.usevectorbinarycompare=!1,this.loadbackgroundvectors=!1,this.loadoverlayvectors=!1,this.usepdfjs=!1,this.drawtextSearchRect=!1,this.usevector3Dxml=!1,this.usevector3Dbinary=!1,this.usevector3DGLTF=!1,this.has3Dnav=!1,this.pageloaded=!1,this.markuplistloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.VectorPageObj=void 0,this.Vector3DPageObj=void 0,this.VectorPartfilelist=[],this.VectorBPartfilelist=[],this.smallimageloaded=!1,this.largeimageloaded=!1,this.vectorloaded=!1,this.rendercallback=!1,this.thumbnnailloaded=!1,this.CurrentMarkup=0,this.LayoutName=r,"ComparePage"==i)p.compositereference=h,p.usedincomposite=!0,p.PageName=r,"overlay"==p.PageName?(p.role=2,p.DocRef=p.compositereference.pages[1].DocRef):"background"==p.PageName&&(p.role=1,p.DocRef=p.compositereference.pages[0].DocRef),p.usedincomposite=!0,p.PageName=r;else if(null!=i.getElementsByTagName("PageName")[0]?this.PageName=i.getElementsByTagName("PageName")[0].firstChild.nodeValue:this.PageName=r,null!=i.getElementsByTagName("Compression")[0]&&(this.Compression=i.getElementsByTagName("Compression")[0].firstChild.nodeValue),null!=i.getElementsByTagName("DPI")[0]&&(this.DPI=i.getElementsByTagName("DPI")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetX")[0]&&(this.OffsetX=i.getElementsByTagName("OffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetY")[0]&&(this.OffsetY=i.getElementsByTagName("OffsetY")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OriginalScale")[0]&&(this.OriginalScale=i.getElementsByTagName("OriginalScale")[0].firstChild.nodeValue),null!=i.getElementsByTagName("VectorBinary2DSRC")[0]&&(this.Vector2DBinarySRC=encodeURI(u+i.getElementsByTagName("VectorBinary2DSRC")[0].firstChild.nodeValue),this.usevectorbinary=!0),null!=i.getElementsByTagName("OverlayComparemode")[0]&&(p.OverlayComparemode=parseInt(i.getElementsByTagName("OverlayComparemode")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("BckGrndDocindex")[0]&&(p.comparebgdocindex=parseInt(i.getElementsByTagName("BckGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("BckGrndPageindex")[0]&&(p.comparebgpageindex=parseInt(i.getElementsByTagName("BckGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("FrGrndDocindex")[0]&&(p.comparefgdocindex=parseInt(i.getElementsByTagName("FrGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("FrGrndPageindex")[0]&&(p.comparefgpageindex=parseInt(i.getElementsByTagName("FrGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0]&&(this.Vector2DBinarySRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!0),null!=i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0]&&(this.Vector2DBinarySRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadoverlayvectors=!0),null!=i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0]&&(this.Vector2DImageSRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!1,p.loadbackgroundimage=!0,null!=i.getElementsByTagName("MainImageWidthBckGrnd")[0]&&(p.MainImageWidthBckGrnd=parseInt(i.getElementsByTagName("MainImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightBckGrnd")[0]&&(p.MainImageHeightBckGrnd=parseInt(i.getElementsByTagName("MainImageHeightBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingBckGrnd")[0]&&(p.MainImageScalingBckGrnd=parseInt(i.getElementsByTagName("MainImageScalingBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXBckGrnd")[0]&&(p.MainImageOffsetXBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYBckGrnd")[0]&&(p.MainImageOffsetYBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthBckGrnd")[0]&&(p.SmallImageWidthBckGrnd=parseInt(i.getElementsByTagName("SmallImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightBckGrnd")[0]&&(p.SmallImageHeightBckGrnd=parseInt(i.getElementsByTagName("SmallImageHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0]&&(this.Vector2DImageSRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadoverlayvectors=!1,p.loadoverlayimage=!0,null!=i.getElementsByTagName("MainImageWidthFrGrnd")[0]&&(p.MainImageWidthFrGrnd=parseInt(i.getElementsByTagName("MainImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightFrGrnd")[0]&&(p.MainImageHeightFrGrnd=parseInt(i.getElementsByTagName("MainImageHeightFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingFrGrnd")[0]&&(p.MainImageScalingFrGrnd=parseFloat(i.getElementsByTagName("MainImageScalingFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXFrGrnd")[0]&&(p.MainImageOffsetXFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYFrGrnd")[0]&&(p.MainImageOffsetYFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthFrGrnd")[0]&&(p.SmallImageWidthFrGrnd=parseInt(i.getElementsByTagName("SmallImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightFrGrnd")[0]&&(p.SmallImageHeightFrGrnd=parseInt(i.getElementsByTagName("SmallImageHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFBckGrnd")[0]&&(p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!1,p.loadbackgroundpdf=!0,null!=i.getElementsByTagName("PDFWidthBckGrnd")[0]&&(p.PDFWidthBckGrnd=parseInt(i.getElementsByTagName("PDFWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightBckGrnd")[0]&&(p.PDFHeightBckGrnd=parseInt(i.getElementsByTagName("PDFHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFFrGrnd")[0]&&(p.usevectorbinarycompare=!0,p.loadoverlayvectors=!1,p.loadoverlaypdf=!0,null!=i.getElementsByTagName("PDFWidthFrGrnd")[0]&&(p.PDFWidthFrGrnd=parseInt(i.getElementsByTagName("PDFWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightFrGrnd")[0]&&(p.PDFHeightFrGrnd=parseInt(i.getElementsByTagName("PDFHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DSRC")[0]&&(this.Vector2DSRC=encodeURI(u+i.getElementsByTagName("Vector2DSRC")[0].firstChild.nodeValue),this.usevectorbinary||(this.usevectorxml=!0)),this.DocRef.PublisherVersion){var g=this.DocRef.PublisherVersion.split(".");parseInt(g[3].trim())}function f(e){p.pdfstartx=e.x,p.pdfstarty=e.y,p.pdfendx=e.width+p.pdfstartx,p.pdfendy=e.height+p.pdfstarty,p.starty=e.y,p.startx=e.x,p.endx=e.width+e.x,p.endy=e.height+e.y}function m(e,t){var a=e.x,i=e.y,s=a+e.width,r=i+e.height,n=t*(Math.PI/180),o=Math.cos(n),l=Math.sin(n),c=ti/2,h=ai/2,d=a-c,p=i-h,u=d*o-p*l,g=d*l+p*o;u=c+u,g=h+g;var f=(d=s-c)*o-(p=r-h)*l,m=d*l+p*o;return f=c+f,m=h+m,{x:Math.min(u,f),y:Math.min(g,m),w:Math.max(f,u),h:Math.max(m,g)}}function y(e){p.dypdf=e.y,p.dxpdf=e.x,p.starty=e.y,p.startx=e.x,p.endx=e.w,p.endy=e.h}function v(e){p.dxpdfzerorot=e.x,p.dypdfzerorot=e.y}function x(e,t,a,i){const s=Hl();return{x:e/s,y:t/s,w:a/s,h:i/s}}function b(){p.DocRef.draw_mpagepdf(!1),Vl(n),Nl(a),p.DocRef.foxitsearchobj.active&&p.DocRef.drawsearchRect()}function w(){p.DocRef.thumbnails[p.pagenumber]&&(p.usepdfjs?p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerectdirect()):p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerect())),null!=p.DocRef.foxitdoc?(n.clearRect(0,0,ti,ai),p.DocRef.foxitsearchobj.active&&p.DocRef.drawsearchRect()):(Vl(n),Nl(a))}function k(e,t){if(p.usevectorxml)p.dxvector=e.dx,p.dyvector=e.dy,p.dscalevector=e.dscale,p.startx=e.startx,p.starty=e.starty,p.endx=e.endx,p.endy=e.endy,p.draw_vector(!1),t?p.vectorscrollbuffer(p.dscalevector,p.dxvector,p.dyvector):p.vectorischanged=!0,p.DocRef.textselect&&(p.cleartextdivs(),p.settextdivs());else if(p.usepdfjs){if(p.checkFoxitMaxZoom(e.dscale)&&(p.dxpdf=e.dx,p.dypdf=e.dy,p.dscalepdf=e.dscale,p.startx=e.startx,p.starty=e.starty),p.pdfrenderopque+=1,p.pdfisrendered=!1,t)if(null!=e.mousepoint)p.foxitdirectZoomTo(p.dscalepdf,e.dfactor,e.mousepoint,e.offsetpoint,e.offsetcenter,e.bIn);else{var a=e.offsetcenter,i=.5*ti,s=.5*ai,r=C(p.getpageRotation(),p.foxitpageorigrot),n=p.getPDFDistScale(i,p.dscalepdf),o=p.getPDFDistScale(s,p.dscalepdf);switch(r){case 0:a.x=a.x-n,a.y=a.y+o;break;case 90:a.x=a.x-o,a.y=a.y-n;break;case 180:a.x=a.x+n,a.y=a.y-o;break;case 270:a.x=a.x+o,a.y=a.y+n}p.foxitdirectZoomToEx(p.dscalepdf,a)}p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else p.dx=e.dx,p.dy=e.dy,p.dscale=e.dscale,p.startx=e.startx,p.starty=e.starty,p.endx=e.endx,p.endy=e.endy,p.checkimageswitch(),0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0)}function D(){if(p.usevectorxml){if(null==p.VectorPageObj)return;var e={dscale:p.dscalevector,dx:p.dxvector,dy:p.dyvector,width:p.VectorPageObj.width,height:p.VectorPageObj.height}}else e=p.usepdfjs?{dscale:p.dscalepdf,dx:p.dxpdf,dy:p.dypdf,width:p.pdfpagewidth,height:p.pdfpageheight,mousepoint:{x:0,y:0},offsetpoint:{x:0,y:0},offsetcenter:{x:0,y:0},bIn:!1,dfactor:1}:{dscale:p.dscale,dx:p.dx,dy:p.dy,width:p.MainImageWidth,height:p.MainImageHeight};return e}function w(){Vl(n),Nl(a);var e=p.DocRef.getThumb(p.pagenumber);null!=e&&(p.usepdfjs?e.birdseyerect(p.getpagerectdirect()):e.birdseyerect(p.getpagerect()))}function C(e,t){return t+e>=360?e+t-360:e+t}"3"!=p.DocRef.Type&&"7"!=p.DocRef.Type||(this.TextSelectArea=document.createElement("div"),this.TextSelectArea.className="textLayer",this.TextSelectArea.addEventListener("wheel",tu,!0),this.TextSelectArea.style.display="none"),"Adobe PDF"==p.DocRef.Format.substring(0,9)?(this.bautoloadthumbnails=!1,this.tilespending=!1,this.prioritytilespending=!1,this.pagecanvas=document.createElement("canvas"),this.pagectx=this.pagecanvas.getContext("2d"),this.canvtileArray=[],this.bgCanvtileArray=[],this.tempfoxitpage={canvases:[],imagedim:{width:0,height:0},havecanvases:!1},this.busetempcanvases=!1,this.annotArray=[],this.usepdfjs=!0,this.magnifycanvas=document.createElement("canvas"),this.magnifypagectx=this.magnifycanvas.getContext("2d"),this.pageRendering=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=1,this.PDFTextArea=document.createElement("div"),this.PDFTextArea.style.zIndex="4",this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",tu,!0),this.pdfpagetime=10,this.viewport=null,this.magviewport=null,this.compareviewport=null):"ComparePage"==i||(null!=i.getElementsByTagName("MainImageSRC")[0]&&(this.MainImageSRC=encodeURI(u+i.getElementsByTagName("MainImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageSRC")[0]&&(this.SmallImageSRC=encodeURI(u+i.getElementsByTagName("SmallImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidth")[0]&&(this.SmallImageWidth=i.getElementsByTagName("SmallImageWidth")[0].firstChild.nodeValue,this.SmallImageWidth=parseInt(this.SmallImageWidth)),null!=i.getElementsByTagName("SmallImageHeight")[0]&&(this.SmallImageHeight=i.getElementsByTagName("SmallImageHeight")[0].firstChild.nodeValue,this.SmallImageHeight=parseInt(this.SmallImageHeight)),null!=i.getElementsByTagName("SmallImageScaling")[0]&&(this.SmallImageScaling=i.getElementsByTagName("SmallImageScaling")[0].firstChild.nodeValue,this.SmallImageScaling=parseFloat(this.SmallImageScaling))),"ComparePage"==i||(null!=i.getElementsByTagName("ThumbnailImageSRC")[0]&&null!=i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild&&(this.ThumbnailImageSRC=u+i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageWidth")[0]&&(this.MainImageWidth=i.getElementsByTagName("MainImageWidth")[0].firstChild.nodeValue,this.MainImageWidth=parseInt(this.MainImageWidth)),null!=i.getElementsByTagName("MainImageHeight")[0]&&(this.MainImageHeight=i.getElementsByTagName("MainImageHeight")[0].firstChild.nodeValue,this.MainImageHeight=parseInt(this.MainImageHeight)),null!=i.getElementsByTagName("MainImageScaling")[0]&&(this.MainImageScaling=i.getElementsByTagName("MainImageScaling")[0].firstChild.nodeValue,this.MainImageScaling=parseFloat(this.MainImageScaling)),null!=i.getElementsByTagName("MainImageOffsetX")[0]&&(this.MainImageOffsetX=i.getElementsByTagName("MainImageOffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageOffsetY")[0]&&(this.MainImageOffsetY=i.getElementsByTagName("MainImageOffsetY")[0].firstChild.nodeValue)),"ComparePage"==i?(this.ThumbnailWidth=as,this.ThumbnailHeight=is):(null!=i.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailWidth=i.getElementsByTagName("ThumbnailWidth")[0].firstChild.nodeValue:this.ThumbnailWidth=as,null!=i.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailHeight=i.getElementsByTagName("ThumbnailHeight")[0].firstChild.nodeValue:this.ThumbnailHeight=is),this.printcanvas=document.createElement("canvas"),this.printctx=this.printcanvas.getContext("2d"),this.pdfprintcanvas=document.createElement("canvas"),this.pdfprintctx=this.pdfprintcanvas.getContext("2d"),this.printobj={pagenumber:p.pagenumber,paperimage:p.printcanvas,paperwidth:297,paperheight:210,docwidth:1,docheight:1,inchtomm:25.4,DPI:300,scrDPI:96,scaleSet:!1,pdx:0,pdy:0,pscale:1,printctx:p.printctx,setRes:function(e){this.DPI=e},setPaperSize:function(e,t){this.paperwidth=e,this.paperheight=t,this.paperimage.width=e/this.inchtomm*this.DPI,this.paperimage.height=t/this.inchtomm*this.DPI},setDocSize:function(e,t){this.docwidth=e,this.docheight=t},setScale:function(){var e=this.paperimage.width/this.docwidth,t=this.paperimage.height/this.docheight;this.pscale=Math.min(e,t),this.pdx=(this.paperimage.width-this.docwidth*this.pscale)/2,this.pdy=(this.paperimage.height-this.docheight*this.pscale)/2,this.scaleSet=!0},print:function(){this.scaleSet&&p.usepdfjs&&p.printPDFpage()}},this.scaleChanged=function(){null!=pt&&pt.scalechanged(p.DocRef.fileindex,p.pagenumber,p.scaleObject)},this.setpagedimsize=function(e,t,a,i,s){s?(p.startx=e,p.starty=t,p.endx=a,p.endy=i):(p.startx=e,p.starty=t,p.endx=a+e,p.endy=i+t),p.DocRef.thumbnails[p.pagenumber]&&p.DocRef.thumbnails[p.pagenumber].birdseyerect({x:p.startx,y:p.starty,w:a,h:i})},this.getwidth=function(){return p.offscreenwidth},this.getheight=function(){return p.offscreenheight},this.draw_tile_background=function(e,t,a,i){p.draw_tiled_cavas(e,t,a,1)},this.draw_tile_overlay=function(e,t,a,i){p.draw_tiled_cavas(e,t,a,1)},this.transparentpdfcompare=function(e){for(var t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++){try{var s=p.canvtileArray[a][i].ctx.getImageData(0,0,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height)}catch(e){alert("Error 1 - "+e),console.log(e,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height),t=-1}e?p.setinvert(s.data):p.transparent(s.data),0==t&&p.canvtileArray[a][i].ctx.putImageData(s,0,0)}},this.invertpdfcompare=function(e){for(var t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++){try{var s=p.canvtileArray[a][i].ctx.getImageData(0,0,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height)}catch(e){alert("Error 1 - "+e),console.log(e,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height),t=-1}var r=p.compositereference.getColors();if(e)p.setinvert(s.data);else switch(p.role){case 1:p.setcolor(s.data,r.bg);break;case 2:p.setcolor(s.data,r.fg)}0==t&&p.canvtileArray[a][i].ctx.putImageData(s,0,0)}},this.copyCanvasTiles=function(e){for(var t=0;t<e.length;t++){p.canvtileArray.push([]);for(var a=0;a<e[t].length;a++){var i=document.createElement("canvas"),s=i.getContext("2d"),r={cnv:i,ctx:s,tilenumber:0};r.cnv.height=e[t][a].cnv.height,r.cnv.width=e[t][a].cnv.width,r.tilenumber=e[t][a].tilenumber,r.ctx.drawImage(e[t][a].cnv,0,0),p.canvtileArray[t].push(r)}}},this.gettilesize=function(){for(var e=0,t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++)e+=p.canvtileArray[a][i].cnv.width,t+=p.canvtileArray[a][i].cnv.height;p.setpagesize(e,t)},this.movepage=function(e){p.pagenumber=e,this.dxpdf=0,this.dypdf=0,this.foxitdx=0,this.foxitdy=0,this.dscalepdf=1,this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.curpagescale=1,this.curfoxitpagescale=1,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.iscollapsed=!0,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=_i,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.PDFsnapTransform=null,this.textselectobj={rectarray:void 0,start:-1,end:-1,bstart:!1,bend:!1,startpos:null,endpos:null,$handler:null,complete:!1},this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.bDorescaleonsizeChange=Vi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.startx=0,this.starty=0,this.endx=0,this.endy=0,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.drotation=this.DocRef.pagerotations[p.pagenumber]),this.pagelockrotation=0,this.textsearchindx=0,this.drawtextSearchRect=!1,this.pageloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.usepdfjs&&(this.visibleTiles=[],this.bautoloadthumbnails=!1,this.tilespending=!1,this.prioritytilespending=!1,this.canvtileArray=[],this.bgCanvtileArray=[],this.annotArray=[],this.tempfoxitpage={canvases:[],imagedim:{width:0,height:0},havecanvases:!1},this.busetempcanvases=!1,this.pageRendering=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=1,this.PDFTextArea=document.createElement("div"),this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",tu,!0),this.pdfpagetime=10,this.viewport=null,this.magviewport=null,this.compareviewport=null,null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getpageinfodim(p.pagenumber,p.setfoxitPageSizeNonRender))},this.setNotCollapsedArray=function(){if(p.DocRef.isNotCollapsed&&p.DocRef.isNotCollapsed.length)if(p.iscollapsed){var e=p.DocRef.isNotCollapsed.indexOf(p.pagenumber);-1!==e&&p.DocRef.isNotCollapsed.splice(e,1)}else-1===p.DocRef.isNotCollapsed.indexOf(p.pagenumber)&&p.DocRef.isNotCollapsed.push(p.pagenumber);else p.iscollapsed||(p.DocRef.isNotCollapsed=[p.pagenumber])},this.setCanvasTiles=function(e,t){for(var a=t.rows,i=t.columns,s=0;s<a;s++){e.push([]);for(var r=0;r<i;r++)e[s].push({cnv:document.createElement("canvas"),ctx:null,tilenumber:0,visible:!1,xoffset:0,yoffset:0}),e[s][r].ctx=e[s][r].cnv.getContext("2d")}return e},this.sharpencomplete=function(){},this.annotComplete=function(){p.DocRef.getpageloadSearch(p.pagenumber)},this.canvasArraySizeSet=function(e,t){e.width=t.pagepos.width,e.height=t.pagepos.height,p.prioritytilespending=!0,p.tilespending=!0},this.tilesCreated=function(e,t){p.canvtileArray=e,Dc(p.canvasArraySizeSet,t,p.canvtileArray)},this.drawpriorityTileComplete=function(e,t,a){if(t.scrollupdate)for(var i=0;i<e.length;i++)p.canvtileArray[e[i].r][e[i].c]=p.bgCanvtileArray[e[i].r][e[i].c];p.setfoxitpagedim(t.width,t.height,a,t.pagescale),wc(p.sharpencomplete,p.canvtileArray,t.transScale),p.compositereference&&0!=p.role?(0==p.compositereference.compareMode?p.invertpdfcompare(!1):1==p.compositereference.compareMode&&p.transparentpdfcompare(!1),p.compositereference.canvasdrawn(p.role),p.compositereference.canvasdrawready&&p.compositereference.draw_compare(!0)):p.DocRef.draw_mpagepdf(!1),e.ndtilesnum>0&&Rc(p.drawTilesComplete,e,t,p),kc(p.annotComplete,t,p)},this.drawTilesComplete=function(e){if(e.scrollupdate)for(var t=0;t<p.bgCanvtileArray.length;t++)p.canvtileArray[t]=p.bgCanvtileArray[t].slice();wc(p.sharpencomplete,p.canvtileArray,e.transScale),p.DocRef.draw_mpagepdf(!1)},this.foxitpagescalecheck=function(e){var t=p.curpagescale*rn;e.toFixed(4)!=t.toFixed(4)&&(p.curpagescale=e/rn,b())},this.foxitonScrollupdate=function(e){e&&(p.setpagedimfoxit(e),null!=e.x&&null!=e.y?p.setpagedimsize(e.x,e.y,e.width,e.height,!1):null!=e.left&&null!=e.top&&p.setpagedimsize(e.left,e.top,e.width,e.height,!1),p.setpagerotationdimfoxit(e))},this.getFoxitpageRect=function(){return{x:p.pdfstartx,y:p.pdfstarty,w:p.pdfendx,h:p.pdfendy}},this.setpagerotationdimfoxitrot=function(e){switch(C(p.getpageRotation(),p.foxitpageorigrot)){case 0:p.dxpdfzerorot=p.foxitdx,p.dypdfzerorot=p.foxitdy;break;case 90:var t=m(e,270);v(t);break;case 180:v(t=m(e,180));break;case 270:v(t=m(e,90))}},this.setpagerotationdimfoxit=function(e){switch(p.getpageRotation()){case 0:p.dypdf=p.foxitdy,p.dxpdf=p.foxitdx;break;case 90:var t=m(e,270);y(t);break;case 180:y(t=m(e,180));break;case 270:y(t=m(e,90))}p.setpagerotationdimfoxitrot(e)},this.setpagedimfoxit=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),f(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e))},this.setpagedimdirect=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&f(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),b())},this.foxitcalibratepagemarkupEx=function(e,t){if(e){if(t&&0!=p.offscreenwidth&&0!=p.pdfpagewidth){var a=p.getPDFpageScale()*rn;t==a*p.dscalepdf||(p.dscalepdf=t/a)}null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&f(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),b()}},this.foxitcalibratepagemarkup=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&f(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),b())},this.foxitcalibratepagePosY=function(){0==p.pagenumber&&(p.dypdf=0,p.starty=0,p.endy=p.offscreenheight*p.dscalepdf+p.starty),p.pagenumber==p.DocRef.pages.length-1&&(p.endy=ai,p.dypdf=p.endy-p.offscreenheight*p.dscalepdf,p.starty=p.dypdf)},this.foxitcalibratepagePosX=function(e){e?p.offscreenwidth*p.dscalepdf<ti?(p.dxpdf=(ti-p.offscreenwidth*p.dscalepdf)/2,p.startx=p.dxpdf,p.endx=p.offscreenwidth*p.dscalepdf+p.startx):(p.endx=ti,p.dxpdf=p.endx-p.offscreenwidth*p.dscalepdf,p.startx=p.dxpdf):p.offscreenwidth*p.dscalepdf<ti?(p.dxpdf=(ti-p.offscreenwidth*p.dscalepdf)/2,p.startx=p.dxpdf,p.endx=p.offscreenwidth*p.dscalepdf+p.startx):(p.dxpdf=0,p.startx=0,p.endx=p.offscreenwidth*p.dscalepdf+p.startx)},this.setfoxitPageSizeEx=function(e){p.curfoxitpagescale=e.pagescale,p.curfoxitpagescale=e.pagescale/rn,e.pagescale=e.pagescale/rn,p.setfoxitpagedimnew(e)},this.setfoxitPageSizeNonRender=function(e){p.foxitpagerot=e.rotation,p.foxitpageorigrot=e.originalrotation,p.pdfpagewidth=e.width,p.pdfpageheight=e.height;var t=ti-42;switch(p.getpageRotation()){case 0:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight;break;case 90:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth;break;case 180:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight;break;case 270:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth}var a=Te/p.pdfpageheight,i=Me/p.pdfpagewidth;p.fixedScale=Math.min(i,a),p.curpagescale=e.pagescale,p.width=e.pagepos.width,p.height=e.pagepos.height;var s=t/e.pdfwidth;p.pdfdscaletemp=s*rn;var r=e.pagepos.width*(p.pdfdscaletemp/rn);e.pagepos.height,p.pdfdscaletemp,p.pdfdxtemp=(ti-r)/2,p.pdfdxtemp=p.pdfdxtemp/2,p.pdfdytemp=8,dl(p),null!=p.DocRef.markupsave&&p.DocRef.markupsave.setpage(p)},this.setfoxitPageSize=function(e){if(p.canvtileArray=[],p.curfoxitpagescale=e.pagescale,p.setfoxitpagedimnew(e),null!=e.pagepos){var t={width:e.pagepos.width,height:e.pagepos.height};p.canvasArraySizeSet(t,e),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.rendercallback&&null!=lt&&lt.RenderComplete(p.pagenumber)}},this.createCanvasTiles=function(e){e.scaleupdate?(p.canvtileArray=[],p.bgCanvtileArray=[]):e.scrollupdate&&(p.bgCanvtileArray=[]),p.curfoxitpagescale=e.pagescale,e.scaleupdate&&Cc(p.tilesCreated,p.canvtileArray,e),e.scrollupdate&&Cc(p.tilesCreated,p.bgCanvtileArray,e,p.visibleTiles)},this.setfoxitpagedimnew=function(e){switch(p.foxitpagerot=e.rotation,p.foxitpageorigrot=e.originalrotation,p.pdfpagewidth=e.width,p.pdfpageheight=e.height,p.originalwidth=e.pdfwidth,p.originalheight=e.pdfheight,p.printobj.setDocSize(p.originalwidth,p.originalheight),p.getpageRotation()){case 0:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight,p.bpagesizeupdated=!0;break;case 90:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth,p.bpagesizeupdated=!0;break;case 180:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight,p.bpagesizeupdated=!0;break;case 270:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth,p.bpagesizeupdated=!0}var t=Te/p.pdfpageheight,a=Me/p.pdfpagewidth;if(p.fixedScale=Math.min(a,t),p.curpagescale=e.pagescale,null!=e.pagepos&&p.setpagesize(e.pagepos.width,e.pagepos.height),p.curpagescale=p.offscreenwidth/p.pdfpagewidth,null!=e.pagepos&&(p.width=e.pagepos.width,p.height=e.pagepos.height),p.pdfrenderopque-=1,p.pdfrenderopque<=0&&(p.pdfrenderopque=0,p.pdfisrendered=!0),null!=e.pagepos){var i=p.width/e.pagepos.width,s=p.height/e.pagepos.height;p.pdfdscaletemp=Math.min(i,s),p.pdfdxtemp=(ti-e.pagepos.width)/2,p.pdfdytemp=(ai-e.pagepos.height)/2,p.pdfisrendered=!0,p.iscollapsed=!1,p.pdfisfirstrendered=!0,p.setPDFdim(p.pdfdxtemp,0,p.pdfdscaletemp)}p.DocRef.foxitsearchobjrect.active&&p.DocRef.foxitsearchobjrect.setpagerect(p.pagenumber),p.DocRef.foxitsearchobj.active&&p.DocRef.getpageloadSearch(p.pagenumber),p.drawtextSearchRect&&(p.drawsearchRect(),p.drawtextSearchRect=!1)},this.setfoxitpagedim=function(e,t,a,i){p.pdfpagewidth=e,p.pdfpageheight=t,p.originalwidth=e,p.originalheight=t;var s=Te/p.pdfpageheight,r=Me/p.pdfpagewidth;p.fixedScale=Math.min(r,s),p.curpagescale=i,p.setpagesize(a.width,a.height),p.curpagescale=p.offscreenwidth/p.pdfpagewidth,p.width=a.width,p.height=a.height,p.pdfrenderopque-=1,p.pdfrenderopque<=0&&(p.pdfrenderopque=0,p.pdfisrendered=!0);var n=p.width/a.width,o=p.height/a.height;p.pdfdscaletemp=Math.min(n,o),p.pdfdxtemp=(ti-a.width)/2,p.pdfdytemp=(ai-a.height)/2,p.pdfisrendered=!0,p.iscollapsed=!1,p.pdfisfirstrendered=!0,p.setPDFdim(p.pdfdxtemp,0,p.pdfdscaletemp)},this.foxitcreateAnnotArray=function(e){if(p.annotArray=[],e.annots&&e.annots.length>0)for(var t=0;t<e.annots.length;t++)p.annotArray.push({cnv:document.createElement("canvas"),pos:e.annots[t].pos}),p.annotArray[t].cnv.width=e.annots[t].tiles[0].width,p.annotArray[t].cnv.height=e.annots[t].tiles[0].height,p.annotArray[t].cnv.getContext("2d").drawImage(e.annots[t].tiles[0],0,0)},this.foxitcreatecanvasArray=function(e,t){var a=0,i=0,s=0;if(e.canvases&&e.canvases.length>0){for(var r=0,n=0;n<e.hidden.length;n++)r==e.hidden[n].ct&&r++;for(var o=0;o<t.length;o++){"canvas"==e.canvases[r].tagName.toLowerCase()&&(o<t.length-1?(i+=e.tileSize,s=e.tileSize):(i+=e.canvases[r].height,s=e.canvases[r].height),a=0);for(var l=0;l<t[o].length;l++)if(e.canvases[r]&&"canvas"==e.canvases[r].tagName.toLowerCase())for(l<t[o].length-1?(a+=e.tileSize,e.tileSize):(a+=e.canvases[r].width,e.canvases[r].width),s<e.canvases[r].height&&(i+=e.canvases[r].height-s),1==e.transScale?(t[o][l].cnv.height=e.canvases[r].height,t[o][l].cnv.width=e.canvases[r].width,t[o][l].tilenumber=r,t[o][l].xoffset=e.tileSize,t[o][l].yoffset=e.tileSize):(t[o][l].cnv.height=Math.round(e.canvases[r].height*e.transScale),t[o][l].cnv.width=Math.round(e.canvases[r].width*e.transScale),t[o][l].tilenumber=r,t[o][l].xoffset=e.tileSize*e.transScale,t[o][l].yoffset=e.tileSize*e.transScale),r++,n=0;n<e.hidden.length;n++)r==e.hidden[n].ct&&r++}}return{width:a*=e.transScale,height:i*=e.transScale}},this.foxitdrawcanvasArray=function(e,t,a){var i=!1,s=!1;if(this.busetempcanvases?p.tempfoxitpage.canvases&&(i=!0,p.tempfoxitpage.canvases.length>0&&(s=!0)):t&&(i=!0,t.length>0&&(s=!0)),i&&s)for(var r=!0,n=0;n<p.canvtileArray.length;n++){r=!0;for(var o=0;o<p.canvtileArray[n].length;o++){r=!0;for(var l=0;l<e.length;l++)n==e[l].r&&o==e[l].c&&(r=!1);if(r)if(1==a)this.busetempcanvases?p.canvtileArray[n][o].ctx.drawImage(p.tempfoxitpage.canvases[p.canvtileArray[n][o].tilenumber].cnv,0,0):p.canvtileArray[n][o].ctx.drawImage(t[p.canvtileArray[n][o].tilenumber],0,0);else{if(this.busetempcanvases)var c=Un(p.tempfoxitpage.canvases[p.canvtileArray[n][o].tilenumber].cnv,a);else c=Un(t[p.canvtileArray[n][o].tilenumber],a);p.canvtileArray[n][o].ctx.drawImage(c,0,0),c=null}}}this.busetempcanvases&&(p.tempfoxitpage.canvases=[],this.busetempcanvases=!1)},this.foxitdrawAllcanvasArray=function(e,t){if(e&&e.length>0){p.canvtileArray[0][0].cnv.width,p.canvtileArray[0][0].cnv.height;for(var a=(p.dxpdf,p.dypdf,[]),i=0;i<p.canvtileArray.length;i++){for(var s=0;s<p.canvtileArray[i].length;s++){if(p.canvtileArray[i][s].cnv.width,p.canvtileArray[i][s].cnv.height,1==t)p.canvtileArray[i][s].ctx.drawImage(e[p.canvtileArray[i][s].tilenumber],0,0);else{var r=Un(e[p.canvtileArray[i][s].tilenumber],t);p.canvtileArray[i][s].ctx.drawImage(r,0,0)}a.push({r:i,c:s}),p.dscalepdf}p.dscalepdf,p.dxpdf}}return p.draw_canvas(!0),a},this.rotatedRectbyangle=function(e){var t=this.startx,a=this.starty,i=this.endx,s=this.endy,r=e*(Math.PI/180),n=Math.cos(r),o=Math.sin(r),l=ti/2,c=ai/2,h=t-l,d=a-c,p=h*n-d*o,u=h*o+d*n;p=l+p,u=c+u;var g=(h=i-l)*n-(d=s-c)*o,f=h*o+d*n;return g=l+g,f=c+f,{x:Math.min(p,g),y:Math.min(u,f),w:Math.max(g,p),h:Math.max(f,u)}},this.rotatedRect=function(){var e=this.startx,t=this.starty,a=this.endx,i=this.endy,s=this.getpageRotation()*(Math.PI/180),r=Math.cos(s),n=Math.sin(s),o=ti/2,l=ai/2,c=e-o,h=t-l,d=c*r-h*n,p=c*n+h*r;d=o+d,p=l+p;var u=(c=a-o)*r-(h=i-l)*n,g=c*n+h*r;return u=o+u,g=l+g,{x:Math.min(d,u),y:Math.min(p,g),w:Math.max(u,d),h:Math.max(g,p)}},this.printPDFpage=function(){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getBitmap(p.pagenumber,p.printobj.pscale,p.setPageBitmapPrint)},this.setPageBitmapPrint=function(e,t){if(e.error)return console.log("bitmap failed",t,e.error),void(p.printResolve&&p.printResolve());if(null!=e){var a=new Uint8ClampedArray(e.buffer),i=new ImageData(a,e.width,e.height);p.pdfprintcanvas.width=e.width,p.pdfprintcanvas.height=e.height,p.printobj.pagenumber=t,p.pdfprintctx.putImageData(i,0,0),p.printobj.printctx.drawImage(p.pdfprintcanvas,p.printobj.pdx,p.printobj.pdy,p.printobj.docwidth*p.printobj.pscale,p.printobj.docheight*p.printobj.pscale),jl(p.printobj.printctx,t,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale),Qi[t]=!0,p.printResolve&&(p.printResolve(),p.printResolve=null)}else p.printResolve&&p.printResolve()},this.load3Dimage=function(e){p.printobj.printctx.drawImage(e.currentTarget,p.printobj.pdx,p.printobj.pdy,p.printobj.docwidth*p.printobj.pscale,p.printobj.docheight*p.printobj.pscale),jl(p.printobj.printctx,p.pagenumber,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale)},this.smallimagecreatefromlarge=function(){var e,t,a,i,s,r,n;r=p.SmallImageWidth,n=p.SmallImageHeight;var o=p.SmallImageWidth/p.originalwidth;p.smallimagecnv.width=r,p.smallimagecnv.height=n,o<1?p.smallimagecnv=Un(p.largeimagecnv,o):p.smallimagectx.drawImage(p.largeimagecnv,0,0,r,n),e=ai/p.SmallImageHeight,t=ti/p.SmallImageWidth,s=Math.min(t,e),a=(ti-p.SmallImageWidth*s)/2,i=(ai-p.SmallImageHeight*s)/2,p.setimagedimsmall(a,i,s),null!=la&&la.setDownload("hide")},this.getpageRef=function(){return p.pdfpageref},this.getpageRotation=function(){var e=p.drotation;return null!=p.DocRef.foxitdoc&&0!=p.DocRef.documentrotation&&(e=p.DocRef.documentrotation),e},this.backupScaleAndOffset=function(){p.dscalebackup=p.dscalepdf,p.curpagescalebackup=p.curpagescale,p.dxbackup=p.dxpdf,p.dybackup=p.dypdf},this.getCurPageScale=function(){return p.curpagescale},this.restoreScaleAndOffset=function(){p.dscalepdf=p.dscalebackup,p.curpagescale=p.curpagescalebackup,p.dxpdf=p.dxbackup,p.dypdf=p.dybackup},this.setPDFDiminit=function(e,t,a){this.pageloaded=!1,this.dxpdf=e,this.dypdf=t,this.dscalepdf=a,p.setpagedimsize(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf,!1),this.pagedimset=!0,this.pdfdiminitset=!0,o&&(vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive())),p.pagenumber==p.DocRef.pages.length-1&&null!=mt&&mt.loadComplete(p.DocRef.FileName,p.DocRef.bActive)},this.setPFDdimnodraw=function(e,t,a,i){this.dxpdf=e,this.dypdf=t,i&&(this.dscalepdf=a),p.setpagedimsize(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf,!1),p.pagedimset=!0},this.setPDFdim=function(e,t,a){p.pageloaded=!0,p.pdfdiminitset||(p.dxpdf=e,p.dypdf=t,p.setpagedimsize(p.dxpdf,p.dypdf,p.offscreenwidth*p.dscalepdf,p.offscreenheight*p.dscalepdf,!1),this.pagedimset=!0,p.pdfdiminitset=!0,p.pageloading=!1,p.backupScaleAndOffset(),o&&(vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive()),null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getLayerNodes(),p.visible=!0,null!=la&&la.setDownload("hide"),null!=_e&&_e.loadComplete(p.DocRef.OriginalURL,p.DocRef.bActive),null!=ja&&(p.DocRef.hastext=!0,ja.hasText(p.DocRef.hastext,p.DocRef.bActive)),p.draw_canvas(!0),Lp(),p.DocRef.getfoxitThumbnail(0))),p.dscalepdf=1,!o||p.DocRef.markuploaded||p.markuplistloaded||(nr?Wc(l,p.DocRef):or?_c(p.DocRef):(p.markuplistloaded=!0,Xc(l,p.DocRef))),o&&p.pdfdiminitset,o&&p.pdfdiminitset,p.DocRef.setthumbnail(p.pdfpagewidth,p.pdfpageheight,p.pagenumber),null!=nt&&(nt.loadComplete(p.pagenumber),p.DocRef.loadPageEvt(p.pagenumber)),p.DocRef.draw_mpagepdf(!1),p.backupScaleAndOffset()},this.istextvisible=function(e,t){var a=!1;return Math.max(0,e),Math.min(ti,e),Math.max(ai,t),Math.min(0,t),e>0&&e<ti&&t>0&&t<ai&&(a=!0),a},this.ispagevisible=function(){var e=!1;if(p.usepdfjs){if(null!=p.DocRef.pages[p.DocRef.currentpage]){Math.max(0,p.DocRef.pages[p.DocRef.currentpage].startx),Math.min(ti,p.DocRef.pages[p.DocRef.currentpage].endx);var t=p.DocRef.pages[p.DocRef.currentpage].endy,a=p.DocRef.pages[p.DocRef.currentpage].starty;p.DocRef.currentpage==p.pagenumber?e=!0:(p.pagenumber==p.DocRef.currentpage+1&&t<ai-2&&(e=!0),p.pagenumber==p.DocRef.currentpage-1&&a>2&&(e=!0))}}else e=p.DocRef.currentpage==p.pagenumber;return e},this.queRenderCompareScale=function(e){p.pageRendering?p.pageNumPending=p.pagenumber+1:p.renderPDFComparescale(e)},this.continueCallback=function(e){p.pagenumber,p.DocRef.pages[p.DocRef.currentpage].pagenumber,e()},this.foxitRenderPageScaled=function(){var e=p.offscreenwidth*p.dscalepdf/pagewidth,t=p.offscreenheight*p.dscalepdf/pageheight,a=Math.min(e,t);null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.renderScale(p.pagenumber,a)},this.setpagesize=function(e,t){p.offscreenwidth=e,p.offscreenheight=t},this.collapsetileArray=function(){for(var e=0;e<p.canvtileArray.length;e++)for(var t=0;t<p.canvtileArray[e].length;t++)p.canvtileArray[e][t].cnv.width=1,p.canvtileArray[e][t].cnv.height=1,p.canvtileArray[e][t].ctx=null,p.canvtileArray[e][t].cnv=null;p.canvtileArray=[],p.annotArray=[]},this.collapsepage=function(){p.iscollapsed||(p.iscollapsed=!0,p.setNotCollapsedArray(),p.collapsetileArray(),p.PDFPointArray=[],p.bpointlistSet=!1)},this.setPDFTextAra=function(t){p.PDFTextArea.id="PDFpage"+t,p.PDFTextArea.style.left=p.pdfdxtemp+"px",p.PDFTextArea.style.width=p.width+"px",p.PDFTextArea.style.height=p.height+"px",p.PDFTextArea.style.zIndex="4",e.appendChild(p.PDFTextArea),1==t&&p.DocRef.textselect?p.PDFTextArea.style.display=li:p.PDFTextArea.style.display="none",p.textareaset=!0},this.drawpoints=function(e,t){p.PDFinternalScale.x>0&&p.PDFinternalScale.x,p.PDFinternalScale.y>0&&p.PDFinternalScale.y;var i=p.offscreenheight*p.dscalepdf,s=p.offscreenwidth*p.dscalepdf;p.PDFpageRotate;for(var r=0;r<e.length;r++){if(0!=p.PDFpageRotate)if(90==p.PDFpageRotate)var n=p.starty+-e[r].y*t,o=p.startx+e[r].x*t;else n=p.starty+(-e[r].y*t+i),o=p.startx+e[r].x*t+s;else n=e[r].y<0?p.starty+-e[r].y*t:p.starty+(-e[r].y*t+i),o=e[r].x<0?p.startx+e[r].x*t+s:p.startx+e[r].x*t;$p(a,0,{x:o,y:n})}},this.getdivpos=function(e){var t={x:0,y:0,w:0,h:0};if(p.pan_update(0,0),null!=p.PDFTextArea&&null!=p.PDFTextArea.children[e]){var a=p.PDFTextArea.children[e],i=p.PDFTextArea.offsetTop,s=p.PDFTextArea.offsetLeft;t.y=a.offsetTop+i,t.x=a.offsetLeft+s,t.w=a.offsetWidth,t.h=a.offsetHeight}if(null!=p.TextSelectArea&&null!=p.TextSelectArea.children[e]){var r=p.TextSelectArea.children[e],n=p.TextSelectArea.offsetTop,o=p.TextSelectArea.offsetLeft;t.y=r.offsetTop+n,t.x=r.offsetLeft+o,t.w=r.offsetWidth,t.h=r.offsetHeight}return t},this.indexdivTexts=function(){var e=[];if(null!=p.PDFTextArea)for(var t=p.PDFTextArea.children,a=0;a<t.length;a++){t[a].style.backgroundColor=null;var i=t[a];e.push(i.textContent)}if(null!=p.TextSelectArea)for(var s=p.TextSelectArea.children,r=0;r<s.length;r++){s[r].style.backgroundColor=null;var n=s[r];e.push(n.textContent)}return e},this.clearmarktextdiv=function(e,t){if(null!=p.PDFTextArea&&null!=p.PDFTextArea.children[e]){p.PDFTextArea.children[e].innerHTML="";var a=document.createTextNode(t);p.PDFTextArea.children[e].appendChild(a)}if(null!=p.TextSelectArea&&null!=p.TextSelectArea.children[e]){p.TextSelectArea.children[e].innerHTML="";var i=document.createTextNode(t);p.TextSelectArea.children[e].appendChild(i)}},this.marktextdiv=function(e,t,a,i){if(null!=p.PDFTextArea){var s=t.substring(a,i+a),r=t.split(" ");if(null!=p.PDFTextArea.children[e]){p.PDFTextArea.children[e].innerHTML="";for(var n=0,o=0;o<r.length;o++){var l=r[o].search(s);if(-1==l){if(n>0)var c=document.createTextNode(r[o]+" ");else c=document.createTextNode(r[o]);p.PDFTextArea.children[e].appendChild(c),n++}else if(l>=0){var h=document.createElement("span");h.className="highlight",c=document.createTextNode(s),h.appendChild(c),p.PDFTextArea.children[e].appendChild(h),n=0}}}}if(null!=p.TextSelectArea){var d=t.substring(a,i+a),u=t.split(d);if(null!=p.TextSelectArea.children[e]){p.TextSelectArea.children[e].innerHTML="";for(var g=0;g<u.length;g++){if(g>0){var f=document.createElement("span");f.className="highlight";var m=document.createTextNode(d);f.appendChild(m),p.TextSelectArea.children[e].appendChild(f)}""!=u[g]&&(m=document.createTextNode(u[g]),p.TextSelectArea.children[e].appendChild(m))}}}},this.getVectorSearchList=function(){p.getVectorSearchListSearch(p.DocRef.searchobj)},this.getVectorSearchListSearch=function(e){for(var t=p.indexdivTexts(),a=e.casesens,i=e.expr,s=0;s<t.length;s++){if(a)r=i,n=t[s];else var r=i.toLowerCase(),n=t[s].toLowerCase();var o=!1,l=n.search(r);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:p.pagenumber,indx:s,searchtext:t[s],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getVectorSearchListRect=function(e){for(var t=p.indexdivTexts(),a=e.casesens,i=e.expr,s=0;s<t.length;s++){if(a)r=i,n=t[s];else var r=i.toLowerCase(),n=t[s].toLowerCase();var o=!1,l=n.search(r);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:p.pagenumber,indx:s,searchtext:t[s],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getPDFSearchList=function(){for(var e=p.indexdivTexts(),t=p.DocRef.searchobj.casesens,a=p.DocRef.searchobj.expr,i=0;i<e.length;i++){if(t)s=a,r=e[i];else var s=a.toLowerCase(),r=e[i].toLowerCase();var n=!1,o=r.search(s);if(-1==o?n=!1:o>=0&&(n=!0),n){var l={page:p.pagenumber,indx:i,searchtext:e[i],pos:o,length:a.length};p.DocRef.searchobj.matcharray.push(l)}}},this.getrotcoords=function(e,t,a,i,s){var r=Math.PI/180*s,n=Math.cos(r),o=Math.sin(r);return{x:n*(a-e)+o*(i-t)+e,y:n*(i-t)-o*(a-e)+t}},this.getSearchTextRect=function(){if(p.DocRef.extractsearchobj.page==p.pagenumber){if(p.usevectorxml){p.settextdivs(),p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].searchtext;var e=p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].indx;p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].pos,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].length}p.usepdfjs&&(p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].searchtext,e=p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].indx,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].pos,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].length);var t=p.getdivpos(e);p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].rect=t}var a=ai/2,i=ti/2;p.getpagerect(),0!=p.getpageRotation()&&p.getrotcoords(i,a,t.x,t.y,-p.getpageRotation())},this.getsearchpanupdate=function(e,t){var a=si/2,i=ii/2,s=ii,r=si,n=0,o=0;if(0!=p.getpageRotation()){var l=p.getrotcoords(i,a,e,t,-p.getpageRotation());c=Math.max(l.x,s)-Math.min(l.x,s),(Math.max(l.x,s)==l.x||c<300)&&(n=l.x-i),h=Math.max(l.y,r)-Math.min(l.y,r),(Math.max(l.y,r)==l.y||h<100)&&(o=l.y-a),d=Math.max(l.x,0)-Math.min(l.x,0),(Math.min(l.x,0)==l.x||d<100)&&(n=-(i-l.x)),u=Math.max(l.y,0)-Math.min(l.y,0),(Math.min(l.y,0)==l.y||u<100)&&(o=-(a-l.y))}else{var c=Math.max(e,s)-Math.min(e,s);(Math.max(e,s)==e||c<300)&&(n=e-i);var h=Math.max(t,r)-Math.min(t,r);(Math.max(t,r)==t||h<100)&&(o=t-a);var d=Math.max(e,0)-Math.min(e,0);(Math.min(e,0)==e||d<100)&&(n=-(i-e));var u=Math.max(t,0)-Math.min(t,0);(Math.min(t,0)==t||u<100)&&(o=-(a-t))}return{x:n,y:o}},this.setAs3DNavigator=function(e,a){for(var i=[],s=0;s<e.length;s++)i.push({Elevation:e[s].Elevation,index:s});null!=a&&(p.bis3Dnavigator=!0,p.navfloorplan={index:e[a].index,SRC:e[a].SRC,Elevation:e[a].Elevation,Elevations:i,Scale:e[a].Scale,BScale:e[a].BScale,RScale:e[a].RScale,image:e[a].image,canvas:e[a].canvas,ctx:e[a].ctx,replaced:e[a].replaced,originalWidth:e[a].originalWidth,originalHeight:e[a].originalHeight,width:e[a].width,height:e[a].height,offsetX:e[a].offsetX,offsetY:e[a].offsetY,alignarray:e[a].alignarray},null==p.birdseyemarker&&(p.birdseyemarker=new vc(t)))},this.birdseyecamera=function(){p.bis3Dnavigator&&p.DocRef.bActive&&p.navfloorplan&&(a.clearRect(0,0,t.width,t.height),p.birdseyemarker.drawme(a,!0))},this.get3DNavElevation=function(e){return p.navfloorplan.index==e.max},this.getnavcampos=function(e,t,a){if(p.DocRef.bActive&&p.navfloorplan&&null!=t){p.birdseyedispeye.distance=0,p.birdseyedispeye.rotation={degrees:90,radians:.5*Math.PI};var i=p.getpagedim();if(p.birdseyedispeye.r=32,p.navfloorplan.replaced){var s=i.scale/p.navfloorplan.RScale;p.birdseyedispeye.x=.5*p.navfloorplan.originalWidth*s+i.x,p.birdseyedispeye.y=.5*p.navfloorplan.originalHeight*s+i.y,p.birdseyedispeye.scale=s*p.navfloorplan.Scale,p.birdseyedispeye.x+=-p.navfloorplan.offsetX*s,p.birdseyedispeye.y+=-p.navfloorplan.offsetY*s}else p.birdseyedispeye.x=.5*i.w+i.x,p.birdseyedispeye.y=.5*i.h+i.y,p.birdseyedispeye.scale=i.scale*p.navfloorplan.Scale;p.birdseyedispeye.boxcenter=t,p.birdseyedispeye.camerapos=t;var r=p.navfloorplan.index,n=p.getCurfloorElevation(r,e),o=p.birdseyemarker.getcamera(p.birdseyedispeye,a.xus,a.yus);return o.z=n,o}},this.getfloorheight=function(e){return 1==e?1.8:0==e?1800:2==e?5.9:3==e?69:4==e?180:void 0},this.getCurfloorElevation=function(e,t){var a=null;if(null!=p.navfloorplan&&p.navfloorplan.index==e){var i=p.getfloorheight(t);a=p.navfloorplan.Elevation+i}return a},this.setbirdseyecamera=function(e,t,a){if(p.DocRef.bActive&&p.navfloorplan&&!(null==a&&null==a||null==e&&null==e)){null==t&&(t={degrees:90,radians:.5*Math.PI}),p.birdseyedispeye.distance=e.distanceTo(a),p.birdseyedispeye.rotation=t;var i=p.getpagedim();if(p.birdseyedispeye.r=32,p.navfloorplan.replaced){var s=i.scale/p.navfloorplan.RScale;p.birdseyedispeye.x=.5*p.navfloorplan.originalWidth*s+i.x,p.birdseyedispeye.y=.5*p.navfloorplan.originalHeight*s+i.y,p.birdseyedispeye.scale=s*p.navfloorplan.Scale,p.birdseyedispeye.x+=-p.navfloorplan.offsetX*s,p.birdseyedispeye.y+=-p.navfloorplan.offsetY*s}else p.birdseyedispeye.scale=i.scale*p.navfloorplan.Scale,p.birdseyedispeye.x=.5*i.w+i.x,p.birdseyedispeye.y=.5*i.h+i.y;p.birdseyedispeye.boxcenter=a,p.birdseyedispeye.camerapos=e,p.birdseyemarker.setcamera(p.birdseyedispeye)}},this.showFoxitSearchOnUpdate=function(){p.drawtextSearchRect=!0},this.showFoxitSearch=function(){if(p.DocRef.foxitsearchobj.page==p.pagenumber){var e=p.DocRef.foxitsearchobj.getcurmatch(),t=e.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,a=(p.pdfpageheight-e.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,i=p.getsearchpanupdate(t,a);p.pan_update(i.x,i.y),p.drawtextSearchRect=!0,p.drawsearchRect()}},this.showBookmark=function(e){if(e.page==p.pagenumber){var t=e.left*(p.curpagescale*p.dscalepdf)+p.dxpdf,a=(p.pdfpageheight-e.top)*(p.curpagescale*p.dscalepdf)+p.dypdf;p.pan_update(t,a)}},this.showSearch=function(){if(p.DocRef.searchobj.page==p.pagenumber){p.usevectorxml&&p.settextdivs();var e=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].searchtext,t=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].indx,a=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].pos,i=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].length,s=p.getdivpos(t),r=p.getsearchpanupdate(s.x,s.y);p.pan_update(r.x,r.y),p.marktextdiv(t,e,a,i)}},this.foxitClearSearch=function(){p.DocRef.foxitsearchobj.page==p.pagenumber&&(p.drawtextSearchRect=!1)},this.clearSearch=function(){if(p.DocRef.searchobj.page==p.pagenumber){var e=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].searchtext,t=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].indx;p.clearmarktextdiv(t,e)}},this.removetext=function(){null!=p.TextSelectArea&&(p.TextSelectArea.removeEventListener("wheel",tu,!0),p.TextSelectArea.remove())},this.selecttext=function(){null!=p.TextSelectArea&&(p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none")},this.movetextdivs=function(){if(null!=p.TextSelectArea){Hl();var e=ai/2,t=ti/2;p.TextSelectArea.removeAttribute("style");var a=p.endx-p.startx,i=p.endy-p.starty,s=t-p.startx,r=e-p.starty,n=x(p.startx,p.starty,a,i);if(p.TextSelectArea.style.top=n.y+"px",p.TextSelectArea.style.left=n.x+"px",p.TextSelectArea.style.width=n.w+"px",p.TextSelectArea.style.height=n.h+"px",p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none",0!=this.getpageRotation()){var o=s+"px "+r+"px";p.TextSelectArea.style.transformOrigin=o,p.TextSelectArea.style.transform="rotate("+this.getpageRotation()+"deg)"}}},this.settextdivs=function(){if(null!=p.TextSelectArea){p.TextSelectArea.removeAttribute("style");var e=D(),t=p.endx-p.startx,a=p.endy-p.starty,i=x(e.dx,e.dy,t,a);p.TextSelectArea.style.top=i.y+"px",p.TextSelectArea.style.left=i.x+"px",p.TextSelectArea.style.width=i.w+"px",p.TextSelectArea.style.height=i.h+"px",p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none",0!=this.getpageRotation()&&(p.TextSelectArea.style.transformOrigin="50% 50%",p.TextSelectArea.style.transform="rotate("+this.getpageRotation()+"deg)");var s={textLayerDiv:p.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};p.VectorPageObj.TextLayerBuilder(s)}},this.cleartextdivs=function(){if(null!=p.TextSelectArea){var e={textLayerDiv:p.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};p.VectorPageObj.TextLayerClear(e)}},this.ZoomRealSize=function(){var e=p.MainImageWidth/this.MainImageScaling/p.DPI*96;this.dscale=e/p.MainImageWidth,this.dx=(ti-this.MainImageWidth*this.dscale)/2,this.dy=0},this.getdx=function(){return this.usevectorxml?this.dxvector:this.usepdfjs?this.dxpdf:this.dx},this.getdy=function(){return this.usevectorxml?this.dyvector:this.usepdfjs?this.dypdf:this.dy},this.getdscale=function(){return this.usevectorxml?this.dscalevector:this.usepdfjs?this.dscalepdf*this.curpagescale:this.dscale},this.getClipRect=function(e,t){var a=void 0;if(p.usevector3DGLTF){var i=d.getContext();e.y=ai-e.y-e.h;var r=new Uint8Array(e.w*e.h*4);i.readPixels(e.x,e.y,e.w,e.h,i.RGBA,i.UNSIGNED_BYTE,r);var n=new Uint8ClampedArray(r);a=sp(a=new ImageData(n,e.w,e.h))}else p.usepdfjs?p.getPDFcliprect(e,t):a=s.getImageData(e.x,e.y,e.w,e.h);return a},this.screentoDocRect=function(e){return{x:(e.x-p.getdx())/p.getdscale(),y:(e.y-p.getdy())/p.getdscale(),w:e.w/p.getdscale(),h:e.h/p.getdscale()}},this.getcur3DView=function(){return null},this.setpagedim=function(e,t,a,i){var s=p.getpagedim(),r=t/s.w;s.h,r>1?p.ZoomIn(r,!0,!0):(r=1/r,p.ZoomOut(r,!0,!0)),p.pan_position(a,i)},this.getpagedim=function(){var e=p.DPI;p.usepdfjs&&(e=72);var t=p.getpagerect();return{x:t.x,y:t.y,w:t.w,h:t.h,origw:p.originalwidth,origh:p.originalheight,scale:p.getdscale(),dpi:e,rotation:p.getpageRotation()}},this.redraw=function(){this.usepdfjs&&p.DocRef.forcefoxitRedraw(),w()},this.getPDFcliprect=function(e,t){var a=p.getPDFpageScale();e.x=e.x-p.dxpdf,e.y=e.y-p.dypdf;var i=p.originalPDFwidth,s=p.originalPDFheight,r=Math.sqrt(ws/(i*s));a>r?(a=r,p.bMaxzoom=!0):p.bMaxzoom=!1,null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getBitmapRect(p.pagenumber,a,e,t)},this.getfoxitbitmap=function(e){var t=p.getPDFpageScale();null!=p.DocRef.foxitdoc&&(t=p.DocRef.foxitdoc.getcurPageScale());var a=p.originalPDFwidth,i=p.originalPDFheight,s=Math.sqrt(ws/(a*i));t>scope.nPDFMaxFactor?(t=s,p.bMaxzoom=!0):p.bMaxzoom=!1,null!=p.DocRef.foxitdoc&&docref.foxitdoc.getBitmapRect(p.pagenumber,t,e,p.setPageBitmap)},this.checkFoxitMaxZoom=function(e){var t=!1,a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc){var i=p.DocRef.foxitdoc.nMaxScale;null!=i&&a<=i&&(t=!0)}return t},this.foxitpanToPoint=function(e){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.pantopoint(p.pagenumber,e)},this.foxitdirectZoomToEx=function(e,t){var a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc)var i=p.DocRef.foxitdoc.nMaxScale;null!=i&&a>=i||null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.zoomtopointdirect(p.pagenumber,a,t)},this.foxitdirectZoomTo=function(e,t,a,i,s,r){var n=Hl(),o=p.getPDFpageScale()*rn;if(o*=e,a.x/=n,a.y/=n,null!=p.DocRef.foxitdoc)var l=p.DocRef.foxitdoc.nMaxScale;null!=l&&o>=l||null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.zoomToPoint(p.pagenumber,o,t,a,i,s,r)},this.getPDFpageScale=function(){var e=p.offscreenwidth/p.pdfpagewidth;return 0!=p.getpageRotation()&&(e=p.bpagesizeupdated?(90==p.getpageRotation()||p.getpageRotation(),p.offscreenwidth/p.pdfpagewidth):p.offscreenwidth/p.pdfpagewidth),e},this.foxitdirectZoom=function(e){var t=void 0,a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc&&(t=p.DocRef.foxitdoc.nMaxScale),!(null!=t&&a>=t)){if(null!=p.DocRef.foxitdoc){var i=(p.getpagerect(),p.pagenumber);return i={pagerect:p.getpagerect(),cw:ii,ch:si,pagenum:p.pagenumber,visiblechanged:!1},p.DocRef.foxitdoc.zoomdirect(p.pagenumber,a,i)}return Promise.resolve()}},this.zoomall=function(e){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,3)}if(!this.usevector3Dxml){if(this.usepdfjs){if(0==p.offscreenheight||0==p.offscreenwidth||!p.pdfdiminitset)return;var a=p.offscreenheight,i=p.offscreenwidth}else{var s=D();null!=s&&k(function(e){var t=e.dscale,a=e.dscale;switch(p.getpageRotation()){case 0:t=ai/e.height,a=ti/e.width;break;case 90:t=ai/e.width,a=ti/e.height;break;case 180:t=ai/e.height,a=ti/e.width;break;case 270:t=ai/e.width,a=ti/e.height}e.dscale=Math.min(a,t),e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;var i=e.dx,s=e.dy,r=e.width*e.dscale+i,n=e.height*e.dscale+s;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:i,starty:s,endx:r,endy:n}}(s),!1)}if(this.usepdfjs){var r=this.dscalepdf,n=this.dscalepdf;switch(this.getpageRotation()){case 0:r=ai/a,n=ti/i,r=si/a,n=ii/i,this.dscalepdf=Math.min(n,r),this.curzoomfunction=0;break;case 90:p.bpagesizeupdated?(r=ai/a,n=ti/i,r=si/a,n=ii/i):(r=ai/i,n=ti/a,r=si/i,n=ii/a),this.dscalepdf=Math.min(n,r),this.dscalepdf==n?p.curzoomfunction=1:this.dscalepdf==r&&(p.curzoomfunction=2);break;case 180:r=ai/a,n=ti/i,r=si/a,n=ii/i,this.dscalepdf=Math.min(n,r),this.curzoomfunction=0;break;case 270:p.bpagesizeupdated?(r=ai/a,n=ti/i,r=si/a,n=ii/i):(r=ai/i,n=ti/a,r=si/i,n=ii/a),this.dscalepdf=Math.min(n,r),this.dscalepdf==n?p.curzoomfunction=1:this.dscalepdf==r&&(p.curzoomfunction=2)}p.pdfisrendered=!1,p.pdfrenderopque+=1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf),this.dxpdf=(ii-i*this.dscalepdf)/2,this.dypdf=(si-a*this.dscalepdf)/2}this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),w(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,3))}},this.getPageScale=function(){return p.curpagescale},this.ZoomPageUpdate=function(e,t){switch(t){case 0:p.ZoomIn(e.factor,e.center,!0,e.mousepos);break;case 1:p.ZoomOut(e.factor,e.center,!0,e.mousepos);break;case 2:p.zoom_update(e.sx,e.sy,e.sWide,e.sHi,!0);break;case 3:p.zoomall(!0);break;case 4:p.zoomwidth(!0);break;case 5:p.zoomheight(!0)}},this.vectorscrollbuffer=function(e,t,a){var i={s:e,x:t,y:a};p.vectordebounce_timer&&window.clearTimeout(p.vectordebounce_timer),p.vectordebounce_timer=window.setTimeout((function(){i&&(i.s,p.vectorischanged=!0,i=null)}),100)},this.scrollzoombuffer=function(e,t,a,i){var s={s:e,ps:t,x:a,y:i};p.debounce_timer&&window.clearTimeout(p.debounce_timer),p.debounce_timer=window.setTimeout((function(){p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&s&&(p.foxitdirectZoom(s.s),s=null),s=null}),1e3)},this.ZoomOutTest=function(e,t,a){if(!this.usevector3Dxml){if(a){var i={x:a.x,y:a.y};0!=p.getpageRotation()&&(i=Fn(a.x,a.y));var s=(ti/2-i.x)/e-(ti/2-i.x),r=(ai/2-i.y)/e-(ai/2-i.y);this.usepdfjs&&(i={x:a.xus,y:a.yus},0!=p.getpageRotation()&&(i=Fn(a.xus,a.yus)),s=(ii/2-i.x)/e-(ii/2-i.x),r=(si/2-i.y)/e-(si/2-i.y))}var n=(ti-this.MainImageWidth*this.dscale)/2,o=(ai-this.MainImageHeight*this.dscale)/2,l=(this.dx,this.dy,this.dscale/e);this.MainImageWidth,this.MainImageHeight;if(this.usepdfjs){var c=p.offscreenheight,h=p.offscreenwidth;0!=p.getpageRotation()&&(h=p.originalPDFwidth,c=p.originalPDFheight);var d=this.dscalepdf,u=this.dscalepdf;d=(ii-h*this.dscalepdf)/2,u=(si-c*this.dscalepdf)/2;var g,f,m=d-this.dxpdf,y=u-this.dypdf;this.dxpdf,this.dypdf,g=si/c,f=ii/h;var v=Math.min(f,g),x=h*this.dscalepdf/p.pdfpagewidth*e,b=c*this.dscalepdf/p.pdfpageheight*e;if(Math.min(x,b),1==p.DocRef.pages.length){var w=this.dscalepdf/e;this.bMinzoom=!1}else w=this.dscalepdf/e<v?v:this.dscalepdf/e;var k=this.dscalepdf,D=this.dscalepdf;if(k=(ii-h*this.dscalepdf)/2,D=(si-c*this.dscalepdf)/2,t)var C=k,R=D;else C=k-m/e,R=D-y/e;if(h<=ii){C=k;var P=!0}h*this.dscalepdf<=ii&&(C=(ii-h*this.dscalepdf)/2,P=!0),a&&(P||(C+=s),R+=r)}if(!this.usevectorxml&&this.usepdfjs)var S=C,M=R,T=h*w+C,E=c*w+R;return p.getpagetestrect({startx:S,starty:M,endx:T,endy:E})}},this.textselectreturn=function(e){p.textselectobj=e,p.textselectobj.bend&&(p.textselectobj.complete=!0,null!=ka&&null!=p.textselectobj.rectarray&&null!=p.textselectobj.rectarray[0]&&ka.TextCopied(p.DocRef.OriginalURL,p.textselectobj.rectarray[0].text))},this.SelectText=function(e,t,a,i){if(p.textselectobj.bstart=e,p.textselectobj.bend=t,e&&(p.textselectobj.rectarray=void 0,p.textselectobj.start=-1,p.textselectobj.end=-1,p.textselectobj.$handler=null),i){var s={x:i.x,y:i.y},r={x:a.x,y:a.y};s={x:i.xus,y:i.yus},r={x:a.xus,y:a.yus},0!=p.getpageRotation()&&(s=Fn(i.x,i.y),r=Fn(a.x,a.y),s=Fn(i.xus,i.yus),r=Fn(a.xus,a.yus));var n=p.getPDFCoordsRot(s),o=p.getPDFCoordsRot(r);p.textselectobj.startpos=[o.x,o.y],p.textselectobj.endpos=[n.x,n.y],null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.selectText(p.pagenumber,p.textselectobj,p.textselectreturn)}},this.postscaleRefresh=function(){window.setTimeout((function(){p.DocRef.forcefoxitRedraw()}),500)},this.ZoomIn=function(e,t,a,i){if(!this.usevector3Dxml){p.DocRef.textselect&&(i=void 0);var s=.5*ii,r=.5*si,n={x:s,y:r};if(0!=p.getpageRotation()&&Fn(s,r),null!=Da&&0==a){var o={factor:e,center:t,mousepos:i,rect:u=p.getpagerect()};Da.zoomUpdate(o,0)}if(i){var l={x:i.x,y:i.y},c={x:i.xus,y:i.yus};0==p.getpageRotation()||p.usepdfjs||(l=Fn(i.x,i.y),c=Fn(i.xus,i.yus));var h=(ti/2-l.x)*e-(ti/2-l.x),d=(ai/2-l.y)*e-(ai/2-l.y)}var u,g=D();if(this.usepdfjs){var f=function(e,t,a,i){var s=p.offscreenheight,r=p.offscreenwidth;p.bMinzoom=!1;var n=!1,o=a.dscale,l=a.dscale;o=(ii-r*a.dscale)/2,l=(si-s*a.dscale)/2;var c=o-a.dx,h=l-a.dy,d=r*a.dscale/p.pdfpagewidth*t,u=s*a.dscale/p.pdfpageheight*t;0!=p.getpageRotation()&&(90!=p.getpageRotation()&&270!=p.getpageRotation()||(p.bpagesizeupdated?(d=r*a.dscale/p.pdfpagewidth*t,u=s*a.dscale/p.pdfpageheight*t):(d=r*a.dscale/p.pdfpageheight*t,u=s*a.dscale/p.pdfpagewidth*t))),Math.min(d,u),a.dscale=a.dscale*t;var g=(ti-r*a.dscale)/2,f=(ai-s*a.dscale)/2;g=(ii-r*a.dscale)/2,f=(si-s*a.dscale)/2,0!=p.getpageRotation()&&p.bpagesizeupdated&&(90!=p.getpageRotation()&&270!=p.getpageRotation()||(g=(ai-r*a.dscale)/2,f=(ti-s*a.dscale)/2,g=(si-r*a.dscale)/2,f=(ii-s*a.dscale)/2)),e?(a.dx=g,a.dy=f):(a.dx=g-c*t,a.dy=f-h*t),r<=ii&&(p.DocRef.pagelocked||(a.dx=g),n=!0),r*a.dscale<=ii&&(p.DocRef.pagelocked||(a.dx=(ii-r*a.dscale)/2),n=!0),p.setpagedimsize(a.dx,a.dy,r*a.dscale,s*a.dscale,!1);var m=a.dx,y=a.dy,v=a.width*a.dscale+m,x=a.height*a.dscale+y;return{dscale:a.dscale,dx:a.dx,dy:a.dy,startx:m,starty:y,endx:v,endy:x,bWidthlocked:n,mousepoint:a.mousepoint,offsetpoint:a.offsetpoint,offsetcenter:a.offsetcenter,bIn:i,dfactor:t}}(t,e,g,!0),m=p.getPDFCoordsRot(n);if(i){var y=p.getPDFCoordsRot(c),v=0,x=0;this.dxpdf>0&&(v=8),this.dypdf>0&&(x=8);var b={x:v,y:x},C={x:v,y:x};0!=p.getpageRotation()&&(b=Fn(b.x,b.y));var R=p.getPDFCoordsRot(C);(!f.bWidthlocked||p.DocRef.pagelocked&&!Bi)&&(f.dx+=h,f.startx+=h,f.endx+=h),f.dy+=d,f.starty+=d,f.endy+=d,f.mousepoint=y,f.offsetpoint=R,f.bIn=!0,f.dfactor=e}else f.mousepoint=void 0;f.offsetcenter=m,k(f,!0)}if(w(),(u=p.getpagerect()).x>5&&u.y>5&&p.postscaleRefresh(),null!=Ca&&0==a)o={factor:e,center:t,mousepos:i,rect:u=p.getpagerect()},Ca.zoomUpdate(o,0)}},this.ZoomOut=function(e,t,a,i){if(!this.usevector3Dxml){Hl(),p.DocRef.textselect&&(i=void 0),E=.5*ti,F=.5*ai;var s={x:.5*ii,y:.5*si};if(null!=Da&&0==a){var r={factor:e,center:t,mousepos:i,rect:p.getpagerect()};Da.zoomUpdate(r,1)}if(i){var n={x:i.x,y:i.y};0==p.getpageRotation()||p.usepdfjs||(n=Fn(i.x,i.y));var o=(ti/2-n.x)/e-(ti/2-n.x),l=(ai/2-n.y)/e-(ai/2-n.y);this.usepdfjs&&(n={x:i.xus,y:i.yus},o=(ii/2-n.x)/e-(ii/2-n.x),l=(si/2-n.y)/e-(si/2-n.y))}if(this.usevectorxml,this.usepdfjs){var c=p.offscreenheight,h=p.offscreenwidth,d=p.getPDFCoordsRot(s);if(i){var u=p.getPDFCoordsRot(n),g={x:0,y:0};0!=p.getpageRotation()&&(g=Fn(g.x,g.y));var f=p.getPDFCoordsRot({x:0,y:0})}var m=this.dscalepdf,y=this.dscalepdf;m=(ii-h*this.dscalepdf)/2,y=(si-c*this.dscalepdf)/2;var v,x,b=m-this.dxpdf,k=y-this.dypdf;this.dxpdf,this.dypdf,v=si/c,x=ii/h;var D=Math.min(x,v),R=h*this.dscalepdf/p.pdfpagewidth*e,P=c*this.dscalepdf/p.pdfpageheight*e;Math.min(R,P),1==p.DocRef.pages.length?(this.dscalepdf=this.dscalepdf/e,this.bMinzoom=!1):this.dscalepdf/e<D?(this.dscalepdf=D,this.bMinzoom=!0):(this.dscalepdf=this.dscalepdf/e,this.bMinzoom=!1);var S=this.dscalepdf,M=this.dscalepdf;if(S=(ii-h*this.dscalepdf)/2,M=(si-c*this.dscalepdf)/2,t?(this.dxpdf=S,this.dypdf=M):(this.dxpdf=S-b/e,this.dypdf=M-k/e),h<=ii){p.DocRef.pagelocked||(this.dxpdf=S);var T=!0}if(h*this.dscalepdf<=ii&&(p.DocRef.pagelocked||(p.dxpdf=(ii-h*this.dscalepdf)/2),T=!0),i&&((!T||p.DocRef.pagelocked&&!Bi)&&(this.startx+=o,this.endx+=o),this.starty+=l,this.endy+=l),p.pdfrenderopque+=1,p.pdfisrendered=!1,p.getPDFpageScale(),i)p.foxitdirectZoomTo(p.dscalepdf,e,u,f,d,!1);else{var E=.5*ti,F=.5*ai,I=C(p.getpageRotation(),p.foxitpageorigrot),j=p.getPDFDistScale(E,p.dscalepdf),A=p.getPDFDistScale(F,p.dscalepdf);switch(I){case 0:d.x=d.x-j,d.y=d.y+A;break;case 90:d.x=d.x-A,d.y=d.y-j;break;case 180:d.x=d.x+j,d.y=d.y-A;break;case 270:d.x=d.x+A,d.y=d.y+j}p.foxitdirectZoomToEx(p.dscalepdf,d)}}this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,h*this.dscalepdf,c*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),w(),null!=Ca&&0==a&&(r={factor:e,center:t,mousepos:i,rect:p.getpagerect()},Ca.zoomUpdate(r,1))}},this.zoomwidth=function(e){if(!this.usevector3Dxml){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,4)}var a=0,i=ti;if(null!=p.DocRef.foxitdoc&&(i=ii-40),this.usepdfjs)var s=p.offscreenheight,r=p.offscreenwidth;switch(this.getpageRotation()){case 0:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 90:this.usepdfjs&&(a=p.bpagesizeupdated?i/r:i/s,p.curzoomfunction=1,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 180:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 270:this.usepdfjs&&(a=p.bpagesizeupdated?i/r:i/s,p.curzoomfunction=1,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;default:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2)}this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,s*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)),w(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,4))}},this.zoomheight=function(e){if(!this.usevector3Dxml){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,5)}var a=0;if(this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;switch(this.getpageRotation()){case 0:a=ai/i,a=si/i,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 90:p.bpagesizeupdated?(a=ai/s,a=si/s):(a=ai/i,a=si/i),p.curzoomfunction=2,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 180:a=ai/i,a=si/i,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 270:p.bpagesizeupdated?(a=ai/i,a=si/i):(a=ai/s,a=si/s),p.curzoomfunction=2,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2}}this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)),w(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,5))}},this.mtzoom_update=function(e,t,a){this.MainImageHeight,this.MainImageWidth;var i=Math.sqrt(Math.pow(this.MainImageHeight,2)+Math.pow(this.MainImageWidth,2)),s=Math.sqrt(Math.pow(ai,2)+Math.pow(ti,2)),r=t*i-s;if(this.dscale=(s+r+e)/i,this.usepdfjs){var n=p.offscreenheight,o=p.offscreenwidth;0!=p.getpageRotation()&&(o=p.originalPDFwidth,n=p.originalPDFheight);var l=Math.sqrt(Math.pow(n,2)+Math.pow(n,2));r=a*l-s,this.dscalepdf=(s+r+e)/l,p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)}this.usevector3Dxml||(this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,o*this.dscalepdf,n*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),w())},this.getRotatedPoint=function(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c},this.setpdfscaleNoOffset=function(e){p.checkFoxitMaxZoom(e)&&(this.dscalepdf=e)},this.setpdfscaleoffset=function(e,t,a){p.checkFoxitMaxZoom(e)&&(this.dscalepdf=e,this.dxpdf=t,this.dypdf=a)},this.zoom_update=function(e,t,a,i,s){if(!this.usevector3Dxml){var r=1/Hl(),n={x:e,y:t,w:a,h:i};n.x=n.x*r,n.y=n.y*r,n.w=n.w*r,n.h=n.h*r;var o=n;if(null!=Da&&null==s){var l={sx:e,sy:t,sWide:a,sHi:i,rect:p.getpagerect()};Da.zoomUpdate(l,2)}var c,h,d=1,u=0,g=0,f=0;c=si/2,h=ii/2,this.getpageRotation(),Math.PI;var m,y,v={x:m=o.x+o.w/2,y:y=o.y+o.h/2},x=e/this.dscalepdf,b=t/this.dscalepdf,k=(this.dscalepdf,this.dscalepdf,this.dscalepdf),D=this.dscalepdf;if(x=o.x/this.dscalepdf,b=o.y/this.dscalepdf,o.x,o.w,this.dscalepdf,o.y,o.h,this.dscalepdf,k=o.h/this.dscalepdf,D=o.w/this.dscalepdf,this.usepdfjs){var R=p.offscreenheight,P=p.offscreenwidth,S=p.getPDFcoords(0,0);switch(this.getpageRotation()){case 90:if(this.usepdfjs){if(g=m-h,f=y-c,b=this.dypdf+m-h,x=this.dxpdf-y+c,k>0&&D>0){var M=this.dscalepdf*ai/i,T=this.dscalepdf*ti/a;M=this.dscalepdf*si/n.h,T=this.dscalepdf*ii/n.w}u=(d=Math.min(M,T))/this.dscalepdf;var E=(ti-P*this.dscalepdf)/2,F=(ai-R*this.dscalepdf)/2;E=(ii-P*this.dscalepdf)/2,F=(si-R*this.dscalepdf)/2;this.dxpdf,this.dypdf,this.dscalepdf,this.dscalepdf;(ii-P*this.dscalepdf)/2,(si-R*this.dscalepdf)/2,Fn(m,y),S=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d)}break;case 270:this.usepdfjs&&(g=m-h,f=y-c,x=-(m-p.dxpdfnonrot)/this.dscalepdf,b=-(y-p.dypdfnonrot)/this.dscalepdf,k>0&&D>0&&(M=this.dscalepdf*ai/i,T=this.dscalepdf*ti/a,M=this.dscalepdf*si/n.h,T=this.dscalepdf*ii/n.w),u=(d=Math.min(M,T))/this.dscalepdf,p.bpagesizeupdated?(E=(ti-P*this.dscalepdf)/2,F=(ai-R*this.dscalepdf)/2,E=(ii-P*this.dscalepdf)/2,F=(si-R*this.dscalepdf)/2):(E=(ti-R*this.dscalepdf)/2,F=(ai-P*this.dscalepdf)/2,E=(ii-R*this.dscalepdf)/2,F=(si-P*this.dscalepdf)/2),E-this.dxpdf,F-this.dypdf,p.bpagesizeupdated?((ti-P*this.dscalepdf)/2,(ai-R*this.dscalepdf)/2,(ii-P*this.dscalepdf)/2,(si-R*this.dscalepdf)/2):((ti-R*this.dscalepdf)/2,(ai-P*this.dscalepdf)/2,(ii-R*this.dscalepdf)/2,(si-P*this.dscalepdf)/2),Fn(m,y),S=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d));break;case 180:this.usepdfjs?(g=m-h,f=y-c,b=this.dypdf+y-c,x=this.dxpdf+m-h,k>0&&D>0&&(M=this.dscalepdf*ai/i,T=this.dscalepdf*ti/a,M=this.dscalepdf*si/n.h,T=this.dscalepdf*ii/n.w),u=(d=Math.min(M,T))/this.dscalepdf,E=(ti-P*this.dscalepdf)/2,F=(ai-R*this.dscalepdf)/2,E=(ii-P*this.dscalepdf)/2,F=(si-R*this.dscalepdf)/2,E-this.dxpdf,F-this.dypdf,(ti-P*this.dscalepdf)/2,(ai-R*this.dscalepdf)/2,(ii-P*this.dscalepdf)/2,(si-R*this.dscalepdf)/2,Fn(m,y),S=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d)):(g=m-h,f=y-c,x=this.dypdf+f,b=this.dxpdf+g,this.dxpdf=x,this.dypdf=b,k>0&&D>0&&(M=this.dscalepdf*ai/i,T=this.dscalepdf*ti/a,M=this.dscalepdf*si/n.h,T=this.dscalepdf*ii/n.w),d=Math.min(M,T),this.usepdfjs&&(u=d/this.dscalepdf),this.ZoomIn(u,!1,!1));break;case 0:x=-(m-this.dxpdf)/this.dscalepdf,b=-(y-this.dypdf)/this.dscalepdf,k>0&&D>0&&(M=this.dscalepdf*ai/i,T=this.dscalepdf*ti/a,M=this.dscalepdf*si/o.h,T=this.dscalepdf*ii/o.w);var I=Math.min(M,T);this.dxpdf,this.dypdf,this.dxpdf,this.dypdf,S=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(I)}var j=C(p.getpageRotation(),p.foxitpageorigrot),A=p.getPDFDist(ti/2),O=p.getPDFDist(ai/2);switch(A=p.getPDFDist(ii/2),O=p.getPDFDist(si/2),j){case 0:S.x=S.x-A,S.y=S.y+O;break;case 90:S.x=S.x-O,S.y=S.y-A;break;case 180:S.x=S.x+A,S.y=S.y-O;break;case 270:S.x=S.x+O,S.y=S.y+A}}this.usepdfjs&&(0==p.getpageRotation()&&p.setpagedimsize(this.dxpdf,this.dypdf,P*this.dscalepdf,R*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoomToEx(p.dscalepdf,S)),w(),null!=Ca&&null==s&&(l={sx:e,sy:t,sWide:a,sHi:i,rect:p.getpagerect()},Ca.zoomUpdate(l,2))}},this.MarkupFindText=function(e){for(var t=[],a=0;a<p.DocRef.markuplist.length;a++)p.DocRef.markuplist[a].FindText(e)&&t.push(p.DocRef.markuplist[a]);return t},this.getMarkupPos=function(e){var t=e.hscaled,a=e.wscaled,i=e.xscaled,s=e.yscaled;switch(e.bisTextArrow&&null!=e.textBoxConnected&&(t=Math.max(e.hscaled,e.textBoxConnected.hscaled),a=Math.max(e.wscaled,e.textBoxConnected.wscaled),i=Math.min(e.xscaled,e.textBoxConnected.xscaled),s=Math.min(e.yscaled,e.textBoxConnected.yscaled)),e.pagenumber,this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:case 6:case 7:case 8:a-=i,t-=s;break;case 9:break;case 13:a-=i,t-=s}break;case 90:t=e.rotatedrect.h,a=e.rotatedrect.w;var r=i=e.rotatedrect.x;i=a,a=r,a-=i,t-=s=e.rotatedrect.y;break;case 180:t=e.rotatedrect.h,a=e.rotatedrect.w;var n=i=e.rotatedrect.x,o=s=e.rotatedrect.y;i=a,s=t,a=n,t=o,a-=i,t-=s;break;case 270:t=e.rotatedrect.h,a=e.rotatedrect.w,i=e.rotatedrect.x;var l=s=e.rotatedrect.y;s=t,t=l,a-=i,t-=s}return{x:i,y:s,w:a,h:t}},this.panToMarkup=function(e){e.selected||e.selectedit?e.drawmescaled(a):e.drawmescaled(n);var t=p.getMarkupPos(e);p.pan_update(0,0);var i=ai/2,s=ti/2,r=0,o=0,l=p.getpagerect(),c=t.x+.5*t.w,h=t.y+.5*t.h;if(0!=p.getpageRotation()){var d=p.getrotcoords(s,i,c,h,-p.getpageRotation());u=Math.max(d.x,ti)-Math.min(d.x,ti),(Math.max(d.x,ti)==d.x||u<300)&&(r=d.x-s),g=Math.max(d.y,ai)-Math.min(d.y,ai),(Math.max(d.y,ai)==d.y||g<100)&&(o=d.y-i),f=Math.max(d.x,0)-Math.min(d.x,0),(Math.min(d.x,0)==d.x||f<100)&&(r=-(s-d.x)),m=Math.max(d.y,0)-Math.min(d.y,0),(Math.min(d.y,0)==d.y||m<100)&&(o=-(i-d.y)),p.pan_update(r,o)}else{var u=Math.max(c,ti)-Math.min(c,ti);(Math.max(c,ti)==c||u<300)&&(r=c-s);var g=Math.max(h,ai)-Math.min(h,ai);(Math.max(h,ai)==h||g<100)&&(o=h-i);var f=Math.max(c,0)-Math.min(c,0);(Math.min(c,0)==c||f<100)&&(r=-(s-c));var m=Math.max(h,0)-Math.min(h,0);(Math.min(h,0)==h||m<100)&&(o=-(i-h)),l.w<=ti&&p.usepdfjs&&(r=0),p.pan_update(r,o)}},this.zoomToMarkup=function(e,t){this.zoomall();var a=e.hscaled,i=e.wscaled,s=e.xscaled,r=e.yscaled;switch(e.pagenumber,this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:i=Math.abs(i-s),a=Math.abs(a-r);break;case 6:case 7:0==(i=Math.abs(i-s))&&(i=1),0==(a=Math.abs(a-r))&&(a=1);break;case 8:i=Math.abs(i-s),a=Math.abs(a-r)}break;case 90:a=e.rotatedrect.h,i=e.rotatedrect.w;var n=s=e.rotatedrect.x;s=i,i=n,i-=s,a-=r=e.rotatedrect.y;break;case 180:a=e.rotatedrect.h,i=e.rotatedrect.w;var o=s=e.rotatedrect.x,l=r=e.rotatedrect.y;s=i,r=a,i=o,a=l,i-=s,a-=r;break;case 270:a=e.rotatedrect.h,i=e.rotatedrect.w,s=e.rotatedrect.x;var c=r=e.rotatedrect.y;r=a,a=c,i-=s,a-=r}t?(a+=t.h*a/100,i+=t.w*i/100,s-=t.x*i/100,r-=t.y*a/100):(a+=100,i+=50,s-=50,r-=50),this.zoom_update(s,r,i,a)},this.MarkupFind=function(e){for(var t=!1;this.CurrentMarkup<p.DocRef.nummarkups&&!t;){if(p.DocRef.markuplist[this.CurrentMarkup].FindText(e)){t=!0,this.zoomall();var a=p.DocRef.markuplist[this.CurrentMarkup].hscaled,i=p.DocRef.markuplist[this.CurrentMarkup].wscaled,s=p.DocRef.markuplist[this.CurrentMarkup].xscaled,r=p.DocRef.markuplist[this.CurrentMarkup].yscaled;switch(p.DocRef.markuplist[this.CurrentMarkup].pagenumber,this.getpageRotation()){case 0:switch(p.DocRef.markuplist[this.CurrentMarkup].type){case 0:case 1:case 2:case 6:case 7:case 8:i-=s,a-=r;break;case 9:r-=a}break;case 90:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w;var n=s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x;s=i,i=n,i-=s,a-=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;break;case 180:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w;var o=s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x,l=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;s=i,r=a,i=o,a=l,i-=s,a-=r;break;case 270:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w,s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x;var c=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;r=a,a=c,i-=s,a-=r}a+=100,i+=50,s-=50,r-=50,this.zoom_update(s,r,i,a)}this.CurrentMarkup++}this.CurrentMarkup=0},this.SetMarkupZoom=function(e,t,a){if(this.usevectorxml&&null!=p.VectorPageObj)p.vectorloaded?(this.dscalevector=a,this.dxvector=e,this.dyvector=t,p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),this.draw_vector(!1)):p.loadbinvectors();else if(this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;0!=p.getpageRotation()&&(s=p.originalPDFwidth,i=p.originalPDFheight),this.dscalepdf=a,this.dxpdf=e,this.dypdf=t,p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.pdfrenderopque+=1,p.pdfisrendered=!1,p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else this.dscale=a,this.dx=e,this.dy=t,this.checkimageswitch(),0==p.DocRef.Type&&p.DocRef.draw_mpage()},this.MarkupZoombyMarkup=function(e,t){this.zoomall();var a=3;this.dscale,e.scaling,this.usevectorxml?(this.dscalevector,e.scaling):this.usepdfjs?(this.dscalepdf,e.scaling):(this.dscale,e.scaling);var i=e.xscaled,s=e.wscaled,r=e.yscaled,n=e.hscaled;switch(this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),s-=i,n-=r;break;case 6:case 7:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),0==(n-=r)&&(n=1),0==(s-=i)&&(s=1);break;case 8:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),s-=i,n-=r;break;case 9:if(0==e.textrotate&&(i=e.rotatedrect.x,s=e.rotatedrect.w,r=e.rotatedrect.y,n=e.rotatedrect.h),e.textrotate/(Math.PI/180)==90){i=e.xscaled,r=e.yscaled;var o=s=e.wscaled;s=n=e.hscaled,n=o}e.textrotate/(Math.PI/180)==270&&(i=e.xscaled,r=e.yscaled,o=s=e.wscaled,i-=s=n=e.hscaled,r-=n=o),e.textrotate/(Math.PI/180)==180&&(i=e.xscaled,r=e.yscaled,i-=s=e.wscaled,r-=n=e.hscaled)}break;case 90:case 180:case 270:i=Math.min(e.rotatedrect.x,e.rotatedrect.w),s=Math.max(e.rotatedrect.x,e.rotatedrect.w),r=Math.min(e.rotatedrect.y,e.rotatedrect.h),n=Math.max(e.rotatedrect.y,e.rotatedrect.h),0==(n-=r)&&(n=1),0==(s-=i)&&(s=1)}this.zoom_update(i,r,s,n),t&&(a=t.h/50),this.ZoomOut(a,!1,!1)},this.MarkupZoom=function(){this.CurrentMarkup>p.DocRef.nummarkups-1&&(this.CurrentMarkup=0);for(var e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup>=p.DocRef.nummarkups-1;)this.CurrentMarkup++,e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;if(this.CurrentMarkup<=p.DocRef.nummarkups-1&&(this.MarkupZoombyMarkup(p.DocRef.markuplist[this.CurrentMarkup]),this.CurrentMarkup++,this.CurrentMarkup<=p.DocRef.nummarkups-1)){for(e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup<=p.DocRef.nummarkups-1&&(this.CurrentMarkup++,!(this.CurrentMarkup>=p.DocRef.nummarkups-1));)e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;this.CurrentMarkup>=p.DocRef.nummarkups-1&&(this.CurrentMarkup=0)}},this.resize=function(){if(!this.usevector3Dxml){if(p.bDorescaleonsizeChange){var e=ai/this.MainImageHeight,t=ti/this.MainImageWidth;this.dscale=Math.min(t,e),this.dx=(ti-this.MainImageWidth*this.dscale)/2,this.dy=(ai-this.MainImageHeight*this.dscale)/2}if(this.usepdfjs){var a=p.offscreenheight,i=p.offscreenwidth;0!=p.getpageRotation()&&(i=p.originalPDFwidth,a=p.originalPDFheight),this.dxpdf>1&&i*this.dscalepdf<ti&&this.pan_update_resize((ti-i*this.dscalepdf)/2-this.dxpdf,0)}this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),null!=p.DocRef.pages[p.DocRef.currentpage]&&p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&(ai>a&&a>i&&p.bDorescaleonsizeChange||ti>i&&a<i&&p.bDorescaleonsizeChange||p.DocRef.draw_mpagepdf(!1))),w()}},this.setpagepos_pan=function(e,t){var a=p.dxpdf-e,i=p.dypdf-t;switch(this.getpageRotation()){case 0:p.pan_update(a,i,!0);break;case 90:p.pan_update(-i,a,!0);break;case 180:p.pan_update(-a,-i,!0);break;case 270:p.pan_update(i,-a,!0)}},this.pan_page=function(e,t,a){p.pan_update(e,t,a)},this.pan_page_pos=function(e,t,a){p.pan_position(e,t,a)},this.pan_position=function(e,t,a){var i=p.getpagedim(),s=i.x-e,r=i.y-t;p.pan_update(s,r,!0)},this.getpagetestrect=function(e){var t={x1:e.startx,y1:e.starty,x2:e.endx,y2:e.endy},a={x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1};if(0!=p.getpageRotation())switch(t=En(e.startx,e.starty,e.endx,e.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}return a},this.getrotatedpagerect=function(e){var t={x1:this.startx,y1:this.starty,x2:this.endx,y2:this.endy},a=(this.pdfstartx,this.pdfstarty,this.pdfendx,this.pdfendy,{x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1,usepixelscale:!1});if(0!=p.getpageRotation())switch(t=En(this.startx,this.starty,this.endx,this.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}if(this.usepdfjs&&(a.usepixelscale=!0),e){var i=Hl();a.x*=i,a.y*=i,a.w*=i,a.h*=i}return a},this.getpagerectdirect=function(e){var t={x:this.startx,y:this.starty,w:this.endx,h:this.endy,usepixelscale:!1};if(e){var a=Hl();t.x*=a,t.y*=a,t.w*=a,t.h*=a}return this.usepdfjs&&(t.usepixelscale=!0),t},this.getpagerect=function(e){var t={x1:this.startx,y1:this.starty,x2:this.endx,y2:this.endy},a=(this.pdfstartx,this.pdfstarty,this.pdfendx,this.pdfendy,{x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1,usepixelscale:!1});if(0!=p.getpageRotation())switch(t=En(this.startx,this.starty,this.endx,this.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}if(this.usepdfjs&&(a.usepixelscale=!0),e){var i=Hl();a.x*=i,a.y*=i,a.w*=i,a.h*=i}return a},this.pan_update_resize=function(e,t){p.resizepan=!0,p.pan_update(e,t)},this.setPagePosBelow=function(e){0==p.getpageRotation()&&p.setPagePos(p.startx,e.starty+e.offscreenheight*e.dscalepdf+10)},this.setPagePosAbove=function(e){0==p.getpageRotation()&&p.setPagePos(p.startx,e.starty-p.offscreenheight*p.dscalepdf-10)},this.setPageBitmap=function(e){if(!e.error){p.pageRendering=!1;var t=new Uint8ClampedArray(e.buffer),a=new ImageData(t,e.width,e.height);p.dscalepdf=1,p.pagecanvas.width=e.width,p.pagecanvas.height=e.height,p.offscreenwidth=e.width,p.offscreenheight=e.height;var i=p.compositereference.getColors();switch(p.role){case 1:p.setcolor(a.data,i.bg);break;case 2:p.setcolor(a.data,i.fg)}p.pagectx.putImageData(a,0,0),p.pdfisrendered=!0,p.compositereference.draw_compare(!0)}},this.setpagerect=function(e,t,a,i,s=!1){if(p.startx=e,p.starty=t,p.endx=a+e,p.endy=i+t,s){const e=D();p.dxvector=p.startx,p.dyvector=p.starty;const t=a,s=i,r=Math.min(t/e.width,s/e.height);p.dscalevector!=r&&(p.dscalevector=r,p.vectorischanged=!0)}return{x:p.startx,y:p.starty,w:p.endx,h:p.endy}},this.setPagePos=function(e,t){switch(this.getpageRotation()){case 0:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 90:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e;break;case 180:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 270:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e}if(this.usevectorxml)null!=p.VectorPageObj&&(a=p.setpagerect(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector),p.movetextdivs(),i=Math.max(0,a.x),s=Math.min(ti,a.w),r=Math.max(ai,a.h),n=Math.min(0,a.y),i<s&&r>n?(p.visible=!0,p.DocRef.textselect&&(p.TextSelectArea.style.display=li),this.draw_vector(!1)):(p.visible=!1,p.DocRef.textselect&&(p.TextSelectArea.style.display="none")));else if(this.usepdfjs){this.dxpdf=e,this.dypdf=t;var a=p.setpagerect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf);0==this.getpageRotation()||180==this.getpageRotation()||90==this.getpageRotation()||this.getpageRotation(),p.PDFTextArea.style.left=a.x+"px",p.PDFTextArea.style.top=a.y+"px";var i=Math.max(0,a.x),s=Math.min(ti,a.w),r=Math.max(ai,a.h),n=Math.min(0,a.y);i<s&&r>n?(p.visible=!0,p.DocRef.textselect&&(p.PDFTextArea.style.display=li,p.PDFTextArea.style.zIndex="4")):(p.visible=!1,p.DocRef.textselect&&(p.PDFTextArea.style.display="none"))}else this.checkimageswitch(),this.draw_image(!0);w()},this.getcanvasdim=function(){return this.usepdfjs?{w:ii,h:si}:{w:ti,h:ai}},this.pan_update=function(e,t,i){if(!this.usevector3Dxml){this.dxpdf;var s=t,r=e,o=1/Hl(),l={x:e,y:t};l.x=l.x*o,l.y=l.y*o,s=l.y,r=l.x;var c=!1;switch(null!=p.DocRef.foxitdoc&&(p.DocRef.foxitdoc.onHBarGrip&&p.DocRef.foxitdoc.hBarOn||p.DocRef.foxitdoc.onVBarGrip&&p.DocRef.foxitdoc.vBarOn)?(c=!0,s=-t*p.DocRef.foxitdoc.scrollHeightfactor,r=-e*p.DocRef.foxitdoc.scrollWidthfactor,s=-l.y*p.DocRef.foxitdoc.scrollHeightfactor,r=-l.x*p.DocRef.foxitdoc.scrollWidthfactor):c=!1,this.getpageRotation()){case 0:c?(this.dx=this.dx-e,this.dy=this.dy-t,this.dxvector-=e,this.dyvector-=t,this.dxpdf-=r,this.dypdf-=s):(this.dx=this.dx-e,this.dy=this.dy-t,this.dxvector-=e,this.dyvector-=t,this.dxpdf-=l.x,this.dypdf-=l.y);break;case 90:c?(this.dx=this.dx-t,this.dy=this.dy+e,this.dxvector-=t,this.dyvector+=e,this.dxpdf-=s,this.dypdf+=r):(this.dx=this.dx-t,this.dy=this.dy+e,this.dxvector-=t,this.dyvector+=e,this.dxpdf-=l.y,this.dypdf+=l.x);break;case 180:c?(this.dx=this.dx+e,this.dy=this.dy+t,this.dxvector+=e,this.dyvector+=t,this.dxpdf+=r,this.dypdf+=s):(this.dx=this.dx+e,this.dy=this.dy+t,this.dxvector+=e,this.dyvector+=t,this.dxpdf+=l.x,this.dypdf+=l.y);break;case 270:c?(this.dx=this.dx+t,this.dy=this.dy-e,this.dxvector+=t,this.dyvector-=e,this.dxpdf+=s,this.dypdf-=r):(this.dx=this.dx+t,this.dy=this.dy-e,this.dxvector+=t,this.dyvector-=e,this.dxpdf+=l.y,this.dypdf-=l.x)}if(!this.usevectorxml&&this.usepdfjs){var h=p.offscreenheight,d=p.offscreenwidth;0!=p.getpageRotation()&&(d=p.originalPDFwidth,h=p.originalPDFheight),p.setpagedimsize(this.dxpdf,this.dypdf,d*this.dscalepdf,h*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px",d*this.dscalepdf<=ii&&0==this.getpageRotation()&&(p.dxpdf=(ii-d*this.dscalepdf)/2),null!=p.DocRef.pages[p.DocRef.currentpage]&&p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&(p.resizepan?(p.DocRef.draw_mpagepdf(!1),p.resizepan=!1):p.DocRef.draw_mpagepdf(!0));var u=Math.max(0,p.dxpdf),g=Math.min(ti,p.endx),f=Math.max(ai,p.endy),m=Math.min(0,p.dypdf);if(g=Math.min(ii,p.endx),f=Math.max(si,p.endy),u<g&&f>m?(p.visible=!0,p.DocRef.textselect&&(p.PDFTextArea.style.display=li,p.PDFTextArea.style.zIndex="4")):(p.visible=!1,p.DocRef.textselect&&(p.PDFTextArea.style.display="none")),null!=p.DocRef.foxitdoc){var y=p.getpagerect();!0===p.pagenumber&&(p.pagenumber=p.DocRef.currentpage);var v={mx:l.x,my:l.y},x={x:p.dxpdf,y:p.dypdf};p.getPDFCoordsRot(x),p.DocRef.foxitdoc.scrolldeltaupdate(v,p.pagenumber)}}p.DocRef.thumbnails[p.pagenumber]&&(p.usepdfjs?p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerectdirect()):p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerect())),null!=p.DocRef.foxitdoc||(Vl(n),Nl(a)),null!=wa&&null==i&&(y=p.getpagerect(),wa.panUpdate(e,t,y))}},this.rotateCanvas=function(){s.save();var e=ti/2,t=ai/2;s.translate(e,t),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-e,-t),s.fillStyle="rgb(238,243,250)",s.fillRect(0,0,ti,ai),s.restore(),w()},this.rotatepage=function(e){if(null!=p.DocRef.foxitdoc){var t=e;if(0!=p.foxitpageorigrot)switch(p.foxitpageorigrot){case 90:case 270:(t=e-90)<0&&(t+=360);break;case 180:(t=e+180)>=360&&(t-=360)}p.DocRef.foxitdoc.rotatePage(p.pagenumber,t,this.foxitonRotate),p.bpagesizeupdated=!1}var a=0;switch(this.getpageRotation()){case 0:if(90==e)for(a=0;a<=90;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=0;a<=180;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=0;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 90:if(0==e)for(a=90;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=90;a<=180;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=90;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 180:if(0==e)for(a=180;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=180;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(a=180;a>=90;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 270:if(0==e)for(a=270;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=270;a>=180;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(a=270;a>=90;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas()}if(!this.usevector3Dxml){if(!this.usevectorxml&&this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;0!=p.getpageRotation()&&(s=p.originalPDFwidth,i=p.originalPDFheight);var r=ai/2,n=ti/2;p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px";var o=n-p.startx,l=r-p.starty;p.PDFTextArea.style.transformOrigin=o+"px "+l+"px",p.PDFTextArea.style.transform="rotate("+this.getpageRotation()+"deg)",p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}null!=Fa&&Fa.onRotate(e,p.pagenumber),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()}},this.foxitonRotate=function(e,t){null!=Fa&&Fa.onRotate(e,t),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.rotateimage=function(e){var t=1==this.DocRef.pages.length;if(!this.usepdfjs||this.DocRef.pagelocked||!this.usepdfjs||t){if(null!=p.DocRef.foxitdoc){var a=e;if(0!=p.foxitpageorigrot)switch(p.foxitpageorigrot){case 90:case 270:(a=e-90)<0&&(a+=360);break;case 180:(a=e+180)>=360&&(a-=360)}p.DocRef.foxitdoc.rotatePage(p.pagenumber,a,this.foxitonRotate),p.bpagesizeupdated=!1}var i=0;switch(this.getpageRotation()){case 0:if(90==e)for(i=0;i<=90;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=0;i<=180;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=0;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 90:if(0==e)for(i=90;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=90;i<=180;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=90;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 180:if(0==e)for(i=180;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=180;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(i=180;i>=90;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 270:if(0==e)for(i=270;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=270;i>=180;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(i=270;i>=90;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas()}if(!this.usevector3Dxml){if(!this.usevectorxml&&this.usepdfjs){var s=p.offscreenheight,r=p.offscreenwidth;0!=p.getpageRotation()&&(r=p.originalPDFwidth,s=p.originalPDFheight);var n=ai/2,o=ti/2;p.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,s*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px";var l=o-p.startx,c=n-p.starty;p.PDFTextArea.style.transformOrigin=l+"px "+c+"px",p.PDFTextArea.style.transform="rotate("+this.getpageRotation()+"deg)",p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}null==p.DocRef.foxitdoc&&(null!=Fa&&Fa.onRotate(e,p.pagenumber),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye())}}else this.pagelockrotation=e},this.enableSnap=function(e){p.snapEnabled=e},this.getSnapState=function(){return p.snapEnabled},this.setViewMode=function(e){p.usevectorxml&&(p.VectorPageObj.ViewMode(e),p.draw_vector(!1),p.vectorischanged=!0,null!=Sa&&Sa.ViewModeChange(e))},this.getpixeldist=function(e){return p.usevectorxml?e*p.VectorPageObj.scale*p.dscalevector:e},this.renderSelectedBlocks=function(){},this.unselectallBlocks=function(){},this.getinsideHyperlink=function(e,t,a,i,s,r){var n=!1,o={x:e,y:t};if(null==p.VectorPageObj)return!1;0!=p.drotation&&(o=Fn(e,t)),e=o.x,t=o.y;for(var l=0;l<p.hyperlinks.length;l++)p.hyperlinks[l].insideHyperlink(e,t,a,i,s,p.VectorPageObj.x,p.VectorPageObj.y,p.VectorPageObj.h,p.pagenumber,r)&&(n=!0);return n},this.gethyperlink=function(e,t){var a=!1;return p.usevectorxml&&(a=p.getinsideHyperlink(e,t,p.dscalevector,p.dxvector,p.dyvector,!1)),a},this.gethyperlinkhover=function(e,t){var a=!1;return p.usevectorxml&&(a=p.getinsideHyperlink(e,t,p.dscalevector,p.dxvector,p.dyvector,!0)),a},this.getPDFcoordsPos=function(e,t,a,i,s){var r=e,n=t;return p.getpageRotation(),(r=(e-a)/(p.curpagescale*s))<0&&(r=0),(n=-((t-i)/(p.curpagescale*s)-p.pdfpageheight))<0&&(n=0),{x:r,y:n}},this.getPDFDist=function(e){return e/(p.curpagescale*p.dscalepdf)},this.getPDFDistScale=function(e,t){return e/(p.curpagescale*t)},this.returnFoxitpageCoords=function(e){console.log(e)},this.getFoxitpageCoords=function(e){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getPDFpagecoordinates(e,p.pagenumber,p.returnFoxitpageCoords)},this.getPDFCoordsRot=function(e){e.x,e.y,e.y,e.x,e.y,e.y;var t={x:e.x,y:e.y},a=(C(p.getpageRotation(),p.foxitpageorigrot),p.dxpdfzerorot),i=p.dypdfzerorot;return{x:(t.x-a)/(p.curpagescale*p.dscalepdf),y:-((t.y-i)/(p.curpagescale*p.dscalepdf)-p.pdfpageheight),mx:t.x,my:t.y}},this.getPDFcoords=function(e,t){var a=e,i=t,s=t,r=e,n=t,o=.5*p.originalPDFwidth,l=.5*p.originalPDFheight,c=p.originalPDFwidth-p.originalPDFheight,h=p.dxpdf,d=p.dypdf,u=p.dxpdfnonrot,g=p.dypdfnonrot;if(a=(e-h)/(p.curpagescale*p.dscalepdf),s=-((i=(t-d)/(p.curpagescale*p.dscalepdf))-p.pdfpageheight),90!=p.getpageRotation()&&270!=p.getpageRotation()||p.bpagesizeupdated&&(270==p.getpageRotation()||90==p.getpageRotation())&&(s=-(i-p.pdfpagewidth)),i=s,r=(e-u)/(p.curpagescale*p.dscalepdf),n=-((n=(t-g)/(p.curpagescale*p.dscalepdf))-p.pdfpageheight),270==p.foxitpageorigrot&&90==p.getpageRotation()&&(i=n,a=r),90==p.foxitpageorigrot&&270==p.getpageRotation()&&(i=n,a=r),0==p.getpageRotation())switch(p.foxitpageorigrot){case 270:var f=a-=o;a=i-=l,i=-f,a+=o,i+=l,a-=.5*c,i+=.5*c,f=r-=o,r=n=r-l,n=-f,r+=o,n+=l,r-=.5*c,n+=.5*c;break;case 90:f=a-=o,a=-(i-=l),i=f,a+=o,i+=l,a-=.5*c,i+=.5*c,f=r-=o,r=-(n=r-l),n=f,r+=o,n+=l,r-=.5*c,n+=.5*c;break;case 180:a=-(a-=o),i=-(i-=l),a+=o,i+=l,n=(r-=o)-l,r=-r,n=-n,r+=o,n+=l}return 0==p.foxitpagerot||p.getpageRotation(),{x:a,y:i,mx:e,my:t}},this.getPDFSnapPointArray=function(e,t){var a={x:e,y:t};e=a.x,t=a.y;var i=p.PDFSnapPoint,s={found:!1,x:0,y:0,type:1};if(null!=i){var r=e-i.x,n=t-i.y;Math.sqrt(r*r+n*n)<20&&(s=i)}return s},this.setPDFSnapPointArray=function(e){p.PDFSnapPoint=e},this.adjustpointpdfsnap=function(e){return 0==p.getpageRotation()?(e.x=e.x+p.dxpdf,e.y=e.y+p.dypdf):(p.getpageRotation(),e.x=e.x+p.dxpdfnonrot,e.y=e.y+p.dypdfnonrot),e},this.foxitsnapCallback=function(e){e.found&&(e=p.adjustpointpdfsnap(e)),p.setPDFSnapPointArray(e),p.pdfsnapready=!0},this.getPDFsnapPoint=function(e,t){var a={found:!1,change:!1,x:0,y:0,type:1},i={x:e,y:t};if(null!=p.DocRef.foxitdoc&&Fi&&p.pdfsnapready){p.DocRef.foxitdoc.pdfViewer.getCurrentPDFDoc().getPageByIndex(p.pagenumber);var s=p.getpageRotation();if(90==s||270==s||180==s)p.DocRef.foxitdoc.getSnapPointRotate(p.pagenumber,i.x,i.y,p.foxitsnapCallback);else{var r=p.getPDFCoordsRot(i);p.DocRef.foxitdoc.getSnapPoint(p.pagenumber,r.x,r.y,p.foxitsnapCallback)}return p.pdfsnapready=!1,p.getPDFSnapPointArray(i.x,i.y)}var n=[];if(null==p.PDFPointArray)return a;p.PDFinternalScale.x>0?(p.pdfSnapScale,p.PDFinternalScale.x):p.pdfSnapScale,p.PDFinternalScale.y>0?(p.pdfSnapScale,p.PDFinternalScale.y):p.pdfSnapScale;for(var o=p.offscreenheight*p.dscalepdf,l=p.offscreenwidth*p.dscalepdf,c=0;c<p.PDFPointArray.length;c++){if(0!=p.PDFpageRotate)if(90==p.PDFpageRotate)var h=p.starty+-p.PDFPointArray[c].y*p.pdfSnapScale,d=p.startx+p.PDFPointArray[c].x*p.pdfSnapScale;else h=p.starty+(-p.PDFPointArray[c].y*p.pdfSnapScale+o),d=p.startx+p.PDFPointArray[c].x*p.pdfSnapScale+l;else h=p.PDFPointArray[c].y<0?p.starty+-p.PDFPointArray[c].y*p.pdfSnapScale:p.starty+(-p.PDFPointArray[c].y*p.pdfSnapScale+o),d=p.PDFPointArray[c].x<0?p.startx+p.PDFPointArray[c].x*p.pdfSnapScale+l:p.startx+p.PDFPointArray[c].x*p.pdfSnapScale;var u=e-d,g=t-h,f=Math.sqrt(u*u+g*g);f<10&&n.push({x:d,y:h})}if(n.length>0){u=e-n[0].x,g=t-n[0].y;var m=Math.sqrt(u*u+g*g);f=Math.sqrt(u*u+g*g);var y=0;for(c=0;c<n.length;c++)u=e-n[c].x,g=t-n[c].y,(f=Math.sqrt(u*u+g*g))<m&&(m=f,y=c);a={found:!0,x:n[y].x,y:n[y].y,type:1}}else a={found:!1,change:!1,x:0,y:0,type:1};return a},this.getsnap=function(e){if(p.usepdfjs&&p.snapEnabled){var t=p.getPDFsnapPoint(e.xus,e.yus),a=Hl();return t.x*=a,t.y*=a,t}return{found:!1,change:!1,x:0,y:0}},this.magnifyoff=function(){p.usevector3Dxml||(p.usevectorxml?p.draw_vector(!0):p.usepdfjs?p.DocRef.draw_mpagepdf(!1):0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0))},this.drawmarkupcliprect=function(e,t){if(0==p.getpageRotation())var a=e.x,i=e.y;else{var s=In({x:e.x+.5*e.w,y:e.y+.5*e.h},ti/2,ai/2,360-p.getpageRotation());a=s.x-.5*e.w,i=s.y-.5*e.h}if(p.usevectorxml)var r=p.dscalevector,n=-a+p.dxvector,o=-i+p.dyvector;else if(p.usepdfjs)r=p.dscalepdf*p.curpagescale,n=-a+p.dxpdf,o=-i+p.dypdf;else{switch(p.currentimage){case 0:r=p.dscale,n=-a+p.dx,o=-i+p.dy;break;case 1:r=p.dscale/p.bitmapratio,n=-a+p.dx,o=-i+p.dy}r=p.dscale}Il(t,p.pagenumber,n,o,r,p.getpageRotation())},this.drawmagnify=function(e,t,a){if(!p.usevector3Dxml){if(0==p.getpageRotation())var i=e.x-Se.width/2/a,s=e.y-Se.height/2/a;else{var r=In(e,ti/2,ai/2,360-p.getpageRotation());i=r.x-Se.width/2/a,s=r.y-Se.height/2/a}t.fillStyle=p.DocRef.backgroundColor,t.fillRect(0,0,Se.width,Se.height);var n=Se.width/2,o=Se.height/2;if(p.usevectorxml){var l=p.dscalevector*a,c=-i+p.dxvector,h=-s+p.dyvector;c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),p.VectorPageObj.drawallmagnify(t,l,c,h)}else if(p.usepdfjs)l=p.dscalepdf*p.curpagescale*a,p.magnifycanvas.width,p.magnifyrestscale,p.magnifycanvas.height,p.magnifyrestscale,c=-i+p.dxpdf,h=-s+p.dypdf,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.magnifycanvas,c,h);else{switch(p.currentimage){case 0:l=p.dscale*a,c=-i+p.dx,h=-s+p.dy,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.largeimagecnv,c,h,p.MainImageWidth*l,p.MainImageHeight*l);break;case 1:l=p.dscale/p.bitmapratio*a,c=-i+p.dx,h=-s+p.dy,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.smallimagecnv,c,h,p.SmallImageWidth*l,p.SmallImageHeight*l)}l=p.dscale*a}0==p.getpageRotation()?Il(t,p.pagenumber,c,h,l,p.getpageRotation()):(Il(t,p.pagenumber,c,h,l,p.getpageRotation()),t.restore())}},this.removevisibleTile=function(e,t){for(var a=0;a<p.visibleTiles.length;a++)p.visibleTiles[a].r==e&&p.visibleTiles[a].c==t&&p.visibleTiles.splice(a,1)},this.addvisibleTile=function(e,t){p.visibleTiles=[],p.visibleTiles.push({row:e,column:t})},this.draw_tiled_cavas=function(e,t,a,i){if(0!=p.canvtileArray.length&&null!=p.canvtileArray[0][0]&&null!=p.canvtileArray[0][0].cnv){var s=p.canvtileArray[0][0].cnv.width,r=p.canvtileArray[0][0].cnv.height,n=t,o=a,l=0,c=0;p.tilevisibiltychanged=!1;for(var h=0;h<p.canvtileArray.length;h++){for(var d=0;d<p.canvtileArray[h].length;d++){s=p.canvtileArray[h][d].cnv.width,r=p.canvtileArray[h][d].cnv.height,l=p.canvtileArray[h][d].xoffset,c=p.canvtileArray[h][d].yoffset;var u=0!=p.canvtileArray[h][d].cnv.width,g=0!=p.canvtileArray[h][d].cnv.height;n<ti&&o<ai&&n+s*i>0&&o+r*i>0?(u&&g&&e.drawImage(p.canvtileArray[h][d].cnv,n,o,s*i,r*i),p.canvtileArray[h][d].visible||(p.tilevisibiltychanged=!0),p.canvtileArray[h][d].visible=!0,p.tilespending&&(p.tilespending=!1),p.prioritytilespending&&(p.prioritytilespending=!1)):(p.canvtileArray[h][d].visible&&(p.tilevisibiltychanged=!0),p.canvtileArray[h][d].visible=!1),n+=l*i}o+=c*i,n=t}}},this.draw_foxit_annots=function(e,t,a,i){for(var s=t,r=a,n=0;n<p.annotArray.length;n++){p.annotArray[n].cnv.width,p.annotArray[n].cnv.height;var o=p.annotArray[n].pos.left*i,l=p.annotArray[n].pos.top*i;o+=s,l+=r,e.drawImage(p.annotArray[n].cnv,o,l,p.annotArray[n].pos.width*i*p.annotArray[n].pos.scale,p.annotArray[n].pos.height*i*p.annotArray[n].pos.scale)}},this.removesamerects=function(e){for(var t=[],a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)e[a][i].match.pageIndex==p.pagenumber&&(e[a][i].match.rectArray[0],i&&t.push({outer:a,inner:i}),e[a][i].match.rectArray[0]);return t},this.getpagerectdim=function(e){for(var t=[],a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)if(e[a][i].match.pageIndex==p.pagenumber){var s=e[a][i].match.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,r=(p.pdfpageheight-e[a][i].match.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,n=e[a][i].match.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-s,o=(p.pdfpageheight-e[a][i].match.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-r;t.push({x:s,y:r,w:n,h:o,pagenum:e[a][i].match.pageIndex,pageheight:p.pdfpageheight})}return t},this.drawsearchRect=function(){var e=Hl();if(p.DocRef.foxitsearchobj.page==p.pagenumber&&p.DocRef.foxitsearchobj.active){n.save();var t=p.DocRef.foxitsearchobj.getcurmatch();if(!t)return;var a=t.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,i=(p.pdfpageheight-t.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,s=t.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-a,r=(p.pdfpageheight-t.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-i;a*=e,i*=e,s*=e,r*=e,n.clearRect(a,i,s,r),n.fillStyle="rgba(238, 238, 0, 0.3)",n.fillRect(a,i,s,r),n.restore()}},this.drawsearchRects=function(e){const t=p.DocRef.currentpage;p.DocRef.pages[t];var a=Hl();n.save();for(var i=0;i<e.length;i++)for(var s=0;s<e[i].length;s++)if(e[i][s].match.pageIndex==t){const t=e[i][s].match;var r=t.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,o=(p.pdfpageheight-t.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,l=t.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-r,c=(p.pdfpageheight-t.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-o;r*=a,o*=a,l*=a,c*=a,e[i][s]==p.DocRef.foxitsearchobj.orangeItem?n.fillStyle="rgba(255, 165, 0, 0.3)":n.fillStyle="rgba(238, 238, 0, 0.3)",n.fillRect(r,o,l,c)}n.restore()},this.draw_canvas_compare=function(e,t,a,i){var s=p.pagecanvas.width,r=p.pagecanvas.height,n=t,o=a;e.drawImage(p.pagecanvas,n,o,s*p.dscalepdf,r*p.dscalepdf)},this.draw_canvas=function(e){if(p.backupScaleAndOffset(),!p.DocRef.bSopenSilent&&p.DocRef.bActive){e&&(s.fillStyle=xs,s.fillRect(0,0,ti,ai));var t=ti/2,a=ai/2;gi=!0;var i=1==this.DocRef.pages.length;if(this.DocRef.pagelocked||i)var r=this.getpageRotation();else r=0;if(!Ni){if(!p.pdfdiminitset)return p.DocRef.pages[p.pagenumber-1]&&p.DocRef.pages[p.pagenumber-1].endy,s.fillStyle="rgb(255,255,255)",void s.fillRect(p.DocRef.pages[0].dxpdf,0,p.DocRef.pages[0].offscreenwidth*p.DocRef.pages[0].dscalepdf,p.DocRef.pages[0].offscreenheight*p.DocRef.pages[0].dscalepdf);if(0==r){if(p.iscollapsed||!p.pdfisfirstrendered)if(!p.pdfisfirstrendered&&zi){if(s.fillStyle="rgb(255,255,255)",p.pdfisfirstrendered)n=this.dscalepdf;else var n=1;s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*n,p.offscreenheight*n)}else s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf);else s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf),p.draw_tiled_cavas(s,this.dxpdf,this.dypdf,this.dscalepdf),p.draw_foxit_annots(s,this.dxpdf,this.dypdf,this.dscalepdf);p.drawtextSearchRect&&p.drawsearchRect()}else s.save(),s.translate(t,a),s.rotate(r*(Math.PI/180)),s.translate(-t,-a),p.pdfisrendered&&!p.iscollapsed?(s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf),p.draw_tiled_cavas(s,this.dxpdf,this.dypdf,this.dscalepdf),p.draw_foxit_annots(s,this.dxpdf,this.dypdf,this.dscalepdf)):(s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf)),s.restore()}}},this.transparent=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]&&(e[t+3]=100)},this.setcolor=function(e,t){for(var a=Nn(t),i=0;i<e.length;i+=4)255==e[i]&&255==e[i+1]&&255==e[i+2]||254==e[i]&&254==e[i+1]&&254==e[i+2]?e[i+3]=100:(e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b)},this.setred=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]?e[t+3]=100:(e[t]=255,e[t+1]=128,e[t+2]=0)},this.setblue=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]||(e[t]=0,e[t+1]=0,e[t+2]=255)},this.setinvert=function(e){for(var t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]},this.invertpdfmagnify=function(e){try{var t=p.magnifypagectx.getImageData(0,0,p.magnifycanvas.width,p.magnifycanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.magnifycanvas.width,p.magnifycanvas.height),e=-1}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}-1!=e&&p.magnifypagectx.putImageData(t,0,0)},this.invertpdfprint=function(e){switch(e){case 1:try{var t=p.compositePrintreference.bgpagectx.getImageData(0,0,p.compositePrintreference.bgpagecanvas.width,p.compositePrintreference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositePrintreference.bgpagecanvas.width,p.compositePrintreference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositePrintreference.ovpagectx.getImageData(0,0,p.compositePrintreference.ovpagecanvas.width,p.compositePrintreference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositePrintreference.ovpagecanvas.width,p.compositePrintreference.ovpagecanvas.height),e=-1}}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:p.compositePrintreference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositePrintreference.ovpagectx.putImageData(t,0,0)}},this.transparentpdf=function(e){switch(e){case 1:try{var t=p.compositereference.bgpagectx.getImageData(0,0,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositereference.ovpagectx.getImageData(0,0,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height),e=-1}}switch(e){case 0:p.setinvert(t.data);break;case 1:case 2:p.transparent(t.data)}if(-1!=e)switch(e){case 1:p.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositereference.ovpagectx.putImageData(t,0,0)}},this.invertpdf=function(e){switch(e){case 1:try{var t=p.compositereference.bgpagectx.getImageData(0,0,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositereference.ovpagectx.getImageData(0,0,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height),e=-1}}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:p.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositereference.ovpagectx.putImageData(t,0,0)}}}}class Sc{constructor(i,r,o,l,c,h){var p=this,u=$;he&&(u=fe),this.DocRef=h,this.pagenumber=c,this.firstpage=o,this.camera=null,this.navcamera=null,this.birdseyemarker=null,this.bis3Dnavigator=!1,this.navfloorplan=null,this.camerapos=new THREE.Vector3(0,0,0),this.camerarot=new THREE.Euler(0,1,1.57,"XYZ"),this.boxcenter=new THREE.Vector3(0,0,0),this.birdseyedispeye={x:0,y:0,r:0,scale:1,boxcenter:null,camerapos:null,rotation:0},this.walkthroughcontrol={},this.currentimage=1,this.dx=0,this.dy=0,this.dscale=1,this.initialscale=1,this.scaleObject=new Tc,this.invalid=!1,this.dxvector=0,this.dyvector=0,this.dxpdf=0,this.dypdf=0,this.dxpdfnonrot=0,this.dypdfnonrot=0,this.dxpdfrot=0,this.dypdfrot=0,this.dxpdfzerorot=0,this.dypdfzerorot=0,this.pdfstartx=0,this.pdfstarty=0,this.pdfendx=0,this.pdfendy=0,this.foxitdx=0,this.foxitdy=0,this.dscalepdf=1,this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.curpagescale=1,this.curfoxitpagescale=1,this.foxitpagerot=0,this.foxitpageorigrot=0,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.originalPDFwidth=0,this.originalPDFheight=0,this.bpagesizeupdated=!1,this.curzoomfunction=0,this.role=0,this.bgpagewidth=0,this.bgpageheight=0,this.ovpageheight=0,this.ovpagewidth=0,this.overlayScale=1,this.overlayOffsetX=0,this.overlayOffsetY=0,this.backgroundScale=1,this.backgroundOffsetX=0,this.backgroundOffsetY=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.iscollapsed=!0,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=_i,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.PDFSnapArray=[],this.PDFSnapPoint=void 0,this.pdfsnapready=!0,this.textselectobj={rectarray:void 0,start:-1,end:-1,bstart:!1,bend:!1,startpos:null,endpos:null,$handler:null,complete:!1},this.StoreyMetadata=[],this.visibleTiles=[],this.tilevisibiltychanged=!1,this.PDFsnapTransform=null,this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.dscalevector=1,this.fixedScale=1,this.vectorisrendered=!1,this.vectorischanged=!1,this.vectorstartrender=-1,this.vectorendrender=-1,this.vectorpagetime=-1,this.vectortimervar=null,this.bDorescaleonsizeChange=Vi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.usedincomposite=!1,this.compositereference=void 0,this.compositePrintreference=void 0,this.isbackground=!1,this.isoverlay=!1,this.dxextent=0,this.dyextent=0,this.startx=0,this.starty=0,this.endx=0,this.endy=0,this.dscaleextent=1,this.bitmapratio=1,this.pagedimset=!1,this.dxprint=0,this.dyprint=0,this.dscaleprint=1,this.dxthumb=0,this.dythumb=0,this.dxthumbtemp=0,this.dythumbtemp=0,this.dscalethumb=1,this.pdftempthumbscale=1,this.drotation=0,this.pagelockrotation=0,this.textsearchindx=0,this.usevectorxml=!1,this.usevectorbinary=!1,this.usevectorbinarycompare=!1,this.loadbackgroundvectors=!1,this.loadoverlayvectors=!1,this.usepdfjs=!1,this.drawtextSearchRect=!1,this.usevector3Dxml=!1,this.usevector3Dbinary=!1,this.usevector3DGLTF=!1,this.has3Dnav=!1,this.pageloaded=!1,this.markuplistloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.VectorPageObj=void 0,this.Vector3DPageObj=void 0,this.VectorPartfilelist=[],this.VectorBPartfilelist=[],this.largeimage=document.createElement("img"),this.smallimage=document.createElement("img"),this.smallimageloaded=!1,this.largeimageloaded=!1,this.vectorloaded=!1,this.rendercallback=!1,this.thumbnnailloaded=!1,this.CurrentMarkup=0,this.LayoutName=r;var g=null;if("ComparePage"==i)p.compositereference=h,p.usedincomposite=!0,p.PageName=r,"overlay"==p.PageName?(p.role=2,p.DocRef=p.compositereference.pages[1].DocRef):"background"==p.PageName&&(p.role=1,p.DocRef=p.compositereference.pages[0].DocRef),p.usedincomposite=!0,p.PageName=r;else{null!=i.getElementsByTagName("PageName")[0]?this.PageName=i.getElementsByTagName("PageName")[0].firstChild.nodeValue:this.PageName=r,null!=i.getElementsByTagName("Compression")[0]&&(this.Compression=i.getElementsByTagName("Compression")[0].firstChild.nodeValue),null!=i.getElementsByTagName("DPI")[0]&&(this.DPI=i.getElementsByTagName("DPI")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetX")[0]&&(this.OffsetX=i.getElementsByTagName("OffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetY")[0]&&(this.OffsetY=i.getElementsByTagName("OffsetY")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OriginalScale")[0]&&(this.OriginalScale=i.getElementsByTagName("OriginalScale")[0].firstChild.nodeValue),null!=i.getElementsByTagName("VectorBinary2DSRC")[0]&&(this.Vector2DBinarySRC=encodeURI(u+i.getElementsByTagName("VectorBinary2DSRC")[0].firstChild.nodeValue),this.usevectorbinary=!0),null!=i.getElementsByTagName("OverlayComparemode")[0]&&(p.OverlayComparemode=parseInt(i.getElementsByTagName("OverlayComparemode")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("BckGrndDocindex")[0]&&(p.comparebgdocindex=parseInt(i.getElementsByTagName("BckGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("BckGrndPageindex")[0]&&(p.comparebgpageindex=parseInt(i.getElementsByTagName("BckGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("FrGrndDocindex")[0]&&(p.comparefgdocindex=parseInt(i.getElementsByTagName("FrGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("FrGrndPageindex")[0]&&(p.comparefgpageindex=parseInt(i.getElementsByTagName("FrGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0]&&(this.Vector2DBinarySRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!0),null!=i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0]&&(this.Vector2DBinarySRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadoverlayvectors=!0),null!=i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0]&&(this.Vector2DImageSRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!1,p.loadbackgroundimage=!0,null!=i.getElementsByTagName("MainImageWidthBckGrnd")[0]&&(p.MainImageWidthBckGrnd=parseInt(i.getElementsByTagName("MainImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightBckGrnd")[0]&&(p.MainImageHeightBckGrnd=parseInt(i.getElementsByTagName("MainImageHeightBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingBckGrnd")[0]&&(p.MainImageScalingBckGrnd=parseInt(i.getElementsByTagName("MainImageScalingBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXBckGrnd")[0]&&(p.MainImageOffsetXBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYBckGrnd")[0]&&(p.MainImageOffsetYBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthBckGrnd")[0]&&(p.SmallImageWidthBckGrnd=parseInt(i.getElementsByTagName("SmallImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightBckGrnd")[0]&&(p.SmallImageHeightBckGrnd=parseInt(i.getElementsByTagName("SmallImageHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0]&&(this.Vector2DImageSRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0].firstChild.nodeValue),p.usevectorbinarycompare=!0,p.loadoverlayvectors=!1,p.loadoverlayimage=!0,null!=i.getElementsByTagName("MainImageWidthFrGrnd")[0]&&(p.MainImageWidthFrGrnd=parseInt(i.getElementsByTagName("MainImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightFrGrnd")[0]&&(p.MainImageHeightFrGrnd=parseInt(i.getElementsByTagName("MainImageHeightFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingFrGrnd")[0]&&(p.MainImageScalingFrGrnd=parseFloat(i.getElementsByTagName("MainImageScalingFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXFrGrnd")[0]&&(p.MainImageOffsetXFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYFrGrnd")[0]&&(p.MainImageOffsetYFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthFrGrnd")[0]&&(p.SmallImageWidthFrGrnd=parseInt(i.getElementsByTagName("SmallImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightFrGrnd")[0]&&(p.SmallImageHeightFrGrnd=parseInt(i.getElementsByTagName("SmallImageHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFBckGrnd")[0]&&(p.usevectorbinarycompare=!0,p.loadbackgroundvectors=!1,p.loadbackgroundpdf=!0,null!=i.getElementsByTagName("PDFWidthBckGrnd")[0]&&(p.PDFWidthBckGrnd=parseInt(i.getElementsByTagName("PDFWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightBckGrnd")[0]&&(p.PDFHeightBckGrnd=parseInt(i.getElementsByTagName("PDFHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFFrGrnd")[0]&&(p.usevectorbinarycompare=!0,p.loadoverlayvectors=!1,p.loadoverlaypdf=!0,null!=i.getElementsByTagName("PDFWidthFrGrnd")[0]&&(p.PDFWidthFrGrnd=parseInt(i.getElementsByTagName("PDFWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightFrGrnd")[0]&&(p.PDFHeightFrGrnd=parseInt(i.getElementsByTagName("PDFHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DSRC")[0]&&(this.Vector2DSRC=encodeURI(u+i.getElementsByTagName("Vector2DSRC")[0].firstChild.nodeValue),this.usevectorbinary||(this.usevectorxml=!0));var f=!1;if(this.DocRef.PublisherVersion){var m=this.DocRef.PublisherVersion.split(".");parseInt(m[3].trim())>129&&(f=!0)}else f=!1;if(null!=i.getElementsByTagName("VectorBinary3DSRC")[0]&&(this.Vector3DBinarySRC=encodeURI(u+i.getElementsByTagName("VectorBinary3DSRC")[0].firstChild.nodeValue),this.usevector3Dbinary=!0,null!=i.getElementsByTagName("Navigator3DSRC")[0]&&(this.Navigator3DSRC=encodeURI(u+i.getElementsByTagName("Navigator3DSRC")[0].firstChild.nodeValue),this.has3Dnav=!0)),null!=i.getElementsByTagName("VectorGLTF3DSRC")[0]){if(null!=i.getElementsByTagName("VectorMetadataSRC")[0]&&(this.Vector3DBinarySRC=encodeURI(u+i.getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue)),this.VectorMetadataSRC=encodeURI(u+i.getElementsByTagName("VectorMetadataSRC")[0].firstChild.nodeValue),this.usevector3DGLTF=!0,this.usevector3Dxml=!0,this.usevector3Dbinary=!1,this.floorplans=[],null!=i.getElementsByTagName("Floorplan")[0]){var y=i.getElementsByTagName("Floorplan");for(A=0;A<y.length;A++){var v=y[A].getElementsByTagName("SRC")[0].firstChild.nodeValue,x="";null!=y[A].getElementsByTagName("Name")[0]&&null!=y[A].getElementsByTagName("Name")[0].firstChild.nodeValue&&(x=y[A].getElementsByTagName("Name")[0].firstChild.nodeValue),v=u+v;var b=parseFloat(y[A].getElementsByTagName("Elevation")[0].firstChild.nodeValue),w=parseFloat(y[A].getElementsByTagName("Scale")[0].firstChild.nodeValue),k=document.createElement("canvas"),D=k.getContext("2d"),C=document.createElement("canvas"),R=C.getContext("2d"),P=document.createElement("img");this.floorplans.push({index:A,SRC:v,Elevation:b,Name:x,Scale:w,BScale:w,RScale:w,replaceScale:1,image:P,canvas:k,ctx:D,thumbcanvas:C,thumbctx:R,thumbwidht:as,thumbheight:is,replaced:!1,originalWidth:0,originalHeight:0,width:0,height:0,offsetX:0,offsetY:0,alignarray:[]})}this.floorplans.sort((function(e,t){return e.Elevation-t.Elevation}))}if(null!=i.getElementsByTagName("Storey")[0])for(var S=i.getElementsByTagName("Storey"),M=0;M<S.length;M++)if(null!=S[M].getElementsByTagName("IDSRC")[0]){var T=encodeURI(u+S[M].getElementsByTagName("IDSRC")[0].firstChild.nodeValue);if(null!=S[M].getElementsByTagName("Name")[0])var E=S[M].getElementsByTagName("Name")[0].firstChild.nodeValue;if(null!=S[M].getElementsByTagName("GlobalID")[0])var F=S[M].getElementsByTagName("GlobalID")[0].firstChild.nodeValue;if(null!=S[M].getElementsByTagName("Elevation")[0])var I=S[M].getElementsByTagName("Elevation")[0].firstChild.nodeValue;E&&F&&this.StoreyMetadata.push({src:T,name:E,id:F,index:M,Elevation:I})}null!=i.getElementsByTagName("NavigatorJSONSRC")[0]&&(this.NavigatorJSONSRC=encodeURI(u+i.getElementsByTagName("NavigatorJSONSRC")[0].firstChild.nodeValue),this.has3Dnav=!0),null!=i.getElementsByTagName("Navigator3DSRC")[0]&&(this.Navigator3DSRC=encodeURI(u+i.getElementsByTagName("Navigator3DSRC")[0].firstChild.nodeValue),this.has3Dnav=!0)}if(null!=i.getElementsByTagName("Vector3DSRC")[0]&&(this.Vector3DSRC=encodeURI(u+i.getElementsByTagName("Vector3DSRC")[0].firstChild.nodeValue),this.usevector3Dbinary||(this.usevector3Dxml=!0),null!=i.getElementsByTagName("Parts3D")[0]))for(var j=i.getElementsByTagName("SRC"),A=0;A<j.length;A++)this.VectorPartfilelist[A]=encodeURI(u+j[A].firstChild.nodeValue)}"3"!=p.DocRef.Type&&"7"!=p.DocRef.Type||(this.TextSelectArea=document.createElement("div"),this.TextSelectArea.className="textLayer",this.TextSelectArea.addEventListener("wheel",tu,!0),this.TextSelectArea.style.display="none"),"Adobe PDF"==p.DocRef.Format.substring(0,9)?(this.bautoloadthumbnails=!1,this.tilespending=!1,this.prioritytilespending=!1,this.pagecanvas=document.createElement("canvas"),this.pagectx=this.pagecanvas.getContext("2d"),this.canvtileArray=[],this.bgCanvtileArray=[],this.tempfoxitpage={canvases:[],imagedim:{width:0,height:0},havecanvases:!1},this.busetempcanvases=!1,this.annotArray=[],this.usepdfjs=!0,this.magnifycanvas=document.createElement("canvas"),this.magnifypagectx=this.magnifycanvas.getContext("2d"),this.pageRendering=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=1,this.PDFTextArea=document.createElement("div"),this.PDFTextArea.style.zIndex="4",this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",tu,!0),this.pdfpagetime=10,this.viewport=null,this.magviewport=null,this.compareviewport=null):"ComparePage"==i||(null!=i.getElementsByTagName("MainImageSRC")[0]&&(this.MainImageSRC=encodeURI(u+i.getElementsByTagName("MainImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageSRC")[0]&&(this.SmallImageSRC=encodeURI(u+i.getElementsByTagName("SmallImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidth")[0]&&(this.SmallImageWidth=i.getElementsByTagName("SmallImageWidth")[0].firstChild.nodeValue,this.SmallImageWidth=parseInt(this.SmallImageWidth)),null!=i.getElementsByTagName("SmallImageHeight")[0]&&(this.SmallImageHeight=i.getElementsByTagName("SmallImageHeight")[0].firstChild.nodeValue,this.SmallImageHeight=parseInt(this.SmallImageHeight)),null!=i.getElementsByTagName("SmallImageScaling")[0]&&(this.SmallImageScaling=i.getElementsByTagName("SmallImageScaling")[0].firstChild.nodeValue,this.SmallImageScaling=parseFloat(this.SmallImageScaling))),"ComparePage"==i||(null!=i.getElementsByTagName("ThumbnailImageSRC")[0]&&null!=i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild&&(this.ThumbnailImageSRC=u+i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageWidth")[0]&&(this.MainImageWidth=i.getElementsByTagName("MainImageWidth")[0].firstChild.nodeValue,this.MainImageWidth=parseInt(this.MainImageWidth)),null!=i.getElementsByTagName("MainImageHeight")[0]&&(this.MainImageHeight=i.getElementsByTagName("MainImageHeight")[0].firstChild.nodeValue,this.MainImageHeight=parseInt(this.MainImageHeight)),null!=i.getElementsByTagName("MainImageScaling")[0]&&(this.MainImageScaling=i.getElementsByTagName("MainImageScaling")[0].firstChild.nodeValue,this.MainImageScaling=parseFloat(this.MainImageScaling)),null!=i.getElementsByTagName("MainImageOffsetX")[0]&&(this.MainImageOffsetX=i.getElementsByTagName("MainImageOffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageOffsetY")[0]&&(this.MainImageOffsetY=i.getElementsByTagName("MainImageOffsetY")[0].firstChild.nodeValue)),this.largeimagecnv=document.createElement("canvas"),this.largeimagectx=this.largeimagecnv.getContext("2d",{willReadFrequently:!0}),this.smallimagecnv=document.createElement("canvas"),this.smallimagectx=this.smallimagecnv.getContext("2d",{willReadFrequently:!0}),"ComparePage"==i?(this.ThumbnailWidth=as,this.ThumbnailHeight=is):(null!=i.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailWidth=i.getElementsByTagName("ThumbnailWidth")[0].firstChild.nodeValue:this.ThumbnailWidth=as,null!=i.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailHeight=i.getElementsByTagName("ThumbnailHeight")[0].firstChild.nodeValue:this.ThumbnailHeight=is),this.printcanvas=document.createElement("canvas"),this.printctx=this.printcanvas.getContext("2d"),this.print3Dimage=document.createElement("img"),this.pdfprintcanvas=document.createElement("canvas"),this.pdfprintctx=this.pdfprintcanvas.getContext("2d"),this.printobj={pagenumber:p.pagenumber,paperimage:p.printcanvas,paperwidth:297,paperheight:210,docwidth:1,docheight:1,inchtomm:25.4,DPI:300,scrDPI:96,scaleSet:!1,pdx:0,pdy:0,pscale:1,printctx:p.printctx,setRes:function(e){this.DPI=e},setPaperSize:function(e,t){this.paperwidth=e,this.paperheight=t,this.paperimage.width=e/this.inchtomm*this.DPI,this.paperimage.height=t/this.inchtomm*this.DPI},setDocSize:function(e,t){this.docwidth=e,this.docheight=t},setScale:function(){var e=this.paperimage.width/this.docwidth,t=this.paperimage.height/this.docheight;this.pscale=Math.min(e,t),this.pdx=(this.paperimage.width-this.docwidth*this.pscale)/2,this.pdy=(this.paperimage.height-this.docheight*this.pscale)/2,this.scaleSet=!0},print:function(){this.scaleSet&&(p.usepdfjs?p.printPDFpage():p.usevectorxml?p.draw_vectorPrint():p.usevector3Dxml?(p.print3Dimage.addEventListener("load",p.load3Dimage,!1),p.print3Dimage.src=d.domElement.toDataURL()):p.draw_imagePrint())}};function O(e){p.pdfstartx=e.x,p.pdfstarty=e.y,p.pdfendx=e.width+p.pdfstartx,p.pdfendy=e.height+p.pdfstarty,p.starty=e.y,p.startx=e.x,p.endx=e.width+e.x,p.endy=e.height+e.y}function L(e,t){var a=e.x,i=e.y,s=a+e.width,r=i+e.height,n=t*(Math.PI/180),o=Math.cos(n),l=Math.sin(n),c=ti/2,h=ai/2,d=a-c,p=i-h,u=d*o-p*l,g=d*l+p*o;u=c+u,g=h+g;var f=(d=s-c)*o-(p=r-h)*l,m=d*l+p*o;return f=c+f,m=h+m,{x:Math.min(u,f),y:Math.min(g,m),w:Math.max(f,u),h:Math.max(m,g)}}function V(e){p.dypdf=e.y,p.dxpdf=e.x,p.starty=e.y,p.startx=e.x,p.endx=e.w,p.endy=e.h}function N(e){p.dxpdfzerorot=e.x,p.dypdfzerorot=e.y}function B(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e}function U(e,t,a,i){const s=Hl();return{x:e/s,y:t/s,w:a/s,h:i/s}}function G(){p.DocRef.draw_mpagepdf(!1),Vl(n),Nl(a),p.DocRef.foxitsearchobj.active&&p.DocRef.drawsearchRect()}function z(){p.DocRef.thumbnails[p.pagenumber]&&(p.usepdfjs?p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerectdirect()):p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerect())),null!=p.DocRef.foxitdoc?(n.clearRect(0,0,ti,ai),p.DocRef.foxitsearchobj.active&&p.DocRef.drawsearchRect()):(Vl(n),Nl(a))}function H(e,t){if(p.usevectorxml)p.dxvector=e.dx,p.dyvector=e.dy,p.dscalevector=e.dscale,p.startx=e.startx,p.starty=e.starty,p.endx=e.endx,p.endy=e.endy,p.draw_vector(!1),t?p.vectorscrollbuffer(p.dscalevector,p.dxvector,p.dyvector):p.vectorischanged=!0,p.DocRef.textselect&&(p.cleartextdivs(),p.settextdivs());else if(p.usepdfjs){if(p.checkFoxitMaxZoom(e.dscale)&&(p.dxpdf=e.dx,p.dypdf=e.dy,p.dscalepdf=e.dscale,p.startx=e.startx,p.starty=e.starty),p.pdfrenderopque+=1,p.pdfisrendered=!1,t)if(null!=e.mousepoint)p.foxitdirectZoomTo(p.dscalepdf,e.dfactor,e.mousepoint,e.offsetpoint,e.offsetcenter,e.bIn);else{var a=e.offsetcenter,i=.5*ti,s=.5*ai,r=X(p.getpageRotation(),p.foxitpageorigrot),n=p.getPDFDistScale(i,p.dscalepdf),o=p.getPDFDistScale(s,p.dscalepdf);switch(r){case 0:a.x=a.x-n,a.y=a.y+o;break;case 90:a.x=a.x-o,a.y=a.y-n;break;case 180:a.x=a.x+n,a.y=a.y-o;break;case 270:a.x=a.x+o,a.y=a.y+n}p.foxitdirectZoomToEx(p.dscalepdf,a)}p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else p.dx=e.dx,p.dy=e.dy,p.dscale=e.dscale,p.startx=e.startx,p.starty=e.starty,p.endx=e.endx,p.endy=e.endy,p.checkimageswitch(),0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0)}function _(){if(p.usevectorxml){if(null==p.VectorPageObj)return;var e={dscale:p.dscalevector,dx:p.dxvector,dy:p.dyvector,width:p.VectorPageObj.width,height:p.VectorPageObj.height}}else e=p.usepdfjs?{dscale:p.dscalepdf,dx:p.dxpdf,dy:p.dypdf,width:p.pdfpagewidth,height:p.pdfpageheight,mousepoint:{x:0,y:0},offsetpoint:{x:0,y:0},offsetcenter:{x:0,y:0},bIn:!1,dfactor:1}:{dscale:p.dscale,dx:p.dx,dy:p.dy,width:p.MainImageWidth,height:p.MainImageHeight};return e}function W(e,t,a,i){var s=(ti-a.width*a.dscale)/2,r=(ai-a.height*a.dscale)/2,n=s-a.dx,o=r-a.dy;a.dscale=i?a.dscale*t:a.dscale/t;var l=(ti-a.width*a.dscale)/2,c=(ai-a.height*a.dscale)/2;e?(a.dx=l,a.dy=c):i?(a.dx=l-n*t,a.dy=c-o*t):(a.dx=l-n/t,a.dy=c-o/t);var h=a.dx,d=a.dy,u=a.width*a.dscale+h,g=a.height*a.dscale+d;return p.setpagedimsize(h,d,u,g,!0),{dscale:a.dscale,dx:a.dx,dy:a.dy,startx:h,starty:d,endx:u,endy:g}}function z(){Vl(n),Nl(a);var e=p.DocRef.getThumb(p.pagenumber);null!=e&&(p.usepdfjs?e.birdseyerect(p.getpagerectdirect()):e.birdseyerect(p.getpagerect()))}function X(e,t){return t+e>=360?e+t-360:e+t}this.scaleChanged=function(){null!=pt&&pt.scalechanged(p.DocRef.fileindex,p.pagenumber,p.scaleObject)},this.setpagedimsize=function(e,t,a,i,s){s?(p.startx=e,p.starty=t,p.endx=a,p.endy=i):(p.startx=e,p.starty=t,p.endx=a+e,p.endy=i+t),p.DocRef.thumbnails[p.pagenumber]&&p.DocRef.thumbnails[p.pagenumber].birdseyerect({x:p.startx,y:p.starty,w:a,h:i})},this.getwidth=function(){return p.offscreenwidth},this.getheight=function(){return p.offscreenheight},this.draw_tile_background=function(e,t,a,i){p.draw_tiled_cavas(e,t,a,1)},this.draw_tile_overlay=function(e,t,a,i){p.draw_tiled_cavas(e,t,a,1)},this.transparentpdfcompare=function(e){for(var t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++){try{var s=p.canvtileArray[a][i].ctx.getImageData(0,0,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height)}catch(e){alert("Error 1 - "+e),console.log(e,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height),t=-1}e?p.setinvert(s.data):p.transparent(s.data),0==t&&p.canvtileArray[a][i].ctx.putImageData(s,0,0)}},this.invertpdfcompare=function(e){for(var t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++){try{var s=p.canvtileArray[a][i].ctx.getImageData(0,0,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height)}catch(e){alert("Error 1 - "+e),console.log(e,p.canvtileArray[a][i].cnv.width,p.canvtileArray[a][i].cnv.height),t=-1}var r=p.compositereference.getColors();if(e)p.setinvert(s.data);else switch(p.role){case 1:p.setcolor(s.data,r.bg);break;case 2:p.setcolor(s.data,r.fg)}0==t&&p.canvtileArray[a][i].ctx.putImageData(s,0,0)}},this.copyCanvasTiles=function(e){for(var t=0;t<e.length;t++){p.canvtileArray.push([]);for(var a=0;a<e[t].length;a++){var i=document.createElement("canvas"),s=i.getContext("2d"),r={cnv:i,ctx:s,tilenumber:0};r.cnv.height=e[t][a].cnv.height,r.cnv.width=e[t][a].cnv.width,r.tilenumber=e[t][a].tilenumber,r.ctx.drawImage(e[t][a].cnv,0,0),p.canvtileArray[t].push(r)}}},this.gettilesize=function(){for(var e=0,t=0,a=0;a<p.canvtileArray.length;a++)for(var i=0;i<p.canvtileArray[a].length;i++)e+=p.canvtileArray[a][i].cnv.width,t+=p.canvtileArray[a][i].cnv.height;p.setpagesize(e,t)},this.scaleCompare=function(e){p.checkFoxitMaxZoom(e)&&p.DocRef.foxitdoc.getBitmap(p.pagenumber,e,p.setPageBitmap)},this.initCompare=function(){p.canvtileArray=[],1==p.role?(p.pdfpagewidth=p.compositereference.pages[0].pdfpagewidth,p.pdfpageheight=p.compositereference.pages[0].pdfpageheight,p.bgpagewidth=p.compositereference.pages[0].pdfpagewidth,p.bgpageheight=p.compositereference.pages[0].pdfpageheight,p.backgroundScale=p.compositereference.pages[0].getdscale(),p.backgroundOffsetX=p.compositereference.pages[0].getdx(),p.backgroundOffsetY=p.compositereference.pages[0].getdy(),p.offscreenwidth=p.compositereference.pages[0].offscreenwidth,p.offscreenheight=p.compositereference.pages[0].offscreenheight,p.dxpdf=p.backgroundOffsetX,p.dypdf=p.backgroundOffsetY,p.DocRef.foxitdoc.getBitmap(p.pagenumber,p.backgroundScale,p.setPageBitmap)):2==p.role&&(p.pdfpagewidth=p.compositereference.pages[1].pdfpagewidth,p.pdfpageheight=p.compositereference.pages[1].pdfpageheight,p.ovpageheight=p.compositereference.pages[1].pdfpageheight,p.ovpagewidth=p.compositereference.pages[1].pdfpagewidth,p.overlayScale=p.compositereference.pages[1].getdscale(),p.overlayOffsetX=p.compositereference.pages[1].getdx(),p.overlayOffsetY=p.compositereference.pages[1].getdy(),p.offscreenwidth=p.compositereference.pages[1].offscreenwidth,p.offscreenheight=p.compositereference.pages[1].offscreenheight,p.dxpdf=p.overlayOffsetX,p.dypdf=p.overlayOffsetY,p.DocRef.foxitdoc.getBitmap(p.pagenumber,p.overlayScale,p.setPageBitmap)),0==p.compositereference.compareMode?p.invertpdfcompare(!1):1==p.compositereference.compareMode&&p.transparentpdfcompare(!1)},this.movepage=function(e){p.pagenumber=e,this.dxpdf=0,this.dypdf=0,this.foxitdx=0,this.foxitdy=0,this.dscalepdf=1,this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.curpagescale=1,this.curfoxitpagescale=1,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.iscollapsed=!0,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=_i,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.PDFsnapTransform=null,this.textselectobj={rectarray:void 0,start:-1,end:-1,bstart:!1,bend:!1,startpos:null,endpos:null,$handler:null,complete:!1},this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.bDorescaleonsizeChange=Vi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.startx=0,this.starty=0,this.endx=0,this.endy=0,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.drotation=this.DocRef.pagerotations[p.pagenumber]),this.pagelockrotation=0,this.textsearchindx=0,this.drawtextSearchRect=!1,this.pageloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.usepdfjs&&(this.visibleTiles=[],this.bautoloadthumbnails=!1,this.tilespending=!1,this.prioritytilespending=!1,this.canvtileArray=[],this.bgCanvtileArray=[],this.annotArray=[],this.tempfoxitpage={canvases:[],imagedim:{width:0,height:0},havecanvases:!1},this.busetempcanvases=!1,this.pageRendering=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=1,this.PDFTextArea=document.createElement("div"),this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",tu,!0),this.pdfpagetime=10,this.viewport=null,this.magviewport=null,this.compareviewport=null,null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getpageinfodim(p.pagenumber,p.setfoxitPageSizeNonRender))},this.setNotCollapsedArray=function(){if(p.DocRef.isNotCollapsed&&p.DocRef.isNotCollapsed.length)if(p.iscollapsed){var e=p.DocRef.isNotCollapsed.indexOf(p.pagenumber);-1!==e&&p.DocRef.isNotCollapsed.splice(e,1)}else-1===p.DocRef.isNotCollapsed.indexOf(p.pagenumber)&&p.DocRef.isNotCollapsed.push(p.pagenumber);else p.iscollapsed||(p.DocRef.isNotCollapsed=[p.pagenumber])},this.setCanvasTiles=function(e,t){for(var a=t.rows,i=t.columns,s=0;s<a;s++){e.push([]);for(var r=0;r<i;r++)e[s].push({cnv:document.createElement("canvas"),ctx:null,tilenumber:0,visible:!1,xoffset:0,yoffset:0}),e[s][r].ctx=e[s][r].cnv.getContext("2d")}return e},this.sharpencomplete=function(){},this.annotComplete=function(){p.DocRef.getpageloadSearch(p.pagenumber)},this.canvasArraySizeSet=function(e,t){e.width=t.pagepos.width,e.height=t.pagepos.height,p.prioritytilespending=!0,p.tilespending=!0},this.tilesCreated=function(e,t){p.canvtileArray=e,Dc(p.canvasArraySizeSet,t,p.canvtileArray)},this.drawpriorityTileComplete=function(e,t,a){if(t.scrollupdate)for(var i=0;i<e.length;i++)p.canvtileArray[e[i].r][e[i].c]=p.bgCanvtileArray[e[i].r][e[i].c];p.setfoxitpagedim(t.width,t.height,a,t.pagescale),wc(p.sharpencomplete,p.canvtileArray,t.transScale),p.compositereference&&0!=p.role?(0==p.compositereference.compareMode?p.invertpdfcompare(!1):1==p.compositereference.compareMode&&p.transparentpdfcompare(!1),p.compositereference.canvasdrawn(p.role),p.compositereference.canvasdrawready&&p.compositereference.draw_compare(!0)):p.DocRef.draw_mpagepdf(!1),e.ndtilesnum>0&&Rc(p.drawTilesComplete,e,t,p),kc(p.annotComplete,t,p)},this.drawTilesComplete=function(e){if(e.scrollupdate)for(var t=0;t<p.bgCanvtileArray.length;t++)p.canvtileArray[t]=p.bgCanvtileArray[t].slice();wc(p.sharpencomplete,p.canvtileArray,e.transScale),p.DocRef.draw_mpagepdf(!1)},this.foxitpagescalecheck=function(e){var t=p.curpagescale*rn;e.toFixed(4)!=t.toFixed(4)&&(p.curpagescale=e/rn,G())},this.foxitonScrollupdate=function(e){e&&(p.setpagedimfoxit(e),null!=e.x&&null!=e.y?p.setpagedimsize(e.x,e.y,e.width,e.height,!1):null!=e.left&&null!=e.top&&p.setpagedimsize(e.left,e.top,e.width,e.height,!1),p.setpagerotationdimfoxit(e))},this.getFoxitpageRect=function(){return{x:p.pdfstartx,y:p.pdfstarty,w:p.pdfendx,h:p.pdfendy}},this.setpagerotationdimfoxitrot=function(e){switch(X(p.getpageRotation(),p.foxitpageorigrot)){case 0:p.dxpdfzerorot=p.foxitdx,p.dypdfzerorot=p.foxitdy;break;case 90:var t=L(e,270);N(t);break;case 180:N(t=L(e,180));break;case 270:N(t=L(e,90))}},this.setpagerotationdimfoxit=function(e){switch(p.getpageRotation()){case 0:p.dypdf=p.foxitdy,p.dxpdf=p.foxitdx;break;case 90:var t=L(e,270);V(t);break;case 180:V(t=L(e,180));break;case 270:V(t=L(e,90))}p.setpagerotationdimfoxitrot(e)},this.setpagedimfoxit=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),O(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e))},this.setpagedimdirect=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&O(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),G())},this.foxitcalibratepagemarkupEx=function(e,t){if(e){if(t&&0!=p.offscreenwidth&&0!=p.pdfpagewidth){var a=p.getPDFpageScale()*rn;t==a*p.dscalepdf||(p.dscalepdf=t/a)}if(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&O(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),G(),null!=ba&&null==bexternal){var i=p.getpagerect();ba.panUpdate(p.dxpdf,p.dypdf,i)}}},this.foxitcalibratepagemarkup=function(e){e&&(null!=e.x&&null!=e.y?(p.foxitdx=e.x,p.foxitdy=e.y):null!=e.left&&null!=e.top&&(p.foxitdx=e.left,p.foxitdy=e.top),0!=p.getpageRotation()&&O(e),p.dypdfnonrot=p.foxitdy,p.dxpdfnonrot=p.foxitdx,p.setpagerotationdimfoxit(e),G())},this.foxitcalibratepagePosY=function(){0==p.pagenumber&&(p.dypdf=0,p.starty=0,p.endy=p.offscreenheight*p.dscalepdf+p.starty),p.pagenumber==p.DocRef.pages.length-1&&(p.endy=ai,p.dypdf=p.endy-p.offscreenheight*p.dscalepdf,p.starty=p.dypdf)},this.foxitcalibratepagePosX=function(e){e?p.offscreenwidth*p.dscalepdf<ti?(p.dxpdf=(ti-p.offscreenwidth*p.dscalepdf)/2,p.startx=p.dxpdf,p.endx=p.offscreenwidth*p.dscalepdf+p.startx):(p.endx=ti,p.dxpdf=p.endx-p.offscreenwidth*p.dscalepdf,p.startx=p.dxpdf):p.offscreenwidth*p.dscalepdf<ti?(p.dxpdf=(ti-p.offscreenwidth*p.dscalepdf)/2,p.startx=p.dxpdf,p.endx=p.offscreenwidth*p.dscalepdf+p.startx):(p.dxpdf=0,p.startx=0,p.endx=p.offscreenwidth*p.dscalepdf+p.startx)},this.setfoxitPageSizeEx=function(e){p.curfoxitpagescale=e.pagescale,p.curfoxitpagescale=e.pagescale/rn,e.pagescale=e.pagescale/rn,p.setfoxitpagedimnew(e)},this.setfoxitPageSizeNonRender=function(e){p.foxitpagerot=e.rotation,p.foxitpageorigrot=e.originalrotation,p.pdfpagewidth=e.width,p.pdfpageheight=e.height;var t=ti-42;switch(p.getpageRotation()){case 0:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight;break;case 90:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth;break;case 180:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight;break;case 270:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth}var a=Te/p.pdfpageheight,i=Me/p.pdfpagewidth;p.fixedScale=Math.min(i,a),p.curpagescale=e.pagescale,p.width=e.pagepos.width,p.height=e.pagepos.height;var s=t/e.pdfwidth;p.pdfdscaletemp=s*rn;var r=e.pagepos.width*(p.pdfdscaletemp/rn);e.pagepos.height,p.pdfdscaletemp,p.pdfdxtemp=(ti-r)/2,p.pdfdxtemp=p.pdfdxtemp/2,p.pdfdytemp=8,dl(p),null!=p.DocRef.markupsave&&p.DocRef.markupsave.setpage(p)},this.setfoxitPageSize=function(e){if(p.canvtileArray=[],p.curfoxitpagescale=e.pagescale,p.setfoxitpagedimnew(e),null!=e.pagepos){var t={width:e.pagepos.width,height:e.pagepos.height};p.canvasArraySizeSet(t,e),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.rendercallback&&null!=lt&&lt.RenderComplete(p.pagenumber)}},this.createCanvasTiles=function(e){e.scaleupdate?(p.canvtileArray=[],p.bgCanvtileArray=[]):e.scrollupdate&&(p.bgCanvtileArray=[]),p.curfoxitpagescale=e.pagescale,e.scaleupdate&&Cc(p.tilesCreated,p.canvtileArray,e),e.scrollupdate&&Cc(p.tilesCreated,p.bgCanvtileArray,e,p.visibleTiles)},this.setfoxitpagedimnew=function(e){switch(p.foxitpagerot=e.rotation,p.foxitpageorigrot=e.originalrotation,p.pdfpagewidth=e.width,p.pdfpageheight=e.height,p.originalwidth=e.pdfwidth,p.originalheight=e.pdfheight,p.printobj.setDocSize(p.originalwidth,p.originalheight),p.getpageRotation()){case 0:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight,p.bpagesizeupdated=!0;break;case 90:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth,p.bpagesizeupdated=!0;break;case 180:p.originalPDFwidth=e.pdfwidth,p.originalPDFheight=e.pdfheight,p.bpagesizeupdated=!0;break;case 270:p.originalPDFwidth=e.pdfheight,p.originalPDFheight=e.pdfwidth,p.bpagesizeupdated=!0}var t=Te/p.pdfpageheight,a=Me/p.pdfpagewidth;if(p.fixedScale=Math.min(a,t),p.curpagescale=e.pagescale,null!=e.pagepos&&p.setpagesize(e.pagepos.width,e.pagepos.height),p.curpagescale=p.offscreenwidth/p.pdfpagewidth,null!=e.pagepos&&(p.width=e.pagepos.width,p.height=e.pagepos.height),p.pdfrenderopque-=1,p.pdfrenderopque<=0&&(p.pdfrenderopque=0,p.pdfisrendered=!0),null!=e.pagepos){var i=p.width/e.pagepos.width,s=p.height/e.pagepos.height;p.pdfdscaletemp=Math.min(i,s),p.pdfdxtemp=(ti-e.pagepos.width)/2,p.pdfdytemp=(ai-e.pagepos.height)/2,p.pdfisrendered=!0,p.iscollapsed=!1,p.pdfisfirstrendered=!0,p.setPDFdim(p.pdfdxtemp,0,p.pdfdscaletemp)}p.DocRef.foxitsearchobjrect.active&&p.DocRef.foxitsearchobjrect.setpagerect(p.pagenumber),p.DocRef.foxitsearchobj.active&&p.DocRef.getpageloadSearch(p.pagenumber),p.drawtextSearchRect&&(p.drawsearchRect(),p.drawtextSearchRect=!1)},this.setfoxitpagedim=function(e,t,a,i){p.pdfpagewidth=e,p.pdfpageheight=t,p.originalwidth=e,p.originalheight=t;var s=Te/p.pdfpageheight,r=Me/p.pdfpagewidth;p.fixedScale=Math.min(r,s),p.curpagescale=i,p.setpagesize(a.width,a.height),p.curpagescale=p.offscreenwidth/p.pdfpagewidth,p.width=a.width,p.height=a.height,p.pdfrenderopque-=1,p.pdfrenderopque<=0&&(p.pdfrenderopque=0,p.pdfisrendered=!0);var n=p.width/a.width,o=p.height/a.height;p.pdfdscaletemp=Math.min(n,o),p.pdfdxtemp=(ti-a.width)/2,p.pdfdytemp=(ai-a.height)/2,p.pdfisrendered=!0,p.iscollapsed=!1,p.pdfisfirstrendered=!0,p.setPDFdim(p.pdfdxtemp,0,p.pdfdscaletemp)},this.foxitcreateAnnotArray=function(e){if(p.annotArray=[],e.annots&&e.annots.length>0)for(var t=0;t<e.annots.length;t++)p.annotArray.push({cnv:document.createElement("canvas"),pos:e.annots[t].pos}),p.annotArray[t].cnv.width=e.annots[t].tiles[0].width,p.annotArray[t].cnv.height=e.annots[t].tiles[0].height,p.annotArray[t].cnv.getContext("2d").drawImage(e.annots[t].tiles[0],0,0)},this.foxitcreatecanvasArray=function(e,t){var a=0,i=0,s=0;if(e.canvases&&e.canvases.length>0){for(var r=0,n=0;n<e.hidden.length;n++)r==e.hidden[n].ct&&r++;for(var o=0;o<t.length;o++){"canvas"==e.canvases[r].tagName.toLowerCase()&&(o<t.length-1?(i+=e.tileSize,s=e.tileSize):(i+=e.canvases[r].height,s=e.canvases[r].height),a=0);for(var l=0;l<t[o].length;l++)if(e.canvases[r]&&"canvas"==e.canvases[r].tagName.toLowerCase())for(l<t[o].length-1?(a+=e.tileSize,e.tileSize):(a+=e.canvases[r].width,e.canvases[r].width),s<e.canvases[r].height&&(i+=e.canvases[r].height-s),1==e.transScale?(t[o][l].cnv.height=e.canvases[r].height,t[o][l].cnv.width=e.canvases[r].width,t[o][l].tilenumber=r,t[o][l].xoffset=e.tileSize,t[o][l].yoffset=e.tileSize):(t[o][l].cnv.height=Math.round(e.canvases[r].height*e.transScale),t[o][l].cnv.width=Math.round(e.canvases[r].width*e.transScale),t[o][l].tilenumber=r,t[o][l].xoffset=e.tileSize*e.transScale,t[o][l].yoffset=e.tileSize*e.transScale),r++,n=0;n<e.hidden.length;n++)r==e.hidden[n].ct&&r++}}return{width:a*=e.transScale,height:i*=e.transScale}},this.foxitdrawcanvasArray=function(e,t,a){var i=!1,s=!1;if(this.busetempcanvases?p.tempfoxitpage.canvases&&(i=!0,p.tempfoxitpage.canvases.length>0&&(s=!0)):t&&(i=!0,t.length>0&&(s=!0)),i&&s)for(var r=!0,n=0;n<p.canvtileArray.length;n++){r=!0;for(var o=0;o<p.canvtileArray[n].length;o++){r=!0;for(var l=0;l<e.length;l++)n==e[l].r&&o==e[l].c&&(r=!1);if(r)if(1==a)this.busetempcanvases?p.canvtileArray[n][o].ctx.drawImage(p.tempfoxitpage.canvases[p.canvtileArray[n][o].tilenumber].cnv,0,0):p.canvtileArray[n][o].ctx.drawImage(t[p.canvtileArray[n][o].tilenumber],0,0);else{if(this.busetempcanvases)var c=Un(p.tempfoxitpage.canvases[p.canvtileArray[n][o].tilenumber].cnv,a);else c=Un(t[p.canvtileArray[n][o].tilenumber],a);p.canvtileArray[n][o].ctx.drawImage(c,0,0),c=null}}}this.busetempcanvases&&(p.tempfoxitpage.canvases=[],this.busetempcanvases=!1)},this.foxitdrawAllcanvasArray=function(e,t){if(e&&e.length>0){p.canvtileArray[0][0].cnv.width,p.canvtileArray[0][0].cnv.height;for(var a=(p.dxpdf,p.dypdf,[]),i=0;i<p.canvtileArray.length;i++){for(var s=0;s<p.canvtileArray[i].length;s++){if(p.canvtileArray[i][s].cnv.width,p.canvtileArray[i][s].cnv.height,1==t)p.canvtileArray[i][s].ctx.drawImage(e[p.canvtileArray[i][s].tilenumber],0,0);else{var r=Un(e[p.canvtileArray[i][s].tilenumber],t);p.canvtileArray[i][s].ctx.drawImage(r,0,0)}a.push({r:i,c:s}),p.dscalepdf}p.dscalepdf,p.dxpdf}}return p.draw_canvas(!0),a},this.rotatedRectbyangle=function(e){var t=this.startx,a=this.starty,i=this.endx,s=this.endy,r=e*(Math.PI/180),n=Math.cos(r),o=Math.sin(r),l=ti/2,c=ai/2,h=t-l,d=a-c,p=h*n-d*o,u=h*o+d*n;p=l+p,u=c+u;var g=(h=i-l)*n-(d=s-c)*o,f=h*o+d*n;return g=l+g,f=c+f,{x:Math.min(p,g),y:Math.min(u,f),w:Math.max(g,p),h:Math.max(f,u)}},this.rotatedRect=function(){var e=this.startx,t=this.starty,a=this.endx,i=this.endy,s=this.getpageRotation()*(Math.PI/180),r=Math.cos(s),n=Math.sin(s),o=ti/2,l=ai/2,c=e-o,h=t-l,d=c*r-h*n,p=c*n+h*r;d=o+d,p=l+p;var u=(c=a-o)*r-(h=i-l)*n,g=c*n+h*r;return u=o+u,g=l+g,{x:Math.min(d,u),y:Math.min(p,g),w:Math.max(u,d),h:Math.max(g,p)}},this.printPDFpage=function(){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getBitmap(p.pagenumber,p.printobj.pscale,p.setPageBitmapPrint)},this.setPageBitmapPrint=function(e,t){if(e.error)return console.log("bitmap failed",t,e.error),void(p.printResolve&&p.printResolve());if(null!=e){var a=new Uint8ClampedArray(e.buffer),i=new ImageData(a,e.width,e.height);p.pdfprintcanvas.width=e.width,p.pdfprintcanvas.height=e.height,p.printobj.pagenumber=t,p.pdfprintctx.putImageData(i,0,0),p.printobj.printctx.drawImage(p.pdfprintcanvas,p.printobj.pdx,p.printobj.pdy,p.printobj.docwidth*p.printobj.pscale,p.printobj.docheight*p.printobj.pscale),jl(p.printobj.printctx,t,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale),Qi[t]=!0,p.printResolve&&(p.printResolve(),p.printResolve=null)}else p.printResolve&&p.printResolve()},this.load3Dimage=function(e){p.printobj.printctx.drawImage(e.currentTarget,p.printobj.pdx,p.printobj.pdy,p.printobj.docwidth*p.printobj.pscale,p.printobj.docheight*p.printobj.pscale),jl(p.printobj.printctx,p.pagenumber,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale)},this.floorplanloadevent=function(e){var t,a;t=e.srcElement.naturalWidth,a=e.srcElement.naturalHeight,p.SmallImageWidth=t,p.SmallImageHeight=a,p.smallimagecnv.width=t,p.smallimagecnv.height=a,p.smallimagectx.drawImage(p.smallimage,0,0,t,a)},this.smallimagecreatefromlarge=function(){var e,t,a,i,s,r,n;r=p.SmallImageWidth,n=p.SmallImageHeight;var o=p.SmallImageWidth/p.originalwidth;p.smallimagecnv.width=r,p.smallimagecnv.height=n,o<1?p.smallimagecnv=Un(p.largeimagecnv,o):p.smallimagectx.drawImage(p.largeimagecnv,0,0,r,n),e=ai/p.SmallImageHeight,t=ti/p.SmallImageWidth,s=Math.min(t,e),a=(ti-p.SmallImageWidth*s)/2,i=(ai-p.SmallImageHeight*s)/2,p.setimagedimsmall(a,i,s),null!=la&&la.setDownload("hide")},this.smallimageloadevent=function(e){var t,a,i,s,r,n,o;n=p.SmallImageWidth,o=p.SmallImageHeight,p.smallimagecnv.width=n,p.smallimagecnv.height=o,p.smallimagectx.drawImage(p.smallimage,0,0,n,o),t=ai/p.SmallImageHeight,a=ti/p.SmallImageWidth,r=Math.min(a,t),i=(ti-p.SmallImageWidth*r)/2,s=(ai-p.SmallImageHeight*r)/2,p.setimagedimsmall(i,s,r),null!=la&&la.setDownload("hide")},this.replacefloorplan=function(e,t){var a=t.birdseyeobj.birdseye.width,i=t.birdseyeobj.birdseye.height;p.floorplans[e].width=a,p.floorplans[e].height=i,p.floorplans[e].canvas.width=a,p.floorplans[e].canvas.height=i,p.floorplans[e].ctx.drawImage(t.birdseyeobj.birdseye,0,0,a,i),p.floorplans[e].replaced=!0,p.floorplans[e].RScale=t.floorplanreplaceScale},this.getFloorplans=function(){return p.floorplans},this.floorplanlolad=function(e){if(f){var t=p.floorplans[e].SRC;Fh("GET",t,"blob").then((function(t){var a=t;a&&(p.floorplans[e].image.addEventListener("load",(function(t){var a,i;a=t.srcElement.naturalWidth,i=t.srcElement.naturalHeight,p.floorplans[e].width=a,p.floorplans[e].height=i,p.floorplans[e].originalWidth=a,p.floorplans[e].originalHeight=i,p.floorplans[e].canvas.width=a,p.floorplans[e].canvas.height=i,p.floorplans[e].ctx.drawImage(p.floorplans[e].image,0,0,a,i);var s=p.floorplans[e].thumbwidht/a;p.floorplans[e].thumbcanvas.width=a*s,p.floorplans[e].thumbcanvas.height=i*s,p.floorplans[e].thumbctx.drawImage(p.floorplans[e].image,0,0,a*s,i*s),null!=ut&&ut.setThumbnail(e,p.floorplans[e])})),p.floorplans[e].image.src=URL.createObjectURL(a))})).catch((function(e){e.status||console.log(e)}))}},this.smallimageload=function(){var e=new XMLHttpRequest;if(e.withCredentials=ji,e.open("GET",p.SmallImageSRC,!0),_r){var t=Th();t.authset&&e.setRequestHeader("Authorization",t.authString+t.baseuserstring)}e.responseType="blob",e.onload=function(t){var a=e.response;a&&(p.smallimage.addEventListener("load",p.smallimageloadevent,!1),p.smallimage.src=URL.createObjectURL(a))},e.onprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},e.send(null)},this.largeimageloadevent=function(e){var t,a,i,s,r,n=0,o=0;s=p.MainImageWidth,r=p.MainImageHeight,p.originalwidth=p.MainImageWidth,p.originalheight=p.MainImageHeight,p.largeimagecnv.width=s,p.largeimagecnv.height=r,p.largeimagectx.drawImage(p.largeimage,0,0,s,r),n=Te/p.MainImageHeight,o=Me/p.MainImageWidth,p.fixedScale=Math.min(o,n),n=ai/p.MainImageHeight,o=ti/p.MainImageWidth,p.printobj.setDocSize(p.MainImageWidth,p.MainImageHeight),p.width=s,p.height=r,i=Math.min(o,n),t=(ti-p.MainImageWidth*i)/2,a=(ai-p.MainImageHeight*i)/2,p.setimagedimlarge(t,a,i),p.smallimagecreatefromlarge()},this.largeimageload=function(){var e=new XMLHttpRequest;if(e.withCredentials=ji,e.open("GET",p.MainImageSRC,!0),_r){var t=Th();t.authset&&e.setRequestHeader("Authorization",t.authString+t.baseuserstring)}e.responseType="blob",e.onload=function(t){var a=e.response;a&&(p.largeimage.addEventListener("load",p.largeimageloadevent,!1),p.largeimage.src=URL.createObjectURL(a))},e.onprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},e.send(null)},this.getlayerlist=function(){return p.VectorPageObj.getlayerlist()},this.turnLayerOnOff=function(e){p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye(),p.VectorPageObj.turnLayerOnOff(e),p.draw_vector(!1),p.vectorischanged=!0},this.changeLayerOnOff=function(e,t){p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye(),p.VectorPageObj.changeLayerOnOff(e,t),p.draw_vector(!1),p.vectorischanged=!0},this.turnBlockAllOnOff=function(e){p.VectorPageObj.turnBlockAllOnOff(e),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.turnLayerAllOnOff=function(e){p.VectorPageObj.turnLayerAllOnOff(e),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.resetLayers=function(){p.VectorPageObj.resetLayers(),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.getBlocks=function(){return null==p.VectorPageObj?[]:p.VectorPageObj.getBlocks()},this.getPenTable=function(){return null==p.VectorPageObj?[]:p.VectorPageObj.getpenTable()},this.getBlockswFill=function(){return p.VectorPageObj.getBlockswFill()},this.getFilteredAttributes=function(){return p.VectorPageObj.getFilteredAttributes()},this.getpageRef=function(){return p.pdfpageref},this.getpageRotation=function(){var e=p.drotation;return null!=p.DocRef.foxitdoc&&0!=p.DocRef.documentrotation&&(e=p.DocRef.documentrotation),e},this.filterBlocks=function(e){p.VectorPageObj.filterBlocks(e)},this.filterAttributes=function(e){p.VectorPageObj.filterAttributes(e)},this.turnBlockOnOff=function(e){p.VectorPageObj.turnBlockOnOff(e),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.changeBlockOnOff=function(e,t){p.VectorPageObj.changeBlockOnOff(e,t),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.state3dBlockAll=function(e,t){p.usevector3DGLTF&&p.set3DBlockStateNewAll(e,t)},this.state3dBlock=function(e,t,a){p.usevector3DGLTF&&p.set3DBlockStateNewGroup(e,t,a)},this.turn3DBlockOnOff=function(e,t){p.usevector3DGLTF?p.turn3DBlockOnOffNew(e,t):p.turn3DBlockOnOffOld(e)},this.change3DMarkupSize=function(e){var t=p.Vector3DPageObj.getMarkupChildren(),a=(p.Vector3DPageObj.getmminUnit(400),e),i=e,s=e;if(0!=t.length){for(var r=0;r<t.length;r++)t[r].userData.selected&&"symbol"==t[r].userData.type&&t[r].scale.set(a,i,s);this.Vector3DPageObj.updateblocklist()}},this.change3DMarkup=function(e){var t=p.Vector3DPageObj.getMarkupChildren(),a=null;if(0!=t.length){for(var i=0;i<sn.length;i++)sn[i].color==e&&(a=i);for(i=0;i<t.length;i++)t[i].userData.selected&&null!=a&&null!=sn[a].markupmaterial&&(t[i].material[4]=sn[a].markupmaterial,t[i].material[5]=sn[a].markupmaterial,t[i].userData.actionStatus=e);this.Vector3DPageObj.updateblocklist()}},this.updatedimline=function(e,t,a){var i=p.Vector3DPageObj.getMarkupChildren();if(0!=i.length)for(var s=0;s<i.length;s++)if("dimension"==i[s].userData.type&&i[s].userData.parentref==e&&"LineSegments"==i[s].type){var r=new Float32Array([t.x,t.y,t.z,a.x,a.y,a.z]);i[s].geometry.setAttribute("position",new THREE.BufferAttribute(r,3)),i[s].geometry.attributes.position.needsUpdate=!0}},this.move3DMarkupdimPoint=function(e,t,a){var i=p.Vector3DPageObj.getMarkupChildren();if(0!=i.length&&null!=a){for(var s=!1,r=0;r<i.length;r++)if(i[r].userData.selected&&"dimension"==i[r].userData.type){var n=[];if(i[r].uuid==e&&"Points"==i[r].type){i[r].updateMatrixWorld();for(var o=i[r].geometry.getAttribute("position"),l=t.clone(),c=0;c<o.count-1;c++){var h=c*o.itemSize,d=o.array[h],u=o.array[h+1],g=o.array[h+2],f=new THREE.Vector3(d,u,g);i[r].localToWorld(f),a==c?n.push(l):n.push(f)}var m=n[0].distanceTo(n[1]),y=new THREE.Vector3;y.subVectors(n[0],n[1]).setLength(.5*m).add(n[1]),n.push(y);var v=new Float32Array([n[0].x,n[0].y,n[0].z,n[1].x,n[1].y,n[1].z,n[2].x,n[2].y,n[2].z]);i[r].geometry.setAttribute("position",new THREE.Float32BufferAttribute(v,3)),i[r].userData.dimtext=p.Vector3DPageObj.setdimvalue(m),i[r].userData.distance=m,p.updatedimline(e,n[0],n[1]),i[r].geometry.attributes.position.needsUpdate=!0,i[r].updateMatrixWorld(),s=!0}}s&&(null!=Mt&&Mt.setMarkupList(i,hn.bActive),this.Vector3DPageObj.updateblocklist())}},this.moveSelected3DMarkup=function(e,t){var a=p.Vector3DPageObj.getMarkupChildren();if(p.Vector3DPageObj.getmarkupScene(),0!=a.length)for(var i=0;i<a.length;i++)if(a[i].userData.selected){if("symbol"==a[i].userData.type){p.move3DMarkup(a[i].uuid,e);break}if("Points"==a[i].type){p.move3DMarkupdimPoint(a[i].uuid,e,t);break}}},this.move3DMarkup=function(e,t){var a=p.Vector3DPageObj.getMarkupChildren();if(p.Vector3DPageObj.getmarkupScene(),0!=a.length){for(var i=!1,s=0;s<a.length;s++)a[s].userData.selected&&"symbol"==a[s].userData.type&&a[s].uuid==e&&(a[s].position.copy(t),i=!0);i&&(null!=Mt&&Mt.setMarkupList(a,hn.bActive),this.Vector3DPageObj.updateblocklist())}},this.displayfloorplan=function(e,t,a){var i=p.Vector3DPageObj.getMarkupChildren(),s=p.Vector3DPageObj.getmarkupScene();if(0!=i.length)for(var r=0;r<i.length;r++)(i[r].userData.floornum==e||a)&&null!=p.Vector3DPageObj.getmarkupScene()&&p.Vector3DPageObj.scene.children[s]&&(i[r].userData.type="floorplan")&&(i[r].visible=t)},this.removefloorplan=function(e){var t=p.Vector3DPageObj.getMarkupChildren(),a=p.Vector3DPageObj.getmarkupScene();if(0!=t.length)for(var i=0;i<t.length;i++)t[i].userData.floornum==e&&(t[i].geometry.dispose(),t[i].material.dispose(),null!=p.Vector3DPageObj.getmarkupScene()&&p.Vector3DPageObj.scene.children[a]&&p.Vector3DPageObj.scene.children[a].remove(t[i]))},this.delete3DMarkupbyName=function(e){var t=p.Vector3DPageObj.getMarkupChildren(),a=p.Vector3DPageObj.getmarkupScene();if(0!=t.length){for(var i=[],s=0;s<t.length;s++)t[s].userData.name==e&&(t[s].geometry.dispose(),"symbol"==t[s].userData.type&&(t[s].material[0].dispose(),t[s].material[1].dispose(),t[s].material[2].dispose(),t[s].material[3].dispose(),t[s].material[4].dispose(),t[s].material[5].dispose()),"dimension"==t[s].userData.type&&t[s].material.dispose(),"camera"==t[s].userData.type&&t[s].material.dispose(),i.push(t[s]));for(var r=0;r<i.length;r++)null!=p.Vector3DPageObj.getmarkupScene()&&p.Vector3DPageObj.scene.children[a]&&p.Vector3DPageObj.scene.children[a].remove(i[r]);i=[],null!=Mt&&Mt.setMarkupList(t,hn.bActive),this.Vector3DPageObj.updateblocklist()}},this.delete3DMarkup=function(){var e=p.Vector3DPageObj.getMarkupChildren(),t=p.Vector3DPageObj.getmarkupScene();if(0!=e.length){for(var a=[],i=0;i<e.length;i++)e[i].userData.selected&&(e[i].geometry.dispose(),"symbol"==e[i].userData.type&&(e[i].material[0].dispose(),e[i].material[1].dispose(),e[i].material[2].dispose(),e[i].material[3].dispose(),e[i].material[4].dispose(),e[i].material[5].dispose()),"dimension"==e[i].userData.type&&e[i].material.dispose(),a.push(e[i]));for(var s=0;s<a.length;s++)null!=p.Vector3DPageObj.getmarkupScene()&&p.Vector3DPageObj.scene.children[t]&&p.Vector3DPageObj.scene.children[t].remove(a[s]);a=[],null!=Mt&&Mt.setMarkupList(e,hn.bActive),this.Vector3DPageObj.updateblocklist()}},this.setblockstateMeshAll=function(e,t){null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.visible=t,e.userData.tempvisible=t},this.setblockstateMesh=function(e,t,a,i){var s=!1;return null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.name==t&&(s=!0,e.visible=a,e.userData.tempvisible=a,null!=Pt&&i&&Pt.set3DPartInfo(e.userData)),s},this.setStateMeshGroup=function(e,t,a,i,s){var r=!1;if(null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),i)var n=B(t,e.type),o=B(e.name,e.type);else o=e.name,n=t;if(o==n){if(r=!0,e.visible=a,e.userData.tempvisible=a,e.userData.blockRef)var l=p.Vector3DPageObj.blocklist[e.userData.blockRef];else p.Vector3DPageObj.setBlockRef(e),l=p.Vector3DPageObj.blocklist[e.userData.blockRef];null!=l?(l.visible=e.userData.tempvisible,Pt.set3DPartInfo(l)):null!=Pt&&s&&Pt.set3DPartInfo(e.userData)}return r},this.turnbloconoffMesh=function(e,t,a,i){var s=!1;if(null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),a)var r=t,n=B(e.name,e.type);else n=e.name,r=t;if(n==r){if(s=!0,e.visible?(e.visible=!1,e.userData.tempvisible=!1):(e.visible=!0,e.userData.tempvisible=!0),e.userData.blockRef)var o=p.Vector3DPageObj.blocklist[e.userData.blockRef];else p.Vector3DPageObj.setBlockRef(e),o=p.Vector3DPageObj.blocklist[e.userData.blockRef];null!=o?(o.visible=e.userData.tempvisible,Pt.set3DPartInfo(o)):null!=Pt&&i&&Pt.set3DPartInfo(e.userData)}return s},this.set3DBlockStateNewAllArray=function(e,t){for(var a=0;a<e.length;a++)if("Group"===e[a].type)for(var i=0;i<e[a].children.length;i++)p.setblockstateMeshAll(e[a].children[i],t);else p.setblockstateMeshAll(e[a],t)},this.set3DBlockStateNewAll=function(e,t){var a=p.Vector3DPageObj.getMeshChildren();if(0!=a.length){p.set3DBlockStateNewAllArray(a,e);for(var i=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),s=0;s<i.length;s++)p.set3DBlockStateNewAllArray(i[s],e)}},this.set3DBlockStateOld=function(e,t,a){var i=p.Vector3DPageObj.getMeshChildren();if(0!=i.length)for(var s=0;s<i.length;s++){if("Group"===i[s].type)for(var r=0;r<i[s].children.length&&(p.setblockstateMesh(i[s].children[r],e,t),!a);r++);if(p.setblockstateMesh(i[s],e,t),a)break}},this.set3DBlockStateNewGroup=function(e,t,a){var i=p.Vector3DPageObj.getMeshChildren();if(0!=i.length){p.set3DBlockstateGroupAll(i,e,t,a);for(var s=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),r=0;r<s.length;r++)p.set3DBlockstateGroupAll(s[r],e,t,a);a&&this.Vector3DPageObj.updateblocklist()}},this.set3DBlockStateNew=function(e,t,a){var i=p.Vector3DPageObj.getMeshByName(e);if(null!=i){if(a)var s=p.setblockstateMesh(i,e,t,a);else p.setblockstateMeshAll(i,t);s&&a&&this.Vector3DPageObj.updateblocklist()}},this.set3DBlockstateGroupAll=function(e,t,a,i){for(var s=!1,r=0;r<e.length;r++){if("Group"===e[r].type)for(var n=0;n<e[r].children.length;n++)p.setStateMeshGroup(e[r].children[n],t,a,!0,i)&&(s=!0);if(s)break;if(p.setStateMeshGroup(e[r],t,a,!1,i))break}},this.turn3DBlockOnOffNewAll=function(e,t,a){for(var i=!1,s=0;s<e.length;s++){if("Group"===e[s].type)for(var r=0;r<e[s].children.length;r++)p.turnbloconoffMesh(e[s].children[r],t,!0,a)&&(i=!0);if(i)break;if(p.turnbloconoffMesh(e[s],t,!1,a))break}},this.turn3DBlockOnOffNew=function(e,t){var a=p.Vector3DPageObj.getMeshChildren();if(0!=a.length){p.turn3DBlockOnOffNewAll(a,e,t);for(var i=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),s=0;s<i.length;s++)p.turn3DBlockOnOffNewAll(i[s],e,t);this.Vector3DPageObj.updateblocklist()}},this.turn3DBlockOnOffOld=function(e){for(var t=0;t<p.Vector3DPageObj.scene.children.length;t++)if(p.Vector3DPageObj.scene.children[t].name==e)return p.Vector3DPageObj.scene.children[t].visible?(p.Vector3DPageObj.scene.children[t].visible=!1,this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].tempvisible=!1):(p.Vector3DPageObj.scene.children[t].visible=!0,this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].tempvisible=!0),null!=Rt&&Rt.set3DPartInfo(this.Vector3DPageObj.partlist[e]),void this.Vector3DPageObj.updateblocklist()},this.restoreBlockStates=function(){p.VectorPageObj.restoreBlockStates(),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.resetBlocks=function(){p.VectorPageObj.resetBlocks(),p.draw_vector(!1),p.vectorischanged=!0,p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.reset3DParts=function(){p.usevector3DGLTF?p.reset3DPartsnew():p.reset3DPartsold()},this.resetMesh=function(e){var t=0;null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.userData.isSpace||(e.userData.visible?e.userData.tempvisible=1==e.userData.visible:e.userData.visible=e.visible?1:0,e.userData.tempvisible?e.visible=e.userData.tempvisible:e.userData.tempvisible=e.visible,e.userData.selected=!1,e.userData.usetempfacecolor=!1,null!=e.userData.facecolor&&(e.type,e.material.color.setHex(e.userData.facecolor)),e.userData.meshcolors&&(e.userData.meshcolors.length>1?(e.material.color=new THREE.Color(e.userData.meshcolors[t]),t<e.userData.meshcolors.length&&t++):e.userData.facecolor&&(e.material.color=setHex(e.userData.facecolor))))},this.reset3DPartsnewAll=function(e){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"!=e[t].children[a].type&&"LineSegments"!=e[t].children[a].type||p.resetMesh(e[t].children[a]);"Mesh"!=e[t].type&&"LineSegments"!=e[t].type||p.resetMesh(e[t])}},this.reset3DPartsnew=function(){var e=p.Vector3DPageObj.getMeshChildren();if(0!=e.length){p.reset3DPartsnewAll(e);for(var t=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),a=0;a<t.length;a++)p.reset3DPartsnewAll(t[a]);this.Vector3DPageObj.updateblocklist()}},this.reset3DPartsold=function(){for(var e=0,t=0;t<p.Vector3DPageObj.scene.children.length;t++)"Mesh"==p.Vector3DPageObj.scene.children[t].type&&(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].isSpace||(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].resetvisible(),p.Vector3DPageObj.scene.children[t].visible=this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].tempvisible,p.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].selected=!1,p.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].meshcolors.length>1?(p.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].meshcolors[e]),e<p.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].meshcolors.length&&e++):p.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].facecolor)));this.Vector3DPageObj.updateblocklist()},this.deleteVectorAttribute=function(e){p.usevectorxml&&p.VectorPageObj.deleteAttribute(e)},this.appendCustomBlockAttribute=function(e,t,a){p.usevectorxml&&p.VectorPageObj.appendCustomBlockAttribute(e,t,a)},this.setBlockColor=function(e,t,a){p.usevectorxml&&(p.VectorPageObj.setBlockColor(e,t,a),p.draw_vector(!1),p.vectorischanged=!0)},this.setBlockHatch=function(e,t,a){p.usevectorxml&&(p.VectorPageObj.setBlockHatch(e,t,a),p.draw_vector(!1),p.vectorischanged=!0)},this.FindBlockByAttr=function(e,t){if(p.usevectorxml)return p.VectorPageObj.FindBlockByAttr(e,t)},this.search3DAttribute=function(e){return p.Vector3DPageObj.searchAttribute(e)},this.get3dVectorBlocks=function(){return p.Vector3DPageObj.getmeshUserData([],!0)},this.search3DAttributesEx=function(e){return p.Vector3DPageObj.searchAttributeJSONEx(e)},this.search3DAttributes=function(e){return p.Vector3DPageObj.searchAttributeJSON(e)},this.getstoreyNames=function(){var e=null;return p.Vector3DPageObj&&(e=p.Vector3DPageObj.getstoreyNames()),e},this.getStoreyRealIDs=function(e){return p.Vector3DPageObj.getStoreyRealIDs(e)},this.getStoreyIDs=function(e){return p.Vector3DPageObj.getStoreyIDs(e)},this.getStoreyAttributes=function(e){return p.Vector3DPageObj.getAttributeStorey(e)},this.searchStoreyAttributesEx=function(e,t){return p.Vector3DPageObj.searchAttributeStoreyEx(e,t)},this.searchStoreyAttributes=function(e,t){return p.Vector3DPageObj.searchAttributeStorey(e,t)},this.set3DBlockTransparency=function(e,t,a){p.Vector3DPageObj.setBlockTransparency(e,t,a)},this.set3DBlockNoSelect=function(e,t){p.Vector3DPageObj.setBlockNoSelect(e,t)},this.reset3DBlockColorsAll=function(e){for(var t=0;t<e.length;t++)if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"==e[t].children[a].type&&(null==e[t].children[a].userData.facecolor?e[t].children[a].userData.facecolor=e[t].children[a].material.color.getHex():e[t].children[a].material.color.setHex(e[t].children[a].userData.facecolor));else if("Mesh"==e[t].type){if(""===e[t].name)continue;null==e[t].userData.facecolor?e[t].userData.facecolor=e[t].material.color.getHex():e[t].material.color.setHex(e[t].userData.facecolor)}},this.reset3DBlockColors=function(){var e=p.Vector3DPageObj.getMeshChildren();if(0!=e.length){p.reset3DBlockColorsAll(e);var t=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0!=t.length)for(var a=0;a<t.length;a++)p.reset3DBlockColorsAll(t[a])}},this.set3DBlockColorOld=function(e,t,a){var i=p.Vector3DPageObj.getMeshChildren();if(0!=i.length)for(var s=0;s<i.length;s++)if("Group"==i[s].type)for(var r=0;r<i[s].children.length;r++)"Mesh"==i[s].children[r].type&&(null==i[s].children[r].userData.facecolor&&(i[s].children[r].userData.facecolor=i[s].children[r].material.color.getHex()),i[s].children[r].name==e&&i[s].children[r].visible&&(a?i[s].children[r].material.color=new THREE.Color(t):i[s].children[r].material.color.setHex(i[s].children[r].userData.facecolor)));else if("Mesh"==i[s].type){if(""===i[s].name)continue;null==i[s].userData.facecolor&&(i[s].userData.facecolor=i[s].material.color.getHex()),i[s].name==e&&i[s].visible&&(a?i[s].material.color=new THREE.Color(t):i[s].material.color.setHex(i[s].userData.facecolor))}},this.set3DBlockDistance=function(e,t,a,i){var s=p.Vector3DPageObj.getMeshByName(e),r=new THREE.Vector3(a.x,a.y,a.z).normalize();r.multiplyScalar(t);var n=new THREE.Vector3;null!=s&&(null==s.userData.posX&&(s.userData.posX=s.position.x),null==s.userData.posY&&(s.userData.posY=s.position.y),null==s.userData.posZ&&(s.userData.posZ=s.position.z),s.visible&&(i?s.position.add(r):(n.set(s.userData.posX,s.userData.posY,s.userData.posZ),s.position.copy(n))))},this.set3DBlockPosition=function(e,t,a){var i=p.Vector3DPageObj.getMeshByName(e),s=new THREE.Vector3;null!=i&&(null==i.userData.posX&&(i.userData.posX=i.position.x),null==i.userData.posY&&(i.userData.posY=i.position.y),null==i.userData.posZ&&(i.userData.posZ=i.position.z),i.visible&&(a?(s.set(t.x,t.y,t.z),i.position=s.clone()):(s.set(i.userData.posX,i.userData.posY,i.userData.posZ),i.position=s.clone())))},this.set3DBlockColor=function(e,t,a){var i=p.Vector3DPageObj.getMeshByName(e);null!=i&&(null==i.userData.facecolor&&(i.userData.facecolor=i.material.color.getHex()),i.visible&&(a?(i.material.color=new THREE.Color(t),i.userData.tempfacecolor=i.material.color.getHex(),i.userData.usetempfacecolor=!0):null!=i.userData.facecolor&&(i.material.color.setHex(i.userData.facecolor),i.userData.usetempfacecolor=!1)))},this.getScreenPoint=function(e){return p.Vector3DPageObj.pointToScreen(e)},this.add3DSymbol=function(e,t){p.Vector3DPageObj.add3DSymbol(e,t)},this.get3DCamerasJSON=function(){for(var e=null,t=p.Vector3DPageObj.getCameraSaves(),a=[],i=0;i<t.length;i++)if("resetView"!=t[i].name){var s={position:null,name:null,tool:null,explodefactor:0,clipping:null,thumbnail:null,width:0,height:0,image:null,selectedmesharray:[],attributes:[]};s.position=t[i].position,s.name=t[i].name,s.tool=t[i].tool,s.explodefactor=t[i].explodefactor,s.clipping=t[i].clipping,s.attributes=t[i].attributes,s.image=Gn(t[i].image),t[i].selectedmesharray&&(s.selectedmesharray=t[i].selectedmesharray.slice()),a.push(s)}return a.length>0&&(e=JSON.stringify(a)),e},this.get3DMarkupJSON=function(){var e=null,t=p.Vector3DPageObj.getMarkupChildren(),a=p.Vector3DPageObj.getmarkupScene();if(0!=t.length)return null!=p.Vector3DPageObj.getmarkupScene()&&(e=JSON.stringify(p.Vector3DPageObj.scene.children[a].toJSON())),e},this.select3DBlock=function(e,t,a){p.usevector3DGLTF?p.select3DBlocknew(e,t,a):p.select3DBlockold(e)},this.show3DViewMarker=function(e){var t=p.Vector3DPageObj.getMarkupChildren();if(0!=t.length)for(var a=0;a<t.length;a++)"camera"==t[a].userData.type&&(p.Vector3DPageObj.set3DViewPos(t[a]),t[a].visible=e)},this.show3Dmarkup=function(e){var t=p.Vector3DPageObj.getMarkupChildren();if(0!=t.length)for(var a=0;a<t.length;a++)"camera"!=t[a].userData.type&&(t[a].visible=e)},this.unSelect3DmarkupAll=function(){var e=p.Vector3DPageObj.getMarkupChildren();if(0!=e.length){for(var t=0;t<e.length;t++)e[t].userData.selected=!1,"symbol"==e[t].userData.type&&(e[t].material[0].transparent=!0,e[t].material[1].transparent=!0,e[t].material[2].transparent=!0,e[t].material[3].transparent=!0,e[t].material[4].transparent=!0,e[t].material[5].transparent=!0),"camera"==e[t].userData.type&&null!=e[t].userData.facecolor&&e[t].material.color.setHex(e[t].userData.facecolor),"dimension"==e[t].userData.type&&p.select3Ddimline(e[t].uuid,!1);null!=Mt&&Mt.setMarkupList(e,hn.bActive)}},this.select3Ddimline=function(e,t){var a=p.Vector3DPageObj.getMarkupChildren();if(0!=a.length)for(var i=0;i<a.length;i++)"dimension"==a[i].userData.type&&a[i].userData.parentref==e&&"LineSegments"==a[i].type&&(a[i].userData.selected=t)},this.resize3DSymbol=function(){var e=p.Vector3DPageObj.getMarkupChildren();if(0!=e.length)for(var t=0;t<e.length;t++)e[t].userData.selected&&e[t].userData.type},this.get3DResetView=function(){var e=null;return p.usevector3DGLTF&&p.Vector3DPageObj&&(e=p.Vector3DPageObj.get3DResetView()),e},this.getCameraimage=function(e){var t=void 0;return p.usevector3DGLTF&&p.Vector3DPageObj&&(t=p.Vector3DPageObj.getCameraimage(e)),t},this.restoreCameraByName=function(e){p.usevector3DGLTF&&p.Vector3DPageObj&&p.Vector3DPageObj.restoreCameraName(e)},this.set3DViewSelectedMesh=function(e){p.usevector3DGLTF&&p.Vector3DPageObj&&p.Vector3DPageObj.set3DViewSelectedMesh(e)},this.select3Dmarkup=function(e){if(p.usevector3DGLTF&&p.Vector3DPageObj){var t=p.Vector3DPageObj.getMarkupChildren();if(0!=t.length){for(var a=0;a<t.length;a++)if(""!==t[a].uuid)if(t[a].uuid==e&&t[a].visible)if(t[a].userData.selected)t[a].userData.selected=!1,"symbol"==t[a].userData.type&&(t[a].material[0].transparent=!0,t[a].material[1].transparent=!0,t[a].material[2].transparent=!0,t[a].material[3].transparent=!0,t[a].material[4].transparent=!0,t[a].material[5].transparent=!0),"dimension"==t[a].userData.type&&p.select3Ddimline(t[a].uuid,!1),"camera"==t[a].userData.type&&null!=t[a].userData.facecolor&&t[a].material.color.setHex(t[a].userData.facecolor);else{"symbol"==t[a].userData.type&&(t[a].material[0].transparent=!1,t[a].material[1].transparent=!1,t[a].material[2].transparent=!1,t[a].material[3].transparent=!1,t[a].material[4].transparent=!1,t[a].material[5].transparent=!1),"dimension"==t[a].userData.type&&p.select3Ddimline(e,!0),"camera"==t[a].userData.type&&(null==t[a].userData.facecolor&&(t[a].userData.facecolor=t[a].material.color.getHex()),t[a].material.color=new THREE.Color(16220659)),t[a].userData.selected=!0;var i={name:t[a].name,index:a,group:!1,groupindex:-1,markup:!0};p.Vector3DPageObj.setSelectedPart(i),null!=St&&St.set3DPartInfo(t[a].userData)}else"Mesh"==t[a].type&&t[a].visible&&(t[a].material.transparent=!0,t[a].userData.selected=!1);null!=Mt&&Mt.setMarkupList(t,hn.bActive)}}},this.setunselect=function(e){e.userData.selected&&(e.userData.usetempfacecolor?null!=e.userData.tempfacecolor&&e.material.color.setHex(e.userData.tempfacecolor):null!=e.userData.facecolor?e.material.color.setHex(e.userData.facecolor):e.userData.facecolor=e.material.color.getHex(),e.userData.selected=!1)},this.getMeshName=function(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e},this.setselect=function(e,t){if(p.unSelect3DmarkupAll(),e.isgroup)var a=B(e.name,e.mesh.type),i=B(e.mesh.name,e.mesh.type);else i=e.mesh.name,a=e.name;if(i==a&&e.mesh.visible)if(e.mesh.userData.selected)e.mesh.userData.selected=!1,e.mesh.userData.usetempfacecolor?null!=e.mesh.userData.tempfacecolor&&e.mesh.material.color.setHex(e.mesh.userData.tempfacecolor):null!=e.mesh.userData.facecolor&&e.mesh.material.color.setHex(e.mesh.userData.facecolor);else{null==e.mesh.userData.facecolor&&(e.mesh.userData.facecolor=e.mesh.material.color.getHex()),"LineSegments"!=e.mesh.type&&(e.mesh.material.color=new THREE.Color(16220659)),e.mesh.userData.selected=!0;var s={name:e.name,index:e.meshindex,group:e.isgroup,groupindex:e.groupindex,isadded:e.isadded,addedmeshindex:e.addedmeshindex,markup:!1};if(p.Vector3DPageObj.setSelectedPart(s),e.mesh.userData.blockRef)var r=p.Vector3DPageObj.blocklist[e.mesh.userData.blockRef];else p.Vector3DPageObj.setBlockRef(e.mesh),r=p.Vector3DPageObj.blocklist[e.mesh.userData.blockRef];null!=Rt&&t&&(null!=r?Rt.set3DPartInfo(r):Rt.set3DPartInfo(e.mesh.userData))}else ys||e.mesh.visible&&e.mesh.userData.selected&&(e.mesh.userData.usetempfacecolor?null!=e.mesh.userData.tempfacecolor&&e.mesh.material.color.setHex(e.mesh.userData.tempfacecolor):null==e.mesh.userData.facecolor?e.mesh.userData.facecolor=e.mesh.material.color.getHex():e.mesh.material.color.setHex(e.mesh.userData.facecolor),e.mesh.userData.selected=!1);return e},this.unselect3DBlockAllAdd=function(e){for(var t=0;t<e.length;t++)if("Group"===e[t].type)for(var a=0;a<e[t].children.length;a++)this.setunselect(e[t].children[a]);else this.setunselect(e[t])},this.unselect3DBlockAll=function(){if(null==p.Vector3DPageObj.cur3Dview){var e=p.Vector3DPageObj.getMeshChildren();p.unselect3DBlockAllAdd(e);for(var t=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),a=0;a<t.length;a++)p.unselect3DBlockAllAdd(t[a])}},this.select3DBlocknewAll=function(e,t,a,i,s){this.Vector3DPageObj.setSelectedPart({name:"",index:-1,group:!1,groupindex:-1,markup:!1,addedmesh:!1,addedmeshindex:-1});for(var r=0;r<e.length;r++)if("Group"===e[r].type)for(var n=0;n<e[r].children.length;n++){var o={mesh:e[r].children[n],name:i,meshindex:r,groupindex:n,isgroup:!0,isadded:t,addedmeshindex:a};o=this.setselect(o,s)}else{if(""===e[r].name)continue;o={mesh:e[r],name:i,meshindex:r,groupindex:-1,isgroup:!1,isadded:t,addedmeshindex:a},o=this.setselect(o,s)}},this.select3DBlocknew=function(e,t,a){var i=p.Vector3DPageObj.getMeshChildren();if(0!=i.length){if(a){var s=p.Vector3DPageObj.getAddedMeshChildren();if(0!=s.length)for(var r=0;r<s.length;r++)p.select3DBlocknewAll(s[r],!0,r,e,t)}else p.select3DBlocknewAll(i,!1,-1,e,t);this.Vector3DPageObj.updateblocklist()}},this.select3DBlockold=function(e){this.Vector3DPageObj.setSelectedPart(-1);for(var t=0;t<p.Vector3DPageObj.scene.children.length;t++)""!==p.Vector3DPageObj.scene.children[t].name&&(p.Vector3DPageObj.scene.children[t].name==e&&isNaN(e)?this.Vector3DPageObj.restoreCameraName(e):p.Vector3DPageObj.scene.children[t].name==e&&p.Vector3DPageObj.scene.children[t].visible?this.Vector3DPageObj.partlist[e].selected?(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].selected=!1,p.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].facecolor)):(p.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(16220659),this.Vector3DPageObj.partlist[e].selected=!0,this.Vector3DPageObj.setSelectedPart(e),null!=Rt&&Rt.set3DPartInfo(this.Vector3DPageObj.partlist[e])):"Mesh"!=p.Vector3DPageObj.scene.children[t].type||isNaN(p.Vector3DPageObj.scene.children[t].name)||p.Vector3DPageObj.scene.children[t].visible&&this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].selected&&(p.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].facecolor),this.Vector3DPageObj.partlist[p.Vector3DPageObj.scene.children[t].name].selected=!1));this.Vector3DPageObj.updateblocklist()},this.vectorbinaryloadBckGrnd=function(e){var t=0,a=0,i=0,s=0,r=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;if(o){var l={role:1,bgColor:Rs,fgColor:Ps,fvonly:!1};if(p.VectorPageObj=new lc(p,o,!0,l),null==p.VectorPageObj)return;if(0==p.VectorPageObj.height||0==p.VectorPageObj.width)return;if(p.originalwidth=p.VectorPageObj.width,p.originalheight=p.VectorPageObj.height,t=Te/p.VectorPageObj.height,a=Me/p.VectorPageObj.width,n=Math.min(a,t),p.fixedScale=n,t=ai/p.VectorPageObj.height,a=ti/p.VectorPageObj.width,r=Math.min(a,t),i=(ti-p.VectorPageObj.width*r)/2,s=(ai-p.VectorPageObj.height*r)/2,p.width=p.VectorPageObj.width,p.height=p.VectorPageObj.height,p.setvectordim(i,s,r),p.printobj.setDocSize(p.VectorPageObj.width,p.VectorPageObj.height),p.loadoverlayvectors&&p.loadfgvectors(),p.loadoverlayimage){var c={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:p.MainImageWidthFrGrnd,y2:p.MainImageHeightFrGrnd,imagestr:p.Vector2DImageSRCFrGrnd};p.VectorPageObj.addimage(c,!1,l)}p.loadoverlaypdf&&(c={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:p.PDFWidthFrGrnd,y2:p.PDFHeightFrGrnd},p.VectorPageObj.addpdfimage(c,!1,l))}}},this.vectorbinaryloadFrGrnd=function(e){var t=0,a=0,i=0,s=0,r=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;if(o){var l={role:2,bgColor:Rs,fgColor:Ps};if(p.loadbackgroundvectors?p.VectorPageObj.addvectors(o,l):p.VectorPageObj=new lc(p,o,!0,l),null==p.VectorPageObj)return;if(0==p.VectorPageObj.height||0==p.VectorPageObj.width)return;if(null!=la&&la.setDownload("hide"),p.originalwidth=p.VectorPageObj.width,p.originalheight=p.VectorPageObj.height,t=Te/p.VectorPageObj.height,a=Me/p.VectorPageObj.width,n=Math.min(a,t),p.fixedScale=n,t=ai/p.VectorPageObj.height,a=ti/p.VectorPageObj.width,r=Math.min(a,t),i=(ti-p.VectorPageObj.width*r)/2,s=(ai-p.VectorPageObj.height*r)/2,p.width=p.VectorPageObj.width,p.height=p.VectorPageObj.height,p.setvectordim(i,s,r),p.printobj.setDocSize(p.VectorPageObj.width,p.VectorPageObj.height),p.loadbackgroundimage){var c={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:p.MainImageWidthBckGrnd,y2:p.MainImageHeightBckGrnd,imagestr:p.Vector2DImageSRCBckGrnd};p.VectorPageObj.addimage(c,!0,l)}p.loadbackgroundpdf&&(c={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:p.PDFWidthBckGrnd,y2:p.PDFHeightBckGrnd},p.VectorPageObj.addpdfimage(c,!0,l))}}},this.vectorbinaryload=function(e){var t=0,a=0,i=0,s=0,r=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;o&&(p.VectorPageObj=new lc(p,o,!0),(null==p.VectorPageObj||p.VectorPageObj.invalid)&&(p.invalid=!0),0!=p.VectorPageObj.height&&0!=p.VectorPageObj.width||(p.invalid=!0),null!=la&&la.setDownload("hide"),p.invalid?p.DocRef.removepage(p):(p.originalwidth=p.VectorPageObj.width,p.originalheight=p.VectorPageObj.height,t=Te/p.VectorPageObj.height,a=Me/p.VectorPageObj.width,n=Math.min(a,t),p.fixedScale=n,t=ai/p.VectorPageObj.height,a=ti/p.VectorPageObj.width,r=Math.min(a,t),i=(ti-p.VectorPageObj.width*r)/2,s=(ai-p.VectorPageObj.height*r)/2,p.width=p.VectorPageObj.width,p.height=p.VectorPageObj.height,p.setvectordim(i,s,r),p.printobj.setDocSize(p.VectorPageObj.width,p.VectorPageObj.height)))}},this.vectorbinprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},this.vectorprogress=function(e){e.currentTarget.getResponseHeader("Content-Length")>1e7&&(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&(alert("This file is currently too large for your device. Check back for an update shortly "),null!=la&&la.setDownload("hide"),e.currentTarget.abort()),e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},this.vectorabort=function(e){Qd()},this.vector3Dbinprogress=function(e){d.domElement.style.visibility="visible",e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},this.vector3Dprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=la&&la.setDownload("hide")},this.vector3Dabort=function(e){Qd()},this.vector3DblocknavloadJSON=function(e){200==e.currentTarget.status&&JSON.parse(e.currentTarget.responseText)},this.vector3Dblocknavload=function(e){if(200==e.currentTarget.status){var t=e.currentTarget.responseXML;if(null==t||null==t.documentElement)try{t=So(this.responseText)}catch(e){return void alert("Error 1 - "+e)}p.Vector3DPageObj.addblocks(t)}},this.glTFstoreyLoadComplete=function(){null!=_e&&_e.loadComplete(p.DocRef.OriginalURL,p.DocRef.bActive)},this.gltfAddLoadComplete=function(e){null!=e&&p.loadAddIFCJSON(e)},this.glTFloadComplete=function(e,t,a,i){p.walkthroughcontrol=new cc;var s=p.Vector3DPageObj.getfloorElevation(0),r=p.Vector3DPageObj.getfloorheight(),n=p.Vector3DPageObj.getmeterunit(),c=p.Vector3DPageObj.boxCenter.z;if(p.walkthroughcontrol.setwalkHeight(s+r),p.walkthroughcontrol.setTempWalkHeight(c),p.walkthroughcontrol.setwalkUnit(n),p.walkthroughcontrol.setwalkSpeed(50),p.walkthroughcontrol.setinitial(t,e),p.loadIFCJSON(),p.StoreyMetadata.length>0)for(var h=0;h<p.StoreyMetadata.length;h++)p.loadStoreyJSON(p.StoreyMetadata[h]);p.loadIFCNavigator(),o&&!p.DocRef.markuploaded&&(nr?Wc(l,p.DocRef):or?_c(p.DocRef):Xc(l,p.DocRef)),p.printobj.setDocSize(ti,ai),Hs=!0,gi=!0,hu(!0),Cd(),Ed(),p.Vector3DPageObj.modelLoaded=!0,p.Vector3DPageObj.load3Dmarkupcheck(),0==p.StoreyMetadata.length&&null!=_e&&_e.loadComplete(p.DocRef.OriginalURL,p.DocRef.bActive)},this.IFCJSONloadAdd=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}p.Vector3DPageObj.addblockscombine(t)}},this.loadAddIFCJSON=function(e){var t=[{event:"loadend",func:p.IFCJSONloadAdd}];Mh("GET",e,"",t)},this.IFCJSONNavload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}p.Vector3DPageObj.addNavlist(t)}},this.loadIFCNavigator=function(){if(!p.NavigatorJSONSRC){var e=zo(p.Vector3DBinarySRC);this.NavigatorJSONSRC=e+"navigator.json"}var t=[{event:"loadend",func:p.IFCJSONNavload}];Mh("GET",p.NavigatorJSONSRC,"",t)},this.IFCJSONload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}p.Vector3DPageObj.addblocks(t)}},this.loadIFCJSON=function(){if(!p.VectorMetadataSRC){var e=zo(p.Vector3DBinarySRC);p.VectorMetadataSRC=e+"1_1.json"}var t=[{event:"loadend",func:p.IFCJSONload}];Mh("GET",p.VectorMetadataSRC,"",t)},this.storeyJSONload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}p.Vector3DPageObj.addstoreys(t)}},this.loadStoreyJSON=function(e){Fh("GET",e.src,"").then((function(t){var a=JSON.parse(t);p.Vector3DPageObj.addstoreys(a,e.name,e.id,e.index,e.Elevation)})).catch((function(e){e.status||console.log(e)}))},this.loadGLTFSpaces=function(){if(p.usevector3DGLTF&&p.Vector3DPageObj){var e=zo(p.Vector3DBinarySRC);p.VectorSpaceDataSRC=e+"spaces.glb",p.addtoGLTFScene(p.VectorSpaceDataSRC)}},this.addtoGLTFScene=function(e,t){p.usevector3DGLTF&&p.Vector3DPageObj&&p.Vector3DPageObj.addToScene(e,t)},this.vector3DGltfload=function(){null!=sa&&sa.setUpload("show"),p.Vector3DPageObj=new mc(p.Vector3DBinarySRC,p),zo(p.Vector3DBinarySRC)},this.vector3DBinaryload=function(e){200==e.currentTarget.status&&(g=e.currentTarget.response)&&(p.Vector3DPageObj=new yc(g,!0,p),p.walkthroughcontrol=new hc,p.walkthroughcontrol.movementSpeed=10,p.walkthroughcontrol.lookSpeed=.125,p.walkthroughcontrol.lookVertical=!0,p.printobj.setDocSize(ti,ai),gi=!0,hu(!0),Cd())},this.vectorpart3Dload=function(e){if(200==e.currentTarget.status){var t=e.currentTarget.responseXML;if(null==t||null==t.documentElement)try{t=So(this.responseText)}catch(e){return void alert("Error 1 - "+e)}p.VectorPartfilelist.length}},this.vector3Dpartprogress=function(e){},this.load3dvectorPart=function(){for(var e=0;e<p.VectorPartfilelist.length;e++){var t=[{event:"load",func:p.vectorpart3Dload},{event:"progress",func:p.vector3Dpartprogress}];Mh("GET",p.VectorPartfilelist[e],"",t)}},this.load3dnavigator=function(){var e=[{event:"load",func:p.vector3Dblocknavload},{event:"progress",func:p.vector3Dprogress},{event:"abort",func:p.vector3Dabort}];Mh("GET",p.Navigator3DSRC,"",e)},this.loadvectors3DBinary=function(){null!=la&&la.setDownload("show");var e=[{event:"loadend",func:p.vector3DBinaryload},{event:"progress",func:p.vector3Dbinprogress},{event:"abort",func:p.vector3Dabort}];Mh("GET",p.Vector3DBinarySRC,"arraybuffer",e)},this.loadvectors3D=function(){var e=[{event:"load",func:p.vector3Dload},{event:"progress",func:p.vector3Dprogress},{event:"abort",func:p.vector3Dabort}];Mh("GET",p.Vector3DSRC,"",e)},this.loadcomparevectors=function(){p.loadbackgroundvectors?p.loadbgvectors():p.loadoverlayvectors?p.loadfgvectors():p.createEmptyVectorpage()},this.createEmptyVectorpage=function(){var e,t,a,i,s=0,r=0,n={role:1,bgColor:Rs,fgColor:Ps},o={x:0,y:0,w:0,h:0,scale:1,offsetx:0,offsety:0,iscompare:!0,bgcolor:Rs,fgcolor:Ps};if(p.loadbackgroundimage)null!=p.MainImageWidthBckGrnd&&(o.w=parseInt(p.MainImageWidthBckGrnd),o.h=parseInt(p.MainImageHeightBckGrnd),o.scaling=parseFloat(p.MainImageScalingBckGrnd));else if(p.loadoverlayimage)null!=p.MainImageWidthFrGrnd&&(o.w=parseInt(p.MainImageWidthFrGrnd),o.h=parseInt(p.MainImageHeightFrGrnd),o.scaling=parseFloat(p.MainImageScalingFrGrnd));else if(p.loadbackgroundpdf)null!=p.PDFWidthBckGrnd&&(o.w=p.PDFWidthBckGrnd,o.h=p.PDFHeightBckGrnd,o.scaling=1);else{if(!p.loadoverlaypdf)return;null!=p.PDFWidthFrGrnd&&(o.w=p.PDFWidthFrGrnd,o.h=p.PDFHeightFrGrnd,o.scaling=1)}if(p.VectorPageObj=new lc(p,o,!1,n),null!=p.VectorPageObj&&0!=p.VectorPageObj.height&&0!=p.VectorPageObj.width){if(p.originalwidth=p.VectorPageObj.width,p.originalheight=p.VectorPageObj.height,s=Te/p.VectorPageObj.height,r=Me/p.VectorPageObj.width,i=Math.min(r,s),p.fixedScale=i,s=ai/p.VectorPageObj.height,r=ti/p.VectorPageObj.width,a=Math.min(r,s),e=(ti-p.VectorPageObj.width*a)/2,t=(ai-p.VectorPageObj.height*a)/2,p.width=p.VectorPageObj.width,p.height=p.VectorPageObj.height,p.setvectordim(e,t,a),p.printobj.setDocSize(p.VectorPageObj.width,p.VectorPageObj.height),p.loadbackgroundimage){var l={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:p.MainImageWidthBckGrnd,y2:p.MainImageHeightBckGrnd,imagestr:p.Vector2DImageSRCBckGrnd};p.VectorPageObj.addimage(l,!0,n)}p.loadoverlayimage&&(l={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:p.MainImageWidthFrGrnd,y2:p.MainImageHeightFrGrnd,imagestr:p.Vector2DImageSRCFrGrnd},p.VectorPageObj.addimage(l,!1,n)),p.loadbackgroundpdf&&(l={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:p.PDFWidthBckGrnd,y2:p.PDFHeightBckGrnd},p.VectorPageObj.addpdfimage(l,!0,n)),p.loadoverlaypdf&&(l={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:p.PDFWidthFrGrnd,y2:p.PDFHeightFrGrnd},p.VectorPageObj.addpdfimage(l,!1,n))}},this.loadbgvectors=function(){var e=[{event:"load",func:p.vectorbinaryloadBckGrnd},{event:"progress",func:p.vectorbinprogress},{event:"abort",func:p.vectorabort}];Mh("GET",p.Vector2DBinarySRCBckGrnd,"arraybuffer",e)},this.loadfgvectors=function(){var e=[{event:"load",func:p.vectorbinaryloadFrGrnd},{event:"progress",func:p.vectorbinprogress},{event:"abort",func:p.vectorabort}];Mh("GET",p.Vector2DBinarySRCFrGrnd,"arraybuffer",e)},this.loadbinvectors=function(){null!=la&&la.setDownload("show");var e=[{event:"load",func:p.vectorbinaryload},{event:"progress",func:p.vectorbinprogress},{event:"abort",func:p.vectorabort}];Mh("GET",p.Vector2DBinarySRC,"arraybuffer",e)},this.loadvectors=function(){var e=[{event:"load",func:p.vectorload},{event:"progress",func:p.vectorprogress},{event:"abort",func:p.vectorabort}];Mh("GET",p.Vector2DSRC,"",e)},this.backupScaleAndOffset=function(){p.usevectorxml?(p.dscalebackup=p.dscalevector,p.dxbackup=p.dxvector,p.dybackup=p.dyvector):p.usepdfjs?(p.dscalebackup=p.dscalepdf,this.curpagescalebackup=p.curpagescale,p.dxbackup=p.dxpdf,p.dybackup=p.dypdf):(p.dscalebackup=p.dscale,p.dxbackup=p.dx,p.dybackup=p.dy)},this.getCurPageScale=function(){return p.curpagescale},this.restoreScaleAndOffset=function(){p.usevectorxml?(p.dscalevector=p.dscalebackup,p.dxvector=p.dxbackup,p.dyvector=p.dybackup):p.usepdfjs?(p.dscalepdf=p.dscalebackup,p.curpagescale=p.curpagescalebackup,p.dxpdf=p.dxbackup,p.dypdf=p.dybackup):(p.dscalebackup=p.dscale=p.dscalebackup,p.dx=p.dxbackup,p.dy=p.dybackup)},this.setPDFDiminit=function(e,t,a){this.pageloaded=!1,this.dxpdf=e,this.dypdf=t,this.dscalepdf=a,p.setpagedimsize(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf,!1),this.pagedimset=!0,this.pdfdiminitset=!0,o&&(vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive())),p.pagenumber==p.DocRef.pages.length-1&&null!=mt&&mt.loadComplete(p.DocRef.FileName,p.DocRef.bActive)},this.setPFDdimnodraw=function(e,t,a,i){this.dxpdf=e,this.dypdf=t,i&&(this.dscalepdf=a),p.setpagedimsize(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf,!1),p.pagedimset=!0},this.setPDFdim=function(e,t,a){p.pageloaded=!0,p.pdfdiminitset||(p.dxpdf=e,p.dypdf=t,p.setpagedimsize(p.dxpdf,p.dypdf,p.offscreenwidth*p.dscalepdf,p.offscreenheight*p.dscalepdf,!1),this.pagedimset=!0,p.pdfdiminitset=!0,p.pageloading=!1,p.backupScaleAndOffset(),o&&(vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive()),null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getLayerNodes(),p.visible=!0,null!=la&&la.setDownload("hide"),null!=_e&&_e.loadComplete(p.DocRef.OriginalURL,p.DocRef.bActive),null!=ja&&(p.DocRef.hastext=!0,ja.hasText(p.DocRef.hastext,p.DocRef.bActive)),p.draw_canvas(!0),Lp(),p.DocRef.getfoxitThumbnail(0))),p.dscalepdf=1,!o||p.DocRef.markuploaded||p.markuplistloaded||(nr?Wc(l,p.DocRef):or?_c(p.DocRef):(p.markuplistloaded=!0,Xc(l,p.DocRef))),o&&p.pdfdiminitset,o&&p.pdfdiminitset,p.DocRef.setthumbnail(p.pdfpagewidth,p.pdfpageheight,p.pagenumber),null!=nt&&(nt.loadComplete(p.pagenumber),p.DocRef.loadPageEvt(p.pagenumber)),p.DocRef.draw_mpagepdf(!1),p.backupScaleAndOffset()},this.istextvisible=function(e,t){var a=!1;return Math.max(0,e),Math.min(ti,e),Math.max(ai,t),Math.min(0,t),e>0&&e<ti&&t>0&&t<ai&&(a=!0),a},this.ispagevisible=function(){var e=!1;if(p.usepdfjs){if(null!=p.DocRef.pages[p.DocRef.currentpage]){Math.max(0,p.DocRef.pages[p.DocRef.currentpage].startx),Math.min(ti,p.DocRef.pages[p.DocRef.currentpage].endx);var t=p.DocRef.pages[p.DocRef.currentpage].endy,a=p.DocRef.pages[p.DocRef.currentpage].starty;p.DocRef.currentpage==p.pagenumber?e=!0:(p.pagenumber==p.DocRef.currentpage+1&&t<ai-2&&(e=!0),p.pagenumber==p.DocRef.currentpage-1&&a>2&&(e=!0))}}else e=p.DocRef.currentpage==p.pagenumber;return e},this.changeinterval=function(e){clearInterval(p.vectortimervar),p.vectorpagetime=e,p.vectortimervar=setInterval((function(){p.vectortimer()}),p.vectorpagetime)},this.vectortimer=function(){if(null!=p.DocRef&&p.DocRef.bActive){if(null==p)return;if(null==p.DocRef.pages[p.DocRef.currentpage])return;p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&(p.VectorPageObj.offscreenscale(p.dscalevector),p.vectorischanged&&(p.draw_vector(!0),p.vectorischanged=!1))}},this.pdftimer=function(){p.DocRef.pages.length},this.queRenderCompareScale=function(e){p.pageRendering?p.pageNumPending=p.pagenumber+1:p.renderPDFComparescale(e)},this.continueCallback=function(e){p.pagenumber,p.DocRef.pages[p.DocRef.currentpage].pagenumber,e()},this.foxitRenderPageScaled=function(){var e=p.offscreenwidth*p.dscalepdf/pagewidth,t=p.offscreenheight*p.dscalepdf/pageheight,a=Math.min(e,t);null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.renderScale(p.pagenumber,a)},this.setpagesize=function(e,t){p.offscreenwidth=e,p.offscreenheight=t},this.collapsetileArray=function(){for(var e=0;e<p.canvtileArray.length;e++)for(var t=0;t<p.canvtileArray[e].length;t++)p.canvtileArray[e][t].cnv.width=1,p.canvtileArray[e][t].cnv.height=1,p.canvtileArray[e][t].ctx=null,p.canvtileArray[e][t].cnv=null;p.canvtileArray=[],p.annotArray=[]},this.collapsepage=function(){p.iscollapsed||(p.iscollapsed=!0,p.setNotCollapsedArray(),p.collapsetileArray(),p.PDFPointArray=[],p.bpointlistSet=!1)},this.setPDFTextAra=function(t){p.PDFTextArea.id="PDFpage"+t,p.PDFTextArea.style.left=p.pdfdxtemp+"px",p.PDFTextArea.style.width=p.width+"px",p.PDFTextArea.style.height=p.height+"px",p.PDFTextArea.style.zIndex="4",e.appendChild(p.PDFTextArea),1==t&&p.DocRef.textselect?p.PDFTextArea.style.display=li:p.PDFTextArea.style.display="none",p.textareaset=!0},this.drawpoints=function(e,t){p.PDFinternalScale.x>0&&p.PDFinternalScale.x,p.PDFinternalScale.y>0&&p.PDFinternalScale.y;var i=p.offscreenheight*p.dscalepdf,s=p.offscreenwidth*p.dscalepdf;p.PDFpageRotate;for(var r=0;r<e.length;r++){if(0!=p.PDFpageRotate)if(90==p.PDFpageRotate)var n=p.starty+-e[r].y*t,o=p.startx+e[r].x*t;else n=p.starty+(-e[r].y*t+i),o=p.startx+e[r].x*t+s;else n=e[r].y<0?p.starty+-e[r].y*t:p.starty+(-e[r].y*t+i),o=e[r].x<0?p.startx+e[r].x*t+s:p.startx+e[r].x*t;$p(a,0,{x:o,y:n})}},this.getdivpos=function(e){var t={x:0,y:0,w:0,h:0};if(p.pan_update(0,0),null!=p.PDFTextArea&&null!=p.PDFTextArea.children[e]){var a=p.PDFTextArea.children[e],i=p.PDFTextArea.offsetTop,s=p.PDFTextArea.offsetLeft;t.y=a.offsetTop+i,t.x=a.offsetLeft+s,t.w=a.offsetWidth,t.h=a.offsetHeight}if(null!=p.TextSelectArea&&null!=p.TextSelectArea.children[e]){var r=p.TextSelectArea.children[e],n=p.TextSelectArea.offsetTop,o=p.TextSelectArea.offsetLeft;t.y=r.offsetTop+n,t.x=r.offsetLeft+o,t.w=r.offsetWidth,t.h=r.offsetHeight}return t},this.indexdivTexts=function(){var e=[];if(null!=p.PDFTextArea)for(var t=p.PDFTextArea.children,a=0;a<t.length;a++){t[a].style.backgroundColor=null;var i=t[a];e.push(i.textContent)}if(null!=p.TextSelectArea)for(var s=p.TextSelectArea.children,r=0;r<s.length;r++){s[r].style.backgroundColor=null;var n=s[r];e.push(n.textContent)}return e},this.clearmarktextdiv=function(e,t){if(null!=p.PDFTextArea&&null!=p.PDFTextArea.children[e]){p.PDFTextArea.children[e].innerHTML="";var a=document.createTextNode(t);p.PDFTextArea.children[e].appendChild(a)}if(null!=p.TextSelectArea&&null!=p.TextSelectArea.children[e]){p.TextSelectArea.children[e].innerHTML="";var i=document.createTextNode(t);p.TextSelectArea.children[e].appendChild(i)}},this.marktextdiv=function(e,t,a,i){if(null!=p.PDFTextArea){var s=t.substring(a,i+a),r=t.split(" ");if(null!=p.PDFTextArea.children[e]){p.PDFTextArea.children[e].innerHTML="";for(var n=0,o=0;o<r.length;o++){var l=r[o].search(s);if(-1==l){if(n>0)var c=document.createTextNode(r[o]+" ");else c=document.createTextNode(r[o]);p.PDFTextArea.children[e].appendChild(c),n++}else if(l>=0){var h=document.createElement("span");h.className="highlight",c=document.createTextNode(s),h.appendChild(c),p.PDFTextArea.children[e].appendChild(h),n=0}}}}if(null!=p.TextSelectArea){var d=t.substring(a,i+a),u=t.split(d);if(null!=p.TextSelectArea.children[e]){p.TextSelectArea.children[e].innerHTML="";for(var g=0;g<u.length;g++){if(g>0){var f=document.createElement("span");f.className="highlight";var m=document.createTextNode(d);f.appendChild(m),p.TextSelectArea.children[e].appendChild(f)}""!=u[g]&&(m=document.createTextNode(u[g]),p.TextSelectArea.children[e].appendChild(m))}}}},this.getVectorSearchList=function(){p.getVectorSearchListSearch(p.DocRef.searchobj)},this.getVectorSearchListSearch=function(e){for(var t=p.indexdivTexts(),a=e.casesens,i=e.expr,s=0;s<t.length;s++){if(a)r=i,n=t[s];else var r=i.toLowerCase(),n=t[s].toLowerCase();var o=!1,l=n.search(r);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:p.pagenumber,indx:s,searchtext:t[s],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getVectorSearchListRect=function(e){for(var t=p.indexdivTexts(),a=e.casesens,i=e.expr,s=0;s<t.length;s++){if(a)r=i,n=t[s];else var r=i.toLowerCase(),n=t[s].toLowerCase();var o=!1,l=n.search(r);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:p.pagenumber,indx:s,searchtext:t[s],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getPDFSearchList=function(){for(var e=p.indexdivTexts(),t=p.DocRef.searchobj.casesens,a=p.DocRef.searchobj.expr,i=0;i<e.length;i++){if(t)s=a,r=e[i];else var s=a.toLowerCase(),r=e[i].toLowerCase();var n=!1,o=r.search(s);if(-1==o?n=!1:o>=0&&(n=!0),n){var l={page:p.pagenumber,indx:i,searchtext:e[i],pos:o,length:a.length};p.DocRef.searchobj.matcharray.push(l)}}},this.getrotcoords=function(e,t,a,i,s){var r=Math.PI/180*s,n=Math.cos(r),o=Math.sin(r);return{x:n*(a-e)+o*(i-t)+e,y:n*(i-t)-o*(a-e)+t}},this.getSearchTextRect=function(){if(p.DocRef.extractsearchobj.page==p.pagenumber){if(p.usevectorxml){p.settextdivs(),p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].searchtext;var e=p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].indx;p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].pos,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].length}p.usepdfjs&&(p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].searchtext,e=p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].indx,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].pos,p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].length);var t=p.getdivpos(e);p.DocRef.extractsearchobj.matcharray[p.DocRef.extractsearchobj.indx].rect=t}var a=ai/2,i=ti/2;p.getpagerect(),0!=p.getpageRotation()&&p.getrotcoords(i,a,t.x,t.y,-p.getpageRotation())},this.getsearchpanupdate=function(e,t){var a=si/2,i=ii/2,s=ii,r=si,n=0,o=0;if(0!=p.getpageRotation()){var l=p.getrotcoords(i,a,e,t,-p.getpageRotation());c=Math.max(l.x,s)-Math.min(l.x,s),(Math.max(l.x,s)==l.x||c<300)&&(n=l.x-i),h=Math.max(l.y,r)-Math.min(l.y,r),(Math.max(l.y,r)==l.y||h<100)&&(o=l.y-a),d=Math.max(l.x,0)-Math.min(l.x,0),(Math.min(l.x,0)==l.x||d<100)&&(n=-(i-l.x)),u=Math.max(l.y,0)-Math.min(l.y,0),(Math.min(l.y,0)==l.y||u<100)&&(o=-(a-l.y))}else{var c=Math.max(e,s)-Math.min(e,s);(Math.max(e,s)==e||c<300)&&(n=e-i);var h=Math.max(t,r)-Math.min(t,r);(Math.max(t,r)==t||h<100)&&(o=t-a);var d=Math.max(e,0)-Math.min(e,0);(Math.min(e,0)==e||d<100)&&(n=-(i-e));var u=Math.max(t,0)-Math.min(t,0);(Math.min(t,0)==t||u<100)&&(o=-(a-t))}return{x:n,y:o}},this.loadfloorplan=function(){for(var e=0;e<p.floorplans.length;e++)p.floorplanlolad(e)},this.drawcamerapos=function(){p.bis3Dnavigator&&vs&&p.birdseyecamera()},this.setFloorNavScaleOffset=function(e){if(p.bis3Dnavigator){var t=e[0].scaleinfo.scaledDistance,a=e[1].scaleinfo.scaledDistance,i=e[0].scaleinfo.curscale,s=e[1].scaleinfo.curscale,r=(e[0].dist,e[0].pwidth,e[1].dist,e[1].pwidth,a*s/i/t),n=t/a;e[1].dist,e[1].pwidth,e[0].dist,e[0].pwidth,p.navfloorplan.RScale=n;var o=e[1].offset.x*n,l=e[1].offset.y*n,c=-(o-e[0].offset.x),h=-(l-e[0].offset.y);p.navfloorplan.offsetX=c,p.navfloorplan.offsetY=h,p.navfloorplan.replaceScale=r,p.navfloorplan.replaced=!0}},this.setAs3DNavigator=function(e,a){for(var i=[],s=0;s<e.length;s++)i.push({Elevation:e[s].Elevation,index:s});null!=a&&(p.bis3Dnavigator=!0,p.navfloorplan={index:e[a].index,SRC:e[a].SRC,Elevation:e[a].Elevation,Elevations:i,Scale:e[a].Scale,BScale:e[a].BScale,RScale:e[a].RScale,image:e[a].image,canvas:e[a].canvas,ctx:e[a].ctx,replaced:e[a].replaced,originalWidth:e[a].originalWidth,originalHeight:e[a].originalHeight,width:e[a].width,height:e[a].height,offsetX:e[a].offsetX,offsetY:e[a].offsetY,alignarray:e[a].alignarray},null==p.birdseyemarker&&(p.birdseyemarker=new vc(t)))},this.birdseyecamera=function(){p.bis3Dnavigator&&p.DocRef.bActive&&p.navfloorplan&&(a.clearRect(0,0,t.width,t.height),p.birdseyemarker.drawme(a,!0))},this.getFloorLevel=function(){var e=null;return p.navfloorplan&&(e={floorindex:p.navfloorplan.index,replaced:p.navfloorplan.replaced}),e},this.get3DNavElevation=function(e){return p.navfloorplan.index==e.max},this.setcamerapos=function(e,t,a){p.camerapos=e.clone(),p.boxcenter=a.clone(),p.setbirdseyecamera(p.camerapos,t,a)},this.getnavcampos=function(e,t,a){if(p.DocRef.bActive&&p.navfloorplan&&null!=t){p.birdseyedispeye.distance=0,p.birdseyedispeye.rotation={degrees:90,radians:.5*Math.PI};var i=p.getpagedim();if(p.birdseyedispeye.r=32,p.navfloorplan.replaced){var s=i.scale/p.navfloorplan.RScale;p.birdseyedispeye.x=.5*p.navfloorplan.originalWidth*s+i.x,p.birdseyedispeye.y=.5*p.navfloorplan.originalHeight*s+i.y,p.birdseyedispeye.scale=s*p.navfloorplan.Scale,p.birdseyedispeye.x+=-p.navfloorplan.offsetX*s,p.birdseyedispeye.y+=-p.navfloorplan.offsetY*s}else p.birdseyedispeye.x=.5*i.w+i.x,p.birdseyedispeye.y=.5*i.h+i.y,p.birdseyedispeye.scale=i.scale*p.navfloorplan.Scale;p.birdseyedispeye.boxcenter=t,p.birdseyedispeye.camerapos=t;var r=p.navfloorplan.index,n=p.getCurfloorElevation(r,e),o=p.birdseyemarker.getcamera(p.birdseyedispeye,a.xus,a.yus);return o.z=n,o}},this.getfloorheight=function(e){return 1==e?1.8:0==e?1800:2==e?5.9:3==e?69:4==e?180:void 0},this.getCurfloorElevation=function(e,t){var a=null;if(null!=p.navfloorplan&&p.navfloorplan.index==e){var i=p.getfloorheight(t);a=p.navfloorplan.Elevation+i}return a},this.setbirdseyecamera=function(e,t,a){if(p.DocRef.bActive&&p.navfloorplan&&!(null==a&&null==a||null==e&&null==e)){null==t&&(t={degrees:90,radians:.5*Math.PI}),p.birdseyedispeye.distance=e.distanceTo(a),p.birdseyedispeye.rotation=t;var i=p.getpagedim();if(p.birdseyedispeye.r=32,p.navfloorplan.replaced){var s=i.scale/p.navfloorplan.RScale;p.birdseyedispeye.x=.5*p.navfloorplan.originalWidth*s+i.x,p.birdseyedispeye.y=.5*p.navfloorplan.originalHeight*s+i.y,p.birdseyedispeye.scale=s*p.navfloorplan.Scale,p.birdseyedispeye.x+=-p.navfloorplan.offsetX*s,p.birdseyedispeye.y+=-p.navfloorplan.offsetY*s}else p.birdseyedispeye.scale=i.scale*p.navfloorplan.Scale,p.birdseyedispeye.x=.5*i.w+i.x,p.birdseyedispeye.y=.5*i.h+i.y;p.birdseyedispeye.boxcenter=a,p.birdseyedispeye.camerapos=e,p.birdseyemarker.setcamera(p.birdseyedispeye)}},this.showFoxitSearchOnUpdate=function(){p.drawtextSearchRect=!0},this.showFoxitSearch=function(){if(p.DocRef.foxitsearchobj.page==p.pagenumber){var e=p.DocRef.foxitsearchobj.getcurmatch(),t=e.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,a=(p.pdfpageheight-e.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,i=p.getsearchpanupdate(t,a);p.pan_update(i.x,i.y),p.drawtextSearchRect=!0,p.drawsearchRect()}},this.showBookmark=function(e){if(e.page==p.pagenumber){var t=e.left*(p.curpagescale*p.dscalepdf)+p.dxpdf,a=(p.pdfpageheight-e.top)*(p.curpagescale*p.dscalepdf)+p.dypdf;p.pan_update(t,a)}},this.showSearch=function(){if(p.DocRef.searchobj.page==p.pagenumber){p.usevectorxml&&p.settextdivs();var e=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].searchtext,t=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].indx,a=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].pos,i=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].length,s=p.getdivpos(t),r=p.getsearchpanupdate(s.x,s.y);p.pan_update(r.x,r.y),p.marktextdiv(t,e,a,i)}},this.foxitClearSearch=function(){p.DocRef.foxitsearchobj.page==p.pagenumber&&(p.drawtextSearchRect=!1)},this.clearSearch=function(){if(p.DocRef.searchobj.page==p.pagenumber){var e=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].searchtext,t=p.DocRef.searchobj.matcharray[p.DocRef.searchobj.indx].indx;p.clearmarktextdiv(t,e)}},this.loadimages=function(){null!=la&&la.setDownload("show"),p.largeimageload()},this.setvectordim=function(t,a,i){if(null!=p.VectorPageObj){this.dxvector=t,this.dyvector=a,this.dscalevector=i,this.initialscale=i,this.vectorloaded=!0,p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),this.pagedimset=!0,p.draw_vector(!0),p.vectorpagetime=p.VectorPageObj.vectorpagetime,p.vectortimervar=setInterval((function(){p.vectortimer()}),p.vectorpagetime);var s=p.endx-p.startx,r=p.endy-p.starty;if(p.VectorPageObj.textlist.length>0&&p.settextdivs(!0),null!=p.TextSelectArea){var n=U(p.startx,p.starty,s,r);p.TextSelectArea.style.top=n.y+"px",p.TextSelectArea.style.left=n.x+"px",p.TextSelectArea.style.width=n.w+"px",p.TextSelectArea.style.height=n.h+"px",e.appendChild(p.TextSelectArea),o&&p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none"}if(o&&!p.DocRef.markuploaded&&(nr?Wc(l,p.DocRef):or?_c(p.DocRef):Xc(l,p.DocRef)),vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive()),p.DocRef.bDoPrint&&p.DocRef.checkprintready()&&wh(),Lp(),o){if(ue){if(null!=Qe){var c={docindex:p.DocRef.fileindex,pageindex:p.pagenumber,floorindex:ge};Qe.loadComplete(p.DocRef.FileName,p.DocRef.bActive,c)}ue=!1,ge=null}null!=_e&&_e.loadComplete(p.DocRef.FileName,p.DocRef.bActive)}null!=nt&&nt.loadComplete(p.pagenumber)}},this.removetext=function(){null!=p.TextSelectArea&&(p.TextSelectArea.removeEventListener("wheel",tu,!0),p.TextSelectArea.remove())},this.selecttext=function(){null!=p.TextSelectArea&&(p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none")},this.movetextdivs=function(){if(null!=p.TextSelectArea){Hl();var e=ai/2,t=ti/2;p.TextSelectArea.removeAttribute("style");var a=p.endx-p.startx,i=p.endy-p.starty,s=t-p.startx,r=e-p.starty,n=U(p.startx,p.starty,a,i);if(p.TextSelectArea.style.top=n.y+"px",p.TextSelectArea.style.left=n.x+"px",p.TextSelectArea.style.width=n.w+"px",p.TextSelectArea.style.height=n.h+"px",p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none",0!=this.getpageRotation()){var o=s+"px "+r+"px";p.TextSelectArea.style.transformOrigin=o,p.TextSelectArea.style.transform="rotate("+this.getpageRotation()+"deg)"}}},this.settextdivs=function(){if(null!=p.TextSelectArea){p.TextSelectArea.removeAttribute("style");var e=_(),t=p.endx-p.startx,a=p.endy-p.starty,i=U(e.dx,e.dy,t,a);p.TextSelectArea.style.top=i.y+"px",p.TextSelectArea.style.left=i.x+"px",p.TextSelectArea.style.width=i.w+"px",p.TextSelectArea.style.height=i.h+"px",p.DocRef.textselect?p.TextSelectArea.style.display=li:p.TextSelectArea.style.display="none",0!=this.getpageRotation()&&(p.TextSelectArea.style.transformOrigin="50% 50%",p.TextSelectArea.style.transform="rotate("+this.getpageRotation()+"deg)");var s={textLayerDiv:p.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};p.VectorPageObj.TextLayerBuilder(s)}},this.cleartextdivs=function(){if(null!=p.TextSelectArea){var e={textLayerDiv:p.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};p.VectorPageObj.TextLayerClear(e)}},this.setimagedimlarge=function(e,t,a){if(this.dx=e,this.dy=t,this.dscale=a,this.largeimageloaded=!0,o&&!p.DocRef.markuploaded&&(nr?Wc(l,p.DocRef):or?_c(p.DocRef):Xc(l,p.DocRef)),1==this.initialzoom||this.ZoomRealSize(),null!=la&&la.setDownload("hide"),vi?(Nd(p.DocRef.FileName),Bd()):(Hd(),p.DocRef.SetActive()),p.DocRef.bDoPrint&&p.DocRef.checkprintready()&&wh(),Lp(),o){if(ue){if(null!=Qe){var i={docindex:p.DocRef.fileindex,pageindex:p.pagenumber,floorindex:ge};Qe.loadComplete(p.DocRef.FileName,p.DocRef.bActive,i)}ue=!1,ge=null}null!=_e&&_e.loadComplete(p.DocRef.FileName,p.DocRef.bActive)}null!=nt&&nt.loadComplete(p.pagenumber),null!=bt&&bt.setVectorBlocks([])},this.setimagedimsmall=function(e,t,a){this.dxextent=e,this.dyextent=t,this.dscaleextent=a,this.initialscale=a,p.setpagedimsize(this.dxextent,this.dyextent,this.SmallImageWidth*this.dscaleextent,this.SmallImageHeight*this.dscaleextent,!1),this.pagedimset=!0,this.smallimageloaded=!0,p.largeimageloaded?(p.dscale=p.smallimagecnv.width*p.dscaleextent/p.largeimagecnv.width,p.dx=p.dxextent,p.dy=p.dyextent,p.bitmapratio=p.dscale/p.dscaleextent):(p.dscale=p.dscaleextent,p.dx=p.dxextent,p.dy=p.dyextent,p.bitmapratio=1),this.draw_image(!0)},this.checkimageswitch=function(){this.dscale/p.bitmapratio<pi?this.currentimage=1:this.currentimage=0,p.setpagedimsize(this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale,!1)},this.ZoomRealSize=function(){var e=p.MainImageWidth/this.MainImageScaling/p.DPI*96;this.dscale=e/p.MainImageWidth,this.dx=(ti-this.MainImageWidth*this.dscale)/2,this.dy=0},this.getdx=function(){return this.usevectorxml?this.dxvector:this.usepdfjs?this.dxpdf:this.dx},this.getdy=function(){return this.usevectorxml?this.dyvector:this.usepdfjs?this.dypdf:this.dy},this.getdscale=function(){return this.usevectorxml?this.dscalevector:this.usepdfjs?this.dscalepdf*this.curpagescale:this.dscale},this.getClipRect=function(e,t){var a=void 0;if(p.usevector3DGLTF){var i=d.getContext();e.y=ai-e.y-e.h;var r=new Uint8Array(e.w*e.h*4);i.readPixels(e.x,e.y,e.w,e.h,i.RGBA,i.UNSIGNED_BYTE,r);var n=new Uint8ClampedArray(r);a=sp(a=new ImageData(n,e.w,e.h))}else p.usepdfjs?p.getPDFcliprect(e,t):a=s.getImageData(e.x,e.y,e.w,e.h);return a},this.screentoDocRect=function(e){return{x:(e.x-p.getdx())/p.getdscale(),y:(e.y-p.getdy())/p.getdscale(),w:e.w/p.getdscale(),h:e.h/p.getdscale()}},this.getcur3DView=function(){var e=null;return p.usevector3DGLTF&&p.Vector3DPageObj&&(e=p.Vector3DPageObj.getcur3DView()),e},this.setpagedim=function(e,t,a,i){var s=p.getpagedim(),r=t/s.w;s.h,r>1?p.ZoomIn(r,!0,!0):(r=1/r,p.ZoomOut(r,!0,!0)),p.pan_position(a,i)},this.getpagedim=function(){var e=p.DPI;p.usepdfjs&&(e=72);var t=p.getpagerect();return{x:t.x,y:t.y,w:t.w,h:t.h,origw:p.originalwidth,origh:p.originalheight,scale:p.getdscale(),dpi:e,rotation:p.getpageRotation()}},this.redraw=function(){this.usevectorxml?this.draw_vector(!0):this.usepdfjs?p.DocRef.forcefoxitRedraw():this.draw_image(!0),z()},this.getPDFcliprect=function(e,t){var a=p.getPDFpageScale();e.x=e.x-p.dxpdf,e.y=e.y-p.dypdf;var i=p.originalPDFwidth,s=p.originalPDFheight,r=Math.sqrt(ws/(i*s));a>r?(a=r,p.bMaxzoom=!0):p.bMaxzoom=!1,null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getBitmapRect(p.pagenumber,a,e,t)},this.getfoxitbitmap=function(e){var t=p.getPDFpageScale();null!=p.DocRef.foxitdoc&&(t=p.DocRef.foxitdoc.getcurPageScale());var a=p.originalPDFwidth,i=p.originalPDFheight,s=Math.sqrt(ws/(a*i));t>scope.nPDFMaxFactor?(t=s,p.bMaxzoom=!0):p.bMaxzoom=!1,null!=p.DocRef.foxitdoc&&docref.foxitdoc.getBitmapRect(p.pagenumber,t,e,p.setPageBitmap)},this.checkFoxitMaxZoom=function(e){var t=!1,a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc){var i=p.DocRef.foxitdoc.nMaxScale;null!=i&&a<=i&&(t=!0)}return t},this.foxitpanToPoint=function(e){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.pantopoint(p.pagenumber,e)},this.foxitdirectZoomToEx=function(e,t){var a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc)var i=p.DocRef.foxitdoc.nMaxScale;null!=i&&a>=i||null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.zoomtopointdirect(p.pagenumber,a,t)},this.foxitdirectZoomTo=function(e,t,a,i,s,r){var n=Hl(),o=p.getPDFpageScale()*rn;if(o*=e,a.x/=n,a.y/=n,null!=p.DocRef.foxitdoc)var l=p.DocRef.foxitdoc.nMaxScale;null!=l&&o>=l||null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.zoomToPoint(p.pagenumber,o,t,a,i,s,r)},this.getPDFpageScale=function(){var e=p.offscreenwidth/p.pdfpagewidth;return 0!=p.getpageRotation()&&(e=p.bpagesizeupdated?(90==p.getpageRotation()||p.getpageRotation(),p.offscreenwidth/p.pdfpagewidth):p.offscreenwidth/p.pdfpagewidth),e},this.foxitdirectZoom=function(e){var t=void 0,a=p.getPDFpageScale()*rn;if(a*=e,null!=p.DocRef.foxitdoc&&(t=p.DocRef.foxitdoc.nMaxScale),!(null!=t&&a>=t)){if(null!=p.DocRef.foxitdoc){var i=(p.getpagerect(),p.pagenumber);return i={pagerect:p.getpagerect(),cw:ii,ch:si,pagenum:p.pagenumber,visiblechanged:!1},p.DocRef.foxitdoc.zoomdirect(p.pagenumber,a,i)}return Promise.resolve()}},this.zoomall=function(e){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,3)}if(!this.usevector3Dxml){if(this.usepdfjs){if(0==p.offscreenheight||0==p.offscreenwidth||!p.pdfdiminitset)return;var a=p.offscreenheight,i=p.offscreenwidth}else{var s=_();null!=s&&H(function(e){var t=e.dscale,a=e.dscale;switch(p.getpageRotation()){case 0:t=ai/e.height,a=ti/e.width;break;case 90:t=ai/e.width,a=ti/e.height;break;case 180:t=ai/e.height,a=ti/e.width;break;case 270:t=ai/e.width,a=ti/e.height}e.dscale=Math.min(a,t),e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;var i=e.dx,s=e.dy,r=e.width*e.dscale+i,n=e.height*e.dscale+s;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:i,starty:s,endx:r,endy:n}}(s),!1)}if(this.usepdfjs){var r=this.dscalepdf,n=this.dscalepdf;switch(this.getpageRotation()){case 0:r=ai/a,n=ti/i,r=si/a,n=ii/i,this.dscalepdf=Math.min(n,r),this.curzoomfunction=0;break;case 90:p.bpagesizeupdated?(r=ai/a,n=ti/i,r=si/a,n=ii/i):(r=ai/i,n=ti/a,r=si/i,n=ii/a),this.dscalepdf=Math.min(n,r),this.dscalepdf==n?p.curzoomfunction=1:this.dscalepdf==r&&(p.curzoomfunction=2);break;case 180:r=ai/a,n=ti/i,r=si/a,n=ii/i,this.dscalepdf=Math.min(n,r),this.curzoomfunction=0;break;case 270:p.bpagesizeupdated?(r=ai/a,n=ti/i,r=si/a,n=ii/i):(r=ai/i,n=ti/a,r=si/i,n=ii/a),this.dscalepdf=Math.min(n,r),this.dscalepdf==n?p.curzoomfunction=1:this.dscalepdf==r&&(p.curzoomfunction=2)}p.pdfisrendered=!1,p.pdfrenderopque+=1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf),this.dxpdf=(ii-i*this.dscalepdf)/2,this.dypdf=(si-a*this.dscalepdf)/2}this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),z(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,3))}},this.getPageScale=function(){return p.curpagescale},this.pageStats=function(){return _()},this.ZoomPageUpdate=function(e,t){switch(t){case 0:p.ZoomIn(e.factor,e.center,!0,e.mousepos);break;case 1:p.ZoomOut(e.factor,e.center,!0,e.mousepos);break;case 2:p.zoom_update(e.sx,e.sy,e.sWide,e.sHi,!0);break;case 3:p.zoomall(!0);break;case 4:p.zoomwidth(!0);break;case 5:p.zoomheight(!0)}},this.vectorscrollbuffer=function(e,t,a){var i={s:e,x:t,y:a};p.vectordebounce_timer&&window.clearTimeout(p.vectordebounce_timer),p.vectordebounce_timer=window.setTimeout((function(){i&&(i.s,p.vectorischanged=!0,i=null)}),100)},this.scrollzoombuffer=function(e,t,a,i){var s={s:e,ps:t,x:a,y:i};p.debounce_timer&&window.clearTimeout(p.debounce_timer),p.debounce_timer=window.setTimeout((function(){p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&s&&(p.foxitdirectZoom(s.s),s=null),s=null}),1e3)},this.getBlockCentroid=function(e){if(this.usevectorxml)var t=p.VectorPageObj.getblockcentroid(e,p.dscalevector,p.dxvector,p.dyvector);return t},this.ZoomToBlock=function(e){if(this.usevectorxml){var t=p.VectorPageObj.getBlockRect(e,p.dscalevector,p.dxvector,p.dyvector);t.found&&this.zoom_update(t.x-t.wp,t.y-t.hp,t.w+2*t.wp,t.h+2*t.hp)}},this.ZoomToBlockInsert=function(e){if(this.usevectorxml){var t=p.VectorPageObj.getBlockInsertRect(e,p.dscalevector,p.dxvector,p.dyvector),a=t;0!=p.getpageRotation()&&(a=function(e,t){var a=ti/2,i=ai/2,s=a,r=i,n=0,o={x:e.x,y:e.y,w:e.w,h:e.h};switch(n=t*(Math.PI/180),t){case 0:n=t*(Math.PI/180);break;case 90:n=t*(Math.PI/180);var l=o.h;o.h=o.w,o.w=l;break;case 270:n=t*(Math.PI/180),l=o.h,o.h=o.w,o.w=l;break;case 180:n=t*(Math.PI/180)}var c=Math.cos(n),h=Math.sin(n),d=o.x-s,p=o.y-r;return(o={x:d*c-p*h,y:d*h+p*c,w:o.w,h:o.h}).x=a+o.x,o.y=i+o.y,o}(t,p.getpageRotation())),t.found&&(this.zoom_update(a.x,a.y,a.w,a.h,!0),.1*p.dscalevector>p.fixedScale?this.ZoomOut(10):this.ZoomOut(2))}},this.ZoomOutTest=function(e,t,a){if(!this.usevector3Dxml){if(a){var i={x:a.x,y:a.y};0!=p.getpageRotation()&&(i=Fn(a.x,a.y));var s=(ti/2-i.x)/e-(ti/2-i.x),r=(ai/2-i.y)/e-(ai/2-i.y);this.usepdfjs&&(i={x:a.xus,y:a.yus},0!=p.getpageRotation()&&(i=Fn(a.xus,a.yus)),s=(ii/2-i.x)/e-(ii/2-i.x),r=(si/2-i.y)/e-(si/2-i.y))}var n=(ti-this.MainImageWidth*this.dscale)/2,o=(ai-this.MainImageHeight*this.dscale)/2,l=(this.dx,this.dy,this.dscale/e);this.MainImageWidth,this.MainImageHeight;if(this.usevectorxml&&null!=p.VectorPageObj){var c=(ti-p.VectorPageObj.width*this.dscalevector)/2,h=(ai-p.VectorPageObj.height*this.dscalevector)/2,d=c-this.dxvector,u=h-this.dyvector,g=this.dscalevector/e,f=(ti-p.VectorPageObj.width*g)/2,m=(ai-p.VectorPageObj.height*g)/2;if(t)var y=f,v=m;else y=f-d/e,v=m-u/e;a&&(y+=s,v+=r)}if(this.usepdfjs){var x=p.offscreenheight,b=p.offscreenwidth;0!=p.getpageRotation()&&(b=p.originalPDFwidth,x=p.originalPDFheight);var w=this.dscalepdf,k=this.dscalepdf;w=(ii-b*this.dscalepdf)/2,k=(si-x*this.dscalepdf)/2;var D,C,R=w-this.dxpdf,P=k-this.dypdf;this.dxpdf,this.dypdf,D=si/x,C=ii/b;var S=Math.min(C,D),M=b*this.dscalepdf/p.pdfpagewidth*e,T=x*this.dscalepdf/p.pdfpageheight*e;if(Math.min(M,T),1==p.DocRef.pages.length){var E=this.dscalepdf/e;this.bMinzoom=!1}else E=this.dscalepdf/e<S?S:this.dscalepdf/e;var F=this.dscalepdf,I=this.dscalepdf;if(F=(ii-b*this.dscalepdf)/2,I=(si-x*this.dscalepdf)/2,t)var j=F,A=I;else j=F-R/e,A=I-P/e;if(b<=ii){j=F;var O=!0}b*this.dscalepdf<=ii&&(j=(ii-b*this.dscalepdf)/2,O=!0),a&&(O||(j+=s),A+=r)}if(this.usevectorxml)null!=p.VectorPageObj&&(L=y,V=v,N=p.VectorPageObj.width*g+L,B=p.VectorPageObj.height*g+V);else if(this.usepdfjs)var L=j,V=A,N=b*E+j,B=x*E+A;return p.getpagetestrect({startx:L,starty:V,endx:N,endy:B})}},this.textselectreturn=function(e){p.textselectobj=e,p.textselectobj.bend&&(p.textselectobj.complete=!0,null!=ka&&null!=p.textselectobj.rectarray&&null!=p.textselectobj.rectarray[0]&&ka.TextCopied(p.DocRef.OriginalURL,p.textselectobj.rectarray[0].text))},this.SelectText=function(e,t,a,i){if(p.textselectobj.bstart=e,p.textselectobj.bend=t,e&&(p.textselectobj.rectarray=void 0,p.textselectobj.start=-1,p.textselectobj.end=-1,p.textselectobj.$handler=null),i){var s={x:i.x,y:i.y},r={x:a.x,y:a.y};s={x:i.xus,y:i.yus},r={x:a.xus,y:a.yus},0!=p.getpageRotation()&&(s=Fn(i.x,i.y),r=Fn(a.x,a.y),s=Fn(i.xus,i.yus),r=Fn(a.xus,a.yus));var n=p.getPDFCoordsRot(s),o=p.getPDFCoordsRot(r);p.textselectobj.startpos=[o.x,o.y],p.textselectobj.endpos=[n.x,n.y],null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.selectText(p.pagenumber,p.textselectobj,p.textselectreturn)}},this.postscaleRefresh=function(){window.setTimeout((function(){p.DocRef.forcefoxitRedraw()}),500)},this.ZoomIn=function(e,t,a,i){if(!this.usevector3Dxml){p.DocRef.textselect&&(i=void 0);var s=.5*ii,r=.5*si,n={x:s,y:r};if(0!=p.getpageRotation()&&Fn(s,r),null!=Da&&0==a){var o={factor:e,center:t,mousepos:i,rect:u=p.getpagerect()};Da.zoomUpdate(o,0)}if(i){var l={x:i.x,y:i.y},c={x:i.xus,y:i.yus};0==p.getpageRotation()||p.usepdfjs||(l=Fn(i.x,i.y),c=Fn(i.xus,i.yus));var h=(ti/2-l.x)*e-(ti/2-l.x),d=(ai/2-l.y)*e-(ai/2-l.y)}var u,g=_();if(this.usepdfjs){var f=function(e,t,a,i){var s=p.offscreenheight,r=p.offscreenwidth;p.bMinzoom=!1;var n=!1,o=a.dscale,l=a.dscale;o=(ii-r*a.dscale)/2,l=(si-s*a.dscale)/2;var c=o-a.dx,h=l-a.dy,d=r*a.dscale/p.pdfpagewidth*t,u=s*a.dscale/p.pdfpageheight*t;0!=p.getpageRotation()&&(90!=p.getpageRotation()&&270!=p.getpageRotation()||(p.bpagesizeupdated?(d=r*a.dscale/p.pdfpagewidth*t,u=s*a.dscale/p.pdfpageheight*t):(d=r*a.dscale/p.pdfpageheight*t,u=s*a.dscale/p.pdfpagewidth*t))),Math.min(d,u),a.dscale=a.dscale*t;var g=(ti-r*a.dscale)/2,f=(ai-s*a.dscale)/2;g=(ii-r*a.dscale)/2,f=(si-s*a.dscale)/2,0!=p.getpageRotation()&&p.bpagesizeupdated&&(90!=p.getpageRotation()&&270!=p.getpageRotation()||(g=(ai-r*a.dscale)/2,f=(ti-s*a.dscale)/2,g=(si-r*a.dscale)/2,f=(ii-s*a.dscale)/2)),e?(a.dx=g,a.dy=f):(a.dx=g-c*t,a.dy=f-h*t),r<=ii&&(p.DocRef.pagelocked||(a.dx=g),n=!0),r*a.dscale<=ii&&(p.DocRef.pagelocked||(a.dx=(ii-r*a.dscale)/2),n=!0),p.setpagedimsize(a.dx,a.dy,r*a.dscale,s*a.dscale,!1);var m=a.dx,y=a.dy,v=a.width*a.dscale+m,x=a.height*a.dscale+y;return{dscale:a.dscale,dx:a.dx,dy:a.dy,startx:m,starty:y,endx:v,endy:x,bWidthlocked:n,mousepoint:a.mousepoint,offsetpoint:a.offsetpoint,offsetcenter:a.offsetcenter,bIn:i,dfactor:t}}(t,e,g,!0),m=p.getPDFCoordsRot(n);if(i){var y=p.getPDFCoordsRot(c),v=0,x=0;this.dxpdf>0&&(v=8),this.dypdf>0&&(x=8);var b={x:v,y:x},w={x:v,y:x};0!=p.getpageRotation()&&(b=Fn(b.x,b.y));var k=p.getPDFCoordsRot(w);(!f.bWidthlocked||p.DocRef.pagelocked&&!Bi)&&(f.dx+=h,f.startx+=h,f.endx+=h),f.dy+=d,f.starty+=d,f.endy+=d,f.mousepoint=y,f.offsetpoint=k,f.bIn=!0,f.dfactor=e}else f.mousepoint=void 0;f.offsetcenter=m,H(f,!0)}else if(null!=g){var D=W(t,e,g,!0);i&&(D.dx+=h,D.dy+=d,D.startx+=h,D.endx+=h,D.starty+=d,D.endy+=d),H(D,!0)}if(z(),(u=p.getpagerect()).x>5&&u.y>5&&p.postscaleRefresh(),null!=Ca&&0==a)o={factor:e,center:t,mousepos:i,rect:u=p.getpagerect()},Ca.zoomUpdate(o,0)}},this.ZoomOut=function(e,t,a,i){if(!this.usevector3Dxml){Hl(),p.DocRef.textselect&&(i=void 0),M=.5*ti,T=.5*ai;var s={x:.5*ii,y:.5*si};if(null!=Da&&0==a){var r={factor:e,center:t,mousepos:i,rect:p.getpagerect()};Da.zoomUpdate(r,1)}if(i){var n={x:i.x,y:i.y};0==p.getpageRotation()||p.usepdfjs||(n=Fn(i.x,i.y));var o=(ti/2-n.x)/e-(ti/2-n.x),l=(ai/2-n.y)/e-(ai/2-n.y);this.usepdfjs&&(n={x:i.xus,y:i.yus},o=(ii/2-n.x)/e-(ii/2-n.x),l=(si/2-n.y)/e-(si/2-n.y))}if(this.usevectorxml,this.usepdfjs){var c=p.offscreenheight,h=p.offscreenwidth,d=p.getPDFCoordsRot(s);if(i){var u=p.getPDFCoordsRot(n),g={x:0,y:0};0!=p.getpageRotation()&&(g=Fn(g.x,g.y));var f=p.getPDFCoordsRot({x:0,y:0})}var m=this.dscalepdf,y=this.dscalepdf;m=(ii-h*this.dscalepdf)/2,y=(si-c*this.dscalepdf)/2;var v,x,b=m-this.dxpdf,w=y-this.dypdf;this.dxpdf,this.dypdf,v=si/c,x=ii/h;var k=Math.min(x,v),D=h*this.dscalepdf/p.pdfpagewidth*e,C=c*this.dscalepdf/p.pdfpageheight*e;Math.min(D,C),1==p.DocRef.pages.length?(this.dscalepdf=this.dscalepdf/e,this.bMinzoom=!1):this.dscalepdf/e<k?(this.dscalepdf=k,this.bMinzoom=!0):(this.dscalepdf=this.dscalepdf/e,this.bMinzoom=!1);var R=this.dscalepdf,P=this.dscalepdf;if(R=(ii-h*this.dscalepdf)/2,P=(si-c*this.dscalepdf)/2,t?(this.dxpdf=R,this.dypdf=P):(this.dxpdf=R-b/e,this.dypdf=P-w/e),h<=ii){p.DocRef.pagelocked||(this.dxpdf=R);var S=!0}if(h*this.dscalepdf<=ii&&(p.DocRef.pagelocked||(p.dxpdf=(ii-h*this.dscalepdf)/2),S=!0),i&&((!S||p.DocRef.pagelocked&&!Bi)&&(this.startx+=o,this.endx+=o),this.starty+=l,this.endy+=l),p.pdfrenderopque+=1,p.pdfisrendered=!1,p.getPDFpageScale(),i)p.foxitdirectZoomTo(p.dscalepdf,e,u,f,d,!1);else{var M=.5*ti,T=.5*ai,E=X(p.getpageRotation(),p.foxitpageorigrot),F=p.getPDFDistScale(M,p.dscalepdf),I=p.getPDFDistScale(T,p.dscalepdf);switch(E){case 0:d.x=d.x-F,d.y=d.y+I;break;case 90:d.x=d.x-I,d.y=d.y-F;break;case 180:d.x=d.x+F,d.y=d.y-I;break;case 270:d.x=d.x+I,d.y=d.y+F}p.foxitdirectZoomToEx(p.dscalepdf,d)}}else{var j=W(t,e,_(),!1);i&&(j.dx+=o,j.dy+=l,j.startx+=o,j.endx+=o,j.starty+=l,j.endy+=l),H(j,!0)}this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,h*this.dscalepdf,c*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),z(),null!=Ca&&0==a&&(r={factor:e,center:t,mousepos:i,rect:p.getpagerect()},Ca.zoomUpdate(r,1))}},this.zoomwidth=function(e){if(!this.usevector3Dxml){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,4)}var a=0,i=ti;if(null!=p.DocRef.foxitdoc&&(i=ii-40),this.usepdfjs)var s=p.offscreenheight,r=p.offscreenwidth;else H(function(e){var t=0;switch(p.getpageRotation()){case 0:t=ti/e.width,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 90:t=ti/e.height,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 180:t=ti/e.width,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 270:t=ti/e.height,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;default:t=ti/e.width,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2}var a=e.dx,i=e.dy,s=e.width*e.dscale+a,r=e.height*e.dscale+i;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:a,starty:i,endx:s,endy:r}}(_()),!1);switch(this.getpageRotation()){case 0:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 90:this.usepdfjs&&(a=p.bpagesizeupdated?i/r:i/s,p.curzoomfunction=1,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 180:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;case 270:this.usepdfjs&&(a=p.bpagesizeupdated?i/r:i/s,p.curzoomfunction=1,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2);break;default:this.usepdfjs&&(a=i/r,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-r*this.dscalepdf)/2,this.dypdf=(ai-s*this.dscalepdf)/2,this.dxpdf=(ii-r*this.dscalepdf)/2,this.dypdf=(si-s*this.dscalepdf)/2)}this.usevectorxml||this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,s*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)),z(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,4))}},this.zoomheight=function(e){if(!this.usevector3Dxml){if(null!=Da&&null==e){var t={rect:p.getpagerect()};Da.zoomUpdate(t,5)}var a=0;if(this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;switch(this.getpageRotation()){case 0:a=ai/i,a=si/i,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 90:p.bpagesizeupdated?(a=ai/s,a=si/s):(a=ai/i,a=si/i),p.curzoomfunction=2,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 180:a=ai/i,a=si/i,p.curzoomfunction=0,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2;break;case 270:p.bpagesizeupdated?(a=ai/i,a=si/i):(a=ai/s,a=si/s),p.curzoomfunction=2,this.dscalepdf=a,this.dxpdf=(ti-s*this.dscalepdf)/2,this.dypdf=(ai-i*this.dscalepdf)/2,this.dxpdf=(ii-s*this.dscalepdf)/2,this.dypdf=(si-i*this.dscalepdf)/2}}else H(function(e){var t=0;switch(p.getpageRotation()){case 0:t=ai/e.height,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 90:t=ai/e.width,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 180:t=ai/e.height,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2;break;case 270:t=ai/e.width,e.dscale=t,e.dx=(ti-e.width*e.dscale)/2,e.dy=(ai-e.height*e.dscale)/2}var a=e.dx,i=e.dy,s=e.width*e.dscale+a,r=e.height*e.dscale+i;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:a,starty:i,endx:s,endy:r}}(_()),!1);this.usepdfjs&&(p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)),z(),p.postscaleRefresh(),null!=Ca&&null==e&&(t={rect:p.getpagerect()},Ca.zoomUpdate(t,5))}},this.mtzoom_update=function(e,t,a){this.MainImageHeight,this.MainImageWidth;var i=Math.sqrt(Math.pow(this.MainImageHeight,2)+Math.pow(this.MainImageWidth,2)),s=Math.sqrt(Math.pow(ai,2)+Math.pow(ti,2)),r=t*i-s;if(this.dscale=(s+r+e)/i,this.usevectorxml&&null!=p.VectorPageObj){p.VectorPageObj.height,p.VectorPageObj.width;var n=Math.sqrt(Math.pow(p.VectorPageObj.height,2)+Math.pow(p.VectorPageObj.width,2));r=a*n-s,this.dscalevector=(s+r+e)/n}if(this.usepdfjs){var o=p.offscreenheight,l=p.offscreenwidth;0!=p.getpageRotation()&&(l=p.originalPDFwidth,o=p.originalPDFheight);var c=Math.sqrt(Math.pow(o,2)+Math.pow(o,2));r=a*c-s,this.dscalepdf=(s+r+e)/c,p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoom(p.dscalepdf)}this.usevector3Dxml||(this.usevectorxml?null!=p.VectorPageObj&&(this.startx=this.dxvector,this.starty=this.dyvector,this.endx=p.VectorPageObj.width*this.dscalevector+this.startx,this.endy=p.VectorPageObj.height*this.dscalevector+this.starty,p.draw_vector(!1),p.vectorischanged=!0):this.usepdfjs?(p.setpagedimsize(this.dxpdf,this.dypdf,l*this.dscalepdf,o*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)):(this.checkimageswitch(),0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0)),z())},this.getRotatedPoint=function(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c},this.setpdfscaleNoOffset=function(e){p.checkFoxitMaxZoom(e)&&(this.dscalepdf=e)},this.setpdfscaleoffset=function(e,t,a){p.checkFoxitMaxZoom(e)&&(this.dscalepdf=e,this.dxpdf=t,this.dypdf=a)},this.zoom_update=function(e,t,a,i,s){if(!this.usevector3Dxml){var r=1/Hl(),n={x:e,y:t,w:a,h:i};n.x=n.x*r,n.y=n.y*r,n.w=n.w*r,n.h=n.h*r;var o=n;if(null!=Da&&null==s){var l={sx:e,sy:t,sWide:a,sHi:i,rect:p.getpagerect()};Da.zoomUpdate(l,2)}var c,h,d=1,u=0,g=0,f=0;c=si/2,h=ii/2,this.getpageRotation(),Math.PI;var m,y,v={x:m=o.x+o.w/2,y:y=o.y+o.h/2},x=e/this.dscalepdf,b=t/this.dscalepdf,w=(this.dscalepdf,this.dscalepdf,this.dscalepdf),k=this.dscalepdf;if(x=o.x/this.dscalepdf,b=o.y/this.dscalepdf,o.x,o.w,this.dscalepdf,o.y,o.h,this.dscalepdf,w=o.h/this.dscalepdf,k=o.w/this.dscalepdf,this.usepdfjs){var D=p.offscreenheight,C=p.offscreenwidth,R=p.getPDFcoords(0,0);switch(this.getpageRotation()){case 90:if(this.usepdfjs){if(g=m-h,f=y-c,b=this.dypdf+m-h,x=this.dxpdf-y+c,w>0&&k>0){var P=this.dscalepdf*ai/i,S=this.dscalepdf*ti/a;P=this.dscalepdf*si/n.h,S=this.dscalepdf*ii/n.w}u=(d=Math.min(P,S))/this.dscalepdf;var M=(ti-C*this.dscalepdf)/2,T=(ai-D*this.dscalepdf)/2;M=(ii-C*this.dscalepdf)/2,T=(si-D*this.dscalepdf)/2;this.dxpdf,this.dypdf,this.dscalepdf,this.dscalepdf;(ii-C*this.dscalepdf)/2,(si-D*this.dscalepdf)/2,Fn(m,y),R=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d)}break;case 270:this.usepdfjs&&(g=m-h,f=y-c,x=-(m-p.dxpdfnonrot)/this.dscalepdf,b=-(y-p.dypdfnonrot)/this.dscalepdf,w>0&&k>0&&(P=this.dscalepdf*ai/i,S=this.dscalepdf*ti/a,P=this.dscalepdf*si/n.h,S=this.dscalepdf*ii/n.w),u=(d=Math.min(P,S))/this.dscalepdf,p.bpagesizeupdated?(M=(ti-C*this.dscalepdf)/2,T=(ai-D*this.dscalepdf)/2,M=(ii-C*this.dscalepdf)/2,T=(si-D*this.dscalepdf)/2):(M=(ti-D*this.dscalepdf)/2,T=(ai-C*this.dscalepdf)/2,M=(ii-D*this.dscalepdf)/2,T=(si-C*this.dscalepdf)/2),M-this.dxpdf,T-this.dypdf,p.bpagesizeupdated?((ti-C*this.dscalepdf)/2,(ai-D*this.dscalepdf)/2,(ii-C*this.dscalepdf)/2,(si-D*this.dscalepdf)/2):((ti-D*this.dscalepdf)/2,(ai-C*this.dscalepdf)/2,(ii-D*this.dscalepdf)/2,(si-C*this.dscalepdf)/2),Fn(m,y),R=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d));break;case 180:this.usepdfjs?(g=m-h,f=y-c,b=this.dypdf+y-c,x=this.dxpdf+m-h,w>0&&k>0&&(P=this.dscalepdf*ai/i,S=this.dscalepdf*ti/a,P=this.dscalepdf*si/n.h,S=this.dscalepdf*ii/n.w),u=(d=Math.min(P,S))/this.dscalepdf,M=(ti-C*this.dscalepdf)/2,T=(ai-D*this.dscalepdf)/2,M=(ii-C*this.dscalepdf)/2,T=(si-D*this.dscalepdf)/2,M-this.dxpdf,T-this.dypdf,(ti-C*this.dscalepdf)/2,(ai-D*this.dscalepdf)/2,(ii-C*this.dscalepdf)/2,(si-D*this.dscalepdf)/2,Fn(m,y),R=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(d)):(g=m-h,f=y-c,x=this.dypdf+f,b=this.dxpdf+g,this.dxpdf=x,this.dypdf=b,w>0&&k>0&&(P=this.dscalepdf*ai/i,S=this.dscalepdf*ti/a,P=this.dscalepdf*si/n.h,S=this.dscalepdf*ii/n.w),d=Math.min(P,S),this.usepdfjs&&(u=d/this.dscalepdf),this.ZoomIn(u,!1,!1));break;case 0:x=-(m-this.dxpdf)/this.dscalepdf,b=-(y-this.dypdf)/this.dscalepdf,w>0&&k>0&&(P=this.dscalepdf*ai/i,S=this.dscalepdf*ti/a,P=this.dscalepdf*si/o.h,S=this.dscalepdf*ii/o.w);var E=Math.min(P,S);this.dxpdf,this.dypdf,this.dxpdf,this.dypdf,R=p.getPDFCoordsRot(v),p.setpdfscaleNoOffset(E)}var F=X(p.getpageRotation(),p.foxitpageorigrot),I=p.getPDFDist(ti/2),j=p.getPDFDist(ai/2);switch(I=p.getPDFDist(ii/2),j=p.getPDFDist(si/2),F){case 0:R.x=R.x-I,R.y=R.y+j;break;case 90:R.x=R.x-j,R.y=R.y-I;break;case 180:R.x=R.x+I,R.y=R.y-j;break;case 270:R.x=R.x+j,R.y=R.y+I}}else{var A=_();Nr&&console.log(A);var O=function(e,t,a,i,s){var r=0,n=0,o=0,l=ai/2,c=ti/2,h=(p.getpageRotation(),Math.PI,t+i/2),d=a+s/2,u=t/e.dscale,g=a/e.dscale,f=(e.dscale,e.dscale,s/e.dscale),m=i/e.dscale,y=ai/e.height,v=ti/e.width;switch(e.height,e.dscale,p.getpageRotation()){case 90:n=h-c,o=d-l,g=e.dy+n,u=e.dx-o,e.dx=u,e.dy=g,f>0&&m>0&&(y=e.dscale*ai/s,v=e.dscale*ti/i),r=Math.min(y,v)/e.dscale;var x={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy};H(x,!1),p.ZoomIn(r,!1,!0);break;case 270:n=h-c,o=d-l,g=e.dy-n,u=e.dx+o,e.dx=u,e.dy=g,f>0&&m>0&&(y=e.dscale*ai/s,v=e.dscale*ti/i),r=Math.min(y,v)/e.dscale,H(x={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy},!1),p.ZoomIn(r,!1,!0);break;case 180:n=h-c,o=d-l,g=e.dy+o,u=e.dx+n,e.dx=u,e.dy=g,f>0&&m>0&&(y=e.dscale*ai/s,v=e.dscale*ti/i),r=Math.min(y,v)/e.dscale,H(x={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy},!1),p.ZoomIn(r,!1,!0);break;case 0:u=-(h-e.dx)/e.dscale,g=-(d-e.dy)/e.dscale,f>0&&m>0&&(y=e.dscale*ai/s,v=e.dscale*ti/i),e.dscale=Math.min(y,v),e.dx=u*e.dscale+ti/2,e.dy=g*e.dscale+ai/2}var b=e.dx,w=e.dy,k=e.width*e.dscale+b,D=e.height*e.dscale+w;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:b,starty:w,endx:k,endy:D}}(A,e,t,a,i);0==p.getpageRotation()&&H(O,!1)}this.usepdfjs&&(0==p.getpageRotation()&&p.setpagedimsize(this.dxpdf,this.dypdf,C*this.dscalepdf,D*this.dscalepdf,!1),p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)),this.usepdfjs&&(p.pdfrenderopque+=1,p.pdfisrendered=!1,p.DocRef.pages[p.DocRef.currentpage].pagenumber==p.pagenumber&&p.foxitdirectZoomToEx(p.dscalepdf,R)),z(),null!=Ca&&null==s&&(l={sx:e,sy:t,sWide:a,sHi:i,rect:p.getpagerect()},Ca.zoomUpdate(l,2))}},this.MarkupFindText=function(e){for(var t=[],a=0;a<p.DocRef.markuplist.length;a++)p.DocRef.markuplist[a].FindText(e)&&t.push(p.DocRef.markuplist[a]);return t},this.getMarkupPos=function(e){var t=e.hscaled,a=e.wscaled,i=e.xscaled,s=e.yscaled;switch(e.bisTextArrow&&null!=e.textBoxConnected&&(t=Math.max(e.hscaled,e.textBoxConnected.hscaled),a=Math.max(e.wscaled,e.textBoxConnected.wscaled),i=Math.min(e.xscaled,e.textBoxConnected.xscaled),s=Math.min(e.yscaled,e.textBoxConnected.yscaled)),e.pagenumber,this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:case 6:case 7:case 8:a-=i,t-=s;break;case 9:break;case 13:a-=i,t-=s}break;case 90:t=e.rotatedrect.h,a=e.rotatedrect.w;var r=i=e.rotatedrect.x;i=a,a=r,a-=i,t-=s=e.rotatedrect.y;break;case 180:t=e.rotatedrect.h,a=e.rotatedrect.w;var n=i=e.rotatedrect.x,o=s=e.rotatedrect.y;i=a,s=t,a=n,t=o,a-=i,t-=s;break;case 270:t=e.rotatedrect.h,a=e.rotatedrect.w,i=e.rotatedrect.x;var l=s=e.rotatedrect.y;s=t,t=l,a-=i,t-=s}return{x:i,y:s,w:a,h:t}},this.panToMarkup=function(e){e.selected||e.selectedit?e.drawmescaled(a):e.drawmescaled(n);var t=p.getMarkupPos(e);p.pan_update(0,0);var i=ai/2,s=ti/2,r=0,o=0,l=p.getpagerect(),c=t.x+.5*t.w,h=t.y+.5*t.h;if(0!=p.getpageRotation()){var d=p.getrotcoords(s,i,c,h,-p.getpageRotation());u=Math.max(d.x,ti)-Math.min(d.x,ti),(Math.max(d.x,ti)==d.x||u<300)&&(r=d.x-s),g=Math.max(d.y,ai)-Math.min(d.y,ai),(Math.max(d.y,ai)==d.y||g<100)&&(o=d.y-i),f=Math.max(d.x,0)-Math.min(d.x,0),(Math.min(d.x,0)==d.x||f<100)&&(r=-(s-d.x)),m=Math.max(d.y,0)-Math.min(d.y,0),(Math.min(d.y,0)==d.y||m<100)&&(o=-(i-d.y)),p.pan_update(r,o)}else{var u=Math.max(c,ti)-Math.min(c,ti);(Math.max(c,ti)==c||u<300)&&(r=c-s);var g=Math.max(h,ai)-Math.min(h,ai);(Math.max(h,ai)==h||g<100)&&(o=h-i);var f=Math.max(c,0)-Math.min(c,0);(Math.min(c,0)==c||f<100)&&(r=-(s-c));var m=Math.max(h,0)-Math.min(h,0);(Math.min(h,0)==h||m<100)&&(o=-(i-h)),l.w<=ti&&p.usepdfjs&&(r=0),p.pan_update(r,o)}},this.zoomToMarkup=function(e,t){this.zoomall();var a=e.hscaled,i=e.wscaled,s=e.xscaled,r=e.yscaled;switch(e.pagenumber,this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:i=Math.abs(i-s),a=Math.abs(a-r);break;case 6:case 7:0==(i=Math.abs(i-s))&&(i=1),0==(a=Math.abs(a-r))&&(a=1);break;case 8:i=Math.abs(i-s),a=Math.abs(a-r)}break;case 90:a=e.rotatedrect.h,i=e.rotatedrect.w;var n=s=e.rotatedrect.x;s=i,i=n,i-=s,a-=r=e.rotatedrect.y;break;case 180:a=e.rotatedrect.h,i=e.rotatedrect.w;var o=s=e.rotatedrect.x,l=r=e.rotatedrect.y;s=i,r=a,i=o,a=l,i-=s,a-=r;break;case 270:a=e.rotatedrect.h,i=e.rotatedrect.w,s=e.rotatedrect.x;var c=r=e.rotatedrect.y;r=a,a=c,i-=s,a-=r}t?(a+=t.h*a/100,i+=t.w*i/100,s-=t.x*i/100,r-=t.y*a/100):(a+=100,i+=50,s-=50,r-=50),this.zoom_update(s,r,i,a)},this.MarkupFind=function(e){for(var t=!1;this.CurrentMarkup<p.DocRef.nummarkups&&!t;){if(p.DocRef.markuplist[this.CurrentMarkup].FindText(e)){t=!0,this.zoomall();var a=p.DocRef.markuplist[this.CurrentMarkup].hscaled,i=p.DocRef.markuplist[this.CurrentMarkup].wscaled,s=p.DocRef.markuplist[this.CurrentMarkup].xscaled,r=p.DocRef.markuplist[this.CurrentMarkup].yscaled;switch(p.DocRef.markuplist[this.CurrentMarkup].pagenumber,this.getpageRotation()){case 0:switch(p.DocRef.markuplist[this.CurrentMarkup].type){case 0:case 1:case 2:case 6:case 7:case 8:i-=s,a-=r;break;case 9:r-=a}break;case 90:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w;var n=s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x;s=i,i=n,i-=s,a-=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;break;case 180:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w;var o=s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x,l=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;s=i,r=a,i=o,a=l,i-=s,a-=r;break;case 270:a=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.h,i=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.w,s=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.x;var c=r=p.DocRef.markuplist[this.CurrentMarkup].rotatedrect.y;r=a,a=c,i-=s,a-=r}a+=100,i+=50,s-=50,r-=50,this.zoom_update(s,r,i,a)}this.CurrentMarkup++}this.CurrentMarkup=0},this.SetMarkupZoom=function(e,t,a){if(this.usevectorxml&&null!=p.VectorPageObj)p.vectorloaded?(this.dscalevector=a,this.dxvector=e,this.dyvector=t,p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),this.draw_vector(!1)):p.loadbinvectors();else if(this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;0!=p.getpageRotation()&&(s=p.originalPDFwidth,i=p.originalPDFheight),this.dscalepdf=a,this.dxpdf=e,this.dypdf=t,p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.pdfrenderopque+=1,p.pdfisrendered=!1,p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else this.dscale=a,this.dx=e,this.dy=t,this.checkimageswitch(),0==p.DocRef.Type&&p.DocRef.draw_mpage()},this.MarkupZoombyMarkup=function(e,t){this.zoomall();var a=3;this.dscale,e.scaling,this.usevectorxml?(this.dscalevector,e.scaling):this.usepdfjs?(this.dscalepdf,e.scaling):(this.dscale,e.scaling);var i=e.xscaled,s=e.wscaled,r=e.yscaled,n=e.hscaled;switch(this.getpageRotation()){case 0:switch(e.type){case 0:case 1:case 2:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),s-=i,n-=r;break;case 6:case 7:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),0==(n-=r)&&(n=1),0==(s-=i)&&(s=1);break;case 8:i=Math.min(e.xscaled,e.wscaled),s=Math.max(e.xscaled,e.wscaled),r=Math.min(e.yscaled,e.hscaled),n=Math.max(e.yscaled,e.hscaled),s-=i,n-=r;break;case 9:if(0==e.textrotate&&(i=e.rotatedrect.x,s=e.rotatedrect.w,r=e.rotatedrect.y,n=e.rotatedrect.h),e.textrotate/(Math.PI/180)==90){i=e.xscaled,r=e.yscaled;var o=s=e.wscaled;s=n=e.hscaled,n=o}e.textrotate/(Math.PI/180)==270&&(i=e.xscaled,r=e.yscaled,o=s=e.wscaled,i-=s=n=e.hscaled,r-=n=o),e.textrotate/(Math.PI/180)==180&&(i=e.xscaled,r=e.yscaled,i-=s=e.wscaled,r-=n=e.hscaled)}break;case 90:case 180:case 270:i=Math.min(e.rotatedrect.x,e.rotatedrect.w),s=Math.max(e.rotatedrect.x,e.rotatedrect.w),r=Math.min(e.rotatedrect.y,e.rotatedrect.h),n=Math.max(e.rotatedrect.y,e.rotatedrect.h),0==(n-=r)&&(n=1),0==(s-=i)&&(s=1)}this.zoom_update(i,r,s,n),t&&(a=t.h/50),this.ZoomOut(a,!1,!1)},this.MarkupZoom=function(){this.CurrentMarkup>p.DocRef.nummarkups-1&&(this.CurrentMarkup=0);for(var e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup>=p.DocRef.nummarkups-1;)this.CurrentMarkup++,e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;if(this.CurrentMarkup<=p.DocRef.nummarkups-1&&(this.MarkupZoombyMarkup(p.DocRef.markuplist[this.CurrentMarkup]),this.CurrentMarkup++,this.CurrentMarkup<=p.DocRef.nummarkups-1)){for(e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup<=p.DocRef.nummarkups-1&&(this.CurrentMarkup++,!(this.CurrentMarkup>=p.DocRef.nummarkups-1));)e=p.DocRef.markuplist[this.CurrentMarkup].pagenumber;this.CurrentMarkup>=p.DocRef.nummarkups-1&&(this.CurrentMarkup=0)}},this.resize=function(){if(!this.usevector3Dxml){if(p.bDorescaleonsizeChange){var e=ai/this.MainImageHeight,t=ti/this.MainImageWidth;this.dscale=Math.min(t,e),this.dx=(ti-this.MainImageWidth*this.dscale)/2,this.dy=(ai-this.MainImageHeight*this.dscale)/2}if(this.usevectorxml&&p.bDorescaleonsizeChange&&null!=p.VectorPageObj&&(e=ai/p.VectorPageObj.height,t=ti/p.VectorPageObj.width,this.dscalevector=Math.min(t,e),this.dxvector=(ti-p.VectorPageObj.width*this.dscalevector)/2,this.dyvector=(ai-p.VectorPageObj.height*this.dscalevector)/2),this.usepdfjs){var a=p.offscreenheight,i=p.offscreenwidth;0!=p.getpageRotation()&&(i=p.originalPDFwidth,a=p.originalPDFheight),this.dxpdf>1&&i*this.dscalepdf<ti&&this.pan_update_resize((ti-i*this.dscalepdf)/2-this.dxpdf,0)}if(this.usevectorxml){if(null==p.VectorPageObj)return;p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),p.draw_vector(!1)}else this.usepdfjs?(p.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),null!=p.DocRef.pages[p.DocRef.currentpage]&&p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&(ai>a&&a>i&&p.bDorescaleonsizeChange||ti>i&&a<i&&p.bDorescaleonsizeChange||p.DocRef.draw_mpagepdf(!1))):(this.checkimageswitch(),0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0));z()}},this.setpagepos_pan=function(e,t){p.usevectorxml?(p.dxvector=e,p.dyvector=t):p.usepdfjs?(p.dxpdf=e,p.dypdf=t):(p.dx=e,p.dy=t),p.pan_update(0,0,!0)},this.pan_page=function(e,t,a){p.pan_update(e,t,a)},this.pan_page_pos=function(e,t,a){p.pan_position(e,t,a)},this.pan_position=function(e,t,a){var i=p.getpagedim(),s=i.x-e,r=i.y-t;p.pan_update(s,r,!0)},this.getpagetestrect=function(e){var t={x1:e.startx,y1:e.starty,x2:e.endx,y2:e.endy},a={x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1};if(0!=p.getpageRotation())switch(t=En(e.startx,e.starty,e.endx,e.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}return a},this.getrotatedpagerect=function(e){var t={x1:this.startx,y1:this.starty,x2:this.endx,y2:this.endy},a=(this.pdfstartx,this.pdfstarty,this.pdfendx,this.pdfendy,{x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1,usepixelscale:!1});if(0!=p.getpageRotation())switch(t=En(this.startx,this.starty,this.endx,this.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}if(this.usepdfjs&&(a.usepixelscale=!0),e){var i=Hl();a.x*=i,a.y*=i,a.w*=i,a.h*=i}return a},this.getpagerectdirect=function(e){var t={x:this.startx,y:this.starty,w:this.endx,h:this.endy,usepixelscale:!1};if(e){var a=Hl();t.x*=a,t.y*=a,t.w*=a,t.h*=a}return this.usepdfjs&&(t.usepixelscale=!0),t},this.getpagerect=function(e){var t={x1:this.startx,y1:this.starty,x2:this.endx,y2:this.endy},a=(this.pdfstartx,this.pdfstarty,this.pdfendx,this.pdfendy,{x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1,usepixelscale:!1});if(0!=p.getpageRotation())switch(t=En(this.startx,this.starty,this.endx,this.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,p.getpageRotation()){case 90:case 270:a.y=-(a.y+a.h-ai),a.x=-(a.x+a.w-ti)}if(this.usepdfjs&&(a.usepixelscale=!0),e){var i=Hl();a.x*=i,a.y*=i,a.w*=i,a.h*=i}return a},this.pan_update_resize=function(e,t){p.resizepan=!0,p.pan_update(e,t)},this.setPagePosBelow=function(e){0==p.getpageRotation()&&p.setPagePos(p.startx,e.starty+e.offscreenheight*e.dscalepdf+10)},this.setPagePosAbove=function(e){0==p.getpageRotation()&&p.setPagePos(p.startx,e.starty-p.offscreenheight*p.dscalepdf-10)},this.setPageBitmap=function(e){if(!e.error){p.pageRendering=!1;var t=new Uint8ClampedArray(e.buffer),a=new ImageData(t,e.width,e.height);p.dscalepdf=1,p.pagecanvas.width=e.width,p.pagecanvas.height=e.height,p.offscreenwidth=e.width,p.offscreenheight=e.height;var i=p.compositereference.getColors();switch(p.role){case 1:p.setcolor(a.data,i.bg);break;case 2:p.setcolor(a.data,i.fg)}p.pagectx.putImageData(a,0,0),p.pdfisrendered=!0,p.compositereference.draw_compare(!0)}},this.setpagerect=function(e,t,a,i,s=!1){if(p.startx=e,p.starty=t,p.endx=a+e,p.endy=i+t,s){const e=_();p.dxvector=p.startx,p.dyvector=p.starty;const t=a,s=i;p.dscalevector=Math.min(t/e.width,s/e.height)}return{x:p.startx,y:p.starty,w:p.endx,h:p.endy}},this.setPagePos=function(e,t){switch(this.getpageRotation()){case 0:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 90:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e;break;case 180:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 270:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e}if(this.usevectorxml)null!=p.VectorPageObj&&(a=p.setpagerect(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector),p.movetextdivs(),i=Math.max(0,a.x),s=Math.min(ti,a.w),r=Math.max(ai,a.h),n=Math.min(0,a.y),i<s&&r>n?(p.visible=!0,p.DocRef.textselect&&(p.TextSelectArea.style.display=li),this.draw_vector(!1)):(p.visible=!1,p.DocRef.textselect&&(p.TextSelectArea.style.display="none")));else if(this.usepdfjs){this.dxpdf=e,this.dypdf=t;var a=p.setpagerect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf);0==this.getpageRotation()||180==this.getpageRotation()||90==this.getpageRotation()||this.getpageRotation(),p.PDFTextArea.style.left=a.x+"px",p.PDFTextArea.style.top=a.y+"px";var i=Math.max(0,a.x),s=Math.min(ti,a.w),r=Math.max(ai,a.h),n=Math.min(0,a.y);i<s&&r>n?(p.visible=!0,p.DocRef.textselect&&(p.PDFTextArea.style.display=li,p.PDFTextArea.style.zIndex="4")):(p.visible=!1,p.DocRef.textselect&&(p.PDFTextArea.style.display="none"))}else this.checkimageswitch(),this.draw_image(!0);z()},this.getcanvasdim=function(){return this.usepdfjs?{w:ii,h:si}:{w:ti,h:ai}},this.pan_update=function(e,t,i){if(!this.usevector3Dxml){this.dxpdf;var s=t,r=e,o=1/Hl(),l={x:e,y:t};l.x=l.x*o,l.y=l.y*o,s=l.y,r=l.x;var c=!1;switch(null!=p.DocRef.foxitdoc&&(p.DocRef.foxitdoc.onHBarGrip&&p.DocRef.foxitdoc.hBarOn||p.DocRef.foxitdoc.onVBarGrip&&p.DocRef.foxitdoc.vBarOn)?(c=!0,s=-t*p.DocRef.foxitdoc.scrollHeightfactor,r=-e*p.DocRef.foxitdoc.scrollWidthfactor,s=-l.y*p.DocRef.foxitdoc.scrollHeightfactor,r=-l.x*p.DocRef.foxitdoc.scrollWidthfactor):c=!1,this.getpageRotation()){case 0:c?(this.dx=this.dx-e,this.dy=this.dy-t,this.dxvector-=e,this.dyvector-=t,this.dxpdf-=r,this.dypdf-=s):(this.dx=this.dx-e,this.dy=this.dy-t,this.dxvector-=e,this.dyvector-=t,this.dxpdf-=l.x,this.dypdf-=l.y);break;case 90:c?(this.dx=this.dx-t,this.dy=this.dy+e,this.dxvector-=t,this.dyvector+=e,this.dxpdf-=s,this.dypdf+=r):(this.dx=this.dx-t,this.dy=this.dy+e,this.dxvector-=t,this.dyvector+=e,this.dxpdf-=l.y,this.dypdf+=l.x);break;case 180:c?(this.dx=this.dx+e,this.dy=this.dy+t,this.dxvector+=e,this.dyvector+=t,this.dxpdf+=r,this.dypdf+=s):(this.dx=this.dx+e,this.dy=this.dy+t,this.dxvector+=e,this.dyvector+=t,this.dxpdf+=l.x,this.dypdf+=l.y);break;case 270:c?(this.dx=this.dx+t,this.dy=this.dy-e,this.dxvector+=t,this.dyvector-=e,this.dxpdf+=s,this.dypdf-=r):(this.dx=this.dx+t,this.dy=this.dy-e,this.dxvector+=t,this.dyvector-=e,this.dxpdf+=l.y,this.dypdf-=l.x)}if(this.usepdfjs,this.usevectorxml)null!=p.VectorPageObj&&(p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),p.movetextdivs(),this.draw_vector(!1),u=Math.max(0,p.dxvector),g=Math.min(ti,p.endx),f=Math.max(ai,p.endy),m=Math.min(0,p.dyvector),u<g&&f>m?(p.visible=!0,p.DocRef.textselect&&(p.TextSelectArea.style.display=li)):(p.visible=!1,p.DocRef.textselect&&(p.TextSelectArea.style.display="none")));else if(this.usepdfjs){var h=p.offscreenheight,d=p.offscreenwidth;0!=p.getpageRotation()&&(d=p.originalPDFwidth,h=p.originalPDFheight),p.setpagedimsize(this.dxpdf,this.dypdf,d*this.dscalepdf,h*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px",d*this.dscalepdf<=ii&&0==this.getpageRotation()&&(p.dxpdf=(ii-d*this.dscalepdf)/2),null!=p.DocRef.pages[p.DocRef.currentpage]&&p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&(p.resizepan?(p.DocRef.draw_mpagepdf(!1),p.resizepan=!1):p.DocRef.draw_mpagepdf(!0));var u=Math.max(0,p.dxpdf),g=Math.min(ti,p.endx),f=Math.max(ai,p.endy),m=Math.min(0,p.dypdf);if(g=Math.min(ii,p.endx),f=Math.max(si,p.endy),u<g&&f>m?(p.visible=!0,p.DocRef.textselect&&(p.PDFTextArea.style.display=li,p.PDFTextArea.style.zIndex="4")):(p.visible=!1,p.DocRef.textselect&&(p.PDFTextArea.style.display="none")),null!=p.DocRef.foxitdoc){var y=p.getpagerect();!0===p.pagenumber&&(p.pagenumber=p.DocRef.currentpage);var v={mx:l.x,my:l.y},x={x:p.dxpdf,y:p.dypdf};p.getPDFCoordsRot(x),p.DocRef.foxitdoc.scrolldeltaupdate(v,p.pagenumber)}}else this.checkimageswitch(),0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0);if(p.DocRef.thumbnails[p.pagenumber]&&(p.usepdfjs?p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerectdirect()):p.DocRef.thumbnails[p.pagenumber].birdseyerect(p.getpagerect())),null!=p.DocRef.foxitdoc||(Vl(n),Nl(a)),null!=wa&&null==i&&(y=p.getpagerect(),wa.panUpdate(e,t,y)),null!=ba&&null==i){y=p.getpagerect();var b=p.getpageoffset();ba.panUpdate(b.x,b.y,y)}}},this.getpageoffset=function(){var e={x:0,y:0};return p.usevectorxml?(e.x=p.dxvector,e.y=p.dyvector):p.usepdfjs?(e.x=p.dxpdf,e.y=p.dypdf):(e.x=p.dx,e.y=p.dy),e},this.rotateCanvas=function(){var e=0;s.save();var t=ti/2,a=ai/2;switch(s.translate(t,a),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-t,-a),s.fillStyle="rgb(238,243,250)",s.fillRect(0,0,ti,ai),this.currentimage){case 0:s.drawImage(this.largeimage,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale);break;case 1:e=this.dscale/p.bitmapratio,s.drawImage(this.smallimage,this.dx,this.dy,this.SmallImageWidth*e,this.SmallImageHeight*e)}s.restore(),z()},this.rotatepage=function(e){if(null!=p.DocRef.foxitdoc){var t=e;if(0!=p.foxitpageorigrot)switch(p.foxitpageorigrot){case 90:case 270:(t=e-90)<0&&(t+=360);break;case 180:(t=e+180)>=360&&(t-=360)}p.DocRef.foxitdoc.rotatePage(p.pagenumber,t,this.foxitonRotate),p.bpagesizeupdated=!1}var a=0;switch(this.getpageRotation()){case 0:if(90==e)for(a=0;a<=90;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=0;a<=180;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=0;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 90:if(0==e)for(a=90;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=90;a<=180;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=90;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 180:if(0==e)for(a=180;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(a=180;a<=270;a+=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(a=180;a>=90;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 270:if(0==e)for(a=270;a>=0;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(a=270;a>=180;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(a=270;a>=90;a-=10)this.drotation=a,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas()}if(!this.usevector3Dxml){if(this.usevectorxml)null!=p.VectorPageObj&&(p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),p.movetextdivs(),p.draw_vector(!1));else if(this.usepdfjs){var i=p.offscreenheight,s=p.offscreenwidth;0!=p.getpageRotation()&&(s=p.originalPDFwidth,i=p.originalPDFheight);var r=ai/2,n=ti/2;p.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,i*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px";var o=n-p.startx,l=r-p.starty;p.PDFTextArea.style.transformOrigin=o+"px "+l+"px",p.PDFTextArea.style.transform="rotate("+this.getpageRotation()+"deg)",p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else 0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0);null!=Fa&&Fa.onRotate(e,p.pagenumber),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()}},this.foxitonRotate=function(e,t){null!=Fa&&Fa.onRotate(e,t),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye()},this.rotateimage=function(e){var t=1==this.DocRef.pages.length;if(!this.usepdfjs||this.DocRef.pagelocked||!this.usepdfjs||t){if(null!=p.DocRef.foxitdoc){var a=e;if(0!=p.foxitpageorigrot)switch(p.foxitpageorigrot){case 90:case 270:(a=e-90)<0&&(a+=360);break;case 180:(a=e+180)>=360&&(a-=360)}p.DocRef.foxitdoc.rotatePage(p.pagenumber,a,this.foxitonRotate),p.bpagesizeupdated=!1}var i=0;switch(this.getpageRotation()){case 0:if(90==e)for(i=0;i<=90;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=0;i<=180;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=0;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 90:if(0==e)for(i=90;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=90;i<=180;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=90;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 180:if(0==e)for(i=180;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(270==e)for(i=180;i<=270;i+=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(i=180;i>=90;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();break;case 270:if(0==e)for(i=270;i>=0;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(180==e)for(i=270;i>=180;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas();if(90==e)for(i=270;i>=90;i-=10)this.drotation=i,null!=this.DocRef.pagerotations[p.pagenumber]&&(this.DocRef.pagerotations[p.pagenumber]=this.drotation),this.rotateCanvas()}if(!this.usevector3Dxml){if(this.usevectorxml)null!=p.VectorPageObj&&(p.setpagedimsize(this.dxvector,this.dyvector,p.VectorPageObj.width*this.dscalevector,p.VectorPageObj.height*this.dscalevector,!1),p.movetextdivs(),p.draw_vector(!1));else if(this.usepdfjs){var s=p.offscreenheight,r=p.offscreenwidth;0!=p.getpageRotation()&&(r=p.originalPDFwidth,s=p.originalPDFheight);var n=ai/2,o=ti/2;p.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,s*this.dscalepdf,!1),p.PDFTextArea.style.left=p.startx+"px",p.PDFTextArea.style.top=p.starty+"px";var l=o-p.startx,c=n-p.starty;p.PDFTextArea.style.transformOrigin=l+"px "+c+"px",p.PDFTextArea.style.transform="rotate("+this.getpageRotation()+"deg)",p.pagenumber==p.DocRef.pages[p.DocRef.currentpage].pagenumber&&p.DocRef.draw_mpagepdf(!1)}else 0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0);null==p.DocRef.foxitdoc&&(null!=Fa&&Fa.onRotate(e,p.pagenumber),p.DocRef.refreshBirdsEye(),p.DocRef.renderBirdsEye())}}else this.pagelockrotation=e},this.get_layers_html=function(){return this.VectorPageObj.layerhtml},this.enableSnap=function(e){p.snapEnabled=e},this.getSnapState=function(){return p.snapEnabled},this.setpentableUnit=function(e){p.usevectorxml&&(p.VectorPageObj.setpentableUnit(e),p.draw_vector(!1),p.vectorischanged=!0)},this.setpentableScaled=function(e){p.usevectorxml&&(p.VectorPageObj.setpentableScaled(e),p.draw_vector(!1),p.vectorischanged=!0)},this.setPenTable=function(e){p.usevectorxml&&(p.VectorPageObj.setPenTable(e),p.draw_vector(!1),p.vectorischanged=!0)},this.setPenwidth=function(e){p.usevectorxml&&p.VectorPageObj.setPenwidth(e)},this.setPenTablepen=function(e){p.usevectorxml&&(p.VectorPageObj.setPenTablepen(e),p.draw_vector(!1),p.vectorischanged=!0)},this.resetPenTablepen=function(e){p.usevectorxml&&(p.VectorPageObj.resetPenTablepen(e),p.draw_vector(!1),p.vectorischanged=!0)},this.setpencolor=function(e,t){p.usevectorxml&&p.VectorPageObj.setpencolor(e,t)},this.resetpencolor=function(e){p.usevectorxml&&p.VectorPageObj.resetpencolor(e)},this.resetpenwidth=function(e){p.usevectorxml&&p.VectorPageObj.resetpenwidth(e)},this.setViewMode=function(e){p.usevectorxml&&(p.VectorPageObj.ViewMode(e),p.draw_vector(!1),p.vectorischanged=!0,null!=Sa&&Sa.ViewModeChange(e))},this.blockAttributes=function(e){if(p.usevectorxml)return p.VectorPageObj.blockAttributes(e)},this.markVectorBlock=function(e){p.usevectorxml&&p.VectorPageObj.markblockinsert(e,p.dscalevector,p.dxvector,p.dyvector)},this.selectBlock=function(e){p.usevectorxml&&(p.VectorPageObj.selectBlock(e),p.draw_vector(!1),p.vectorischanged=!0)},this.selectBlockInsert=function(e,t){p.usevectorxml&&(p.VectorPageObj.selectBlockInsert(e,t),p.draw_vector(!1),p.vectorischanged=!0)},this.getpixeldist=function(e){return p.usevectorxml?e*p.VectorPageObj.scale*p.dscalevector:e},this.getpolygonPointsbyblockID=function(e){var t=[];return p.usevectorxml&&(t=p.VectorPageObj.getpathPointsBybId(e)),t},this.getpolygonPathbypathIndex=function(e){var t=null;return p.usevectorxml&&(t=p.VectorPageObj.getpathbyindex(e)),t},this.getpolygonPathbyblockID=function(e){var t=null;return p.usevectorxml&&(t=p.VectorPageObj.getpathbybId(e)),t},this.getpolygonPath=function(e,t){var a=null;return p.usevectorxml&&(a=p.VectorPageObj.getpath(e,t,p.dscalevector,p.dxvector,p.dyvector)),a},this.getpolygonPoints=function(e,t){var a=[];return p.usevectorxml&&(a=p.VectorPageObj.getpathPoints(e,t,p.dscalevector,p.dxvector,p.dyvector)),a},this.createAreaAttributes=function(e){p.usevectorxml&&p.VectorPageObj.createAreaAttributes(e)},this.setVectorBlockArea=function(e,t,a){p.usevectorxml&&p.VectorPageObj.setBlockArea(e,t,a)},this.getinsideHyperlink=function(e,t,a,i,s,r){var n=!1,o={x:e,y:t};if(null==p.VectorPageObj)return!1;0!=p.drotation&&(o=Fn(e,t)),e=o.x,t=o.y;for(var l=0;l<p.hyperlinks.length;l++)p.hyperlinks[l].insideHyperlink(e,t,a,i,s,p.VectorPageObj.x,p.VectorPageObj.y,p.VectorPageObj.h,p.pagenumber,r)&&(n=!0);return n},this.gethyperlink=function(e,t){var a=!1;return p.usevectorxml&&(a=p.getinsideHyperlink(e,t,p.dscalevector,p.dxvector,p.dyvector,!1)),a},this.gethyperlinkhover=function(e,t){var a=!1;return p.usevectorxml&&(a=p.getinsideHyperlink(e,t,p.dscalevector,p.dxvector,p.dyvector,!0)),a},this.getvectorentity=function(e,t){var a=!1;return p.usevectorxml&&(a=p.VectorPageObj.getvectorinformation(e,t,p.dscalevector,p.dxvector,p.dyvector,!1),p.draw_vector(!1),p.vectorischanged=!0),a},this.getvectorentityhover=function(e,t){var a=!1;return p.usevectorxml&&(a=p.VectorPageObj.getvectorinformation(e,t,p.dscalevector,p.dxvector,p.dyvector,!0),p.draw_vector(!1),p.vectorischanged=!0),a},this.getpolygonhover=function(e,t){var a=!1;return p.usevectorxml&&(a=p.VectorPageObj.getinsidePolygon(e,t,p.dscalevector,p.dxvector,p.dyvector,!1,!0),p.draw_vector(!1),p.vectorischanged=!0),a},this.getpolygon=function(e,t,a){var i=!1;return p.usevectorxml&&(i=p.VectorPageObj.getinsidePolygon(e,t,p.dscalevector,p.dxvector,p.dyvector,a,!1),p.draw_vector(!1),p.vectorischanged=!0),i},this.rendervectormouseover=function(){p.usevectorxml&&null!=p.VectorPageObj&&p.VectorPageObj.rendermouseonVectors(p.dscalevector,p.dxvector,p.dyvector,p.drotation)},this.renderSelectedBlocks=function(){p.usevectorxml&&null!=p.VectorPageObj&&p.VectorPageObj.renderSelectedBlocks(p.dscalevector,p.dxvector,p.dyvector,p.drotation)},this.getblockinserthover=function(e,t){var a=!1;return p.usevectorxml&&(a=p.VectorPageObj.getinsideblockinsert(e,t,p.dscalevector,p.dxvector,p.dyvector,p.drotation,!0),p.draw_vector(!1),p.vectorischanged=!0),a},this.getblockinsert=function(e,t){var a=!1;return p.usevectorxml&&(a=p.VectorPageObj.getinsideblockinsert(e,t,p.dscalevector,p.dxvector,p.dyvector,p.drotation,!1),p.draw_vector(!1),p.vectorischanged=!0),a},this.unSelectAllBlockInserts=function(){p.usevectorxml&&p.VectorPageObj&&p.VectorPageObj.unSelectAllBlockInserts()},this.unSelectAllBlocks=function(e){p.usevectorxml&&(p.VectorPageObj.unSelectAllBlocks(e),p.draw_vector(!1),p.vectorischanged=!0)},this.getPDFcoordsPos=function(e,t,a,i,s){var r=e,n=t;return p.getpageRotation(),(r=(e-a)/(p.curpagescale*s))<0&&(r=0),(n=-((t-i)/(p.curpagescale*s)-p.pdfpageheight))<0&&(n=0),{x:r,y:n}},this.getPDFDist=function(e){return e/(p.curpagescale*p.dscalepdf)},this.getPDFDistScale=function(e,t){return e/(p.curpagescale*t)},this.returnFoxitpageCoords=function(e){console.log(e)},this.getFoxitpageCoords=function(e){null!=p.DocRef.foxitdoc&&p.DocRef.foxitdoc.getPDFpagecoordinates(e,p.pagenumber,p.returnFoxitpageCoords)},this.getPDFCoordsRot=function(e){e.x,e.y,e.y,e.x,e.y,e.y;var t={x:e.x,y:e.y},a=(X(p.getpageRotation(),p.foxitpageorigrot),p.dxpdfzerorot),i=p.dypdfzerorot;return{x:(t.x-a)/(p.curpagescale*p.dscalepdf),y:-((t.y-i)/(p.curpagescale*p.dscalepdf)-p.pdfpageheight),mx:t.x,my:t.y}},this.getPDFcoords=function(e,t){var a=e,i=t,s=t,r=e,n=t,o=.5*p.originalPDFwidth,l=.5*p.originalPDFheight,c=p.originalPDFwidth-p.originalPDFheight,h=p.dxpdf,d=p.dypdf,u=p.dxpdfnonrot,g=p.dypdfnonrot;if(a=(e-h)/(p.curpagescale*p.dscalepdf),s=-((i=(t-d)/(p.curpagescale*p.dscalepdf))-p.pdfpageheight),90!=p.getpageRotation()&&270!=p.getpageRotation()||p.bpagesizeupdated&&(270==p.getpageRotation()||90==p.getpageRotation())&&(s=-(i-p.pdfpagewidth)),i=s,r=(e-u)/(p.curpagescale*p.dscalepdf),n=-((n=(t-g)/(p.curpagescale*p.dscalepdf))-p.pdfpageheight),270==p.foxitpageorigrot&&90==p.getpageRotation()&&(i=n,a=r),90==p.foxitpageorigrot&&270==p.getpageRotation()&&(i=n,a=r),0==p.getpageRotation())switch(p.foxitpageorigrot){case 270:var f=a-=o;a=i-=l,i=-f,a+=o,i+=l,a-=.5*c,i+=.5*c,f=r-=o,r=n=r-l,n=-f,r+=o,n+=l,r-=.5*c,n+=.5*c;break;case 90:f=a-=o,a=-(i-=l),i=f,a+=o,i+=l,a-=.5*c,i+=.5*c,f=r-=o,r=-(n=r-l),n=f,r+=o,n+=l,r-=.5*c,n+=.5*c;break;case 180:a=-(a-=o),i=-(i-=l),a+=o,i+=l,n=(r-=o)-l,r=-r,n=-n,r+=o,n+=l}return 0==p.foxitpagerot||p.getpageRotation(),{x:a,y:i,mx:e,my:t}},this.getPDFSnapPointArray=function(e,t){var a={x:e,y:t};e=a.x,t=a.y;var i=p.PDFSnapPoint,s={found:!1,x:0,y:0,type:1};if(null!=i){var r=e-i.x,n=t-i.y;Math.sqrt(r*r+n*n)<20&&(s=i)}return s},this.setPDFSnapPointArray=function(e){p.PDFSnapPoint=e},this.adjustpointpdfsnap=function(e){return 0==p.getpageRotation()?(e.x=e.x+p.dxpdf,e.y=e.y+p.dypdf):(p.getpageRotation(),e.x=e.x+p.dxpdfnonrot,e.y=e.y+p.dypdfnonrot),e},this.foxitsnapCallback=function(e){e.found&&(e=p.adjustpointpdfsnap(e)),p.setPDFSnapPointArray(e),p.pdfsnapready=!0},this.getPDFsnapPoint=function(e,t){var a={found:!1,change:!1,x:0,y:0,type:1},i={x:e,y:t};if(null!=p.DocRef.foxitdoc&&Fi&&p.pdfsnapready){p.DocRef.foxitdoc.pdfViewer.getCurrentPDFDoc().getPageByIndex(p.pagenumber);var s=p.getpageRotation();if(90==s||270==s||180==s)p.DocRef.foxitdoc.getSnapPointRotate(p.pagenumber,i.x,i.y,p.foxitsnapCallback);else{var r=p.getPDFCoordsRot(i);p.DocRef.foxitdoc.getSnapPoint(p.pagenumber,r.x,r.y,p.foxitsnapCallback)}return p.pdfsnapready=!1,p.getPDFSnapPointArray(i.x,i.y)}var n=[];if(null==p.PDFPointArray)return a;p.PDFinternalScale.x>0?(p.pdfSnapScale,p.PDFinternalScale.x):p.pdfSnapScale,p.PDFinternalScale.y>0?(p.pdfSnapScale,p.PDFinternalScale.y):p.pdfSnapScale;for(var o=p.offscreenheight*p.dscalepdf,l=p.offscreenwidth*p.dscalepdf,c=0;c<p.PDFPointArray.length;c++){if(0!=p.PDFpageRotate)if(90==p.PDFpageRotate)var h=p.starty+-p.PDFPointArray[c].y*p.pdfSnapScale,d=p.startx+p.PDFPointArray[c].x*p.pdfSnapScale;else h=p.starty+(-p.PDFPointArray[c].y*p.pdfSnapScale+o),d=p.startx+p.PDFPointArray[c].x*p.pdfSnapScale+l;else h=p.PDFPointArray[c].y<0?p.starty+-p.PDFPointArray[c].y*p.pdfSnapScale:p.starty+(-p.PDFPointArray[c].y*p.pdfSnapScale+o),d=p.PDFPointArray[c].x<0?p.startx+p.PDFPointArray[c].x*p.pdfSnapScale+l:p.startx+p.PDFPointArray[c].x*p.pdfSnapScale;var u=e-d,g=t-h,f=Math.sqrt(u*u+g*g);f<10&&n.push({x:d,y:h})}if(n.length>0){u=e-n[0].x,g=t-n[0].y;var m=Math.sqrt(u*u+g*g);f=Math.sqrt(u*u+g*g);var y=0;for(c=0;c<n.length;c++)u=e-n[c].x,g=t-n[c].y,(f=Math.sqrt(u*u+g*g))<m&&(m=f,y=c);a={found:!0,x:n[y].x,y:n[y].y,type:1}}else a={found:!1,change:!1,x:0,y:0,type:1};return a},this.getsnap=function(e){if(p.usevectorxml&&p.snapEnabled)return null!=p.VectorPageObj?p.VectorPageObj.getsnapPoint(e.x,e.y,p.dscalevector,p.dxvector,p.dyvector):{found:!1,change:!1,x:0,y:0};if(p.usepdfjs&&p.snapEnabled){var t=p.getPDFsnapPoint(e.xus,e.yus),a=Hl();return t.x*=a,t.y*=a,t}return{found:!1,change:!1,x:0,y:0}},this.draw_vectorPrint=function(){p.printobj.printctx.fillStyle="rgb(255,255,255)",p.printobj.printctx.fillRect(0,0,p.printobj.paperimage.width,p.printobj.paperimage.height),null!=this.VectorPageObj&&(this.VectorPageObj.drawallnew(p.printobj.printctx,p.printobj.pscale,p.printobj.pdx,p.printobj.pdy,!0,!0),jl(p.printobj.printctx,p.pagenumber,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale))},this.magnifyoff=function(){p.usevector3Dxml||(p.usevectorxml?p.draw_vector(!0):p.usepdfjs?p.DocRef.draw_mpagepdf(!1):0==p.DocRef.Type?p.DocRef.draw_mpage():p.draw_image(!0))},this.drawmarkupcliprect=function(e,t){if(0==p.getpageRotation())var a=e.x,i=e.y;else{var s=In({x:e.x+.5*e.w,y:e.y+.5*e.h},ti/2,ai/2,360-p.getpageRotation());a=s.x-.5*e.w,i=s.y-.5*e.h}if(p.usevectorxml)var r=p.dscalevector,n=-a+p.dxvector,o=-i+p.dyvector;else if(p.usepdfjs)r=p.dscalepdf*p.curpagescale,n=-a+p.dxpdf,o=-i+p.dypdf;else{switch(p.currentimage){case 0:r=p.dscale,n=-a+p.dx,o=-i+p.dy;break;case 1:r=p.dscale/p.bitmapratio,n=-a+p.dx,o=-i+p.dy}r=p.dscale}Il(t,p.pagenumber,n,o,r,p.getpageRotation())},this.drawmagnify=function(e,t,a){if(!p.usevector3Dxml){if(0==p.getpageRotation())var i=e.x-Se.width/2/a,s=e.y-Se.height/2/a;else{var r=In(e,ti/2,ai/2,360-p.getpageRotation());i=r.x-Se.width/2/a,s=r.y-Se.height/2/a}t.fillStyle=p.DocRef.backgroundColor,t.fillRect(0,0,Se.width,Se.height);var n=Se.width/2,o=Se.height/2;if(p.usevectorxml){var l=p.dscalevector*a,c=-i+p.dxvector,h=-s+p.dyvector;c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),p.VectorPageObj.drawallmagnify(t,l,c,h)}else if(p.usepdfjs)l=p.dscalepdf*p.curpagescale*a,p.magnifycanvas.width,p.magnifyrestscale,p.magnifycanvas.height,p.magnifyrestscale,c=-i+p.dxpdf,h=-s+p.dypdf,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.magnifycanvas,c,h);else{switch(p.currentimage){case 0:l=p.dscale*a,c=-i+p.dx,h=-s+p.dy,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.largeimagecnv,c,h,p.MainImageWidth*l,p.MainImageHeight*l);break;case 1:l=p.dscale/p.bitmapratio*a,c=-i+p.dx,h=-s+p.dy,c*=a,h*=a,0==p.getpageRotation()||(t.save(),t.translate(n,o),t.rotate(p.getpageRotation()*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(p.smallimagecnv,c,h,p.SmallImageWidth*l,p.SmallImageHeight*l)}l=p.dscale*a}0==p.getpageRotation()?Il(t,p.pagenumber,c,h,l,p.getpageRotation()):(Il(t,p.pagenumber,c,h,l,p.getpageRotation()),t.restore())}},this.refresh_vectorPath=function(e){p.backupScaleAndOffset(),s.fillRect(0,0,ti,ai);var t=ti/2,a=ai/2;null!=this.VectorPageObj&&(0==this.getpageRotation()?this.VectorPageObj.refreshPath(e,s,this.dscalevector,this.dxvector,this.dyvector):(s.save(),s.translate(t,a),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-t,-a),this.VectorPageObj.refreshPath(e,s,this.dscalevector,this.dxvector,this.dyvector),s.restore()))},this.draw_vector_selected=function(){p.backupScaleAndOffset(),s.fillRect(0,0,ti,ai);var e=ti/2,t=ai/2;null!=this.VectorPageObj&&(0==this.getpageRotation()?this.VectorPageObj.drawSelected(s,this.dscalevector,this.dxvector,this.dyvector):(s.save(),s.translate(e,t),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-e,-t),this.VectorPageObj.drawSelected(s,this.dscalevector,this.dxvector,this.dyvector),s.restore()))},this.invert_images=function(e){this.VectorPageObj.invert_images(e)},this.draw_vector=function(e){if(p.backupScaleAndOffset(),!p.DocRef.bSopenSilent&&p.DocRef.bActive){s.fillStyle=xs,s.fillRect(0,0,ti,ai);var t=ti/2,a=ai/2;gi=!0,null!=this.VectorPageObj&&(Ni||(0==this.getpageRotation()?this.VectorPageObj.drawallnew(s,this.dscalevector,this.dxvector,this.dyvector,e,!1):(s.save(),s.translate(t,a),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-t,-a),this.VectorPageObj.drawallnew(s,this.dscalevector,this.dxvector,this.dyvector,e,!1),s.restore())))}},this.removevisibleTile=function(e,t){for(var a=0;a<p.visibleTiles.length;a++)p.visibleTiles[a].r==e&&p.visibleTiles[a].c==t&&p.visibleTiles.splice(a,1)},this.addvisibleTile=function(e,t){p.visibleTiles=[],p.visibleTiles.push({row:e,column:t})},this.draw_tiled_cavas=function(e,t,a,i){if(0!=p.canvtileArray.length&&null!=p.canvtileArray[0][0]&&null!=p.canvtileArray[0][0].cnv){var s=p.canvtileArray[0][0].cnv.width,r=p.canvtileArray[0][0].cnv.height,n=t,o=a,l=0,c=0;p.tilevisibiltychanged=!1;for(var h=0;h<p.canvtileArray.length;h++){for(var d=0;d<p.canvtileArray[h].length;d++){s=p.canvtileArray[h][d].cnv.width,r=p.canvtileArray[h][d].cnv.height,l=p.canvtileArray[h][d].xoffset,c=p.canvtileArray[h][d].yoffset;var u=0!=p.canvtileArray[h][d].cnv.width,g=0!=p.canvtileArray[h][d].cnv.height;n<ti&&o<ai&&n+s*i>0&&o+r*i>0?(u&&g&&e.drawImage(p.canvtileArray[h][d].cnv,n,o,s*i,r*i),p.canvtileArray[h][d].visible||(p.tilevisibiltychanged=!0),p.canvtileArray[h][d].visible=!0,p.tilespending&&(p.tilespending=!1),p.prioritytilespending&&(p.prioritytilespending=!1)):(p.canvtileArray[h][d].visible&&(p.tilevisibiltychanged=!0),p.canvtileArray[h][d].visible=!1),n+=l*i}o+=c*i,n=t}}},this.draw_foxit_annots=function(e,t,a,i){for(var s=t,r=a,n=0;n<p.annotArray.length;n++){p.annotArray[n].cnv.width,p.annotArray[n].cnv.height;var o=p.annotArray[n].pos.left*i,l=p.annotArray[n].pos.top*i;o+=s,l+=r,e.drawImage(p.annotArray[n].cnv,o,l,p.annotArray[n].pos.width*i*p.annotArray[n].pos.scale,p.annotArray[n].pos.height*i*p.annotArray[n].pos.scale)}},this.removesamerects=function(e){for(var t=[],a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)e[a][i].match.pageIndex==p.pagenumber&&(e[a][i].match.rectArray[0],i&&t.push({outer:a,inner:i}),e[a][i].match.rectArray[0]);return t},this.getpagerectdim=function(e){for(var t=[],a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)if(e[a][i].match.pageIndex==p.pagenumber){var s=e[a][i].match.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,r=(p.pdfpageheight-e[a][i].match.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,n=e[a][i].match.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-s,o=(p.pdfpageheight-e[a][i].match.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-r;t.push({x:s,y:r,w:n,h:o,pagenum:e[a][i].match.pageIndex,pageheight:p.pdfpageheight})}return t},this.drawsearchRect=function(){var e=Hl();if(p.DocRef.foxitsearchobj.page==p.pagenumber&&p.DocRef.foxitsearchobj.active){n.save();var t=p.DocRef.foxitsearchobj.getcurmatch();if(!t)return;var a=t.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,i=(p.pdfpageheight-t.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,s=t.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-a,r=(p.pdfpageheight-t.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-i;a*=e,i*=e,s*=e,r*=e,n.clearRect(a,i,s,r),n.fillStyle="rgba(238, 238, 0, 0.3)",n.fillRect(a,i,s,r),n.restore()}},this.drawsearchRects=function(e){const t=p.DocRef.currentpage;p.DocRef.pages[t];var a=Hl();n.save();for(var i=0;i<e.length;i++)for(var s=0;s<e[i].length;s++)if(e[i][s].match.pageIndex==t){const t=e[i][s].match;var r=t.rectArray[0].left*(p.curpagescale*p.dscalepdf)+p.dxpdf,o=(p.pdfpageheight-t.rectArray[0].top)*(p.curpagescale*p.dscalepdf)+p.dypdf,l=t.rectArray[0].right*(p.curpagescale*p.dscalepdf)+p.dxpdf-r,c=(p.pdfpageheight-t.rectArray[0].bottom)*(p.curpagescale*p.dscalepdf)+p.dypdf-o;r*=a,o*=a,l*=a,c*=a,e[i][s]==p.DocRef.foxitsearchobj.orangeItem?n.fillStyle="rgba(255, 165, 0, 0.3)":n.fillStyle="rgba(238, 238, 0, 0.3)",n.fillRect(r,o,l,c)}n.restore()},this.draw_canvas_compare=function(e,t,a,i){var s=p.pagecanvas.width,r=p.pagecanvas.height,n=t,o=a;e.drawImage(p.pagecanvas,n,o,s*p.dscalepdf,r*p.dscalepdf)},this.draw_canvas=function(e){if(p.backupScaleAndOffset(),!p.DocRef.bSopenSilent&&p.DocRef.bActive){e&&(s.fillStyle=xs,s.fillRect(0,0,ti,ai));var t=ti/2,a=ai/2;gi=!0;var i=1==this.DocRef.pages.length;if(this.DocRef.pagelocked||i)var r=this.getpageRotation();else r=0;if(!Ni){if(!p.pdfdiminitset)return p.DocRef.pages[p.pagenumber-1]&&p.DocRef.pages[p.pagenumber-1].endy,s.fillStyle="rgb(255,255,255)",void s.fillRect(p.DocRef.pages[0].dxpdf,0,p.DocRef.pages[0].offscreenwidth*p.DocRef.pages[0].dscalepdf,p.DocRef.pages[0].offscreenheight*p.DocRef.pages[0].dscalepdf);if(0==r){if(p.iscollapsed||!p.pdfisfirstrendered)if(!p.pdfisfirstrendered&&zi){if(s.fillStyle="rgb(255,255,255)",p.pdfisfirstrendered)n=this.dscalepdf;else var n=1;s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*n,p.offscreenheight*n)}else s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf);else s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf),p.draw_tiled_cavas(s,this.dxpdf,this.dypdf,this.dscalepdf),p.draw_foxit_annots(s,this.dxpdf,this.dypdf,this.dscalepdf);p.drawtextSearchRect&&p.drawsearchRect()}else s.save(),s.translate(t,a),s.rotate(r*(Math.PI/180)),s.translate(-t,-a),p.pdfisrendered&&!p.iscollapsed?(s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf),p.draw_tiled_cavas(s,this.dxpdf,this.dypdf,this.dscalepdf),p.draw_foxit_annots(s,this.dxpdf,this.dypdf,this.dscalepdf)):(s.fillStyle="rgb(255,255,255)",s.fillRect(this.dxpdf,this.dypdf,p.offscreenwidth*this.dscalepdf,p.offscreenheight*this.dscalepdf)),s.restore()}}},this.transparent=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]&&(e[t+3]=100)},this.setcolor=function(e,t){for(var a=Nn(t),i=0;i<e.length;i+=4)255==e[i]&&255==e[i+1]&&255==e[i+2]||254==e[i]&&254==e[i+1]&&254==e[i+2]?e[i+3]=100:(e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b)},this.setred=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]?e[t+3]=100:(e[t]=255,e[t+1]=128,e[t+2]=0)},this.setblue=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]||(e[t]=0,e[t+1]=0,e[t+2]=255)},this.setinvert=function(e){for(var t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]},this.invertpdfmagnify=function(e){try{var t=p.magnifypagectx.getImageData(0,0,p.magnifycanvas.width,p.magnifycanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.magnifycanvas.width,p.magnifycanvas.height),e=-1}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}-1!=e&&p.magnifypagectx.putImageData(t,0,0)},this.invertpdfprint=function(e){switch(e){case 1:try{var t=p.compositePrintreference.bgpagectx.getImageData(0,0,p.compositePrintreference.bgpagecanvas.width,p.compositePrintreference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositePrintreference.bgpagecanvas.width,p.compositePrintreference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositePrintreference.ovpagectx.getImageData(0,0,p.compositePrintreference.ovpagecanvas.width,p.compositePrintreference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositePrintreference.ovpagecanvas.width,p.compositePrintreference.ovpagecanvas.height),e=-1}}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:p.compositePrintreference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositePrintreference.ovpagectx.putImageData(t,0,0)}},this.transparentpdf=function(e){switch(e){case 1:try{var t=p.compositereference.bgpagectx.getImageData(0,0,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositereference.ovpagectx.getImageData(0,0,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height),e=-1}}switch(e){case 0:p.setinvert(t.data);break;case 1:case 2:p.transparent(t.data)}if(-1!=e)switch(e){case 1:p.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositereference.ovpagectx.putImageData(t,0,0)}},this.invertpdf=function(e){switch(e){case 1:try{var t=p.compositereference.bgpagectx.getImageData(0,0,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.bgpagecanvas.width,p.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=p.compositereference.ovpagectx.getImageData(0,0,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,p.compositereference.ovpagecanvas.width,p.compositereference.ovpagecanvas.height),e=-1}}var a=p.compositereference.getColors();switch(e){case 0:p.setinvert(t.data);break;case 1:p.setcolor(t.data,a.bg);break;case 2:p.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:p.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:p.compositereference.ovpagectx.putImageData(t,0,0)}},this.transparentimage=function(e){var t=p.largeimagectx.getImageData(0,0,p.largeimagecnv.width,p.largeimagecnv.height),a=p.smallimagectx.getImageData(0,0,p.smallimagecnv.width,p.smallimagecnv.height),i=a.data;switch(e){case 0:p.setinvert(i);break;case 1:case 2:p.transparent(i)}switch(p.smallimagectx.putImageData(a,0,0),i=t.data,e){case 0:p.setinvert(i);break;case 1:case 2:p.transparent(i)}p.largeimagectx.putImageData(t,0,0),p.largeimagectx.putImageData(t,0,0),p.draw_image(!0)},this.invert=function(e){var t=p.largeimagectx.getImageData(0,0,p.largeimagecnv.width,p.largeimagecnv.height),a=p.smallimagectx.getImageData(0,0,p.smallimagecnv.width,p.smallimagecnv.height),i=a.data,s=p.compositereference.getColors();switch(e){case 0:p.setinvert(i);break;case 1:p.setcolor(i,s.bg);break;case 2:p.setcolor(i,s.fg)}switch(p.smallimagectx.putImageData(a,0,0),i=t.data,e){case 0:p.setinvert(i);break;case 1:p.setcolor(i,s.bg);break;case 2:p.setcolor(i,s.fg)}p.largeimagectx.putImageData(t,0,0),p.draw_image(!0)},this.resetimage=function(){var e=p.MainImageWidth,t=p.MainImageHeight;p.largeimagecnv.width=e,p.largeimagecnv.height=t,p.largeimagectx.drawImage(p.largeimage,0,0,e,t),this.smallimagecreatefromlarge()},this.draw_imagePrint=function(){p.printobj.printctx.drawImage(this.largeimage,p.printobj.pdx,p.printobj.pdy,p.printobj.docwidth*p.printobj.pscale,p.printobj.docheight*p.printobj.pscale),jl(p.printobj.printctx,p.pagenumber,p.printobj.pdx,p.printobj.pdy,p.printobj.pscale)},this.draw_image=function(e){if(p.backupScaleAndOffset(),!p.DocRef.bSopenSilent){e&&(s.fillStyle=xs,s.fillRect(0,0,ti,ai));var t=ti/2,a=ai/2;if(gi=!0,!Ni)switch(this.currentimage){case 0:0==this.getpageRotation()?s.drawImage(this.largeimagecnv,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale):(s.save(),s.translate(t,a),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-t,-a),s.drawImage(this.largeimagecnv,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale),s.restore());break;case 1:var i=p.dscale/p.bitmapratio;0==this.getpageRotation()?s.drawImage(this.smallimagecnv,this.dx,this.dy,this.SmallImageWidth*i,this.SmallImageHeight*i):(s.save(),s.translate(t,a),s.rotate(this.getpageRotation()*(Math.PI/180)),s.translate(-t,-a),s.drawImage(this.smallimagecnv,this.dx,this.dy,this.SmallImageWidth*i,this.SmallImageHeight*i),s.restore())}}}}}class Mc{constructor(t){var i=this,s=$,r=0,o=!1,l=0,c=!1;he&&(s=fe),this.bRenderinProgress=!1,this.bcompare=!1,this.usepagesload=!1,this.bdelayedClose=!1,this.fileindex=0,this.relativepath=void 0,this.bActive=!0,this.bSopenSilent=!1,this.textselect=!1,this.id=Math.ceil(1e4*Math.random()),this.hastext=!1,this.markuploaded=!1,this.pagelocked=!1,this.lockedpage=i.currentpage,this.prevpage=0,this.currentpage=0,this.scrollbarwidth=15,this.restorecurpage=0,this.backgroundColor=cs,this.monoChrome=!1,this.bMarkupchanged=!1,this.curcontrol3D="orbitControl",this.bMarkupLocked=!1,this.bDoPrint=!1,this.bLargePDF=!1,this.FileLocal=!1,this.largePDFPagerange=4,this.endpagerange=4,this.startpagerange=0,this.pagerangelimit=1,this.pdfLoadingTask=null,this.PDFWrapper=null,this.foxitdoc=null,this.documentrotation=0,this.foxitannotations=void 0,this.bdestroyPDFonClose=!1,this.PDFpagescale={width:1,height:1,scale:1},this.PDFPassword=null,this.markup3DSavepath=null,this.views3DSavepath=null,this.setComparelink=void 0,this.tempPage=void 0,this.markupsave=void 0,this.markupselectedChangeSaved=!1,this.xrefs=[],this.fonts=[],this.markupfileURLs=[],this.scalesOptions=[],this.markupsearchobj={matcharray:[],active:!1,forward:!0,casesens:!1,expr:"",indx:0,page:0,padding:{x:50,y:50,w:50,h:100},next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].pagenumber)},previous:function(){0!=this.matcharray.length&&(this.indx--,this.indx<0&&(this.indx=this.matcharray.length-1),this.page=this.matcharray[this.indx].pagenumber)},start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].pagenumber)}},this.foxitsearchobjrect={matcharray:[],pagedims:[],curRect:{left:0,right:0,top:0,bottom:0},active:!1,forward:!0,casesens:!1,expr:"",outerindx:0,innerindx:0,page:0,firstpage:0,lastpage:0,pageindex:0,foxit:!0,getpages:function(){for(var e=0;e<this.matcharray.length;e++)this.pagedims.push({page:this.matcharray[e][0].match.pageIndex,done:!1});return this.pagedims},next:function(){0!=this.matcharray.length&&(this.innerindx<this.matcharray[this.outerindx].length-1?this.innerindx++:this.outerindx<this.matcharray.length-1?(this.innerindx=0,this.outerindx++):(this.outerindx=0,this.innerindx=0),null==this.matcharray[this.outerindx][this.innerindx].match?(this.outerindx=0,this.innerindx=0):this.page=this.matcharray[this.outerindx][this.innerindx].match.pageIndex)},previous:function(){0!=this.matcharray[this.outerindx].length&&0!=this.matcharray.length&&(this.innerindx>0?this.innerindx--:this.outerindx>0?(this.innerindx=this.matcharray[this.outerindx].length-1,this.outerindx--):(this.outerindx=this.matcharray.length-1,this.innerindx=this.matcharray[this.outerindx].length-1),null==this.matcharray[this.outerindx][this.innerindx].match?(this.outerindx=0,this.innerindx=0):this.page=this.matcharray[this.outerindx][this.innerindx].match.pageIndex)},start:function(){if(0!=this.matcharray.length){for(var e=0;e<this.matcharray.length;e++)this.pagedims.push({page:this.matcharray[e][0].match.pageIndex,done:!1});this.pageindex=0,this.firstpage=this.pagedims[this.pageindex].page,this.lastpage=this.pagedims[this.pagedims.length-1].page,this.page=this.firstpage,i.currentpage==this.pagedims[this.pageindex].page&&(this.active?this.setpagerect(this.pagedims[this.pageindex].page):i.GotoPage(this.firstpage))}},getcurmatch:function(){return this.matcharray[this.outerindx][this.innerindx]?this.matcharray[this.outerindx][this.innerindx].match:null},getpagerects:function(e){if(e&&null!=i.pages[this.page])var t=i.pages[e];else t=i.pages[this.page];return t.getpagerectdim(this.matcharray)},setpagerect:function(e){e!=this.pagedims[this.pageindex].page||this.pagedims[this.pageindex].done?i.GotoPage(this.pagedims[this.pageindex].page,!0):(null!=Ga&&(this.page=e,Ga.numTextFound(i.pages[this.page].getpagerectdim(this.matcharray),e)),this.pagedims[this.pageindex].done=!0,this.pageindex<this.pagedims.length-1?(this.pageindex++,i.GotoPage(this.pagedims[this.pageindex].page,!0)):this.pageindex==this.pagedims.length-1&&i.foxitSearchTextRectEnd())},getpagesdone:function(){return this.pagedims.length}},this.foxitsearchobj={matcharray:[],clonearray:[],curRect:{left:0,right:0,top:0,bottom:0},active:!1,forward:!0,casesens:!1,expr:"",outerindx:0,innerindx:0,page:0,wholedocument:!1,wholeword:!1,orangeItem:null,next:function(){0!=this.matcharray.length&&(this.innerindx<this.matcharray[this.outerindx].length-1?this.innerindx++:this.outerindx<this.matcharray.length-1?(this.innerindx=0,this.outerindx++):(this.outerindx=0,this.innerindx=0),null!=this.matcharray[this.outerindx][this.innerindx]?null==this.matcharray[this.outerindx][this.innerindx].match?(this.outerindx=0,this.innerindx=0):this.page=this.matcharray[this.outerindx][this.innerindx].match.pageIndex:(this.outerindx=0,this.innerindx=0))},previous:function(){0!=this.matcharray[this.outerindx].length&&0!=this.matcharray.length&&(this.innerindx>this.matcharray[this.outerindx].length-1&&(this.innerindx=this.matcharray[this.outerindx].length-1),this.innerindx>0?this.innerindx--:this.outerindx>0?(this.outerindx--,this.innerindx=this.matcharray[this.outerindx].length-1):(this.outerindx=this.matcharray.length-1,this.innerindx=this.matcharray[this.outerindx].length-1),null==this.matcharray[this.outerindx][this.innerindx].match?(this.outerindx=0,this.innerindx=0):this.page=this.matcharray[this.outerindx][this.innerindx].match.pageIndex)},start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.outerindx][this.innerindx].match.pageIndex)},getcurmatch:function(){return this.matcharray[this.outerindx][this.innerindx]?this.matcharray[this.outerindx][this.innerindx].match:null}},this.searchobj={matcharray:[],active:!1,forward:!0,casesens:!1,expr:"",indx:0,page:0,next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].page)},previous:function(){0!=this.matcharray.length&&(this.indx--,this.indx<0&&(this.indx=this.matcharray.length-1),this.page=this.matcharray[this.indx].page)},start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].page)}},this.extractsearchobj={matcharray:[],foundrects:[],active:!1,casesens:!1,expr:"",indx:0,page:0,start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].page)},next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].page)}},null!=t.getElementsByTagName("Version")[0]&&(this.Version=t.getElementsByTagName("Version")[0].firstChild.nodeValue),null!=t.getElementsByTagName("NumPages")[0]&&(this.NumPages=t.getElementsByTagName("NumPages")[0].firstChild.nodeValue),null!=t.getElementsByTagName("NumLayouts")[0]&&(this.NumLayouts=t.getElementsByTagName("NumLayouts")[0].firstChild.nodeValue),null!=t.getElementsByTagName("FileName")[0]&&(this.FileName=t.getElementsByTagName("FileName")[0].firstChild.nodeValue),this.FileName=decodeURIComponent(this.FileName),this.CacheFileName=this.FileName;var h=_o(this.FileName);if(this.CachePath=Ho(this.FileName),he&&(this.FileName=h),this.openFileName=this.FileName,null!=t.getElementsByTagName("OriginalURL")[0]&&(this.OriginalURL=t.getElementsByTagName("OriginalURL")[0].firstChild.nodeValue,this.OriginalURL=decodeURIComponent(this.OriginalURL)),null!=t.getElementsByTagName("Format")[0]&&(this.Format=t.getElementsByTagName("Format")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Filter")[0]&&(this.Filter=t.getElementsByTagName("Filter")[0].firstChild.nodeValue),null!=t.getElementsByTagName("FileSizeLow")[0]&&(this.FileSizeLow=t.getElementsByTagName("FileSizeLow")[0].firstChild.nodeValue),null!=t.getElementsByTagName("FileSizeHigh")[0]&&(this.FileSizeHigh=t.getElementsByTagName("FileSizeHigh")[0].firstChild.nodeValue),null!=t.getElementsByTagName("PublisherVersion")[0]&&(this.PublisherVersion=t.getElementsByTagName("PublisherVersion")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Type")[0]&&(this.Type=t.getElementsByTagName("Type")[0].firstChild.nodeValue),null!=t.getElementsByTagName("XREFS"))for(var p=t.getElementsByTagName("XREF"),u=0;u<p.length;u++)if(null!=p[u].getElementsByTagName("FileName")[0].firstChild){var g={path:p[u].getElementsByTagName("FileName")[0].firstChild.nodeValue,found:"true"==p[u].getElementsByTagName("Found")[0].firstChild.nodeValue};this.xrefs.push(g)}if(null!=t.getElementsByTagName("Fonts")){var f=t.getElementsByTagName("Font");for(u=0;u<f.length;u++){var m={path:f[u].getElementsByTagName("FileName")[0].firstChild.nodeValue,found:"true"==f[u].getElementsByTagName("Found")[0].firstChild.nodeValue};this.fonts.push(m)}}if(null!=t.getElementsByTagName("Summary")){var y=t.getElementsByTagName("Property");for(u=0;u<y.length;u++){if(null!=y[u].getElementsByTagName("Name")&&null!=y[u].getElementsByTagName("Name")[0].firstChild)var v=y[u].getElementsByTagName("Name")[0].firstChild.nodeValue;else v="";if(null!=y[u].getElementsByTagName("Value")&&null!=y[u].getElementsByTagName("Value")[0].firstChild)var x=y[u].getElementsByTagName("Value")[0].firstChild.nodeValue;else x="";"ACAD_MEASUREMENT"==v&&(this.CadMeasurement=parseInt(x))}}if(null!=t.getElementsByTagName("FileLocal")[0]){this.FileLocal=!0;for(var b=0;b<vr.length;b++)vr[b].filenameonly==i.FileName&&Uc(vr[b],i.fileindex)}function w(e){const t=new Set;return e.forEach(e=>{if(1===e.length)t.add(e[0]);else for(let a=e[0];a<=e[1];a++)t.add(a)}),t}function w(e){const t=new Set;return e.forEach(e=>{if(1===e.length)t.add(e[0]);else for(let a=e[0];a<=e[1];a++)t.add(a)}),t}function k(e){return new Promise(t=>{window.addEventListener("rx_page_change_done",(function a(i){i?.detail?.currentPage===e&&(window.removeEventListener("rx_page_change_done",a),t())}))})}function D(e){return new Promise(t=>{window.addEventListener("rx_page_change_done",(function a(i){i?.detail?.currentPage===e&&(window.removeEventListener("rx_page_change_done",a),t())}))})}function C(e){var t=null==i.pages[e];if(t)var a=!1,s=!1;else a=i.pages[e].pageloaded,s=i.pages[e].pdfdiminitset;return{havepage:!t,loaded:a,pdfdimset:s}}null!=t.getElementsByTagName("FileNameSRC")[0]&&(this.FileNameSRC=encodeURI(s+t.getElementsByTagName("FileNameSRC")[0].firstChild.nodeValue),this.CacheURL=zo(this.FileNameSRC)),this.thumbnailobects=[],this.thumbnails=[],this.hoverspace=null,this.Drawmarkup=!0,this.thumbnailhtmlsource="",this.layerhtmlsource="",this.layouts=[],this.pages=[],this.pagerotations=[],this.markuplist=[],this.markupdraworder=[],this.markupdraworderChange=!1,this.selectedmarkup={id:-1,selected:!1,edit:!1},this.rangeupdated={start:0,end:0,operation:"none"},this.markupundolist=[],this.markupredolist=[],this.tempundolist=[],this.documentproperties=[],this.pageSearchArr=[],this.nummarkups=0,this.pdfDoc=null,this.pdfURL="",this.pageNum=1,this.pageRendering=!1,this.pageNumPending=null,this.scale=.8,this.pdftimervar=null,this._pagesRefCache=Object.create(null),this.pdfoutline=void 0,this.scrollbuttonStats={topscrbutton:!1,bottomscrbutton:!1,rightscrbutton:!1,leftscrbutton:!1},this.mouseOffScroll=function(){null!=i.foxitdoc&&(i.foxitdoc.onScollV(!1),i.foxitdoc.onScollVGrip(!1),i.scrollbuttonStats.bottomscrbutton=!1,i.scrollbuttonStats.topscrbutton=!1,i.scrollbuttonStats.leftscrbutton=!1,i.scrollbuttonStats.rightscrbutton=!1)},this.holdOnScrollbutton=function(){null!=i.foxitdoc&&(i.scrollbuttonStats.bottomscrbutton?i.foxitdoc.onScrollVbuttonBottom():i.scrollbuttonStats.topscrbutton?i.foxitdoc.onScrollVbuttonTop():i.scrollbuttonStats.leftscrbutton?i.foxitdoc.onScrollHbuttonLeft():i.scrollbuttonStats.rightscrbutton&&i.foxitdoc.onScrollHbuttonRight())},this.foxitpagescalecheck=function(e){null!=i.foxitdoc&&i.pages[i.currentpage].foxitpagescalecheck(e)},this.scalecomparepage=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.scalecomparepage(e)},this.scalecompare=function(){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.scalecompare()},this.setColors=function(e,t){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.setColors(e,t)},this.getColors=function(){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.getColors()},this.nudgeRotate=function(e){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.nudgeRotate(e)},this.nudgeScale=function(e){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.nudgeScale(e)},this.offsetdirect=function(e,t){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.offsetdirect(e,t)},this.nudgeoffset=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.nudgeoffset(e)},this.setcomparescale=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.setcomparescale(e)},this.checkRender=function(){null!=Ke&&Ke.renderComplete(i.fileindex)},this.setmarkupfilepaths=function(e){i.markupfileURLs.push(e)},this.getmarkupfilepaths=function(e){return i.markupfileURLs},this.setMarkup3DSavefile=function(e){i.markup3DSavepath=e},this.getMarkup3DSavefile=function(){return i.markup3DSavepath},this.setViews3DSavefile=function(e){i.views3DSavepath=e},this.getViews3DSavefile=function(){return i.views3DSavepath},this.ScrollBarCheck=function(){if(null!=i.foxitdoc){var e=ti,t=ai;e=ii,t=si;var a=i.foxitdoc.getScrollBarStatus();if(i.scrollbarwidth=i.foxitdoc.getScrollbarWidth(),i.foxitdoc.setmarkupPosition(i.currentpage),a.vBarOn?(e=ti-i.scrollbarwidth,e=ii-i.scrollbarwidth):e=ii,a.hBarOn?(t=ai-i.scrollbarwidth,t=si-i.scrollbarwidth):t=si,null!=i.foxitdoc){var s=i.foxitdoc.getPagePos(i.currentpage);null!=i.pages[i.currentpage]&&i.pages[i.currentpage].foxitonScrollupdate(s)}ou(e,t)}},this.mouseOnScroll=function(e){if(null!=i.foxitdoc&&null==i.foxitdoc){var t=ti,a=ai,s=ti-e.x,r=ai-e.y;i.scrollbuttonStats.bottomscrbutton=!1,i.scrollbuttonStats.topscrbutton=!1,i.scrollbuttonStats.leftscrbutton=!1,i.scrollbuttonStats.rightscrbutton=!1,i.foxitdoc.setScrollFactors(ti,ai);var n=i.foxitdoc.getScrollBarStatus(),o=i.foxitdoc.getScrollGrip(ti,ai);if(n.vBarOn)if(i.scrollbarwidth=i.foxitdoc.getScrollbarWidth(),t=ti-i.scrollbarwidth,s<i.scrollbarwidth&&s>0){o.posy,e.y;var l=e.y-o.posy;if(n.hBarOn)var c=2*i.scrollbarwidth;else c=i.scrollbarwidth;i.scrollbuttonStats.bottomscrbutton=r>0&&r<c,e.y>0&&e.y<i.scrollbarwidth?i.scrollbuttonStats.topscrbutton=!0:i.scrollbuttonStats.topscrbutton=!1,l<o.sizeV&&l>0?i.foxitdoc.onScollVGrip(!0):(l<0?i.scrollbuttonStats.topscrbutton||i.foxitdoc.onScrollVPageUp(ti,ai):l>0&&(i.scrollbuttonStats.bottomscrbutton||i.foxitdoc.onScrollVPageDown(ti,ai)),i.foxitdoc.onScollVGrip(!1)),i.foxitdoc.onScollV(!0)}else i.foxitdoc.onScollV(!1),i.foxitdoc.onScollVGrip(!1);if(n.hBarOn)if(i.scrollbarwidth=i.foxitdoc.getScrollbarWidth(),a=ai-i.scrollbarwidth,r<i.scrollbarwidth&&r>0){if(o.posx,e.x,l=e.x-o.posx,n.vBarOn)var h=2*i.scrollbarwidth;else h=i.scrollbarwidth;i.scrollbuttonStats.rightscrbutton=s>0&&s<h,e.x>0&&e.x<i.scrollbarwidth?i.scrollbuttonStats.leftscrbutton=!0:i.scrollbuttonStats.leftscrbutton=!1,l<o.sizeH&&l>0?i.foxitdoc.onScollHGrip(!0):(l<0?i.scrollbuttonStats.leftscrbutton||i.foxitdoc.onScrollHPageLeft(ti,ai):l>0&&(i.scrollbuttonStats.rightscrbutton||i.foxitdoc.onScrollHPageRight(ti,ai)),i.foxitdoc.onScollHGrip(!1)),i.foxitdoc.onScollH(!0)}else i.foxitdoc.onScollH(!1),i.foxitdoc.onScollHGrip(!1);return ou(t,a),n}},this.ScrollFoxitDiv=function(){null!=i.foxitdoc&&i.foxitdoc.scrolltoPageCorner()},this.updateURL=function(e){null!=e.getElementsByTagName("OriginalURL")[0]&&(i.OriginalURL=e.getElementsByTagName("OriginalURL")[0].firstChild.nodeValue,i.OriginalURL=decodeURIComponent(i.OriginalURL)),null!=e.getElementsByTagName("FileNameSRC")[0]&&(i.FileNameSRC=encodeURI(s+e.getElementsByTagName("FileNameSRC")[0].firstChild.nodeValue),i.CacheURL=zo(i.FileNameSRC))},this.setPassword=function(e){i.PDFPassword=e},this.setfileindex=function(e){i.fileindex=e,null!=i.foxitdoc&&(i.foxitdoc.rxindex=e)},this.setnummarkupfiles=function(e){r=e,o=!0},this.getnummarkupfiles=function(){return r},this.getmarkupfilesread=function(){return o},this.setmarkupfilesreceived=function(){l++},this.getmarkupfilesreceived=function(){return l},this.setFoxitAnnotlist=function(e){null!=i.foxitdoc&&(i.foxitannotations=e)},this.getFoxitAnnot=function(e){var t=void 0;return null!=i.foxitdoc&&(t=i.foxitannotations[e]),t},this.getmarkuplist=function(){return i.markuplist.filter((function(e){return!(8==e.type&&2==e.subtype)}))},this.foxitSearchTextRectEnd=function(){i.foxitsearchobjrect.matcharray=[],i.foxitsearchobjrect.pagedims=[],i.foxitsearchobjrect.expr="",i.foxitsearchobjrect.forward=!0,i.foxitsearchobjrect.casesens=!1,i.foxitsearchobjrect.active=!1,i.foxitsearchobjrect.outerindx=0,i.foxitsearchobjrect.innerindx=0,i.foxitsearchobjrect.page=0,null!=Ba&&Ba.numTextFound(i.foxitsearchobjrect,i.currentpage)},this.endMarkupTextSearch=function(){i.markupsearchobj.matcharray=[],i.markupsearchobj.expr="",i.markupsearchobj.forward=!0,i.markupsearchobj.casesens=!1,i.markupsearchobj.active=!1,i.markupsearchobj.indx=0,i.markupsearchobj.page=0,i.markupsearchobj.padding={x:50,y:50,w:50,h:100},null!=Na&&Na.numTextFound(i.markupsearchobj.matcharray.length)},this.textrectsearchend=function(){null==i.foxitdoc?(i.extractsearchobj.matcharray=[],i.extractsearchobj.expr="",i.extractsearchobj.forward=!0,i.extractsearchobj.casesens=!1,i.extractsearchobj.active=!1,i.extractsearchobj.indx=0,i.extractsearchobj.page=0,i.pages[i.currentpage].usepdfjs&&i.enableTextSelect(!1),i.pages[i.currentpage].usevectorxml&&i.enableTextSelect(!1),null!=Ba&&Ba.numTextFound(i.extractsearchobj,i.currentpage)):i.foxitSearchTextRectEnd()},this.textsearchend=function(){null==i.foxitdoc?(i.searchobj.active&&i.pages[i.currentpage].clearSearch(),i.searchobj.matcharray=[],i.searchobj.expr="",i.searchobj.forward=!0,i.searchobj.casesens=!1,i.searchobj.active=!1,i.searchobj.indx=0,i.searchobj.page=0,i.pages[i.currentpage].usepdfjs&&i.enableTextSelect(!1),i.pages[i.currentpage].usevectorxml&&i.enableTextSelect(!1),null!=Oa&&Oa.numTextFound(i.searchobj.matcharray.length)):i.foxitSearchTextEnd()},this.getsearchresultrect=function(e,t,a){for(var s=0;s<e.list.length;s++)e.list[s].match.pageIndex;if(i.foxitsearchobjrect.matcharray.push(e.list),e.hasMore&&a<i.pages.length)i.foxitdoc.getTextSearch(t,a+1,i.getsearchresultrect,i.foxitsearchobjrect.casesens);else{for(var r=0,n=0;n<i.foxitsearchobjrect.matcharray.length;n++)r+=i.foxitsearchobjrect.matcharray[n].length;r>0&&(i.foxitsearchobjrect.active=!0),i.foxitsearchobjrect.start(),null!=Ba&&Ba.numTextFound(i.foxitsearchobjrect,i.currentpage)}},this.drawselectedBlocks=function(){null!=i.pages[i.currentpage]&&i.pages[i.currentpage].usevectorxml&&(i.pages[i.currentpage].renderSelectedBlocks(),i.pages[i.currentpage].rendervectormouseover())},this.unselectallBlocks=function(){null!=i.pages[i.currentpage]&&i.pages[i.currentpage].usevectorxml&&i.pages[i.currentpage].unSelectAllBlockInserts()},this.drawsearchRect=function(){i.foxitsearchobj.wholedocument&&null!=i.pages[i.currentpage]&&i.pages[i.currentpage].drawsearchRects(i.foxitsearchobj.clonearray),i.foxitsearchobj.active&&null!=i.pages[i.currentpage]&&i.pages[i.currentpage].drawsearchRect()},this.getsearchresult=function(e,t,a){for(var s=0;s<e.list.length;s++)e.list[s].match.pageIndex;if(i.foxitsearchobj.matcharray.push(e.list),e.hasMore&&a<i.pages.length)i.foxitdoc.getTextSearch(t,a+1,i.getsearchresult,i.foxitsearchobj.casesens);else{for(var r=0,n=0;n<i.foxitsearchobj.matcharray.length;n++)r+=i.foxitsearchobj.matcharray[n].length;null!=Oa&&Oa.numTextFound(r),r>0&&(i.foxitsearchobj.active=!0,i.foxitsearchobj.start(),i.foxitsearchobj.page!=i.currentpage?(i.GotoPage(i.foxitsearchobj.page),i.pageSearchArr.push(i.foxitsearchobj.page)):i.pages[i.currentpage].showFoxitSearch())}},this.getpageloadSearch=function(e){for(var t=0;t<i.pageSearchArr.length;t++)i.pageSearchArr[t]==e&&(i.pages[e].showFoxitSearch(),i.pageSearchArr.splice(t,1))},this.foxitSearchTextEnd=function(){i.foxitsearchobj.active&&i.pages[i.currentpage].foxitClearSearch(),i.foxitsearchobj.matcharray=[],i.foxitsearchobj.forward=!0,i.foxitsearchobj.expr="",i.foxitsearchobj.casesens=!1,i.foxitsearchobj.active=!1,i.foxitsearchobj.outerindx=0,i.foxitsearchobj.innerindx=0,i.foxitsearchobj.page=0,null!=Oa&&Oa.numTextFound(i.searchobj.matcharray.length)},this.forcefoxitCanvas=function(){null!=i.foxitdoc&&i.foxitdoc.forceCanvas()},this.postscaleRefresh=function(){window.setTimeout((function(){i.forcefoxitRedraw()}),500)},this.forcefoxitRedraw=function(){null!=i.foxitdoc&&i.foxitdoc.forceRedraw()},this.markupSearchComplete=function(){null!=Na&&Na.numTextFound(i.markupsearchobj.matcharray.length),i.markupsearchobj.matcharray.length>0&&(i.markupsearchobj.active=!0,i.markupsearchobj.start(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx],i.markupsearchobj.padding))},this.searchComplete=function(){null!=Oa&&Oa.numTextFound(i.searchobj.matcharray.length),i.searchobj.matcharray.length>0&&(i.searchobj.active=!0,i.searchobj.start(),i.searchobj.page!=i.currentpage&&i.GotoPage(i.searchobj.page),i.pages[i.currentpage].showSearch())},this.searchCompleteRect=function(){if(i.extractsearchobj.matcharray.length>0){for(i.extractsearchobj.active=!0,i.extractsearchobj.start(),i.pages[i.currentpage].getSearchTextRect(),i.extractsearchobj.next();0!=i.extractsearchobj.indx;)i.pages[i.currentpage].getSearchTextRect(),i.extractsearchobj.next();null!=Ba&&Ba.numTextFound(i.extractsearchobj,i.currentpage)}},this.foxitSearchTextRect=function(e,t){i.foxitsearchobjrect.matcharray=[],i.foxitsearchobjrect.pagedims=[],i.foxitsearchobjrect.forward=!0,i.foxitsearchobjrect.expr=e,i.foxitsearchobjrect.casesens=t,i.foxitsearchobjrect.active=!1,i.foxitsearchobjrect.outerindx=0,i.foxitsearchobjrect.innerindx=0,i.foxitsearchobjrect.page=0,null!=i.foxitdoc&&i.foxitdoc.getTextSearch(e,0,i.getsearchresultrect,i.foxitsearchobjrect.casesens)},this.foxitSearchText=function(e,t,a){e==i.foxitsearchobj.expr&&i.foxitsearchobj.active?(t&&(i.pages[i.currentpage].foxitClearSearch(),i.foxitsearchobj.next(),i.foxitsearchobj.page!=i.currentpage?(i.GotoPage(i.foxitsearchobj.page),i.pageSearchArr.push(i.foxitsearchobj.page)):i.pages[i.currentpage].showFoxitSearch()),t||(i.pages[i.currentpage].foxitClearSearch(),i.foxitsearchobj.previous(),i.foxitsearchobj.page!=i.currentpage?(i.GotoPage(i.foxitsearchobj.page),i.pageSearchArr.push(i.foxitsearchobj.page)):i.pages[i.currentpage].showFoxitSearch())):(i.foxitsearchobj.active&&i.pages[i.currentpage].foxitClearSearch(),i.foxitsearchobj.matcharray=[],i.foxitsearchobj.forward=t,i.foxitsearchobj.expr=e,i.foxitsearchobj.casesens=a,i.foxitsearchobj.active=!1,i.foxitsearchobj.outerindx=0,i.foxitsearchobj.innerindx=0,i.foxitsearchobj.page=0,null!=i.foxitdoc&&i.foxitdoc.getTextSearch(e,0,i.getsearchresult,i.foxitsearchobj.casesens))},this.getTextRects=function(e,t){if(null==i.foxitdoc){if(i.extractsearchobj.active,i.extractsearchobj.matcharray=[],i.extractsearchobj.foundrects=[],i.extractsearchobj.expr=e,i.extractsearchobj.casesens=t,i.extractsearchobj.active=!1,i.extractsearchobj.indx=0,i.extractsearchobj.page=0,i.pages[i.currentpage].usevectorxml){i.textselect||i.enableTextSelect(!0);for(var a=0;a<i.pages.length;a++)null!=i.pages[a]&&i.pages[a].getVectorSearchListRect(i.extractsearchobj);i.searchCompleteRect()}}else i.foxitSearchTextRect(e,t)},this.clearDocumentTextSearch=function(){null!=i.foxitdoc&&(i.searchMatches={},i.foxitsearchobj.clonearray=[],i.foxitsearchobj.forward=!0,i.foxitsearchobj.expr="",i.foxitsearchobj.casesens=!1,i.foxitsearchobj.active=!1,i.foxitsearchobj.outerindx=0,i.foxitsearchobj.innerindx=0,i.foxitsearchobj.page=0,i.foxitsearchobj.wholeword="",i.foxitsearchobj.wholedocument=!1)},this.getSearchWholeDocument=function(e,t,a){let s=e.list;const r=i.foxitsearchobj.casesens,n=i.foxitsearchobj.wholeword;if(i.searchMatches[a]={text:t,pgindex:a,list:[]},s.forEach(e=>{const a=e.match.pageIndex;i.searchMatches[a]||(i.searchMatches[a]={text:t,pgindex:a,list:[]}),i.searchMatches[a].list.push(e)}),a<i.pages.length-1)i.foxitdoc.getTextSearch(t,a+1,i.getSearchWholeDocument,r,n);else{const e=Object.values(i.searchMatches);La.matchesFound(e),i.foxitsearchobj.active=!0,i.foxitsearchobj.wholedocument=!0,i.foxitsearchobj.matcharray=e,i.foxitsearchobj.clonearray=e.map(e=>e.list)}},this.documentTextSearch=function(e,t,a){null!=i.foxitdoc&&(i.foxitsearchobj.active&&i.pages[i.currentpage].foxitClearSearch(),i.searchMatches={},i.foxitsearchobj.forward=!0,i.foxitsearchobj.expr=e,i.foxitsearchobj.casesens=t,i.foxitsearchobj.active=!1,i.foxitsearchobj.outerindx=0,i.foxitsearchobj.innerindx=0,i.foxitsearchobj.page=0,i.foxitsearchobj.wholeword=a,i.foxitsearchobj.wholedocument=!0,null!=i.foxitdoc)&&i.foxitdoc.getTextSearch(e,0,i.getSearchWholeDocument,t,a)},this.markupTextWithOrange=function(e){if(null!=i.foxitdoc){i.foxitsearchobj.orangeItem=e;const r=i.pages[i.currentpage];var t=e.match.rectArray[0].left*(r.curpagescale*r.dscalepdf)+r.dxpdf,a=(r.pdfpageheight-e.match.rectArray[0].top)*(r.curpagescale*r.dscalepdf)+r.dypdf,s=r.getsearchpanupdate(t,a);r.pan_update(s.x,s.y)}},this.movePageTo=function(e,a){null!=i.foxitdoc&&i.foxitdoc.movePageTo(e,a).then(s=>{const r=this.findChangedIndices(e,a),n=t.getElementsByTagName("Page");r.forEach(e=>{if(e<i.thumbnails.length){const t=new bc(n[0],"Default",i,e);i.thumbnails[e]=t,i.foxitdoc.getThumbnail(e)}}),ht.setThumbnails(i.thumbnails),i.foxitsearchobj.clonearray!=[]&&(i.foxitsearchobj.clonearray=[],this.documentTextSearch(i.foxitsearchobj.expr,i.foxitsearchobj.casesens,i.foxitsearchobj.wholeword))})},this.removePage=function(e){null!=i.foxitdoc&&i.foxitdoc.removePage(e).then(()=>{const t=this.countItemsInRanges(e);i.pages.splice(i.pages.length-t,t),i.thumbnails=this.removeItemsByIndices(i.thumbnails,e),ht.setThumbnails(i.thumbnails),Va.countChanged(i.pages.length),i.foxitsearchobj.clonearray!=[]&&(i.foxitsearchobj.matcharray=this.removeItemsByIndices(i.foxitsearchobj.matcharray,e),this.refreshSearchResult())})},this.extractPage=function(e,t){null!=i.foxitdoc&&i.foxitdoc.extractPage(e).then(()=>{t&&this.removePage(e)})},this.refreshPages=function(){null!=i.foxitdoc&&(i.pages=i.pages.map((e,t)=>null!=e?{...e,PageName:"Page "+(t+1),firstpage:0===t,pagenumber:t,printobj:{...e.printobj,pagenumber:t}}:void 0))},this.refreshSearchResult=function(){i.foxitsearchobj.matcharray=i.foxitsearchobj.matcharray.map((e,t)=>{let a=[];return e&&e.list&&(a=e.list.map(e=>({match:{...e.match,pageIndex:t}}))),{text:i.foxitsearchobj.expr,pgindex:t,list:a}}),i.foxitsearchobj.clonearray=i.foxitsearchobj.matcharray.map(e=>e.list),La.matchesFound(i.foxitsearchobj.matcharray)},this.insertBlankPages=function(e,a,s,r){null!=i.foxitdoc&&i.foxitdoc.insertBlankPages(e,a,s,r).then(()=>{var s=t.getElementsByTagName("Page");const r=this.flattenRanges(e),n=this.countItemsInRanges(e);new Array(n).fill(0).forEach((e,t)=>{new Array(a).fill(0).forEach(()=>{console.log(r[t]);const e=new Sc(s[0],"Default",!1,"",r[t],i);hn.addpage(e,!1)})}),this.refreshThumbnails(),this.refreshPages(),i.pages.forEach((e,t)=>{i.foxitdoc.getThumbnail(t)}),i.foxitsearchobj.clonearray!=[]&&(i.foxitsearchobj.clonearray=[],this.documentTextSearch(i.foxitsearchobj.expr,i.foxitsearchobj.casesens,i.foxitsearchobj.wholeword))})},this.importPages=function(e,a,s,r,n,o,l){return null!=i.foxitdoc?i.foxitdoc.importPages(e,a,s,r,n,o,l).then(()=>{var e=t.getElementsByTagName("Page");if(r){const e=this.countItemsInRanges(a);i.pages.splice(i.pages.length-e,e)}return new Array(n).fill(0).forEach((t,s)=>{const r=new Sc(e[0],"Default",!1,"",a[0][0]+s,i);hn.addpage(r,!1)}),this.refreshThumbnails(),this.refreshPages(),i.pages.forEach((e,t)=>{i.foxitdoc.getThumbnail(t)}),i.foxitsearchobj.clonearray!=[]&&(i.foxitsearchobj.clonearray=[],this.documentTextSearch(i.foxitsearchobj.expr,i.foxitsearchobj.casesens,i.foxitsearchobj.wholeword)),Va.countChanged(i.pages.length),Promise.resolve()}):Promise.reject()},this.copyPage=function(e){null!=i.foxitdoc&&i.foxitdoc.copyPage(e).then(e=>{z=e})},this.getAllThumbnailsFromFile=function(e){if(null!=i.foxitdoc)return i.foxitdoc.getAllThumbnailsFromFile(e)},this.uploadPDFCustom=function(e){null!=i.foxitdoc&&i.foxitdoc.exportPDFupload(!0,e)},this.uploadPDF=function(){null!=i.foxitdoc&&i.foxitdoc.exportPDFupload(!1,void 0)},this.exportPDF=function(){null!=i.foxitdoc&&i.foxitdoc.exportPDF1()},this.pastePage=function(e){null!=i.foxitdoc&&null!=z&&i.foxitdoc.pastePage(G,e,z).then(()=>{var a=t.getElementsByTagName("Page");const s=this.countItemsInRanges(G);new Array(s).fill(0).forEach((t,s)=>{const r=new Sc(a[0],"Default",!1,"",e+s,i);i.addpage(r,!1),i.thumbnails.splice(e,0,i.thumbnails[0])}),this.refreshThumbnails(),this.refreshPages(),i.pages.forEach((e,t)=>{i.foxitdoc.getThumbnail(t)}),Va.countChanged(i.pages.length),i.foxitsearchobj.clonearray!=[]&&(i.foxitsearchobj.clonearray=[],this.documentTextSearch(i.foxitsearchobj.expr,i.foxitsearchobj.casesens,i.foxitsearchobj.wholeword)),z=null})},this.removeItemsByIndices=function(e,t){const a=w(t);return e.filter((e,t)=>!a.has(t))},this.itemsInRange=function(e,t){const a=w(t);return e.filter((e,t)=>a.has(t))},this.countItemsInRanges=function(e){return e.reduce((e,t)=>e+(1===t.length?1:t[1]-t[0]+1),0)},this.flattenRanges=function(e){let t=[];return e.forEach(e=>{if(2===e.length)for(let a=e[0];a<=e[1];a++)t.push(a);else t.push(e[0])}),t},this.findChangedIndices=function(e,t){let a=[];const i=this.countItemsInRanges(e);if(e[0][0]<=t)for(let s=e[0][0];s<t+i;s++)a.push(s);else for(let s=t;s<e[0][0]+i;s++)a.push(s);return a},this.textsearch=function(e,t,a){if(null==i.foxitdoc)if(e==i.searchobj.expr&&i.searchobj.active)t&&(i.pages[i.currentpage].clearSearch(),i.searchobj.next(),i.searchobj.page!=i.currentpage&&i.GotoPage(i.searchobj.page),i.pages[i.currentpage].showSearch()),t||(i.pages[i.currentpage].clearSearch(),i.searchobj.previous(),i.searchobj.page!=i.currentpage&&i.GotoPage(i.searchobj.page),i.pages[i.currentpage].showSearch());else{if(i.searchobj.active&&i.pages[i.currentpage].clearSearch(),i.searchobj.matcharray=[],i.searchobj.expr=e,i.searchobj.forward=t,i.searchobj.casesens=a,i.searchobj.active=!1,i.searchobj.indx=0,i.searchobj.page=0,i.pages[i.currentpage].usepdfjs){i.textselect||i.enableTextSelect(!0);for(var s=0;s<i.pages.length;s++)i.pages[s].getPDFSearchList();null!=Oa&&Oa.numTextFound(i.searchobj.matcharray.length)}if(i.pages[i.currentpage].usevectorxml){i.textselect||i.enableTextSelect(!0);for(var r=0;r<i.pages.length;r++)null!=i.pages[r]&&i.pages[r].getVectorSearchList();i.searchComplete()}}else i.foxitSearchText(e,t,a)},this.ZoomToMarkup=function(e){Ol(e)||i.GotoPage(e.pagenumber),i.pages[i.currentpage].zoomToMarkup(e)},this.panToMarkup=function(e){Ol(e)||i.GotoPage(e.pagenumber),i.pages[i.currentpage].panToMarkup(e)},this.markupTextSearch=function(e,t,a,s){if(e==i.markupsearchobj.expr&&i.markupsearchobj.active)t&&(i.markupsearchobj.next(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx],i.markupsearchobj.padding)),t||(i.markupsearchobj.previous(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx],i.markupsearchobj.padding));else if(i.markupsearchobj.matcharray=[],i.markupsearchobj.expr=e,i.markupsearchobj.forward=t,i.markupsearchobj.casesens=a,i.markupsearchobj.active=!1,i.markupsearchobj.indx=0,i.markupsearchobj.page=0,s&&(i.markupsearchobj.padding=s),""!=i.markupsearchobj.expr){for(var r=0;r<i.markuplist.length;r++)i.markuplist[r].FindText(i.markupsearchobj.expr,i.markupsearchobj.casesens)&&i.markupsearchobj.matcharray.push(i.markuplist[r]);i.markupSearchComplete()}},this.getcurpageScale=function(e){return i.currentpage,(i.usepagesload?i.pages[i.pages[e].pagenumber]:i.pages[e]).curpagescale},this.getcur3DView=function(){var e=null;return null!=i.pages[i.currentpage]&&(e=i.pages[i.currentpage].getcur3DView()),e},this.getcurPage=function(){return i.currentpage,i.usepagesload?i.pages[i.currentpage].pagenumber:i.currentpage},this.setDocumentPageScale=function(e,t,a){i.PDFpagescale.width=e,i.PDFpagescale.height=t,i.PDFpagescale.scale=a},this.getAllPageDim=function(){for(var e=[],t=0;t<i.pages.length;t++)null!=i.pages[t]&&e.push(i.pages[t].getpagedim());return e},this.getPageDim=function(e){var t=i.getPageObject(e);if(null!=t)var a=t.getpagedim();else a=void 0;return a},this.setPageDim=function(e,t,a,s,r){var n=i.getPageObject(e);null!=n&&n.setpagedim(t,a,s,r)},this.getFirstLoadedPage=function(){return i.pages[0]},this.getPageObjectLoad=function(e){var t=void 0;if(i.usepagesload)for(var a=0;a<i.pages.length;a++)null!=i.pages[a]&&i.pages[a].pagenumber==e&&(t=i.pages[a]);else t=i.pages[e];return null==t&&null!=i.tempPage&&(i.tempPage.movepage(e),t=i.tempPage),t},this.getPageObject=function(e){var t=void 0;if(i.usepagesload)for(var a=0;a<i.pages.length;a++)null!=i.pages[a]&&i.pages[a].pagenumber==e&&(t=i.pages[a]);else t=i.pages[e];return t},this.addProperties=function(e){if("Adobe PDF"==i.Format.substring(0,9))for(var t in e.info)"function"!=typeof e.info[t]&&i.documentproperties.push({name:t,value:e.info[t]})},this.inpagerange=function(e){var t=i.pagerange();return e>t.start&&e<t.end},this.loadPageEvt=function(e){null!=i.pages[i.currentpage]&&i.pages[i.currentpage].pagenumber},this.pgChangeLoop=function(){for(var e={pagenum:0,pagerange:i.pagerange(),bpageshort:!1},t=i.isNotCollapsed||[],a=e.pagerange.start;a<=e.pagerange.end;a++)-1==t.indexOf(a)&&t.push(a);for(var s=0;s<t.length;s++)e.pagenum=t[s]},this.pagerangearray=function(){var e=this.currentpage,t=i.largePDFPagerange/2,a=i.endpagerange-i.pagerangelimit,s=i.startpagerange+i.pagerangelimit;i.bLargePDF?e<=t?(i.startpagerange=0,i.endpagerange=i.largePDFPagerange):e>=i.pages.length-t?(i.startpagerange=i.pages.length-i.largePDFPagerange,i.endpagerange=i.pages.length):e==a?(i.startpagerange=a-t,i.endpagerange=a+t):e==s?(i.startpagerange=s-t,i.endpagerange=s+t):(e>i.endpagerange||e<i.startpagerange)&&(i.startpagerange=e-t,i.endpagerange=e+t):(i.startpagerange=0,i.endpagerange=i.pages.length);for(var r=[i.currentpage],n=1;n<t;n++)r.push(i.currentpage+n),i.currentpage-n>=0&&r.push(i.currentpage-n);return r},this.pagerange=function(){var e=this.currentpage,t=i.largePDFPagerange/2,a=i.endpagerange-i.pagerangelimit,s=i.startpagerange+i.pagerangelimit;return i.bLargePDF?e<=t?(i.startpagerange=0,i.endpagerange=i.largePDFPagerange):e>=i.pages.length-t?(i.startpagerange=i.pages.length-i.largePDFPagerange,i.endpagerange=i.pages.length):e==a?(i.startpagerange=a-t,i.endpagerange=a+t):e==s?(i.startpagerange=s-t,i.endpagerange=s+t):(e>i.endpagerange||e<i.startpagerange)&&(i.startpagerange=e-t,i.endpagerange=e+t):(i.startpagerange=0,i.endpagerange=i.pages.length),{start:i.startpagerange,end:i.endpagerange,nextstart:i.endpagerange+1,nextend:i.endpagerange+i.largePDFPagerange+1}},this.pagelock=function(e){i.pagelocked=e,i.lockedpage=i.currentpage},this.mpzoom=function(e,t,a){i.pagelocked},this.zoom_update=function(e,t,a,s){i.pagelocked},this.zoomall=function(){i.pagelocked},this.pan_position=function(e,t){i.pagelocked||(0==this.currentpage||i.currentpage,i.currentpage==i.pages.length-1?i.pages.length:this.currentpage)},this.pan_update=function(e,t){i.pagelocked||(0==this.currentpage||this.currentpage,this.currentpage==this.pages.length-1?this.pages.length:this.currentpage)},this.ZoomIn=function(e,t){},this.zoomheight=function(){i.pagelocked},this.zoomwidth=function(){i.pagelocked},this.ZoomOut=function(e,t){i.pagelocked},this.recalcPages=function(e,t,a){if(!i.pagelocked){null!=i.pages[i.currentpage]&&(i.pages[i.currentpage].dscalepdf,i.pages[i.currentpage].dxpdf,i.pages[i.currentpage].dypdf);for(var s=0;s<this.pages.length;s++)s!=i.currentpage&&null!=i.pages[s]&&(i.pages[s].dscalepdf=t?i.pages[s].dscalepdf*e:i.pages[s].dscalepdf/e,i.pages[s].dxpdf=i.pages[s].dxpdf-a,i.pages[s].pdfisrendered=!1)}},this.turnPDFLayerOnOff=function(e,t){null!=i.foxitdoc&&(i.foxitdoc.setLayerState(e,t),i.postscaleRefresh())},this.get_bookmark_pageref=function(e){for(var t=null,a=e[0],s=0;s<i.pages.length;s++)null!=i.pages[s]&&Tn(a,i.pages[s].getpageRef())&&(t=i.pages[s].pagenumber);return t},this.getPDF_PageRef=function(e,t){i.pdfDoc.getPageIndex(e).then((function(a){var s=e.num+" "+e.gen+" R";i._pagesRefCache[s]=a,null!=xa&&xa.setPageRef(i._pagesRefCache),t&&null!=xa&&xa.setPDFBookmarks(i.pdfoutline)}))},this.getPDFDocument=function(){return i.pdfDoc},this.navigateBookmark=function(e){e.page!=i.currentpage&&i.GotoPage(e.page),null!=i.pages[i.currentpage]&&i.pages[i.currentpage].showBookmark(e)},this.getPDFBookmarks=function(){null!=i.foxitdoc&&i.foxitdoc.getBookmarks()},this.setPDFBookmarks=function(e){e?e.length>0&&null!=xa&&xa.setPDFBookmarks(e):null!=xa&&xa.setPDFBookmarks([])},this.setPDFLayers=function(e){e&&null!=yt&&yt.setVectorLayers(e)},this.rxfoxitpagedim=function(e,t){null!=i.foxitdoc&&i.foxitdoc.pagedimcompare(e,t)},this.createTempcanvArray=function(e){i.fileindex==e.docindex&&i.pages[e.pageindex]&&i.pages[e.pageindex].createTempcanvArray(e)},this.foxitonScrollupdate=function(e,t){i.pages[t]&&i.pages[t].foxitonScrollupdate(e)},this.foxitcalibratepagemarkupEx=function(e,t,a){null!=i.foxitdoc&&i.pages[a]&&i.pages[a].foxitcalibratepagemarkupEx(e,t)},this.foxitcalibratepagemarkup=function(e,t){null!=i.foxitdoc&&i.pages[t]&&i.pages[t].foxitcalibratepagemarkup(e)},this.foxitcalibratepagePosX=function(e,t){null!=i.foxitdoc&&i.pages[e]},this.foxitcalibratepagePosY=function(e){null!=i.foxitdoc&&i.pages[e]&&i.pages[e].foxitcalibratepagePosY()},this.setfoxitPageSize=function(e){null!=i.foxitdoc&&i.fileindex==e.docindex&&i.pages[e.pageindex]&&i.pages[e.pageindex].setfoxitPageSize(e)},this.setfoxitPageSizeEx=function(e){null!=i.foxitdoc&&i.fileindex==e.docindex&&i.pages[e.pageindex]&&i.pages[e.pageindex].setfoxitPageSizeEx(e)},this.createPageTileArray=function(e){i.fileindex==e.docindex&&i.pages[e.pageindex]&&i.pages[e.pageindex].createCanvasTiles(e)},this.getpageinfodim=function(e){null!=i.pages[e]&&null!=i.foxitdoc&&i.foxitdoc.getpageinfodim(e,i.pages[e].setfoxitPageSizeNonRender)},this.setLargePDF=function(e){if(e>ks){i.bLargePDF=!0;for(var t=0;t<i.pages.length;t++)null!=i.pages[t]&&null!=i.foxitdoc&&i.foxitdoc.getpageinfodim(t,i.pages[t].setfoxitPageSizeNonRender)}i.bLargePDF=!1},this.loadPDFpages=function(){if(i.pages.length>ks){Ii&&(console.log("page load terminated",e),Ii=!1),i.bLargePDF=!0;for(var e=0;e<i.pages.length;e++)if(Ii){console.log("page load terminated",e),Ii=!1;break}}else for(Ii&&(console.log("page load terminated",e),Ii=!1),e=0;e<i.pages.length;e++)if(Ii){console.log("page load terminated",e),Ii=!1;break}i.bLargePDF=!1,i.SetActive()},this.setPDFdocument=function(e,t){i.busesetpdfdoc=!0,i.pdfDoc=e,t&&i.loadPDFpages()},this.getThumb=function(e){for(var t=void 0,a=0;a<i.thumbnails.length;a++)i.thumbnails[a].pagenumber==e&&(t=i.thumbnails[a]);return t},this.loadThumbnailPDF=function(e){i.pages[0].usevector3Dbinary||i.pages[0].usevector3DGLTF||null!=i.foxitdoc&&i.foxitdoc.getThumbnail(e)},this.loadThumbnail=function(e){i.pages[0].usevector3Dbinary||i.pages[0].usevector3DGLTF||(null!=i.foxitdoc?i.foxitdoc.getThumbnail(e):i.pages[0].usevectorxml?(90==i.thumbnails[e].thumbnailobj.rotation||270==i.thumbnails[e].thumbnailobj.rotation?(i.thumbnails[e].thumbcanvas.width=parseInt(i.thumbnails[e].ThumbnailHeight),i.thumbnails[e].thumbcanvas.height=parseInt(i.thumbnails[e].ThumbnailWidth)):(i.thumbnails[e].thumbcanvas.width=parseInt(i.thumbnails[e].ThumbnailWidth),i.thumbnails[e].thumbcanvas.height=parseInt(i.thumbnails[e].ThumbnailHeight)),null!=i.thumbnails[e].renderVector&&i.thumbnails[e].renderVector(1)):(90==i.thumbnails[e].thumbnailobj.rotation||270==i.thumbnails[e].thumbnailobj.rotation?(i.thumbnails[e].thumbcanvas.width=parseInt(i.thumbnails[e].ThumbnailHeight),i.thumbnails[e].thumbcanvas.height=parseInt(i.thumbnails[e].ThumbnailWidth)):(i.thumbnails[e].thumbcanvas.width=parseInt(i.thumbnails[e].ThumbnailWidth),i.thumbnails[e].thumbcanvas.height=parseInt(i.thumbnails[e].ThumbnailHeight)),null!=i.thumbnails[e].renderImage&&i.thumbnails[e].renderImage(1)))},this.getfoxitThumbnail=function(e){null!=i.foxitdoc&&i.foxitdoc.getThumbnail(e)},this.getFoxitThumbnails=function(){null!=i.foxitdoc&&i.foxitdoc.getThumbnails()},this.refreshThumbnails=function(){if(null!=i.foxitdoc){const e=t.getElementsByTagName("Page")[0];i.thumbnails=[],new Array(i.pages.length).fill(0).forEach((t,a)=>{const s=new bc(e,"Default",i,a);i.thumbnails.push(s)})}null!=ht&&ht.setThumbnails(i.thumbnails)},this.onFoxitRotateDocument=function(e){i.documentrotation=e;for(var t=0;t<i.pages.length;t++)null!=Fa&&Fa.onRotate(e,t)},this.rotateDocument=function(e){null!=i.foxitdoc&&i.foxitdoc.rotateDocument(e,this.onFoxitRotateDocument)},this.rotateThumbnail=function(e,t){var a=i.getThumb(e);null!=a&&(a.thumbnailobj.rotation=t)},this.setthumbnail=function(e,t,a){var s=i.getThumb(a);if(null!=s){var r=s.thumbnailobj.thumbnail.height/t,n=s.thumbnailobj.thumbnail.width/e,o=Math.min(n,r);s.setthumbnail(0,0,o),null!=i.pages[0]&&i.pages[0].usepdfjs&&i.thumbnails[a].setPDFdim(e,t)}},this.addthumbnail=function(e){i.thumbnails.push(e)},this.setBirdseyeTool=function(){var e=i.getThumb(i.currentpage);null!=e&&e.setBirdseyeTool()},this.refreshBirdsEye=function(){var e=i.getThumb(i.currentpage);null!=e&&e.refreshbirdseye()},this.draw3DNav=function(){var e=i.getThumb(i.currentpage);null!=e&&null!=i.pages[i.currentpage]&&(i.pages[0].usevector3DGLTF?(i.pages[i.currentpage].Vector3DPageObj.checkcurfloor(),e.drawcamerapos()):i.pages[i.currentpage].bis3Dnavigator&&e.drawcamerapos())},this.setpagecamerapos=function(e,t,a){i.pages[i.currentpage].bis3Dnavigator&&i.pages[i.currentpage].setcamerapos(e,t,a)},this.getBoxcenter=function(){return i.pages[0].usevector3DGLTF?i.pages[i.currentpage].Vector3DPageObj.boxCenter:null},this.setthumbcamdirfunction=function(){var e=i.getThumb(i.currentpage);null!=e&&i.pages[0].usevector3DGLTF&&e.connectCampos(i.pages[i.currentpage].Vector3DPageObj)},this.setthumcamerapos=function(e,t){var a=i.getThumb(i.currentpage);null!=a&&i.pages[0].usevector3DGLTF&&a.setcamerapos(e,t,i.pages[i.currentpage].Vector3DPageObj.boxCenter)},this.setFloorNavScaleOffset=function(e,t){var a=i.getThumb(i.currentpage);null!=a&&i.pages[0].usevector3DGLTF&&a.setFloorNavScaleOffset(e,t)},this.setfloorplanNav=function(e,t){i.pages[0].usevector3DGLTF&&i.pages[0].replacefloorplan(e,t)},this.getFloorplans=function(){return i.pages[0].getFloorplans()},this.create3DFloorplan=function(e,t,a){i.pages[0].usevector3DGLTF&&i.pages[0].Vector3DPageObj.addfloorplanTexture(e,t,a)},this.get3DNavElevationPages=function(e){for(var t=[],a=0;a<i.pages.length;a++)i.pages[a].bis3Dnavigator&&i.pages[a].get3DNavElevation(e)&&t.push({index:a,replaced:i.pages[a].navfloorplan.replaced});return t},this.replaceFloorNav=function(e,t){i.pages[0].usevector3Dbinary||(i.pages[0].usevector3DGLTF||(i.thumbnails[i.currentpage].removereplacefloornavCallback(),i.thumbnails[i.currentpage].setreplacefloornavCallback(e,t)),i.refreshBirdsEye(),i.pages[0].usevectorxml?(i.thumbnails[i.currentpage],i.thumbnails[i.currentpage].renderVector(4)):i.pages[0].usepdfjs||i.pages[0].usevector3DGLTF||i.thumbnails[i.currentpage].renderImage(4))},this.renderFloorplan=function(e,t,a){if(!i.pages[0].usevector3Dbinary){var s=i.getThumb(i.currentpage);null!=s&&(s.removefloorplanCallback(),s.setfloorplanCallback(e,t,a),i.pages[0].usevectorxml?s.renderVector(3):i.pages[0].usepdfjs?null!=i.foxitdoc&&i.foxitdoc.getBirdsEye(i.currentpage):s.renderImage(3))}},this.setbirdseyefloor=function(e){var t=i.getThumb(i.currentpage);null!=t&&i.pages[0].usevector3DGLTF&&t.setBirdseyeFloor(e)},this.renderBirdsEye=function(){if(!i.pages[0].usevector3Dbinary){var e=i.getThumb(i.currentpage);null!=e&&(i.pages[0].usevector3DGLTF?e.set3DNavImage(2,!1):i.pages[0].usevectorxml?e.renderVector(2):i.pages[0].usepdfjs?null!=i.foxitdoc&&(e.birdseyedrawn||i.foxitdoc.getBirdsEye(i.currentpage,i.pages[i.currentpage].getpageRotation())):e.renderImage(2),null!=i.pages[i.currentpage]&&i.pages[i.currentpage].pan_update(0,0))}},this.removepage=function(e){for(var t=-1,a=0;a<i.pages.length;a++)i.pages[a].pagenumber==e.pagenumber&&(t=a);t>-1&&i.pages.splice(t,1),0==i.pages.length?(gi=!0,$d(i.fileindex)):i.GotoPage(i.prevpage)},this.createPages=function(e,t){var a,s,r=0,n=0,o="Adobe PDF"==i.Format.substring(0,9);if(null!=i.OriginalURL)var l=Wo(i.OriginalURL);for(s=0;s<e.length;s++){var c=e[s].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;i.addlayout(c);var h=e[s].getElementsByTagName("Page");for(n=0;n<h.length;n++)if(0==n&&0==s){a=o?new Pc(h[n],c,!0,l,n,i):new Sc(h[n],c,!0,l,n,i);var d=h[n],p=c;i.addthumbnail(new bc(h[n],c,i,n)),i.addpage(a,!0)}else i.addthumbnail(new bc(h[n],c,i,n+r)),a=o?new Pc(h[n],c,!1,"",n+r,i):new Sc(h[n],c,!1,"",n+r,i),i.addpage(a,!1);r+=n}md()&&(o&&d&&p&&(i.tempPage=new Pc(d,p,!1,"",0,i)),i.FileName=t)},this.addpage=function(e,t){if(null!=e){if(e.DocRef=i,i.pages.push(e),i.pagerotations.push(0),i.pages.length,t)if(e.usevector3Dbinary)e.loadvectors3DBinary();else if(e.usevector3DGLTF)e.vector3DGltfload(),e.loadfloorplan();else if(e.usevector3Dxml);else if(e.usevectorbinary)nu(!1),i.bRenderinProgress=!0,e.loadbinvectors();else if(e.usevectorbinarycompare)nu(!1),i.bRenderinProgress=!0,e.loadcomparevectors();else if(e.usevectorxml&&null!=e.VectorPageObj)nu(!1),i.bRenderinProgress=!0,e.loadbinvectors(),0!=e.VectorPageObj.height&&0!=e.VectorPageObj.width||i.pages.pop();else if(e.usepdfjs){nu(!1),i.backgroundColor="#FFFFFF";var a=_o(i.FileName);if(i.FileLocal)var s=zo(e.ThumbnailImageSRC);else s=zo(i.FileNameSRC);null!=i.relativepath&&(s=i.relativepath);var r=RxConfig.noCachFolder;i.pdfURL=r?RxConfig.xmlurlrel+i.FileNameSRC:s+a,e.firstpage&&(""!=s&&(this.foxitdoc=foxitGetDoc(),null!=this.foxitdoc&&(Vd(!1),this.foxitdoc.openPDFURL(i.pdfURL,i.openFileName),this.foxitdoc.rxindex=this.fileindex,addfoxitdoc()),i.bdestroyPDFonClose=!0),i.loadPDFpages())}else 0==i.Type&&(e.initialzoom=2),i.backgroundColor="#FFFFFF",nu(!0),e.loadimages(i.pageNum);e.usevectorbinary&&(e.usevectorxml=!0),e.usevectorbinarycompare&&(e.usevectorxml=!0),e.usevector3Dbinary&&(e.usevector3Dxml=!0),e.usevector3DGLTF&&(e.usevector3Dxml=!0)}else i.pages.push(e),i.pagerotations.push(0),i.pages.length},this.addlayout=function(e){i.layouts.push(e)},this.setmovepagesthird=function(e,t,a){e.push({from:t.midpage,to:a});for(var i=a+1,s=0;s<t.last.length;s++)e.push({from:t.last[s],to:i+s});i=a-t.first.length;for(var r=0;r<t.first.length;r++)e.push({from:t.first[r],to:i+r});return e},this.setmovepages=function(e,t,a,s){var r=i.pages.length<=60;if(s){var n=a;if(r){for(var o=t.positions.slice(),l=[];o.length>0&&n<i.pages.length;)(g=o.shift())!=n?e.push({from:g,to:n}):l.unshift(g),n++;if(a-o[o.length-1]>1){var c=a-o[o.length-1]-1,h=0;for(n=e[0].to-c;h<c;)(g=o.shift())!=n&&e.push({from:g,to:n}),n++,h++}}else{e.push({from:t.midpage,to:a});for(var d=a+1,p=0;p<t.last.length;p++)e.push({from:t.last[p],to:d+p});d=a-t.first.length;for(var u=0;u<t.first.length;u++)e.push({from:t.first[u],to:d+u})}}else if(n=a,r){for(o=t.positions.slice(),l=[];o.length>0&&n<i.pages.length;)(g=o.shift())!=n?e.push({from:g,to:n}):l.unshift(g),n++;if(a-o[o.length-1]>1)for(c=a-o[o.length-1]-1,h=0,n=e[0].to-c;h<c;){var g;(g=o.shift())!=n&&e.push({from:g,to:n}),n++,h++}}else{for(d=a-t.first.length,u=0;u<t.first.length;u++)e.push({from:t.first[u],to:d+u});for(e.push({from:t.midpage,to:a}),d=a+1,p=0;p<t.last.length;p++)e.push({from:t.last[p],to:d+p})}return e},this.getTargetPositions=function(e,t){for(var a=!1,s=!1,r=!1,n=0,o=[],l=i.pages.length-1,c=0;c<t.positions.length;c++)e==t.positions[c]&&(a=!0);if((n=Math.abs(e-t.midpage))>29&&(n=29),e-t.midpage<0?(s=!0,r=!1):(r=!0,s=!1),a)for(var h=0;h<n;h++){var d=h+1;r?t.positions[t.positions.length-1]+d<=l&&o.push({from:t.positions[0]+h,to:t.positions[t.positions.length-1]+d}):s&&t.positions[0]-d>=1&&o.push({from:t.positions[t.positions.length-1]-h,to:t.positions[0]-d})}else if(e>=Ds&&e<=i.pages.length-Ds){var p=e+1;o=i.setmovepages(o,t,e,r)}else if(e<Ds){p=1;for(var u=0;u<t.positions.length;u++)o.push({from:t.positions[u],to:p+u})}else if(e>i.pages.length-Ds){if(e>=i.pages.length-t.last.length)var g=i.pages.length-1-t.last.length;else g=e;o=i.pages.length<=60?i.setmovepages(o,t,e,r):i.setmovepages(o,t,g,r)}return g=1,{within:a,toend:r,tofront:s,pagestomove:n,fromto:o}},this.getpagePositions=function(e){for(var t=[],a=1;a<i.pages.length;)null!=i.pages[a]&&t.push(a),a++;for(var s=Math.floor(t.length/2),r=[],n=[],o=0;o<t.length;o++)o<s?r.push(t[o]):o>s&&n.push(t[o]);return{positions:t,midpage:t[s],first:r,last:n}},this.checkpageposnumbers=function(){for(var e=0;e<i.pages.length;e++)null!=i.pages[e]&&e!=i.pages[e].pagenumber&&i.pages[e].movepage(e)},this.movepage=function(e,t,a){var i=e[a];e[a]=e[t],e[t]=i,null!=e[t]&&e[t].movepage(t)},this.oldmovepage=function(e,t,a){if(t>=e.length)for(var i=t-e.length+1;i--;)e.push(void 0);return e.splice(t,0,e.splice(a,1)[0]),e},this.movePageObjects=function(e){if(i.bLargePDF){var t=i.getpagePositions(e);if(!(1==t.positions[0]&&e<t.midpage||t.positions[28]==i.pages.length-1&&e>t.midpage)){if(0!=t.positions.length)var a=i.getTargetPositions(e,t);if(a.within)for(var s=0;s<a.fromto.length;s++)i.movepage(this.pages,a.fromto[s].to,a.fromto[s].from);else{for(s=0;s<a.fromto.length;s++)i.movepage(this.pages,a.fromto[s].to,a.fromto[s].from);i.checkpageposnumbers()}}}},this.loadpage=function(e){if(i.pages[i.currentpage].usevectorxml||i.pages[i.currentpage].usevectorbinary)if(i.pages[i.currentpage].vectorloaded){if(null!=this.pages[this.currentpage].VectorPageObj){if(0==i.pages[i.currentpage].VectorPageObj.width||0==i.pages[i.currentpage].VectorPageObj.height)return;i.pages[i.currentpage].draw_vector(!0)}}else i.pages[i.currentpage].loadbinvectors();else 0!=e&&(i.pages[i.currentpage].usepdfjs?i.bLargePDF:i.pages[e].largeimageloaded&&i.pages[e].smallimageloaded||(0==i.Type&&(i.pages[e].initialzoom=2),i.pages[e].loadimages()))},this.getpageThumb=function(e){return i.getThumb(e)},this.getCurrentThumb=function(){return i.getThumb(i.currentpage)},this.getHoverSpace=function(){return i.hoverspace},this.addHoverSpace=function(e){null==i.hoverspace&&(i.hoverspace=e)},this.clearHoverSpace=function(){i.hoverspace=null},this.drawHoverSpace=function(e){if(null!=i.hoverspace){var t=i.getCurrentpage().dscalevector,a=i.getCurrentpage().dxvector,s=i.getCurrentpage().dyvector,r=i.getCurrentpage().VectorPageObj.x,n=(i.getCurrentpage().VectorPageObj.y,i.getCurrentpage().VectorPageObj.h),o=(i.hoverspace.path[0].x-r)*t,l=(n-i.hoverspace.path[0].y)*t;o+=a,l+=s,e.save(),e.lineWidth=0,e.fillStyle=i.hoverspace.color,e.beginPath(),e.moveTo(o,l);for(var c=1;c<i.hoverspace.path.length;c++)o=(i.hoverspace.path[c].x-r)*t,l=(n-i.hoverspace.path[c].y)*t,o+=a,l+=s,e.lineTo(o,l);e.closePath(),e.fill(),e.restore()}},this.setPageBitmap=function(e,t){null!=i.pages[t]&&i.pages[t].setPageBitmap(e)},this.visiblepage=function(e){return null!=i.pages[e]&&i.pages[e].ispagevisible()},this.getCurrentpage=function(){return null==i.pages[i.currentpage]?i.pages[0]:i.pages[i.currentpage]},this.setCurrentpage=function(e){var t="Adobe PDF"==i.Format.substring(0,9);i.pages.length>Ds&&t?(i.movePageObjects(e),i.foxitdoc):t&&i.foxitdoc,i.currentpage=e,i.pages[i.currentpage].visible=!0,Gs&&(-1!=i.selectedmarkup.id&&null!=i.markuplist[i.selectedmarkup.id]&&(i.markuplist[i.selectedmarkup.id].setselectedit(!1),i.markuplist[i.selectedmarkup.id].setselect(!1)),Vl(n),Nl(a))},this.PageDown=function(){var e=this.currentpage;if(i.pages[i.currentpage].usepdfjs&&i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display="none"),this.currentpage+1<=this.pages.length-1){if(i.setCurrentpage(this.currentpage+1),i.pages[i.currentpage].usevector3Dxml)null==i.pages[i.currentpage].Vector3DPageObj?(i.pages[i.currentpage].usevector3Dbinary&&i.pages[i.currentpage].loadvectors3DBinary(),i.pages[i.currentpage].usevector3DGLTF&&i.pages[i.currentpage].vector3DGltfload()):(i.restorecurpage=i.currentpage,i.SetActive());else if(i.pages[i.currentpage].usevectorxml||i.pages[i.currentpage].usevectorbinary)if(i.pages[i.currentpage].vectorloaded){if(0==i.pages[i.currentpage].VectorPageObj.width||0==i.pages[i.currentpage].VectorPageObj.height)return void i.setCurrentpage(e);i.restorecurpage=this.currentpage,i.SetActive()}else i.pages[i.currentpage].loadbinvectors();else i.pages[i.currentpage].usepdfjs?(i.pagelocked||(i.pages[i.currentpage].dxpdf=i.pages[e].dxpdf,i.pages[i.currentpage].dypdf=0),i.pages[i.currentpage].pageloaded||i.loadpage(i.currentpage),i.pages[i.currentpage].draw_canvas(!0),i.pages[i.currentpage].iscollapsed,i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display=li,i.pages[i.currentpage].PDFTextArea.style.zIndex="4")):(0!=i.currentpage&&(i.pages[i.currentpage].largeimageloaded&&i.pages[i.currentpage].smallimageloaded||(0==i.Type&&(i.pages[i.currentpage].initialzoom=2),i.pages[i.currentpage].loadimages()),i.pages[i.currentpage].dscale=i.pages[i.currentpage-1].dscale,i.pages[i.currentpage].dx=i.pages[i.currentpage-1].dx,i.pages[i.currentpage].dy=i.pages[i.currentpage-1].dy,i.pages[i.currentpage].checkimageswitch()),i.pages[i.currentpage].draw_image(!0));Vl(n),yn.length,i.pages[i.currentpage].usepdfjs,i.pages[i.currentpage].usevector3Dxml,i.pages[i.currentpage].usevectorxml,i.pages.length,i.currentpage,i.bActive;var t={numpages:this.pages.length,currentpage:this.currentpage};null!=Kt&&Kt.pageEvent(t)}this.restorecurpage=this.currentpage},this.checkprintready=function(){for(var e=!0,t=0;t<i.pages.length;t++)null!=i.pages[t]&&(i.pages[t].usevector3Dxml?e=!0:i.pages[t].usevectorxml?i.pages[t].vectorloaded||(e=!1):i.pages[t].usepdfjs?e=!0:i.pages[t].largeimageloaded&&i.pages[t].smallimageloaded||(e=!1));return e},this.loadAllPages=function(){i.bDoPrint=!0;for(var e=0;e<i.pages.length;e++)i.pages[e].usevectorxml?i.pages[e].vectorloaded||i.GotoPage(e):i.pages[e].usepdfjs||i.pages[e].largeimageloaded&&i.pages[e].smallimageloaded||i.GotoPage(e);i.GotoPage(0)},this.setDirectBitmapPrint=function(e,t,a,s,r,n,o){try{const l=new Uint8ClampedArray(e.buffer),c=new ImageData(l,e.width,e.height);let h=i.pages[t];h.pdfprintcanvas.width=e.width,h.pdfprintcanvas.height=e.height,h.printobj.pagenumber=t,h.pdfprintctx.putImageData(c,0,0),h.printobj.printctx.drawImage(h.pdfprintcanvas,r,n,a*o,s*o),jl(h.printobj.printctx,t,r,n,o),Qi[t]=!0}catch(e){console.error("Error in direct bitmap print:",e)}},this.printDirect=async function(e){if(!i.foxitdoc.pdfViewer)return;const t=(await i.foxitdoc.pdfViewer.getCurrentPDFDoc()).getPageCount();for(let a=0;a<t;a++)await new Promise((s,r)=>{i.pages[a].printobj.setRes(300),i.pages[a].printobj.setPaperSize(e.width,e.height),i.foxitdoc.getBitmapPrint(a,e,e=>{if(e.error)return console.error("Print error on page",a,e.error),void r(e.error);const{bitmap:n,pgindex:o,docwidth:l,docheight:c,pdx:h,pdy:d,pscale:p}=e;i.setDirectBitmapPrint(n,o,l,c,h,d,p),null!=Ha&&Ha.printpageComplete({current:a+1,total:t}),s()})})},this.printDocument=async function(e,t=!1){const a=i.currentpage;if(null!=i.foxitdoc)t?(e.DPI=300,await i.printDirect(e)):(await i.cycleThroughPages(e),i.pagecycle=!1,i.GotoPage(a));else{var s=0;do{null==i.pages[s]?Qi[s]=!0:(i.pages[s].printobj.setRes(300),i.pages[s].printobj.setPaperSize(e.width,e.height),i.pages[s].printobj.setScale(),i.pages[s].printobj.print()),s++}while(s<i.pages.length);i.bDoPrint=!1}},this.scrolltestfoxit=function(e,t){null!=i.foxitdoc&&i.foxitdoc.scrollpostest(e,t)},this.printcanvas=document.createElement("canvas"),this.printctx=this.printcanvas.getContext("2d"),this.print3Dimage=document.createElement("img"),this.pdfprintcanvas=document.createElement("canvas"),this.pdfprintctx=this.pdfprintcanvas.getContext("2d"),this.printobj={pagenumber:i.pages[i.currentpage],paperimage:i.printcanvas,paperwidth:297,paperheight:210,docwidth:1,docheight:1,inchtomm:25.4,DPI:300,scrDPI:96,scaleSet:!1,pdx:0,pdy:0,pscale:1,printctx:i.printctx,setRes:function(e){this.DPI=e},setPaperSize:function(e,t){this.paperwidth=e,this.paperheight=t,this.paperimage.width=e/this.inchtomm*this.DPI,this.paperimage.height=t/this.inchtomm*this.DPI},setDocSize:function(e,t){this.docwidth=e,this.docheight=t},setScale:function(){var e=this.paperimage.width/this.docwidth,t=this.paperimage.height/this.docheight;this.pscale=Math.min(e,t),this.pdx=(this.paperimage.width-this.docwidth*this.pscale)/2,this.pdy=(this.paperimage.height-this.docheight*this.pscale)/2,this.scaleSet=!0},print:function(){this.scaleSet&&(i.pages[i.currentpage].usepdfjs?i.pages[i.currentpage].printPDFpage():thispage.usevectorxml?i.pages[i.currentpage].draw_vectorPrint():thispage.usevector3Dxml?(i.pages[i.currentpage].print3Dimage.addEventListener("load",i.pages[i.currentpage].load3Dimage,!1),i.pages[i.currentpage].print3Dimage.src=d.domElement.toDataURL()):i.pages[i.currentpage].draw_imagePrint())}},this.setPageBitmapPrint=function(e,t){if(e.error)return void console.log("bitmap failed",t,e.error);if(null==e)return void console.log("bitmap failed",t,e.error);var a=new Uint8ClampedArray(e.buffer),s=new ImageData(a,e.width,e.height);i.pdfprintcanvas.width=e.width,i.pdfprintcanvas.height=e.height;const r=i.pages[t];i.pdfprintctx.putImageData(s,0,0),r.printobj.printctx.drawImage(i.pdfprintcanvas,r.printobj.pdx,r.printobj.pdy,r.printobj.docwidth*r.printobj.pscale,r.printobj.docheight*r.printobj.pscale),Qi[t]=!0,jl(r.printobj.printctx,t,r.printobj.pdx,r.printobj.pdy,r.printobj.pscale),vh(),console.log("page printed",t)},this.cycleThroughPages=async function(e){i.pagecycle=!0;for(let t=0;t<i.pages.length;t++){const a=k(t);i.GotoPage(t),await a;const s=i.pages[t];null!=s?s?.printobj&&(s.printobj.setRes(300),s.printobj.setPaperSize(e.width,e.height),s.printobj.setScale(),await new Promise(e=>{s.printResolve=e,s.printobj.print()})):(Qi[t]=!0,console.log("page not found",t))}console.log("â All pages rendered and printed."),i.pagecycle=!1},this.cycleThroughPagesorg=async function(){i.pagecycle=!0;for(let e=0;e<i.pages.length;e++){const t=D(e);i.GotoPage(e),await t,console.log(`Page ${e+1} done.`)}console.log("â All pages visited."),i.pagecycle=!1},this.dispatchPageChangeEvent=function(e=!1){if((e||i.currentpage!==i.lastDispatchedPage)&&(i.lastDispatchedPage=i.currentpage,window&&window.dispatchEvent)){const e=new CustomEvent("rx_page_change_done",{detail:{currentPage:i.currentpage}});window.dispatchEvent(e)}},this.foxitpageRenderEvent=function(e){const t=Math.max(0,e);i.currentpage=t,i.pages.length,i.pagecycle&&this.dispatchPageChangeEvent(!0)},this.foxitpagEvent=function(e){const t=Math.max(0,e-1);i.currentpage=t;const a={numpages:i.pages.length,currentpage:t};i.currentpage,null!=Kt&&Kt.pageEvent(a)},this.GotoPage=function(e,t){if(!isNaN(e)&&!(e>i.pages.length-1||e<0))if(e!=i.currentpage){var a=i.currentpage;if(i.prevpage=i.currentpage,null!=i.pages[i.currentpage]&&i.pages[i.currentpage].usepdfjs&&(i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display="none"),i.pages[i.currentpage].visible=!1),i.setCurrentpage(e),null!=i.pages[i.currentpage]){if(i.pages[i.currentpage].usevector3Dxml)null==i.pages[i.currentpage].Vector3DPageObj?(i.pages[i.currentpage].usevector3Dbinary&&i.pages[i.currentpage].loadvectors3DBinary(),i.pages[i.currentpage].usevector3DGLTF&&i.pages[i.currentpage].vector3DGltfload()):(i.restorecurpage=i.currentpage,i.SetActive());else if(i.pages[i.currentpage].usevectorxml)if(i.pages[i.currentpage].vectorloaded){if(null!=i.pages[i.currentpage].VectorPageObj||i.pages[i.currentpage].VectorPageObj.invalid){if(0==i.pages[i.currentpage].VectorPageObj.width||0==i.pages[i.currentpage].VectorPageObj.height)return void i.setCurrentpage(a);i.restorecurpage=i.currentpage,i.SetActive()}}else i.pages[i.currentpage].loadbinvectors();else i.pages[i.currentpage].usepdfjs?(i.bLargePDF,i.pagelocked?i.pages[i.currentpage].dypdf=0:i.pages[i.currentpage].setPFDdimnodraw(i.pages[0].dxpdf,0,1,!1),i.pages[i.currentpage].pageloaded||i.loadpage(i.currentpage),i.pages[i.currentpage].draw_canvas(!0),i.pages[i.currentpage].iscollapsed,i.bLargePDF&&(i.pages[i.currentpage].pdfisrendered=!1),i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display=li),null!=i.foxitdoc&&(i.pages[i.currentpage].rendercallback=!0,t?(i.foxitdoc.gotoPage(i.currentpage),i.foxitdoc.forceRedraw()):i.foxitdoc.gotoPage(i.currentpage),null!=i.pages[a]&&(i.pages[a].visible=!1,i.foxitdoc.setmarkupPosition(a)),i.foxitdoc.setmarkupPosition(i.currentpage))):(i.pages[i.currentpage].largeimageloaded&&i.pages[i.currentpage].smallimageloaded||(0==i.Type&&(i.pages[i.currentpage].initialzoom=2),i.pages[i.currentpage].loadimages()),0!=i.currentpage&&(i.pages[i.currentpage].dscale=i.pages[0].dscale,i.pages[i.currentpage].dx=i.pages[0].dx,i.pages[i.currentpage].dy=i.pages[0].dy,i.pages[i.currentpage].checkimageswitch()),i.pages[i.currentpage].draw_image(!0));Vl(n),yn.length,i.pages[i.currentpage].usepdfjs,i.pages[i.currentpage].usevector3Dxml,i.pages[i.currentpage].usevectorxml,i.pages.length,i.currentpage,i.bActive;var s={numpages:i.pages.length,currentpage:i.currentpage};i.currentpage,i.pages.length,null!=Kt&&Kt.pageEvent(s),i.restorecurpage=i.currentpage}}else i.pages[i.currentpage].usepdfjs&&i.foxitpageRenderEvent(e)},this.PageUp=function(){var e=i.currentpage;if(i.pages[i.currentpage].usepdfjs&&i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display="none"),i.currentpage-1>=0){if(i.setCurrentpage(i.currentpage-1),i.pages[i.currentpage].usevector3Dxml)null==i.pages[i.currentpage].Vector3DPageObj?(i.pages[i.currentpage].usevector3Dbinary&&i.pages[i.currentpage].loadvectors3DBinary(),i.pages[i.currentpage].usevector3DGLTF&&i.pages[i.currentpage].vector3DGltfload()):(i.restorecurpage=i.currentpage,i.SetActive());else if(i.pages[i.currentpage].usevectorxml)if(i.pages[i.currentpage].vectorloaded){if(0==i.pages[i.currentpage].VectorPageObj.width||0==i.pages[i.currentpage].VectorPageObj.height)return void i.setCurrentpage(e);i.restorecurpage=i.currentpage,i.SetActive()}else i.pages[i.currentpage].loadbinvectors();else i.pages[i.currentpage].usepdfjs?(i.pagelocked||(i.pages[i.currentpage].setPagePos(i.pages[e].dxpdf,0),i.pages[i.currentpage].dxpdf=i.pages[e].dxpdf,i.pages[i.currentpage].dypdf=0),i.pages[i.currentpage].pageloaded||i.loadpage(i.currentpage),i.pages[i.currentpage].draw_canvas(!0),i.pages[i.currentpage].iscollapsed,i.textselect&&(i.pages[i.currentpage].PDFTextArea.style.display=li)):(i.pages[i.currentpage].largeimageloaded&&i.pages[i.currentpage].smallimageloaded||(0==i.Type&&(i.pages[i.currentpage].initialzoom=2),i.pages[i.currentpage].loadimages()),i.pages[i.currentpage].checkimageswitch(),i.pages[i.currentpage].draw_image(!0));Vl(n),yn.length,i.pages[i.currentpage].usepdfjs,i.pages[i.currentpage].usevector3Dxml,i.pages[i.currentpage].usevectorxml,i.pages.length,i.currentpage,i.bActive;var t={numpages:this.pages.length,currentpage:this.currentpage};null!=Kt&&Kt.pageEvent(t)}this.restorecurpage=this.currentpage},this.getpage=function(e){return i.pages[e]},this.lockMarkupbyGUID=function(e,t){var a=0;for(a=0;a<this.markuplist.length;a++)this.markuplist[a].uniqueID==e&&(this.markuplist[a].locked=t)},this.getmarkupbyGUIDXML=function(e){var t=0,a="",s=!1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&(a=sh(this.markuplist[t],i),s=!0);return{document:a,found:s}},this.getmarkupSelectedXML=function(e){return e.isempty?void 0:sh(e,i)},this.getmarkupobjbyGUID=function(e){var t=0,a=null;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&0!=this.markuplist[t].uniqueID&&(a=this.markuplist[t]);return a},this.selectmarkupbyGUIDs=function(e){var t=0,a=0;for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;)null!=e[a]&&this.markuplist[t].uniqueID==e[a]&&this.markuplist[t].selectSet(),a++},this.unselectmarkupbyGUIDs=function(e){var t=0,a=0;for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;)null!=e[a]&&this.markuplist[t].uniqueID==e[a]&&this.markuplist[t].unselect(),a++},this.getannotGUIDs=function(){var e=0,t=[];for(e=0;e<this.markuplist.length;e++)t.push(this.markuplist[e].uniqueID);return t},this.getmarkupbyGUIDs=function(e){var t=0,a=0,i=[];for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;a++)this.markuplist[t].uniqueID==e[a]&&i.push(t);return i},this.getmarkupbyGUID=function(e){var t=0,a=-1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&(a=t);return a},this.getmarkupbynumber=function(e){var t=0,a=-1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupnumber==e&&(a=t);return a},this.getmarkupobjbynumber=function(e){var t=0,a=null;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupnumber==e&&(a=this.markuplist[t]);return a},this.getmarkupobjbyID=function(e){var t=0,a=null;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupID==e&&(a=this.markuplist[t]);return a},this.setGroupSelectedMarkup=function(e){var t=0;if(e)for(t=0;t<this.markuplist.length;t++){this.markuplist[t].bhasArrow&&this.markuplist[t].type;var a=6==this.markuplist[t].subtype&&6==this.markuplist[t].type,s=a||a,r=this.markuplist[t].selectedit&&9!=this.markuplist[t].type,n=this.markuplist[t].selected||r;s&&n&&this.markuplist[t].pagenumber==i.getcurPage()&&(this.markuplist[t].bispartofGroup=!0,this.markuplist[t].groupRect=i.getmarkupGroupRect())}else for(t=0;t<this.markuplist.length;t++)this.markuplist[t].bispartofGroup=!1,this.markuplist[t].groupRect={x:0,y:0,w:0,h:0}},this.getNumSelectedMarkup=function(){var e=0,t=0;for(e=0;e<this.markuplist.length;e++)this.markuplist[e].isSelected(i.getcurPage())&&t++;return t},this.getMarkupMultiselected=function(){return c},this.setMarkupMultiselected=function(){c=i.getNumSelectedMarkup()>1,i.setGroupSelectedMarkup(c)},this.getmarkupGroupRect=function(){var e=0,t=0,a=[],s=0,r=0,n=0,o=0,l=i.getSelectedMarkup();if(l.length>1){if(3==l[0].type||4==l[0].type||5==l[0].type||9==l[0].type||10==l[0].type||11==l[0].type||12==l[0].type){if(0!=l[0].rotation)var c=l[0].rotrect(l[0].xscaled,l[0].yscaled,l[0].xscaled+l[0].wscaled,l[0].yscaled+l[0].hscaled);else c={x:l[0].xscaled,y:l[0].yscaled,w:l[0].wscaled,h:l[0].hscaled};if(s=c.x,r=c.y,n=c.x+c.w,o=c.y+c.h,4==l[0].type&&1==l[0].subtype){var h=Math.max(l[0].xscaled,l[0].wscaled)-Math.min(l[0].xscaled,l[0].wscaled),d=Math.max(l[0].yscaled,l[0].hscaled)-Math.min(l[0].yscaled,l[0].hscaled),p=l[0].getdiag(h,d);s=l[0].xscaled-p,r=l[0].yscaled-p,n=l[0].xscaled+p,o=l[0].yscaled+p}}else s=l[0].xscaled,r=l[0].yscaled,n=l[0].wscaled,o=l[0].hscaled;for(e=0;e<l.length;e++)3==l[e].type||4==l[e].type||5==l[e].type||9==l[e].type||10==l[e].type||11==l[e].type||12==l[e].type?(c=0!=l[e].rotation?l[e].rotrect(l[e].xscaled,l[e].yscaled,l[e].xscaled+l[e].wscaled,l[e].yscaled+l[e].hscaled):{x:l[e].xscaled,y:l[e].yscaled,w:l[e].wscaled,h:l[e].hscaled},4==l[e].type&&1==l[e].subtype?(h=Math.max(l[e].xscaled,l[e].wscaled)-Math.min(l[e].xscaled,l[e].wscaled),d=Math.max(l[e].yscaled,l[e].hscaled)-Math.min(l[e].yscaled,l[e].hscaled),p=l[e].getdiag(h,d),a.push({x:l[e].xscaled-p,y:l[e].yscaled-p}),a.push({x:l[e].xscaled+p,y:l[e].yscaled+p})):(a.push({x:c.x,y:c.y}),a.push({x:c.x+c.w,y:c.y+c.h}))):(a.push({x:l[e].xscaled,y:l[e].yscaled}),a.push({x:l[e].wscaled,y:l[e].hscaled}));for(t=0;t<a.length;t++)a[t].x<s&&(s=a[t].x),a[t].y<r&&(r=a[t].y),a[t].x>n&&(n=a[t].x),a[t].y>o&&(o=a[t].y)}return{x:s,y:r,w:n,h:o}},this.getSelectedMarkup=function(){var e=0;const t=[];for(e=0;e<this.markuplist.length;e++){var a=this.markuplist[e].selectedit&&9!=this.markuplist[e].type;(this.markuplist[e].selected||a)&&this.markuplist[e].pagenumber==i.getcurPage()&&(this.markuplist[e].bhasArrow&&null!=this.markuplist[e].markupArrowConnected?t.push(this.markuplist[e].markupArrowConnected):t.push(this.markuplist[e]))}return t},this.moveselected=function(e,t){var a=0;for(a=0;a<this.markuplist.length;a++){var s=this.markuplist[a].selectedit&&9!=this.markuplist[a].type;(this.markuplist[a].selected||s)&&this.markuplist[a].pagenumber==i.getcurPage()&&this.markuplist[a].move(e,t)}},this.draw_mpage=function(){var e=ai/2;switch(i.pages[this.currentpage].currentimage){case 0:i.pages[this.currentpage].dy>e&&this.currentpage>0?i.setCurrentpage(this.currentpage-1):i.pages[this.currentpage].endy<e&&this.currentpage<this.NumPages-1&&i.setCurrentpage(this.currentpage+1),i.pages[this.currentpage].draw_image(!0),i.pages[this.currentpage].endy<ai&&this.currentpage<this.NumPages-1?i.pages[this.currentpage+1].largeimageloaded?(i.pages[this.currentpage+1].dy=i.pages[this.currentpage].endy+10,i.pages[this.currentpage+1].dx=i.pages[this.currentpage].dx,i.pages[this.currentpage+1].dscale=i.pages[this.currentpage].dscale,i.pages[this.currentpage+1].draw_image(!1)):(this.loadpage(this.currentpage+1),i.setCurrentpage(this.currentpage+1)):i.pages[this.currentpage].dy>10&&this.currentpage>0&&(i.pages[this.currentpage-1].largeimageloaded?(i.pages[this.currentpage-1].dy=i.pages[this.currentpage].dy-i.pages[this.currentpage].MainImageHeight*i.pages[this.currentpage].dscale-10,i.pages[this.currentpage-1].dx=i.pages[this.currentpage].dx,i.pages[this.currentpage-1].dscale=i.pages[this.currentpage].dscale,i.pages[this.currentpage-1].draw_image(!1)):(this.loadpage(this.currentpage-1),i.setCurrentpage(this.currentpage-1)));break;case 1:i.pages[this.currentpage].dyextent>e&&this.currentpage>0?i.setCurrentpage(this.currentpage-1):i.pages[this.currentpage].endy<e&&this.currentpage<this.NumPages-1&&i.setCurrentpage(this.currentpage+1),i.pages[this.currentpage].draw_image(!0),i.pages[this.currentpage].endy<ai&&this.currentpage<this.NumPages-1?i.pages[this.currentpage+1].smallimageloaded?(i.pages[this.currentpage+1].dy=i.pages[this.currentpage].endy+10,i.pages[this.currentpage+1].dx=i.pages[this.currentpage].dx,i.pages[this.currentpage+1].dscale=i.pages[this.currentpage].dscale,i.pages[this.currentpage+1].draw_image(!1)):(this.loadpage(this.currentpage+1),i.setCurrentpage(this.currentpage+1)):i.pages[this.currentpage].dyextent>10&&this.currentpage>0&&(i.pages[this.currentpage-1].smallimageloaded?(i.pages[this.currentpage-1].dy=i.pages[this.currentpage].dy-i.pages[this.currentpage].MainImageHeight*i.pages[this.currentpage].dscale-10,i.pages[this.currentpage-1].dx=i.pages[this.currentpage].dx,i.pages[this.currentpage-1].dscale=i.pages[this.currentpage].dscale,i.pages[this.currentpage-1].draw_image(!1)):(this.loadpage(this.currentpage-1),i.setCurrentpage(this.currentpage-1)))}yn.length,i.pages[this.currentpage].usepdfjs,i.pages[this.currentpage].usevector3Dxml,i.pages[this.currentpage].usevectorxml,i.pages.length,i.currentpage,i.bActive,this.restorecurpage=this.currentpage;var t={numpages:this.pages.length,currentpage:this.currentpage};null!=Kt&&Kt.pageEvent(t)},this.get_visible_pages=function(){},this.draw_mpagepdf=function(e){if(i.bActive&&!mi){var t=this.currentpage;if(this.restorecurpage=this.currentpage,null!=i.pages[this.currentpage]){var a,s,r,n,o,l,c=i.pages[this.currentpage].dypdf+i.pages[this.currentpage].offscreenheight*i.pages[this.currentpage].dscalepdf,h=i.pages[this.currentpage].dypdf,d=(i.pages[this.currentpage].dypdf,i.pages[0].offscreenheight,i.pages[0].dscalepdf,i.pages[0].dxpdf,i.pages[0].offscreenwidth,i.pages[0].dscalepdf,i.pages[0].offscreenheight*i.pages[0].dscalepdf),p=(a=h,s=c,r=i.currentpage,n=i.pages.length-1,o=si/2,l=Hl(),{bt:(a*=l)>10&&r>0,bc:a-10>o&&r>0,ab:(s*=l)<si&&r<n,ac:s+10<o&&r<n}),u=function(e,t){var a=t;return e.bc&&(a-=1),e.ac&&(a+=1),a}(p,this.currentpage);if(i.pages.length>1&&!i.pagelocked){if(i.pages[this.currentpage].draw_canvas(!0),p.ab?(g=C(this.currentpage+1),function(e,t,a,i,s,r){for(var n=t,o=s;o<=r;)n<ai&&o,o+=1,n=n+i+10}(0,i.pages[this.currentpage].dypdf+d+10,0,d,i.currentpage+1,i.pages.length-1),g.havepage&&g.loaded&&g.pdfdimset?(i.pages[this.currentpage+1].setPagePosBelow(i.pages[this.currentpage]),i.pages[this.currentpage+1].draw_canvas(!1)):null!=i.foxitdoc&&this.currentpage):p.bt&&(g=C(this.currentpage-1),function(e,t,a,i,s,r){for(var n=s,o=r,l=t,c=l+i;n>=0;)c>10&&(o=n),n-=1,c=(l=l-10-i)+i}(0,i.pages[this.currentpage].dypdf-10-d,0,d,i.currentpage-1,i.pages.length-1),g.havepage&&g.loaded&&g.pdfdimset?(i.pages[this.currentpage-1].setPagePosAbove(i.pages[this.currentpage]),i.pages[this.currentpage-1].draw_canvas(!1)):null!=i.foxitdoc&&this.currentpage),u!=this.currentpage){var g=C(u);e&&g.havepage&&g.loaded&&g.pdfdimset&&i.setCurrentpage(u)}}else i.pages[this.currentpage].draw_canvas(!0);this.textselect&&(i.pages[this.currentpage].PDFTextArea.style.display=li);var f={numpages:this.pages.length,currentpage:this.currentpage};this.currentpage,this.pages.length,null!=Kt&&t!=this.currentpage&&Kt.pageEvent(f)}}},this.Suspend=function(){i.pages[i.currentpage].usevector3Dxml&&(i.pages[i.currentpage].clock.stop(),d.clippingPlanes=Re,d.domElement.style.visibility="hidden",Hs=!1,null!=kt&&(kt.isupdate=!1,kt.set3DParts([])))},this.forcepagesState=function(e){if(0==yn.length)var t=1;else t=yn.length;var a={iscompare:mi,numOpenFiles:t,isPDF:!0,is3D:i.pages[i.currentpage].usevector3Dxml,markupOn3D:!1,is2D:i.pages[i.currentpage].usevectorxml,numpages:e,currentpage:i.currentpage,activefile:i.bActive,disableMenu:i.disableMenu||!1,source:"forcepagestateDoc"};null!=Jt&&Jt.setGUIState(a)},this.SetActive=function(e){if(!i.bSopenSilent){var t=i.pages.length,a=!1;if(i.setCurrentpage(i.restorecurpage),0==i.pages.length)return!1;if(e&&"Compare"==e.Type&&(a=!0,this.disableMenu=!0,this.Drawmarkup=!1,i.restorecurpage=i.currentpage,i.setCurrentpage(e.currentpage)),this.bActive=!0,d.clippingPlanes=Re,d.domElement.style.visibility="hidden",Hs=!1,mi=a,i.pages[i.currentpage].usevectorxml){if(nu(!1),!a&&i.pages[i.currentpage].VectorPageObj){i.pages[i.currentpage].restoreScaleAndOffset(),i.pages[i.currentpage].VectorPageObj.setActive();for(var s=0;s<i.pages.length;s++)i.pages[s].usedincomposite=!1,i.pages[s].VectorPageObj&&(i.pages[s].VectorPageObj.docompare=!1);this.bcompare?this.disableMenu=!0:this.disableMenu=!1,this.setactive=!1,this.Drawmarkup=!0,i.pages[i.currentpage].draw_vector(!0)}Vl(n),Lp()}else if(i.pages[i.currentpage].usevector3Dxml)switch(i.pages[i.currentpage].clock.start(),d.domElement.style.visibility="visible",mi=!1,i.pages[i.currentpage].Vector3DPageObj.clippingOn?d.clippingPlanes=i.pages[i.currentpage].Vector3DPageObj.globalPlanes:d.clippingPlanes=Re,Hs=!0,null!=kt&&(kt.isupdate=!1,kt.set3DParts(i.pages[i.currentpage].Vector3DPageObj.navlist)),i.curcontrol3D){case"orbitControl":eu("orbitControl",{}),i.curcontrol3D="orbitControl",null!=da&&Cs&&da.setWalkthroughGUI(!1);break;case"Walkthrough3D":eu("Walkthrough3D",{}),i.curcontrol3D="Walkthrough3D",null!=da&&Cs&&da.setWalkthroughGUI(!0)}else i.pages[i.currentpage].usepdfjs?(nu(!1),null!=i.foxitdoc&&i.foxitdoc.fileOpen&&i.foxitdoc.getLayerNodes(),a||(i.pages[i.currentpage].restoreScaleAndOffset(),de||(i.pages[i.currentpage].draw_canvas(!0),de=!1),this.disableMenu=!1,this.Drawmarkup=!0,Vl(n)),Lp()):i.pages[i.currentpage].usevectorbinarycompare||(nu(!0),a||(i.pages[i.currentpage].restoreScaleAndOffset(),this.disableMenu=!1,this.Drawmarkup=!0,Vl(n)),i.pages[i.currentpage].draw_image(!0),Lp());a=i.bcompare,i.disableMenu=i.bcompare,null!=Nt&&Nt.setMarkupList(i.getmarkuplist(),i.bActive),null!=ht&&ht.setThumbnails(i.thumbnails),null!=i.foxitdoc&&i.pages.length!=i.foxitdoc.numpages&&(t=i.foxitdoc.numpages);var r={iscompare:mi,numOpenFiles:yn.length,isPDF:i.pages[this.currentpage].usepdfjs,is3D:i.pages[this.currentpage].usevector3Dxml,markupOn3D:!1,is2D:i.pages[this.currentpage].usevectorxml,numpages:t,currentpage:i.currentpage,activefile:i.bActive,disableMenu:i.disableMenu||!1,source:"setActiveDocument"};null!=Jt&&Jt.setGUIState(r),null!=ja&&(ja.hastext=i.hastext,ja.hasText(i.hastext,i.bActive));var o={numpages:this.pages.length,currentpage:this.currentpage};return null!=Kt&&Kt.pageEvent(o),!0}},this.enableTextSelect=function(e){i.textselect=e;for(var t=0;t<i.pages.length;)null!=i.pages[t]&&(i.pages[t].usepdfjs&&(e||(i.pages[t].PDFTextArea.style.display="none")),i.pages[t].usevectorxml&&(e||i.pages[i.currentpage].usevectorbinarycompare||(i.pages[t].TextSelectArea.style.display="none"))),t++;e?null!=i.pages[i.currentpage]&&(i.pages[i.currentpage].usepdfjs&&(null!=i.foxitdoc&&eu("selectText",{p1:!1}),i.pages[i.currentpage].PDFTextArea.style.display=li),i.pages[i.currentpage].usevectorxml&&(i.pages[i.currentpage].cleartextdivs(),i.pages[i.currentpage].settextdivs(),i.pages[i.currentpage].TextSelectArea.style.display=li)):(null!=i.foxitdoc&&i.foxitdoc.removeTextSelect(i.pages[i.currentpage].textselectobj),Lp())},this.closePages=function(t){for(;0!=i.pages.length;){if(null!=i.pages[i.pages.length-1]){if(i.pages[i.pages.length-1].usepdfjs&&(i.pages[i.pages.length-1].PDFPointArray=[],i.pages[i.pages.length-1].pdfisfirstrendered&&null!=e&&null!=i.pages[i.pages.length-1].PDFTextArea&&(i.pages[i.pages.length-1].PDFTextArea.removeEventListener("wheel",tu,!0),e.removeChild(i.pages[i.pages.length-1].PDFTextArea))),i.pages[i.pages.length-1].usevectorxml){clearInterval(i.pages[i.pages.length-1].vectortimervar),i.textselect=!1,null!=e&&null!=i.pages[i.pages.length-1].TextSelectArea&&(e.appendChild(i.pages[i.pages.length-1].TextSelectArea),e.removeChild(i.pages[i.pages.length-1].TextSelectArea)),null!=i.pages[i.pages.length-1].VectorPageObj&&i.pages[i.pages.length-1].VectorPageObj.Close();var a=[];null!=yt&&yt.setVectorLayers(a),null!=xt&&xt.setVectorBlocks(a)}i.pages[i.pages.length-1].usevector3Dxml&&(d.domElement.style.visibility="hidden",null!=da&&Cs&&da.setWalkthroughGUI(!1),Hs=!1,null!=i.pages[i.pages.length-1].Vector3DPageObj&&(i.pages[i.pages.length-1].Vector3DPageObj.Close(),i.pages[i.pages.length-1].Vector3DPageObj=null),null!=kt&&(kt.isupdate=!1,kt.set3DParts([])))}i.pages.pop()}if(t){for(;0!=i.markupundolist.length;)i.markupundolist.pop();for(;0!=i.markupredolist.length;)i.markupredolist.pop();for(;0!=i.markuplist.length;)i.markuplist.pop();for(;0!=i.markupdraworder.length;)i.markupdraworder.pop()}null!=Nt&&Nt.setMarkupList(i.getmarkuplist(),i.bActive),null!=ht&&ht.setThumbnails(i.thumbnails)},this.setdelayedClose=function(e){i.bdelayedClose=e},this.getdelayedClose=function(){return i.bdelayedClose},this.bgFileClosed=function(){Qd(i.fileindex)},this.fgFileClosed=function(){Qd(i.fileindex)},this.Close=function(){for(i.bActive=!1,_s=!1;0!=i.pages.length;){if(null!=i.pages[i.pages.length-1]){if(i.pages[i.pages.length-1].usevectorxml){clearInterval(i.pages[i.pages.length-1].vectortimervar),i.textselect=!1,null!=e&&null!=i.pages[i.pages.length-1].TextSelectArea&&(e.appendChild(i.pages[i.pages.length-1].TextSelectArea),e.removeChild(i.pages[i.pages.length-1].TextSelectArea)),null!=i.pages[i.pages.length-1].VectorPageObj&&i.pages[i.pages.length-1].VectorPageObj.Close();var t=[];null!=yt&&yt.setVectorLayers(t),null!=xt&&xt.setVectorBlocks(t)}i.pages[i.pages.length-1].usevector3Dxml&&(d.domElement.style.visibility="hidden",null!=da&&Cs&&da.setWalkthroughGUI(!1),Hs=!1,null!=i.pages[i.pages.length-1].Vector3DPageObj&&(i.pages[i.pages.length-1].Vector3DPageObj.Close(),i.pages[i.pages.length-1].Vector3DPageObj=null),null!=kt&&(kt.isupdate=!1,kt.set3DParts([])))}i.pages.pop()}for(i.bdestroyPDFonClose&&(null!=i.pdfDoc&&i.pdfDoc.destroy(),i.pdfDoc=null,null!=i.foxitdoc&&(i.foxitdoc.closeFile(),foxitgetnumDocs()>2&&removefoxitdoc()));0!=this.markupundolist.length;)this.markupundolist.pop();for(;0!=this.markupredolist.length;)this.markupredolist.pop();for(;0!=this.markuplist.length;)this.markuplist.pop();for(;0!=this.markupdraworder.length;)this.markupdraworder.pop();for(;0!=this.layouts.length;)this.layouts.pop();for(;0!=this.thumbnails.length;)this.thumbnails.pop();null!=Nt&&Nt.setMarkupList(i.getmarkuplist(),i.bActive),null!=Mt&&Mt.setMarkupList([],i.bActive),null!=ht&&ht.setThumbnails(i.thumbnails),null!=i.setComparelink&&i.setComparelink.onClose(),i.setComparelink=void 0}}}class Tc{constructor(){var e=this;this.measurescale=Js,this.Unitofmeasure=Ys,this.unitname="Metric",this.SubmeasureUnit=fr,this.Unitlabel=qs,this.AreaUnitlabel=Zs,this.unitscale=hr,this.scaleValue="1:1",this.scaleLabel="1 Millimeter : 1 Millimeter",this.ndimprecision=be,this.setUnit=function(e){switch(e){case 1:this.Unitlabel="mm",this.AreaUnitlabel="mmÂ²";break;case 2:this.Unitlabel="in.",this.AreaUnitlabel="sq.in.";break;case 3:this.Unitlabel="Units",this.AreaUnitlabel="UnitsÂ²"}this.Unitofmeasure=e},this.getUnitScale=function(){return e.unitscale},this.getUnit=function(){var t="Metric";switch(this.Unitofmeasure){case 1:t="Metric";break;case 2:t="Imperial";break;case 3:t="System"}return{unit:e.Unitofmeasure,unitname:t,subunit:e.SubmeasureUnit,label:e.Unitlabel,Arealabel:e.AreaUnitlabel}},this.imperialUnit=function(t){switch("Inch"==t&&(e.SubmeasureUnit=1),"Feet"==t&&(e.SubmeasureUnit=2),"Yard"==t&&(e.SubmeasureUnit=3),"Mile"==t&&(e.SubmeasureUnit=4),"Nautical Miles"==t&&(e.SubmeasureUnit=5),e.SubmeasureUnit){case 1:e.Unitlabel="in.",e.AreaUnitlabel="sq.in.",e.unitscale=1;break;case 2:e.Unitlabel="ft.",e.AreaUnitlabel="sq.ft.",e.unitscale=12;break;case 3:e.Unitlabel="yd.",e.AreaUnitlabel="sq.yd.",e.unitscale=36;break;case 4:e.Unitlabel="mi.",e.AreaUnitlabel="sq.mi",e.unitscale=63360;break;case 5:e.Unitlabel="nm",e.AreaUnitlabel="sq.nm",e.unitscale=72913.3858}},this.metricUnit=function(t){switch("Millimeter"==t&&(e.SubmeasureUnit=1),"Centimeter"==t&&(e.SubmeasureUnit=2),"Decimeter"==t&&(e.SubmeasureUnit=3),"Meter"==t&&(e.SubmeasureUnit=4),"Kilometer"==t&&(e.SubmeasureUnit=5),"Nautical Miles"==t&&(e.SubmeasureUnit=6),e.SubmeasureUnit){case 1:e.Unitlabel="mm",e.AreaUnitlabel="mmÂ²",e.unitscale=1;break;case 2:e.Unitlabel="cm",e.AreaUnitlabel="cmÂ²",e.unitscale=10;break;case 3:e.Unitlabel="dm",e.AreaUnitlabel="dmÂ²",e.unitscale=100;break;case 4:e.Unitlabel="m",e.AreaUnitlabel="mÂ²",e.unitscale=1e3;break;case 5:e.Unitlabel="km",e.AreaUnitlabel="kmÂ²",e.unitscale=1e6;break;case 6:e.Unitlabel="nmi",e.AreaUnitlabel="nmiÂ²",e.unitscale=1852e5}},this.setMeasureScaledirect=function(t){e.measurescale=t},this.getMeasureScale=function(){return e.measurescale},this.getScaleValue=function(){return e.scaleValue},this.setCalibration=function(t){return t?0!=Qs&&(Ks=1/(Ks=$s/Qs),e.measurescale=Ks):Ks=1,jd(),Ks},this.setCalibrateScale=function(t){e.measurescale=t,jd()},this.setMeasureScale=function(t){e.scaleValue=t;var a=0,i=0;if("Calibration"!=t){var s=t.split(":");a=s[0],i=s[1],e.measurescale=Kr?i/a:a/i}else e.measurescale=Ks;jd()},this.setDimPrecision=function(t){e.ndimprecision=t},this.getDimPrecision=function(t){return e.ndimprecision},this.setScaleLabel=function(t){e.scaleLabel=t},this.getScaleLabel=function(){return e.scaleLabel},this.resetToDefaultValue=function(){e.measurescale=Js,e.Unitofmeasure=Ys,e.unitname="Metric",e.SubmeasureUnit=fr,e.Unitlabel=qs,e.AreaUnitlabel=Zs,e.unitscale=hr,e.scaleValue="1:1",e.scaleLabel="1 Millimeter : 1 Millimeter",e.ndimprecision=be}}}function Ec(e){}function Fc(e){if(null!=sa&&sa.setUpload("hide"),200==e.currentTarget.status){var t=e.currentTarget.responseXML;null!=t&&null!=t.documentElement||(t=So(e.currentTarget.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;a=zo(hn.FileNameSRC)+a,null!=Ge&&Ge.loadComplete(a)}else 404==this.status?console.log("Image upload failed error 404"):503==this.status&&console.log("Image upload failed error 503")}function Ic(e){e.lengthComputable&&null!=sa&&sa.setUpload(Math.round(100*e.loaded/e.total))}function jc(){var e=Ho(hn.OriginalURL),t=_o(hn.OriginalURL);if(he)var a=Z+"&"+e+"&"+t+"&PDF&200";else a=Z+"?"+e+"&"+t+"&PDF&200";var i=d.domElement.toDataURL();Mh("POST",a,"",[{event:"load",func:Fc},{event:"progress",func:Ic,bupload:!0}],i)}function Ac(e){var t="";return t=(t=e.replace(/&(?!amp;)(?!quot;)(?!lt;)(?!gt;)(?!apos;)/g,"&amp;")).replace(/"/g,"&quot;"),m0=m0.replace(/'/g,"&apos;"),t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;")}function Oc(e){Dl(),bl(),hn.bLargePDF?function(e){var t=new wn(hn);t.setOncomplete((function(t){Vc(e,t)})),t.createxmlexport(Fr,Ir,e.consolidateonly)}(e):function(e){var t=ih(!1,e.consolidateonly,Pi,Fr,Fr);Vc(e,t)}(e)}function Lc(e){e.consolidateonly,e.format,e.UPI,e.paperSize,e.markupFlag,e.useRaster;var t=Ho(hn.OriginalURL),a=_o(hn.OriginalURL);if(he)var i=Y+"&"+t+"&"+a;else i=Y+"?"+t+"&"+a;for(var s=[],r=Eo(),n=0;n<r.length;n++)s.push({type:r[n].type,name:r[n].name,ptrn:r[n].ptrn,tilesize:r[n].tilesize,color:r[n].color,description:r[n].description,inuse:r[n].inuse});var o={pagerect:Sd(),fillarray:s,layers:Md(),filledblocks:Td()};for(n=0;n<o.fillarray.length;n++)if("hatch"==o.fillarray[n].type){var l=zn(o.fillarray[n].ptrn);o.fillarray[n].ptrn=l}var c=JSON.stringify(o);Fh("POST",i,"",c).then((function(t){var a=So(t);if(null!=a.getElementsByTagName("reference")[0]){var i=a.getElementsByTagName("reference")[0].firstChild.nodeValue;e.reference=i,function(e){var t=e.consolidateonly,a=(e.format,e.UPI,e.paperSize),i=(e.markupFlag,e.useRaster,e.reference),s=ih(!1,t,!0,Fr,Fr),r=Ho(hn.OriginalURL),n=_o(hn.OriginalURL);if(he)var o=q+"&"+r+"&"+n+"&"+i+"&"+a;else o=q+"?"+r+"&"+n+"&"+i+"&"+a;Eh("POST",o,s).then((function(e){if(null!=e.getElementsByTagName("PDF")[0]){var t=e.getElementsByTagName("PDF")[0].firstChild.nodeValue,a=zo(hn.FileNameSRC);he&&(a=fe),t=a+t,null!=Ge&&Ge.loadComplete(t)}})).catch((function(e){e.status?console.log("exportFilePrintFinal",e.status):console.log(e)}))}(e)}})).catch((function(e){e.status?console.log("exportFileSendPrintPDF",e.status):console.log(e)}))}function Vc(e,t){if(!yd()){e.consolidateonly;var a=e.format,i=e.UPI,s=e.paperSize,r=e.markupFlag,n=e.singlepage,o=e.page,l=e.useRaster?"1":"0";if((new Date).getTime(),hn.getCurrentpage().usevector3Dxml)jc();else{hn.getCurrentpage().usepdfjs&&(hn.getCurrentpage().curpagescale,hn.getCurrentpage().dscalepdf);var c=new XMLHttpRequest;c.withCredentials=ji,c.upload.addEventListener("progress",Ec,!1);var h=Ho(hn.OriginalURL),d=_o(hn.OriginalURL);if(e.overridefilename&&(d=e.overridefilename),n&&null!=o)var p=W+"&"+h+"&"+d+"&"+o+"&"+a+"&"+i+"&"+s+"&"+r+"&"+l;else p=he?_+"&"+h+"&"+d+"&"+a+"&"+i+"&"+s+"&"+r+"&"+l:_+"?"+h+"&"+d+"&"+a+"&"+i+"&"+s+"&"+r+"&"+l;try{c.open("POST",p,!0)}catch(e){alert("Error 1 - "+e)}try{c.responseType=""}catch(e){}if(_r){var u=Th();u.authset&&c.setRequestHeader("Authorization",u.authString+u.baseuserstring)}c.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=So(this.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;null!=t.getElementsByTagName("isPDF")[0]&&t.getElementsByTagName("isPDF")[0].firstChild.nodeValue;var i=zo(hn.FileNameSRC);he&&(i=fe),Ri||(a=i+a),null!=Ge&&Ge.loadComplete(a)}else 404==this.status?console.log("Export of PDF failed, error 404"):503==this.status&&console.log("Export of PDF failed, error 503")},c.send(t)}}}function Nc(e,i,r,o){if(Ii=!1,wi){if(null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),null!=e.displayname)var l=e.displayname;else l=_o(e.filename);var c,h=function(e){var t='<?xml version="1.0" encoding="UTF-8"?>';return t+="<RxViewServer>",t+="<Command>GetFile</Command>",t+="<LicenseID>"+os+"</LicenseID>",t+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(t+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(t+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(t+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(t+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(t+="<password>"+e.password+"</password>"),t+"</RxViewServer>"}(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp(),Eh("POST",C,h,[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=la&&la.setDownload("hide");var s=0,n=0;fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1),hn.usepagesload=!0;var o=Wo(hn.OriginalURL),h=e.getElementsByTagName("Layout");for(t=0;t<h.length;t++){var d=h[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;hn.addlayout(d);var p=h[t].getElementsByTagName("Page");if(i.indexOf(t)>=0)for(a=0;a<p.length;a++)0==a&&0==t?(r&&i.indexOf(t),(i.indexOf(a)>=0||r)&&(c=new Sc(p[a],d,!0,o,a,hn),hn.addpage(c,!0),hn.addthumbnail(new bc(p[a],d,hn,a)),n++)):(i.indexOf(a)>=0||r)&&(0==n?(c=new Sc(p[a],d,!0,o,a+s,hn),hn.addthumbnail(new bc(p[a],d,hn,a+s)),hn.addpage(c,!0),n++):(c=new Sc(p[a],d,!1,"",a+s,hn),hn.addthumbnail(new bc(p[a],d,hn,a+s)),hn.addpage(c,!1),n++));s+=a}if(md()){hn.FileName=l,yn[fn-1]=hn,null!=ht&&ht.setThumbnails(hn.thumbnails);var u={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"getfilepages"};null!=Jt&&Jt.setGUIState(u);var g={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(g)}else u={iscompare:mi,numOpenFiles:yn.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:hn.pages.length,currentpage:0,activefile:hn.bActive,source:"getfilepages"},null!=Jt&&Jt.setGUIState(u)})).catch((function(e){fd(e)}))}}function Bc(e,i,r,o){if(Ii=!1,wi){null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0));var l,c=_o(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp();var h='<?xml version="1.0" encoding="UTF-8"?>';h+="<RxViewServer>",h+="<Command>GetFile</Command>",h+="<LicenseID>"+os+"</LicenseID>",h+="<FileURL>"+e+"</FileURL>",Eh("POST",C,h+="</RxViewServer>",[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=la&&la.setDownload("hide");var s=0,n=0;null==hn||null==hn?(fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1),hn.usepagesload=!0):(fn=yn.push(new Mc(e)),hn.enableTextSelect(!1),(hn=yn[fn-1]).setfileindex(fn-1),hn.usepagesload=!0);var o=Wo(hn.OriginalURL),h=e.getElementsByTagName("Layout");for(t=0;t<h.length;t++){var d=h[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;hn.addlayout(d);var p=h[t].getElementsByTagName("Page");if(i.indexOf(t)>=0)for(a=0;a<p.length;a++)0==a&&0==t?(r&&i.indexOf(t),(i.indexOf(a)>=0||r)&&(l=new Sc(p[a],d,!0,o,a,hn),hn.addpage(l,!0),hn.addthumbnail(new bc(p[a],d,hn,a)),n++)):(i.indexOf(a)>=0||r)&&(0==n?(l=new Sc(p[a],d,!0,o,a+s,hn),hn.addthumbnail(new bc(p[a],d,hn,a+s)),hn.addpage(l,!0),n++):(l=new Sc(p[a],d,!1,"",a+s,hn),hn.addthumbnail(new bc(p[a],d,hn,a+s)),hn.addpage(l,!1),n++));s+=a}if(md()){hn.FileName=c,yn[fn-1]=hn,null!=ht&&ht.setThumbnails(hn.thumbnails);var u={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"getfilepages"};null!=Jt&&Jt.setGUIState(u);var g={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(g)}else u={iscompare:mi,numOpenFiles:yn.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:hn.pages.length,currentpage:0,activefile:hn.bActive,source:"getfilepages"},null!=Jt&&Jt.setGUIState(u)})).catch((function(e){gd("getFilePages",e)}))}}function Uc(e,t){if(Ii=!1,wi){if(null!=e.displayname)var a=e.displayname;else a=_o(e.filename);var i='<?xml version="1.0" encoding="UTF-8"?>';i+="<RxViewServer>",i+="<Command>GetFile</Command>",i+="<LicenseID>"+os+"</LicenseID>",i+="<FileURL>"+e.filename+"</FileURL>",Eh("POST",C,i+="</RxViewServer>").then((function(e){yn.length>0&&yn[t].updateURL(e),Wo(hn.OriginalURL),hn.Format.substring(0,9),hn.FileName=a})).catch((function(e){fd(e)}))}}function Gc(e,t,a){if(Ii=!1,wi){var i='<?xml version="1.0" encoding="UTF-8"?>';i+="<RxViewServer>",i+="<Command>GetFile</Command>",i+="<LicenseID>"+os+"</LicenseID>",i+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(i+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(i+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(i+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(i+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(i+="<password>"+e.password+"</password>"),e.refresh&&(i+="<RefreshCache>1</RefreshCache>"),Eh("POST",C,i+="</RxViewServer>",[{event:"callback",func:t},{event:"progressCallBack",func:a}]).then((function(e){var t=(new XMLSerializer).serializeToString(e);null!=$e&&$e.setXMLreturn(e,t)})).catch((function(e){gd("createContent",e)}))}else null!=la&&la.setDownload("hide")}function zc(e,i,r){if(Ii=!1,wi){if(null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),null!=e.displayname)var o=e.displayname;else o=_o(e.filename);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp();var l='<?xml version="1.0" encoding="UTF-8"?>';l+="<RxViewServer>",l+="<Command>GetFile</Command>",l+="<LicenseID>"+os+"</LicenseID>",l+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(l+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(l+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(l+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(l+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(l+="<password>"+e.password+"</password>"),null!=e.displayname&&(l+="<displayname>"+e.displayname+"</displayname>"),Ci&&(l+="<Customer>"+ci+"</Customer>"),Eh("POST",C,l+="</RxViewServer>",[{event:"callback",func:i},{event:"progressCallBack",func:r}]).then((function(t){if(gi&&Li&&Qd(),w=t,0==t.getElementsByTagName("Error").length||null==t.getElementsByTagName("Error")[0].firstChild){null==hn||null==hn?(fn=yn.push(new Mc(t)),(hn=yn[fn-1]).setfileindex(fn-1)):(fn=yn.push(new Mc(t)),hn.enableTextSelect(!1),(hn=yn[fn-1]).setfileindex(fn-1)),null!=e.password&&hn.setPassword(e.password),hn.ScrollBarCheck(),null!=hn.OriginalURL&&Wo(hn.OriginalURL),hn.Format.substring(0,9),hn.openFileName=o;var a=t.getElementsByTagName("Layout");if(hn.createPages(a,o),md()){yn[fn-1]=hn,null!=ht&&ht.setThumbnails(hn.thumbnails);var i={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"getfile"};null!=Jt&&Jt.setGUIState(i);var s={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(s)}}else{var r=t.getElementsByTagName("Error")[0].firstChild.nodeValue;"nolicense"==r?alert("There is currently no available licenses for this format"):"nomorelicense"==r?alert("There is currently no free licenses for this format, try again later"):"Require Password"==r&&function(e,t){null!=la&&la.setDownload("hide"),"Require Password"==e&&null!=ct&&ct.PassWordRequest(Ad,1,t)}(r,e)}})).catch((function(e){gd("getFile",e)}))}else null!=la&&la.setDownload("hide")}function Hc(e,t,a){if(Ii=!1,wi){null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!1));var i=_o(e);yp(),mp();var s='<?xml version="1.0" encoding="UTF-8"?>';s+="<RxViewServer>",s+="<Command>GetFile</Command>",s+="<LicenseID>"+os+"</LicenseID>",s+="<FileURL>"+e+"</FileURL>",Eh("POST",C,s+="</RxViewServer>",[{event:"callback",func:t},{event:"progressCallBack",func:a}]).then((function(e){gi&&Li&&Qd(),w=e,null==hn||null==hn?(fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1)):(fn=yn.push(new Mc(e)),yn[fn-1].setfileindex(fn-1),yn[fn-1].bSopenSilent=!0),Wo(yn[fn-1].OriginalURL);var t=e.getElementsByTagName("Layout");if(yn[fn-1].createPages(t,i),null!=yn[fn-1]){null!=ht&&ht.setThumbnails(yn[fn-1].thumbnails);var a={iscompare:mi,numOpenFiles:yn.length,isPDF:yn[fn-1].pages[yn[fn-1].currentpage].usepdfjs,is3D:yn[fn-1].pages[yn[fn-1].currentpage].usevector3Dxml,markupOn3D:!1,is2D:yn[fn-1].pages[yn[fn-1].currentpage].usevectorxml,numpages:yn[fn-1].pages.length,currentpage:yn[fn-1].getcurPage(),activefile:!1,source:"noActiveFile"};null!=Jt&&Jt.setGUIState(a);var s={numpages:yn[fn-1].pages.length,currentpage:yn[fn-1].getcurPage()};null!=Kt&&Kt.pageEvent(s)}})).catch((function(e){gd("getFileNotActive",e)}))}}function _c(e){e.setnummarkupfiles(yr.length);for(var t=0;t<yr.length;t++)yr.length,Kc(yr[t],e);Vl(n),e.markuploaded=!0,0==markupfilepathobj.length&&null!=Nt&&Nt.setMarkupList(e.getmarkuplist(),e.bActive),or=!1}function Wc(e,t){var a=$;he&&(a=fe);var i=_o(t.CacheFileName),s='<?xml version="1.0" encoding="UTF-8"?>';s+="<RxViewServer>",s+="<Command>GetMarkupByRef</Command>",s+="<LicenseID>"+os+"</LicenseID>",s+="<FileURL>"+e+i+"</FileURL>",s+="<MARKUP_INFO>";for(var r=0;r<yr.length;r++)s+="<MARKUP_URL>"+yr[r]+"</MARKUP_URL>";s+="</MARKUP_INFO>",Eh("POST",C,s+="</RxViewServer>").then((function(e){var i=0,s=0,r=e.getElementsByTagName("File");for(t.setnummarkupfiles(r.length),s=0;s<r.length;s++)i=r[s].firstChild.nodeValue,i=a+i,r.length,Kc(i,t);Vl(n),t.markuploaded=!0,0==r.length&&null!=Nt&&Nt.setMarkupList(t.getmarkuplist(),t.bActive),nr=!1})).catch((function(e){e.status?404==e.status?console.log("getMarkupbyReference error 404"):503==e.status?console.log("getMarkupbyReference error 503"):501==e.status&&console.log("getMarkupbyReference error 501"):console.log(e)}))}function Xc(e,t){if(!lr&&!cr){_o(t.FileName);var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetMarkup</Command>",a+="<LicenseID>"+os+"</LicenseID>",a+="<FileURL>"+e+"</FileURL>",Eh("POST",P,a+="</RxViewServer>").then((function(e){var a=0,i=0;try{var s=e.getElementsByTagName("readonlymarkup")[0].firstChild.nodeValue}catch(e){s=""}Hr||(Hr=""!=s&&"True"==s);var r=e.getElementsByTagName("File");for(t.setnummarkupfiles(r.length),t.pages[0].usevector3DGLTF&&t.pages[0].Vector3DPageObj&&t.pages[0].Vector3DPageObj.load3Dmarkupcheck(),i=0;i<r.length;i++)a=r[i].firstChild.nodeValue,a=he?fe+a:Q+a,t.pages[0].usevector3DGLTF,Kc(a,t),t.setmarkupfilepaths(a);Vl(n),t.markuploaded=!0,0==r.length&&(null!=Nt&&Nt.setMarkupList(t.getmarkuplist(),t.bActive),null!=tt&&tt.loadComplete(t.markuplist,t.fileindex,t.bActive))})).catch((function(e){fd(e)}))}}function Yc(e){localStorage.clear(),hh(os),ch(0,"",!1),qc(e,!1)}function qc(e,t){if("undefined"!=typeof Storage){if(t){var a=e.markupnumber;if(null!=localStorage.getItem("MarkupPostfixlist")){var i=localStorage.MarkupPostfixlist;localStorage.setItem("MarkupPostfixlist",i+","+a)}else localStorage.setItem("MarkupPostfixlist",a)}else a="";localStorage.setItem("Type"+a,e.type),localStorage.setItem("Subtype"+a,e.subtype),localStorage.setItem("Alternative"+a,e.alternative),localStorage.setItem("Redaction"+a,e.bRedact?1:0),localStorage.setItem("Rotation"+a,e.rotation),localStorage.setItem("fillcolor"+a,e.fillcolor),localStorage.setItem("strokecolor"+a,e.strokecolor),localStorage.setItem("textcolor"+a,e.textcolor),localStorage.setItem("markercolor"+a,e.markercolor),localStorage.setItem("Color"+a,e.color),localStorage.setItem("FontName"+a,e.font.fontName),localStorage.setItem("FontHeight"+a,e.font.height),localStorage.setItem("bold"+a,e.font.bold?1:0),localStorage.setItem("italic"+a,e.font.italic?1:0),localStorage.setItem("Transparency"+a,e.transparency),null!=e.leaderoffset&&localStorage.setItem("LeaderOffset"+a,e.leaderoffset),null!=e.labeloffsetx&&localStorage.setItem("LabelOffsetX"+a,e.labeloffsetx),null!=e.labeloffsety&&localStorage.setItem("LabelOffsetY"+a,e.labeloffsety),null!=e.arrowlength&&localStorage.setItem("Arrowlength"+a,e.arrowlength),""==e.text?localStorage.setItem("Text"+a,""):localStorage.setItem("Text"+a,e.text),""==localStorage.DimText?localStorage.setItem("DimText"+a,""):localStorage.setItem("DimText"+a,e.dimtext),localStorage.setItem("TextWidth"+a,e.textwidth),12==e.type&&localStorage.setItem("Stampsmalltheight"+a,e.stampsmalltheight),11==e.type&&localStorage.setItem("image"+a,e.image.src),20==e.type&&localStorage.setItem("image"+a,e.image.src),localStorage.setItem("Scaling"+a,e.scaling),localStorage.setItem("Xoffset"+a,e.xoffset),localStorage.setItem("Yoffset"+a,e.yoffset),localStorage.setItem("Pageheight"+a,e.pageheight),localStorage.setItem("Pagewidth"+a,e.pagewidth),localStorage.setItem("LineWidth"+a,e.linewidth),localStorage.setItem("OuterRadius"+a,e.outerRadius),localStorage.setItem("InnerRadius"+a,e.innerRadius),e.points.length>0&&localStorage.setItem("Points"+a,JSON.stringify(e.points)),e.pointlist.length>0&&localStorage.setItem("Pointlist"+a,JSON.stringify(e.pointlist)),e.sides.length>0&&localStorage.setItem("Sides"+a,JSON.stringify(e.sides)),e.countshapes.length>0&&localStorage.setItem("Countshapes"+a,JSON.stringify(e.countshapes)),localStorage.setItem("Rect"+a,"x="+e.x+" y="+e.y+" w="+e.w+" h="+e.h)}}function Zc(e,t){var a={type:5,data:e.image,index:t,width:e.width,height:e.height};null!=zt&&zt.onStampReceived(a)}function Jc(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetGUID</Command>",t+="<LicenseID>"+os+"</LicenseID>",Fh("POST",C,"",t+="</RxViewServer>").then((function(t){var a=t;e.setUniqueID(a)})).catch((function(e){e.status?console.log(e.status):console.log(e)}))}function Kc(e,t){Eh("GET",e).then((function(a){cp(a,t,e)})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status?console.log("Server is down"):501==e.status&&console.log("Markup could not be loaded"):console.log(e)}))}function $c(e,t,a,i){for(var s=e.ownerDocument.createElement(t),r=0;r<i.length;r++)s.setAttribute(i[r].name,i[r].value);s.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(s)}function Qc(e,t,a){var i=e.ownerDocument.createElement(t);i.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(i)}function eh(e,t,a,i,s){(new Date).getTime();var r=1,n=1,o=1,l={operation:null,Entity:{ID:e.markupnumber,Image:null,UniqueID:null,Imagehref:null,SvgContent:null,Type:null,Subtype:null,Alternative:null,Redaction:null,Layer:null,Rotation:null,TextRotation:null,PageRotation:null,FileName:null,Layout:null,View:null,ViewName3D:null,For3DView:null,PageHeight3D:null,PageWidth3D:null,ViewName:null,Handle:null,FillColor:null,LineColor:null,TextColor:null,Transparency:null,Consolidated:null,HaveLink:null,HaveLeader:null,HasScale:null,ScalingObject:null,LeaderReference:null,Entity:null,FixedScale:null,LineStyleScale:null,LinkURL:null,Font:null,Text:null,Status:null,SmallText:null,DimText:null,CustomLabelOn:null,CustomLabelText:null,TextWidth:null,Signature:null,Name:null,TimeStamp:null,Scaling:null,LoadScaling:null,Printscale:null,Xoffset:null,Yoffset:null,LineWidth:null,LineWidthSegment:null,ArrowSize:null,LineStyle:null,MainImageScaling:null,MainImageOffsetX:null,MainImageOffsetY:null,DocScale:null,DocOffsetX:null,DocOffsetY:null,Points:{Point:[]},Line:[],Holes:[],outerRadius:null,innerRadius:null,startX:null,startY:null,secondX:null,secondY:null,endX:null,endY:null,LeaderLineOffset:null,LabelOffsetX:null,LabelOffsetY:null,LabelColor:null,Rect:null,Extended:[],Comments:[]}};if(0!=e.markupID&&null!=e.markupID||(e.markupID=e.markupnumber),s&&(l.operation=s),null!=e&&!e.pdfannotproxy){var c=null;i||e.bisTextArrow&&null!=e.textBoxConnected&&(c=JSON.parse(eh(e,t,a,!0)),e=e.textBoxConnected);var h=e.pagenumber,d=t.getThumb(h),p=null!=a,u=e.viewname,g=e.isdrawn();if(p){if(a.usepdfjs||a.usevectorxml?r=e.scaling:o=e.scaling,1==(n=a.fixedScale))if(0==a.pdfpageheight&&0==a.pdfpagewidth);else{var f=Te/a.pdfpageheight,m=Me/a.pdfpagewidth;n=Math.min(m,f)}isFinite(r)||(r=1),isFinite(n)||(n=1),0==r&&(r=1),isNaN(r)&&(r=1),null==n&&(n=1),isNaN(n)&&(n=1),0==n&&(n=1);var y=3==e.type&&4==e.subtype;l.Entity.ID=e.markupnumber,11!=e.type&&20!=e.type||(l.Entity.Image={image:zn(e.image),type:"png",encoding:"base64"},e.svgContent&&(l.Entity.SvgContent=e.svgContent)),l.Entity.UniqueID=e.uniqueID,11!=e.type&&20!=e.type||""==e.imagehref||(l.Entity.Imagehref=e.imagehref),l.Entity.Type=e.type,l.Entity.Subtype=e.subtype,l.Entity.Alternative=e.alternative,l.Entity.Redaction=e.bRedact?1:0,l.Entity.Layer=e.layer,l.Entity.Rotation=e.rotation,l.Entity.TextRotation=e.textrotate,l.Entity.PageRotation=e.pagerotation,l.Entity.FileName=e.documentName,l.Entity.Layout=a.LayoutName,l.Entity.View=h,e.hasScale&&null!=e.scaleObject&&(l.Entity.HasScale=!0,l.Entity.ScalingObject={Measurescale:e.scaleObject.measurescale,ScaleLabel:e.scaleObject.scaleLabel,Unitofmeasure:e.scaleObject.Unitofmeasure,SubmeasureUnit:e.scaleObject.SubmeasureUnit,Unitlabel:e.scaleObject.Unitlabel,AreaUnitlabel:e.scaleObject.AreaUnitlabel,Unitscale:e.scaleObject.unitscale,ScaleValue:e.scaleObject.scaleValue,Ndimprecision:e.scaleObject.ndimprecision}),null!=u&&(l.Entity.ViewName3D=u,l.Entity.For3DView=e.bfor3D?1:0,l.Entity.PageHeight3D=e.pageheight,l.Entity.PageWidth3D=e.pagewidth),l.Entity.ViewName=d.PageName,l.Entity.Handle=e.bfor3D?1:0,l.Entity.FillColor=e.fillcolor,l.Entity.LineColor=y?e.fillcolor:e.strokecolor,l.Entity.TextColor=e.textcolor,l.Entity.Transparency=e.transparency,l.Entity.Consolidated=e.consolidated?1:0,l.Entity.HaveLink=e.bhaveLink?1:0,l.Entity.HaveLeader=e.bhasArrow?1:0,e.bhasArrow&&null!=e.markupArrowConnected&&(l.Entity.LeaderReference=e.markupArrowConnected.markupnumber,null!=c||(c=JSON.parse(eh(e.markupArrowConnected,t,a,!0,s))),l.Entity.Entity=c);var v=null;if(e.holes.length>0)for(var x=0;x<e.holes.length;x++)v=JSON.parse(eh(e.holes[x],t,a,!1)),l.Entity.Holes.push(v);l.Entity.FixedScale=e.bUseFixedScale?1:0,l.Entity.FixedScaleFactor=e.fixedscaleFactor,l.Entity.LineStyleScale=n,l.Entity.LinkURL=e.linkURL;var b={Font:{facename:null,height:null,bold:null,italic:null}};b.Font.facename=e.font.fontName,g?a.usepdfjs||a.usevectorxml?12!=e.type&&e.bUseFixedScale?b.Font.height=e.font.height/n:b.Font.height=e.font.height/r:12!=e.type&&e.bUseFixedScale?b.Font.height=e.font.height/n:b.Font.height=e.font.height/o:b.Font.height=e.font.height,b.Font.bold=e.font.bold?1:0,b.Font.bold=e.font.italic?1:0,l.Entity.Font=b;var w=Kn(e.signature);l.Entity.Text=""==e.text?".":e.text,l.Entity.SmallText=""==e.smalltext?".":e.smalltext,l.Entity.DimText=""==e.dimtext?".":e.dimtext,l.Entity.Status=e.status,l.Entity.CustomLabelOn=e.busecustomlabel?1:0,l.Entity.CustomLabelText=e.signature,l.Entity.TextWidth=e.textwidth,l.Entity.Signature=e.signature,l.Entity.Name=w,l.Entity.TimeStamp=e.timestamp,isFinite(e.scaling)||(e.scaling=1),0==e.scaling&&(e.scaling=1),isNaN(e.scaling)&&(e.scaling=1),l.Entity.Scaling=e.scaling,null!=e.loadscaling&&(l.Entity.LoadScaling=e.loadscaling),l.Entity.Printscale=e.printscale;var k=isFinite(e.xoffset),D=isFinite(e.yoffset);k||(e.xoffset=0),D||(e.yoffset=0),isNaN(e.xoffset)&&(e.xoffset=0),isNaN(e.yoffset)&&(e.yoffset=0),g&&(a.usepdfjs||a.usevectorxml)?(l.Entity.Xoffset=e.xoffset/r,l.Entity.Yoffset=e.yoffset/r):(l.Entity.Xoffset=e.xoffset,l.Entity.Yoffset=e.yoffset);var C=e.linewidth,R=e.linewidthSegment;if(g)if(a.usepdfjs||a.usevectorxml)if(y)l.Entity.LineWidth=1;else if(e.bUseFixedScale){var P=C/n,S=R/n;l.Entity.LineWidth=P,l.Entity.LineWidthSegment=S}else l.Entity.LineWidth=C/r,l.Entity.LineWidthSegment=R/r;else y?l.Entity.LineWidth=1:e.bUseFixedScale?(P=C/n,S=R/n,l.Entity.LineWidth=P,l.Entity.LineWidthSegment=S):(l.Entity.LineWidth=C/o,l.Entity.LineWidthSegment=R/o);var M=e.arrowlength-e.linewidth;if(l.Entity.ArrowSize=M,l.Entity.LineStyle=e.linestyle,l.Entity.MainImageScaling=a.MainImageScaling,l.Entity.MainImageOffsetX=a.MainImageOffsetX,l.Entity.MainImageOffsetY=a.MainImageOffsetY,l.Entity.DocScale=e.docdscale,l.Entity.DocOffsetX=e.docdx,l.Entity.DocOffsetY=e.docdy,g){var T=1==e.type&&6==e.subtype;if(0==e.type||T){if(0!=e.pointlist.length){l.Entity.Line=[];for(var E=0;E<e.pointlist.length;E++)for(l.Entity.Line.push({Point:[]}),F=0;F<e.pointlist[E].length;F++)a.usepdfjs||a.usevectorxml?(I=(e.pointlist[E][F].x-e.xoffset)/r,j=(e.pointlist[E][F].y-e.yoffset)/r,l.Entity.Line[E].Point.push({x:I,y:j})):(I=(e.pointlist[E][F].x-e.xoffset)/o,j=(e.pointlist[E][F].y-e.yoffset)/o,l.Entity.Line[E].Point.push({x:I,y:j}))}}else if(-1!=e.points.length)for(var F=0;F<e.points.length;F++)if(a.usepdfjs||a.usevectorxml){var I=(e.points[F].x-e.xoffset)/r,j=(e.points[F].y-e.yoffset)/r;l.Entity.Points.Point.push({x:I,y:j})}else I=(e.points[F].x-e.xoffset)/o,j=(e.points[F].y-e.yoffset)/o,l.Entity.Points.Point.push({x:I,y:j})}else if(0!=e.type){if(-1!=e.points.length)for(F=0;F<e.points.length;F++)l.Entity.Points.Point.push({x:e.points[F].x,y:e.points[F].y})}else if(0!=e.pointlist.length)for(l.Entity.Line=[],E=0;E<e.pointlist.length;E++)for(l.Entity.Line.push({Point:[]}),F=0;F<e.pointlist[E].length;F++)l.Entity.Line[F].Point.push({x:e.pointlist[E][F].x,y:e.pointlist[E][F].y});if(g){if(13==e.type&&-1!=e.countshapes.length){var A=e.outerRadius,O=e.innerRadius;if(a.usepdfjs||a.usevectorxml)if(e.bUseFixedScale){var L=A/n,V=O/n;l.Entity.outerRadius=L,l.Entity.innerRadius=V}else l.Entity.outerRadius=A/r,l.Entity.innerRadius=O/r;else e.bUseFixedScale?(L=A/n,V=O/n,l.Entity.outerRadius=L,l.Entity.innerRadius=V):(l.Entity.outerRadius=A/o,l.Entity.innerRadius=O/o);for(F=0;F<e.countshapes.length;F++)a.usepdfjs||a.usevectorxml?(I=(e.countshapes[F].x-e.xoffset)/r,j=(e.countshapes[F].y-e.yoffset)/r,l.Entity.Points.Point.push({x:I,y:j})):(I=(e.countshapes[F].x-e.xoffset)/o,j=(e.countshapes[F].y-e.yoffset)/o,l.Entity.Points.Point.push({x:I,y:j}))}if(14==e.type){var N=e.startX,B=e.startY,U=e.secondX,G=e.secondY,z=e.endX,H=e.endY;a.usepdfjs||a.usevectorxml?(N=(N-e.xoffset)/r,B=(B-e.yoffset)/r,U=(U-e.xoffset)/r,G=(G-e.yoffset)/r,z=(z-e.xoffset)/r,H=(H-e.yoffset)/r):(N=(N-e.xoffset)/o/mainimagescale,B=(B-e.yoffset)/o/mainimagescale,U=(U-e.xoffset)/o/mainimagescale,G=(G-e.yoffset)/o/mainimagescale,z=(z-e.xoffset)/o/mainimagescale,H=(H-e.yoffset)/o/mainimagescale),l.Entity.startX=N,l.Entity.startY=B,l.Entity.secondX=U,l.Entity.secondY=G,l.Entity.endX=z,l.Entity.endY=H}}else{if(13==e.type&&-1!=e.countshapes.length)for(A=e.outerRadius,O=e.innerRadius,l.Entity.outerRadius=A,l.Entity.innerRadius=O,F=0;F<e.countshapes.length;F++)l.Entity.Points.Point.push({x:e.countshapes[F].x,y:e.countshapes[F].y});14==e.type&&(N=e.startX,B=e.startY,U=e.secondX,G=e.secondY,z=e.endX,H=e.endY,l.Entity.startX=N,l.Entity.startY=B,l.Entity.secondX=U,l.Entity.secondY=G,l.Entity.endX=z,l.Entity.endY=H)}7==e.type&&(g&&(a.usepdfjs||a.usevectorxml)?l.Entity.LeaderLineOffset=e.leaderoffset/r:l.Entity.LeaderLineOffset=e.leaderoffset),8==e.type&&(g&&(a.usepdfjs||a.usevectorxml)?(l.Entity.LabelOffsetX=e.labeloffsetx/r,l.Entity.LabelOffsetY=e.labeloffsety/r):(l.Entity.LabelOffsetX=e.labeloffsetx,l.Entity.LabelOffsetY=e.labeloffsety),l.Entity.LabelColor=e.labelfillcolor);var _=isFinite(e.x),W=isFinite(e.y),X=isFinite(e.w),Y=isFinite(e.h);if(_||(e.x=0),W||(e.y=0),X||(e.w=100),Y||(e.h=100),isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.w)&&(e.w=100),isNaN(e.h)&&(e.h=100),g)if(a.usepdfjs||a.usevectorxml){var q=(e.x-e.xoffset)/r,Z=(e.y-e.yoffset)/r,J=4==e.type&&e.subtype;if(0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||J)var K=(e.w-e.xoffset)/r,$=(e.h-e.yoffset)/r;else 9==e.type&&0==e.subtype?(K=e.w/r,$=e.textheight/r):10==e.type&&e.bUseFixedScale?(K=e.w/n,$=e.h/n):(K=e.w/r,$=e.h/r);var Q=isFinite(q),ee=isFinite(Z),te=isFinite(K),ae=isFinite($);Q||(q=0),ee||(Z=0),te||(K=100),ae||($=100),isNaN(q)&&(q=0),isNaN(Z)&&(Z=0),isNaN(K)&&(K=100),isNaN($)&&($=100),l.Entity.Rect={x:q,y:Z,w:K,h:$}}else q=(e.x-e.xoffset)/o,Z=(e.y-e.yoffset)/o,J=4==e.type&&e.subtype,0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||J?(K=(e.w-e.xoffset)/o,$=(e.h-e.yoffset)/o):9==e.type&&0==e.subtype?(K=e.w/o,$=e.textheight/o):10==e.type&&e.bUseFixedScale?(K=e.w/n,$=e.h/n):(K=e.w/o,$=e.h/o),(Q=isFinite(q))||(q=0),(ee=isFinite(Z))||(Z=0),(te=isFinite(K))||(K=100),(ae=isFinite($))||($=100),isNaN(q)&&(q=0),isNaN(Z)&&(Z=0),isNaN(K)&&(K=100),isNaN($)&&($=100),l.Entity.Rect={x:q,y:Z,w:K,h:$};else l.Entity.Rect={x:e.x,y:e.y,w:e.w,h:e.h};if(e.customattributes.length>0)for(var ie={tagname:null,tagvalue:null},se=0;se<e.customattributes.length;se++){var re=e.customattributes[se].name,ne=e.customattributes[se].value;ie.tagname=re,ie.tagvalue=ne,l.Entity.Extended.push(ie)}if(e.comments.length>0)for(se=0;se<e.comments.length;se++){var oe={id:e.comments[se].id,signature:e.comments[se].signature,value:e.comments[se].value};oe.signature=e.comments[se].signature,oe.value=e.comments[se].value,null!=e.comments[se].timestamp&&(oe.timestamp=e.comments[se].timestamp),l.Entity.Comments.push(oe)}}}return JSON.stringify(l)}function th(e,t,a,i,s){(new Date).getTime();var r=1,n=1,o=1,l=1,c=void 0;if(null!=e&&!e.pdfannotproxy){var h=null;s||e.bisTextArrow&&null!=e.textBoxConnected&&(h=th(e,t,a,i,!0),e=e.textBoxConnected);var d=e.pagenumber,p=t.getThumb(d),u=null!=i,g=e.viewname,f=e.isdrawn();if(u){if(i.usepdfjs||i.usevectorxml?r=e.scaling:o=e.scaling,n=i.fixedScale,l=i.MainImageScaling,1==n)if(0==i.pdfpageheight&&0==i.pdfpagewidth);else{var m=Te/i.pdfpageheight,y=Me/i.pdfpagewidth;n=Math.min(y,m)}isFinite(r)||(r=1),isFinite(n)||(n=1),0==r&&(r=1),isNaN(r)&&(r=1),null==n&&(n=1),isNaN(n)&&(n=1),0==n&&(n=1);var v=3==e.type&&4==e.subtype;if((c=a.createElement("Entity")).setAttribute("ID",e.markupnumber),11==e.type||20==e.type){var x=function(e,t,a){var i=e.ownerDocument.createElement(t);return i.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(i),i}(c,"Image",zn(e.image));x.setAttribute("type","png"),x.setAttribute("encoding","base64"),e.svgContent&&Qc(c,"SvgContent",e.svgContent)}Qc(c,"UniqueID",e.uniqueID),11!=e.type&&20!=e.type||""==e.imagehref||Qc(c,"Imagehref",e.imagehref),Qc(c,"Type",e.type),Qc(c,"Subtype",e.subtype),Qc(c,"Alternative",e.alternative),Qc(c,"Redaction",e.bRedact?1:0),Qc(c,"Layer",e.layer),Qc(c,"Rotation",e.rotation),Qc(c,"TextRotation",e.textrotate),Qc(c,"PageRotation",e.pagerotation),Qc(c,"FileName",e.documentName),Qc(c,"Layout",i.LayoutName),Qc(c,"View",d),null!=g&&(Qc(c,"ViewName3D",g),Qc(c,"For3DView",e.bfor3D?1:0),Qc(c,"PageHeight3D",e.pageheight),Qc(c,"PageWidth3D",e.pagewidth)),Qc(c,"ViewName",p.PageName),Qc(c,"Handle",e.markupnumber),null==e.fillcolor&&(e.fillcolor="rgba(255, 0, 0, 1)"),Qc(c,"FillColor",e.fillcolor),null==e.strokecolor&&(e.strokecolor="rgba(255, 0, 0, 1)"),Qc(c,"LineColor",v?e.fillcolor:e.strokecolor),Qc(c,"TextColor",e.textcolor),Qc(c,"Transparency",e.transparency),Qc(c,"Consolidated",e.consolidated?1:0),Qc(c,"HaveLink",e.bhaveLink?1:0),Qc(c,"HaveLeader",e.bhasArrow?1:0),e.bhasArrow&&null!=e.markupArrowConnected&&(Qc(c,"LeaderReference",e.markupArrowConnected.markupnumber),null!=h&&c.appendChild(h));var b=null;if(e.holes.length>0)for(var w=0;w<e.holes.length;w++)b=th(e.holes[w],t,a,i,!1),Qc(c,"Hole",e.holes[w].markupnumber),null!=b&&c.appendChild(b);Qc(c,"FixedScale",e.bUseFixedScale?1:0),Qc(c,"LineStyleScale",n),Qc(c,"FixedScaleFactor",e.fixedscaleFactor),Qc(c,"LinkURL",e.linkURL);var k=a.createElement("Font");k.setAttribute("facename",e.font.fontName),f?i.usepdfjs||i.usevectorxml?12!=e.type&&e.bUseFixedScale?k.setAttribute("height",e.font.height/n):k.setAttribute("height",e.font.height/r):12!=e.type&&e.bUseFixedScale?k.setAttribute("height",e.font.height/n):k.setAttribute("height",e.font.height/o/l):k.setAttribute("height",e.font.height),k.setAttribute("bold",e.font.bold?1:0),k.setAttribute("italic",e.font.italic?1:0),c.appendChild(k),Qc(c,"Text",""==e.text?".":e.text),Qc(c,"Status",e.status),Qc(c,"SmallText",""==e.smalltext?".":e.smalltext),Qc(c,"DimText",""==e.dimtext?".":e.dimtext),Qc(c,"CustomLabelOn",e.busecustomlabel?1:0),Qc(c,"CustomLabelText",""==e.customlabeltext?".":e.customlabeltext),Qc(c,"TextWidth",e.textwidth),Qc(c,"Signature",e.signature),Qc(c,"Name",Kn(e.signature)),Qc(c,"TimeStamp",e.timestamp),isFinite(e.scaling)||(e.scaling=1),0==e.scaling&&(e.scaling=1),isNaN(e.scaling)&&(e.scaling=1),Qc(c,"Scaling",e.scaling),null!=e.loadscaling&&Qc(c,"LoadScaling",e.scaling),Qc(c,"Printscale",e.printscale);var D=isFinite(e.xoffset),C=isFinite(e.yoffset);D||(e.xoffset=0),C||(e.yoffset=0),isNaN(e.xoffset)&&(e.xoffset=0),isNaN(e.yoffset)&&(e.yoffset=0),f&&(i.usepdfjs||i.usevectorxml)?(Qc(c,"Xoffset",e.xoffset/r),Qc(c,"Yoffset",e.yoffset/r)):(Qc(c,"Xoffset",e.xoffset),Qc(c,"Yoffset",e.yoffset));var R=e.linewidth,P=e.linewidthSegment;if(f)if(i.usepdfjs||i.usevectorxml)if(v)Qc(c,"LineWidth",1);else if(e.bUseFixedScale){var S=R/n,M=P/n;Qc(c,"LineWidth",S),Qc(c,"LineWidthSegment",M)}else Qc(c,"LineWidth",R/r),Qc(c,"LineWidthSegment",P/r);else v?Qc(c,"LineWidth",1):e.bUseFixedScale?(M=P/n,Qc(c,"LineWidth",S=R/n),Qc(c,"LineWidthSegment",M)):(Qc(c,"LineWidth",R/o/l),Qc(c,"LineWidthSegment",P/o/l));else Qc(c,"LineWidth",R),Qc(c,"LineWidthSegment",P);Qc(c,"ArrowSize",e.arrowlength-e.linewidth),Qc(c,"LineStyle",e.linestyle),Qc(c,"MainImageScaling",i.MainImageScaling),Qc(c,"MainImageOffsetX",i.MainImageOffsetX),Qc(c,"MainImageOffsetY",i.MainImageOffsetY),Qc(c,"DocScale",e.docdscale),Qc(c,"DocOffsetX",e.docdx),Qc(c,"DocOffsetY",e.docdy),Qc(c,"HasScale",e.hasScale);var T=i.scaleObject;if(e.hasScale&&(T=e.scaleObject),Qc(c,"Measurescale",T.measurescale),Qc(c,"ScaleLabel",T.scaleLabel),Qc(c,"Unitofmeasure",T.Unitofmeasure),Qc(c,"SubmeasureUnit",T.SubmeasureUnit),Qc(c,"Unitlabel",T.Unitlabel),Qc(c,"AreaUnitlabel",T.AreaUnitlabel),Qc(c,"Unitscale",T.unitscale),Qc(c,"ScaleValue",T.scaleValue),Qc(c,"Ndimprecision",T.ndimprecision),f){var E=1==e.type&&6==e.subtype;if(0==e.type||E){if(0!=e.pointlist.length)for(var F=0;F<e.pointlist.length;F++){var I=a.createElement("Line");for(A=0;A<e.pointlist[F].length;A++)O=a.createElement("Point"),i.usepdfjs||i.usevectorxml?(L=(e.pointlist[F][A].x-e.xoffset)/r,V=(e.pointlist[F][A].y-e.yoffset)/r,O.setAttribute("x",L),O.setAttribute("y",V)):(L=(e.pointlist[F][A].x-e.xoffset)/o/l,V=(e.pointlist[F][A].y-e.yoffset)/o/l,O.setAttribute("x",L),O.setAttribute("y",V)),I.appendChild(O);c.appendChild(I)}}else if(-1!=e.points.length){for(var j=a.createElement("Points"),A=0;A<e.points.length;A++){var O=a.createElement("Point");if(i.usepdfjs||i.usevectorxml){var L=(e.points[A].x-e.xoffset)/r,V=(e.points[A].y-e.yoffset)/r;O.setAttribute("x",L),O.setAttribute("y",V)}else L=(e.points[A].x-e.xoffset)/o/l,V=(e.points[A].y-e.yoffset)/o/l,O.setAttribute("x",L),O.setAttribute("y",V);j.appendChild(O)}c.appendChild(j)}}else if(0!=e.type){if(-1!=e.points.length){for(j=a.createElement("Points"),A=0;A<e.points.length;A++)(O=a.createElement("Point")).setAttribute("x",e.points[A].x),O.setAttribute("y",e.points[A].y),j.appendChild(O);c.appendChild(j)}}else if(0!=e.pointlist.length)for(F=0;F<e.pointlist.length;F++){for(I=a.createElement("Line"),A=0;A<e.pointlist[F].length;A++)(O=a.createElement("Point")).setAttribute("x",e.pointlist[F][A].x),O.setAttribute("y",e.pointlist[F][A].y),I.appendChild(O);c.appendChild(I)}if(f){if(13==e.type&&-1!=e.countshapes.length){var N=e.outerRadius,B=e.innerRadius;if(i.usepdfjs||i.usevectorxml)if(e.bUseFixedScale){var U=N/n,G=B/n;Qc(c,"outerRadius",U),Qc(c,"innerRadius",G)}else Qc(c,"outerRadius",N/r),Qc(c,"innerRadius",B/r);else e.bUseFixedScale?(G=B/n,Qc(c,"outerRadius",U=N/n),Qc(c,"innerRadius",G)):(Qc(c,"outerRadius",N/o/l),Qc(c,"innerRadius",B/o/l));for(A=0;A<e.countshapes.length;A++)O=a.createElement("Point"),i.usepdfjs||i.usevectorxml?(L=(e.countshapes[A].x-e.xoffset)/r,V=(e.countshapes[A].y-e.yoffset)/r,O.setAttribute("x",L),O.setAttribute("y",V)):(L=(e.countshapes[A].x-e.xoffset)/o/l,V=(e.countshapes[A].y-e.yoffset)/o/l,O.setAttribute("x",L),O.setAttribute("y",V)),j.appendChild(O);c.appendChild(j)}if(14==e.type){var z=e.startX,H=e.startY,_=e.secondX,W=e.secondY,X=e.endX,Y=e.endY;i.usepdfjs||i.usevectorxml?e.bUseFixedScale?(H/=n,Qc(c,"startX",z/=n),Qc(c,"startY",H),W/=n,Qc(c,"secondX",_/=n),Qc(c,"secondY",W),Y/=n,Qc(c,"endX",X/=n),Qc(c,"endY",Y)):(Qc(c,"startX",z/r),Qc(c,"startY",H/r),Qc(c,"secondX",_/r),Qc(c,"secondY",W/r),Qc(c,"endX",X/r),Qc(c,"endY",Y/r)):e.bUseFixedScale?(Qc(c,"startX",z/n),Qc(c,"startY",H/n),Qc(c,"secondX",_/n),Qc(c,"secondY",W/n),Qc(c,"endX",X/n),Qc(c,"endY",Y/n)):(Qc(c,"startX",z/o/l),Qc(c,"startY",H/o/l),Qc(c,"secondX",_/o/l),Qc(c,"secondY",W/o/l),Qc(c,"endX",X/o/l),Qc(c,"endY",Y/o/l))}}else{if(13==e.type&&-1!=e.countshapes.length){for(N=e.outerRadius,B=e.innerRadius,Qc(c,"outerRadius",N),Qc(c,"innerRadius",B),A=0;A<e.countshapes.length;A++)(O=a.createElement("Point")).setAttribute("x",e.countshapes[A].x),O.setAttribute("y",e.countshapes[A].y),j.appendChild(O);c.appendChild(j)}14==e.type&&(z=e.startX,H=e.startY,_=e.secondX,W=e.secondY,X=e.endX,Y=e.endY,Qc(c,"startX",z),Qc(c,"startY",H),Qc(c,"secondX",_),Qc(c,"secondY",W),Qc(c,"endX",X),Qc(c,"endY",Y))}7==e.type&&(f&&(i.usepdfjs||i.usevectorxml)?Qc(c,"LeaderLineOffset",e.leaderoffset/r):Qc(c,"LeaderLineOffset",e.leaderoffset)),8==e.type&&(f&&(i.usepdfjs||i.usevectorxml)?(Qc(c,"LabelOffsetX",e.labeloffsetx/r),Qc(c,"LabelOffsetY",e.labeloffsety/r)):(Qc(c,"LabelOffsetX",e.labeloffsetx),Qc(c,"LabelOffsetY",e.labeloffsety)),Qc(c,"LabelColor",e.labelfillcolor));var q=a.createElement("Rect"),Z=isFinite(e.x),J=isFinite(e.y),K=isFinite(e.w),$=isFinite(e.h);if(Z||(e.x=0),J||(e.y=0),K||(e.w=100),$||(e.h=100),isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.w)&&(e.w=100),isNaN(e.h)&&(e.h=100),f)if(i.usepdfjs||i.usevectorxml){var Q=(e.x-e.xoffset)/r,ee=(e.y-e.yoffset)/r,te=4==e.type&&e.subtype;if(0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||te)var ae=(e.w-e.xoffset)/r,ie=(e.h-e.yoffset)/r;else 9==e.type&&0==e.subtype?(ae=e.w/r,ie=e.textheight/r):10==e.type&&e.bUseFixedScale?(ae=e.w/n,ie=e.h/n):(ae=e.w/r,ie=e.h/r);var se=isFinite(Q),re=isFinite(ee),ne=isFinite(ae),oe=isFinite(ie);se||(Q=0),re||(ee=0),ne||(ae=100),oe||(ie=100),isNaN(Q)&&(Q=0),isNaN(ee)&&(ee=0),isNaN(ae)&&(ae=100),isNaN(ie)&&(ie=100),q.setAttribute("x",Q),q.setAttribute("y",ee),q.setAttribute("w",ae),q.setAttribute("h",ie)}else Q=(e.x-e.xoffset)/o/l,ee=(e.y-e.yoffset)/o/l,te=4==e.type&&e.subtype,0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||te?(ae=(e.w-e.xoffset)/o/l,ie=(e.h-e.yoffset)/o/l):9==e.type&&0==e.subtype?(ae=e.w/o/l,ie=e.textheight/o/l):10==e.type&&e.bUseFixedScale?(ae=e.w/n,ie=e.h/n):(ae=e.w/o/l,ie=e.h/o/l),(se=isFinite(Q))||(Q=0),(re=isFinite(ee))||(ee=0),(ne=isFinite(ae))||(ae=100),(oe=isFinite(ie))||(ie=100),isNaN(Q)&&(Q=0),isNaN(ee)&&(ee=0),isNaN(ae)&&(ae=100),isNaN(ie)&&(ie=100),q.setAttribute("x",Q),q.setAttribute("y",ee),q.setAttribute("w",ae),q.setAttribute("h",ie);else q.setAttribute("x",e.x),q.setAttribute("y",e.y),q.setAttribute("w",e.w),q.setAttribute("h",e.h);if(c.appendChild(q),e.customattributes.length>0){for(var le=a.createElement("Extended"),ce=0;ce<e.customattributes.length;ce++)Qc(le,pe=e.customattributes[ce].name,e.customattributes[ce].value);c.appendChild(le)}if(e.comments.length>0){var he=a.createElement("Comments"),de=[];for(ce=0;ce<e.comments.length;ce++){var pe="id_"+e.comments[ce].id,ue={name:"Signature",value:e.comments[ce].signature};if(de.push(ue),null!=e.comments[ce].timestamp){var ge={name:"Time",value:e.comments[ce].timestamp};de.push(ge)}$c(he,pe,e.comments[ce].value,de)}c.appendChild(he)}}}return c}function ah(e,t,a,i,s,r){if(!yd()){var n=[],o=0;if((new Date).getTime(),hn.markuplist.length>0)for(o=0;o<hn.markuplist.length;o++)if(null!=hn.markuplist[o]&&!hn.markuplist[o].pdfannotproxy){var l=hn.markuplist[o].pagenumber,c=hn.getPageObject(l),h=null!=c;if((hn.markuplist[o].signature==i||a)&&(hn.markuplist[o].display||e)&&(hn.markuplist[o].consolidated||!t)){var d=8==hn.markuplist[o].type&&2==hn.markuplist[o].subtype;if(h){if(hn.markuplist[o].bhasArrow&&null!=hn.markuplist[o].markupArrowConnected);else if(d);else var p=JSON.parse(eh(hn.markuplist[o],hn,c,!1));null!=p&&n.push(p)}else null!=r&&r.addpage(l)}}return JSON.stringify(n)}}function ih(e,t,a,i,s,r){if(yd())return;var n=0,o=((new Date).getTime(),'<?xml version="1.0" encoding="UTF-8"?>\n');o+="<RasterexMarkup>\n",o+="<Header>\n",o+="<FileVersion>C370</FileVersion>\n",hn.getCurrentpage().usepdfjs?o+="<Format>pdfjs</Format>\n":hn.getCurrentpage().usevectorxml?o+="<Format>vector</Format>\n":hn.getCurrentpage().usevector3Dxml?(null!=hn.getCurrentpage().get3DMarkupJSON()&&(o+="<Markup3D>"+hn.getMarkup3DSavefile()+"</Markup3D>\n"),null!=hn.getCurrentpage().get3DCamerasJSON()&&(o+="<Views3D>"+hn.getViews3DSavefile()+"</Views3D>\n"),o+="<Format>3D</Format>\n"):o+="<Format>image</Format>\n",o+="<Scale>1.0000</Scale>\n",o+="<OrigoX>0.0000</OrigoX>\n",o+="<OrigoY>0.0000</OrigoY>\n",o+="<DirectionY>1</DirectionY>\n",o+="<DirectionX>1</DirectionX>\n",o+="</Header>\n",o+="<Users>\n",o+="<User>\n",o+="<ID>"+i+"</ID>\n",o+="<Name>"+s+"</Name>\n",o+="<Color>"+Pr+"</Color>\n",o+="<Layer>"+Rr+"</Layer>\n",o+="</User>\n",o+="</Users>\n",o+="<Scales/>\n";var l=So(o+="<Entities/></RasterexMarkup>\n");if(hn.markuplist.length>0)for(n=0;n<hn.markuplist.length;n++)if(null!=hn.markuplist[n]){var c=hn.markuplist[n].pagenumber,h=hn.getPageObject(c),d=null!=h;if((hn.markuplist[n].signature==i||a)&&(hn.markuplist[n].display||e)&&(hn.markuplist[n].consolidated||!t)){var p=8==hn.markuplist[n].type&&2==hn.markuplist[n].subtype;if(d){if(hn.markuplist[n].bhasArrow&&null!=hn.markuplist[n].markupArrowConnected);else if(p);else var u=th(hn.markuplist[n],hn,l,h,!1);null!=u&&l.getElementsByTagName("Entities")[0].appendChild(u)}else null!=r&&r.addpage(c)}}const g=hn.scalesOptions;if(g.length>0)for(var f=0;f<g.length;f++){var m=l.createElement("ScaleItem");Qc(m,"PrecisionValue",g[f].presisionValue),Qc(m,"Value",g[f].value),Qc(m,"Label",g[f].label),Qc(m,"Metric",g[f].metric),Qc(m,"MetricUnit",g[f].metricUnit),Qc(m,"DimPrecision",g[f].dimPrecision),Qc(m,"IsSelected",g[f].isSelected),l.getElementsByTagName("Scales")[0].appendChild(m)}return l}function sh(e,t,a){(new Date).getTime();var i=So('<?xml version="1.0" encoding="UTF-8"?>\n<RasterexMarkup>\n<FileVersion>C370</FileVersion>\n<Entities/></RasterexMarkup>\n');if(null!=e){var s=t.getPageObject(e.pagenumber);if(e.bhasArrow&&null!=e.markupArrowConnected);else{var r=th(e,t,i,s,!1);null!=r&&i.getElementsByTagName("Entities")[0].appendChild(r)}}return i}function rh(e,t,a,i){if(null!=hn&&null!=hn){var s=Ho(hn.OriginalURL);if(Oi)var r=e;else r=e+"&"+s+"&"+t;Fh("POST",r,"",i).then((function(e){Jr&&(hn.markuplist=[],yp(),mp(),hn.nummarkups=0,Xc("")),hn&&(hn.bMarkupchanged=!1,hn.getdelayedClose()&&(hn.setdelayedClose(!1),Qd())),null!=Ra&&Ra.markupSaved(),hn&&function(e,t){_o(t.FileName);var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetMarkup</Command>",a+="<LicenseID>"+os+"</LicenseID>",a+="<FileURL>"+e+"</FileURL>",Eh("POST",P,a+="</RxViewServer>").then((function(e){var t=0,a=[],i=0,s=e.getElementsByTagName("File");for(i=0;i<s.length;i++)t=s[i].firstChild.nodeValue,he?(t=fe+t,a.push(t)):(t=Q+t,a.push(t));null!=Ma&&Ma.markupPaths(a)})).catch((function(e){fd(e)}))}(Wo(hn.OriginalURL),hn)})).catch((function(e){e.status?404==e.status?console.log("post of markup to server failed error 404"):503==e.status&&console.log("post of markup to server failed error 503"):console.log(e)}))}}function nh(e,t,a){var i=new wn(hn);i.setOncomplete((function(a){rh(e,t,0,a)})),i.createxml(t,a)}function oh(e,t,a){if(!yd()){if(hn.getCurrentpage().usevector3Dxml){var i=hn.getMarkup3DSavefile(),s=hn.getViews3DSavefile();null==i&&hn.setMarkup3DSavefile("markup.json"),null==s&&hn.setViews3DSavefile("views.json");var r=Ho(hn.OriginalURL);i=r+hn.getMarkup3DSavefile(),s=r+hn.getViews3DSavefile(),function(e,t){var a="";yd()||(hn.getCurrentpage().usevector3Dxml&&(a=hn.getCurrentpage().get3DMarkupJSON()),Fh("POST",e+"&"+t,"",a).then((function(e){})).catch((function(e){e.status?404==e.status?console.log("post of 3D markup failed error 404"):503==e.status&&console.log("post of 3D markup failed error 503"):console.log(e)})))}(j,i),function(e,t){var a="";yd()||(hn.getCurrentpage().usevector3Dxml&&(a=hn.getCurrentpage().get3DCamerasJSON()),Fh("POST",e+"&"+t,"",a).then((function(e){})).catch((function(e){e.status?404==e.status?console.log("Post of 3D views failed error 404"):503==e.status&&console.log("Post of 3D views failed error 503"):console.log(e)})))}(j,s)}rh(e,t,0,ih(!0,!1,!1,t,a))}}function lh(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetConfiguration</Command>",t+="<LicenseID>"+os+"</LicenseID>",t+=en?"<CallingPageUrl>"+ee+tn+"</CallingPageUrl>":"<CallingPageUrl>"+ee+"</CallingPageUrl>",t+="</RxViewServer>",pe?Eh("GET",e).then((function(e){iu(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)})):Eh("POST",e,t).then((function(e){iu(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)}))}function ch(e,t,a){"undefined"!=typeof Storage&&(a?(localStorage.setItem("User",t),localStorage.setItem("UserName",t)):(localStorage.setItem("User",Fr),localStorage.setItem("UserName",Kn(Fr)),dh("User").then(()=>{!async function(e){const t=(await dh(e.store)).transaction(e.store,"readwrite"),a=t.objectStore(e.store).add({fileData:e});a.onsuccess=function(){console.log("Data successfully saved to IndexedDB!")},a.onerror=function(e){console.error("Error saving data to IndexedDB: ",e.target.errorCode)}}({store:"User",User:Fr,UserName:Kn(Fr)})}).catch(e=>console.error("Error opening database:",e))))}function hh(e){"undefined"!=typeof Storage&&localStorage.setItem("RxLic",e)}async function dh(e){return new Promise((t,a)=>{const i=indexedDB.open("myAppDatabase",1);i.onupgradeneeded=function(t){const a=t.target.result;if(!a.objectStoreNames.contains(e))if("Rxlic"===e)a.createObjectStore(e,{keyPath:"id",autoIncrement:!0}).createIndex("Rxlic","Rxlic",{unique:!1});else if("User"===e){const t=a.createObjectStore(e,{keyPath:"id",autoIncrement:!0});t.createIndex("User","User",{unique:!1}),t.createIndex("UserName","UserName",{unique:!1})}},i.onsuccess=function(e){t(e.target.result)},i.onerror=function(e){a("Database error: "+e.target.errorCode)}})}function ph(){if(Ci)var e=S+"&RxView360&2.0&"+Fr+"&"+ci;else e=M+"&RxView360"+ls+"&2.0&"+Fr;if("bypass"==ls)return os=50942768,void(wi=!0);Fh("GET",e,"").then((function(e){var t=e.split(":");if("OK"==t[0]){var a=t[1].split(",");hh(os=a[0]),wi=!0,au()}else alert(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)}))}function uh(e,t){Fh("GET",T+"&"+e,"").then((function(e){wi=!1,t&&ph()})).catch((function(e){e.status||console.log(e)}))}function gh(){return ns}function fh(){return ss}function mh(){return rs}function yh(){return w}function vh(){for(var e=!0,t=0;t<Qi.length;t++)Qi[t]||(e=!1);e&&ts&&(ts=!1,window.onafterprint=()=>{bh(),window.onafterprint=null,null!=_a&&_a.printpageComplete()},window.print())}function xh(e){es[e.pagenumber]=document.createElement("img"),es[e.pagenumber].src=e.paperimage.toDataURL(),es[e.pagenumber].addEventListener("load",(function(t){try{$i[e.pagenumber].drawImage(es[e.pagenumber],0,0)}catch(e){console.log(e.message)}Qi[e.pagenumber]=!0,vh()}),!1)}function bh(){if(null!=De){for(;De.firstChild;)De.removeChild(De.lastChild);$i=[],Qi=[],es=[]}}function wh(e){!function(){if(ts=!0,null!=De&&null!=uu().docObj){bh();try{rs=uu().getPaperHeight()}catch(e){rs=3480}try{ss=uu().getPaperWidth()}catch(e){ss=2460}try{ns=uu().getPrintRect()}catch(e){ns=void 0}for(var e={width:ss,height:rs,printrect:ns},t=e.width/25.4*96+"px",a=e.height/25.4*96+"px",i=e.width/25.4*300,s=e.height/25.4*300,r=uu().docObj.pages.length,n=0;n<r;n++){var o=document.createElement("canvas");if(!o)return void alert("Error: I cannot create a new canvas element!");o.id="page"+n,o.width=i,o.height=s,o.style.width=t,o.style.height=a,De.appendChild(o),Qi[n]=!1;var l=o.getContext("2d");if(!l)return void alert("Error: failed to getContext!");$i.push(l)}uu().onPrintpage.connect(xh),uu().docObj.printDocument(e,!0)}}()}function kh(){null!=dn&&null!=dn.printref&&dn.printClose(),(0).focus(),(0).close()}function Dh(){n.drawImage(t,0,0),a.clearRect(0,0,t.width,t.height)}function Ch(e,t,a,i){var r=0,n=0,o=0;s.fillStyle="rgb(238,243,250)",s.fillRect(0,0,ti,ai),r=t,n=a,o=i,s.drawImage(e,r,n,hi*o,di*o)}function Rh(){ui=!0}function Ph(e,i,r){var o=e.usevector3DGLTF||e.usevector3Dbinary||e.usevector3Dxml,l=i.usevector3DGLTF||i.usevector3Dbinary||i.usevector3Dxml;if(!(o||l||e.usevectorbinarycompare||i.usevectorbinarycompare)){var c=!e.usevectorbinary&&!e.usevectorxml,h=!i.usevectorbinary&&!i.usevectorxml,d=e.usepdfjs,p=i.usepdfjs,u=e.DocRef.OriginalURL,g=i.DocRef.OriginalURL,f=e.DocRef.FileNameSRC+" "+i.DocRef.FileNameSRC,m=(e.DocRef.FileNameSRC,i.DocRef.FileNameSRC,e.DocRef.fileindex),y=e.pagenumber,v=i.DocRef.fileindex,x=i.pagenumber,b=decodeURI(e.Vector2DBinarySRC),w=decodeURI(i.Vector2DBinarySRC);if(c){var k=e.MainImageSRC,D=e.SmallImageSRC,C=e.MainImageWidth,R=e.MainImageHeight,P=e.MainImageScaling;e.SmallImageWidth,e.SmallImageHeight,e.SmallImageScaling}if(h){var S=i.MainImageSRC,M=i.SmallImageSRC,T=i.MainImageWidth,E=i.MainImageHeight,F=i.MainImageScaling;i.SmallImageWidth,i.SmallImageHeight,i.SmallImageScaling}if(d)var I=e.originalPDFwidth,j=e.originalPDFheight;if(p)var A=i.originalPDFwidth,O=i.originalPDFheight;var L='<?xml version="1.0" encoding="UTF-8"?>\n';L+="<RxViewServer>\n",L+="<NumLayouts>1</NumLayouts>\n",L+="<Version>1</Version>\n",L+="<Format>Compare</Format>\n",L+="<FileName>Compare</FileName>\n",L+="<OriginalURL>"+u+" "+g+"</OriginalURL>\n",L+="<FileNameSRC>"+f+"</FileNameSRC>\n",L+="<Filter>Composite</Filter>\n",L+="<FileSizeLow>89192</FileSizeLow>\n",L+="<FileSizeHigh>0</FileSizeHigh>\n",L+="<Type>5</Type>\n",L+="<Layout>\n",L+="<LayoutName>Default</LayoutName>\n",L+="</Layout>\n";var V=So(L+="</RxViewServer>\n"),N=V.createElement("NumPages"),B=V.createElement("Page"),U=V.createTextNode("1");N.appendChild(U),V.getElementsByTagName("RxViewServer")[0].appendChild(N),Qc(B,"PageName","Default"),Qc(B,"Compression","---"),Qc(B,"DPI","0.02540000"),Qc(B,"OffsetX","0.00000"),Qc(B,"OffsetY","0.00000"),Qc(B,"OriginalScale","1.00000"),Qc(B,"OriginalScale","1.00000"),Qc(B,"BckGrndDocindex",m),Qc(B,"BckGrndPageindex",y),Qc(B,"FrGrndDocindex",v),Qc(B,"FrGrndPageindex",x),Qc(B,"OverlayComparemode",r),null!=b&&Qc(B,"Vector2DBinarySRCBckGrnd",b),null!=w&&Qc(B,"Vector2DBinarySRCFrGrnd",w),k&&(Qc(B,"Vector2DImageSRCBckGrnd",k),D&&Qc(B,"Vector2DImageSRCBckGrndSmall",D)),S&&(Qc(B,"Vector2DImageSRCFrGrnd",S),M&&Qc(B,"Vector2DImageSRCFrGrndSmall",M)),c&&(Qc(B,"MainImageWidthBckGrnd",C),Qc(B,"MainImageHeightBckGrnd",R),Qc(B,"MainImageScalingBckGrnd",P),Qc(B,"MainImageOffsetXBckGrnd","0.00000000"),Qc(B,"MainImageOffsetYBckGrnd","0.00000000"),Qc(B,"SmallImageWidthBckGrnd",C),Qc(B,"SmallImageHeightBckGrnd",R)),h&&(Qc(B,"MainImageWidthFrGrnd",T),Qc(B,"MainImageHeightFrGrnd",E),Qc(B,"MainImageScalingFrGrnd",F),Qc(B,"MainImageOffsetXFrGrnd","0.00000000"),Qc(B,"MainImageOffsetYFrGrnd","0.00000000"),Qc(B,"SmallImageWidthFrGrnd",T),Qc(B,"SmallImageHeightFrGrnd",E)),d&&(Qc(B,"PDFBckGrnd",T),Qc(B,"PDFWidthBckGrnd",I),Qc(B,"PDFHeightBckGrnd",j)),p&&(Qc(B,"PDFFrGrnd",T),Qc(B,"PDFWidthFrGrnd",A),Qc(B,"PDFHeightFrGrnd",O)),V.getElementsByTagName("Layout")[0].appendChild(B),function(e){if(Ii=!1,wi){var i;null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp(),gi&&Li&&Qd(),null==hn||null==hn?(fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1)):(fn=yn.push(new Mc(e)),hn.enableTextSelect(!1),(hn=yn[fn-1]).setfileindex(fn-1)),yn[fn-1]=hn;for(var r=e.getElementsByTagName("Page"),o=0;o<r.length;o++)0==o?(i=new Sc(r[o],"Default",!0,"",o,hn),hn.addthumbnail(new bc(r[o],"Default",hn,o)),hn.addpage(i,!0)):(hn.addthumbnail(new bc(r[o],"Default",hn,o)),o<Ds?(i=new Sc(r[o],"Default",!1,"",o,hn),hn.addpage(i,!1)):hn.addpage(void 0,!1));if(md()){hn.pages[0].firstpage=!0,hn.bcompare=!0;var l={iscompare:!0,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"createCompareXML"};null!=Jt&&Jt.setGUIState(l);var c={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(c),null!=_e&&_e.loadComplete(hn.OriginalURL,hn.bActive),null!=la&&la.setDownload("hide")}}}(V)}}function Sh(e){var i='<?xml version="1.0" encoding="UTF-8"?>\n';i+="<RxViewServer>\n",i+="<NumLayouts>1</NumLayouts>\n",i+="<NumLayouts>1</NumLayouts>\n",i+="<Version>1</Version>\n",i+="<Format>IFC 2X3</Format>\n",i+="<FileName>"+e+"</FileName>\n",i+="<OriginalURL>"+e+"</OriginalURL>\n",i+="<FileNameSRC>"+e+"</FileNameSRC>\n",i+="<Filter>RxFilterIFC</Filter>\n",i+="<FileSizeLow>89192</FileSizeLow>\n",i+="<FileSizeHigh>0</FileSizeHigh>\n",i+="<Type>4</Type>\n",i+="<Layout>\n",i+="<LayoutName>Default</LayoutName>\n",i+="</Layout>\n";var r=So(i+="</RxViewServer>\n"),o=r.createElement("NumPages"),l=r.createElement("Page"),c=r.createTextNode("1");o.appendChild(c),r.getElementsByTagName("RxViewServer")[0].appendChild(o),Qc(l,"PageName","Default"),Qc(l,"Compression","---"),Qc(l,"DPI","0.02540000"),Qc(l,"OffsetX","0.00000"),Qc(l,"OffsetY","0.00000"),Qc(l,"OriginalScale","1.00000"),Qc(l,"VectorGLTF3DSRC",e),Qc(l,"MainImageWidth","0"),Qc(l,"MainImageHeight","0"),Qc(l,"MainImageScaling","1.00000000"),Qc(l,"MainImageOffsetX","0.00000000"),Qc(l,"MainImageOffsetY","0.00000000"),r.getElementsByTagName("Layout")[0].appendChild(l),function(e,i){if(Ii=!1,wi){var r;null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp(),gi&&Li&&Qd(),null==hn||null==hn?(fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1)):(fn=yn.push(new Mc(e)),hn.enableTextSelect(!1),(hn=yn[fn-1]).setfileindex(fn-1)),yn[fn-1]=hn;for(var o=e.getElementsByTagName("Page"),l=0;l<o.length;l++)0==l?(r=new Sc(o[l],"Default",!0,"",l,hn),hn.addthumbnail(new bc(o[l],"Default",hn,l)),hn.addpage(r,!0)):(hn.addthumbnail(new bc(o[l],"Default",hn,l)),l<Ds?(r=new Sc(o[l],"Default",!1,"",l,hn),hn.addpage(r,!1)):hn.addpage(void 0,!1));if(md()){hn.pages[0].firstpage=!0,hn.bglTF=!0;var c={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"createGLTFDirect"};null!=Jt&&Jt.setGUIState(c);var h={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(h),null!=_e&&_e.loadComplete(hn.OriginalURL,hn.bActive),null!=la&&la.setDownload("hide")}}}(r)}const Mh=function(e,t,a,i,s){const r=new XMLHttpRequest;r.withCredentials=ji;for(var n=0;n<i.length;n++)"progress"==i[n].event&&i[n].bupload?r.upload.addEventListener(i[n].event,i[n].func,!1):r.addEventListener(i[n].event,i[n].func,!1);try{r.open(e,t)}catch(e){reject("Error 1 - "+e)}try{r.responseType=a}catch(e){reject("Error 2 - "+e)}if(_r){var o=Th();o.authset&&r.setRequestHeader("Authorization",o.authString+o.baseuserstring)}s?r.send(s):r.send()};function Th(){var e={authString:"",baseuserstring:"",authset:!1};if(_r)if(e.authString=Yr+" ",Wr)e.baseuserstring=Xr,e.authset=!0;else{var t=qr;t+=":",t+=Zr,e.baseuserstring=window.btoa(t),e.authset=!0}return e}const Eh=function(e,t,a,i){return new Promise((function(s,r){const n=new XMLHttpRequest;n.withCredentials=ji;try{n.open(e,t)}catch(e){r("Error 1 - "+e)}try{n.responseType=""}catch(e){r("Error 2 - "+e)}if(_r){var o=Th();o.authset&&n.setRequestHeader("Authorization",o.authString+o.baseuserstring)}n.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=So(this.responseText)),an=this.getAllResponseHeaders(),null!=Za&&Za.setRespHeaders(an),null==t||null==t.documentElement?r("Unable to get XML"):s(t)}else r(this);if(i)for(var a=0;a<i.length;a++)"callback"==i[a].event&&i[a].func&&"function"==typeof i[a].func&&i[a].func(this)},n.onerror=function(e){r("Failed to connect to "+t)},n.addEventListener("progress",(function(e){if(e.lengthComputable){var t=e.loaded/e.total;if(i)for(var a=0;a<i.length;a++)"progressCallBack"==i[a].event&&i[a].func&&"function"==typeof i[a].func&&i[a].func(t)}}),!1),n.send(a)}))},Fh=function(e,t,a,i,s){return new Promise((function(r,n){const o=new XMLHttpRequest;if(o.open(e,t),_r){var l=Th();l.authset&&o.setRequestHeader("Authorization",l.authString+l.baseuserstring)}try{o.responseType=a}catch(e){n("Error 2 - "+e)}s&&o.setRequestHeader(s.name,s.value),o.onload=function(e){200==this.status?r(o.response):n(this)},o.onerror=function(e){n("Something went wrong")},i?o.send(i):o.send()}))};function Ih(e){e.lengthComputable&&null!=sa&&sa.setUpload(50)}function jh(e){e.lengthComputable&&null!=sa&&sa.setUpload(Math.round(100*e.loaded/e.total))}function Ah(e){e.lengthComputable&&null!=sa&&sa.setUpload(Math.round(100*e.loaded/e.total))}function Oh(e){null!=sa&&sa.setUpload(100),Fe.overridefilename=e.target.responseText,Oc(Fe)}function Lh(e){if(document.getElementById("fileToUpload"))var t=document.getElementById("fileToUpload").files[0];else null!=Ce&&(t=Ce);encodeURI(t.name);var a={filename:K+t.name,displayname:null,filenameonly:t.name.toLowerCase()};if(vr.push(a),hn)for(var i=0;i<vr.length;i++)vr[i].filenameonly==t.name.toLowerCase()&&Uc(vr[i],hn.fileindex)}function Vh(e){var t=document.getElementById("fileToUpload").files[0],a=encodeURIComponent(t.name),i=K+a;null!=sa&&sa.setUpload("hide"),null!=la&&la.setDownload("show"),null!=ra&&ra.setUpload(t.name),zc({filename:i,displayname:null}),eu("markupedit",{p1:!1})}function Nh(e){null!=sa&&sa.setUpload("hide"),alert("There was an error attempting to upload the file.")}function Bh(e){null!=sa&&sa.setUpload("hide"),alert("The upload has been canceled by the user or the browser dropped the connection.")}function Uh(e){if(Cs){if(e.preventDefault(),null!=da){var t=da._wheelImg;if(null!=t)if(null==t.x)var a=t.getBoundingClientRect(),i=a.left+100,s=a.top+100;else i=t.x+100,s=t.y+100}else i=0,s=0;switch(e.type){case"mousedown":case"MSPointerDown":case"pointerdown":e.preventDefault(),Xo(100,e.pageX-i,-e.pageY+s,1);break;case"mousemove":break;case"touchstart":e.preventDefault(),Xo(100,e.targetTouches[0].pageX-i,-e.targetTouches[0].pageY+s,1);break;case"touchmove":break;case"mouseup":case"MSPointerUp":case"pointerup":Xo(100,e.pageX-i,-e.pageY+s,0);break;case"mouseout":for(var r=1;r<7;r++)hn.getCurrentpage().walkthroughcontrol.movedirection&&hn.getCurrentpage().walkthroughcontrol.movedirection(r,!1);break;case"MSPointerOut":for(r=1;r<7;r++)hn.getCurrentpage().walkthroughcontrol.movedirection&&hn.getCurrentpage().walkthroughcontrol.movedirection(r,!1);break;case"pointerout":for(r=1;r<7;r++)hn.getCurrentpage().walkthroughcontrol.movedirection&&hn.getCurrentpage().walkthroughcontrol.movedirection(r,!1);break;case"touchcancel":for(e.preventDefault(),r=1;r<7;r++)hn.getCurrentpage().walkthroughcontrol.movedirection&&hn.getCurrentpage().walkthroughcontrol.movedirection(r,!1);break;case"touchend":for(e.preventDefault(),r=1;r<7;r++)hn.getCurrentpage().walkthroughcontrol.movedirection&&hn.getCurrentpage().walkthroughcontrol.movedirection(r,!1)}}}function Gh(e){e.addEventListener("touchstart",Uh),e.addEventListener("touchmove",Uh),e.addEventListener("touchcancel",Uh),e.addEventListener("touchend",Uh),Hi?(e.addEventListener("mousemove",Uh),e.addEventListener("mousedown",Uh),e.addEventListener("mouseup",Uh),e.addEventListener("mouseout",Uh)):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerMove",Uh),e.addEventListener("MSPointerDown",Uh),e.addEventListener("MSPointerUp",Uh),e.addEventListener("MSPointerOut",Uh)):(e.addEventListener("mousemove",Uh),e.addEventListener("mousedown",Uh),e.addEventListener("mouseup",Uh),e.addEventListener("mouseout",Uh))}class zh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onResize=function(e){"function"==typeof t.callback&&t.callback(e)}}}class Hh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.zoomUpdate=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class _h{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.zoomUpdate=function(e){"function"==typeof t.callback&&t.callback(e)}}}class Wh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.panUpdate=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}}class Xh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.markupSaved=function(){"function"==typeof t.callback&&t.callback()}}}class Yh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setupComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}}class qh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onRotate=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class Zh{constructor(e){var t=this;this.callback=e,this.progress=0,this.connect=function(e){t.callback=e},this.setUpload=function(e){"function"==typeof t.callback&&t.callback(e)}}}class Jh{constructor(e){var t=this;this.hastext=!1,this.callback=e,this.connect=function(e){t.callback=e},this.numTextFound=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class Kh{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupSelected=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class $h{constructor(){var e=this;this.callback=void 0,this.connect=function(t){e.callback=t},this.printpageComplete=function(t){"function"==typeof e.callback&&void 0!==e.callback&&e.callback(t)}}}class Qh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setPentablelist=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class ed{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.getCurrentPage=function(){return hn.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<hn.markuplist.length;a++)hn.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.pageindex,this.thumbnail)},this.setThumbnail=function(e,t){this.thumbnail=t,this.pageindex=e,this.notify()}}}class td{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.getCurrentPage=function(){return hn.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<hn.markuplist.length;a++)hn.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.thumbnails)},this.setThumbnails=function(e){this.thumbnails=e,this.notify()}}}class ad{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.setVectorBlocks=function(e){"function"==typeof t.callback&&t.callback(e)}}}class id{constructor(e){var t=this;this.connect=function(e){t.callback=e},this.readComplete=function(){"function"==typeof t.callback&&t.callback()}}}class sd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockID=function(e){"function"==typeof t.callback&&t.callback(e)}}}class rd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockInfo=function(e,a,i){this.info=e,"function"==typeof t.callback&&t.callback(e,a,i)}}}class nd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set3DPartInfo=function(e){this.info=e,"function"==typeof t.callback&&t.callback(e)}}}class od{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.RenderComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}}class ld{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}}class cd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class hd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onDrawEvent=function(e){"function"==typeof t.callback&&t.callback(e)}}}class dd{constructor(e){var t=this;this.callback=e,this.pageonly=!1,this.connect=function(e){t.callback=e},this.getDisplayName=function(e){return Kn(e)},this.getDisplayDate=function(e){return GetDateTime(e)},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setMarkupList=function(e,t,a){this.markupList=e,a||this.notify(e,t)}}}class pd{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onClose=function(){"function"==typeof t.callback&&t.callback()}}}class ud{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.CompareDialog=function(){"function"==typeof t.callback&&t.callback(xn)}}}function gd(e,t){t.status?console.log(e,t.status):console.log(e,t),null!=la&&la.setDownload("hide")}function fd(e){e.status?404==e.status?(console.log("XML could not be found error 404"),null!=la&&la.setDownload("hide")):503==e.status?(console.log("Server is down error 503"),null!=la&&la.setDownload("hide")):501==e.status&&(console.log("Server is not responding refresh the page error 501"),null!=la&&la.setDownload("hide")):(console.log(e),null!=la&&la.setDownload("hide"))}function md(){var e=!0;return(null==hn||null==hn||null==hn.getCurrentpage())&&(e=!1),e}function yd(){var e=!1;return gi||(e=!0),(null==hn||null==hn||null==hn.getCurrentpage())&&(e=!0),e}function vd(){return[{label:"Freehand pen",typename:"PEN",type:0,subtype:0},{label:"Eraser",typename:"ERASER",type:0,subtype:1},{label:"Polyline",typename:"POLYLINE",type:1,subtype:1},{label:"Polygon",typename:"POLYGON",type:1,subtype:2},{label:"Measure Path",typename:"PATH",type:1,subtype:3},{label:"Measure angle",typename:"ANGLE",type:1,subtype:4},{label:"Measure angle",typename:"ANGLEBCKWRD",type:1,subtype:5},{label:"Measure segment",typename:"SEGMENT",type:1,subtype:6},{label:"Rectangle",typename:"RECTANGLE",type:3,subtype:0},{label:"Rounded Rectangle",typename:"ROUNDED_RECTANGLE",type:3,subtype:1},{label:"Marker",typename:"MARKER",type:3,subtype:3},{label:"Rectanglular Area",typename:"AREARECT",type:3,subtype:6},{label:"Oval",typename:"ELLIPSE",type:4,subtype:0},{label:"Circle",typename:"CIRCLE",type:4,subtype:1},{label:"Revision Cloud",typename:"CLOUD",type:5,subtype:0},{label:"Line",typename:"LINE",type:6,subtype:9},{label:"Arrow",typename:"ARROW",type:6,subtype:0},{label:"Dimension Line",typename:"DIMENSION",type:7,subtype:0},{label:"Space",typename:"SPACE",type:8,subtype:1},{label:"Area",typename:"AREA",type:8,subtype:0},{label:"Callout",typename:"CALLOUT",type:9,subtype:2},{label:"Text",typename:"TEXT",type:9,subtype:1},{label:"Note",typename:"NOTE",type:10,subtype:0},{label:"Image",typename:"IMAGE",type:11,subtype:0},{label:"Symbol",typename:"SYMBOL",type:11,subtype:1},{label:"Button",typename:"BUTTON",type:11,subtype:3},{label:"Signature",typename:"SIGNATURE",type:11,subtype:4},{label:"Signature",typename:"SIGNATUREMOVEABLE",type:11,subtype:5},{label:"Stamp",typename:"IMAGESTAMP",type:11,subtype:12},{label:"QRCode",typename:"IMAGEQR",type:11,subtype:13},{label:"link",typename:"link",type:11,subtype:20},{label:"interactiveStamp",typename:"interactiveStamp",type:11,subtype:21},{label:"Stamp",typename:"STAMP",type:12,subtype:0},{label:"Count",typename:"COUNT",type:13,subtype:0},{label:"MeasureArc",typename:"MEASUREARC",type:14,subtype:0}]}function xd(e){var t={lineColor:!1,fillColor:!1,textColor:!1,lineWidth:!1,lineStyle:!1,clockwise:!1,customlabel:!1,display:!0,countsize:!1,countshape:!1,showperimeter:!1,enablelink:!1,endpoint_open_single:!1,endpoint_open_both:!1,endpoint_filled_single:!1,endpoint_filled_both:!1,endpoints_bar:!1,endpoints_arrow:!1,lineSegmentWidth:!1,transpacency:!1,rotate:!1,snap:!1,fill:!1,fontName:!1,fontHeight:!1,labelsize:!1,fontBold:!1,fontItalic:!1};return"PEN"==e.typename&&(t.lineColor=!0,t.lineWidth=!0),"ERASER"==e.typename&&(t.lineWidth=!0,t.display=!1),"POLYLINE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0),"POLYGON"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0),"PATH"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.labelsize=!0),"ANGLE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.clockwise=!0,t.labelsize=!0),"SEGMENT"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.lineSegmentWidth=!0,t.snap=!0),"POLYCURVE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0),"RECTANGLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"ROUNDED_RECTANGLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"MARKER"==e.typename&&(t.fillColor=!0,t.rotate=!0),"AREARECT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.labelsize=!0),"ELLIPSE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"CIRCLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0),"CLOUD"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"LINE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0),"ARROW"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.endpoint_open_single=!0,t.endpoint_open_both=!0,t.endpoint_filled_single=!0,t.endpoint_filled_both=!0),"DIMENSION"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.endpoints_bar=!0,t.endpoints_arrow=!0,t.labelsize=!0),"SPACE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.customlabel=!0,t.labelsize=!0),"AREA"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.customlabel=!0,t.labelsize=!0,t.showperimeter=!0),"CALLOUT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.textColor=!0,t.fontName=!0,t.fontHeight=!0,t.fontBold=!0,t.fontItalic=!0),"TEXT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.textColor=!0,t.rotate=!0,t.fontName=!0,t.fontHeight=!0,t.fontBold=!0,t.fontItalic=!0),e.typename,"IMAGE"!=e.typename&&"IMAGESTAMP"!=e.typename&&"SYMBOL"!=e.typename||(t.rotate=!0),"STAMP"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.rotate=!0),"COUNT"==e.typename&&(t.fillColor=!0,t.countsize=!0,t.countshape=!0),"MEASUREARC"==e.typename&&(t.lineWidth=!0,t.lineColor=!0),t}function bd(e,t,i){yd()||mi||function(e,t,i){var s=0,r=!1;for(s=hn.markuplist.length;s>0;s--)if(null!=hn.markuplist[s-1]&&hn.markuplist[s-1].display&&hn.markuplist[s-1].pagenumber==hn.getcurPage()&&8==hn.markuplist[s-1].type&&1==hn.markuplist[s-1].subtype){var o=e.toString();if(hn.markuplist[s-1].findAttribute("SpaceID",o))if(r=!0,i){var l=Oo(t);-1!=l&&(hn.markuplist[s-1].alternative=l+3,hn.markuplist[s-1].hatchStyle=l)}else hn.markuplist[s-1].alternative=0}return Vl(n),Nl(a),r}(e,t,i)||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().setBlockHatch(e,t,i)}function wd(e,t,a){yd()||mi||(Rl(e,t,a)||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().setBlockColor(e,t,a),hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().set3DBlockColor(e,t,a))}function kd(){for(var e=!1,t=0;t<yn.length;t++){e=!1;var a=!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usepdfjs&&!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevector3Dxml&&!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevectorxml;if("Compare"==yn[t].Type){var i={index:yn[t].pages[0].DocRef.fileindex,Name:yn[t].pages[0].DocRef.FileName,Type:yn[t].pages[0].DocRef.Type,Is2D:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevectorxml,is3D:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevector3Dxml,isImage:a,isPDF:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usepdfjs,state:1};xn.push(i),a=!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usepdfjs&&!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevector3Dxml&&!yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevectorxml,i={index:yn[t].pages[1].DocRef.fileindex,Name:yn[t].pages[1].DocRef.FileName,Type:yn[t].pages[1].DocRef.Type,Is2D:yn[t].pages[1].DocRef.pages[yn[t].pages[1].DocRef.currentpage].usevectorxml,is3D:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usevector3Dxml,isImage:a,isPDF:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usepdfjs,state:2},xn.push(i)}else{for(var s=0,r=0;r<vn.length;r++)yn[t].FileName==vn[r].Name&&(s=vn[r].state);a=!yn[t].pages[yn[t].currentpage].usepdfjs&&!yn[t].pages[yn[t].currentpage].usevector3Dxml&&!yn[t].pages[yn[t].currentpage].usevectorxml,i={index:yn[t].fileindex,Name:yn[t].FileName,Type:yn[t].Type,Is2D:yn[t].pages[yn[t].currentpage].usevectorxml,is3D:yn[t].pages[yn[t].currentpage].usevector3Dxml,isImage:a,isPDF:yn[t].pages[0].DocRef.pages[yn[t].pages[0].DocRef.currentpage].usepdfjs,state:s};for(var n=0;n<xn.length;n++)i.index==xn[n].index&&(e=!0);e||(xn.push(i),e=!1)}}return xn}function Dd(e){a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height);var i=function(){for(var e=null,t=0;t<yn.length;t++)yn[t].bActive&&(e=t);return e}();null!=i&&yn[i].Type,hn&&hn.enableTextSelect(!1),yn.length>=1&&null!=yn[e]&&(Hs=!0,(hn=yn[e]).bSopenSilent=!1,_s&&!hn.pdfDoc&&(_s=!1),hn.pages&&hn.pages.length&&(hn.pages[0].usedincomposite=!1),hn.getCurrentpage().usevector3Dxml||null!=da&&Cs&&da.setWalkthroughGUI(!1),Hd(),hn.SetActive(),null!=hn.foxitdoc?Wp(!0):Wp(!1))}function Cd(){yd()||hn.getCurrentpage().usevector3Dxml&&(null==cn&&(eu("orbitControl",{}),hn.curcontrol3D="orbitControl"),"Walkthrough3D"==cn.name&&(hn.getCurrentpage().walkthroughcontrol.isLocked=!1),null!=da&&Cs&&da.setWalkthroughGUI(!1),eu("orbitControl",{}),hn.curcontrol3D="orbitControl")}function Rd(e){yd()||hn.getCurrentpage().usevector3Dxml&&(e?(null!=da&&Cs&&da.setWalkthroughGUI(!0),eu("Walkthrough3D",{}),hn.curcontrol3D="Walkthrough3D"):(hn.getCurrentpage().walkthroughcontrol.firstxyrecieved=!1,Cd()))}function Pd(){if(!yd()){var e=hn.getCurrentpage();e&&e.usevector3Dxml&&e.Vector3DPageObj.saveCamera()}}function Sd(){var e=void 0;if(!yd())return hn.getCurrentpage().usevectorxml&&(e=hn.getCurrentpage().screentoDocRect({x:0,y:0,w:ti,h:ai})),e}function Md(){var e=void 0;if(!yd())return hn.getCurrentpage().usevectorxml&&(e=hn.getCurrentpage().getlayerlist()),e}function Td(){var e=void 0;if(!yd()&&!mi)return hn.getCurrentpage().usevectorxml&&(e=hn.getCurrentpage().getBlockswFill()),e}function Ed(){if(!yd()&&gi){var e=hn.getCurrentpage();null!=e&&null!=e&&e.usevector3Dxml&&e.Vector3DPageObj.saveresetCamera()}}function Fd(){if(!yd()&&gi){var e=hn.getCurrentpage();null!=e&&null!=e&&e.usevector3Dxml&&e.Vector3DPageObj.restoreresetCam()}}function Id(e,t){if(!yd()&&!Hr&&null!=e&&"string"==typeof e){null!=e.match(/rgb/gi)&&(e=Ln(e));var a=Pr;switch(t){case 1:a=Mr,Mr=e,yl(1),zr||(Mr=a);break;case 0:a=Sr,Sr=e,yl(7),zr||(Sr=a);break;case 2:a=Tr,Tr=e,yl(8),zr||(Tr=a)}}}function jd(){yd()||(Vl(n),Nl(a))}function Ad(e,t){t.password=e,zc(t)}function Od(e){var t=void 0;if("object"==typeof e){var a="";null!=e.filename&&null!=e.filename&&(a=e.filename),null!=e.filepath&&null!=e.filepath&&(a=e.filepath),t={filename:a,displayname:null,auth:null,xrefurl:null,cacheid:null},null!=e.mime&&null!=e.mime&&(t.mime=e.mime),null!=e.cacheid&&null!=e.cacheid&&(t.cacheid=e.cacheid),null!=e.auth&&null!=e.auth&&(t.auth=e.auth),null!=e.xrefurl&&null!=e.xrefurl&&(t.xrefurl=e.xrefurl),e.requestheaders,null!=e.displayname&&null!=e.displayname&&(t.displayname=e.displayname)}else"string"==typeof e&&(t={filename:e,displayname:null});return t}function Ld(e){var t=Od(e);null!=t&&null!=t.filename&&(t.filepath=t.filename,Ss.open=!0,Ss.openfileobj=t)}function Vd(e){if(vi&&0!=vn.length)for(var t=0;t<vn.length;t++)2==vn[t].state&&(vn[t].requirefoxit=!0,vn[t].foxitready=e)}function Nd(e){if(vi&&0!=vn.length)for(var t=0;t<vn.length;t++)e==vn[t].Name&&(vn[t].loaded=!0)}function Bd(){var e=!0;0!=vn.length||vi||(e=!1);for(var t=0;t<vn.length;t++)2!=vn[t].state||vn[t].loaded||(vn[t].requirefoxit?vn[t].foxitready&&zc(vn[t].openobj):zc(vn[t].openobj)),e&&(e=vn[t].loaded);e&&(kd(),vi=!1,vn=[],Wd(!0))}function Ud(){for(var e=void 0,t=0;t<yn.length;t++)if(yn[t].bcompare){e=yn[t];break}return e}function Gd(e,t,a){vi=!0;for(var i=0;i<yn.length;i++)"Compare"==yn[i].Type&&yn.splice(i,1);var s={filename:e,displayname:null},r={filename:t,displayname:null},n={Name:_o(e),loaded:!1,requirefoxit:!1,disableMenu:!0,state:1,openobj:s,foxitready:!1};vn.push(n),n={Name:_o(t),loaded:!1,requirefoxit:!1,disableMenu:!0,state:2,openobj:r,foxitready:!1},vn.push(n),null!=la&&la.setDownload("show"),zc(s)}function zd(e){return new Promise((function(t,a){lt.connect((function(a){a==e&&(hn.pages[a].rendercallback=!1,t(e))})),null!=hn.pages[e]&&(hn.pages[e].rendercallback=!0),hn.GotoPage(e),hn.draw_mpagepdf()}))}function Hd(){for(var e=0;e<yn.length;e++)yn[e].bActive=!1}function _d(e,t){if(!yd()){var a=-1,i=-1;if(!mi)if(xn.length>1&&e){for(var s=0;s<xn.length;s++){if(1==xn[s].state){xn[s].Name;var r=xn[s].index}if(2==xn[s].state){xn[s].Name;var n=xn[s].index}}for(s=0;s<yn.length;s++)yn[s].fileindex==r&&(a=s,yn[s].disableMenu=!0),yn[s].fileindex==n&&(i=s,yn[s].disableMenu=!0);if(-1!=a&&-1!=i&&a!=i){Ph(yn[a].pages[yn[a].currentpage],yn[i].pages[yn[i].currentpage],t);var o={iscompare:!0,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"createcompareoverlay"};null!=Jt&&Jt.setGUIState(o),null!=la&&la.setDownload("hide"),null!=_e&&_e.loadComplete("compare",!0),null!=pa&&pa.CompareDialog()}}else xn=[]}}function Wd(e){_d(e,0)}function Xd(e,t){if(!yd()&&!yi)if(e.constructor!==Array){if(null!=hn.getPageObject(e)){var a=0;if(t)switch(hn.getPageObject(e).getpageRotation()){case 0:a=90;break;case 90:a=180;break;case 270:a=0;break;case 180:a=270}else switch(hn.getPageObject(e).getpageRotation()){case 0:a=270;break;case 90:a=0;break;case 270:a=180;break;case 180:a=90}hn.getPageObject(e).rotatepage(a),0==e&&hn.getPageObject(e).redraw()}}else!function(e,t){for(var a=0;a<e.length;a++)Xd(e[a],t)}(e,t)}function Yd(){yd()||mi||hn.drawsearchRect()}function qd(){yd()||hn.forcefoxitRedraw()}function Zd(){if(!yd()&&!Hr)return gl()}function Jd(){if(!yd()){var e=Math.floor(hn.getCurrentpage().MainImageWidth/hn.getCurrentpage().MainImageScaling),t=Qo(hn.getCurrentpage().MainImageWidth),a=Math.floor(hn.getCurrentpage().MainImageHeight/hn.getCurrentpage().MainImageScaling),i=Qo(hn.getCurrentpage().MainImageHeight),s=void 0,r=void 0;hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().VectorPageObj?(t=Qo(e=Math.floor(hn.getCurrentpage().VectorPageObj.width)),i=Qo(a=Math.floor(hn.getCurrentpage().VectorPageObj.height))):hn.getCurrentpage().usepdfjs?(t=Qo(e=Math.floor(hn.getCurrentpage().pdfpagewidth)),i=Qo(a=Math.floor(hn.getCurrentpage().pdfpageheight))):hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj&&(hn.getCurrentpage().usevector3DGLTF?(t=Qo(e=Math.floor(hn.getCurrentpage().Vector3DPageObj.curwidth)),i=Qo(a=Math.floor(hn.getCurrentpage().Vector3DPageObj.curheight)),r=Qo(s=Math.floor(hn.getCurrentpage().Vector3DPageObj.curdepth))):(t=Qo(e=Math.floor(hn.getCurrentpage().Vector3DPageObj.w)),i=Qo(a=Math.floor(hn.getCurrentpage().Vector3DPageObj.h))));var n=hn.getCurrentpage().OffsetX,o=hn.getCurrentpage().OffsetY,l=hn.getCurrentpage().OriginalScale,c={FileFormat:hn.Format,FileName:hn.FileName,FileSize:Math.floor(hn.FileSizeLow/1024),Compression:hn.getCurrentpage().Compression,DPI:hn.getCurrentpage().DPI,Pages:hn.NumPages,ImageWidth:e,imagewidthunits:t,ImageHeight:a,imageheightunits:i,OffsetX:n,OffsetY:o,OriginalScale:l,XRefs:hn.xrefs,Fonts:hn.fonts,Properties:hn.documentproperties};s&&(c.ImageDepth=s),r&&(c.ImageDepthunits=r),null!=hn.CadMeasurement&&(c.CADMeasurement=hn.CadMeasurement),mi&&(c={FileFormat:"Overlay Composite",FileName:dn.pages[0].DocRef.FileName+"-"+dn.pages[1].DocRef.FileName,FileSize:"-",Compression:"-",DPI:"-",Pages:"-",ImageWidth:"-",imagewidthunits:t,ImageHeight:"-",imageheightunits:i,OffsetX:"-",OffsetY:"-",OriginalScale:"-"}),null!=He&&He.setFileInfo(c)}}function Kd(){mi=!1,xn=[],dn.Close();for(var e=0;e<yn.length;e++)"Compare"==yn[e].Type&&yn.splice(e,1);dn={}}function $d(e){var i=yn[e]||hn,r=e||void 0;if(!gi)return!1;if(i&&(r=i.fileindex),hn&&i.bMarkupchanged&&!Hr&&Si&&nh(E,Fr,Ir),i===hn&&(a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height)),"Compare"==yn[yn.length-1].Type?Kd():(i.Close(),i===hn&&(i=hn=null),yn.splice(r,1)),hn&&(hn.bMarkupchanged=!1),nr=!1,or=!1,yn.length<1){if(gi=!1,!le){hi=gn.width,di=gn.height,hi=gn.naturalWidth,di=gn.naturalHeight;var o=ai/di,l=ti/hi,c=Math.min(l,o),h=(ti-hi*c)/2,d=(ai-di*c)/2}yp(),mp(),null!=je&&je.setUserlist(wr,!0),le||Ch(gn,h,d,c),eu("markupedit",{p1:!1});var p={iscompare:!1,numOpenFiles:yn.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:0,currentpage:0,activefile:!1,source:"internalClosedocOrg"};null!=Jt&&Jt.setGUIState(p)}else"Compare"==yn[yn.length-1].Type?(dn=yn[yn.length-1],Hd(),dn.bSopenSilent=!1,dn.SetActive()):(hn||(hn=yn[yn.length-1]),Hd(),hn.bSopenSilent=!1,hn.SetActive());for(var u=0;u<yn.length;u++)yn[u].setfileindex(u);return!0}function Qd(e){var i=yn[e]||hn,r=e||void 0,o=r;if(!gi)return null!=qe&&qe.closeComplete("no file open",!1),!1;if(i&&(o=r=i.fileindex),hn&&(i.getdelayedClose()&&i.setdelayedClose(!1),i.bMarkupchanged&&!Hr&&Si&&i.setdelayedClose(!1)),i.getdelayedClose())return null!=qe&&qe.closeComplete("delayed",!1),!1;if(i===hn&&(a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height)),"Compare"==yn[yn.length-1].Type)Kd();else{i.Close(),i===hn&&(i=hn=null);for(var l=-1,c=0;c<xn.length;c++)r==xn[c].index&&(l=c);l>=0&&xn.splice(l,1),yn.splice(r,1)}if(hn&&(hn.bMarkupchanged=!1),nr=!1,or=!1,yn.length<1){if(gi=!1,!le){hi=gn.width,di=gn.height,hi=gn.naturalWidth,di=gn.naturalHeight;var h=ai/di,d=ti/hi,p=Math.min(d,h),u=(ti-hi*p)/2,g=(ai-di*p)/2}yp(),mp(),null!=je&&je.setUserlist(wr,!0),le||Ch(gn,u,g,p),eu("markupedit",{p1:!1});var f={iscompare:!1,numOpenFiles:yn.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:0,currentpage:0,activefile:!1,source:"internalClosedoc"};null!=Jt&&Jt.setGUIState(f)}else"Compare"==yn[yn.length-1].Type?(dn=yn[yn.length-1],Hd(),dn.bSopenSilent=!1,dn.SetActive()):(hn||(hn=yn[yn.length-1]),Hd(),hn.bSopenSilent=!1,hn.SetActive());for(var m=0;m<yn.length;m++)yn[m].setfileindex(m);return null!=qe&&qe.closeComplete(o,!0),!0}function ep(e){yd()||mi||hn.getCurrentpage().setViewMode(e)}function tp(e,t){il(),ss=t.width,rs=t.height,ns=t.printrect,mi||(hn.checkprintready()?wh():hn.loadAllPages())}function ap(){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().delete3DMarkup():Fl())}function ip(e){navigator.clipboard&&window.isSecureContext?e.toBlob((function(e){return function(){if(!yd())if(hn.getCurrentpage().usevector3Dxml)switch(hn.curcontrol3D){case"Walkthrough3D":Rd(!0);break;case"orbitControl":Cd();break;case"markupedit":eu("markupedit",{p1:!1})}else eu("markupedit",{p1:!1})}(),navigator.clipboard.write([new ClipboardItem({"image/png":e})])})):console.log("no secure context")}function sp(e){var t=document.createElement("canvas"),a=document.createElement("canvas"),i=t.getContext("2d"),s=a.getContext("2d");return t.width=e.width,t.height=e.height,a.width=e.width,a.height=e.height,i.putImageData(e,0,0),s.save(),s.translate(0,t.height),s.scale(1,-1),s.drawImage(t,0,0),s.restore(),s.getImageData(0,0,e.width,e.height)}function rp(e,t){yd()||hn.getCurrentpage().usevector3Dxml||hn.getCurrentpage().pan_page_pos(e,t)}function np(e){yi=e}function op(e,t){var a=!0,i=hn.getCurrentpage().getpagedim();if(hn.getCurrentpage().usepdfjs)var s=ii-60,r=si-60;else s=ti-60,r=ai-60;i.w/e<s&&i.h/e<r&&(a=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,t);if(hn.getCurrentpage().usepdfjs)var o=si-30,l=ii-30,c=ii/si;else o=ai-30,l=ti-30,c=ti/ai;return n.y,n.h,n.y,n.w/n.h<c?n.h<=o&&(a=!1):n.w<=l&&(a=!1),Ui||(a=!0),a}function lp(e){if(!yd()&&!Hr){var t=!1;Dl(),bl(),e?(Ms&&(hn.markuplist[Us].multipoint()?hn.markuplist[Us].setselectedit(!0):hn.markuplist[Us].setselect(!0),t=8==hn.markuplist[Us].type&&1==hn.markuplist[Us].subtype,Vl(n),Nl(a),Ms=!1,Us=-1),eu("markupedit",{p1:t})):eu("markupedit",{p1:!1})}}function cp(e,t,a){null==t&&(t=hn);var i=0;t.setmarkupfilesreceived();var s,r=t.getmarkupfilesreceived(),o=t.getnummarkupfiles();if(null!=e.getElementsByTagName("FileVersion")&&0!=e.getElementsByTagName("FileVersion").length)var l=e.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=e.getElementsByTagName("Format")&&0!=e.getElementsByTagName("Format").length){if(e.getElementsByTagName("Format")[0].firstChild.nodeValue,null!=a)var c=zo(a);if(null!=e.getElementsByTagName("Markup3D")&&0!=e.getElementsByTagName("Markup3D").length){var h=e.getElementsByTagName("Markup3D")[0].firstChild.nodeValue;null!=a&&function(e,t){t.getCurrentpage()&&t.getCurrentpage().Vector3DPageObj&&t.getCurrentpage().Vector3DPageObj.markupLoad(e)}(h=c+h,t)}if(null!=e.getElementsByTagName("Views3D")&&0!=e.getElementsByTagName("Views3D").length){var d=e.getElementsByTagName("Views3D")[0].firstChild.nodeValue;null!=a&&function(e,t){t.getCurrentpage()&&t.getCurrentpage().Vector3DPageObj&&Fh("GET",e,"").then((function(e){var a=JSON.parse(e);t.getCurrentpage().Vector3DPageObj.addCameraViews(a)})).catch((function(e){e.status||console.log(e)}))}(d=c+d,t)}}if(null!=e.getElementsByTagName("User")&&0!=e.getElementsByTagName("User").length){var p=e.getElementsByTagName("User");for(i=0;i<p.length;i++){var u=p[i].getElementsByTagName("Name")[0].firstChild.nodeValue,g=p[i].getElementsByTagName("ID")[0].firstChild.nodeValue;if(null!=p[i].getElementsByTagName("Layer")[0])var f=p[i].getElementsByTagName("Layer")[0].firstChild.nodeValue;else f=Rr;if(null!=p[i].getElementsByTagName("Color")[0])var m=p[i].getElementsByTagName("Color")[0].firstChild.nodeValue;else m=Pr;wr[0].Signature==g||wr.push(new qn(g,u,f,m,!1))}}else if(e.getElementsByTagName("Name").length>0){var y=e.getElementsByTagName("Name");wr[0].Signature!=y[0].firstChild.nodeValue&&wr.push(new qn(y[0].firstChild.nodeValue,y[0].firstChild.nodeValue,Rr,Pr,!1))}if(e.getElementsByTagName("Entity").length>0){var v=e.getElementsByTagName("Entity");for(i=0;i<v.length;i++){var x=v[i].getElementsByTagName("Type")[0].firstChild.nodeValue,b=v[i].getElementsByTagName("Subtype")[0].firstChild.nodeValue,w=v[i].getElementsByTagName("Alternative")[0].firstChild.nodeValue,k=v[i].getAttribute("ID")?v[i].getAttribute("ID"):null,D=9==x&&2==b;if(null!=v[i].getElementsByTagName("HaveLeader")[0])var C=1==parseInt(v[i].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(C||D){if(null==v[i].getElementsByTagName("Entity")[0])continue;var R=v[i].getElementsByTagName("Entity")[0],P=R.getElementsByTagName("Type")[0].firstChild.nodeValue,S=R.getElementsByTagName("Subtype")[0].firstChild.nodeValue,M=R.getElementsByTagName("Alternative")[0].firstChild.nodeValue;R.getAttribute("ID")&&R.getAttribute("ID"),P=parseInt(P),S=parseInt(S),M=parseInt(M);var T=new cl(P,S,M),E=T.SetfromXML(t,R,l);E&&(v[i].removeChild(R),T.savemetolistLoad(t,!1))}if(null!=v[i].getElementsByTagName("Hole")[0])var F=!0;var I=[],j=[];if(F){if(null==v[i].getElementsByTagName("Entity")[0])continue;var A=v[i].getElementsByTagName("Entity");if(null==A.length){var O=A.getElementsByTagName("Type")[0].firstChild.nodeValue,L=A.getElementsByTagName("Subtype")[0].firstChild.nodeValue,V=A.getElementsByTagName("Alternative")[0].firstChild.nodeValue;A.getAttribute("ID")&&A.getAttribute("ID"),O=parseInt(O),L=parseInt(L),V=parseInt(V),I.push(new cl(O,L,V)),j.push(I[N].SetfromXML(t,A[N],l)),j[0]&&(v[i].removeChild(A),I[0].savemetolistLoad(t,!1))}else for(var N=0;A.length>0;)O=A[0].getElementsByTagName("Type")[0].firstChild.nodeValue,L=A[0].getElementsByTagName("Subtype")[0].firstChild.nodeValue,V=A[0].getElementsByTagName("Alternative")[0].firstChild.nodeValue,A[0].getAttribute("ID")&&A[0].getAttribute("ID"),O=parseInt(O),L=parseInt(L),V=parseInt(V),I.push(new cl(O,L,V)),j.push(I[N].SetfromXML(t,A[0],l)),j[N]&&(v[i].removeChild(A[0]),I[N].savemetolistLoad(t,!1)),N++}x=parseInt(x),b=parseInt(b),w=parseInt(w);var B=new cl(x,b,w);if(B.markupID=k,B.SetfromXML(t,v[i],l)){if(E&&C&&null!=T&&(B.bhasArrow=C,B.markupArrowConnected=T,T.bisTextArrow=!0,T.textBoxConnected=B,T.setArrowPoint(B),E=!1,C=!1,Vl(n)),F)for(N=0;N<I.length;N++)j[N]&&(I[N].parent=B,B.holes.push(I[N]));var U=i==v.length-1&&o==r;B.savemetolistLoad(t,U)}else console.log("adding markup failed ",B.markupID)}B&&B.notify(),0==v.length&&null!=Nt&&Nt.setMarkupList(t.getmarkuplist(),t.bActive),null!=je&&je.setUserlist(wr,t.bActive),Vl(n)}else o==r&&(Vl(n),null!=Nt&&Nt.setMarkupList(t.getmarkuplist(),t.bActive));if(e.getElementsByTagName("ScaleItem").length>0){var G=e.getElementsByTagName("ScaleItem");let t=[];for(i=0;i<G.length;i++){var z=G[i].getElementsByTagName("Value")[0].firstChild.nodeValue,H=G[i].getElementsByTagName("Label")[0].firstChild.nodeValue,_=G[i].getElementsByTagName("Metric")[0].firstChild.nodeValue,W=G[i].getElementsByTagName("MetricUnit")[0].firstChild.nodeValue,X=G[i].getElementsByTagName("DimPrecision")[0].firstChild.nodeValue,Y="true"===G[i].getElementsByTagName("IsSelected")[0].firstChild.nodeValue;const e={value:z,label:H,metric:_,metricUnit:W,dimPrecision:X,isSelected:Y};t.push(e),Y&&("0"===(s=e).metric?gp(1):gp(2),"0"===s.metric?vp(s.metricUnit):xp(s.metricUnit),Gp(s.dimPrecision),bp(s.value),wp(s.label))}hn.scalesOptions=t}t.markuplist.length&&function(e,t){if(null!=t.getPageObject(t.markuplist[0].pagenumber)){if(void 0!==e.getElementsByTagName("HasScale")[0])for(var a=0;a<e.getElementsByTagName("HasScale").length;a++)"true"===e.getElementsByTagName("HasScale")[a].firstChild.nodeValue&&(t.markuplist[a].hasScale=e.getElementsByTagName("HasScale")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.measurescale=parseFloat(e.getElementsByTagName("Measurescale")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.scaleLabel=e.getElementsByTagName("ScaleLabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.Unitofmeasure=parseFloat(e.getElementsByTagName("Unitofmeasure")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.SubmeasureUnit=parseFloat(e.getElementsByTagName("SubmeasureUnit")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.Unitlabel=e.getElementsByTagName("Unitlabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.AreaUnitlabel=e.getElementsByTagName("AreaUnitlabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.unitscale=parseFloat(e.getElementsByTagName("Unitscale")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.scaleValue=e.getElementsByTagName("ScaleValue")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.ndimprecision=e.getElementsByTagName("Ndimprecision")[a].firstChild.nodeValue);jd()}}(e,t),ot.loadComplete()}function hp(e,i,s,r){var o=gl();if(!o.isempty)if(o.anglelengthsupport||o.setRadiusSupport){o.w,o.h,o.x,o.y;var l=o.setAngleLenghtEdit(i,e,r);if(a.clearRect(0,0,t.width,t.height),4==o.type&&1==o.subtype)var c=po({x:o.x,y:o.y},{x:l.w,y:l.h});else c=fo({x:l.w,y:l.h});c?(o.w=l.w,o.h=l.h,Vl(n),Nl(a),o.lengthangleCallbackSelect()):(Vl(n),Nl(a),null!=qa&&qa.onDrawError("outside"))}else if(o.setPointSupport){l=o.setAngleLengthPointsEdit(i,e,r);var h=1==o.type&&(1==o.subtype||3==o.subtype);a.clearRect(0,0,t.width,t.height),fo({x:l.w,y:l.h})?(s||(0!=l.p||h?o.setCurPoint(l.p-1):o.setCurPoint(o.points.length-1)),o.movepoint(l.w,l.h,l.p),o.lengthangleCallbackPointSelect(),Vl(n),Nl(a)):(Vl(n),Nl(a),null!=qa&&qa.onDrawError("outside")),o.findrectangle()}}function dp(e){Xs=e,Wi&&(Xi=!e),e||pp(0,!0)}function pp(e,t){if(!yd()&&!Hr){var i=0;for(i=0;i<hn.markuplist.length;i++)(hn.markuplist[i].spaceselected||t)&&8==hn.markuplist[i].type&&1==hn.markuplist[i].subtype&&(hn.markuplist[i].linestyle=e);Vl(n),function(e){if(null!=hn&&null!=hn){var t=Bl();if(xi&&t)e.clearRect(0,0,ti,ai);else{var a=0,i=!1;if(e.clearRect(0,0,ti,ai),hn.Drawmarkup)for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&Ol(hn.markuplist[a])&&hn.markuplist[a].spaceselected&&(i=8==hn.markuplist[a].type&&1==hn.markuplist[a].subtype,hn.markuplist[a].display&&i&&hn.markuplist[a].drawmescaled(e));else for(a=0;a<hn.markuplist.length;a++)null!=hn.markuplist[a]&&Ol(hn.markuplist[a])&&0==hn.markuplist[a].type&&1==hn.markuplist[a].subtype&&hn.markuplist[a].display&&hn.markuplist[a].drawmescaled(e)}}}(a),Nl(a)}}function up(){if(yd()){var e="Metric";switch(Ys){case 1:e="Metric";break;case 2:e="Imperial";break;case 3:e="System"}return{unit:Ys,unitname:e,subunit:fr,label:qs,Arealabel:Zs}}return hn.getCurrentpage().getUnit()}function gp(e){if(yd()){switch(e){case 1:qs="mm",Zs="mmÂ²";break;case 2:qs="in.",Zs="sq.in.";break;case 3:qs="Units",Zs="UnitsÂ²"}Ys=e}else hn.getCurrentpage().scaleObject.setUnit(e),hn.getCurrentpage().scaleChanged()}function fp(e,t,a,i){for(var s=!1,r=0;r<wr.length;r++)wr[r].Signature==e&&(s=!0,wr[r].DisplayName=t,wr[r].Layer=a,wr[r].Color=i,wr[r].default=!0);s||wr.push(new qn(e,t,a,i,!0))}function mp(){for(var e=!1,t=0;t<wr.length;t++)wr[t].Signature==Fr&&(e=!0,wr[t].DisplayName=Ir);e||wr.push(new qn(Fr,Ir,Rr,Pr,!1))}function yp(){for(var e=Fr,t=Ir,a=0;a<wr.length;a++)wr[a].default&&(e=wr[a].Signature,t=wr[a].DisplayName);(wr=[]).push(new qn(e,t,Rr,Pr,!0))}function vp(e){if(yd())switch("Millimeter"==e&&(fr=1),"Centimeter"==e&&(fr=2),"Decimeter"==e&&(fr=3),"Meter"==e&&(fr=4),"Kilometer"==e&&(fr=5),"Nautical Miles"==e&&(fr=6),fr){case 1:qs="mm",Zs="mmÂ²",hr=1;break;case 2:qs="cm",Zs="cmÂ²",hr=10;break;case 3:qs="dm",Zs="dmÂ²",hr=100;break;case 4:qs="m",Zs="mÂ²",hr=1e3;break;case 5:qs="km",Zs="kmÂ²",hr=1e6;break;case 6:qs="nmi",Zs="nmiÂ²",hr=1852e5}else hn.getCurrentpage().scaleObject.metricUnit(e),hn.getCurrentpage().scaleChanged()}function xp(e){if(yd())switch("Inch"==e&&(fr=1),"Feet"==e&&(fr=2),"Yard"==e&&(fr=3),"Mile"==e&&(fr=4),"Nautical Miles"==e&&(fr=5),fr){case 1:qs="in.",Zs="sq.in.",hr=1;break;case 2:qs="ft.",Zs="sq.ft.",hr=12;break;case 3:qs="yd.",Zs="sq.yd.",hr=36;break;case 4:qs="mi.",Zs="sq.mi",hr=63360;break;case 5:qs="nm",Zs="sq.nm",hr=72913.3858}else hn.getCurrentpage().scaleObject.imperialUnit(e),hn.getCurrentpage().scaleChanged()}function bp(e){var t=0,a=0;if(yd())if("Calibration"!=e){var i=e.split(":");t=i[0],a=i[1],Js=Kr?a/t:t/a}else Js=Ks;else hn.getCurrentpage().scaleObject.setMeasureScale(e),hn.getCurrentpage().scaleChanged(),hn.bMarkupchanged=!0}function wp(e){if(yd())return e;hn.getCurrentpage().scaleObject.setScaleLabel(e),hn.getCurrentpage().scaleChanged()}function kp(e){var t=Zd();t.isempty||null!=t.scaleObject&&(t.hasScale=!0,t.scaleObject.setDimPrecision(e),null!=Qt&&Qt.setMarkupSelected(t,9))}function kp(e){var t=Zd();t.isempty||null!=t.scaleObject&&(t.hasScale=!0,t.scaleObject.setDimPrecision(e),null!=Qt&&Qt.setMarkupSelected(t,9))}function Dp(e,t,a,i,s,r){if(null!=s){var n=new cl(9,2,0);n.settxtboxArrow(s)}else n=new cl(9,1,0);switch(n.x=e,n.y=t,hn.getCurrentpage().getpageRotation()){case 0:case 90:case 180:case 270:n.w=a,n.h=i}return n.pagerotation=hn.getCurrentpage().getpageRotation(),n.pagenumber=hn.getcurPage(),n.font.setFontname(Pn.fontName),n.font.setHeight(Pn.height),n.font.setBold(Pn.bold),n.font.setItalic(Pn.italic),n.fillcolor="rgba(255,255,255, 0.9)",n.text=r,n}function Cp(e,t,i,s,r,o){var l={x:e+i,y:t+s};if(fo({x:e,y:t})&&fo(l)){if(null!=r){var c=new cl(9,2,0);c.settxtboxArrow(r)}else c=new cl(9,1,0);switch(c.x=e,c.y=t,hn.getCurrentpage().getpageRotation()){case 0:case 90:case 180:case 270:c.w=i,c.h=s}c.pagerotation=hn.getCurrentpage().getpageRotation(),c.pagenumber=hn.getcurPage(),c.viewname=hn.getcur3DView(),null!=c.viewname&&(c.bfor3D=!0,c.pageheight=ai,c.pagewidth=ti),c.font.setFontname(Pn.fontName),c.font.setHeight(Pn.height),c.font.setBold(Pn.bold),c.font.setItalic(Pn.italic),c.fillcolor="rgba(255,255,255, 0.9)",c.scaling=lo();var h=ro();return c.xoffset=h.x,c.yoffset=h.y,c.seteditaction(0),c.setselectedit(!0),c.setselect(!1),c.text=o,c.savemetolistDraw(),Gs&&(-1!=hn.selectedmarkup.id&&null!=hn.markuplist[hn.selectedmarkup.id]&&(hn.markuplist[hn.selectedmarkup.id].setselectedit(!1),hn.markuplist[hn.selectedmarkup.id].setselect(!1)),Vl(n),Nl(a)),hn.selectedmarkup.id=hn.getmarkupbynumber(c.markupnumber),hn.selectedmarkup.edit=!0,hn.selectedmarkup.selected=!0,c}}function Rp(e,a,i,s,r){if(i<20&&(i=20),s<12&&(s=12),fo({x:e+i,y:a+s})){var n=Cp(e,a,i,s,r,"");if(null!=qt){var o=t.getBoundingClientRect();e+=.5*i,a+=.5*s,e+=o.left,a+=o.top,qt.operation.start=!0,qt.operation.create=!1,qt.operation.edit=!1,qt.operation.save=!1,qt.operation.markup=n;var l=new Yn(e,a,i,s);l.rotation=hn.getCurrentpage().getpageRotation();var c=Hl();l.x=(l.x-o.left)/c+o.left,l.y=(l.y-o.top)/c+o.top,l.w=l.w/c,l.h=l.h/c,qt.setTextInput(l)}Gs||eu("markupedit",{p1:!1})}}function Pp(e,t,i,s,r){if(i<200&&(i=200),s<124&&(s=124),fo({x:e+i,y:t+s})){for(var n,o=0,l=0;l<kr.length;l++)kr[l]==r&&(o=l);(n=new cl(12,o,1)).fillcolor="rgba(255,0,0,0.3)",n.transparency=30,o<kr.length-2?n.text=kr[o]:("Date"==kr[o]&&(n.text=n.GetDateTime(!1)),"User Name"==kr[o]&&(n.text=Kn(n.signature))),n.w=i,n.h=s,n.scaling=lo();var c=ro();n.xoffset=c.x,n.yoffset=c.y,c.x,c.y,hn.getCurrentpage().endx,hn.getCurrentpage().endy,n.font.setFontname("Times New Roman"),n.font.setBold(!0),n.pagenumber=hn.getcurPage(),n.viewname=hn.getcur3DView(),null!=n.viewname&&(n.bfor3D=!0,n.pageheight=ai,n.pagewidth=ti),n.seteditaction(0),.6*n.w>=n.h?n.font.setHeight(n.h/4):n.font.setHeight(.16*n.w),n.stampsmalltheight=16,n.x=e,n.y=t,Gs||(Ms=!0),Us=hn.markuplist.length,n.drawme(a),n.savemetolistDraw(),Dh(),hn&&(hn.bMarkupchanged=!0),n=null,zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}}function Sp(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.arc(t,a,i,0,2*Math.PI),e.closePath(),e.lineWidth=r,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Mp(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t,a-i),e.lineTo(t+i,a),e.lineTo(t,a+i),e.lineTo(t-i,a),e.lineTo(t,a-i),e.closePath(),e.lineWidth=r,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Tp(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a-i),e.lineTo(t,a+i),e.lineTo(t-i,a-i),e.closePath(),e.lineWidth=r,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Ep(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a-i),e.lineTo(t+i,a+i),e.lineTo(t-i,a+i),e.lineTo(t-i,a-i),e.closePath(),e.lineWidth=r,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Fp(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a+i),e.moveTo(t-i,a+i),e.lineTo(t+i,a-i),e.lineWidth=r,e.strokeStyle=o,e.stroke(),e.restore()}function Ip(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t,a-i),e.lineTo(t,a+i),e.moveTo(t-i,a),e.lineTo(t+i,a),e.lineWidth=r,e.strokeStyle=o,e.stroke(),e.restore()}function jp(e,t,a,i,s,r,n,o){e.save(),e.beginPath(),e.moveTo(t-s,a),e.lineTo(t,a+s),e.lineTo(t+i,a-s),e.lineWidth=r,e.strokeStyle=o,e.stroke(),e.restore()}function Ap(e,t,a,i,s,r,n,o){e.save();var l=0,c=Math.PI/2*3,h=t,d=a,p=Math.PI/5;for(e.beginPath(),e.moveTo(t,a-i),l=0;l<5;l++)h=t+Math.cos(c)*i,d=a+Math.sin(c)*i,e.lineTo(h,d),c+=p,h=t+Math.cos(c)*s,d=a+Math.sin(c)*s,e.lineTo(h,d),c+=p;e.lineTo(t,a-i),e.closePath(),e.lineWidth=r,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}const Op=function(e,t){return new Promise((function(a,i){var s=document.createElement("img"),r=document.createElement("canvas");s.onload=function(i){var n=i.target||i.srcElement;if(r.width=n.naturalWidth,r.height=n.naturalHeight,r.width>0)var o=t/r.width;else o=1;r.getContext("2d").drawImage(s,0,0);var l=Un(r,o);e.thumbnail=l,e.width=l.width,e.height=l.height,a(e)},s.onerror=function(e){i()},s.src=e.image.src}))};function Lp(){if(!yd()){var e=Bl();hn.getCurrentpage().usevector3Dxml&&e||(kl(),eu("markupedit",{p1:!1}))}}function Vp(e){i.style.cursor=e,d.domElement.style.cursor=e,r.style.cursor=e,t.style.cursor=e}function Np(e,a,s){if(!yd()&&hn.getCurrentpage().usevector3Dxml)if("Walkthrough3D"!=hn.curcontrol3D&&"orbitControl"!=hn.curcontrol3D||"select3d"!=a){var n=e?a:hn.curcontrol3D;i.style.cursor="default",d.domElement.style.cursor="default",r.style.cursor="default",t.style.cursor="default","select3d"!=n&&hn.getCurrentpage().unselect3DBlockAll(),Dl(),bl(),hn.getCurrentpage().unSelect3DmarkupAll(),"markupedit"==n&&(s={p1:!1}),eu(n,null==s?{}:s)}else"Walkthrough3D"!=cn.name&&"orbitControl"!=cn.name&&eu(hn.curcontrol3D,null==s?{}:s),e||hn.getCurrentpage().unselect3DBlockAll(),cn&&cn.setSelect(e,s.p1)}function Bp(e){for(var t="default",a=0;a<xr.length;a++)e==xr[a].name&&(t=xr[a].cursor);return t}function Up(e,t,a,i){sn.push(new kn(e,t,a,i))}function Gp(e){if(yd())return e;hn.getCurrentpage().scaleObject.setDimPrecision(e),hn.getCurrentpage().scaleChanged()}function zp(e){if(!yd())return hn.getmarkupobjbyGUID(e)}function Hp(e,t){if(!yd()){if(t){var i=e;if(null==hn.markuplist[i])return}else i=hn.getmarkupbynumber(e);hn.markuplist.length-1<i||hn.markuplist[i].locked||(t?function(e){null!=hn.markuplist[e]&&(hn.markuplist[e].selected&&(hn.markuplist[e].setselect(!1),hn.markuplist[e].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[e])),hn.markuplist[e].selectedit&&(hn.markuplist[e].setselectedit(!1),hn.markuplist[e].bpointEdit=!1,hn.markuplist[e].bUsemouseinput=!0,null!=aa&&aa.setMarkupunSelected(hn.markuplist[e])))}(e):vl(e),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n),Nl(a))}}function _p(e,t,a,i){var r,n;if(e&&(hi=e.width,di=e.height,!gi))if(r=(ti-1*hi*t)/2+a,n=0+i,1==t)s.drawImage(e,r,n,hi*t,di*t);else{var o=Un(e,t);s.drawImage(o,r,n,hi*t,di*t),o=null}}function Wp(e){e?(i.style.visibility="hidden",i.style.zIndex="0"):(i.style.visibility="visible",i.style.zIndex="3")}function Xp(e){hn.getcurPage()!=e.pagenumber?zd(e.pagenumber).then((function(t){hn.panToMarkup(e)})):hn.panToMarkup(e)}function Yp(e,t){if(!yd()){var i=!0;if(t){var s=e;if(null==hn.markuplist[s])return}else s=hn.getmarkupbynumber(e);if(-1!=s){var r=hn.markuplist[s].selected||hn.markuplist[s].selectedit;if(!hn.markuplist[s].locked&&(cn&&(i="markupedit"!=cn.name),!i)){if(nn.isactive?(vl(e),fs||hn.getMarkupMultiselected()||(Dl(),bl())):fs||hn.getMarkupMultiselected()||(Dl(),bl()),null!=hn.markuplist[s].viewname&&hn.markuplist[s].bfor3D&&hn.getcur3DView()!=hn.markuplist[s].viewname&&hn.getCurrentpage().restoreCameraByName(hn.markuplist[s].viewname),hn.markuplist[s].signature!=Fr)return hn.markuplist[s].setmarked(!0),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n),Nl(a),void(ms&&Xp(hn.markuplist[s]));hn.markuplist[s].multipoint()?r||hn.markuplist[s].setselectedit(!0):r||(hn.markuplist[s].setselect(!0),hn.markuplist[s].lengthangleCallbackSelect()),null!=ea&&null!=hn.markuplist[s]&&(9==hn.markuplist[s].type&&2==hn.markuplist[s].subtype?ea.setMarkupSelected(hn.markuplist[s].markupArrowConnected,{created:!1,modified:!1,deleted:!1}):ea.setMarkupSelected(hn.markuplist[s],{created:!1,modified:!1,deleted:!1})),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n),Nl(a),ms&&Xp(hn.markuplist[s])}}}}function qp(e,t,a){const i=Hl();var s,r,n=e.getBoundingClientRect();return t&&t.targetTouches&&t.targetTouches[a]?(s=t.targetTouches[a].pageX-n.left,r=t.targetTouches[a].pageY-n.top):t&&t.changedTouches&&t.changedTouches[a]&&(s=t.changedTouches[a].pageX-n.left,r=t.changedTouches[a].pageY-n.top),{x:s*i,y:r*i,xus:s,yus:r,xpadding:s*i,ypadding:r*i,busepadding:!1}}function Zp(e,t){const a=Hl();var i=e.getBoundingClientRect();return{x:(t.clientX-i.left)*a,y:(t.clientY-i.top)*a,xus:t.clientX-i.left,yus:t.clientY-i.top,xpadding:(t.clientX-i.left)*a,ypadding:(t.clientY-i.top)*a,busepadding:!1}}function Jp(e,t,a,i,s){var r=Math.cos(s),n=Math.sin(s),o=a-e,l=i-t,c=new pn(o*r-l*n,o*n+l*r);return c.x=e+c.x,c.y=t+c.y,c}function Kp(e){if(!gi)return e;var t=ti/2,a=ai/2,i=hn.getCurrentpage().getpageRotation()*(Math.PI/180);if(0!=hn.getCurrentpage().getpageRotation()){var s=Jp(t,a,e.x,e.y,i);e.x=s.x,e.y=s.y}return e}function $p(e,t,a){if(0!=hn.getCurrentpage().getpageRotation()){var i=ti/2,s=ai/2;e.translate(i,s),e.rotate(hn.getCurrentpage().getpageRotation()*(Math.PI/180)),e.translate(-i,-s)}0!=t&&(i=ti/2,s=ai/2,e.translate(i,s),e.rotate(t*(Math.PI/180)),e.translate(-i,-s)),e.lineWidth=1,e.strokeStyle="blue",e.strokeRect(a.x-5,a.y-5,10,10)}function Qp(e,t){if(e.save(),0!=hn.getCurrentpage().getpageRotation())if(null!=hn.foxitdoc);else{var a=ti/2,i=ai/2;e.translate(a,i),e.rotate(hn.getCurrentpage().getpageRotation()*(Math.PI/180)),e.translate(-a,-i)}e.lineWidth=2,e.strokeStyle="blue",e.clearRect(t.x-50,t.y-50,100,100);var s=2*Qa;1==t.type&&e.strokeRect(t.x-Qa,t.y-Qa,s,s),2==t.type&&(e.beginPath(),e.moveTo(t.x-Qa,t.y-Qa),e.lineTo(t.x+Qa,t.y+Qa),e.moveTo(t.x+Qa,t.y-Qa),e.lineTo(t.x-Qa,t.y+Qa),e.stroke()),3==t.type&&(e.beginPath(),e.moveTo(t.x,t.y-Qa),e.lineTo(t.x+Qa,t.y+Qa),e.lineTo(t.x-Qa,t.y+Qa),e.lineTo(t.x,t.y-Qa),e.stroke()),e.restore()}function eu(e,t){cn&&"pencil"==cn.name&&cn.started&&(cn.apply(),Dl(),bl());var a=Bl(),i=function(){var e=!1;return yd()||null!=hn.getCurrentpage()&&(e=hn.getCurrentpage().usevector3Dxml),e}(),s="markupedit"==e;"orbitControl"==e||"Walkthrough3D"==e?(xi=!0,null!=hn.getCurrentpage().Vector3DPageObj&&hn.getCurrentpage().Vector3DPageObj.setcur3DViewnull()):xi=!(!a||!i),a&&i&&s&&(e=hn.curcontrol3D),"orbitControl"==(cn=new mn[e](t)).name&&null!=hn.getCurrentpage().Vector3DPageObj&&hn.getCurrentpage().Vector3DPageObj.setControl(cn),"Walkthrough3D"==cn.name&&null!=hn.getCurrentpage().Vector3DPageObj&&hn.getCurrentpage().Vector3DPageObj.setControl(cn)}function tu(e){if(e.layerX||0==e.layerY?(e._x=e.layerX,e._y=e.layerY):(e.offsetX||0==e.offsetY)&&(e._x=e.offsetX,e._y=e.offsetY),null!=cn){var t=cn[e.type];t&&t(e)}}function au(){if(ye&&wi){if(console.log("rxcorejs 37.14"),null!=Ta&&(Ta.setupComplete(Ss),ve=!0),xe&&(Ss.index?su(Ss.index):su()),null!=va){var e={consolidate:Gr};va.UserPermissions(e)}ye=!1}}function iu(e){try{e.getElementsByTagName("Context")[0].firstChild.nodeValue}catch(e){}try{var t=e.getElementsByTagName("Licensemode")[0].firstChild.nodeValue}catch(e){t=""}try{var a=e.getElementsByTagName("CompanyFeature")[0].firstChild.nodeValue}catch(e){a=""}""!=a&&(Ci=!0,ci=a);try{var i=e.getElementsByTagName("ImgSwitchFactor")[0].firstChild.nodeValue}catch(e){pi=1.5}try{var s=e.getElementsByTagName("CurrentUserName")[0].firstChild.nodeValue}catch(e){s=""}try{var r=e.getElementsByTagName("DisplayName")[0].firstChild.nodeValue}catch(e){r=""}try{var n=e.getElementsByTagName("MarkupLayer")[0].firstChild.nodeValue}catch(e){n=""}try{var o=e.getElementsByTagName("MarkupColor")[0].firstChild.nodeValue}catch(e){o=""}try{var l=e.getElementsByTagName("XmlUrl")[0].firstChild.nodeValue}catch(e){l=""}try{var c=e.getElementsByTagName("XmlUrlmarkup")[0].firstChild.nodeValue}catch(e){c=""}try{var h=e.getElementsByTagName("MarkupSavePOSTOnly")[0].firstChild.nodeValue}catch(e){h=""}Oi=""!=h&&"True"==h;try{var d=e.getElementsByTagName("XmlUrlRel")[0].firstChild.nodeValue}catch(e){d=""}try{var p=e.getElementsByTagName("MarkupSaveUrl")[0].firstChild.nodeValue}catch(e){p=""}try{var u=e.getElementsByTagName("ExportFile")[0].firstChild.nodeValue}catch(e){u=""}try{var g=e.getElementsByTagName("Image3DSave")[0].firstChild.nodeValue}catch(e){g=""}try{var f=e.getElementsByTagName("UseAuth")[0].firstChild.nodeValue}catch(e){f=""}try{var m=e.getElementsByTagName("AuthType")[0].firstChild.nodeValue}catch(e){m=""}try{var y=e.getElementsByTagName("AuthName")[0].firstChild.nodeValue}catch(e){y=""}try{var v=e.getElementsByTagName("AuthPass")[0].firstChild.nodeValue}catch(e){v=""}try{var x=e.getElementsByTagName("PrintPageURL")[0].firstChild.nodeValue}catch(e){x="printcanvas.htm"}try{e.getElementsByTagName("EnableMarkupEdit")[0].firstChild.nodeValue}catch(e){}try{var b=e.getElementsByTagName("CanChangeSignature")[0].firstChild.nodeValue}catch(e){b=""}try{var w=e.getElementsByTagName("CanConsolidate")[0].firstChild.nodeValue}catch(e){w=""}try{var k=e.getElementsByTagName("CanChangeLayer")[0].firstChild.nodeValue}catch(e){k=""}try{var D=e.getElementsByTagName("Readonlymarkup")[0].firstChild.nodeValue}catch(e){D=""}try{e.getElementsByTagName("EnableFileOpen")[0].firstChild.nodeValue}catch(e){}try{var R=e.getElementsByTagName("ReverseScale")[0].firstChild.nodeValue}catch(e){R=""}try{var S=e.getElementsByTagName("DefaultPenTable")[0].firstChild.nodeValue}catch(e){S=""}try{var M=e.getElementsByTagName("InitialDocument")[0].firstChild.nodeValue}catch(e){M=""}try{var T=e.getElementsByTagName("UseCustom")[0].firstChild.nodeValue}catch(e){T=""}try{var F=e.getElementsByTagName("Paperwidth")[0].firstChild.nodeValue}catch(e){F="794"}try{var I=e.getElementsByTagName("Paperheight")[0].firstChild.nodeValue}catch(e){I="1122"}try{var j=e.getElementsByTagName("ArrowSize")[0].firstChild.nodeValue}catch(e){j="20"}er=parseInt(j);try{var A=e.getElementsByTagName("LabelSize")[0].firstChild.nodeValue}catch(e){A="12"}ir=parseInt(A);try{var O=e.getElementsByTagName("RefreshMarkup")[0].firstChild.nodeValue}catch(e){O=""}try{e.getElementsByTagName("PDFZoomAll")[0].firstChild.nodeValue}catch(e){""}try{var L=e.getElementsByTagName("PDFAnimateRender")[0].firstChild.nodeValue}catch(e){L=""}zi=""!=L&&"True"==L;try{var V=e.getElementsByTagName("NoRotateMarkup")[0].firstChild.nodeValue}catch(e){V=""}try{var N=e.getElementsByTagName("layer");if(N.length>0)for(var B=0;B<N.length;B++){var U=N[B].getElementsByTagName("name")[0].firstChild.nodeValue,G=N[B].getElementsByTagName("color")[0].firstChild.nodeValue,z=N[B].getElementsByTagName("number")[0].firstChild.nodeValue;if("on"==N[B].getElementsByTagName("state")[0].firstChild.nodeValue)var H=!0;else H=!1;Dr[B]=new Zn(z,G,U,H)}}catch(e){Po()}try{var W=e.getElementsByTagName("stamp");if(W.length>0){for(var X=0;X<W.length;X++)kr[X]=W[X].firstChild.nodeValue;kr[X]="Date",kr[X+1]="User Name"}else kr=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"]}catch(e){kr=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"]}kr.length>0&&null!=Gt&&Gt.setMarkupStamps(kr),""!=t&&(ls=t),""!=i&&(pi=parseFloat(i)),""!=s&&(Fr=s),""!=r&&(Ir=r),""!=n&&(Rr=parseInt(n)),""!=o&&(Pr=o,Mr=o,Tr=o),fp(Fr,Ir,Rr,Pr),null!=je&&je.setUserlist(wr,!0),ch(0,"",!1),""!=l&&(C=l),""!=c&&(P=c),""!=d&&($=d),""!=p&&(E=p),""!=u&&(_=u),""!=g&&(Z=g),""!=x&&x,Hr=""!=D&&"True"==D,Ei=""!=V&&"True"==V,""!=f&&(_r="True"==f),""!=m&&(Yr=m),""!=y&&(qr=y),""!=v&&(Zr=v),Ur=""!=b&&"True"==b,Gr=""!=w&&"True"==w,Br=""!=k&&"True"==k,Kr=""!=R&&"True"==R,Jr=""!=O&&"True"==O,""!=S&&(Ts=!0,function(e){if(null!=PenTableFile){var t=PenTableFile+"&"+e;Fh("GET",t,"").then((function(e){var t=e.substr(0,e.length-2);Es=Object.freeze(JSON.parse(t)),null!=Oe&&Oe.setPentablelist(Es,!0)})).catch((function(e){e.status?console.log("defaultpentable",e.status):console.log(e)}))}}(S)),""!=M&&Ld(M),Ss.custom=""!=T&&"True"==T,new Xn(F,I),ye=!0,au()}function su(e){null!=Ea&&(e&&(Ss.index=e),ve&&(Ea.setupComplete(Ss),Vd(!0),Bd()),xe=!0)}function ru(e,t){t&&(t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)}function nu(e){s&&(s.imageSmoothingEnabled=e,s.mozImageSmoothingEnabled=e,s.msImageSmoothingEnabled=e)}function ou(e,a){lu(r,e,a),lu(t,e,a),Vl(n),cn.refreshSupport&&cn.refreshDraw()}function lu(e,t,a){var i,s,r=t,n=a;const o=Hl();var l=e.style;return e.width=Math.floor(t*o),e.height=Math.floor(a*o),i=Math.floor(t*o),s=Math.floor(a*o),1!=o&&(l.width=t+"px",l.height=a+"px",r=t,n=a),{awidth:i,aheight:s,swidth:r,sheight:n}}function cu(t,a){if(Hl(),t=t||Pe.offsetWidth,a=a||Pe.offsetHeight,e.offsetParent&&(Pe.absolute||(t+=e.offsetParent.offsetLeft,a+=e.offsetParent.offsetTop)),Pe.absolute){var s=lu(i,t,a);ti=s.awidth,ai=s.aheight,ii=s.swidth,si=s.sheight}else s=lu(i,window.innerWidth-t,window.innerHeight-a),ti=s.awidth,ai=s.aheight,ii=s.swidth,si=s.sheight;if(!yd()&&gi&&!hn.getCurrentpage().usevector3Dxml){window.innerWidth,gi&&hn.getCurrentpage().usepdfjs,nu(!1)}}function hu(e,o,l){if(i){if(cu(o,l),lu(r,ii,si),lu(t,ii,si),lu(d.domElement,ii,si),yd()){if(!le){hi=gn.naturalWidth,di=gn.naturalHeight;var c=ai/di,h=ti/hi,p=Math.min(h,c),u=(ti-hi*p)/2,g=(ai-di*p)/2;a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),Ch(gn,u,g,p)}}else gi&&hn.getCurrentpage().usevector3Dxml&&(d.setSize(ii,si),hn.getCurrentpage().camera&&(hn.getCurrentpage().camera.aspect=ii/si,hn.getCurrentpage().camera.updateProjectionMatrix())),hn.getCurrentpage().resize();if(e){if(null!=ca){var f={w:ti,h:ai};ca.onResize(f)}}else null!=ha&&(f={w:ti,h:ai},ha.onResize(f))}}function du(){if(null!=qt&&hn&&hn.selectedmarkup&&hn.selectedmarkup.edit){qt.operation.edit=!1,qt.operation.start=!1,qt.operation.create=!1,qt.operation.save=!0,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var e=t.getBoundingClientRect(),a=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+e.left,i=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+e.top,s=hn.markuplist[hn.selectedmarkup.id].wscaled,r=hn.markuplist[hn.selectedmarkup.id].hscaled,n=new Yn(a,i,s,r);n.rotation=hn.getCurrentpage().getpageRotation();var o=Hl();n.x=(n.x-e.left)/o+e.left,n.y=(n.y-e.top)/o+e.top,n.w=n.w/o,n.h=n.h/o,qt.setTextInput(n),hn.markuplist[hn.selectedmarkup.id].selectedit=!1,hn.markuplist[hn.selectedmarkup.id].setselect(!1),hn.selectedmarkup.edit=!1}}function pu(e){const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="annotations.xfdf",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(t)},0)}function uu(){return{areaUnitlabel:Zs,bMarkupNoLabel:$r,compareObj:dn,docObj:hn,bdirectPDF:hn.directPDF,onPrintpage:za,onPrintCompare:Wa,documentcompare:mi,getDisplayName:Kn,getHatch:Uo,getPageObject:yh,getPaperHeight:mh,getPaperWidth:fh,getPrintRect:gh,markupprintlist:br,measureScale:Js,printfocus:kh,stampList:kr,Userlist:wr,unitLabel:qs,unitOfMeasure:Ys,unitscale:hr,getUnitArea:qo,xmlurlrel:$,bUseCustomrelpath:he,xmlurlrelcustom:fe,noteimage:ln,bUseFixedScale:Mi,fixedScale:hn.getCurrentpage().fixedScale}}function gu(){return{getUnitLabel:function(){return yd()?Zs:hn.getCurrentpage().scaleObject.AreaUnitlabel},getAreaUnitLabel:function(){return yd()?Zs:hn.getCurrentpage().AreaUnitlabel},getLength:function(e){return Qo(e/lo())}}}return Ie=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setActiveFile=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ot=new sd,Lt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockID=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.onBlockHover=function(e,a){t.blockHoverCallback&&t.blockHoverCallback(e,a)}}},Vt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.unselectAll=function(){"function"==typeof t.callback&&t.callback()}}},Et=new sd,Ft=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockInfo=function(e){this.info=e,"function"==typeof t.callback&&t.callback(e)}}},It=new rd,jt=new rd,At=new rd,Ct=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setCameraSave=function(e,t,a){a||this.notify(e,t)}}},Ye=new id,Rt=new nd,Pt=new nd,St=new nd,Ke=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.renderComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},$e=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setXMLreturn=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},kt=new class{constructor(e){var t=this;this.listheight=0,this.isupdate=!1,this.scrollto=0,this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.setlistHeight=function(e){t.listheight=e},this.set3DParts=function(e){this.parts=e,"function"==typeof t.callback&&t.callback(e)}}},Dt=new id,da=new class{constructor(e){var t=this;this.callback=e,this.elementSet=!1,this._wheelImg=void 0,this.connect=function(e){t.callback=e},this.setDivElement=function(e){Cs&&(Gh(e),this.elementSet=!0)},this.setWalkthroughGUI=function(e){"function"==typeof t.callback&&t.callback(e)}}},Wt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getUnitlabel=function(){return hn.getCurrentpage().scaleObject.Unitlabel},this.setCalibration=function(e){var t=-1;gi?(Ks=hn.getCurrentpage().scaleObject.setCalibration(e),t=hn.getCurrentpage().pagenumber,hn.getCurrentpage().scaleChanged()):e?0!=Qs&&(Js=Ks=1/(Ks=$s/Qs)):Ks=1;var a={calibratescale:Ks,pagenumber:t};null!=Xt&&Xt.onCalibrate(a)},this.SetTempCal=function(e){Qs=e},this.setCalibrateScaleByLength=function(){0!=Qs&&(Ks=1/(Ks=$s/Qs))},this.setCalibrateScale=function(e){Ks=e},this.getMeasureScale=function(){return Ks},this.setCalibrate=function(e){"function"==typeof t.callback&&t.callback(e)}}},Xt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onCalibrate=function(e){"function"==typeof t.callback&&t.callback(e)}}},pa=new ud,na=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.cameraPos=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},oa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.drawbirdseye=function(){"function"==typeof t.callback&&t.callback()}}},ga=new ud,fa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.AlignComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},Xa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.AlignMeasure=function(e,a,i,s,r){"function"==typeof t.callback&&t.callback(e,a,i,s,r)}}},ma=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.Consolidatevt=function(){"function"==typeof t.callback&&t.callback(nn)}}},ya=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.Consolidatevt=function(e){"function"==typeof t.callback&&t.callback(e)}}},va=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.UserPermissions=function(e){"function"==typeof t.callback&&t.callback(e)}}},ka=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.TextCopied=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},xa=new class{constructor(e){var t=this;this._pagesRefCache=Object.create(null),this.callback=e,this.connect=function(e){t.callback=e},this.getPageRef=function(e){var a=-1;if(hn.getCurrentpage().usepdfjs){var i=e.num+" "+e.gen+" R";null!=t._pagesRefCache[i]&&(a=t._pagesRefCache[i])}return a},this.setPageRef=function(e){t._pagesRefCache=e},this.setPDFBookmarks=function(e){"function"==typeof t.callback&&t.callback(e)}}},la=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setDownload=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ge=new cd,ze=new cd,He=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getUnitlabel=function(){return hn.getCurrentpage().scaleObject.Unitlabel},this.setFileInfo=function(e){this.fileinfo=e,"function"==typeof t.callback&&t.callback(e)}}},ua=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setEvent=function(e){"function"==typeof t.callback&&e.addEventListener("contextmenu",t.callback,!1)}}},qe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.closeComplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Ze=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.guidcomplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},_e=new cd,p=new cd,We=new cd,u=new cd,Xe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.compareComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},Qe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},et=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setFloorLevel=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},st=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.navClick=function(e){"function"==typeof t.callback&&t.callback(e)}}},mt=new cd,tt=new ld,at=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Ue=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupHover=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},it=new ld,$t=new Kh,ea=new Kh,Tt=new Kh,Qt=new Kh,new Kh,f=new td,rt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.viewEvent=function(e){"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},Ne=new Xh,Be=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getCurMarkupLayer=function(){return Rr},this.getCanChangelayer=function(){return Br},this.SetLayerMarkupdisplay=function(e,t){var i=0;for(Dr[e].display=t,i=0;i<hn.markuplist.length;i++){var s=$n(hn.markuplist[i].signature);hn.markuplist[i].layer==Dr[e].Layer&&s&&hn.markuplist[i].setdisplay(Dr[e].display)}Vl(n),Nl(a)},this.setMarkupLayers=function(e){"function"==typeof t.callback&&t.callback(e)}}},Nt=new dd,Bt=new dd,Ut=new dd,Mt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getDisplayName=function(e){return Kn(e)},this.getDisplayDate=function(e){return GetDateTime(e)},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setMarkupList=function(e,t,a){this.markupList=e,a||this.notify(e,t)}}},ta=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.markupLink=function(e){"function"==typeof t.callback&&t.callback(e)}}},ia=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setdimtext=function(e){"function"==typeof t.callback&&t.callback(e)}}},aa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setMarkupunSelected=function(e){"function"==typeof t.callback&&t.callback(e)}}},_t=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getLength=function(e){return gu.getLength(e)},this.getUnitlabel=function(){return hn.getCurrentpage().scaleObject.Unitlabel},this.getAreaUnitlabel=function(){return hn.getCurrentpage().scaleObject.AreaUnitlabel},this.setMeasureresult=function(e){"function"==typeof t.callback&&t.callback(e)}}},Zt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.isAvailable=function(){return null!=Yo()&&-1!=Yo().id&&10==hn.markuplist[Yo().id].type},this.getText=function(){return t.isAvailable?hn.markuplist[Yo().id]:null},this.setText=function(e){if(t.isAvailable){if(null!=hn.markuplist[Yo().id]){var i=hn.markuplist[Yo().id];if(i.text=e,null!=Qt){var s=i.editaction;Qt.setMarkupSelected(i,s)}}Vl(n),Nl(a)}},this.setNotediag=function(e,a){if("function"==typeof t.callback)if(""==e||"."==e){if(null==Yo())return;hn.markuplist[Yo().id].text=t.callback("")}else t.callback(e,a)}}},nt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},ot=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},g=new od,lt=new od,ct=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.PassWordRequest=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},ht=new td,pt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.notify=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)},this.scalechanged=function(e,t,a){this.notify(e,t,a)}}},ut=new ed,gt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setFloorCanvas=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},dt=new ed,ft=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.getCurrentPage=function(){return hn.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<hn.markuplist.length;a++)hn.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.pageindex,this.thumbnail)},this.setThumbnail=function(e,t){this.thumbnail=t,this.pageindex=e,this.notify()}}},ca=new zh,ha=new zh,Gt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setMarkupStamps=function(e){"function"==typeof t.callback&&t.callback(e)}}},zt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onStampReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ht=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onSymbolReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Jt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setGUIState=function(e){this.state=e,"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},Kt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.pageEvent=function(e){"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},m=new Wh,ba=new Wh,wa=new Wh,Yt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setText=function(e){null!=hn.markuplist[Yo().id]&&(hn.markuplist[Yo().id].text=e,hn.markuplist[Yo().id].AdjustForRotation(!1),Vl(n),Nl(a))},this.setTextdiag=function(e){"function"==typeof t.callback&&(""==e||"."==e?(hn.markuplist[Yo().id].text=t.callback(""),hn.markuplist[Yo().id].AdjustForRotation(!1),Vl(n),Nl(a)):t.callback(e))}}},qt=new class{constructor(e){var t=this;this.callback=e,this.operation={start:!1,create:!1,edit:!1,save:!1},this.connect=function(e){t.callback=e},this.getText=function(e){return null==hn||null==hn.markuplist?null:null!=hn.markuplist[Yo().id]?hn.markuplist[Yo().id]:null},this.getTextinitset=function(){return null!=hn&&null!=hn.markuplist&&(null!=hn.markuplist[Yo().id]?hn.markuplist[Yo().id].intialtextset:void 0)},this.setText=function(e){null!=hn&&null!=hn.markuplist&&null!=hn.markuplist[Yo().id]&&(t.operation.edit=!1,t.operation.start=!1,t.operation.create=!1,t.operation.save=!1,hn.markuplist[Yo().id].setText(e),hn.markuplist[Yo().id].intialtextset=!0)},this.setSize=function(e){null!=hn&&null!=hn.markuplist&&null!=hn.markuplist[Yo().id]&&(t.operation.edit=!1,t.operation.start=!1,t.operation.create=!1,t.operation.save=!1,hn.markuplist[Yo().id].setSize(e))},this.setTextInput=function(e){"function"==typeof t.callback&&t.callback(e,t.operation)}}},sa=new Zh,ra=new Zh,Je=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.listempty=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},je=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getSignature=function(){return Fr},this.setSignature=function(e){Fr=e},this.getCanChangeSign=function(){return Ur},this.SetUserMarkupdisplay=function(e,t){var i=0;for(wr[e].display=t,i=0;i<hn.markuplist.length;i++){var s=eo(hn.markuplist[i].layer);hn.markuplist[i].signature==wr[e].Signature&&s&&hn.markuplist[i].setdisplay(wr[e].display)}Vl(n),Nl(a)},this.setUserlist=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Ae=new Qh,Oe=new Qh,Le=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onSignReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ve=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.oncomplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},xt=new ad,bt=new ad,wt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setVectorBlock=function(e){"function"==typeof t.callback&&t.callback(e)}}},yt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return ai},this.setVectorLayers=function(e){"function"==typeof t.callback&&t.callback(e)}}},vt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setVectorLayer=function(e){"function"==typeof t.callback&&t.callback(e)}}},Da=new Hh,Ca=new Hh,Pa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.backgroundColorChange=function(e){"function"==typeof t.callback&&t.callback(e)}}},Sa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.ViewModeChange=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ia=new _h,v=new _h,Ra=new Xh,Ma=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.markupPaths=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ta=new Yh,Ea=new Yh,Fa=new qh,y=new qh,ja=new class{constructor(e){var t=this;this.hastext=!1,this.callback=e,this.connect=function(e){t.callback=e},this.hasText=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Oa=new Jh,Na=new Jh,Ba=new Jh,La=new class{constructor(e){var t=this;this.hastext=!1,this.seachText="",this.wholeText=!1,this.casesens=!1,this.callback=[e],this.connect=function(e){t.callback=[...t.callback,e]},this.setFilter=function(e,t,a){this.seachText=e,this.casesens=t,this.wholeText=a},this.matchesFound=function(e){t.callback.forEach(t=>{"function"==typeof t&&t(e)})},this.isCaseSensitive=function(){return this.casesens}}},x=new class{constructor(e){var t=this;this.callback=[e],this.connect=function(e){t.callback=[...t.callback,e]},this.onRemovePage=function(e){t.callback.forEach(t=>{"function"==typeof t&&t(e)})}}},Va=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.countChanged=function(e){"function"==typeof t.callback&&t.callback(e)}}},Aa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setHatchchange=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ua=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setInput=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ga=new Jh,za=new class{constructor(){var e=this;this.callback=void 0,this.connect=function(t){e.callback=t},this.printpageComplete=function(t){"function"==typeof e.callback&&void 0!==e.callback&&e.callback(t)}}},Ha=new $h,_a=new $h,Wa=new class{constructor(){var e=this;this.callback=void 0,this.connect=function(t){e.callback=t},this.printCompareComplete=function(t){"function"==typeof e.callback&&void 0!==e.callback&&e.callback(t)}}},Ya=new hd,b=new hd,qa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onDrawError=function(e){"function"==typeof t.callback&&t.callback(e)}}},Za=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setRespHeaders=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ja=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupMeasureRealTimeData=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},{abortPDFload:function(e){Ii=e,Qd()},add3Dsymbol:function(e,t){Np(e,"add3dsymbol",{p1:t})},addAnnotationFoxit:function(e,t){yd()||Hr||mi||function(e,t){yd()||null!=hn.foxitdoc&&hn.foxitdoc.addAnnotation(e,t)}(e,t)},addGltftoDoc:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&function(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetFile</Command>",t+="<LicenseID>"+os+"</LicenseID>",t+="<FileURL>"+e+"</FileURL>",Eh("POST",C,t+="</RxViewServer>").then((function(e){var t,a=0,i=$,s=e.getElementsByTagName("Layout");for(t=0;t<s.length;t++){s[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;var r=s[t].getElementsByTagName("Page");for(a=0;a<r.length;a++)if(0==a&&0==t&&null!=r[a].getElementsByTagName("VectorGLTF3DSRC")[0]){var n=encodeURI(i+r[a].getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue),o=encodeURI(i+r[a].getElementsByTagName("VectorMetadataSRC")[0].firstChild.nodeValue);hn.getCurrentpage().addtoGLTFScene(n,o)}}})).catch((function(e){gd("getFileaddtoGLTF",e)}))}(e)},addSignature:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("symbol",{p1:4}):eu("markupedit",{p1:!1})))},addMovableSignature:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("symbol",{p1:5}):eu("markupedit",{p1:!1})))},autoUpload:function(e){},updateScaleList:function(e){hn.scalesOptions=e},getDocScales:function(){var e=void 0;if(!yd())return hn&&(e=hn.scalesOptions),e},allowPolygonMove:function(e){Ji=e},autoHyperlink:function(e){bautohyperlink=e},measure3D:function(e){Np(e,"measure3D",null)},create3DTexture:Up,addMarkup:function(e){var t=So(e);if(null!=t.getElementsByTagName("FileVersion")&&0!=t.getElementsByTagName("FileVersion").length)var a=t.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=t.getElementsByTagName("Entity")){for(var i=t.getElementsByTagName("Entity"),s=0;s<i.length;s++){var r=i[s].getElementsByTagName("Type")[0].firstChild.nodeValue,o=i[s].getElementsByTagName("Subtype")[0].firstChild.nodeValue,l=i[s].getElementsByTagName("Alternative")[0].firstChild.nodeValue,c=i[s].getAttribute("ID")?i[s].getAttribute("ID"):null;if(null!=i[s].getElementsByTagName("HaveLeader")[0])var h=1==parseInt(i[s].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(h&&null!=i[s].getElementsByTagName("Entity")[0]){var d=i[s].getElementsByTagName("Entity")[0],p=d.getElementsByTagName("Type")[0].firstChild.nodeValue,u=d.getElementsByTagName("Subtype")[0].firstChild.nodeValue,g=d.getElementsByTagName("Alternative")[0].firstChild.nodeValue;d.getAttribute("ID")&&d.getAttribute("ID"),p=parseInt(p),u=parseInt(u),g=parseInt(g);var f=new cl(p,u,g),m=f.SetfromXML(hn,d,a);m&&(i[s].removeChild(d),f.savemetolistLoad(hn,!1))}r=parseInt(r),o=parseInt(o),l=parseInt(l);var y=new cl(r,o,l);if(y.markupID=c,y.SetfromXML(hn,i[s],a)&&(m&&h&&null!=f&&(y.bhasArrow=h,y.markupArrowConnected=f,f.bisTextArrow=!0,f.textBoxConnected=y,f.setArrowPoint(y),m=!1,h=!1),y.savemetolistLoad(hn)),null!=i[s].getElementsByTagName("Signature")[0].firstChild.nodeValue){var v=i[s].getElementsByTagName("Signature")[0].firstChild.nodeValue;if(null!=i[s].getElementsByTagName("Name")[0].firstChild.nodeValue)var x=i[s].getElementsByTagName("Name")[0].firstChild.nodeValue;if(v&&x&&"default user"==Kn(v)){wr.length;var b=Qn(y.layer);wr.push(new qn(v,x,y.layer,b,!1)),wr.length}}}y&&y.notify(),0==i.length&&null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n)}},addHoverforBlock:function(e,t){if(!yd()&&e&&hn.getCurrentpage().usevectorxml){var a=hn.getCurrentpage().getpolygonPathbypathIndex(e);if(null!=a){var i=function(e,t){var a=t.points[0],i=t.points[1],s=[];s.push({x:a,y:i});for(var r=0,n=0,o=2;o<t.points.length;o+=2)r=t.points[o],n=t.points[o+1],s.push({x:r,y:n});var l=Ro(s),c=[];if(t.gotsubpath)for(var h=0;h<t.subpaths.length;h++){for(o=0;o<t.subpaths[h].points.length;o+=2)r=t.subpaths[h].points[o],n=t.subpaths[h].points[o+1],c.push({x:r,y:n});var d=Ro(c);d>l&&(s=c.slice(),c=[],l=d)}return{path:s,color:e}}(t,a);hn.addHoverSpace(i),Vl(n)}}},alignCompare:function(e){if(!yd()){Dl(),bl();var t=Ud();null!=t&&t.scalecomparepage(e)}},alignCompareEx:function(e,t){if(!yd()&&gi){Dl(),bl();for(var a=0;a<yn.length;a++)if(yn[a].fileindex==t){yn[a].scalecomparepage(e);break}}},appendCustomBlockAttribute:function(e,t,a){yd()||mi||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().appendCustomBlockAttribute(e,t,a)},animateLineStyle:dp,applyAngleLength:function(e,t,a,i){cn.anglelengthsupport&&cn.started&&cn.setAngleLength(e,t,a,i)},applyAngleLengthSelected:hp,applyMarkup:function(){cn.anglelengthsupport&&cn.started&&cn.apply()},applyRadiusSelected:function(e){hp(0,e)},adjustTextAnnotationHeight:function(e,t,a){var i=function(e){for(var t,a={isempty:!0},i=0,s=0,r=0;r<hn.markuplist.length;r++)i=((t=hn.markuplist[r]).h/t.w).toFixed(6),null!=t.initalHeight&&null!=t.initalWidth&&(s=(t.initalHeight/t.initalWidth).toFixed(6)),i==e?(t.initalHeight=t.h,t.initalWidth=t.w,a=t):s==e&&(a=t);return a}(a);if(!i.isempty)if(i.h<t){var s=t-i.h;s>22&&(s=15),i.h=t+s+22}else i.h>t+37&&(i.h=t)},applyWidthHeight:function(e,t){cn.anglelengthsupport&&cn.started&&cn.setWidthHeight(e,t)},applyWidthHeightSelected:function(e,i){var s=gl();if(!s.isempty&&s.widthHeightsupport){s.w,s.h;var r=s.setWidthHeightEdit(e,i),o={x:s.x+r.w,y:s.y+r.h};a.clearRect(0,0,t.width,t.height),fo(o)?(s.w=r.w,s.h=r.h,Vl(n),Nl(a),s.lengthangleCallbackSelect()):(Vl(n),Nl(a),null!=qa&&qa.onDrawError("outside"))}},attributeMask:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().filterAttributes(e)},autoLoadThumbnails:function(e){_i=e},backgroundColor:function(e){cs=e},backgroundCustomColor:function(e){yd()||(us=e,gs=!0,hn.backgroundColor=us,hn.getCurrentpage().usevectorxml&&("#FFFFFF"!=hn.backgroundColor&&"#000000"!=hn.backgroundColor||hn.getCurrentpage().invert_images(hn.backgroundColor),hn.getCurrentpage().draw_vector(!0),hn.refreshBirdsEye(),hn.renderBirdsEye()),Vl(n),null!=Pa&&Pa.backgroundColorChange(hn.backgroundColor))},blockhoverevent:function(e){qi=e},blockLoadMask:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().filterBlocks(e)},calibrate:function(e){yd()||(Dl(),bl(),e?(hn.getCurrentpage().enableSnap(!0),eu("calibrate",{})):(hn.getCurrentpage().enableSnap(!0),eu("markupedit",{p1:!1})))},canvToImage:function(){yd()||(Dl(),bl(),hn.getCurrentpage().usevector3Dxml&&jc())},change3DVectorBlock:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().turn3DBlockOnOff(e,!1)},set3DBlockState:function(e,t){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().state3dBlock(e,t,!1)},set3DBlockStateAll:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().state3dBlockAll(e,!1)},changeFillColor:function(e){Id(e,0)},changeFillColorByIndex:function(e,t){!function(e,t,a){if(!yd()&&!Hr&&null!=t&&"string"==typeof t){null!=t.match(/rgb/gi)&&(t=Ln(t));var i=Pr;switch(a){case 1:i=Mr,Mr=t,fl(e,1),zr||(Mr=i);break;case 0:i=Sr,Sr=t,fl(e,7),zr||(Sr=i);break;case 2:i=Tr,Tr=t,fl(e,8),zr||(Tr=i)}}}(e,t,0)},changeMarkupLayer:function(e){if(!yd()&&!mi){var t=Rr,a=Pr,i=Mr,s=Tr;Rr=e,Pr=Dr[e].Color,Mr=Pr,Tr=Pr,yl(0),zr||(Rr=t,Pr=a,Mr=i,Tr=s)}},changeSnapState:function(e){yd()||hn.getCurrentpage().enableSnap(e)},changeStrokeColor:function(e){Br&&Id(e,1)},changeTextColor:function(e){Br&&Id(e,2)},changeColor:Id,clearMarkupComments:function(){var e=gl();e.isempty||e.ClearComments()},changeColorAll:function(e,t){if(!yd()&&!Hr&&null!=e&&"string"==typeof e){null!=e.match(/rgb/gi)&&(e=Ln(e));var a=Pr;switch(t){case 1:a=Mr,Mr=e,yl(1,!0),zr||(Mr=a);break;case 0:a=Sr,Sr=e,yl(7,!0),zr||(Sr=a);break;case 2:a=Tr,Tr=e,yl(8,!0),zr||(Tr=a)}}},changeColorMarkup:function(e,t,a){if(!yd()&&!Hr&&null!=t&&"string"==typeof t){null!=t.match(/rgb/gi)&&(t=Ln(t));var i=Pr;switch(a){case 1:i=Mr,Mr=t,ml(e,1),zr||(Mr=i);break;case 0:i=Sr,Sr=t,ml(e,7),zr||(Sr=i);break;case 2:i=Tr,Tr=t,ml(e,8),zr||(Tr=i)}}},changeLabelTransp:function(e){if(!yd()&&!Hr){var t=Er;Er=e,yl(12),zr||(Er=t)}},changeTransp:function(e){var t=Er;Er=e,yd()||Hr||(yl(6),zr||(Er=t))},changeTranspMarkup:function(e,t){var a=Er;Er=t,yd()||Hr||e&&(ml(e,6),zr||(Er=a))},changeVectorBlock:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().turnBlockOnOff(e)},changeVectorBlockVisibility:function(e,t){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().changeBlockOnOff(e,t)},changePDFLayer:function(e,t){yd()||hn.turnPDFLayerOnOff(e,t)},changeVectorLayer:function(e){yd()||hn.getCurrentpage().turnLayerOnOff(e)},changeVectorLayerVisibility:function(e,t){yd()||hn.getCurrentpage().changeLayerOnOff(e,t)},checknewDoc:function(){foxitgetOpenDocs()==foxitgetnumDocs()&&addfoxitdoc()},checkLargePDF:function(e){yd()||hn&&hn.setLargePDF(e)},clearMarkup:function(){yd()||(hn.markuplist=[],hn.markupdraworder=[],yp(),mp(),hn.nummarkups=0,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=je&&je.setUserlist(wr,hn.bActive),Vl(n),Nl(a))},clearHover:function(){yd()||hn.getCurrentpage().usevectorxml&&(hn.clearHoverSpace(),Vl(n))},clipping3D:function(e,t,a){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.clipping(t,a,e)},closeAll:function(){if(!yd())for(;yn.length>0;)Qd()},closeDocument:function(e){return $d(e)},closeDocumentEx:function(e){return new Promise((function(t,a){qe.connect((function(e,a){a&&t(e)})),Qd(e)}))},compare:function(e){_d(e,0)},compareEx:Wd,compareDialog:function(){null!=pa&&(0==xn.length&&kd(),pa.CompareDialog())},compareFiles:function(e,t){Gd(e,t,0)},compareOverlayServer:function(e,t,a){if(null!=I){var i=[{Command:"Compare",LicenseID:os,BackURL:e,FrontURL:t,CompareDPI:200,BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)",ReturnData:"text"}];null!=a&&a.length>1&&(i.push(a[0]),i.push(a[1]));var s=JSON.stringify(i);Fh("POST",I,"",s).then((function(e){var t=$+e;null!=ze&&ze.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareOverlayServerJSON:function(e,t,a,i,s){if(null!=I){null==a&&(a={BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)"}),null==i&&(i=200);var r=[{Command:"Compare",LicenseID:os,BackURL:e,FrontURL:t,CompareDPI:i,BackColor:a.BackColor,FrontColor:a.FrontColor,EqualColor:a.EqualColor,ReturnData:"text"}];null!=s&&s.length>1&&(r.push(s[0]),r.push(s[1]));var n=JSON.stringify(r);Fh("POST",I,"",n).then((function(e){var t=$+e;null!=ze&&ze.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareOverlaySaveTo:function(e,t,a,i,s,r,n){if(null!=I){null==s&&(s={BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)"}),null==r&&(r=200);var o=[{Command:"Compare",LicenseID:os,BackURL:e,FrontURL:t,DestFolder:a,OutputName:i,CompareDPI:r,BackColor:s.BackColor,FrontColor:s.FrontColor,EqualColor:s.EqualColor,ReturnData:"text"}];null!=n&&n.length>1&&(o.push(n[0]),o.push(n[1]));var l=JSON.stringify(o);Fh("POST",I,"",l).then((function(e){var t=$+e;null!=ze&&ze.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareMeasure:function(e){yd()||mi||(hn.getCurrentpage().enableSnap(!0),eu("getoverlayscale",{p1:hn.getCurrentpage(),p2:e}))},compareNudgeOffset:function(e){if(!yd()){Dl(),bl();var t=Ud();null!=t&&t.nudgeoffset(e)}},compareNudgeRotate:function(e){if(!yd()){Dl(),bl();var t=Ud();null!=t&&t.nudgeRotate(e)}},compareNudgeScale:function(e){if(!yd()){Dl(),bl();var t=Ud();null!=t&&t.nudgeScale(e)}},compareOffset:function(e,t){if(!yd()){Dl(),bl();var a=Ud();null!=a&&a.offsetdirect(e,t)}},compareScale:function(){if(!yd()){Dl(),bl();var e=Ud();null!=e&&e.scalecompare()}},consolidate:function(e){Gr&&(nn.isactive=e,null!=ma&&ma.Consolidatevt())},consolidatedOnly:function(e){if(!yd()){for(var t=0;t<hn.markuplist.length;t++)hn.markuplist[t].consolidated||(hn.markuplist[t].display=e);Vl(n),Nl(a)}},copyMarkUp:function(){yd()||mi||ul()},cutMarkUp:function(){yd()||mi||(ul(),Fl())},create3Dfloorplan:function(e,t,a){yd()||yn[t].pages[0].usevector3DGLTF&&yn[e].renderFloorplan(yn[t].create3DFloorplan,a,null)},get3dFloorplanCanvas:function(e,t){yd()||null!=gt&&hn.renderFloorplan(gt.setFloorCanvas,e,t)},create3DfloorplanfromPage:function(e,t){yd()||yn[e].pages[0].usevector3DGLTF&&hn.renderFloorplan(yn[e].create3DFloorplan,t,null)},create3DfloorplanfromCanvas:function(e,t,a){yd()||hn.pages[0].usevector3DGLTF&&hn.create3DFloorplan(e,t,a)},replacefloorplan:function(e,t,a){yd()||yn[t].pages[0].usevector3DGLTF&&yn[e].replaceFloorNav(yn[t].setfloorplanNav,a)},replacefloorplanfromPage:function(e,t){yd()||yn[e].pages[0].usevector3DGLTF&&hn.replaceFloorNav(yn[e].setfloorplanNav,t)},createAreaAttributes:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().createAreaAttributes(e)},create3DMarkup:function(e){if(!yd()){var t=Bl();return t?Pd():function(e){if(!yd()&&hn.getCurrentpage().usevector3Dxml){var t=hn.getCurrentpage().Vector3DPageObj.getRestoreControl();if(t)switch(t){case"Walkthrough3D":Rd(!0);break;case"orbitControl":Cd()}}}(),!t}},createCustomStamps:function(e){var t={type:2,data:"Custom Stamps"};null!=zt&&zt.onStampReceived(t),t={type:3,data:e.numstamps},null!=zt&&zt.onStampReceived(t);for(var a=0;a<e.numstamps;a++)Zc(e.stamps[a],a)},createHatchStyles:function(){Bo(0,Pr),Bo(1,Pr),Bo(2,Pr),Bo(3,Pr),Bo(4,Pr),Bo(5,Pr)},createServerContent:function(e,t,a,i){if(he=!1,"object"==typeof e){var s="",r=!1;null!=e.filepath&&null!=e.filepath&&(s=e.filepath,r=!0);var n={filename:s,displayname:null,auth:null,xrefurl:null,cacheid:null,refresh:!1};t&&(n.refresh=!0),null!=e.mime&&null!=e.mime&&(n.mime=e.mime),null!=e.cacheid&&null!=e.cacheid&&(n.cacheid=e.cacheid),null!=e.auth&&null!=e.auth&&(n.auth=e.auth),null!=e.xrefurl&&null!=e.xrefurl&&(n.xrefurl=e.xrefurl),e.requestheaders,null!=e.displayname&&null!=e.displayname&&(n.displayname=e.displayname),r&&Gc(n,a,i)}else"string"==typeof e&&(n={filename:e,displayname:null,refresh:!1},t&&(n.refresh=!0),Gc(n,a,i))},gethatchimagebyType:function(e,t){return function(e,t){var a=document.createElement("canvas");a.width=16,a.height=16;var i=a.getContext("2d"),s=Lo(e);return No(i,e,t),{image:a,name:s,size:{w:16,h:16},color:t,description:"no description"}}(e,t)},createTempcanvArray:function(e){yd()||hn&&hn.createTempcanvArray(e)},createFoxitDoc:function(e){var i=encodeURIComponent(e.filename),s='<?xml version="1.0" encoding="UTF-8"?>\n';s+="<RxViewServer>\n",s+="<NumLayouts>1</NumLayouts>\n",s+="<Version>1</Version>\n",s+="<Format>Adobe PDF 1.2</Format>\n",s+="<FileName>"+i+"</FileName>\n",s+="<OriginalURL>"+i+"</OriginalURL>\n",s+="<FileNameSRC>"+i+"</FileNameSRC>\n",s+="<FileLocal>1</FileLocal>\n",s+="<Filter>RxFilterDynaPDF</Filter>\n",s+="<FileSizeLow>89192</FileSizeLow>\n",s+="<FileSizeHigh>0</FileSizeHigh>\n",s+="<Type>0</Type>\n",s+="<Layout>\n",s+="<LayoutName>Default</LayoutName>\n",s+="</Layout>\n";var r=So(s+="</RxViewServer>\n"),o=r.createElement("NumPages"),l=r.createTextNode(e.numpages.toString());o.appendChild(l),r.getElementsByTagName("RxViewServer")[0].appendChild(o);for(var c=0;c<e.numpages;c++){var h=r.createElement("Page");Qc(h,"PageName","Page "+(c+1)),Qc(h,"Compression","---"),Qc(h,"DPI","600"),Qc(h,"OffsetX","0.00000"),Qc(h,"OffsetY","0.00000"),Qc(h,"OriginalScale","1.00000"),Qc(h,"MainImageWidth","0"),Qc(h,"MainImageHeight","0"),Qc(h,"MainImageScaling","1.00000000"),Qc(h,"MainImageOffsetX","0.00000000"),Qc(h,"MainImageOffsetY","0.00000000"),r.getElementsByTagName("Layout")[0].appendChild(h)}return null!=la&&la.setDownload("hide"),function(e,i){if(Ii=!1,wi){var s;null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),yp(),mp(),gi&&Li&&Qd(),fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1),yn[fn-1]=hn,hn.foxitdoc=i,e.getElementsByTagName("Layout");for(var r=e.getElementsByTagName("Page"),o=0;o<r.length;o++)if(0==o){s=new Sc(r[o],"Default",!0,"",o,hn);var l=r[o],c="Default";hn.addthumbnail(new bc(r[o],"Default",hn,o)),hn.addpage(s,!0)}else hn.addthumbnail(new bc(r[o],"Default",hn,o)),o<Ds?(s=new Sc(r[o],"Default",!1,"",o,hn),hn.addpage(s,!1)):hn.addpage(void 0,!1);if(md()){l&&c&&(hn.tempPage=new Sc(l,c,!1,"",0,hn)),hn.pages[0].firstpage=!0,hn.bdestroyPDFonClose=!0,hn.setLargePDF(i.numpages),hn.ScrollBarCheck(),yn.length,hn.getCurrentpage().usepdfjs,hn.getCurrentpage().usevector3Dxml,hn.getCurrentpage().usevectorxml,i.numpages,hn.getcurPage(),hn.bActive;var h={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(h);for(var d=0;d<vr.length;d++)vr[d].filenameonly==i.filename&&Uc(vr[d],hn.fileindex);return hn.fileindex}}}(r,e)},createPageTileArray:function(e){if(mi)return dn&&dn.createPageTileArray(e),void Lp();yd()||hn&&hn.createPageTileArray(e)},setfoxitPageSize:function(e){yd()||hn&&hn.setfoxitPageSize(e)},setfoxitPageSizeEx:function(e){yd()||hn&&hn.setfoxitPageSizeEx(e)},foxitcalibratepagePosY:function(e){yd()||hn&&hn.foxitcalibratepagePosY(e)},foxitcalibratepagePosX:function(e,t){yd()||hn&&hn.foxitcalibratepagePosX(e,t)},foxitcalibratepagemarkup:function(e,t){yd()||hn&&hn.foxitcalibratepagemarkup(e,t)},foxitcalibratepagemarkupEx:function(e,t,a){yd()||hn&&hn.foxitcalibratepagemarkupEx(e,t,a)},foxitonScrollupdate:function(e,t){yd()||hn&&e&&hn.foxitonScrollupdate(e,t)},createTextRect:function(e,t,a,i,s){Cp(e,t,a,i,null,s)},createImageMarkup:function(e,i,s){if(!yd()&&!Hr&&!mi){Dl(),bl(),function(e){var t=0,i=0,s=[];for(hn.markupdraworder=[],t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&(11==hn.markuplist[t].type&&hn.markuplist[t].subtype==e?(rl(hn.markuplist[t].markupnumber,3),null!=$t&&$t.setMarkupSelected(hn.markuplist[t],{created:!1,modified:!1,deleted:!0})):(s[i]=hn.markuplist[t],hn.markupdraworder[i]=i,i++));hn.markuplist=s,hn.nummarkups=hn.markuplist.length,null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Vl(n),Nl(a)}(2);var r=new cl(11,2,0);r.scaling=lo();var o=ro();r.xoffset=o.x,r.yoffset=o.y,r.printscale=e.scale,r.pagenumber=hn.getcurPage(),r.viewname=hn.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=ai,r.pagewidth=ti),r.seteditaction(0),r.x=i,r.y=s,r.w=e.width,r.h=e.height,r.image=new Image,a.clearRect(0,0,t.width,t.height),ru(!1,n),Gs||(Ms=!0),Us=hn.markuplist.length,r.savemetolistDraw();var l,c,h=(l=r.image,c=e,new Promise((function(e,t){l.onload=function(t){e()},l.onerror=function(e){t()},l.src=c.src})));if(Dh(),r=null,zs){if(null!=$t){var d={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],d)}}else Gs||null==$t||(d={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],d));return h}},createSpaceFromPolygon:function(e){yd()||mi||(e?(Dl(),eu("pickPolygon",{p1:!1,p2:!0,p3:!0,p4:!1})):eu("markupedit",{p1:!1}))},createSpacefromBlock:function(e){if(!yd()&&hn.getCurrentpage().usevectorxml){var t=hn.getCurrentpage().dscalevector,a=hn.getCurrentpage().dxvector,i=hn.getCurrentpage().dyvector,s=hn.getCurrentpage().VectorPageObj.x,r=(hn.getCurrentpage().VectorPageObj.y,hn.getCurrentpage().VectorPageObj.h),o=hn.getCurrentpage().blockAttributes(e),l=hn.getCurrentpage().getpolygonPathbyblockID(e);null!=l&&function(e,t,a,i,s,r,o,l,c){var h=(t.points[0]-o)*i,d=(c-t.points[1])*i;h+=s,d+=r;var p=new cl(8,1,0);p.linewidth=1;for(var u=0;u<a.length;u++)p.AddAttribute(a[u].name,a[u].value);p.AddAttribute("Rx_Area","0");var g=e.toString();p.AddAttribute("SpaceID",g),p.scaling=i,p.xoffset=s,p.yoffset=r,p.addpoint(h,d);for(var f=0,m=0,y=2;y<t.points.length;y+=2)f=(t.points[y]-o)*i,m=(c-t.points[y+1])*i,f+=s,m+=r,p.addpoint(f,m);var v=p.PolygonArea(),x=[];if(t.gotsubpath)for(var b=0;b<t.subpaths.length;b++){for(y=0;y<t.subpaths[b].points.length;y+=2)f=(t.subpaths[b].points[y]-o)*i,m=(c-t.subpaths[b].points[y+1])*i,f+=s,m+=r,x.push({x:f,y:m});var w=Ro(x);w>v&&(p.points=x.slice(),x=[],v=w)}p.findrectangle(),Ms=!0,Us=hn.markuplist.length,p.markupID=Al(),p.savemetolistLoad(hn),Dh(),Vl(n),null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}(e,l,o,t,a,i,s,0,r)}},deleteMarkUp:ap,deletemarkupbyID:Ml,deleteVectorAttribute:function(e){yd()||mi||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().deleteVectorAttribute(e)},change3DMarkup:function(e){yd()||Hr||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().change3DMarkup(e)},change3DMarkupSize:function(e){yd()||Hr||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().change3DMarkupSize(e)},deleteCamera:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.deleteCameraView(e)},deleteMarkupbyGUID:function(e){yd()||Hr||mi||(xl(e),Vl(n),Nl(a))},deletePoint:function(){"markupedit"==cn.name&&cn.enablePointDelete()},disablewelcome:function(e){le=e},forceUniqueMarkup:function(e){ei=e},displayFloorplan:function(e,t,a){yd()||Hr||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().displayfloorplan(e,t,a)},documentOpened:function(){return void 0!==gi&&gi},doResize:hu,doResizeEx:function(e,o){if(i){if(function(e,t){if(Pe.absolute){e=e||Pe.offsetWidth,t=t||Pe.offsetHeight;var a=lu(i,e,t);ti=a.swidth,ai=a.sheight,ii=a.awidth,si=a.aheight,gi&&hn.getCurrentpage().usepdfjs,nu(!1)}}(e,o),yd()){if(!le){hi=gn.naturalWidth,di=gn.naturalHeight;var l=i.height/di,c=i.width/hi,h=Math.min(c,l),p=(i.width-hi*h)/2,u=(i.height-di*h)/2;a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),Ch(gn,p,u,h)}}else gi&&hn.getCurrentpage().usevector3Dxml&&(d.setSize(i.width,i.height),hn.getCurrentpage().camera&&(hn.getCurrentpage().camera.aspect=i.width/i.height,hn.getCurrentpage().camera.updateProjectionMatrix())),hn.getCurrentpage().resize();lu(r,ii,si),lu(t,ii,si),lu(d.domElement,ii,si)}},downloadSignature:function(e,t){if(null!=N&&(!t||null!=U)){var a=N+"&"+e;t&&(a=U+"&"+e),Fh("GET",a,"arraybuffer").then((function(a){var i=new Blob([a],{type:"image/png"});if(a){const a=new Image;a.src=URL.createObjectURL(i),a.onload=function(){var s={data:i,width:a.width,height:a.height,username:e,initials:t};null!=Le&&Le.onSignReceived(s)}}})).catch((function(e){e.status?console.log("signatureload",e.status):console.log("signatureload",e)}))}},drawPoints:function(){yd()||hn.getCurrentpage().usepdfjs&&hn.getCurrentpage().drawpoints(hn.getCurrentpage().PDFPointArray,hn.getCurrentpage().pdfSnapScale)},drawCanvas:function(e,t){s.fillStyle="rgb(238,243,250)",s.fillRect(0,0,ti,ai);var a=0;if(e.length&&e.length>0)for(var i=0;i<e.length;i++)"canvas"==e[i].tagName.toLowerCase()&&(_p(e[i],t,a,0),a+=e[i].width)},drawmarkupToCanvas:function(e,t,i,s){if(gi&&!yd()){var r=0;if(hn&&hn.getCurrentpage().usevector3Dxml)for(r=0;r<hn.markuplist.length;r++)null!=hn.markuplist[r]&&hn.markuplist[r].display&&hn.markuplist[r].bfor3D&&hn.markuplist[r].viewname==s&&hn.markuplist[r].drawWidthHeight(e,t,i);Vl(n),Nl(a)}},getPDFintialScale:function(e,t){var a=ai/t,i=ti/e;return Math.min(i,a)},getmarkupbyNumber:function(e){if(!yd())return!1!==hn.markuplist.find(t=>t.markupnumber===e)?hn.getmarkupobjbynumber(e):void 0},endMarkupTextSearch:function(){yd()||mi||hn.endMarkupTextSearch()},endTextSearch:function(){yd()||mi||hn.textsearchend()},endGetTextRects:function(){yd()||mi||hn.textrectsearchend()},enableCamNavDraw:function(e){vs=e},enableZoomOnScrollMultipage:function(e){Ls=e},forcetextsearchmarker:Yd,getTextRects:function(e,t){yd()||mi||hn.getTextRects(e,t)},exicompareMeasure:function(){yd()||mi||(hn.getCurrentpage().enableSnap(!1),eu("markupedit",{p1:!1}))},explode3D:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&(hn.getCurrentpage().Vector3DPageObj.doexplode=e)},explode3DDistance:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.doexplode&&hn.getCurrentpage().Vector3DPageObj.newExplode(e)},exportFile:function(e,t,a,i,s){yd()||(Dl(),bl(),hn.bLargePDF?function(e,t,a,i,s,r,n){var o={consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:s,useRaster:!1},l=new wn(hn);l.setOncomplete((function(e){Vc(o,e)})),l.createxmlexport(r,n,e)}(e,t,a,i,s,Fr,Ir):function(e,t,a,i,s){Vc({consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:s,useRaster:!1},ih(!1,e,Pi,Fr,Fr))}(e,t,a,i,s))},setDefultExportparams:function(e,t,a,i,s){Fe.consolidateonly=e,Fe.format=t,Fe.UPI=a,Fe.paperSize=i,Fe.markupFlag=s},exportFilePage:function(e,t,a,i,s,r){gi&&(Dl(),bl(),function(e,t,a,i,s,r){Vc({consolidateonly:e,format:a,UPI:i,paperSize:s,markupFlag:r,page:t,useRaster:!1,singlepage:!0},ih(!1,e,Pi,Fr,Fr))}(e,t,a,i,s,r))},exportFileRaster:function(e,t,a,i,s){yd()||(Dl(),bl(),function(e,t,a,i,s){Vc({consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:s,useRaster:!0},ih(!1,e,Pi,Fr,Fr))}(e,t,a,i,s))},exportPDF:function(){yd()||(Dl(),bl(),function(){if(!yd())if((new Date).getTime(),hn.getCurrentpage().usevector3Dxml)jc();else{hn.getCurrentpage().usepdfjs&&(hn.getCurrentpage().curpagescale,hn.getCurrentpage().dscalepdf);var e=new XMLHttpRequest;e.withCredentials=ji,e.upload.addEventListener("progress",Ec,!1);var t=ih(!1,!1,!0,Fr,Fr),a=Ho(hn.OriginalURL),i=_o(hn.OriginalURL),s=_+"?"+a+"&"+i+"&PDF&200";try{e.open("POST",s,!0)}catch(e){alert("Error 1 - "+e)}try{e.responseType=""}catch(e){}if(_r){var r=Th();r.authset&&e.setRequestHeader("Authorization",r.authString+r.baseuserstring)}e.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=So(this.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;a=zo(hn.FileNameSRC)+a,null!=Ge&&Ge.loadComplete(a,!0)}else 404==this.status?console.log("Export of PDF failed, error 404"):503==this.status&&console.log("Export of PDF failed, error 503")},e.send(t)}}())},exportFDF:function(e){yd()||Hr||mi||(F?function(e,t){var a=new XMLHttpRequest;a.open("POST",e,!0),a.onload=function(e){},a.send(t)}(E,e):function(e){const t=e instanceof Blob?e:new Blob([e],{type:"application/vnd.adobe.xfdf"});if("showSaveFilePicker"in window){const e={types:[{description:"XFDF Files",accept:{"application/vnd.adobe.xfdf":[".xfdf"]}}],suggestedName:"annotations.xfdf"};window.showSaveFilePicker(e).then(e=>e.createWritable()).then(e=>e.write(t).then(()=>e)).then(e=>e.close()).catch(e=>{"AbortError"!==e.name&&(console.error("Error saving file:",e),pu(t))})}else pu(t)}(e),F=!0)},exportFilePrintPDF:function(e){yd()||(Dl(),bl(),Lc({consolidateonly:!1,format:"PDF",UPI:"0",paperSize:e,markupFlag:"1",useRaster:!1}))},foxitexportFDF:function(e,t=!0){yd()||Hr||mi||(t||(F=!1),null!=hn.foxitdoc&&hn.foxitdoc.exportFDF(e))},exportPDFBinary:function(){yd()||hn.getCurrentpage().usepdfjs&&hn.sendPDFData()},exportSettings:function(e){Pi=e.includeAllMarkup},fileInfoDialog:Jd,fileSelected:function(){ni?(ni=!1,function(){if(null!=L){var e=document.getElementById("fileToUpload").files[0];null!=sa&&sa.setUpload("show"),Fh("POST",L,"",e).then((function(e){var t=e.substr(0,e.length-2),a=Object.freeze(JSON.parse(t));null!=sa&&sa.setUpload("hide"),null!=Oe&&Oe.setPentablelist(a,hn.bActive)})).catch((function(e){e.status?(null!=sa&&sa.setUpload("hide"),console.log("uploadpentable",e.status)):(null!=sa&&sa.setUpload("hide"),console.log(e))}))}}()):oi?(oi=!1,convertFile()):function(){var e=document.getElementById("fileToUpload").files[0];Ce=e,"application/pdf"==e.type&&(foxitGetDoc().openPDF(e),null!=la&&la.setDownload("show"),addfoxitdoc());var t=new XMLHttpRequest;if(t.withCredentials=ji,"application/pdf"==e.type){t.upload.addEventListener("progress",jh,!1),t.addEventListener("load",Lh,!1),t.addEventListener("error",Nh,!1),t.addEventListener("abort",Bh,!1);var a=encodeURIComponent(e.name);t.open("POST",A+"&"+J+"&"+a+"&"+e.lastModified+"&"+e.size,!0),t.send(e)}else null!=sa&&sa.setUpload("show"),t.upload.addEventListener("progress",Ah,!1),t.addEventListener("load",Vh,!1),t.addEventListener("error",Nh,!1),t.addEventListener("abort",Bh,!1),a=encodeURIComponent(e.name),t.open("POST",A+"&"+J+"&"+a+"&"+e.lastModified+"&"+e.size,!0),t.send(e)}()},findBlockByAttr:function(e,t){if(!yd())return hn.getCurrentpage().usevectorxml?hn.getCurrentpage().FindBlockByAttr(e,t):void 0},findMarkUp:function(){if(!yd()&&!mi){Dl(),bl();var e=prompt("Search markup text","");null!=e&&""!=e&&hn.getCurrentpage().MarkupFind(e)}},forceMarkupCallback:function(e){zs=e},foxitAnnotlist:function(e){if(!yd()&&Fs&&hn&&(hn.setFoxitAnnotlist(e),null!=Ut)){let l=0,c=[];for(let o of e){let e;const h=o.exportToJSON(),d=o.getPage().getDeviceRect(o.getRect(),rn);let p=h.contents.replace("\r\r","\n\n");switch(p=p.replace("\r","\n"),o.getType()){case"freetext":if("FreeTextCallout"==h.intent){if(o.info.calloutLinePoints){const e=o.info.calloutLinePoints[0],s=o.info.calloutLinePoints[2];var t=[e.x,e.y],a=[s.x,s.y];const r=o.getPage().getDevicePoint(t,rn),n=o.getPage().getDevicePoint(a,rn);var i=new cl(6,6,0);i.linewidth=h.width,i.arrowlength=10+i.linewidth,i.x=r[0],i.y=r[1],i.w=n[0],i.h=n[1],i.pagenumber=h.page,i.signature=Object.keys(h).includes("title")?h.title:null,i.pdfannotref=l,i.pdfannot=!0,Is&&(i.pdfannotproxy=!0),i.savemetolistLoad(hn),i.pdfannotproxy||o.getPage().removeAnnotById(o.getUniqueID())}if(o.info.innerRect){const t=o.getPage().getDeviceRect(o.info.innerRect,rn);e=Dp(t.left,t.top,t.right-t.left,t.bottom-t.top,i,p),e.textcolor=h.fontColor,e.fillcolor="rgba(255,255,255, 0)",e.font=new Rn(o.info.fontName,o.info.defaultAppearance.textSize*rn)}}else e=new cl(9,1,0),e.text=p,e.textcolor=h.fontColor,e.strokecolor=h.color,e.fillcolor="rgba(255,255,255, 0)",e.font=new Rn(o.info.fontName,o.info.defaultAppearance.textSize*rn),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top;break;case"text":null==h.inreplyto?(e=new cl(10,0,0),e.text=p,e.x=d.left,e.y=d.top,e.w=ln.width,e.h=ln.height):c.push({inreplyto:h.inreplyto,text:p});break;case"line":const u=o.getStartPoint(),g=o.getEndPoint();var s=[u.x,u.y],r=[g.x,g.y];const f=o.getPage().getDevicePoint(s,rn),m=o.getPage().getDevicePoint(r,rn);if("LineArrow"==h.intent){var n=0;"OpenArrow"==h.tail&&"OpenArrow"==h.head&&(n=2),e=new cl(6,n,0),e.linewidth=h.width,e.arrowlength=10+e.linewidth,e.x=f[0],e.y=f[1],e.w=m[0],e.h=m[1],e.strokecolor=h.color}else"LineDimension"==h.intent?(e=new cl(7,0,0),e.x=f[0],e.y=f[1],e.w=m[0],e.h=m[1],e.strokecolor=h.color,hn.scalesOptions=[{value:h.measureRatio,label:h.measureRatio}]):(e=new cl(1,1,0),e.addpoint(f[0],f[1]),e.addpoint(m[0],m[1]),e.strokecolor=h.color);break;case"circle":e=new cl(4,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color;break;case"square":"SquareImage"!=h.intent?(e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,"solid"==h.style&&h.interiorColor&&(e.fillcolor=Vn(h.interiorColor,80*h.opacity),e.alternative=1),e.strokecolor=h.color):(e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color,e.pdfannotproxy=!0,e.pdfannotproxyType="image");break;case"ink":e=new cl(0,0,0);const y=o.getInkList();for(let t=0;t<y.length;++t){const a=y[t],i=[a.x,a.y],s=o.getPage().getDevicePoint(i,rn);e.addpoint(s[0],s[1])}e.addline(),console.log(e.pointlist),e.strokecolor=h.color;break;case"polygon":"PolygonDimension"===h.intent?e=new cl(8,0,0):"solid"===h.style?h.interiorColor?(e=new cl(1,2,1),e.fillcolor=h.interiorColor):(e=new cl(1,2,0),e.fillcolor=h.interiorColor):"cloudy"===h.style&&(e=new cl(1,7,0));const v=o.getVertexes();for(let t=0;t<v.length;++t){const a=v[t],i=[a.x,a.y],s=o.getPage().getDevicePoint(i,rn);e.addpoint(s[0],s[1])}e.strokecolor=h.color;break;case"polyline":e="PolyLineDimension"===h.intent?new cl(1,3,0):new cl(1,1,0);const x=o.getVertexes();for(let t=0;t<x.length;++t){const a=x[t],i=[a.x,a.y],s=o.getPage().getDevicePoint(i,rn);e.addpoint(s[0],s[1])}e.strokecolor=h.color;break;case"stamp":e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color,e.pdfannotproxy=!0,e.pdfannotproxyType="stamp";break;case"strikeout":e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color,e.pdfannotproxy=!0,e.pdfannotproxyType="strikeout";break;case"highlight":e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color,e.pdfannotproxy=!0,e.pdfannotproxyType="highlight";break;case"underline":e=new cl(3,0,0),e.x=d.left,e.y=d.top,e.w=d.right-d.left,e.h=d.bottom-d.top,e.strokecolor=h.color,e.pdfannotproxy=!0,e.pdfannotproxyType="underline"}null!=e&&(e.pdfannotref=l,e.pdfannot=!0,e.title=Object.keys(h).includes("title")?h.title:null,Jn(e.title)||wr.push(new qn(e.title,e.title,Rr,Pr,!1)),e.signature=Object.keys(h).includes("title")?h.title:null,e.timestamp=o.info.creationTimestamp,e.uniqueID=o.getUniqueID(),e.pagenumber=h.page,e.linewidth=h.width,"solid"==h.style&&(e.linestyle=0),"dashed"==h.style&&(e.linestyle=1,e.linewidth=1),Is&&(e.pdfannotproxy=!0),e.color=h.color,e.savemetolistLoad(hn),e.pdfannotproxy||o.getPage().removeAnnotById(o.getUniqueID())),l++}for(let e of c){var o=zp(e.inreplyto);o&&o.AddCommentInternal(o.comments.length,o.signature,e.text)}}},convertPDFAnnots:function(e){Fs=e},usePDFAnnotProxy:function(e){Is=e},foxitForceCanvas:function(){yd()||hn.forcefoxitCanvas()},foxitForceRedraw:qd,foxitpagescalecheck:function(e){yd()||hn&&hn.foxitpagescalecheck(e)},forcepagesState:function(e){null!=Jt&&Jt.setGUIState(e)},freeLicense:function(){wi&&uh(os,!1)},get2DVectorBlocks:function(){if(!yd())return hn.getCurrentpage().usevectorxml?hn.getCurrentpage().getBlocks():void 0},get3DVectorBlocks:function(){if(!yd())return hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().get3dVectorBlocks():void 0},get2DVectorfilterAttributes:function(){if(!yd())return hn.getCurrentpage().usevectorxml?hn.getCurrentpage().getFilteredAttributes():void 0},get2DVectorPentable:function(){if(!yd())return hn.getCurrentpage().usevectorxml?hn.getCurrentpage().getPenTable():void 0},getActiveFileFloorlevel:function(){var e=null;return gi&&hn.getCurrentpage().bis3Dnavigator&&(e=hn.getCurrentpage().getFloorLevel()),e},getAllPageDimensions:function(){if(!yd())return hn.getAllPageDim()},getBlockAttributes:function(e){if(!yd())return hn.getCurrentpage().usevectorxml?hn.getCurrentpage().blockAttributes(e):void 0},getBookMarkPage:function(e){if(!yd())return hn.get_bookmark_pageref(e)},getCacheURL:function(){if(!yd())return hn.CacheURL},getCameraimage:function(e){var t=null;return yd()||hn.getCurrentpage().usevector3Dxml&&(t=hn.getCurrentpage().Vector3DPageObj.getCameraimage(e)),t},getCameraView:function(e){var t=void 0;return yd()||hn.getCurrentpage().usevector3Dxml&&(t=hn.getCurrentpage().Vector3DPageObj.getCameraView(e)),t},get3DResetView:function(){if(!yd())return hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().get3DResetView():void 0},getCurrentPageScale:lo,getCurrentPageOffset:ro,getCanvasContextMenuEvent:function(){null!=ua&&ua.setEvent(t)},getCanvasFont:function(e,t,a,i){return new Rn(e,t,a,i).fontstringpx},getCanvasSize:function(){var e=Hl();return{w:ti/e,h:ai/e}},getColor:function(){return Pr},getCompareColors:function(){var e={bg:Rs,fg:Ps},t=Ud();return null!=t&&(e=t.getColors()),e},getcurPage:function(){return yd()?0:hn.getcurPage()},getfloorplanDocs:function(e){for(var t=[],a=null,i=0;i<yn.length;i++)if(yn[i].pages.length>0)for(var s=0;s<yn[i].pages.length;s++)a=yn[i].pages[s].getFloorLevel(),e.floorindex==a.floorindex&&t.push({docindex:i,pageindex:s,floorindex:a.floorindex,replaced:a.replaced});return t},getFloorplanList:function(e){var t=[];return gi?(yn[e].pages[0].usevector3DGLTF&&(t=yn[e].getFloorplans()),t):t},getPageScale:function(e){return yd()?1:hn.getcurpageScale(e)},getPage:function(e){return yd()?void 0:hn.getPageObject(e)},getPageScaleObject:function(e){return yd()?void 0:hn.getPageObject(e).scaleObject},getDisplayName:Kn,getdivcontainer:function(){return e},getDocFileName:function(){return hn?hn.FileName:"empty"},getPDFDocobj:function(){return yd()?null:hn.getPDFDocument()},getdocInfo:function(){return yd()?{iscompare:!1,isPDF:!1,is3D:!1,is2D:!1,numpages:0,currentpage:0}:{iscompare:mi,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),type:hn.Type}},pasteClipboard:function(){!async function(){try{if("denied"===(await navigator.permissions.query({name:"clipboard-read"})).state)throw new Error("Not allowed to read clipboard.");const e=await navigator.clipboard.read();for(const t of e){if(!t.types.includes("image/png"))throw new Error("Clipboard contains non-image data.");const e=await t.getType("image/png");eu("clipboardimage",{p1:1}),"clipboardimage"===cn.name&&cn.setimage(e)}}catch(e){console.error(e.message)}}()},getClipRect:function(e){yd()||(Dl(),bl(),e?eu("zoomwindow",{p1:!1,p2:!0}):eu("markupedit",{p1:!1}))},getDocRect:function(e){yd()||hn.getCurrentpage().usevector3Dxml||(Dl(),bl(),e?eu("zoomwindow",{p1:!0,p2:!1}):eu("markupedit",{p1:!1}))},getCamNavPosition:function(e,t,a,i){if(!yd())return yn[e].pages[t].getnavcampos(a.unit,a.boxCenter,i)},getcentrepoint:function(){return{x:.5*ti,y:.5*ai}},getFoxitIframeID:function(e){return 0==yn.length?null:null!=yn[e].foxitdoc?yn[e].foxitdoc.iframename:null},bringIframeToFront:function(e){bringIframeToFront(e)},getFillColor:function(){return Sr},getFillStyle:function(){return Lr},getFixedScale:function(){if(yd())return 1;var e=lo()/hn.getCurrentpage().fixedScale;return Mi?e:1},getFont:function(){return Pn},getfoxitThumbnails:function(){yd()||hn.getFoxitThumbnails()},getfoxitThumbnail:function(e){yd()||hn.getFoxitThumbnail(e)},getFileInfo:function(e){return He.callback=e,Jd(),He.fileinfo},getLayout:function(){return Pe},getLineColor:function(){return Mr},getLineWidth:function(){return jr},getMarkupTypes:vd,getMarkupTypebyname:function(e){for(var t=[{label:"Freehand pen",typename:"PEN",type:0,subtype:0},{label:"Eraser",typename:"ERASER",type:0,subtype:1},{label:"Polyline",typename:"POLYLINE",type:1,subtype:1},{label:"Polygon",typename:"POLYGON",type:1,subtype:2},{label:"Measure Path",typename:"PATH",type:1,subtype:3},{label:"Measure angle",typename:"ANGLE",type:1,subtype:4},{label:"Measure angle",typename:"ANGLEBCKWRD",type:1,subtype:5},{label:"Measure segment",typename:"SEGMENT",type:1,subtype:6},{label:"Rectangle",typename:"RECTANGLE",type:3,subtype:0},{label:"Rounded Rectangle",typename:"ROUNDED_RECTANGLE",type:3,subtype:1},{label:"Marker",typename:"MARKER",type:3,subtype:3},{label:"Rectanglular Area",typename:"AREARECT",type:3,subtype:6},{label:"Oval",typename:"ELLIPSE",type:4,subtype:0},{label:"Circle",typename:"CIRCLE",type:4,subtype:1},{label:"Revision Cloud",typename:"CLOUD",type:5,subtype:0},{label:"Line",typename:"LINE",type:6,subtype:9},{label:"Arrow",typename:"ARROW",type:6,subtype:0},{label:"Dimension Line",typename:"DIMENSION",type:7,subtype:0},{label:"Space",typename:"SPACE",type:8,subtype:1},{label:"Area",typename:"AREA",type:8,subtype:0},{label:"Callout",typename:"CALLOUT",type:9,subtype:2},{label:"Text",typename:"TEXT",type:9,subtype:1},{label:"Note",typename:"NOTE",type:10,subtype:0},{label:"Image",typename:"IMAGE",type:11,subtype:0},{label:"Symbol",typename:"SYMBOL",type:11,subtype:1},{label:"Button",typename:"BUTTON",type:11,subtype:3},{label:"Signature",typename:"SIGNATURE",type:11,subtype:4},{label:"Signature",typename:"SIGNATUREMOVEABLE",type:11,subtype:5},{label:"Stamp",typename:"IMAGESTAMP",type:11,subtype:12},{label:"QRCode",typename:"IMAGEQR",type:11,subtype:13},{label:"link",typename:"link",type:11,subtype:20},{label:"interactiveStamp",typename:"interactiveStamp",type:11,subtype:21},{label:"Stamp",typename:"STAMP",type:12,subtype:0},{label:"Count",typename:"COUNT",type:13,subtype:0},{label:"MeasureArc",typename:"MEASUREARC",type:14,subtype:0}],a=void 0,i=0;i<t;i++)t[i].typename==e&&(a=t[i]);return a},getMarkupLayers:function(){return Dr},getmarkupGUIDs:function(){if(!yd())return hn.getannotGUIDs()},getMarkupProperties:xd,getMarkupType:function(e,t){var a={label:"",type:"",groups:[]};switch(e){case 0:0==t&&(a.label="Freehand pen",a.type="PEN"),1==t&&(a.label="Eraser",a.type="ERASER");break;case 1:0==t&&(a.label="Polygon",a.type="POLYGON"),1==t&&(a.label="Polyline",a.type=["PEN","POLYLINE"]),2==t&&(a.label="Polygon",a.type="POLYGON"),3==t&&(a.label="Measure Path",a.type="PATH"),4==t&&(a.label="Measure angle",a.type="ANGLE"),5==t&&(a.label="Measure angle",a.type="ANGLEBCKWRD"),6==t&&(a.label="Measure segment",a.type="SEGMENT"),7==t&&(a.label="Revision Cloud",a.type="REVCLOUD");break;case 2:a.label="Polycurve",a.type=["SHAPE","POLYCURVE"];break;case 3:0==t&&(a.label="Rectangle",a.type=["SHAPE","RECTANGLE"]),1==t&&(a.label="Rounded Rectangle",a.type=["SHAPE","ROUNDED_RECTANGLE"]),3==t&&(a.label="Marker",a.type="MARKER"),6==t&&(a.label="Rectanglular",a.type="AREARECT");break;case 4:0==t&&(a.label="Oval",a.type=["SHAPE","ELLIPSE"]),1==t&&(a.label="Circle",a.type=["SHAPE","CIRCLE"]);break;case 5:a.label="Revision Cloud",a.type=["SHAPE","CLOUD"];break;case 6:9==t?(a.label="Line",a.type=["NO_ENDS","ARROW"]):6==t?(a.label="Callout",a.type="TEXT"):0==t?(a.label="Arrow",a.type=["OPEN_SINGLE_END","ARROW"]):1==t?(a.label="Arrow",a.type=["FILLED_SINGLE_END","ARROW"]):2==t?(a.label="Arrow",a.type=["OPEN_BOTH_ENDS","ARROW"]):3==t?(a.label="Arrow",a.type=["FILLED_BOTH_ENDS","ARROW"]):a.label="Arrow";break;case 7:a.label="Dimension Line",0==t?a.type=["BAR","DIMENSION"]:1==t&&(a.type=["OPEN_ARROW","DIMENSION"]);break;case 8:1==t?(a.label="Space",a.type="SPACE"):(a.label="Area",a.type="AREA");break;case 9:1==t?(a.label="Text",a.type="TEXT"):2==t&&(a.label="Callout",a.type="CALLOUT");break;case 11:switch(t){case 0:a.label="Image",a.type="IMAGE";break;case 1:a.label="Symbol",a.type="SYMBOL";break;case 3:a.label="Button",a.type="BUTTON";break;case 4:a.label="Signature",a.type="SIGNATURE";break;case 12:a.label="Stamp",a.type="IMAGESTAMP";break;case 20:a.label="Link",a.type="LINK";break;case 21:a.label="InteractiveStamp",a.type="InteractiveStamp"}break;case 10:a.label="Note",a.type="NOTE";break;case 12:a.label="Stamp",a.type="STAMP";break;case 13:a.label="Count",a.type="COUNT";break;case 14:a.label="MeasureArc",a.type="MEASUREARC"}return a},getMarkupControlProperties:function(e,t,a){var i={lineColor:!1,fillColor:!1,textColor:!1,lineWidth:!1,lineStyle:!1,clockwise:!1,customlabel:!1,display:!0,countsize:!1,countshape:!1,showperimeter:!1,enablelink:!1,endpoint_open_single:!1,endpoint_open_both:!1,endpoint_filled_single:!1,endpoint_filled_both:!1,endpoints_bar:!1,endpoints_arrow:!1,lineSegmentWidth:!1,transpacency:!1,rotate:!1,snap:!1,fill:!1,fontName:!1,fontHeight:!1,labelsize:!1,fontBold:!1,fontItalic:!1};switch(e){case 0:0==t&&(i.lineColor=!0,i.lineWidth=!0),1==t&&(i.lineWidth=!0);break;case 1:1==t&&(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),2==t&&(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0),3==t&&(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),4!=t&&5!=t||(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),6==t&&(i.lineColor=!0,i.lineWidth=!0,i.lineSegmentWidth=!0,i.snap=!0);break;case 2:i.lineColor=!0,i.lineWidth=!0;break;case 3:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0,i.rotate=!0;break;case 4:0==t&&(i.rotate=!0),i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0;break;case 5:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0,i.rotate=!0;break;case 6:9==t?(i.lineColor=!0,i.lineWidth=!0,i.snap=!0):6==t||(i.lineColor=!0,i.lineWidth=!0,i.snap=!0,i.endpoint_open_single=!0,i.endpoint_open_both=!0,i.endpoint_filled_single=!0,i.endpoint_filled_both=!0);break;case 7:labelType="Dimension Line",i.lineColor=!0,i.lineWidth=!0,i.snap=!0,i.endpoints_bar=!0,i.endpoints_arrow=!0;break;case 8:1==t||(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0);break;case 9:1==t&&(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.fill=!0,i.textColor=!0,i.rotate=!0,i.fontName=!0,i.fontHeight=!0,i.fontBold=!0,i.fontItalic=!0);break;case 11:0!=t&&1!=t&&12!=t&&20!=t&&21!=t||(i.rotate=!0);break;case 10:labelType="Note";break;case 12:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.fill=!0,i.rotate=!0;break;case 13:i.fillColor=!0}return i},toggleShowHighlightMarkups:function(e){yd()||mi||(hn.foxitsearchobj.wholedocument=e)},documentTextSearch:function(e,t,a){yd()||mi||hn.documentTextSearch(e,t,a)},clearDocumentTextSearch:function(){yd()||mi||hn.clearDocumentTextSearch()},markVectorBlock:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().markVectorBlock(e)},markupDisplayOnload:function(e){H=e},markupTextWithOrange:function(e){yd()||mi||hn.markupTextWithOrange(e)},removePage:function(e){yd()||mi||hn.removePage(e)},movePageTo:function(e,t){yd()||mi||hn.movePageTo(e,t)},downloadPDF:function(){yd()||mi||hn.exportPDF()},extractPage:function(e,t){yd()||mi||hn.extractPage(e,t)},insertBlankPages:function(e,t,a,i){yd()||mi||hn.insertBlankPages(e,t,a,i)},getDPI:function(){const e={x:96,y:96};if(void 0!==window.screen.deviceXDPI&&void 0!==window.screen.deviceYDPI)e.x=window.screen.deviceXDPI,e.y=window.screen.deviceYDPI;else{const t=document.createElement("div");t.style.width="1in",t.style.height="1in",t.style.position="fixed",t.style.left="-100%",document.body.appendChild(t),e.x=t.offsetWidth,e.y=t.offsetHeight,document.body.removeChild(t)}return e},importPages:function(e,t,a,i,s,r,n){if(!yd()&&gi)return hn.importPages(e,t,a,i,s,r,n)},copyPage:function(e){yd()||gi&&(G=e,hn.fileId,hn.copyPage(e))},pastePage:function(e){yd()||gi&&hn.pastePage(e)},getAllThumbnailsFromFile:function(e){if(!yd()&&gi)return hn.getAllThumbnailsFromFile(e)},getCurrentFileInfo:function(){if(!yd()&&gi){if(null!=hn.thumbnails){const e=hn.thumbnails[0].thumbnailobj;if(null!=e.imageData)return{path:hn.FileNameSRC,name:hn.FileName,date:new Date,width:e.thumbnail.width,height:e.thumbnail.height,buffer:e.imageData.data};{const t=e.ctx.getImageData(0,0,e.thumbnail.width,e.thumbnail.height);return{path:hn.FileNameSRC,name:hn.FileName,date:new Date,width:e.thumbnail.width,height:e.thumbnail.height,buffer:t.data}}}return{path:hn.FileNameSRC,name:hn.FileName,date:new Date}}},zoomWithMarkup:function(e){return new Promise((t,a)=>{yd()&&a(),gi||a(),hn.getCurrentpage().usepdfjs?hn.pages[hn.currentpage].foxitdirectZoom(e.documentScale/hn.getCurrentpage().getPDFpageScale()).then(()=>{hn.pages[hn.currentpage].redrawMarkup(),setTimeout(()=>{t()},50)}):(hn.getCurrentpage().setPagestats(e.documentScale),hn.pages[hn.currentpage].redrawMarkup(),setTimeout(()=>{t()},50))})},uploadPDF:function(){yd()||mi||hn.uploadPDF()},uploadPDFCustom:function(e){yd()||mi||hn.uploadPDFCustom(e)},uploadCustomPDF:function(e,t,a){t?function(e,t){var a=new XMLHttpRequest;a.withCredentials=ji,a.upload.addEventListener("progress",Ih,!1),a.addEventListener("load",Oh,!1),a.addEventListener("error",Nh,!1),a.addEventListener("abort",Bh,!1),encodeURIComponent(e.filename),Date.now(),Ho(hn.OriginalURL);var i=_o(hn.OriginalURL);i="new_"+i,a.open("POST",t,!0),a.send(e.binfile)}(e,a):function(e){var t=new XMLHttpRequest;t.withCredentials=ji,t.upload.addEventListener("progress",Ih,!1),t.addEventListener("load",Oh,!1),t.addEventListener("error",Nh,!1),t.addEventListener("abort",Bh,!1),encodeURIComponent(e.filename),Date.now();var a=Ho(hn.OriginalURL),i=_o(hn.OriginalURL),s="&"+a+"&"+(i="new_"+i);t.open("POST",O+s,!0),t.send(e.binfile)}(e)},getMarkupXMLData:function(){if(!yd()&&!mi)return ih(!0,!1,!0,Fr,Ir)},getmarkupobjByGUID:zp,getMarkupSearchPadding:function(){return Ee},getMarkupXMLByGUID:function(e){if(!yd()){for(var t="",a=0;a<yn.length;a++){var i=yn[a].getmarkupbyGUIDXML(e);i.found&&(t=i.document)}return t}},getMarkupXMLSelected:function(){if(!yd()){var e=gl();return hn.getmarkupSelectedXML(e)}},getNoteDiag:function(e){function t(e){Zt.connect(e)}return e&&"function"==typeof e&&t(e),{getText:function(){return Zt.getText().text},setText:function(e){Zt.setText(e)},connect:t}},getnumSymbols:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Numsymbols")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","",t).then((function(e){var t={type:3,data:e};null!=Ht&&Ht.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("number of symbols not returned error 404"):503==e.status?console.log("number of symbols not returned error 503"):501==e.status&&console.log("number of symbols not returned error 501"):console.log(e)}))}(e)},getOpenFiles:kd,getOpenFilesList:function(){for(var e=[],t=0;t<yn.length;t++)e.push({id:yn[t].id,index:yn[t].fileindex,name:yn[t].FileName||yn[t].Type,isActive:yn[t].bActive});return e},getOriginalPath:function(){if(!yd())return hn.OriginalURL},get3DmodelcurFloor:function(){if(!yd())return hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().Vector3DPageObj.checkcurfloor():void 0},getModelCenter:function(){if(!yd())return hn.getCurrentpage().usevector3DGLTF?hn.getCurrentpage().Vector3DPageObj.getModelCenter():void 0},getModelBox:function(){if(!yd())return hn.getCurrentpage().usevector3DGLTF?hn.getCurrentpage().Vector3DPageObj.getmodelBox():void 0},getmodelUnit:function(){if(!yd())return hn.getCurrentpage().usevector3DGLTF?hn.getCurrentpage().Vector3DPageObj.getmodelUnit():void 0},getPageDimensions:function(e){if(!yd())return hn.getPageDim(e)},getPageRotation:function(){if(!yi)return yd()?0:hn.getCurrentpage().getpageRotation()},getcurrentpageStats:function(){if(!yd())return hn.getCurrentpage().pageStats()},getCurrentVectorPageObject:function(){return hn.getCurrentpage().getVectorPageObject()},getpagethumbnail:function(e){if(!yd())return hn.pages[e].thumbnailobj},getCurrentPageScaleValue:function(){if(!yd())return hn.getCurrentpage().scaleObject.getScaleValue()},getCurrentPageScaleLabel:function(){if(!yd())return hn.getCurrentpage().scaleObject.getScaleLabel()},getReadOnly:function(){return Hr},getAllSelectedMarkup:function(){if(!yd()&&!Hr)return hn.getSelectedMarkup()},getSelectedMarkup:Zd,getLastMarkup:function(){if(!yd())return function(){if(hn)return hn.markuplist.length>0?hn.markuplist[hn.markuplist.length-1]:void 0}()},getSnapState:function(){if(!yd())return hn.getCurrentpage().getSnapState()},getStoreyNames:function(){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().getstoreyNames():void 0},getStoreyAttributes:function(e){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().getStoreyAttributes(e):void 0},getStoreyAttributesEx:function(e,t,a){return yd()?-1:hn.getCurrentpage().usevector3Dxml?a?hn.getCurrentpage().searchStoreyAttributes(e,t):hn.getCurrentpage().searchStoreyAttributesEx(e,t):void 0},getStoreyIDs:function(e){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().getStoreyIDs(e):void 0},getStoreyRealIDs:function(e){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().getStoreyRealIDs(e):void 0},getSymbolLibNum:function(){var e,t;(t=[]).push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),t.push(encodeURIComponent("Command")+"="+encodeURIComponent("Numlibs")),e=t.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","",e).then((function(e){var t={type:1,data:e};null!=Ht&&Ht.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("number of symbol libraries not returned error 404"):503==e.status?console.log("number of symbol libraries not returned error 503"):501==e.status&&console.log("number of symbol libraries not returned error 501"):console.log(e)}))},getSymbolLibPNGData:function(e,t){!function(e,t){var a,i=[];i.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),i.push(encodeURIComponent("Command")+"="+encodeURIComponent("symbolpng")),i.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),i.push(encodeURIComponent("Symbolnumber")+"="+encodeURIComponent(t)),a=i.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","arraybuffer",a).then((function(e){var a={type:5,data:new Blob([e],{type:"image/png"}),index:t};null!=Ht&&Ht.onSymbolReceived(a)})).catch((function(e){e.status?404==e.status?console.log("PNG source not found error 404"):503==e.status?console.log("Server is down error 503"):501==e.status&&console.log("Server error 501"):console.log(e)}))}(e,t)},getSymbolName:function(e,t){!function(e,t){var a,i=[];i.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),i.push(encodeURIComponent("Command")+"="+encodeURIComponent("Symbolname")),i.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),i.push(encodeURIComponent("Symbolnumber")+"="+encodeURIComponent(t)),a=i.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","",a).then((function(e){var t={type:4,data:e};null!=Ht&&Ht.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("Symbol name not found error 404"):503==e.status?console.log("Symbol name not found error 503"):501==e.status&&console.log("Symbol name not found error 501"):console.log(e)}))}(e,t)},getTextColor:function(){return Tr},getUnit:up,getUser:function(){Eh("GET",ce).then((function(e){null!=e.getElementsByTagName("ID")[0]&&(Fr=Ac(Fr=e.getElementsByTagName("ID")[0].firstChild.nodeValue)),null!=e.getElementsByTagName("name")[0]&&(Ir=Ac(Ir=e.getElementsByTagName("name")[0].firstChild.nodeValue)),null!=e.getElementsByTagName("color")[0]&&(Pr=e.getElementsByTagName("color")[0].firstChild.nodeValue),null!=e.getElementsByTagName("layer")[0]&&(Rr=e.getElementsByTagName("layer")[0].firstChild.nodeValue),null!=e.getElementsByTagName("canChangeLayer")[0]&&(Br="1"==e.getElementsByTagName("canChangeLayer")[0].firstChild.nodeValue),wr.push(new qn(Fr,Ir,Rr,Pr,!1)),null!=je&&je.setUserlist(wr,!0)})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},getUsers:function(){return wr},gotoPage:function(e){yd()||mi||(Dl(),bl(),hn.GotoPage(e))},PDFPagethrough:function(){yd()||mi||hn.cycleThroughPages()},foxitPageEvt:function(e){yd()||mi||hn.foxitpagEvent(e)},foxitPageRenderEvt:function(e){yd()||mi||hn.foxitpageRenderEvent(e)},testScroll:function(e,t){yd()||mi||hn.scrolltestfoxit(e,t)},getHatchStyle:function(){return Or},getHatchbyName:Ao,getHatches:Eo,getTextInput:function(e){function t(e){qt.connect(e)}return e&&"function"==typeof e&&t(e),{getText:function(){return qt.getText().text},setText:function(e){qt.setText(e)},connect:t}},helper:gu,handlePDFPassword:function(e,t){null!=ct&&ct.PassWordRequest(e,t)},hidedisplayCanvas:Wp,hideAllCanvas:function(e){e?(r.style.visibility="hidden",r.style.zIndex="0",t.style.visibility="hidden",t.style.zIndex="0",o.style.zIndex="0"):(r.style.visibility="visible",r.style.zIndex="3",t.style.visibility="visible",t.style.zIndex="3",o.style.zIndex="3")},hideMarkUp:function(){yd()||(Bl(),hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().unSelect3DmarkupAll(),Dl(),bl(),hn.Drawmarkup?(hn.Drawmarkup=!1,hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().show3Dmarkup(!1),Ll(!1),Vl(n),hn.bMarkupLocked=!0):(hn.Drawmarkup=!0,hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().show3Dmarkup(!0),Ll(!0),Vl(n),hn.bMarkupLocked=!1))},hideMarkupByMarkupNumbers:function(e,t){var a=0;for(a=0;a<e.length;a++)null!=hn.markuplist[e[a]-1]&&hn.markuplist[e[a]-1].setdisplay(t)},hideLabels:function(e){$r=e},hideTextInput:du,imperialUnit:xp,elementImperialUnit:function(e){var t=Zd();t.isempty||t.scaleObject.imperialUnit(e)},importFDF:function(e,t=null){yd()||Hr||mi||(null!=t?t&&null!=hn.foxitdoc&&hn.foxitdoc.importFDF(t):function(e){if(!yd()){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(e){var a=t.response;a&&null!=hn.foxitdoc&&hn.foxitdoc.importFDF(a)},t.send(null)}}(e))},listFoxitAnnots:function(){yd()||Hr||mi||yd()||null!=hn.foxitdoc&&hn.foxitdoc.listAnnotations()},initialize:function(p,u,g){if(!me){me=!0,we=window.devicePixelRatio,Pe=p||Pe,navigator.userAgent.match(/Trident.*rv\:11\./)?(ri=!0,li=""):(ri=!1,li="initial");var f=function(){mn.measurearc=function(e){var i,s,r,o=this,l=(hn.markuplist.length,!1);this.started=!1,e.p1,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.startx=0,this.starty=0,this.startX=null,this.startY=null,this.secondX=null,this.secondY=null,this.endX=null,this.endY=null,this.isDrawing=!1,this.customType="arc3point",this.name="measurearc",this.anglelengthsupport=!1,this.refreshSupport=!1,Vp(Bp("measurearc")),this.setdimoffset=function(e){if(e){i.scaling=lo();var t=ro();i.xoffset=t.x,i.yoffset=t.y,o.orgscale=i.scaling,o.orgdx=i.xoffset,o.orgdy=i.yoffset}var a=hn.getCurrentpage().getdscale();hn.getCurrentpage().getdx(),hn.getCurrentpage().getdy();if(i){i.scaling;i.w,i.xoffset,i.h,i.yoffset}},this.startArc=function(e,t){e&&(hn&&(hn.bMarkupchanged=!0),o.x0=t.x,o.y0=t.y,(i=new cl(14,0,0)).startX=o.x0,i.startY=o.y0,i.pagerotation=hn.getCurrentpage().getpageRotation(),i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),o.setdimoffset(!0),i.setsecond=!0,o.startx=o.x0,o.starty=o.y0,i.seteditaction(0),o.isDrawing=!0)},this.endArc=function(){if(Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),i=null,Dh(),Vl(n),zs){if(null!=$t){var e={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],e)}}else Gs||null==$t||(e={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],e))},this.setSnap=function(e){null==(s=hn.getCurrentpage().getsnap(e))&&(l=!1,a.clearRect(0,0,t.width,t.height)),s.found?(r=0!=hn.getCurrentpage().getpageRotation()?Mn(s):s,l=!0,Qp(a,s)):(l=!1,a.clearRect(0,0,t.width,t.height))},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(l&&r)var s=r;else s=a;var n=fo(a);if(0==e.button){if(!o.isDrawing)return void o.startArc(n,s);if(o.isDrawing&&i.setsecond)return i.startX=o.x0,i.startY=o.y0,i.secondX=s.x,i.secondY=s.y,i.setsecond=!1,void(i.setthird=!0);o.isDrawing&&i.setthird&&(i.endX=s.x,i.endY=s.y,o.isDrawing=!1,o.endArc())}else a.x,a.y},this.touchstart=function(e){e.preventDefault(),o.started=!0,hn&&(hn.bMarkupchanged=!0);var a=qp(t,e,0);if(!fo(a))return o.started=!1,void(hn&&(hn.bMarkupchanged=!1));o.x0=a.x,o.y0=a.y,ro()},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var r=Zp(t,e);o.setSnap(r),o.isDrawing&&(fo(r),i.setsecond?(i.secondX=r.x,i.secondY=r.y):i.setthird&&(i.endX=r.x,i.endY=r.y),a.clearRect(0,0,t.width,t.height),l&&Qp(a,s),i.drawme(a))},this.touchmove=function(e){if(e.preventDefault(),o.started){var i=qp(t,e,0);fo(i)&&(i.x,i.y),o.bUsemouseinput,a.clearRect(0,0,t.width,t.height)}},this.mouseup=function(e){},this.touchcancel=function(e){e.preventDefault(),o.started&&(o.started=!1)},this.touchend=function(e){e.preventDefault(),o.started&&(o.started=!1)}},mn.hide3d=function(){var e=this;this.name="hide3d",this.anglelengthsupport=!1,this.refreshSupport=!1;var a=new THREE.Raycaster,i=new THREE.Vector2;new THREE.Vector3,Vp(Bp("hide3d")),this.getInterSects=function(e){if(a.setFromCamera(e,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var t=hn.getCurrentpage().Vector3DPageObj.getMeshChildren();if(0==t.length)return;var i=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==i.length)var s=[];else{s=[];for(var r=0;r<i.length;r++)s.push(a.intersectObjects(i[r],!0))}var n=a.intersectObjects(t,!0)}else n=a.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(s.length>0)for(var o=0;o<s.length;o++)for(;0<s[o].length;o++)if("LineSegments"!=s[o][0].object.type){var l=null,c=!0,h=!0,d=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(c=s[o][0].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,h=s[o][0].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,d=s[o][0].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),s[o][0].object.visible&&c&&h&&d){l=s[o][0];break}}if(n.length>0)for(o=0;o<n.length;o++)if("LineSegments"!=n[o].object.type&&(c=!0,h=!0,d=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(c=n[o].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,h=n[o].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,d=n[o].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),n[o].object.visible&&c&&h&&d)){var p=!1;if(null!=l&&(p=l.distance<n[o].distance),p)var u=l;else u=n[o];if((null==u.object.userData.visible||u.object.userData.tempvisible)&&(u.object.userData.visible=u.object.visible?1:0,u.object.userData.tempvisible=u.object.visible),u.object.visible){var g=u.object.name,f=u.object.type;g=hn.getCurrentpage().getMeshName(g,f),hn.getCurrentpage().turn3DBlockOnOff(g,!0);break}}},this.mousedown=function(t){t.preventDefault(),t.stopPropagation(),e.started=!0;var a=Zp(d.domElement,t);gi&&hn.getCurrentpage().usevector3Dxml&&(i.x=a.x/ti*2-1,i.y=-a.y/ai*2+1,e.getInterSects(i))},this.mouseup=function(t){t.preventDefault(),t.stopPropagation(),e.started&&(e.started=!1)},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var s=Zp(t,a);e.started=!0,gi&&hn.getCurrentpage().usevector3Dxml&&(i.x=s.x/ti*2-1,i.y=-s.y/ai*2+1,e.getInterSects(i))},this.touchstart=function(t){t.preventDefault(),e.started=!0;var a=qp(d.domElement,t,0);gi&&hn.getCurrentpage().usevector3Dxml&&(i.x=a.x/ti*2-1,i.y=-a.y/ai*2+1,e.getInterSects(i))},this.touchcancel=function(t){t.preventDefault(),e.started&&(e.started=!1)},this.touchend=function(t){t.preventDefault(),e.started&&(e.started=!1)}},mn.add3dsymbol=function(e){var a=this,i=new THREE.Raycaster,s=new THREE.Vector2;new THREE.Vector3,this.color=e.p1,this.name="add3dsymbol",this.anglelengthsupport=!1,this.refreshSupport=!1,this.getInterSects=function(e,t){if(i.setFromCamera(e,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var a=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),s=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==a.length)return;if(0==s.length)var r=[];else{r=[];for(var n=0;n<s.length;n++)r.push(i.intersectObjects(s[n],!0))}var o=i.intersectObjects(a,!0)}else o=i.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(r.length>0)for(var l=0;l<r.length;l++)if(r[l].length>0)for(;0<r[l].length;l++)if("LineSegments"!=r[l][0].object.type){var c=null,h=!0,d=!0,p=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(h=r[l][0].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,d=r[l][0].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,p=r[l][0].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),r[l][0].object.visible&&h&&d&&p){c=r[l][0];break}}if(o.length>0)for(l=0;l<o.length;l++)if("LineSegments"!=o[l].object.type&&(h=!0,d=!0,p=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(h=o[l].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,d=o[l].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,p=o[l].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),o[l].object.visible&&h&&d&&p)){var u=!1;if(null!=c&&(u=c.distance<o[l].distance),u)var g=c;else g=o[l];hn.getCurrentpage().add3DSymbol(g,t);break}},this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();for(var t=Zp(d.domElement,e),i=JSON.parse(e.dataTransfer.getData("Text")),r=!0,n=0;n<sn.lenght;n++)sn[n].id==i.id&&(r=!1);r&&Up(i.src,i.width,i.height,i.id),gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=t.x/ti*2-1,s.y=-t.y/ai*2+1,a.getInterSects(s,i.id))},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),a.started=!0;var t=Zp(d.domElement,e);gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=t.x/ti*2-1,s.y=-t.y/ai*2+1,a.getInterSects(s,a.color))},this.mouseup=function(e){e.preventDefault(),e.stopPropagation(),a.started&&(a.started=!1)},this.pointerdown=function(e){a.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var i=Zp(t,e);a.started=!0,gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=i.x/ti*2-1,s.y=-i.y/ai*2+1,a.getInterSects(s))},this.MSPointerUp=function(e){a.started&&(a.started=!1)},this.touchstart=function(e){e.preventDefault(),a.started=!0;var t=qp(d.domElement,e,0);gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=t.x/ti*2-1,s.y=-t.y/ai*2+1,a.getInterSects(s))},this.touchcancel=function(e){e.preventDefault(),a.started&&(a.started=!1)},this.touchend=function(e){e.preventDefault(),a.started&&(a.started=!1)}},mn.measure3D=function(){var e=this,i=new THREE.Raycaster,s=new THREE.Vector2;new THREE.Vector3,this.name="measure3D",this.anglelengthsupport=!1,this.refreshSupport=!1,this.numpoints=0,this.screenPoints=[];var r=[];Vp(Bp("measure3D")),this.drawLine=function(e,t){a.strokeStyle="black",a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(t.x,t.y),a.closePath(),a.stroke()},this.drawLabel=function(e,i){i&&a.clearRect(0,0,t.width,t.height)},this.drawPoints=function(e,i){i&&a.clearRect(0,0,t.width,t.height),a.save(),a.fillStyle="rgba(0, 0, 255, 0.5)",a.beginPath(),a.arc(e.x,e.y,8,0,2*Math.PI),a.closePath(),a.arc(e.x,e.y,4,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()},this.handlePoints=function(t,i){if(t){var s=hn.getCurrentpage().Vector3DPageObj.pointToScreen(i);e.drawPoints(s,!0);var n=i.point.clone();if(r.length>0){var o=hn.getCurrentpage().Vector3DPageObj.pointToScreen(r[0]);e.drawPoints(o,!1),e.drawLine(o,s);var l=r[0].point.clone().distanceTo(n),c=hn.getCurrentpage().Vector3DPageObj.setdimvalue(l);hn.getCurrentpage().Vector3DPageObj.dimvaluedraw(s,a,"black",c,!0)}}else r.push(i),e.screenPoints.push(s),e.numpoints+=1,2==e.numpoints&&(hn.getCurrentpage().Vector3DPageObj.add2DPoints(r,e.numpoints),r=[],e.numpoints=0,e.started=!1,Np(!1,"measure3D",null))},this.getInterSects=function(s,r,n){if(i.setFromCamera(s,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var o=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),l=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==o.length)return;if(0==l.length)var c=[];else{c=[];for(var h=0;h<l.length;h++)c.push(i.intersectObjects(l[h],!0))}var d=i.intersectObjects(o,!0)}else d=i.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(c.length>0)for(var p=0;p<c.length;p++)if(c[p].length>0)for(;0<c[p].length;p++)if("LineSegments"!=c[p][0].object.type){var u=null,g=!0,f=!0,m=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(g=c[p][0].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=c[p][0].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,m=c[p][0].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),c[p][0].object.visible&&g&&f&&m){u=c[p][0];break}}if(d.length>0)for(p=0;p<d.length;p++)if("LineSegments"!=d[p].object.type&&(g=!0,f=!0,m=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(g=d[p].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=d[p].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,m=d[p].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),d[p].object.visible&&g&&f&&m)){var y=!1;null!=u&&(y=u.distance<d[p].distance),y?e.handlePoints(n,u):e.handlePoints(n,d[p]),e.started&&a.clearRect(0,0,t.width,t.height);break}},this.mousemove=function(t){t.preventDefault(),t.stopPropagation();var a=Zp(d.domElement,t);e.started||(s.x=a.x/ti*2-1,s.y=-a.y/ai*2+1,e.getInterSects(s,e.color,!0))},this.mousedown=function(t){t.preventDefault(),t.stopPropagation();var a=Zp(d.domElement,t);gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=a.x/ti*2-1,s.y=-a.y/ai*2+1,e.numpoints<2?e.getInterSects(s,e.color,!1):e.started=!1)},this.mouseup=function(e){},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=Zp(t,a);e.started=!0,gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=i.x/ti*2-1,s.y=-i.y/ai*2+1,e.numpoints<2?e.getInterSects(s,e.color,!1):e.started=!1)},this.MSPointerUp=function(e){},this.touchstart=function(t){t.preventDefault(),e.started=!0;var a=qp(d.domElement,t,0);gi&&hn.getCurrentpage().usevector3Dxml&&(s.x=a.x/ti*2-1,s.y=-a.y/ai*2+1,e.numpoints<2?e.getInterSects(s,e.color,!1):e.started=!1)},this.touchcancel=function(e){},this.touchend=function(e){}},mn.select3d=function(e){var a,i=this,s=new THREE.Raycaster,r=new THREE.Vector2,o=(new THREE.Vector3,!1),l=null;a=hn.getCurrentpage().Vector3DPageObj.pointTreshold,s.params.Points.threshold=a,this.selectType=e.p1,this.name="select3d",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,Vp(Bp("select3d")),this.getInterSects=function(e,t){var a=null;if(s.setFromCamera(e,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var r=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),n=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),c=hn.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==r.length)return;var h=[];if(0==n.length)h=[];else for(var d=0;d<n.length;d++)h.push(s.intersectObjects(n[d],!0));if(0==c.length)var p=null;else p=s.intersectObjects(c);var u=s.intersectObjects(r,!0)}else u=s.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(p)if(p.length>0)for(var g=0;g<p.length;g++){var f=!0,m=!0,y=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=p[g].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=p[g].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=p[g].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),p[g].object.visible&&f&&m&&y){if("LineSegments"==p[g].object.type)continue;if("floorplan"==p[g].object.userData.type)o=!0;else if("Points"==p[g].object.type)o=t,a=p[g].object.uuid,t||1==i.selectType&&(hn.getCurrentpage().select3Dmarkup(a,!0),l=p[g].index);else{if("symbol"==p[g].object.userData.type){a=p[g].object.uuid,o=t,t||1==i.selectType&&hn.getCurrentpage().select3Dmarkup(a,!0);break}if("camera"==p[g].object.userData.type){a=p[g].object.uuid,1==i.selectType&&hn.getCurrentpage().select3Dmarkup(a,!0);break}}}else o=!0}else o=!0;else o=!0;if(h.length>0&&o)for(g=0;g<h.length;g++)if(h[g].length>0&&o)for(var v=0;v<h[g].length;v++)if("LineSegments"!=h[g][v].object.type){var x=null;if(f=!0,m=!0,y=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=h[g][v].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=h[g][v].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=h[g][v].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[g][v].object.visible&&f&&m&&y){if(t){hn.getCurrentpage().moveSelected3DMarkup(h[g][v].point,l);break}if(0==i.selectType){x=h[g][v];break}}}if(u.length>0&&o){for(g=0;g<u.length;g++)if("LineSegments"!=u[g].object.type&&(f=!0,m=!0,y=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=u[g].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=u[g].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=u[g].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),u[g].object.visible&&f&&m&&y)){if(t){hn.getCurrentpage().moveSelected3DMarkup(u[g].point,l);break}if(0==i.selectType){var b=!1;if(null!=x&&(b=x.distance<u[g].distance),b)var w=x.object.name;else w=u[g].object.name;hn.getCurrentpage().select3DBlock(w,!0,b),l=null;break}}}else null!=x&&(w=x.object.name,meshtype=x.object.type,w=hn.getCurrentpage().getMeshName(w,meshtype),hn.getCurrentpage().select3DBlock(w,!0,b),l=null)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),hn.getCurrentpage().camera.updateProjectionMatrix(),i.started=!0;var t=Zp(d.domElement,e);gi&&hn.getCurrentpage().usevector3Dxml&&(r.x=t.x/ti*2-1,r.y=-t.y/ai*2+1,i.getInterSects(r,!1))},this.mouseup=function(e){e.preventDefault(),e.stopPropagation(),i.started&&(i.started=!1)},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var t=Zp(d.domElement,e);gi&&hn.getCurrentpage().usevector3Dxml&&(r.x=t.x/ti*2-1,r.y=-t.y/ai*2+1,i.started&&i.getInterSects(r,!0),"markupedit"==hn.curcontrol3D&&Vl(n))},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation(),hn.getCurrentpage().camera.updateProjectionMatrix();var a=Zp(t,e);i.started=!0,gi&&hn.getCurrentpage().usevector3Dxml&&(r.x=a.x/ti*2-1,r.y=-a.y/ai*2+1,i.getInterSects(r))},this.MSPointerUp=function(e){i.started&&(i.started=!1)},this.touchstart=function(e){e.preventDefault(),i.started=!0,hn.getCurrentpage().camera.updateProjectionMatrix();var t=qp(d.domElement,e,0);gi&&hn.getCurrentpage().usevector3Dxml&&(r.x=t.x/ti*2-1,r.y=-t.y/ai*2+1,i.getInterSects(r))},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1)},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1)},this.keydown=function(e){if(null!=hn&&null!=hn&&gi&&!hn.bMarkupLocked)switch(Hr&&(hn.bMarkupLocked=Hr),e.keyCode){case 13:case 8:break;case 46:hn.getCurrentpage().delete3DMarkup()}}},mn.Walkthrough3D=function(){var e=this;this.name="Walkthrough3D",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.enabled=!0,this.noZoom=!1,this.enableSelect=!1,this.selectType=null;var t,a=new THREE.Raycaster,i=new THREE.Vector2,s=(new THREE.Vector3,!1),r=null;t=hn.getCurrentpage().Vector3DPageObj.pointTreshold,a.params.Points.threshold=t,hn.getCurrentpage().walkthroughcontrol.isLocked=!0,Vp(Bp("Walkthrough3D")),this.setSelect=function(t,a){e.enableSelect=t,e.selectType=a},this.getInterSects=function(t,i){var n=null;if(a.setFromCamera(t,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var o=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),l=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),c=hn.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==o.length)return;var h=[];if(0==l.length)h=[];else for(var d=0;d<l.length;d++)h.push(a.intersectObjects(l[d],!0));if(0==c.length)var p=null;else p=a.intersectObjects(c);var u=a.intersectObjects(o,!0)}else u=a.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(p)if(p.length>0)for(var g=0;g<p.length;g++){var f=!0,m=!0,y=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=p[g].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=p[g].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=p[g].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),p[g].object.visible&&f&&m&&y){if("LineSegments"==p[g].object.type)continue;if("floorplan"==p[g].object.userData.type)s=!0;else if("Points"==p[g].object.type)s=i,n=p[g].object.uuid,i||1==e.selectType&&(hn.getCurrentpage().select3Dmarkup(n,!0),r=p[g].index);else{if("symbol"==p[g].object.userData.type){n=p[g].object.uuid,s=i,i||1==e.selectType&&hn.getCurrentpage().select3Dmarkup(n,!0);break}if("camera"==p[g].object.userData.type){n=p[g].object.uuid,1==e.selectType&&hn.getCurrentpage().select3Dmarkup(n,!0);break}}}else s=!0}else s=!0;else s=!0;if(h.length>0&&s)for(g=0;g<h.length;g++)if(h[g].length>0&&s)for(var v=0;v<h[g].length;v++)if("LineSegments"!=h[g][v].object.type){var x=null;if(f=!0,m=!0,y=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=h[g][v].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=h[g][v].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=h[g][v].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[g][v].object.visible&&f&&m&&y){if(i){hn.getCurrentpage().moveSelected3DMarkup(h[g][v].point,r);break}if(0==e.selectType){x=h[g][v];break}}}if(u.length>0&&s){for(g=0;g<u.length;g++)if("LineSegments"!=u[g].object.type&&(f=!0,m=!0,y=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(f=u[g].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=u[g].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=u[g].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),u[g].object.visible&&f&&m&&y)){if(i){hn.getCurrentpage().moveSelected3DMarkup(u[g].point,r);break}if(0==e.selectType){var b=!1;if(null!=x&&(b=x.distance<u[g].distance),b)var w=x.object.name,k=x.object.type;else w=u[g].object.name,k=u[g].object.type;w=hn.getCurrentpage().getMeshName(w,k),hn.getCurrentpage().select3DBlock(w,!0,b),r=null;break}}}else null!=x&&(w=x.object.name,k=x.object.type,w=hn.getCurrentpage().getMeshName(w,k),hn.getCurrentpage().select3DBlock(w,!0,b),r=null)},this.commonMouseDown=function(t,a){if(gi&&hn.getCurrentpage().usevector3Dxml){var s=hn.getCurrentpage().walkthroughcontrol;if(e.started?s.onMouseDown(a):(s.onMouseDown(a),e.started=!0),e.enableSelect){e.selectstarted=!0;var r=Zp(d.domElement,t);hn.getCurrentpage().camera.updateProjectionMatrix(),i.x=r.x/ti*2-1,i.y=-r.y/ai*2+1,e.getInterSects(i,!1)}}},this.commonMouseMove=function(t,a,s){gi&&hn.getCurrentpage().usevector3Dxml&&(hn.getCurrentpage().walkthroughcontrol.onMouseMove(t),e.enableSelect&&(i.x=a/ti*2-1,i.y=-s/ai*2+1,e.selectstarted&&e.getInterSects(i,!0)))},this.commonMouseOut=function(){if(gi&&hn.getCurrentpage().usevector3Dxml)for(var e=1;e<7;e++)hn.getCurrentpage().walkthroughcontrol.movedirection(e,!1)},this.commonMouseUp=function(t){gi&&hn.getCurrentpage().usevector3Dxml&&(e.selectstarted=!1,hn.getCurrentpage().walkthroughcontrol.onMouseUp(t.button))},this.mousedown=function(t){t.preventDefault(),e.commonMouseDown(t,t.button)},this.touchstart=function(t){t.preventDefault(),e.commonMouseDown(t,0)},this.pointerdown=function(e){scope.MSPointerDown(e)},this.MSPointerDown=function(t){t.preventDefault(),e.commonMouseDown(t,t.button)},this.pointermove=function(e){scope.MSPointerMove(e)},this.mousemove=function(t){var a=Zp(d.domElement,t);e.commonMouseMove(t,a.x,a.y)},this.MSPointerMove=function(t){t.preventDefault();var a=Zp(d.domElement,t);e.commonMouseMove(t,a.x,a.y)},this.touchmove=function(t){t.preventDefault();var a=qp(d.domElement,t,0);e.commonMouseMove(t,a.x,a.y)},this.mouseup=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.pointerup=function(e){scope.MSPointerUp(e)},this.MSPointerUp=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.pointerout=function(e){scope.MSPointerOut(e)},this.touchcancel=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.touchend=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.MSPointerOut=function(t){t.preventDefault(),e.commonMouseOut()},this.mouseout=function(t){t.preventDefault(),e.commonMouseOut()},this.keydown=function(e){if(!e.altKey&&gi&&hn.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:hn.getCurrentpage().walkthroughcontrol.quickspeed(!0);break;case 87:hn.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 83:hn.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 65:hn.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 68:hn.getCurrentpage().walkthroughcontrol.movedirection(4,!0);break;case 82:hn.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 70:hn.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 33:hn.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 34:hn.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 38:hn.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 40:hn.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 37:hn.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 39:hn.getCurrentpage().walkthroughcontrol.movedirection(4,!0)}},this.keyup=function(e){if(gi&&hn.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:hn.getCurrentpage().walkthroughcontrol.quickspeed(!1);break;case 87:hn.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 83:hn.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 65:hn.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 68:hn.getCurrentpage().walkthroughcontrol.movedirection(4,!1);break;case 82:hn.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 70:hn.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 33:hn.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 34:hn.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 38:hn.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 40:hn.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 37:hn.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 39:hn.getCurrentpage().walkthroughcontrol.movedirection(4,!1)}},this.mousewheel=function(t){e.onMouseWheel(t)},this.wheel=function(t){e.onMouseWheel(t)},this.DOMMouseScroll=function(e){},this.onMouseWheel=function(t){if(!1!==e.enabled&&!0!==e.noZoom&&(t.preventDefault(),t.stopPropagation(),gi&&hn.getCurrentpage().usevector3Dxml)){var a=0;void 0!==t.wheelDelta?a=t.wheelDelta:void 0!==t.deltaY&&(a=-t.deltaY),a>0?hn.getCurrentpage().walkthroughcontrol.scrollforward(1):hn.getCurrentpage().walkthroughcontrol.scrollbackward(1)}}},mn.orbitControl=function(){var e=this,t=-1,a=[];this.name="orbitControl",this.anglelengthsupport=!1,this.refreshSupport=!1,this.object=hn.getCurrentpage().camera,this.domElement=d.domElement,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=.5,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.curmousepos={x:0,y:0,xus:0,yus:0},this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var i=this,s=1e-6,r=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,p=new THREE.Vector3,u=new THREE.Vector3,g=new THREE.Vector2,f=new THREE.Vector2,m=new THREE.Vector2,y=0,v=0,x=1,b=new THREE.Vector3,w=new THREE.Vector3,k=new THREE.Quaternion,D=-1,C=0,R=1,P=2,S=3,M=4,T=5,E=D,F=(new THREE.Quaternion).setFromUnitVectors(hn.getCurrentpage().camera.up,new THREE.Vector3(0,1,0));if(parseInt(THREE.REVISION)<=127)var I=F.clone().inverse();else I=F.clone().invert();this.selectstarted=!1,this.enableSelect=!1,this.selectType=null;var j,A=new THREE.Raycaster,O=new THREE.Vector2,L=(new THREE.Vector3,!1),V=null;function N(){return 2*Math.PI/60/60*i.autoRotateSpeed}function B(){return Math.pow(.95,i.zoomSpeed)}j=hn.getCurrentpage().Vector3DPageObj.pointTreshold,A.params.Points.threshold=j,Vp(Bp("orbitControl")),this.setSelect=function(t,a){e.enableSelect=t,e.selectType=a},this.getInterSects=function(t,a){var i=null;if(A.setFromCamera(t,hn.getCurrentpage().camera),hn.getCurrentpage().usevector3DGLTF){var s=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),r=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),n=hn.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==s.length)return;var o=[];if(0==r.length)o=[];else for(var l=0;l<r.length;l++)o.push(A.intersectObjects(r[l],!0));if(0==n.length)var c=null;else c=A.intersectObjects(n);var h=A.intersectObjects(s,!0)}else h=A.intersectObjects(hn.getCurrentpage().Vector3DPageObj.scene.children);if(c)if(c.length>0)for(var d=0;d<c.length;d++){var p=!0,u=!0,g=!0;if(hn.getCurrentpage().Vector3DPageObj.clippingOn&&(p=c[d].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,u=c[d].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=c[d].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),c[d].object.visible&&p&&u&&g){if("LineSegments"==c[d].object.type)continue;if("floorplan"==c[d].object.userData.type)L=!0;else if("Points"==c[d].object.type)L=a,i=c[d].object.uuid,a||1==e.selectType&&(hn.getCurrentpage().select3Dmarkup(i,!0),V=c[d].index);else{if("symbol"==c[d].object.userData.type){i=c[d].object.uuid,L=a,a||1==e.selectType&&hn.getCurrentpage().select3Dmarkup(i,!0);break}if("camera"==c[d].object.userData.type){i=c[d].object.uuid,1==e.selectType&&hn.getCurrentpage().select3Dmarkup(i,!0);break}}}else L=!0}else L=!0;else L=!0;if(o.length>0&&L)for(d=0;d<o.length;d++)if(o[d].length>0&&L)for(var f=0;f<o[d].length;f++)if("LineSegments"!=o[d][f].object.type&&!o[d][f].object.userData.temptransparent){var m=null;if(p=!0,u=!0,g=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(p=o[d][f].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,u=o[d][f].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=o[d][f].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),o[d][f].object.visible&&p&&u&&g){if(a){hn.getCurrentpage().moveSelected3DMarkup(o[d][f].point,V);break}if(0==e.selectType){m=o[d][f];break}}}if(h.length>0&&L){for(d=0;d<h.length;d++)if("LineSegments"!=h[d].object.type&&!h[d].object.userData.temptransparent&&(p=!0,u=!0,g=!0,hn.getCurrentpage().Vector3DPageObj.clippingOn&&(p=h[d].point.x>-hn.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,u=h[d].point.y>-hn.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=h[d].point.z<hn.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[d].object.visible&&p&&u&&g)){if(a){hn.getCurrentpage().moveSelected3DMarkup(h[d].point,V);break}if(0==e.selectType){var y=!1;if(null!=m&&(y=m.distance<h[d].distance),y)var v=m.object.name,x=m.object.type;else v=h[d].object.name,x=h[d].object.type;v=hn.getCurrentpage().getMeshName(v,x),hn.getCurrentpage().select3DBlock(v,!0,y),V=null;break}}}else null!=m&&(v=m.object.name,x=m.object.type,v=hn.getCurrentpage().getMeshName(v,x),hn.getCurrentpage().select3DBlock(v,!0,y),V=null)},this.resetCam=function(e){null!=e&&(this.object.matrix.fromArray(e),this.object.matrix.decompose(e,this.object.quaternion,this.object.scale))},this.restorelast=function(){this.object.position.copy(w),this.object.quaternion.copy(k)},this.setDimensions=function(t,a,i,s){e.maxDistance=t,e.target.copy(a),null!=s&&e.object.position.copy(s),e.update()},this.setinit=function(){e.target.set(0,5,0),e.update()},this.rotateLeft=function(e){void 0===e&&(e=N()),v-=e},this.rotateUp=function(e){void 0===e&&(e=N()),y-=e},this.panLeft=function(e){var t=this.object.matrix.elements;p.set(t[0],t[1],t[2]),p.multiplyScalar(-e),b.add(p)},this.panUp=function(e){var t=this.object.matrix.elements;p.set(t[4],t[5],t[6]),p.multiplyScalar(e),b.add(p)},this.pan=function(e,t){var a=i.domElement===document?i.domElement.body:i.domElement;if(void 0!==i.object.fov){var s=i.object.position.clone().sub(i.target).length();s*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*e*s/a.clientHeight),i.panUp(2*t*s/a.clientHeight)}else void 0!==i.object.top?(i.panLeft(e*(i.object.right-i.object.left)/a.clientWidth),i.panUp(t*(i.object.top-i.object.bottom)/a.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=B()),x/=e},this.dollyOut=function(e){void 0===e&&(e=B()),x*=e},this.update=function(){var e=this.object.position;u.copy(e).sub(this.target),u.applyQuaternion(F);var t=Math.atan2(u.x,u.z),a=Math.atan2(Math.sqrt(u.x*u.x+u.z*u.z),u.y);this.autoRotate&&this.rotateLeft(N()),t+=v,a+=y,a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a)),a=Math.max(s,Math.min(Math.PI-s,a));var i=u.length()*x;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(b),u.x=i*Math.sin(a)*Math.sin(t),u.y=i*Math.cos(a),u.z=i*Math.sin(a)*Math.cos(t),u.applyQuaternion(I),e.copy(this.target).add(u),this.object.lookAt(this.target),v=0,y=0,x=1,b.set(0,0,0),(w.distanceToSquared(this.object.position)>s||8*(1-k.dot(this.object.quaternion))>s)&&(w.copy(this.object.position),k.copy(this.object.quaternion))},this.reset=function(){E=D,null!=e.target0&&e.target.copy(e.target0),null!=e.position0&&e.object.position.copy(e.position0),this.enabled=!0,this.update()},this.mousedown=function(t){if(!1!==i.enabled){t.preventDefault(),t.stopPropagation(),e.started=!0;var a=Zp(i.domElement,t);if(gi&&hn.getCurrentpage().usevector3Dxml){if(0===t.button){if(!0===i.noRotate)return;E=C,r.set(a.x,a.y)}else if(1===event.button){if(!0===i.noZoom)return;E=R,g.set(a.x,a.y)}else if(2===event.button){if(!0===i.noPan)return;E=P,l.set(a.x,a.y)}e.enableSelect&&(e.selectstarted=!0,a=Zp(d.domElement,t),hn.getCurrentpage().camera.updateProjectionMatrix(),O.x=a.x/ti*2-1,O.y=-a.y/ai*2+1,e.getInterSects(O,!1))}}},this.mousemove=function(t){if(!1!==i.enabled){t.preventDefault();var a=Zp(i.domElement,t);e.curmousepos=a;var s=i.domElement===document?i.domElement.body:i.domElement;if(gi&&hn.getCurrentpage().usevector3Dxml){if(E===C){if(!0===i.noRotate)return;n.set(a.x,a.y),o.subVectors(n,r),i.rotateLeft(2*Math.PI*o.x/s.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/s.clientHeight*i.rotateSpeed),r.copy(n)}else if(E===R){if(!0===i.noZoom)return;f.set(a.x,a.y),m.subVectors(f,g),m.y>0?i.dollyIn():i.dollyOut(),g.copy(f)}else if(E===P){if(!0===i.noPan)return;c.set(a.x,a.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)}i.update(),e.enableSelect&&(O.x=0/ti*2-1,O.y=-0/ai*2+1,e.selectstarted&&e.getInterSects(O,!0))}}},this.mouseup=function(t){!1!==i.enabled&&(t.preventDefault(),t.stopPropagation(),e.started&&(e.started=!1,E=D),e.selectstarted=!1)},this.mousewheel=function(e){i.onMouseWheel(e)},this.wheel=function(e){i.onMouseWheel(e)},this.DOMMouseScroll=function(e){},this.panscroll=function(){var t=.5*si,a=.5*ii-e.curmousepos.xus,s=t-e.curmousepos.yus;l.set(a*x,s*x),c.set(a,s),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)},this.onMouseWheel=function(e){if(!1!==i.enabled&&!0!==i.noZoom&&(e.preventDefault(),e.stopPropagation(),gi&&hn.getCurrentpage().usevector3Dxml)){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=-e.deltaY),t>0?(i.dollyOut(),i.panscroll()):(i.dollyIn(),i.panscroll()),i.update()}},this.keydown=function(e){if(!1!==i.enabled&&!0!==i.noKeys&&!0!==i.noPan&&gi&&hn.getCurrentpage().usevector3Dxml)switch(e.keyCode){case i.keys.UP:i.pan(0,i.keyPanSpeed),i.update();break;case i.keys.BOTTOM:i.pan(0,-i.keyPanSpeed),i.update();break;case i.keys.LEFT:i.pan(i.keyPanSpeed,0),i.update();break;case i.keys.RIGHT:i.pan(-i.keyPanSpeed,0),i.update()}},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(s){s.preventDefault(),s.stopPropagation();var n=Zp(i.domElement,s);if(t++,a[t]=new Cn(s.pointerId,n.x,n.y),e.started=!0,gi&&hn.getCurrentpage().usevector3Dxml)switch(t){case 0:if(0===s.button){if(!0===i.noRotate)return;E=C,r.set(n.x,n.y)}else if(1===event.button){if(!0===i.noZoom)return;E=R,g.set(n.x,n.y)}else if(2===event.button){if(!0===i.noPan)return;E=P,l.set(n.x,n.y)}break;case 1:if(!0===i.noZoom)return;E=M;var o=Math.max(a[0].x,a[1].x)-Math.min(a[0].x,a[1].x),c=Math.max(a[0].y,a[1].y)-Math.min(a[0].y,a[1].y),h=Math.sqrt(o*o+c*c);g.set(0,h)}},this.pointermove=function(t){e.MSPointerMove(t)},this.MSPointerMove=function(e){if(gi&&!1!==i.enabled){e.preventDefault();for(var s=Zp(i.domElement,e),d=-1;d<t;)d++,a[d].pointID==e.pointerId&&(a[d].x=s.x,a[d].y=s.y);var p=i.domElement===document?i.domElement.body:i.domElement;if(gi&&hn.getCurrentpage().usevector3Dxml)switch(t){case 0:if(E===C){if(!0===i.noRotate)return;n.set(s.x,s.y),o.subVectors(n,r),i.rotateLeft(2*Math.PI*o.x/p.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/p.clientHeight*i.rotateSpeed),r.copy(n)}else if(E===R){if(!0===i.noZoom)return;f.set(s.x,s.y),m.subVectors(f,g),m.y>0?i.dollyIn():i.dollyOut(),g.copy(f)}else if(E===P){if(!0===i.noPan)return;c.set(s.x,s.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)}i.update();break;case 1:if(!0===i.noZoom)return;if(E!==M)return;var u=Math.max(a[0].x,a[1].x)-Math.min(a[0].x,a[1].x),y=Math.max(a[0].y,a[1].y)-Math.min(a[0].y,a[1].y),v=Math.sqrt(u*u+y*y);f.set(0,v),m.subVectors(f,g),m.y>0?i.dollyOut():m.y<0&&i.dollyIn(),g.copy(f),i.update();break;case 2:if(!0===i.noPan)return;if(E!==T)return;c.set(a[0].x,a[0].y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c),i.update();break;default:E=D}}},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerUp=function(a){t--,a.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))},this.touchstart=function(t){if(!1!==i.enabled&&(t.preventDefault(),e.started=!0,gi&&hn.getCurrentpage().usevector3Dxml)){var a=qp(d.domElement,t,0);switch(t.touches.length){case 1:if(!0===i.noRotate)return;E=S,r.set(a.x,a.y);break;case 2:if(!0===i.noZoom)return;var s=qp(d.domElement,t,1);E=M;var n=Math.max(a.x,s.x)-Math.min(a.x,s.x),o=Math.max(a.y,s.y)-Math.min(a.y,s.y),c=Math.sqrt(n*n+o*o);g.set(0,c);break;case 3:if(!0===i.noPan)return;E=T,l.set(a.x,a.y);break;default:E=D}}},this.touchmove=function(e){if(!1!==i.enabled){e.preventDefault(),e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;if(gi&&hn.getCurrentpage().usevector3Dxml){var a=qp(d.domElement,e,0);switch(event.touches.length){case 1:if(!0===i.noRotate)return;if(E!==S)return;n.set(a.x,a.y),o.subVectors(n,r),i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed),r.copy(n),i.update();break;case 2:var s=qp(d.domElement,e,1);if(!0===i.noZoom)return;if(E!==M)return;var p=Math.max(a.x,s.x)-Math.min(a.x,s.x),u=Math.max(a.y,s.y)-Math.min(a.y,s.y),y=Math.sqrt(p*p+u*u);f.set(0,y),m.subVectors(f,g),m.y>0?i.dollyOut():m.y<0&&i.dollyIn(),g.copy(f),i.update();break;case 3:if(!0===i.noPan)return;if(E!==T)return;c.set(a.x,a.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c),i.update();break;default:E=D}}}},this.touchcancel=function(t){t.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))},this.touchend=function(t){t.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))}},mn.magnify=function(){var e=this,a=0,i=0,s=0,r=0,c=0,h=0,d=0,p=0,u=0,g=0,f=0,m=0,y=0,v=0,x=0,b=0,w=0;this.name="magnify",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var k=1.5;Vp(Bp("magnify")),hn.getCurrentpage().usepdfjs&&hn.getCurrentpage().renderPDFMagnify(k),this.drawMagnify=function(e){hn.getCurrentpage().drawmagnify(e,l,k)},this.wheel=function(a){if(e.started&&gi){var i=0;void 0!==a.wheelDelta?i=a.wheelDelta:void 0!==a.deltaY&&(i=ri?-a.deltaY:50*-a.deltaY),i<0?k>1.5&&(k-=.2):k<10&&(k+=.2);var s=Zp(t,a);e.x0=s.x,e.y0=s.y,hn.getCurrentpage().usepdfjs&&hn.getCurrentpage().renderPDFMagnify(k),e.drawMagnify({x:e.x0,y:e.y0},l,k)}},this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=Zp(t,a);e.started=!0,e.x0=i.x,e.y0=i.y,e.x0,e.y0,o.style.top=i.yus-Se.height/2+"px",o.style.left=i.xus-Se.width/2+"px",o.style.visibility="visible"},this.mousedown=function(a){a.preventDefault(),a.stopPropagation(),e.started=!0;var i=Zp(t,a);e.x0=i.x,e.y0=i.y,e.x0,e.y0,o.style.top=i.yus-Se.height/2+"px",o.style.left=i.xus-Se.width/2+"px",o.style.visibility="visible"},this.touchstart=function(a){a.preventDefault(),e.started=!0;var i=qp(t,a,0);if(a.targetTouches.length>1)var s=qp(t,a,1);else s=qp(t,a,0);u=i.x,g=i.y,f=s.x,m=s.y,y=Math.abs(f-u),v=Math.abs(m-g);var r=Math.pow(y,2),n=Math.pow(v,2);x=Math.sqrt(r+n),b=x,w=x;var l=i.x+Se.width/2,c=i.y-Se.height/2;o.style.top=i.yus-Se.height+"px",o.style.left=i.xus+"px",o.style.visibility="visible",e.drawMagnify({x:l,y:c})},this.MSPointerMove=function(a){if(e.started){var i=Zp(t,a);i.x,i.y,o.style.top=i.yus-Se.height/2+"px",o.style.left=i.xus-Se.width/2+"px",e.drawMagnify(i),i.x,i.y}},this.mousemove=function(a){if(e.started){var i=Zp(t,a);i.x,i.y,o.style.top=i.yus-Se.height/2+"px",o.style.left=i.xus-Se.width/2+"px",e.drawMagnify(i),i.x,i.y}},this.touchmove=function(n){if(n.preventDefault(),e.started){var l=qp(t,n,0);if(n.targetTouches.length>1)var u=qp(t,n,1);else u=qp(t,n,0);c=l.x,d=l.y,h=u.x,p=u.y,a=Math.min(c,h),i=Math.min(d,p),s=Math.abs(h-c),r=Math.abs(p-d),a+s/2,i+r/2;var g=l.x+Se.width/2,f=l.y-Se.height/2;o.style.top=l.yus-Se.height+"px",o.style.left=l.xus+"px",e.drawMagnify({x:g,y:f});var m=Math.pow(s,2),y=Math.pow(r,2);x=Math.sqrt(m+y),w>=x?k=1.5:b-x>0?k>1.5&&(k-=.2):k<10&&(k+=.2),b=x}},this.MSPointerUp=function(t){e.started&&(e.mousemove(t),e.started=!1,o.style.visibility="hidden",hn.getCurrentpage().magnifyoff(),Vl(n))},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,o.style.visibility="hidden",hn.getCurrentpage().magnifyoff(),Vl(n))},this.touchcancel=function(t){t.preventDefault(),e.started&&t.targetTouches.length<1&&(e.started=!1,o.style.visibility="hidden",hn.getCurrentpage().magnifyoff(),Vl(n))},this.touchend=function(t){t.preventDefault(),e.started&&t.targetTouches.length<1&&(e.started=!1,o.style.visibility="hidden",hn.getCurrentpage().magnifyoff(),Vl(n))}},mn.note=function(){var e,i=this;this.started=!1,this.name="note",this.anglelengthsupport=!1,this.refreshSupport=!1,hn.markuplist.length,Vp(Bp("note")),this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(s){i.started=!0,hn&&(hn.bMarkupchanged=!0);var r=Zp(t,s);if(!fo(r))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));i.x0=r.x,i.y0=r.y,(e=new cl(10,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.scaling=lo();var n=ro();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),hn.selectedmarkup.id=hn.markuplist.length-1,Gs||(Ms=!0),Us=hn.markuplist.length-1,Dh(),i.started=!1,e=null,null!=Zt&&Zt.setNotediag(hn.markuplist[Us].text,!0),zs){if(null!=$t){var o={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],o)}}else Gs||null==$t||(o={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],o))},this.mousedown=function(s){i.started=!0,hn&&(hn.bMarkupchanged=!0);var r=Zp(t,s);if(!fo(r))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));i.x0=r.x,i.y0=r.y,(e=new cl(10,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.scaling=lo();var n=ro();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),hn.selectedmarkup.id=hn.markuplist.length-1,Us=hn.markuplist.length-1,Gs||(Ms=!0),Us=hn.markuplist.length-1,Dh(),i.started=!1,e=null,null!=Zt&&Zt.setNotediag(hn.markuplist[Us].text,!0),zs){if(null!=$t){var o={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],o)}}else Gs||null==$t||(o={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],o))},this.touchstart=function(s){i.started=!0,hn&&(hn.bMarkupchanged=!0);var r=qp(t,s,0);if(!fo(r))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));i.x0=r.x,i.y0=r.y,(e=new cl(10,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.scaling=lo();var n=ro();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),hn.selectedmarkup.id=hn.markuplist.length-1,Gs||(Ms=!0),Us=hn.markuplist.length-1,Dh(),i.started=!1,e=null,null!=Zt&&Zt.setNotediag(hn.markuplist[Us].text,!0),zs){if(null!=$t){var o={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],o)}}else Gs||null==$t||(o={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],o))},this.mouseup=function(e){},this.touchend=function(e){}},mn.text=function(){var e,a=this;this.name="text",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,hn.markuplist.length,this.pointerdown=function(e){a.MSPointerDown(e)},this.MSPointerDown=function(i){i.preventDefault(),i.stopPropagation(),a.started=!0,hn&&(hn.bMarkupchanged=!0);var s=Zp(t,i);if(!fo(s))return a.started=!1,void(hn&&(hn.bMarkupchanged=!1));a.x0=s.x,a.y0=s.y,(e=new cl(9,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.font.setFontname(Pn.fontName),e.scaling=lo();var r=ro();e.xoffset=r.x,e.yoffset=r.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.text="",e.savemetolistDraw(),hn.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=Yt&&Yt.setTextdiag("")},this.mousedown=function(i){i.preventDefault(),i.stopPropagation(),a.started=!0,hn&&(hn.bMarkupchanged=!0);var s=Zp(t,i);if(!fo(s))return a.started=!1,void(hn&&(hn.bMarkupchanged=!1));a.x0=s.x,a.y0=s.y,(e=new cl(9,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.font.setFontname(Pn.fontName),e.scaling=lo();var r=ro();e.xoffset=r.x,e.yoffset=r.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.savemetolistDraw(),hn.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=Yt&&Yt.setTextdiag("")},this.touchstart=function(i){a.started=!0,hn&&(hn.bMarkupchanged=!0);var s=qp(t,i,0);if(!fo(s))return a.started=!1,void(hn&&(hn.bMarkupchanged=!1));a.x0=s.x,a.y0=s.y,(e=new cl(9,0,0)).pagenumber=hn.getcurPage(),e.viewname=hn.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=ai,e.pagewidth=ti),e.font.setFontname(Pn.fontName),e.scaling=lo();var r=ro();e.xoffset=r.x,e.yoffset=r.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.savemetolistDraw(),hn.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=Yt&&Yt.setTextdiag("")},this.mouseup=function(e){a.started},this.touchend=function(e){}},mn.pencil=function(e){var i=this;this.started=!1,this.name="pencil",this.anglelengthsupport=!1,this.refreshSupport=!1,this.draw=!1,hn.markuplist.length;var s,r=0,n=e.p1;Vp(Bp("pencil")),this.newpencil=function(e,t){(s=new cl(0,e,0)).pagenumber=hn.getcurPage(),s.viewname=hn.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=ai,s.pagewidth=ti),s.scaling=lo();var a=ro();s.xoffset=a.x,s.yoffset=a.y,s.x=t.x,s.y=t.y,s.seteditaction(0)},this.mousedown=function(e){var a=Zp(t,e),o=fo(a);i.draw=!0,0==r&&o?(i.newpencil(n,a),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)):o&&(s.addline(),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)),r++},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){var a=Zp(t,e);i.draw=!0,0==r?(i.newpencil(n,a),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)):(s.addline(),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)),r++},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var r=Zp(t,e),n=fo(r);i.started&&i.draw&&n&&(s.addpoint(r.x,r.y),s.drawme(a))},this.pointermove=function(e){i.MSPointerMove(e)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var r=Zp(t,e);i.started&&i.draw&&(s.addpoint(r.x,r.y),s.drawme(a))},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerUp=function(e){e.preventDefault(),i.draw=!1},this.mouseup=function(e){e.preventDefault(),i.draw=!1},this.touchstart=function(e){e.preventDefault(),i.draw=!0;var a=qp(t,e,0),o=fo(a);0==r&&o?(i.newpencil(n,a),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)):o&&(s.addline(),i.started=!0,s.addpoint(a.x,a.y),hn&&(hn.bMarkupchanged=!0)),r++},this.touchmove=function(e){e.preventDefault();var r=qp(t,e,0),n=fo(r);i.started&&i.draw&&n&&(s.addpoint(r.x,r.y),s.drawme(a))},this.touchcancel=function(e){e.preventDefault(),i.draw=!1},this.touchend=function(e){e.preventDefault(),i.draw=!1},this.apply=function(){if(i.draw=!1,Gs||(Ms=!0),Us=hn.markuplist.length,s.addline(),s.findrectangle(),s.savemetolistDraw(),Dh(),i.started=!1,s=null,zs){if(null!=$t){var e={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],e)}}else Gs||null==$t||(e={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],e))}},mn.rect=function(e){var i,s,r=this,o=0,l=0,c=(hn.markuplist.length,!1);this.name="rect",this.anglelengthsupport=!0,this.refreshSupport=!1,this.bUsemouseinput=!0,this.started=!1;var h=e.p1,d=e.p2,p=e.redact;Vp(Bp("rect")),this.setWidthHeight=function(e,s){if(r.bUsemouseinput=!1,null!=i){i.x=r.x0,i.y=r.y0;var n=i.w,o=i.h,l=i.setWidthHeight(e,s),c={x:i.x+l.w,y:i.y+l.h};a.clearRect(0,0,t.width,t.height),fo(c)?(i.w=l.w,i.h=l.h,i.drawme(a)):(i.w=n,i.h=o,r.bUsemouseinput=!0,i.drawme(a),i.bUsemouseinput=!0,null!=qa&&qa.onDrawError("outside"))}},this.apply=function(){a.clearRect(0,0,t.width,t.height),i.drawme(a),r.endRect()},this.pointermove=function(e){r.MSPointerMove(e)},this.pointerdown=function(e){r.MSPointerDown(e)},this.pointerup=function(e){r.MSPointerUp(e)},this.startRect=function(e){if(r.started=!0,hn&&(hn.bMarkupchanged=!0),c){if(0!=hn.getCurrentpage().getpageRotation())var t=Mn(s);else t=s;r.x0=t.x,r.y0=t.y}else r.x0=e.x,r.y0=e.y;(i=new cl(h,d,Lr)).bRedact=p,3==d&&(i.transparency=30,i.fillcolor=An(i.fillcolor,i.transparency)),i.scaling=lo();var a=ro();i.xoffset=a.x,i.yoffset=a.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0)},this.drawRect=function(e){if(r.bUsemouseinput)if(c){if(0!=hn.getCurrentpage().getpageRotation())var t=Mn(s);else t=s;i.x=Math.min(t.x,r.x0),i.y=Math.min(t.y,r.y0),i.w=Math.abs(t.x-r.x0),i.h=Math.abs(t.y-r.y0),o=t.x,l=t.y}else i.x=Math.min(e.x,r.x0),i.y=Math.min(e.y,r.y0),i.w=Math.abs(e.x-r.x0),i.h=Math.abs(e.y-r.y0),o=e.x,l=e.y},this.endRect=function(){if(r.started=!1,Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),i=null,Dh(),Vl(n),zs){if(null!=$t){var e={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],e)}}else Gs||null==$t||(e={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],e))},this.setSnap=function(e){null==(s=hn.getCurrentpage().getsnap(e))&&(c=!1,a.clearRect(0,0,t.width,t.height)),s.found?(c=!0,Qp(a,s)):(c=!1,a.clearRect(0,0,t.width,t.height))},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation(),r.started=!0,hn&&(hn.bMarkupchanged=!0);var a=Zp(t,e);if(!fo(a))return r.started=!1,void(hn&&(hn.bMarkupchanged=!1));r.startRect(a)},this.mousedown=function(e){if(e.preventDefault(),e.stopPropagation(),r.started)r.mousemove(e),r.endRect(),r.started=!1;else{r.started=!0,hn&&(hn.bMarkupchanged=!0);var a=Zp(t,e);if(!fo(a))return r.started=!1,void(hn&&(hn.bMarkupchanged=!1));r.startRect(a)}},this.touchstart=function(e){e.preventDefault(),r.started=!0,hn&&(hn.bMarkupchanged=!0);var a=qp(t,e,0);if(!fo(a))return r.started=!1,void(hn&&(hn.bMarkupchanged=!1));r.x0=a.x,r.y0=a.y,(i=new cl(h,d,Lr)).bRedact=p,3==d&&(i.transparency=30,i.fillcolor=An(i.fillcolor,i.transparency)),i.scaling=lo();var s=ro();i.xoffset=s.x,i.yoffset=s.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.setSnap(n),r.started&&(fo(n)?r.drawRect(n):r.bUsemouseinput&&(i.x=Math.min(o,r.x0),i.y=Math.min(l,r.y0),i.w=Math.abs(o-r.x0),i.h=Math.abs(l-r.y0)),a.clearRect(0,0,t.width,t.height),c&&Qp(a,s),i.w&&i.h&&i.drawme(a))},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.setSnap(n),r.started&&(fo(n)?r.drawRect(n):r.bUsemouseinput&&(i.x=Math.min(o,r.x0),i.y=Math.min(l,r.y0),i.w=Math.abs(o-r.x0),i.h=Math.abs(l-r.y0)),a.clearRect(0,0,t.width,t.height),c&&Qp(a,s),i.drawme(a),i.w&&i.h)},this.touchmove=function(e){if(e.preventDefault(),r.started){var s=qp(t,e,0);if(fo(s)){var n=Math.min(s.x,r.x0),c=Math.min(s.y,r.y0),h=Math.abs(s.x-r.x0),d=Math.abs(s.y-r.y0);o=s.x,l=s.y}else n=Math.min(o,r.x0),c=Math.min(l,r.y0),h=Math.abs(o-r.x0),d=Math.abs(l-r.y0);r.bUsemouseinput&&(i.x=n,i.y=c,i.w=h,i.h=d),a.clearRect(0,0,t.width,t.height),h&&d&&i.drawme(a)}},this.MSPointerUp=function(e){r.started&&(r.mousemove(e),r.endRect(),r.started=!1)},this.mouseup=function(e){},this.touchcancel=function(e){e.preventDefault(),r.started&&(r.endRect(),r.started=!1)},this.touchend=function(e){e.preventDefault(),r.started&&(r.endRect(),r.started=!1)}},mn.count=function(e){var i,s=this,r=0,n=0;this.draw=!1,this.name="count",this.anglelengthsupport=!1,this.refreshSupport=!1,hn.markuplist.length;var o=e.p1,l=e.p2,c=0;this.curmousepos={x:0,y:0,xus:0,yus:0},Vp(Bp("count")),this.setdimoffset=function(e){if(null!=i){if(e){i.scaling=lo();var t=ro();i.xoffset=t.x,i.yoffset=t.y,s.orgscale=i.scaling,s.orgdx=i.xoffset,s.orgdy=i.yoffset}i.countshapes.length>0&&i.drawme(a)}},this.newshape=function(e,t){(i=new cl(o,e,0)).strokecolor=Sr,i.fillcolor=Sr,i.outerRadius=sr,i.innerRadius=.4*sr,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),s.setdimoffset(!0),i.seteditaction(0),i.addcount(t),i.countshapes.length>0&&i.drawme(a),c++},this.apply=function(){if(s.draw=!1,Gs||(Ms=!0),Us=hn.markuplist.length,i.findrectangle(),i.savemetolistDraw(),Dh(),s.started=!1,i=null,c=0,zs){if(null!=$t){var e={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],e)}}else Gs||null==$t||(e={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],e))},this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(hn.currentpage==hn.NumPages-1&&hn.getCurrentpage().endy<=t.height&&(e=0),hn.getCurrentpage().pan_update(0,-e)):(op(1.1,s.curmousepos)||bAllowfreeZoomOut?hn.getCurrentpage().ZoomOut(1.1,!1,!1,s.curmousepos):qd(),s.started&&s.setdimoffset(!1)):hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(0==hn.currentpage&&hn.getCurrentpage().starty>=0&&(e=0),hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,s.curmousepos),s.started&&s.setdimoffset(!1)))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),i=ti-60,r=ai-60;a.w/e<i&&a.h/e<r&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,s.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),s.scrollhandling(t)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var o=Zp(t,e),h=fo(o);if(s.draw=!0,0==e.button){if(!h)return s.started=!1,void(hn&&(hn.bMarkupchanged=!1));0==c?(s.started=!0,s.newshape(l,o)):(i.addcount(o),i.countshapes.length>0&&i.drawme(a),c++)}else r=o.x,n=o.y},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);s.curmousepos=a;var i=r-a.x,o=n-a.y;2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(i,o),s.setdimoffset(!1),r=a.x,n=a.y)},this.pointerdown=function(e){s.MSPointerDown(e)},this.pointermove=function(e){s.MSPointerMove(e)},this.MSPointerDown=function(e){var o=Zp(t,e),h=fo(o);if(s.draw=!0,0==e.button){if(!h)return s.started=!1,void(hn&&(hn.bMarkupchanged=!1));0==c?(s.started=!0,s.newshape(l,o)):(i.addcount(o),i.countshapes.length>0&&i.drawme(a),c++)}else r=o.x,n=o.y},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);s.curmousepos=a;var i=r-a.x,o=n-a.y;2==e.buttons&&(hn.getCurrentpage().pan_update(i,o),r=a.x,n=a.y)},this.touchstart=function(e){e.preventDefault(),e.stopPropagation();var r=qp(t,e,0),n=fo(r);if(s.draw=!0,!n)return s.started=!1,void(hn&&(hn.bMarkupchanged=!1));0==c?(s.started=!0,s.newshape(l,r)):(i.addcount(r),i.countshapes.length>0&&i.drawme(a),c++)},this.touchmove=function(e){e.preventDefault();var a=qp(t,e,0);r=a.x,n=a.y}},mn.clipboardimage=function(e){var i,s=this,r=(t.offsetLeft,t.offsetTop,{width:1,height:1}),n={x:0,y:0,w:r.width,h:r.height};hn.markuplist.length,this.name="clipboardimage",this.anglelengthsupport=!1,this.started=!1,this.clipboardimage=void 0,null!=e.p1?this.subtype=e.p1:this.subtype=1,this.setimage=function(e){var t=new Image;(i=new cl(11,s.subtype,0)).scaling=lo();var a=ro();i.xoffset=a.x,i.yoffset=a.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0),i.markupimageblob(e,t).then((function(e){r={width:e.naturalWidth,height:e.naturalHeight},n={x:0,y:0,w:r.width,h:r.height}}))},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i)if(i.imageloaded){var s=Zp(t,e),o=go(n={x:s.x,y:s.y,w:r.width,h:r.height});e.target.style.cursor=o?"copy":"not-allowed",a.clearRect(0,0,t.width,t.height),a.beginPath(),a.rect(n.x,n.y,n.w,n.h),a.stroke()}else e.target.style.cursor="default"},this.mousedown=function(e){if(e.preventDefault(),i&&i.imageloaded){var s=Zp(t,e),o=go(n);o&&(i.x=s.x,i.y=s.y,i.w=r.width,i.h=r.height,a.clearRect(0,0,t.width,t.height),Gs||(Ms=!0,Us=hn.markuplist.length),i.savemetolistDraw()),Dh(),i=null,!Gs&&o&&null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}}},mn.symbol=function(e){var i,s=this;t.offsetLeft,t.offsetTop,hn.markuplist.length,this.name="symbol",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,null!=e.p1?this.subtype=e.p1:this.subtype=1,Vp(Bp("symbol")),this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();var r=Zp(t,e);(i=new cl(11,s.subtype,0)).scaling=lo();var n=ro();i.xoffset=n.x,i.yoffset=n.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0);var o=fo(r),l=JSON.parse(e.dataTransfer.getData("Text")),c={x:r.x-l.width/2,y:r.y-l.height/2,w:l.width,h:l.height},h=!1;if(o=go(c)){i.x=r.x-l.width/2,i.y=r.y-l.height/2,i.w=l.width,i.h=l.height,l.svgContent&&(i.svgContent=l.svgContent),h=!0;var d=new Image;i.markupcdataset(d,l.src,e=>{if(a.clearRect(0,0,t.width,t.height),Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),Dh(),i=null,zs&&o){if(null!=$t){var s={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],s)}}else!Gs&&o&&null!=$t&&(s={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],s))})}o||null!=Ne&&Ne.markupSaved(),h||(Dh(),i=null)},this.mousedown=function(e){}},mn.interactiveStamp=function(e){var i,s=this;t.offsetLeft,t.offsetTop,hn.markuplist.length,this.name="interactiveStamp",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,void 0!==e.p1?this.subtype=e.p1:this.subtype=21,Vp(Bp("interactiveStamp")),this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();var r=Zp(t,e);(i=new cl(11,s.subtype,0)).scaling=lo();var n=ro();i.xoffset=n.x,i.yoffset=n.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0);var o=fo(r),l=JSON.parse(e.dataTransfer.getData("Text"));if(o=go({x:r.x-l.width/2,y:r.y-l.height/2,w:l.width,h:l.height})){i.x=r.x-l.width/2,i.y=r.y-l.height/2,i.w=l.width,i.h=l.height;var c=new Image;c.src=l.src,i.image=c,i.imageloaded=!0,a.clearRect(0,0,t.width,t.height),Gs||(Ms=!0,Us=hn.markuplist.length),Us=hn.markuplist.length,i.savemetolistDraw();var h=document.getElementById("foxitframe"),d=h.contentDocument||h.contentWindow.document;d.open(),d.write("<html><body>"+c.outerHTML+"</body></html>"),d.close();var p=d.querySelector("svg");p&&p.setAttribute("contenteditable","true")}if(o||void 0!==Ne&&Ne.markupSaved(),Dh(),i=null,zs&&o){if(void 0!==$t){var u={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],u)}}else!Gs&&o&&void 0!==$t&&(u={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],u))},this.mousedown=function(e){}},mn.link=function(e){var i,s=this;t.offsetLeft,t.offsetTop,hn.markuplist.length,this.name="link",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,null!=e.p1?this.subtype=e.p1:this.subtype=20,Vp(Bp("link")),this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();var r=Zp(t,e);(i=new cl(11,s.subtype,0)).scaling=lo();var n=ro();i.xoffset=n.x,i.yoffset=n.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0);var o=fo(r),l=JSON.parse(e.dataTransfer.getData("Text"));if(o=go({x:r.x-l.width/2,y:r.y-l.height/2,w:l.width,h:l.height})){i.x=r.x-l.width/2,i.y=r.y-l.height/2,i.w=l.width,i.h=l.height;var c=new Image;c.src=l.src,i.image=c,i.imageloaded=!0,i.linkURL=l.text,a.clearRect(0,0,t.width,t.height),Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw()}if(o||null!=Ne&&Ne.markupSaved(),Dh(),i=null,zs&&o){if(null!=$t){var h={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],h)}}else!Gs&&o&&null!=$t&&(h={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],h))},this.mousedown=function(e){}},mn.rectText=function(){var e=this;this.x=0,this.y=0,this.w=0,this.h=0;var i=0,s=0,r=0,o=0;this.name="rectText",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var l="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=l,a.fillStyle=l,Vp(Bp("rectText")),this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=Zp(t,a);if(!fo(i))return e.started=!1,void(hn&&(hn.bMarkupchanged=!1));2!=a.button&&(e.started=!0,e.x0=i.x,e.y0=i.y)},this.mousedown=function(a){a.preventDefault(),a.stopPropagation();var i=Zp(t,a);if(!fo(i))return e.started=!1,void(hn&&(hn.bMarkupchanged=!1));2!=a.button&&(e.started=!0,e.x0=i.x,e.y0=i.y)},this.touchstart=function(a){a.preventDefault(),e.started=!0;var i=qp(t,a,0);if(!fo(i))return e.started=!1,void(hn&&(hn.bMarkupchanged=!1));e.x0=i.x,e.y0=i.y},this.MSPointerMove=function(n){if(n.preventDefault(),n.stopPropagation(),e.started){var c=Zp(t,n);fo(c)?(i=Math.min(c.x,e.x0),s=Math.min(c.y,e.y0),r=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),s=Math.min(s,e.y0),r=Math.abs(i-e.x0),o=Math.abs(s-e.y0)),r&&o&&(l="rgba(175, 175, 175, 0.3)",a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillStyle=l,a.fillRect(i,s,r,o))}},this.mousemove=function(n){if(n.preventDefault(),n.stopPropagation(),e.started){var c=Zp(t,n);fo(c)?(i=Math.min(c.x,e.x0),s=Math.min(c.y,e.y0),r=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),s=Math.min(s,e.y0),r=Math.abs(i-e.x0),o=Math.abs(s-e.y0)),r&&o&&(l="rgba(175, 175, 175, 0.3)",a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillStyle=l,a.fillRect(i,s,r,o))}},this.touchmove=function(n){if(n.preventDefault(),e.started){var c=qp(t,n,0);fo(c)?(i=Math.min(c.x,e.x0),s=Math.min(c.y,e.y0),r=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),s=Math.min(s,e.y0),r=Math.abs(i-e.x0),o=Math.abs(s-e.y0)),r&&o&&(a.clearRect(0,0,t.width,t.height),l="rgba(175, 175, 175, 0.3)",a.lineWidth=1,a.strokeStyle=l,a.fillStyle=l,a.fillRect(i,s,r,o))}},this.MSPointerUp=function(n){if(n.preventDefault(),2!=n.button&&e.started){if(e.started=!1,!r||!o)return;Rp(i,s,r,o,null),e.x=i,e.y=s,e.w=r,e.h=o,a.clearRect(0,0,t.width,t.height)}},this.mouseup=function(l){if(l.preventDefault(),2!=l.button&&e.started){if(e.started=!1,!r||!o)return void(Gs&&function(){if(-1!=hn.selectedmarkup.id&&null!=hn.markuplist[hn.selectedmarkup.id]&&9==hn.markuplist[hn.selectedmarkup.id].type&&null!=qt&&hn.selectedmarkup.edit){qt.operation.edit=!1,qt.operation.start=!1,qt.operation.create=!1,qt.operation.save=!0,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var e=t.getBoundingClientRect(),i=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+e.left,s=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+e.top,r=hn.markuplist[hn.selectedmarkup.id].wscaled,o=hn.markuplist[hn.selectedmarkup.id].hscaled,l=ti/2,c=ai/2,h=i+.5*r,d=s+.5*o,p=hn.getCurrentpage().drotation*(Math.PI/180);if(0!=hn.getCurrentpage().drotation){var u=hn.markuplist[hn.selectedmarkup.id].getRotatedMarkup(l,c,h,d,p);h=u.x,d=u.y}h+=e.left,d+=e.top;var g=new Yn(i,s,r,o);g.rotation=hn.getCurrentpage().drotation;var f=Hl();g.x=(g.x-e.left)/f+e.left,g.y=(g.y-e.top)/f+e.top,g.w=g.w/f,g.h=g.h/f,qt.setTextInput(g),hn.selectedmarkup.edit=!1}-1!=hn.selectedmarkup.id&&null!=hn.markuplist[hn.selectedmarkup.id]&&(hn.markuplist[hn.selectedmarkup.id].setselectedit(!1),hn.markuplist[hn.selectedmarkup.id].setselect(!1)),Vl(n),Nl(a)}());Rp(i,s,r,o,null),e.w=0,e.h=0,r=0,o=0,a.clearRect(0,0,t.width,t.height)}},this.touchcancel=function(n){if(n.preventDefault(),e.started){if(e.started=!1,!r||!o)return;Rp(i,s,r,o,null),e.x=i,e.y=s,e.w=r,e.h=o,a.clearRect(0,0,t.width,t.height)}},this.touchend=function(n){if(n.preventDefault(),e.started){if(e.started=!1,!r||!o)return;Rp(i,s,r,o,null),e.x=i,e.y=s,e.w=r,e.h=o,a.clearRect(0,0,t.width,t.height)}}},mn.rectStamp=function(e){var i=this,s=0,r=0,n=0,o=0;this.name="rectStamp",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var l="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=l,a.fillStyle=l;var c=e.p1;Vp(Bp("rectStamp")),this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(!fo(a))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(!fo(a))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.touchstart=function(e){e.preventDefault(),i.started=!0;var a=qp(t,e,0);if(!fo(a))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));i.x0=a.x,i.y0=a.y},this.MSPointerMove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var c=Zp(t,e);fo(c)?(s=Math.min(c.x,i.x0),r=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(s=Math.min(s,i.x0),r=Math.min(r,i.y0),n=Math.abs(s-i.x0),o=Math.abs(r-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(s,r,n,o))}},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var c=Zp(t,e);fo(c)?(s=Math.min(c.x,i.x0),r=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(s=Math.min(s,i.x0),r=Math.min(r,i.y0),n=Math.abs(s-i.x0),o=Math.abs(r-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(s,r,n,o))}},this.touchmove=function(e){if(e.preventDefault(),i.started){var c=qp(t,e,0);fo(c)?(s=Math.min(c.x,i.x0),r=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(s=Math.min(s,i.x0),r=Math.min(r,i.y0),n=Math.abs(s-i.x0),o=Math.abs(r-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(s,r,n,o))}},this.MSPointerUp=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;Pp(s,r,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.mouseup=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;Pp(s,r,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.touchcancel=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;Pp(s,r,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.touchend=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;Pp(s,r,n,o,c),a.clearRect(0,0,t.width,t.height)}}},mn.zoomwindow=function(e){var i=this,s=0,r=0,n=0,o=0,l=e.p1,d=e.p2;this.name="zoomwindow",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.curcliprect={x:0,y:0,w:0,h:0};var p="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=p,a.fillStyle=p,Vp(Bp("zoomwindow")),this.pdfcliprect=function(e){var t=new Uint8ClampedArray(e.buffer),a=new ImageData(t,e.width,e.height);c.width=e.width,c.height=e.height,h.putImageData(a,0,0),hn.getCurrentpage().drawmarkupcliprect(i.curcliprect,h),ip(c)},this.zoomUpdate=function(e,s,r,n){if(l){var o=hn.getCurrentpage().screentoDocRect({x:e,y:s,w:r,h:n});null!=Ia&&Ia.zoomUpdate(o)}else if(d){var p=hn.getCurrentpage().getClipRect({x:e,y:s,w:r,h:n},i.pdfcliprect);i.curcliprect.x=e,i.curcliprect.y=s,i.curcliprect.w=r,i.curcliprect.h=n,null!=p&&(c.width=p.width,c.height=p.height,h.putImageData(p,0,0),hn.getCurrentpage().drawmarkupcliprect({x:e,y:s,w:r,h:n},h),ip(c))}else mi?dn.zoom_update(e,s,r,n):hn.getCurrentpage().zoom_update(e,s,r,n);a.clearRect(0,0,t.width,t.height)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.touchstart=function(e){e.preventDefault(),i.started=!0;var a=qp(t,e,0);i.x0=a.x,i.y0=a.y},this.MSPointerMove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var l=Zp(t,e);s=Math.min(l.x,i.x0),r=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=p,a.fillStyle=p,a.fillRect(s,r,n,o))}},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var l=Zp(t,e);s=Math.min(l.x,i.x0),r=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=p,a.fillStyle=p,a.fillRect(s,r,n,o))}},this.touchmove=function(e){if(e.preventDefault(),i.started){var l=qp(t,e,0);s=Math.min(l.x,i.x0),r=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=p,a.fillStyle=p,a.fillRect(s,r,n,o))}},this.MSPointerUp=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(s,r,n,o)}},this.mouseup=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(s,r,n,o)}},this.mouseout=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(s,r,n,o)}},this.touchcancel=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(s,r,n,o)}},this.touchend=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(s,r,n,o)}}},mn.pickPolygon=function(e){var i=this,s=0,r=0;this.started=!1;var o=e.p1;this.multiselect=o,this.createSpaceMarkup=e.p2,this.allowVectorSelect=e.p3,this.useVectorInfoSelect=e.p4,this.useBlockSelect=e.p5,this.name="PickPolygon",this.anglelengthsupport=!1,this.refreshSupport=!1,this.curmousepos={x:0,y:0,xus:0,yus:0},this.curkey=null,Vp(Bp("PickPolygon")),this.findvectorentityhover=function(e){qi&&hn.getCurrentpage().getvectorentityhover(e.x,e.y)},this.findvectorentity=function(e){hn.getCurrentpage().getvectorentity(e.x,e.y)},this.findBlockhover=function(e){hn.getCurrentpage().getblockinserthover(e.x,e.y)},this.findBlock=function(e){i.multiselect||hn.getCurrentpage().unSelectAllBlockInserts(),hn.getCurrentpage().getblockinsert(e.x,e.y)},this.findspacehover=function(e){i.useVectorInfoSelect?i.findvectorentityhover(e):i.useBlockSelect?i.findBlockhover(e):i.allowVectorSelect&&qi&&hn.getCurrentpage().getpolygonhover(e.x,e.y)},this.findspace=function(e){if(i.useVectorInfoSelect)i.findvectorentity(e);else{if(!i.useBlockSelect){var t=function(e,t,i){var s=0,r=!1,o=!1,l=-1,c=[],h={isempty:!0};for(s=hn.markupdraworder.length;s>0;s--)null!=hn.markuplist[s-1]&&8==hn.markuplist[s-1].type&&1==hn.markuplist[s-1].subtype&&(hn.markuplist[s-1].iswithin(e,t)&&hn.markuplist[s-1].display&&hn.markuplist[s-1].pagenumber==hn.getcurPage()?(o=!0,l=hn.markuplist[s-1].markupnumber,hn.markuplist[s-1].spaceselected=!hn.markuplist[s-1].spaceselected,r=hn.markuplist[s-1].spaceselected,hn.markuplist[s-1].linewidth=r?2:1,h={id:l,attr:hn.markuplist[s-1].GetAttributes(),isempty:!1}):i||(hn.markuplist[s-1].spaceselected=!1,hn.markuplist[s-1].linewidth=1));for(s=hn.markuplist.length;s>0;s--)null!=hn.markuplist[s-1]&&8==hn.markuplist[s-1].type&&1==hn.markuplist[s-1].subtype&&(i||h.id==hn.markuplist[s-1].markupnumber||(hn.markuplist[s-1].spaceselected=!1),i&&hn.markuplist[s-1].spaceselected&&(r=hn.markuplist[s-1].spaceselected,h={id:l=hn.markuplist[s-1].markupnumber,attr:hn.markuplist[s-1].GetAttributes(),isempty:!1},c.push(h)));return i?null!=Et&&Et.set2DBlockID(c):null!=Et&&Et.set2DBlockID(h),Xs||(Vl(n),Nl(a)),{found:r,within:o}}(e.x,e.y,i.multiselect);if(t.found?(i.multiselect||hn.getCurrentpage().unSelectAllBlocks(!1),dp(!0)):dp(!1),!t.within&&i.allowVectorSelect)var s=hn.getCurrentpage().getpolygon(e.x,e.y,i.multiselect);return s||t}i.findBlock(e)}},this.createSpace=function(e){var t=hn.getCurrentpage().getpolygonPath(e.x,e.y);if(null!=t&&t.points.length>0&&hn.getCurrentpage().VectorPageObj){var a=hn.getCurrentpage().dscalevector,i=hn.getCurrentpage().dxvector,s=hn.getCurrentpage().dyvector,r=hn.getCurrentpage().VectorPageObj.x;hn.getCurrentpage().VectorPageObj.y,function(e,t,a,i,s,r,o){var l=(e.points[0]-s)*t,c=(o-e.points[1])*t;l+=a,c+=i;var h=new cl(8,1,0);h.linewidth=1,h.AddAttribute("Rx_Area","0"),h.AddAttribute("SpaceID","0"),h.scaling=t,h.xoffset=a,h.yoffset=i,h.addpoint(l,c);for(var d=0,p=0,u=2;u<e.points.length;u+=2)d=(e.points[u]-s)*t,p=(o-e.points[u+1])*t,d+=a,p+=i,h.addpoint(d,p);var g=h.PolygonArea(),f=[];if(e.gotsubpath)for(var m=0;m<e.subpaths.length;m++){for(u=0;u<e.subpaths[m].points.length;u+=2)d=(e.subpaths[m].points[u]-s)*t,p=(o-e.subpaths[m].points[u+1])*t,d+=a,p+=i,f.push({x:d,y:p});var y=Ro(f);y>g&&(h.points=f.slice(),f=[],g=y)}h.findrectangle(),Ms=!0,Us=hn.markuplist.length,h.savemetolistLoad(hn),Dh(),Vl(n),null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}(t,a,i,s,r,0,hn.getCurrentpage().VectorPageObj.h)}},this.set3DModelPos=function(e){var t=hn.getCurrentpage();if(t.bis3Dnavigator&&null!=st){var a={docindex:hn.fileindex,pageindex:t.pagenumber,cameraPos:e};st.navClick(a)}},this.panlimit=function(){var e=hn.getCurrentpage().getpagedim();e.w/e.h<ti/ai?(e.y+e.h<ai-ar&&(e.h,rp(e.x,e.y)),e.y>ar&&rp(e.x,ar)):(e.x+e.w<ti-ar&&rp(-15,e.y),e.x>ar&&rp(ar,e.y))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),s=ti-60,r=ai-60;a.w/e<s&&a.h/e<r&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,i.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!hn.pagelocked?(hn.getCurrentpage().pan_update(0,-e),hn.getCurrentpage().pagenumber==hn.pages.length-1&&hn.getCurrentpage().getpageRotation()):As?i.scrollkeyOn&&(hn.getCurrentpage().usedincomposite&&!Gi||(op(1.1,i.curmousepos)?(hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Bi&&i.panlimit()):qd())):hn.getCurrentpage().usedincomposite&&!Gi||(op(1.1,i.curmousepos)?(hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Bi&&i.panlimit()):qd()):hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!hn.pagelocked?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e),0==hn.getCurrentpage().pagenumber&&hn.getCurrentpage().getpageRotation()):As?i.scrollkeyOn&&(hn.getCurrentpage().usedincomposite&&!Gi||hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos)):hn.getCurrentpage().usedincomposite&&!Gi||hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos))},this.mousewheel=function(e){i.wheel(e)},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=ri?-e.deltaY:50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(null!=Ua){var n={mousepos:a,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,s=i.x0,r=i.y0},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(null!=Ua){var n={mousepos:a,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,s=i.x0,r=i.y0},this.touchstart=function(e){e.preventDefault();var a=qp(t,e,0);if(null!=Ua){var n={mousepos:a,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,s=i.x0,r=i.y0,i.x0,i.y0},this.MSPointerMove=function(e){var a=Zp(t,e);if(i.findspacehover(a),i.curmousepos=a,i.started){var n=s-a.x,o=r-a.y;hn.getCurrentpage().pan_update(n,o),s=a.x,r=a.y}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(i.findspacehover(a),i.curmousepos=a,i.started){var n=s-a.x,o=r-a.y;hn.getCurrentpage().pan_update(n,o),s=a.x,r=a.y}},this.touchmove=function(e){e.preventDefault();var a=qp(t,e,0);if(i.curmousepos=a,i.started){var n=s-a.x,o=r-a.y;hn.getCurrentpage().pan_update(n,o),s=a.x,r=a.y}},this.MSPointerUp=function(e){i.started&&(i.MSPointerMove(e),i.started=!1)},this.mouseup=function(e){i.started&&(i.mousemove(e),i.started=!1)},this.touchend=function(e){e.preventDefault(),i.started&&(i.touchmove(e),i.started=!1)},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.touchmove(e),i.started=!1)},this.keyup=function(e){i.curkey=null},this.keydown=function(e){if(i.curkey=e.keyCode,null!=Ua){var t={mousepos:null,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(t)}}},mn.pan=function(){var e=this,a=0,i=0;this.started=!1,this.name="pan",this.anglelengthsupport=!1,this.refreshSupport=!1,Vp(Bp("pan")),this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(s){s.preventDefault(),s.stopPropagation();var r=Zp(t,s);e.started=!0,e.x0=r.x,e.y0=r.y,a=e.x0,i=e.y0},this.mousedown=function(s){s.preventDefault(),s.stopPropagation(),e.started=!0;var r=Zp(t,s);e.x0=r.x,e.y0=r.y,a=e.x0,i=e.y0},this.touchstart=function(s){s.preventDefault(),e.started=!0;var r=qp(t,s,0);e.x0=r.x,e.y0=r.y,a=e.x0,i=e.y0,e.x0,e.y0},this.MSPointerMove=function(s){if(e.started){var r=Zp(t,s),n=a-r.x,o=i-r.y;hn.getCurrentpage().pan_update(n,o),a=r.x,i=r.y}},this.mousemove=function(s){if(e.started){var r=Zp(t,s),n=a-r.x,o=i-r.y;hn.getCurrentpage().pan_update(n,o),a=r.x,i=r.y}},this.touchmove=function(s){if(s.preventDefault(),e.started){var r=qp(t,s,0),n=a-r.x,o=i-r.y;hn.getCurrentpage().pan_update(n,o),a=r.x,i=r.y}},this.MSPointerUp=function(t){e.started&&(e.mousemove(t),e.started=!1)},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1)},this.touchcancel=function(t){t.preventDefault(),e.started&&(e.touchmove(t),e.started=!1)},this.touchend=function(t){t.preventDefault(),e.started&&(e.touchmove(t),e.started=!1)}},mn.selectText=function(e){var a=this;this.started=!1,this.name="selectText",this.anglelengthsupport=!1,this.refreshSupport=!1,this.refreshSupport=!1,this.startPos={x:0,y:0},Vp(Bp("selectText")),this.pointermove=function(e){a.MSPointerMove(e)},this.pointerdown=function(e){a.MSPointerDown(e)},this.pointerup=function(e){a.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var i=Zp(t,e);a.started=!0,a.x0=i.xus,a.y0=i.yus,a.startPos=i,a.x0,a.y0,hn.getCurrentpage().SelectText(a.started,!1,a.startPos,i)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),a.started=!0;var i=Zp(t,e);a.x0=i.xus,a.y0=i.yus,a.startPos=i,a.x0,a.y0,hn.getCurrentpage().SelectText(a.started,!1,a.startPos,i)},this.touchstart=function(e){e.preventDefault(),a.started=!0;var i=qp(t,e,0);a.x0=i.xus,a.y0=i.yus,a.startPos=mousePos,a.x0,a.y0,a.x0,a.y0,hn.getCurrentpage().SelectText(a.started,!1,a.startPos,mousePos)},this.MSPointerMove=function(e){if(a.started){var i=Zp(t,e);i.xus,i.yus,a.x0=i.xus,a.y0=i.yus,hn.getCurrentpage().SelectText(!1,!1,a.startPos,i),i.xus,i.yus}},this.mousemove=function(e){if(a.started){var i=Zp(t,e);i.xus,i.yus,hn.getCurrentpage().SelectText(!1,!1,a.startPos,i),i.xus,i.yus}},this.touchmove=function(e){if(e.preventDefault(),a.started){var i=qp(t,e,0);i.xus,i.yus,hn.getCurrentpage().SelectText(!1,!1,a.startPos,i),i.xus,i.yus}},this.MSPointerUp=function(e){if(a.started){a.mousemove(e);var i=Zp(t,e);a.started=!1,hn.getCurrentpage().SelectText(a.started,!0,a.startPos,i)}},this.mouseup=function(e){if(a.started){a.mousemove(e);var i=Zp(t,e);a.started=!1,hn.getCurrentpage().SelectText(a.started,!0,a.startPos,i)}},this.touchcancel=function(e){if(e.preventDefault(),a.started){a.touchmove(e);var i=qp(t,e,0);a.started=!1,hn.getCurrentpage().SelectText(a.started,!0,a.startPos,i)}},this.touchend=function(e){if(e.preventDefault(),a.started){a.touchmove(e);var i=qp(t,e,0);hn.getCurrentpage().SelectText(a.started,!0,a.startPos,i),a.started=!1}}},mn.markupedit=function(e){var i=this,s=0,r=0,o=0,l=0,c=0,h=0,d=0,p=0,u=0,g=0,f=0,m=0,y=0,v=0,x=0,b=0,w=0,k=0,D=0,C=0,R=0,P=0,S=0,M=0,T=0,E=0,F=0,I=-1,j={},A=-1,O=[],L=!1,V=!1,N=0,B=0,U=0,G=0,z=0,H=e.p1;this.LastTouchdata=-1,this.started=!1,this.name="markupedit",this.anglelengthsupport=!1,this.refreshSupport=!1,this.savestate=!0,this.changedstate=!1,this.scrollkeyOn=!1,this.curkey=null,this.curmousepos={x:0,y:0,xus:0,yus:0};var _,W=!1;this.bdeletepoint=!1,this.binsertpoint=!1,this.bmovemousebutton=!1,Vp(Bp("markupedit")),this.findspacehover=function(e){qi&&hn.getCurrentpage().getpolygonhover(e.x,e.y)},this.enablePointDelete=function(){i.bdeletepoint=!0},this.enablePointInsert=function(){i.binsertpoint=!0},this.disablePointInsert=function(){i.binsertpoint=!1},this.enableMoveLabel=function(e){i.bmovelabel=e},this.scrollhandling=function(e){if(!yd()&&gi&&!hn.getCurrentpage().usevector3Dxml){du();var t=hn.getCurrentpage().usepdfjs&&hn.pages.length>1;e<0?!t&&!Os||Ls||hn.pagelocked?As?i.scrollkeyOn&&(hn.getCurrentpage().usedincomposite&&!Gi||(op(1.1,i.curmousepos)?(yi||hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Bi&&i.panlimit()):qd())):hn.getCurrentpage().usedincomposite&&!Gi||(op(1.1,i.curmousepos)?(yi||hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Bi&&i.panlimit()):qd()):(hn.currentpage,hn.pages.length,yi||hn.getCurrentpage().pan_update(0,-e),hn.getCurrentpage().pagenumber==hn.pages.length-1&&hn.getCurrentpage().getpageRotation()):!t&&!Os||Ls||hn.pagelocked?As?i.scrollkeyOn&&(hn.getCurrentpage().usedincomposite&&!Gi||yi||hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos)):hn.getCurrentpage().usedincomposite&&!Gi||yi||hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos):(hn.currentpage,yi||hn.getCurrentpage().pan_update(0,-e),0==hn.getCurrentpage().pagenumber&&hn.getCurrentpage().getpageRotation())}},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),s=ii-60,r=si-60;a.w/e<s&&a.h/e<r&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,i.curmousepos),o=si-30,l=ii-30;return n.y,n.h,n.y,n.w/n.h<ii/si?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.set3DModelPos=function(e){var t=hn.getCurrentpage();if(t.bis3Dnavigator&&null!=st){var a={docindex:hn.fileindex,pageindex:t.pagenumber,cameraPos:e};st.navClick(a)}},this.panlimit=function(){var e=hn.getCurrentpage().getpagedim();if(e.w/e.h<ti/ai){if(e.y+e.h<ai-ar){var t=ai-ar-e.h;rp(e.x,t)}e.y>ar&&rp(e.x,ar)}else e.x+e.w<ti-ar&&rp(-15,e.y),e.x>ar&&rp(ar,e.y)},this.limitPan=function(e,t){var a=hn.getCurrentpage().getpagedim(),i={up:!1,down:!1,left:!1,right:!1};i.down=t<0,i.up=t>0,i.left=e>0,i.right=e<0;var s=a.y-t,r=a.x-e,n=s+a.h,o=r+a.w,l={x:!0,y:!0,diffx:e,diffy:t};return Bi?(a.h<=ai-1?l.y=!1:(a.y>15&&i.down&&(l.y=!1),a.y+a.h<ai-15&&i.up&&(l.y=!1)),a.w<=ti-1?l.x=!1:(a.x>15&&i.right&&(l.x=!1),a.x+a.w<ti-15&&i.left&&(l.x=!1)),i.up&&l.y&&n<ai-15&&t>0&&(l.diffy=t-(ai-15-n)),i.down&&l.y&&s>15&&t<0&&(l.diffy=t+(s-15)),i.left&&l.x&&o<ti-15&&e>0&&(l.diffx=e-(ti-15-o)),i.right&&l.x&&r>15&&e<0&&(l.diffx=e+(r-15)),l):l},this.limitExtent=function(e){if(hn.getCurrentpage().usepdfjs){var t=hn.getCurrentpage().getpagedim();t.w*e<ti&&t.h*e<ai&&hn.getCurrentpage().zoomall()}else hn.getCurrentpage().usevectorxml?hn.getCurrentpage().initialscale>hn.getCurrentpage().dscalevector&&hn.getCurrentpage().zoomall():hn.getCurrentpage().initialscale>hn.getCurrentpage().dscale/hn.getCurrentpage().bitmapratio&&hn.getCurrentpage().zoomall()},this.DOMMouseScroll=function(e){},this.mousewheel=function(e){i.wheel(e)},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=ri?-e.deltaY:50*-e.deltaY),i.scrollhandling(t)},this.mousedownhandling=function(e,t){if(gi&&!hn.getCurrentpage().usevector3Dxml){var a=null;hn.getCurrentpage().usepdfjs&&(a=hn.mouseOnScroll(t)),null==a?e.target.style.cursor="move":a.hBarOn||a.vBarOn||(e.target.style.cursor="move"),V=!0,i.started=!0,i.x0=t.x,i.y0=t.y,c=i.x0,h=i.y0,i.set3DModelPos(t)}},this.mouseuphandler=function(e){if(gi&&(i.started||V)&&(i.started=!1,V=!1,0==hn.Type&&!mi&&!hn.pagelocked&&null==hn.foxitdoc)){if(0==hn.currentpage&&0==hn.getCurrentpage().getpageRotation())for(;hn.getCurrentpage().starty>0;)hn.getCurrentpage().pan_update(0,1);if(hn.currentpage==hn.NumPages-1&&0==hn.getCurrentpage().getpageRotation())for(;hn.getCurrentpage().endy<t.height;)hn.getCurrentpage().pan_update(0,-1)}},this.movehandler=function(e,o){if(gi&&null!=hn&&null!=hn){var l=hn.getCurrentpage().getcanvasdim();if(i.started||V){var d=c-e.x,p=h-e.y;if(0!=hn.Type||mi||hn.pagelocked){var u=i.limitPan(d,p),g=u.x?u.diffx:0,f=u.y?u.diffy:0;if(null==hn.getCurrentpage())return;yi||hn.getCurrentpage().pan_update(g,f)}else{if(null==hn.getCurrentpage())return;hn.getCurrentpage().startx<0||hn.getCurrentpage().endx>l.w?yi||hn.getCurrentpage().pan_update(d,p):0==hn.getCurrentpage().getpageRotation()?yi||hn.getCurrentpage().pan_update(0,p):yi||hn.getCurrentpage().pan_update(d,p)}c=e.x,h=e.y}else{n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),I=pl(e.x,e.y);var m=hn.getmarkupbynumber(I);-1!=I&&hn.markuplist[m].pagenumber==hn.getcurPage()&&hn.markuplist[m].display&&hn.Drawmarkup?-1!=I&&hn.markuplist[m].bhaveLink&&(hn.bMarkupLocked||hn.markuplist[m].locked)?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),hn.markuplist[m].displayurl(a,e.x,e.y)):-1!=I&&10==hn.markuplist[m].type?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),hn.markuplist[m].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),hn.markuplist[m].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),null!=Ue&&Ue.setMarkupHover(null,s,r))}}},this.panhandle=function(e,t){var a=hn.getCurrentpage().getcanvasdim();hn.getCurrentpage().usevectorxml?hn.getCurrentpage().initialscale<hn.getCurrentpage().dscalevector&&e<50&&t<50&&(yi||hn.getCurrentpage().pan_update(e,t)):(0==hn.Type&&(hn.getCurrentpage().startx<0||hn.getCurrentpage().endx>a.w?e<50&&t<50&&(yi||hn.getCurrentpage().pan_update(e,t)):mi?yi||hn.getCurrentpage().pan_update(e,t):yi||hn.getCurrentpage().pan_update(0,t)),hn.getCurrentpage().initialscale<hn.getCurrentpage().dscale/hn.getCurrentpage().bitmapratio&&(0==hn.Type?mi?yi||hn.getCurrentpage().pan_update(e,t):yi||hn.getCurrentpage().pan_update(0,t):e<50&&t<50&&(yi||hn.getCurrentpage().pan_update(e,t))))},this.labelhandler=function(e,o){if(gi&&null!=hn&&null!=hn&&!i.started){I=pl(e.x,e.y);var l=hn.getmarkupbynumber(I);-1!=I&&hn.markuplist[l].pagenumber==hn.getcurPage()&&hn.markuplist[l].display&&hn.Drawmarkup?(-1!=I&&hn.markuplist[l].bhaveLink&&(hn.bMarkupLocked||hn.markuplist[l].locked)?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),Vl(n),Nl(a),hn.markuplist[l].displayurl(a,e.x,e.y)):-1!=I&&10==hn.markuplist[l].type?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),Vl(n),Nl(a),hn.markuplist[l].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),Vl(n),Nl(a),hn.markuplist[l].displaylabel(a,e.x,e.y)),hn.draw3DNav()):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),null!=Ue&&Ue.setMarkupHover(null,s,r),Vl(n),Nl(a),hn.draw3DNav())}},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr),e.preventDefault(),e.stopPropagation(),i.started=!0;var s=Zp(t,e),r=fo(s);if(i.x0=s.x,i.y0=s.y,c=i.x0,h=i.y0,null!=Ua){var o={mousepos:s,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(o)}if(hn.bMarkupLocked){if(j=Pl(i.x0,i.y0,H),I=j.id,j.blink)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}else{if(i.binsertpoint&&r&&wl(s),j=Pl(i.x0,i.y0,H),I=j.id,j.locked&&j.blink)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}switch(O.push(new Cn(e.pointerId,s.x,s.y)),O.length){case 1:if(-1==I)Vl(n),Nl(a),i.mousedownhandling(e,s),hn.selectedmarkup.selected=!1,hn.selectedmarkup.edit=!1;else{if(i.savestate&&sl(I,1),i.savestate=!1,Vl(n),Nl(a),hn&&(hn.bMarkupchanged=!0),10==hn.markuplist[A].type&&(hn.selectedmarkup.id=A,hn.selectedmarkup.selected=!0),9==hn.markuplist[A].type){if(null!=qt&&hn.selectedmarkup.edit){qt.operation.edit=!1,qt.operation.start=!1,qt.operation.create=!1,qt.operation.save=!0,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var l=t.getBoundingClientRect(),d=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+l.left,p=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+l.top,u=hn.markuplist[hn.selectedmarkup.id].wscaled,g=hn.markuplist[hn.selectedmarkup.id].hscaled,D=ti/2,C=ai/2,P=d+.5*u,M=p+.5*g,T=hn.getCurrentpage().getpageRotation()*(Math.PI/180);if(0!=hn.getCurrentpage().getpageRotation()){var V=hn.markuplist[hn.selectedmarkup.id].getRotatedMarkup(D,C,P,M,T);P=V.x,M=V.y}P+=l.left,M+=l.top;var N=new Yn(d,p,u,g);N.rotation=hn.getCurrentpage().getpageRotation();var B=Hl();N.x=(N.x-l.left)/B+l.left,N.y=(N.y-l.top)/B+l.top,N.w=N.w/B,N.h=N.h/B,qt.setTextInput(N),qt.operation.edit=!1,hn.selectedmarkup.edit=!1}hn.selectedmarkup.id=A}4==hn.markuplist[A].editaction&&i.bdeletepoint&&(hn.markuplist[A].deletepoint(hn.markuplist[A].selectedpoint),Vl(n),Nl(a),i.bdeletepoint=!1),7==hn.markuplist[A].editaction&&i.binsertpoint&&(hn.markuplist[A].locked||hn.bMarkupLocked||(hn.markuplist[A].insertpoint(),Vl(n),Nl(a),i.binsertpoint=!1))}1!=e.button||i.started||(i.started=!0);break;case 2:L=!0,f=O[0].x,m=O[0].y,y=O[1].x,v=O[1].y;var U=Math.min(f,y),G=Math.min(m,y);x=Math.abs(y-f),b=Math.abs(v-m),w=Math.pow(x,2),k=Math.pow(b,2),R=Math.sqrt(w+k),S=R,E=U+x/2,F=G+b/2,lo(),lo()}}},this.mousedown=function(e){if(e.preventDefault(),e.stopPropagation(),!yd()){Hr&&(hn.bMarkupLocked=Hr);var s=Bl();if(!hn.getCurrentpage().usevector3Dxml||!s){i.started=!0;var r=Zp(t,e),o=fo(r);if(i.x0=r.x,i.y0=r.y,c=i.x0,h=i.y0,null!=Ua){var l={mousepos:r,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(l)}if(hn.bMarkupLocked){if(j=Pl(i.x0,i.y0,H),I=j.id,j.blink)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}else{if(i.binsertpoint&&o&&wl(r),j=Pl(i.x0,i.y0,H),I=j.id,j.locked&&j.blink)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}if(-1==I)i.started=!1,null!=$t&&($t.showContext=!1),hn.selectedmarkup.edit=!1,hn.selectedmarkup.selected=!1,Vl(n),Nl(a),i.mousedownhandling(e,r);else{if(i.savestate&&(fs||sl(I,1)),fs&&function(e){var t=0,a=bi+=1;for(t=0;t<hn.markuplist.length;t++)if(null!=hn.markuplist[t]){var i=hn.markuplist[t].selectedit&&9!=hn.markuplist[t].type;if(hn.markuplist[t].selected||i){if(hn.markuplist[t].bisTextArrow)continue;hn.markuplist[t].setmultiValues(a),hn.markuplist[t].savemarkupstateChanged(hn,e)}}}(1),i.savestate=!1,Vl(n),Nl(a),hn&&(hn.bMarkupchanged=!0),-1!=hn.selectedmarkup.id&&null!=hn.markuplist[hn.selectedmarkup.id]&&9==hn.markuplist[hn.selectedmarkup.id].type){if(null!=qt&&hn.selectedmarkup.edit){qt.operation.edit=!1,qt.operation.start=!1,qt.operation.create=!1,qt.operation.save=!0,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var d=t.getBoundingClientRect(),p=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+d.left,u=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+d.top,g=hn.markuplist[hn.selectedmarkup.id].wscaled,f=hn.markuplist[hn.selectedmarkup.id].hscaled,m=ti/2,y=ai/2,v=p+.5*g,x=u+.5*f,b=hn.getCurrentpage().getpageRotation()*(Math.PI/180);if(0!=hn.getCurrentpage().getpageRotation()){var w=hn.markuplist[hn.selectedmarkup.id].getRotatedMarkup(m,y,v,x,b);v=w.x,x=w.y}v+=d.left,x+=d.top;var k=new Yn(p,u,g,f);k.rotation=hn.getCurrentpage().getpageRotation();var D=Hl();k.x=(k.x-d.left)/D+d.left,k.y=(k.y-d.top)/D+d.top,k.w=k.w/D,k.h=k.h/D,qt.setTextInput(k),hn.selectedmarkup.edit=!1}hn.selectedmarkup.id=A}i.pointhandler(hn.markuplist[A]),10==hn.markuplist[A].type&&(hn.selectedmarkup.id=A)}1!=e.button||i.started||(i.started=!0),2==e.button&&i.started&&(i.bmovemousebutton=!0)}}},this.dblclick=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr),i.started=!0;var s=Zp(t,e);if(i.x0=s.x,i.y0=s.y,null!=Ua){var r={mousepos:s,mousebutton:e.button,dblclick:!0,key:i.curkey,tool:i.name};Ua.setInput(r)}var o=Bl();hn.getCurrentpage().usevector3Dxml&&o||(hn.bMarkupLocked?I=-1:(I=hl(i.x0,i.y0),A=hn.getmarkupbynumber(I)),-1==I||hn.markuplist[A].locked?(i.started=!1,i.savestate=!0):(sl(I,1),hn&&(hn.bMarkupchanged=!0),9==hn.markuplist[A].type&&(hn.markuplist[A].text,hn.selectedmarkup.id=A,hn.selectedmarkup.edit=!0,null!=Yt&&Yt.setTextdiag(hn.markuplist[hn.selectedmarkup.id].text),hn.markuplist[hn.selectedmarkup.id].editTextmarkupRect(),Nl(a),Vl(n),i.started=!1),10==hn.markuplist[A].type&&(hn.selectedmarkup.id=A)))}},this.doubletap=function(e){if(!yd()){if(Hr&&(hn.bMarkupLocked=Hr),null!=Ua){var s={mousepos:e,mousebutton:null,dblclick:!0,key:i.curkey,tool:i.name};Ua.setInput(s)}if(hn.bMarkupLocked?I=-1:(I=hl(e.x,e.y),A=hn.getmarkupbynumber(I)),-1!=I||hn.markuplist[A].locked){if(i.savestate&&(sl(I,1),hn&&(hn.bMarkupchanged=!0)),i.savestate=!1,9==hn.markuplist[A].type&&(hn.markuplist[A].text,null!=qt)){qt.operation.start=!1,qt.operation.create=!1,qt.operation.edit=!0,qt.operation.save=!1,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var r=t.getBoundingClientRect(),n=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+r.left,o=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+r.top,l=hn.markuplist[hn.selectedmarkup.id].wscaled,c=hn.markuplist[hn.selectedmarkup.id].hscaled,h=new Yn(n,o,l,c);h.rotation=hn.getCurrentpage().getpageRotation();var d=Hl();h.x=(h.x-r.left)/d+r.left,h.y=(h.y-r.top)/d+r.top,h.w=h.w/d,h.h=h.h/d,qt.setTextInput(h),hn.selectedmarkup.edit=!1}10==hn.markuplist[A].type&&(hn.selectedmarkup.id=A)}else i.started=!1,a.clearRect(0,0,t.width,t.height),i.savestate=!0}},this.touchstart=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr),e.preventDefault(),i.started=!0;var o=qp(t,e,0),l=fo(o),d=o.x,p=o.y;if(null!=Ua){var u={mousepos:o,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(u)}f=o.x,m=o.y,c=d,h=p,s=d,r=p;var g=(new Date).getTime(),D=g-(-1==i.LastTouchdata?g+1:i.LastTouchdata);switch(i.LastTouchdata=g,e.targetTouches.length){case 1:if(D<500&&D>0)i.doubletap(o);else{if(hn.bMarkupLocked){if(j=Pl(d,p,H),I=j.id,j.blink)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}else{if(i.binsertpoint&&l&&wl(o),j=Pl(d,p,H),I=j.id,j.blink&&j.locked)return i.started=!1,void(null!=ta&&ta.markupLink(hn.markuplist[j.index]));A=hn.getmarkupbynumber(I)}if(-1==I)i.started=!1,Vl(n),Nl(a),i.mousedownhandling(e,o),i.savestate=!0;else{if(i.savestate&&(sl(I,1),hn&&(hn.bMarkupchanged=!0)),i.savestate=!1,Vl(n),Nl(a),9==hn.markuplist[A].type){if(null!=qt&&hn.selectedmarkup.edit){qt.operation.edit=!1,qt.operation.start=!1,qt.operation.create=!1,qt.operation.save=!0,qt.operation.markup=hn.markuplist[hn.selectedmarkup.id];var C=t.getBoundingClientRect(),P=hn.markuplist[hn.selectedmarkup.id].rotatedrect.x+C.left,M=hn.markuplist[hn.selectedmarkup.id].rotatedrect.y+C.top,T=hn.markuplist[hn.selectedmarkup.id].wscaled,O=hn.markuplist[hn.selectedmarkup.id].hscaled,L=new Yn(P,M,T,O);L.rotation=hn.getCurrentpage().getpageRotation();var V=Hl();L.x=(L.x-C.left)/V+C.left,L.y=(L.y-C.top)/V+C.top,L.w=L.w/V,L.h=L.h/V,qt.setTextInput(L)}hn.selectedmarkup.id=A}i.pointhandler(hn.markuplist[A]),10==hn.markuplist[A].type&&(hn.selectedmarkup.id=A)}}break;case 2:var U=qp(t,e,1);y=U.x,v=U.y,x=Math.abs(y-f),b=Math.abs(v-m),N=y-f,B=v-m,G=180*Math.atan2(B,N)/Math.PI,w=Math.pow(x,2),k=Math.pow(b,2),R=Math.sqrt(w+k),S=R,E=f+x/2,F=m+b/2,lo(),lo()}}},this.pointhandler=function(e){var t=7==e.editaction;4==e.editaction&&i.bdeletepoint&&(e.deletepoint(e.selectedpoint),Vl(n),Nl(a),i.bdeletepoint=!1),t&&i.binsertpoint&&(e.locked||hn.bMarkupLocked||(e.insertpoint(),Vl(n),Nl(a),i.binsertpoint=!1))},this.MSPointerMove=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr);var n=!1,f=0,m=Zp(t,e);for(i.findspacehover(m),i.curmousepos=m;f<O.length;)O[f].pointID==e.pointerId&&(O[f].x=m.x,O[f].y=m.y),f++;switch(O.length){case 0:if(i.labelhandler(m,e),!i.started)return;break;case 1:if(!i.started)return;var y=c-m.x,v=h-m.y;if(1==e.buttons){if(-1==I||hn.bMarkupLocked||hn.markuplist[A].locked)i.movehandler(m,e);else{_=hn.getCurrentpage().getsnap(m),W=!(!_||!_.found||null==_)&&(_.found||null!=_),4==hn.markuplist[A].editaction&&(W&&(w=0!=hn.getCurrentpage().getpageRotation()?Mn(_):_,y=c-w.x,v=h-w.y,n=!0),fo(m),Nl(a),i.changedstate=!0);var x=!i.binsertpoint&&7==hn.markuplist[A].editaction,b=!i.bmovelabel&&8==hn.markuplist[A].editaction;if((1==hn.markuplist[A].editaction||x||b)&&(e.target.style.cursor="move",fs||hn.getMarkupMultiselected()?hn.moveselected(y,v):hn.markuplist[A].move(y,v),Nl(a),i.changedstate=!0),2==hn.markuplist[A].editaction){if(W){if(0!=hn.getCurrentpage().getpageRotation())var w=Mn(_);else w=_;y=c-w.x,v=h-w.y,n=!0}e.target.style.cursor="nw-resize",hn.markuplist[A].scale(y,v,hn.markuplist[A].scalecorner,a),Nl(a),i.changedstate=!0}3==hn.markuplist[A].editaction&&(hn.markuplist[A].rotate(m.x,m.y,hn.markuplist[A].scalecorner),Nl(a),i.changedstate=!0),6==hn.markuplist[A].editaction&&(e.target.style.cursor="move",hn.markuplist[A].dimextend(m.x,m.y),Nl(a),i.changedstate=!0),8!=hn.markuplist[A].editaction||!i.bmovelabel||$r||hn.markuplist[A].hidevaluelabel||(e.target.style.cursor="move",hn.markuplist[A].movelabel(y,v),Nl(a),i.changedstate=!0)}n&&W?(w=0!=hn.getCurrentpage().getpageRotation()?Mn(_):_,c=w.x,h=w.y):(c=m.x,h=m.y)}else 4==e.buttons&&(yi||hn.getCurrentpage().pan_update(y,v),c=m.x,h=m.y,Nl(a));break;case 2:if(!L)return;d=O[0].x,u=O[0].y,p=O[1].x,g=O[1].y,s=Math.min(d,p),r=Math.min(u,g),o=Math.abs(p-d),l=Math.abs(g-u),D=Math.pow(o,2),C=Math.pow(l,2);var k=(P=Math.sqrt(D+C))-S,R=P*(1/S);y=E-(M=s+o/2),v=F-(T=r+l/2),(k>2||k<-2)&&hn.getCurrentpage().ZoomIn(R,!1,!1),S=P,E=M,F=T}}},this.mouseout=function(e){i.bmovemousebutton=!1,i.mouseuphandler(e),I=-1},this.mousemove=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr);var s=!1,r=Zp(t,e);if(i.findspacehover(r),i.curmousepos=r,i.labelhandler(r,e),i.started){var n=c-r.x,o=h-r.y;if(0==e.button){if(-1==I||hn.bMarkupLocked||hn.markuplist[A].locked||i.bmovemousebutton)i.movehandler(r,e);else{_=hn.getCurrentpage().getsnap(r),W=!(!_||!_.found||null==_)&&(_.found||null!=_),4==hn.markuplist[A].editaction&&(W&&(p=0!=hn.getCurrentpage().getpageRotation()?Mn(_):_,n=c-p.x,o=h-p.y,s=!0),fo(r)&&(0==hn.getCurrentpage().getpageRotation()?hn.markuplist[A].snapTo(r.x,r.y,hn.markuplist[A].selectedpoint):Fn(r.x,r.y),W?(0!=hn.getCurrentpage().getpageRotation()?(p=_,null!=hn.foxitdoc&&(p=hn.markuplist[A].AdjustPointForRotation({x:p.x,y:p.y}))):p=_,hn.markuplist[A].snapTo(p.x,p.y,hn.markuplist[A].selectedpoint)):hn.markuplist[A].editpoint(n,o,hn.markuplist[A].selectedpoint)),Nl(a),i.changedstate=!0);var l=!i.binsertpoint&&7==hn.markuplist[A].editaction,d=!i.bmovelabel&&8==hn.markuplist[A].editaction;if((1==hn.markuplist[A].editaction||l||d)&&(e.target.style.cursor="move",fs||hn.getMarkupMultiselected()?hn.moveselected(n,o):hn.markuplist[A].move(n,o),Nl(a),i.changedstate=!0),2==hn.markuplist[A].editaction){if(W){if(0!=hn.getCurrentpage().getpageRotation())var p=Mn(_);else p=_;n=c-p.x,o=h-p.y,s=!0}1==hn.markuplist[A].scalecorner||4==hn.markuplist[A].scalecorner?e.target.style.cursor="nw-resize":e.target.style.cursor="ne-resize",!W||6!=hn.markuplist[A].type&&7!=hn.markuplist[A].type?hn.markuplist[A].scale(n,o,hn.markuplist[A].scalecorner,a):hn.markuplist[A].snapToCorner(_.x,_.y,hn.markuplist[A].scalecorner),Nl(a),i.changedstate=!0}3==hn.markuplist[A].editaction&&(hn.markuplist[A].rotate(r.x,r.y,hn.markuplist[A].scalecorner),Nl(a),i.changedstate=!0),6==hn.markuplist[A].editaction&&(e.target.style.cursor="move",hn.markuplist[A].dimextend(r.x,r.y),Nl(a),i.changedstate=!0),8==hn.markuplist[A].editaction&&i.bmovelabel&&!hn.markuplist[A].hidevaluelabel&&(e.target.style.cursor="move",hn.markuplist[A].movelabel(n,o),Nl(a),i.changedstate=!0)}s&&W?(p=0!=hn.getCurrentpage().getpageRotation()?Mn(_):_,c=p.x,h=p.y):(c=r.x,h=r.y)}else 1==e.button&&(yi||hn.getCurrentpage().pan_update(n,o),c=r.x,h=r.y,Nl(a))}}},this.touchmove=function(e){if(!yd()){Hr&&(hn.bMarkupLocked=Hr),e.preventDefault();var s=qp(t,e,0),r=s.x,n=s.y;d=s.x,u=s.y;var f=c-d,m=h-u;switch(e.targetTouches.length){case 1:if(-1==I||hn.bMarkupLocked||hn.markuplist[A].locked)hn.getCurrentpage().usevectorxml?hn.getCurrentpage().initialscale<hn.getCurrentpage().dscalevector&&f<50&&m<50&&(yi||hn.getCurrentpage().pan_update(f,m)):(0==hn.Type&&(hn.getCurrentpage().startx<0||hn.getCurrentpage().endx>t.width?f<50&&m<50&&(yi||hn.getCurrentpage().pan_update(f,m)):yi||hn.getCurrentpage().pan_update(f,m)),hn.getCurrentpage().initialscale<hn.getCurrentpage().dscale/hn.getCurrentpage().bitmapratio&&(0==hn.Type?mi?yi||hn.getCurrentpage().pan_update(f,m):yi||hn.getCurrentpage().pan_update(0,m):f<50&&m<50&&(yi||hn.getCurrentpage().pan_update(f,m))));else{if(!i.started)return;var y=!i.binsertpoint&&7==hn.markuplist[A].editaction,v=!i.bmovelabel&&8==hn.markuplist[A].editaction;(1==hn.markuplist[A].editaction||y||v)&&(fs||hn.getMarkupMultiselected()?hn.moveselected(f,m):hn.markuplist[A].move(f,m),Nl(a),i.changedstate=!0),2==hn.markuplist[A].editaction&&(hn.markuplist[A].scale(f,m,hn.markuplist[A].scalecorner,a),Nl(a),i.changedstate=!0),3==hn.markuplist[A].editaction&&(hn.markuplist[A].rotate(r,n,hn.markuplist[A].scalecorner),Nl(a),i.changedstate=!0),4==hn.markuplist[A].editaction&&(hn.markuplist[A].editpoint(f,m,hn.markuplist[A].selectedpoint),Nl(a),i.changedstate=!0),6==hn.markuplist[A].editaction&&(e.target.style.cursor="move",hn.markuplist[A].dimextend(s.x,s.y),Nl(a),i.changedstate=!0),8!=hn.markuplist[A].editaction||!i.bmovelabel||$r||hn.markuplist[A].hidevaluelabel||(e.target.style.cursor="move",hn.markuplist[A].movelabel(f,m),Nl(a),i.changedstate=!0)}c=s.x,h=s.y;break;case 2:var x=qp(t,e,1);p=x.x,g=x.y,o=Math.abs(p-d),l=Math.abs(g-u),D=Math.pow(o,2),C=Math.pow(l,2);var b=(P=Math.sqrt(D+C))-S,w=P*(1/S),k=p-d,R=g-u;z=180*Math.atan2(R,k)/Math.PI,U=z-G;var j={x:M=d+o/2,y:T=u+l/2};if(b>2||b<-2){if(w<1)var O=1/w,L=!0;else O=w,L=!1;L?!!i.belowlimitExtent(O)&&hn.getCurrentpage().ZoomOut(O,!1,!1,j):hn.getCurrentpage().ZoomIn(O,!1,!1,j),S=P}Math.abs(U)}E=M,F=T,c=d,h=u}},this.keyup=function(e){switch("function"==typeof bs.indexOf&&bs.indexOf(e.keyCode)>=0&&(i.scrollkeyOn=!1),e.keyCode){case bs:i.scrollkeyOn=!1}i.curkey=null},this.keydown=function(e){if(!yd()){if(i.curkey=e.keyCode,null!=Ua){var t={mousepos:null,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ua.setInput(t)}if(Hr&&(hn.bMarkupLocked=Hr),!hn.bMarkupLocked)switch("function"==typeof bs.indexOf&&bs.indexOf(e.keyCode)>=0&&(i.scrollkeyOn=!0),e.keyCode){case bs:i.scrollkeyOn=!0;break;case 13:case 8:break;case 46:if(!fs){if(-1==A)break;if(null==hn.markuplist[A])break}if(-1!=A&&9==hn.markuplist[A].type&&hn.markuplist[A].selectedit)break;if(js)break;Fl()}}},this.MSPointerUp=function(e){yd()||(i.bmovemousebutton=!1,O.pop(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==hn.markuplist[A].editaction&&hn.markuplist[A].findrectangle(),i.started=!1):i.mouseuphandler(e)))},this.mouseup=function(e){yd()||(i.bmovemousebutton=!1,i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==hn.markuplist[A].editaction&&hn.markuplist[A].findrectangle(),i.started=!1):i.mouseuphandler(e)))},this.touchcancel=function(e){yd()||(e.preventDefault(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==hn.markuplist[A].editaction&&hn.markuplist[A].findrectangle(),i.started=!1,0!=hn.Type||mi||(hn.currentpage,hn.currentpage,hn.NumPages)):i.mouseuphandler(e)))},this.touchend=function(e){yd()||(e.preventDefault(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==hn.markuplist[A].editaction&&hn.markuplist[A].findrectangle(),i.started=!1,0!=hn.Type||mi||(hn.currentpage,hn.currentpage,hn.NumPages)):i.mouseuphandler(e)))}},mn.arrow=function(e){var i,s=this,r=0,n=0,o=0,l=0;hn.markuplist.length,this.started=!1,this.name="arrow",this.anglelengthsupport=!0,this.refreshSupport=!1;var c,h=!1,d=!1,p=e.p1;this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.bfirstpointset=!1,this.bUsemouseinput=!0,this.curmousepos={x:0,y:0,xus:0,yus:0},Vp(Bp(6==p?"callout":"arrow")),this.setAngleLength=function(e,r,n,o){if(this.bUsemouseinput=!1,null!=i){i.x=s.x0,i.y=s.y0;var l=i.w,c=i.h,h=i.setAnglelength(r,e,o);a.clearRect(0,0,t.width,t.height),fo({x:h.w,y:h.h})?(i.w=h.w,i.h=h.h,s.setdimoffset(!1),i.drawme(a)):(i.w=l,i.h=c,this.bUsemouseinput=!0,i.drawme(a),i.bUsemouseinput=!0,null!=qa&&qa.onDrawError("outside"))}},this.apply=function(){a.clearRect(0,0,t.width,t.height),s.setdimoffset(!1),i.drawme(a),Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),i=null,s.started=!1,Dh(),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})},this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1?(hn.currentpage,hn.NumPages,hn.getCurrentpage().pan_update(0,-e)):(op(1.1,s.curmousepos)?(hn.getCurrentpage().ZoomOut(1.1,!1,!1,s.curmousepos),s.started&&s.setdimoffset(!1)):qd(),s.started&&(s.drawArrow({x:s.curmousepos.x,y:s.curmousepos.y}),null!=i&&(a.clearRect(0,0,t.width,t.height),i.drawme(a)))):hn.getCurrentpage().usepdfjs&&hn.pages.length>1?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,s.curmousepos),s.started&&(s.setdimoffset(!1),s.drawArrow({x:s.curmousepos.x,y:s.curmousepos.y}),null!=i&&i.drawme(a))))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),i=ti-60,r=ai-60;a.w/e<i&&a.h/e<r&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,s.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),s.scrollhandling(t)},this.setdimoffset=function(e){if(e){i.scaling=lo(),i.loadscaling=lo();var t=ro();i.xoffset=t.x,i.yoffset=t.y,s.orgscale=i.scaling,s.orgdx=i.xoffset,s.orgdy=i.yoffset}var a=hn.getCurrentpage().getdscale();hn.getCurrentpage().getdx(),hn.getCurrentpage().getdy();if(i){i.scaling;i.w,i.xoffset,i.h,i.yoffset}},this.pointermove=function(e){s.MSPointerMove(e)},this.pointerdown=function(e){s.MSPointerDown(e)},this.pointerup=function(e){s.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);i&&(a=i.getPadding(a));var o=fo(a);0==e.button?s.started?s.completeArrow(o,a):s.startArrow(o,a):(r=a.x,n=a.y)},this.startArrow=function(e,t){if(e){if(s.started=!0,hn&&(hn.bMarkupchanged=!0),h){if(0!=hn.getCurrentpage().getpageRotation())var a=Mn(c);else a=c;s.x0=a.x,s.y0=a.y}else s.x0=t.x,s.y0=t.y;10==p?i=new cl(4,1,Lr):(i=new cl(6,p,0)).pagerotation=hn.getCurrentpage().getpageRotation(),i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),s.setdimoffset(!0),s.startx=s.x0,s.starty=s.y0,i.seteditaction(0)}},this.completeArrow=function(e,r){if(s.bfirstpointset){var n={x:s.x0,y:s.y0};if(4==i.type&&1==i.subtype)var o=po(n,r);else o=!0;if(Vs&&(Vs=!1,d=!0),e&&o){if(s.started=!1,h){if(0!=hn.getCurrentpage().getpageRotation())var l=Mn(c);else l=c;s.bUsemouseinput&&(i.w=l.x,i.h=l.y)}else s.bUsemouseinput&&(hn.getCurrentpage().getpageRotation(),i.w=r.x,i.h=r.y);if(a.clearRect(0,0,t.width,t.height),s.setdimoffset(!1),i.drawme(a),Gs||(Ms=!0),Us=hn.markuplist.length,6==p){Vs&&(Vs=!0,d=!1);var u=i.getdrawBox(r)}if(i.savemetolistDraw(),d){var g=i.calculateOrthoDraw({x:i.x,y:i.y},{x:i.w,y:i.h});i.w=g.w,i.h=g.h}i=null,Dh(),6==p&&Rp(u.x,u.y,u.w,u.h,hn.markuplist[Us]),jd(),zs?null!=$t&&(6==p?$t.setMarkupSelected(hn.markuplist[Us].textBoxConnected,{created:!0,modified:!1,deleted:!1,multi:Gs}):$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs})):Gs||null!=$t&&(6==p?$t.setMarkupSelected(hn.markuplist[Us].textBoxConnected,{created:!0,modified:!1,deleted:!1,multi:Gs}):$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs})),d&&(Vs=!0,d=!1)}}},this.drawArrow=function(e){if(s.bUsemouseinput&&(i.x=s.x0,i.y=s.y0,s.bfirstpointset=!0),h){if(0!=hn.getCurrentpage().getpageRotation())var t=Mn(c);else t=c;s.bUsemouseinput&&(i.w=t.x,i.h=t.y,s.bfirstpointset=!0),o=t.x,l=t.y}else s.bUsemouseinput&&(i.w=e.x,i.h=e.y,s.bfirstpointset=!0),o=e.x,l=e.y},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);i&&(a=i.getPadding(a));var o=fo(a);0==e.button?s.started?s.completeArrow(o,a):s.startArrow(o,a):(r=a.x,n=a.y)},this.touchstart=function(e){e.preventDefault();var a=qp(t,e,0);i&&(a=i.getPadding(a));var r=fo(a);if(s.started=!0,hn&&(hn.bMarkupchanged=!0),!r)return s.started=!1,void(hn&&(hn.bMarkupchanged=!1));s.x0=a.x,s.y0=a.y,(i=10==p?new cl(4,1,Lr):new cl(6,p,0)).scaling=lo(),i.loadscaling=lo();var n=ro();i.xoffset=n.x,i.yoffset=n.y,i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var d=Zp(t,e);s.curmousepos=d;var p=r-d.x,u=n-d.y;if((c=hn.getCurrentpage().getsnap(d)).found&&null!=c?(h=!0,Qp(a,c)):(h=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(hn.getCurrentpage().pan_update(p,u),s.setdimoffset(!1),r=d.x,n=d.y),s.started){i&&(d=i.getPadding(d));var g=fo(d),f={x:s.x0,y:s.y0};if(4==i.type&&1==i.subtype)var m=po(f,d);else m=!0;if(g&&m){if(a.clearRect(0,0,t.width,t.height),i.x=s.x0,i.y=s.y0,h){if(0!=hn.getCurrentpage().getpageRotation())var y=Mn(c);else y=c;s.bUsemouseinput&&(i.w=y.x,i.h=y.y),o=y.x,l=y.y,Qp(a,c)}else s.bUsemouseinput&&(i.w=d.x,i.h=d.y),o=d.x,l=d.y;s.setdimoffset(!1),i.drawme(a)}else a.clearRect(0,0,t.width,t.height),i.x=s.x0,i.y=s.y0,s.bUsemouseinput&&(i.w=o,i.h=l),s.setdimoffset(!1),i.drawme(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var d=Zp(t,e);s.curmousepos=d;var p=r-d.x,u=n-d.y;if((c=hn.getCurrentpage().getsnap(d)).found&&null!=c?(h=!0,Qp(a,c)):(h=!1,a.clearRect(0,0,t.width,t.height)),2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(p,u),s.setdimoffset(!1),r=d.x,n=d.y),s.started){i&&(d=i.getPadding(d));var g=fo(d),f={x:s.x0,y:s.y0};if(4==i.type&&1==i.subtype)var m=po(f,d);else m=!0;g&&m?(a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&(i.x=s.x0,i.y=s.y0),s.drawArrow(d),s.setdimoffset(!1),h&&Qp(a,c),i.drawme(a)):(a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&(i.x=s.x0,i.y=s.y0),s.bUsemouseinput&&(i.w=o,i.h=l),s.setdimoffset(!1),i.drawme(a))}},this.touchmove=function(e){if(e.preventDefault(),s.started){var o=qp(t,e,0);i&&(o=i.getPadding(o)),fo(o)?(i.x=s.x0,i.y=s.y0,s.bUsemouseinput&&(i.w=o.x,i.h=o.y),s.bfirstpointset=!0,r=o.x,n=o.y):(i.x=s.x0,i.y=s.y0,s.bUsemouseinput&&(i.w=r,i.h=n),s.bfirstpointset=!0),a.clearRect(0,0,t.width,t.height),i.drawme(a)}},this.MSPointerUp=function(e){e.preventDefault()},this.mouseup=function(e){e.preventDefault()},this.touchcancel=function(e){if(e.preventDefault(),s.started){if(Gs||(Ms=!0),Us=hn.markuplist.length,6==p){i.h,Pn.height;var t=i.getdrawBox()}i.savemetolistDraw(),Dh(),s.touchmove(e),s.started=!1,i=null,s.bfirstpointset=!1,6==p&&Rp(t.x,t.y,t.w,t.h,hn.markuplist[Us]),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}},this.touchend=function(e){if(e.preventDefault(),s.started){if(Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),Dh(),s.bfirstpointset=!1,s.touchmove(e),6==p){i.h,Pn.height;var t=i.getdrawBox()}s.started=!1,i=null,6==p&&Rp(t.x,t.y,t.w,t.h,hn.markuplist[Us]),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}}},mn.Polycurve=function(e){var i=this,s=0,r=0;this.started=!1,this.name="Polycurve",this.anglelengthsupport=!1,this.refreshSupport=!1,this.terminated=!1,this.LastTouchdata=-1,hn.markuplist.length;var n,o=e.p1;Vp("crosshair"),this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var s=Zp(t,e);if(!fo(s))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));if(i.started)n.addpoint(s.x,s.y);else{(n=new cl(2,o,0)).pagenumber=hn.getcurPage(),n.scaling=lo();var r=ro();n.xoffset=r.x,n.yoffset=r.y,n.x=s.x,n.y=s.y,n.seteditaction(0),n.addpoint(s.x,s.y),i.started=!0,hn&&(hn.bMarkupchanged=!0),n.startdraw(a),n.addpoint(s.x,s.y)}},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var s=Zp(t,e);if(!fo(s))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));if(i.started)n.addpoint(s.x,s.y);else{(n=new cl(2,o,0)).pagenumber=hn.getcurPage(),n.scaling=lo();var r=ro();n.xoffset=r.x,n.yoffset=r.y,n.x=s.x,n.y=s.y,n.seteditaction(0),n.addpoint(s.x,s.y),i.started=!0,hn&&(hn.bMarkupchanged=!0),n.startdraw(a),n.addpoint(s.x,s.y)}},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var o=Zp(t,e),l=fo(o);i.started&&(l?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),s=o.x,r=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(s,r),n.drawme(a)))},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var o=Zp(t,e);i.started&&(fo(o)?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),s=o.x,r=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(s,r),n.drawme(a)))},this.mouseup=function(e){},this.dblclick=function(e){i.started&&(i.mousemove(e),i.started=!1,n.points.splice(n.numpoints-1,2),n.findrectangle(),n.savemetolistDraw(),n=null,Dh())},this.doubletap=function(e){i.started&&(i.started=!1,n.points.splice(n.points.length-1,1),n.findrectangle(),n.savemetolistDraw(),n=null,Dh())},this.touchstart=function(e){e.preventDefault();var s=qp(t,e,0),r=s.x,l=s.y,c=(new Date).getTime(),h=c-(-1==i.LastTouchdata?c+1:i.LastTouchdata);if(i.LastTouchdata=c,h<500&&h>0)i.doubletap(e);else{if(!fo(s))return i.started=!1,void(hn&&(hn.bMarkupchanged=!1));if(i.started)n.addpoint(r,l);else{(n=new cl(2,o,0)).pagenumber=hn.getcurPage(),n.scaling=lo();var d=ro();n.xoffset=d.x,n.yoffset=d.y,n.x=r,n.y=l,n.seteditaction(0),n.addpoint(r,l),n.startdraw(a),n.addpoint(r,l),i.started=!0,hn&&(hn.bMarkupchanged=!0)}}},this.touchmove=function(e){e.preventDefault();var o=qp(t,e,0);o.x,o.y,i.started&&(fo(o)?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),s=o.x,r=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(s,r),n.drawme(a)))},this.touchcancel=function(e){e.preventDefault();var a=qp(t,e,0),s=a.x,r=a.y;i.started&&fo(a)&&n.addpoint(s,r)},this.touchend=function(e){e.preventDefault();var a=qp(t,e,0),s=a.x,r=a.y;i.started&&fo(a)&&n.addpoint(s,r)}},mn.area=function(e){var i,s,r=this,o=0,l=0,c=0,h=0,d=!1,p=(hn.markuplist.length,e.p1),u=e.p2;this.name="area",this.subtype=e.p2,this.markupobject=e.p3,this.anglelengthsupport=!0,this.refreshSupport=!0,this.multipoint=!0,this.bUsemouseinput=!0,this.started=!1,this.terminated=!1,this.LastTouchdata=-1,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0},this.scaleoffset=void 0,Vp(Bp("area")),this.getdimoffset=function(){var e={scale:void 0,xoffset:void 0,yoffset:void 0};e.scale=lo();var t=ro();return e.xoffset=t.x,e.yoffset=t.y,e},this.refreshDraw=function(e){r.started&&(r.setdimoffset(!1),r.bUsemouseinput&&(e?s.setlastpoint(e.x,e.y):s.setlastpoint(r.curmousepos.x,r.curmousepos.y)),s.getnumpoints()>0&&s.drawme(a))},this.refreshMouseUp=function(e){r.started&&(r.setdimoffset(!1),r.bUsemouseinput&&(e?s.setlastpoint(e.x,e.y):s.setlastpoint(r.curmousepos.x,r.curmousepos.y)),s.getnumpoints()>0&&s.drawme(a))},this.setAngleLength=function(e,i,n,o){this.bUsemouseinput=!1;var l=s.points.length>=2;if(null!=s&&l){var c=s.points[s.points.length-1].x,h=s.points[s.points.length-1].y,d=s.setAnglelengthPoints(i,e,o);a.clearRect(0,0,t.width,t.height),fo({x:d.w,y:d.h})?(s.setlastpoint(d.w,d.h),n&&s.addpoint(d.w,d.h),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a)):(s.setlastpoint(c,h),this.bUsemouseinput=!0,s.getnumpoints()>0&&s.drawme(a),s.bUsemouseinput=!0,null!=qa&&qa.onDrawError("outside"))}},this.useMouseInput=function(){r.bUsemouseinput=!0},this.removelastPoint=function(){null!=s&&(a.clearRect(0,0,t.width,t.height),s.getnumpoints()>0&&s.drawme(a),s.points.splice(s.points.length-1,1),s.setlastpoint(r.curmousepos.x,r.curmousepos.y),a.clearRect(0,0,t.width,t.height),s.getnumpoints()>0&&s.drawme(a))},this.newsegment=function(){s.addline()},this.apply=function(){1==s.type&&6==s.subtype?r.applySegment():(a.clearRect(0,0,t.width,t.height),r.started&&(r.started=!1,r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a),s.points.splice(s.points.length-1,1),s.findrectangle(),s.resetcupoint(),Gs||(Ms=!0),Us=hn.markuplist.length,s.savemetolistDraw(),s=null,Vl(n),Dh(),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})))},this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(hn.currentpage,hn.NumPages,hn.getCurrentpage().pan_update(0,-e),s.getnumpoints()>0&&s.drawme(a)):(op(1.1,r.curmousepos)?hn.getCurrentpage().ZoomOut(1.1,!1,!1,r.curmousepos):qd(),r.started&&(r.setdimoffset(!1),r.bUsemouseinput&&s.setlastpoint(r.curmousepos.x,r.curmousepos.y),s.getnumpoints()>0&&s.drawme(a))):hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e),s.getnumpoints()>0&&s.drawme(a)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,r.curmousepos),r.started&&(r.setdimoffset(!1),r.bUsemouseinput&&s.setlastpoint(r.curmousepos.x,r.curmousepos.y),s.getnumpoints()>0&&s.drawme(a))))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),i=ti-60,s=ai-60;a.w/e<i&&a.h/e<s&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,r.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),r.scrollhandling(t)},this.setdimoffset=function(e){e&&(r.scaleoffset=r.getdimoffset(),s.scaling=r.scaleoffset.scale,s.xoffset=r.scaleoffset.xoffset,s.yoffset=r.scaleoffset.yoffset,r.orgscale=r.scaleoffset.scale,r.orgdx=r.scaleoffset.xoffset,r.orgdy=r.scaleoffset.yoffset),r.scaleoffset=r.getdimoffset();hn.getCurrentpage().getdscale();hn.getCurrentpage().getdx(),hn.getCurrentpage().getdy(),s&&s.scaling},this.pointermove=function(e){r.MSPointerMove(e)},this.pointerdown=function(e){r.MSPointerDown(e)},this.pointerup=function(e){r.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(0==e.button){if(!fo(a))return;if(r.started)d?(n=0!=hn.getCurrentpage().getpageRotation()?Mn(i):i,r.bUsemouseinput&&s.addpoint(n.x,n.y)):r.bUsemouseinput&&s.addpoint(a.x,a.y);else if(s=new cl(p,u,Lr),1==u&&(s.linewidth=1,s.AddAttribute("Rx_Area","0"),s.AddAttribute("SpaceID","0")),s.pagenumber=hn.getcurPage(),s.viewname=hn.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=ai,s.pagewidth=ti),r.setdimoffset(!0),d){if(0!=hn.getCurrentpage().getpageRotation())var n=Mn(i);else n=i;s.x=n.x,s.y=n.y,s.seteditaction(0),s.addpoint(n.x,n.y),r.started=!0,hn&&(hn.bMarkupchanged=!0),s.addpoint(n.x,n.y)}else s.x=a.x,s.y=a.y,s.seteditaction(0),s.addpoint(a.x,a.y),r.started=!0,hn&&(hn.bMarkupchanged=!0),s.addpoint(a.x,a.y)}else o=a.x,l=a.y},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(2==r.subtype&&null!=r.markupobject){let e=!0;for(let t=0;t<r.markupobject.points.length;t++)if(r.markupobject.points[t],!1===r.markupobject.ispointwithinarea(a.x,a.y)){e=!1;break}if(!1===e)return}if(0==e.button){if(!fo(a))return;if(r.started){var n=1==s.type&&(4==s.subtype||5==s.subtype);d?(c=0!=hn.getCurrentpage().getpageRotation()?Mn(i):i,r.bUsemouseinput&&(n?s.points.length<3?s.addpoint(c.x,c.y):r.completeArea(0):s.addpoint(c.x,c.y))):r.bUsemouseinput&&(n?s.points.length<3?s.addpoint(a.x,a.y):r.completeArea(0):s.addpoint(a.x,a.y))}else if(s=new cl(p,u,Lr),8==p&&1==u&&(s.linewidth=1,s.AddAttribute("Rx_Area","0"),s.AddAttribute("SpaceID","0")),s.pagenumber=hn.getcurPage(),s.viewname=hn.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=ai,s.pagewidth=ti),r.setdimoffset(!0),d){if(0!=hn.getCurrentpage().getpageRotation())var c=Mn(i);else c=i;s.x=c.x,s.y=c.y,s.seteditaction(0),s.addpoint(c.x,c.y),r.started=!0,hn&&(hn.bMarkupchanged=!0),s.addpoint(c.x,c.y)}else s.x=a.x,s.y=a.y,s.seteditaction(0),s.addpoint(a.x,a.y),r.started=!0,hn&&(hn.bMarkupchanged=!0),s.addpoint(a.x,a.y)}else o=a.x,l=a.y},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.curmousepos=n;var p=o-n.x,u=l-n.y;(i=hn.getCurrentpage().getsnap(n)).found&&null!=i?(d=!0,r.started||Qp(a,i)):(d=!1,r.started||a.clearRect(0,0,t.width,t.height));var g=fo(n);if(2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(p,u),o=n.x,l=n.y,r.started&&r.setdimoffset(!1)),r.started)if(g){if(a.clearRect(0,0,t.width,t.height),d){if(0!=hn.getCurrentpage().getpageRotation())var f=Mn(i);else f=i;Qp(a,i),r.bUsemouseinput&&s.setlastpoint(f.x,f.y),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a),c=f.x,h=f.y}else r.bUsemouseinput&&s.setlastpoint(n.x,n.y),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a),c=n.x,h=n.y;2==e.button||e.buttons}else a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&s.setlastpoint(c,h),s.getnumpoints()>0&&s.drawme(a)},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.curmousepos=n;var c=o-n.x,h=l-n.y;(i=hn.getCurrentpage().getsnap(n)).found&&null!=i?(d=!0,r.started||(a.clearRect(0,0,t.width,t.height),Qp(a,i))):(d=!1,r.started||a.clearRect(0,0,t.width,t.height));var p=fo(n);if(2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(c,h),o=n.x,l=n.y,r.started&&r.setdimoffset(!1)),r.started){if(2==r.subtype&&null!=r.markupobject){let e=!0;for(let t=0;t<r.markupobject.points.length;t++)if(r.markupobject.points[t],!1===r.markupobject.ispointwithinarea(n.x,n.y)){e=!1;break}if(!1===e)return}if(p){if(a.clearRect(0,0,t.width,t.height),d){if(0!=hn.getCurrentpage().getpageRotation())var u=Mn(i);else u=i;Qp(a,i),r.bUsemouseinput&&s.setlastpoint(u.x,u.y),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a),o=u.x,l=u.y}else r.bUsemouseinput&&s.setlastpoint(n.x,n.y),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a),o=n.x,l=n.y;2==e.button||e.buttons}else a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&s.setlastpoint(o,l),r.setdimoffset(!1),s.getnumpoints()>0&&s.drawme(a)}},this.MSPointerUp=function(e){var a=Zp(t,e);r.refreshMouseUp(a)},this.mouseup=function(e){var a=Zp(t,e);r.refreshMouseUp(a)},this.completeSegment=function(e){null!=s&&(e>0&&s.points.splice(s.points.length-e,e),1==s.type&&6==s.subtype&&s.points.length<2||s.addline())},this.applySegment=function(){if(r.started&&null!=s&&1==s.type&&6==s.subtype){r.started=!1,s.findrectangle(),Gs||(Ms=!0,Us=hn.markuplist.length),s.savemetolistDraw();var e=s.saved;s=null,Dh(),Vl(n),e?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):(Ms=e,Us=-1,Gs||lp(!0))}},this.completeArea=function(e){if(null!=s){r.started=!1,e>0&&s.points.splice(s.points.length-e,e);var t=1==s.type&&2==s.subtype||8==s.type,a=1==s.type&&3==s.subtype||1==s.type&&1==s.subtype;if(t&&s.points.length<3)s=null;else if(a&&s.points.length<2)s=null;else{s.findrectangle(),Gs||(Ms=!0),Us=hn.markuplist.length,2==r.subtype&&null!=r.markupobject&&(s.parent=r.markupobject,r.markupobject.holes.push(s),s.isStartedHole=!1),s.savemetolistDraw();var i=s.saved;s=null,Dh(),Vl(n),zs&&i?null!=$t&&(2==r.subtype&&null!=r.markupobject?$t.setMarkupSelected(r.markupobject,{created:!0,modified:!1,deleted:!1,multi:Gs}):$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs})):!Gs&&i&&null!=$t&&(2==r.subtype&&null!=r.markupobject?$t.setMarkupSelected(r.markupobject,{created:!0,modified:!1,deleted:!1}):$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1}))}}},this.dblclick=function(e){var t=1==s.type&&(4==s.subtype||5==s.subtype),a=1==s.type&&6==s.subtype;t||r.bUsemouseinput&&r.started&&(a?r.completeSegment(2):r.completeArea(2))},this.doubletap=function(e){var t=1==s.type&&(4==s.subtype||5==s.subtype),a=1==s.type&&6==s.subtype;t||r.bUsemouseinput&&r.started&&(a?r.completeSegment(1):r.completeArea(1))},this.touchstart=function(e){e.preventDefault();var a=qp(t,e,0),i=a.x,n=a.y,o=(new Date).getTime(),l=o-(-1==r.LastTouchdata?o+1:r.LastTouchdata);if(r.LastTouchdata=o,l<500&&l>0)r.doubletap(e);else if(fo(a))if(r.started){var c=1==s.type&&(4==s.subtype||5==s.subtype);r.bUsemouseinput&&(c?s.points.length<3?s.addpoint(i,n):r.completeArea(0):s.addpoint(i,n))}else s=new cl(p,u,Lr),8==p&&1==u&&(s.linewidth=1,s.AddAttribute("Rx_Area","0"),s.AddAttribute("SpaceID","0")),s.pagenumber=hn.getcurPage(),s.viewname=hn.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=ai,s.pagewidth=ti),r.setdimoffset(!0),s.x=i,s.y=n,s.seteditaction(0),s.addpoint(i,n),s.addpoint(i,n),r.started=!0,hn&&(hn.bMarkupchanged=!0)},this.touchmove=function(e){e.preventDefault();var i=qp(t,e,0);i.x,i.y,r.started&&(fo(i)?(a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&s.setlastpoint(i.x,i.y),s.getnumpoints()>0&&s.drawme(a),o=i.x,l=i.y):(a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&s.setlastpoint(o,l),s.getnumpoints()>0&&s.drawme(a)))},this.touchcancel=function(e){e.preventDefault();var a=qp(t,e,0);r.refreshMouseUp(a);var i=(a=qp(t,e,0)).x,n=a.y;if(r.started){var o=1==s.type&&(4==s.subtype||5==s.subtype);r.bUsemouseinput&&(o?s.points.length<3?s.addpoint(i,n):r.completeArea(0):s.addpoint(i,n))}},this.touchend=function(e){e.preventDefault();var a=qp(t,e,0);r.refreshMouseUp(a);var i=(a=qp(t,e,0)).x,n=a.y;if(r.started){var o=1==s.type&&(4==s.subtype||5==s.subtype);r.bUsemouseinput&&(o?s.points.length<3?s.addpoint(i,n):r.completeArea(0):s.addpoint(i,n))}},this.keydown=function(e){if(!yd()&&null!=s&&null!=s){var t=1==s.type&&(4==s.subtype||5==s.subtype),a=1==s.type&&6==s.subtype;switch(Hr&&(hn.bMarkupLocked=Hr),e.keyCode){case 13:e.stopPropagation(),a?r.completeSegment(1):(r.started=!1,t||r.completeArea(1));break;case 8:r.removelastPoint()}}}},mn.measuretool=function(e){var i=this;this.name="measuretool",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.Area=0,this.totaldistance=0,this.LastTouchdata=-1;var s,r=!1,n=e.twoopoints;this.points=[],this.numpoints=-1,this.lines=[],this.numlines=-1,this.lengths=[],this.numlengths=-1,this.angles=[],this.numangles=-1,this.result={points:[],lines:[],lengths:[],angles:[],numpoints:-1,numlines:-1,numlengths:-1,numangles:-1,area:0,totaldistance:0},Vp(Bp("measuretool")),this.addToTable=function(){var e=hn.getCurrentpage().dscale*hn.getCurrentpage().dscale;hn.getCurrentpage().usevectorxml?e=hn.getCurrentpage().dscalevector*hn.getCurrentpage().dscalevector:hn.getCurrentpage().usepdfjs&&(e=hn.getCurrentpage().curpagescale*hn.getCurrentpage().dscalepdf*(hn.getCurrentpage().curpagescale*hn.getCurrentpage().dscalepdf)),i.result.area=i.PolygonArea(),i.result.area=qo(i.result.area/e),hn.getCurrentpage().usevectorxml?i.result.totaldistance=Qo(i.result.totaldistance/hn.getCurrentpage().dscalevector):hn.getCurrentpage().usepdfjs?i.result.totaldistance=Qo(i.result.totaldistance/(hn.getCurrentpage().curpagescale*hn.getCurrentpage().dscalepdf)):i.result.totaldistance=Qo(i.result.totaldistance/hn.getCurrentpage().dscale)},this.PolygonArea=function(){var e=0,t=0,a=i.result.points.length;for(e=0;e<a-1;e++)t+=i.result.points[e].x*i.result.points[e+1].y-i.result.points[e+1].x*i.result.points[e].y;return t+=i.result.points[a-1].x*i.result.points[0].y-i.result.points[0].x*i.result.points[a-1].y,Math.abs(t/2)},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.addpoint=function(e,s){i.result.points.push(new pn(e,s)),i.result.numpoints++,n&&2===i.result.numpoints&&null!=_t&&(i.started=!1,i.result.points.splice(2,1),i.result.totaldistance=0,i.calculatedistance(),i.addToTable(),_t.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height),Lp())},this.setlastpoint=function(e,t){i.result.points[i.result.points.length-1].x=e,i.result.points[i.result.points.length-1].y=t},this.startdraw=function(e){e.beginPath(),e.moveTo(i.result.points[i.result.points.length-1].x,i.result.points[i.result.points.length-1].y)},this.getangleofline=function(e,t,a,i,s){var r=0,n=0;return s?(r=Math.abs(a-e),n=Math.abs(i-t)):(r=a-e,n=i-t),Math.atan2(n,r)},this.findanglebetweenlines=function(){var e=0,t=0,a=0,s=0;for(e=0;e<i.result.lines.length;e++)e>0&&(i.result.lines[e-1].height<=0&&i.result.lines[e-1].width>=0||i.result.lines[e-1].width<=0&&i.result.lines[e-1].height>=0?t=i.result.lines[e-1].rewangle:(i.result.lines[e-1].width>=0&&i.result.lines[e-1].height>=0||i.result.lines[e-1].width<=0&&i.result.lines[e-1].height<=0)&&(t=i.result.lines[e-1].angle),i.result.lines[e].height<=0&&i.result.lines[e].width>=0||i.result.lines[e].width<=0&&i.result.lines[e].height>=0?a=i.result.lines[e].rewangle:(i.result.lines[e].width>=0&&i.result.lines[e].height>=0||i.result.lines[e].width<=0&&i.result.lines[e].height<=0)&&(a=i.result.lines[e].angle),s=Math.PI-Math.abs(t+a),i.result.angles.push(Math.abs(s)),i.result.numangles++)},this.calculatedistance=function(){var e,t=0,a=0,s=0,r=0,n=0,o=0,l=0,c=0;if(i.result.points.length>=2){for(a=i.result.points[0].x,s=i.result.points[0].y,t=1;t<i.result.points.length;t++)r=i.result.points[t].x,n=i.result.points[t].y,t!=i.result.points.length&&(o=Math.abs(r-a),l=Math.abs(n-s),0!=(c=i.getdiag(o,l))&&(i.result.lengths.push(c),i.result.numlengths++,e=new Dn(a,s,r,n),i.result.lines.push(e),i.result.numlines++,i.result.totaldistance=i.result.totaldistance+c)),a=r,s=n;i.result.points.length>=3&&(r=i.result.points[0].x,n=i.result.points[0].y,o=Math.abs(r-a),l=Math.abs(n-s),c=i.getdiag(o,l),e=new Dn(a,s,r,n),i.result.lines.push(e),i.result.numlines++,i.result.lengths.push(c),i.result.numlengths++,i.result.totaldistance=i.result.totaldistance+c)}},this.draw=function(e){var t=0,a=0,s=0,r=0,n=0,o=0,l=0,c=0,h=0,d=!1;for(e.strokeStyle="red",e.beginPath(),e.moveTo(i.result.points[0].x,i.result.points[0].y),t=1;t<i.result.points.length;t++)e.lineTo(i.result.points[t].x,i.result.points[t].y),t>1&&(r=i.result.points[t-1].x,n=i.result.points[t-1].y,o=i.result.points[t].x,l=i.result.points[t].y,a=i.getangleofline(r,n,o,l,!1),r=i.result.points[t-2].x,n=i.result.points[t-2].y,c=o=i.result.points[t-1].x,h=l=i.result.points[t-1].y,s=i.getangleofline(r,n,o,l,!1),s-=Math.PI,d=!0);e.strokeStyle="red",e.lineWidth=1,e.closePath(),e.stroke(),d&&(e.beginPath(),e.arc(c,h,50,a,s,!1),e.strokeStyle="blue",e.lineWidth=4,e.stroke())},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(i.started)r?(n=0!=hn.getCurrentpage().getpageRotation()?Mn(s):s,i.addpoint(n.x,n.y)):i.addpoint(a.x,a.y);else{if(r){if(0!=hn.getCurrentpage().getpageRotation())var n=Mn(s);else n=s;i.addpoint(n.x,n.y),i.addpoint(n.x,n.y)}else i.addpoint(a.x,a.y),i.addpoint(a.x,a.y);i.started=!0}},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e);if(i.started)r?(n=0!=hn.getCurrentpage().getpageRotation()?Mn(s):s,i.addpoint(n.x,n.y)):i.addpoint(a.x,a.y);else{if(r){if(0!=hn.getCurrentpage().getpageRotation())var n=Mn(s);else n=s;i.addpoint(n.x,n.y),i.addpoint(n.x,n.y)}else i.addpoint(a.x,a.y),i.addpoint(a.x,a.y);i.started=!0}},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);if((s=hn.getCurrentpage().getsnap(n)).found&&null!=s?(r=!0,Qp(a,s)):(r=!1,a.clearRect(0,0,t.width,t.height)),i.started){if(a.clearRect(0,0,t.width,t.height),r){if(0!=hn.getCurrentpage().getpageRotation())var o=Mn(s);else o=s;i.setlastpoint(o.x,o.y),Qp(a,s)}else i.setlastpoint(n.x,n.y);i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);if((s=hn.getCurrentpage().getsnap(n)).found&&null!=s?(r=!0,Qp(a,s)):(r=!1,a.clearRect(0,0,t.width,t.height)),i.started){if(a.clearRect(0,0,t.width,t.height),r){if(0!=hn.getCurrentpage().getpageRotation())var o=Mn(s);else o=s;i.setlastpoint(o.x,o.y),Qp(a,s)}else i.setlastpoint(n.x,n.y);i.draw(a)}},this.MSPointerUp=function(e){},this.mouseup=function(e){},this.dblclick=function(e){i.started&&(i.mousemove(e),i.started=!1,i.result.points.splice(i.result.numpoints-1,2),i.result.totaldistance=0,i.calculatedistance(),i.findanglebetweenlines(),i.addToTable(),null!=_t&&_t.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height))},this.doubletap=function(e){i.started&&(i.started=!1,i.result.points.splice(i.result.numpoints-1,1),i.result.totaldistance=0,i.calculatedistance(),i.findanglebetweenlines(),i.addToTable(),null!=_t&&_t.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height))},this.touchstart=function(e){e.preventDefault();var a=qp(t,e,0),s=(a.x,a.y,(new Date).getTime()),r=s-(-1==i.LastTouchdata?s+1:i.LastTouchdata);i.LastTouchdata=s,r<500&&r>0?i.doubletap(e):i.started?i.addpoint(a.x,a.y):(i.addpoint(a.x,a.y),i.addpoint(a.x,a.y),i.started=!0)},this.touchmove=function(e){e.preventDefault();var s=qp(t,e,0);i.started&&(a.clearRect(0,0,t.width,t.height),i.setlastpoint(s.x,s.y),i.draw(a))},this.touchcancel=function(e){e.preventDefault();var a=qp(t,e,0);a.x,a.y,i.started},this.touchend=function(e){e.preventDefault();var a=qp(t,e,0);a.x,a.y,i.started}},mn.measure=function(e){var i,s,r=this,o=0,l=0,c=0,h=0,d=!1,p=!1,u=e.p1,g=e.p2;this.started=!1,this.name="measure",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.bfirstpointset=!1,this.curmousepos={x:0,y:0,xus:0,yus:0},Vp(Bp("measure")),this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(hn.currentpage,hn.NumPages,hn.getCurrentpage().pan_update(0,-e)):(op(1.1,r.curmousepos)?(hn.getCurrentpage().ZoomOut(1.1,!1,!1,r.curmousepos),r.started&&r.setdimoffset(!1)):qd(),r.started&&(r.drawDimension({x:r.curmousepos.x,y:r.curmousepos.y}),null!=i&&(a.clearRect(0,0,t.width,t.height),i.drawme(a)))):hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!Ls?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,r.curmousepos),r.started&&(r.setdimoffset(!1),r.drawDimension({x:r.curmousepos.x,y:r.curmousepos.y}),null!=i&&i.drawme(a))))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),i=ti-60,s=ai-60;a.w/e<i&&a.h/e<s&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,r.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),r.scrollhandling(t)},this.setdimoffset=function(e){if(e){i.scaling=lo(),i.loadscaling=lo();var t=ro();i.xoffset=t.x,i.yoffset=t.y,r.orgscale=i.scaling,r.orgdx=i.xoffset,r.orgdy=i.yoffset}var a=hn.getCurrentpage().getdscale();hn.getCurrentpage().getdx(),hn.getCurrentpage().getdy();if(i){i.scaling;i.w,i.xoffset,i.h,i.yoffset}},this.pointermove=function(e){r.MSPointerMove(e)},this.pointerdown=function(e){r.MSPointerDown(e)},this.pointerup=function(e){r.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e),c=fo(n);if(0==e.button)if(r.started)c&&(d?(h=0!=hn.getCurrentpage().getpageRotation()?Mn(s):s,i.w=h.x,i.h=h.y):(i.w=n.x,i.h=n.y),a.clearRect(0,0,t.width,t.height),r.setdimoffset(!1),i.drawme(a),Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),i=null,r.started=!1,Dh(),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1}));else{if(r.started=!0,hn&&(hn.bMarkupchanged=!0),!c)return r.started=!1,void(hn&&(hn.bMarkupchanged=!1));if(d){if(0!=hn.getCurrentpage().getpageRotation())var h=Mn(s);else h=s;r.x0=h.x,r.y0=h.y}else r.x0=n.x,r.y0=n.y;(i=new cl(7,g,0)).pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.pagerotation=hn.getCurrentpage().getpageRotation(),r.setdimoffset(!0),r.startx=r.x0,r.starty=r.y0,i.seteditaction(0)}else o=n.x,l=n.y},this.startDimension=function(e,t){if(e){if(r.started=!0,hn&&(hn.bMarkupchanged=!0),d){if(0!=hn.getCurrentpage().getpageRotation())var a=Mn(s);else a=s;r.x0=a.x,r.y0=a.y}else r.x0=t.x,r.y0=t.y;(i=new cl(7,g,0)).pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.pagerotation=hn.getCurrentpage().getpageRotation(),r.setdimoffset(!0),r.startx=r.x0,r.starty=r.y0,i.seteditaction(0)}},this.completeDimension=function(e,n){if(Vs&&(Vs=!1,p=!0),e){if(r.started=!1,d){if(0!=hn.getCurrentpage().getpageRotation())var o=Mn(s);else o=s;i.w=o.x,i.h=o.y}else hn.getCurrentpage().getpageRotation(),i.w=n.x,i.h=n.y;if(a.clearRect(0,0,t.width,t.height),r.setdimoffset(!1),i.drawme(a),Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),p){var l=i.calculateOrthoDraw({x:i.x,y:i.y},{x:i.w,y:i.h});i.w=l.w,i.h=l.h}i=null,Dh(),jd(),zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1}),p&&(Vs=!0,p=!1)}},this.drawDimension=function(e){if(d){if(0!=hn.getCurrentpage().getpageRotation())var t=Mn(s);else t=s;i.x=r.x0,i.y=r.y0,i.w=t.x,i.h=t.y,3==u&&(i.w=i.w-i.x,i.h=i.h-i.y),r.bfirstpointset=!0,c=t.x,h=t.y}else i.x=r.x0,i.y=r.y0,i.w=e.x,i.h=e.y,3==u&&(i.w=i.w-i.x,i.h=i.h-i.y),r.bfirstpointset=!0,c=e.x,h=e.y},this.startRect=function(e,t){if(e){if(r.started=!0,hn&&(hn.bMarkupchanged=!0),d){if(0!=hn.getCurrentpage().getpageRotation())var a=Mn(s);else a=s;r.x0=a.x,r.y0=a.y}else r.x0=t.x,r.y0=t.y;i=new cl(u,g,Lr),r.setdimoffset(!0),i.pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.seteditaction(0)}},this.drawRect=function(e){if(d){if(0!=hn.getCurrentpage().getpageRotation())var t=Mn(s);else t=s;i.x=Math.min(t.x,r.x0),i.y=Math.min(t.y,r.y0),i.w=Math.abs(t.x-i.x),i.h=Math.abs(t.y-i.y),r.bfirstpointset=!0,c=t.x,h=t.y}else i.x=Math.min(e.x,r.x0),i.y=Math.min(e.y,r.y0),i.w=Math.abs(e.x-i.x),i.h=Math.abs(e.y-i.y),r.bfirstpointset=!0,c=e.x,h=e.y},this.endRect=function(e){if(e)if(r.started=!1,Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),i=null,r.bfirstpointset=!1,Dh(),Vl(n),zs){if(null!=$t){var t={created:!0,modified:!1,deleted:!1,multi:Gs};$t.setMarkupSelected(hn.markuplist[Us],t)}}else Gs||null==$t||(t={created:!0,modified:!1,deleted:!1},$t.setMarkupSelected(hn.markuplist[Us],t))},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=Zp(t,e),i=fo(a);0==e.button?r.started?r.bfirstpointset&&(3==u?r.endRect(i):r.completeDimension(i,a)):3==u?r.startRect(i,a):r.startDimension(i,a):(o=a.x,l=a.y)},this.touchstart=function(e){r.started=!0,hn&&(hn.bMarkupchanged=!0);var a=qp(t,e,0);if(!fo(a))return r.started=!1,void(hn&&(hn.bMarkupchanged=!1));r.x0=a.x,r.y0=a.y,(i=new cl(7,0,0)).pagenumber=hn.getcurPage(),i.viewname=hn.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=ai,i.pagewidth=ti),i.pagerotation=hn.getCurrentpage().getpageRotation(),r.setdimoffset(!0),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.curmousepos=n;var p=o-n.x,u=l-n.y;if((s=hn.getCurrentpage().getsnap(n)).found&&null!=s?(d=!0,Qp(a,s)):(d=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(hn.getCurrentpage().pan_update(p,u),r.setdimoffset(!1),o=n.x,l=n.y),r.started){if(fo(n))if(d){if(0!=hn.getCurrentpage().getpageRotation())var g=Mn(s);else g=s;i.x=r.x0,i.y=r.y0,i.w=g.x,i.h=g.y,c=g.x,h=g.y}else i.x=r.x0,i.y=r.y0,i.w=n.x,i.h=n.y,c=n.x,h=n.y;else i.x=r.x0,i.y=r.y0,i.w=c,i.h=h;a.clearRect(0,0,t.width,t.height),d&&Qp(a,s),i.w-i.x!=0&&(r.setdimoffset(!1),i.drawme(a))}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=Zp(t,e);r.curmousepos=n;var p=o-n.x,u=l-n.y;(s=hn.getCurrentpage().getsnap(n)).found&&null!=s?(d=!0,a.clearRect(0,0,t.width,t.height),Qp(a,s)):(a.clearRect(0,0,t.width,t.height),d=!1),2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(p,u),r.setdimoffset(!1),o=n.x,l=n.y),r.started&&(fo(n)?r.drawDimension(n):(i.x=r.x0,i.y=r.y0,i.w=c,i.h=h),a.clearRect(0,0,t.width,t.height),d&&Qp(a,s),i.w-i.x!=0&&(r.setdimoffset(!1),i.drawme(a)))},this.touchmove=function(e){if(e.preventDefault(),r.started){var s=qp(t,e,0);fo(s)?(i.x=r.x0,i.y=r.y0,i.w=s.x,i.h=s.y,r.bfirstpointset=!0,o=s.x,l=s.y):(i.x=r.x0,i.y=r.y0,i.w=o,i.h=l,r.bfirstpointset=!0),a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.drawme(a)}},this.MSPointerUp=function(e){},this.mouseup=function(e){},this.touchcancel=function(e){e.preventDefault(),r.started&&(r.started=!1,r.bfirstpointset=!1,Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),Dh(),i=null,zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1}))},this.touchend=function(e){e.preventDefault(),r.started&&(r.started=!1,r.bfirstpointset=!1,Gs||(Ms=!0),Us=hn.markuplist.length,i.savemetolistDraw(),Dh(),i=null,zs?null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1,multi:Gs}):Gs||null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1}))}},mn.getoverlayscale=function(e){var i=this,s=e.p1,r=e.p2;this.started=!1,this.points=[],this.pageobject=s,this.pageindex=r,this.name="getoverlayscale",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0};var n=document.createElement("canvas");n.width=30,n.height=30;var o=n.getContext("2d");o.strokeStyle="gray",o.lineWidth=1,o.strokeRect(0,0,30,30),o.beginPath(),o.moveTo(15,0),o.lineTo(15,14),o.moveTo(15,30),o.lineTo(15,16),o.moveTo(0,15),o.lineTo(14,15),o.moveTo(30,15),o.lineTo(16,15),o.closePath(),o.stroke();var l,c=0,h=0,d=!1;this.dialogfieldtext="",this.keydown=function(e){if(!yd())switch(e.keyCode){case 27:i.resettool()}},this.resettool=function(){i.x=0,i.y=0,i.w=0,i.h=0,i.started=!1,a.clearRect(0,0,t.width,t.height)},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.getangleofline=function(e,t,a,i,s){var r=0,n=0;return s?(r=Math.abs(a-e),n=Math.abs(i-t)):(r=a-e,n=i-t),Math.atan2(n,r)},this.dialogtext=function(){hn.getCurrentpage().scaleObject.Unitlabel;var e=i.w-i.x,t=i.h-i.y,a=(i.x+i.w)/2,s=(i.y+i.h)/2;a-=i.pageobject.getdx(),s-=i.pageobject.getdy();var r=i.getdiag(e,t),n=i.getangleofline(i.x,i.y,i.w,i.h,!1),o=0,l=i.x-i.pageobject.getdx(),c=i.y-i.pageobject.getdy(),h=i.pageobject.getpagedim(),d=h.scale;if(i.distance=r,i.pageobject.usevectorxml&&i.pageobject.VectorPageObj){var p=d*i.pageobject.VectorPageObj.width;i.pageobject.VectorPageObj.width,i.pageobject.VectorPageObj.height,l/=i.pageobject.dscalevector,c/=i.pageobject.dscalevector,a/=i.pageobject.dscalevector,s/=i.pageobject.dscalevector,o=i.distance/i.pageobject.dscalevector}else if(i.pageobject.usepdfjs){i.pageindex,p=i.pageobject.offscreenwidth;var u=i.pageobject.offscreenwidth*i.pageobject.dscalepdf;p=u;var g=u/i.pageobject.pdfpagewidth;i.pageobject.pdfpagewidth,i.pageobject.pdfpageheight,l/=g,c/=g,a/=g,s/=g,o=i.distance/g}else p=d*i.pageobject.MainImageWidth,i.pageobject.MainImageWidth,i.pageobject.MainImageHeight,l/=i.pageobject.dscale,c/=i.pageobject.dscale,a/=i.pageobject.dscale,s/=i.pageobject.dscale,o=i.distance/i.pageobject.dscale;var f={scaledDistance:o,pagedim:h,linecenter:{x:a,y:s}};null!=Xa&&Xa.AlignMeasure(i.distance,n,{x:l,y:c},p,f)},this.drawCross=function(e,a){e.clearRect(0,0,t.width,t.height),e.strokeStyle="gray",e.lineWidth=1,e.beginPath(),e.moveTo(0,a.y),e.lineTo(a.x-1,a.y),e.moveTo(a.x+1,a.y),e.lineTo(t.width,a.y),e.moveTo(a.x,0),e.lineTo(a.x,a.y-1),e.moveTo(a.x,a.y+1),e.lineTo(a.x,t.height),e.closePath(),e.stroke()},this.draw=function(e){var t=er,a=22.5/(180/Math.PI),s=i.w-i.x,r=i.h-i.y;Math.atan2(r,s),Math.abs(t/Math.cos(a)),e.strokeStyle="blue",e.lineWidth=2,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.strokeRect(this.x-15,this.y-15,30,30),e.beginPath(),e.moveTo(this.x,this.y-15),e.lineTo(this.x,this.y-1),e.moveTo(this.x,this.y+15),e.lineTo(this.x,this.y+1),e.moveTo(this.x-15,this.y),e.lineTo(this.x-1,this.y),e.moveTo(this.x+15,this.y),e.lineTo(this.x+1,this.y),e.closePath(),e.stroke(),e.strokeRect(this.w-15,this.h-15,30,30),e.beginPath(),e.moveTo(this.w,this.h-15),e.lineTo(this.w,this.h-1),e.moveTo(this.w,this.h+15),e.lineTo(this.w,this.h+1),e.moveTo(this.w-15,this.h),e.lineTo(this.w-1,this.h),e.moveTo(this.w+15,this.h),e.lineTo(this.w+1,this.h),e.closePath(),e.stroke()},this.scrollhandling=function(e){if(gi&&!hn.getCurrentpage().usevector3Dxml)if(e<0)if(hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!hn.pagelocked)hn.currentpage,hn.NumPages,hn.getCurrentpage().pan_update(0,-e);else{hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos);var t=hn.getCurrentpage().getdscale(),a=hn.getCurrentpage().getdx(),s=hn.getCurrentpage().getdy();if(i.started){var r=t/i.orgscale,n=(i.startx-i.orgdx)*r,o=(i.starty-i.orgdy)*r;n+=a,o+=s,i.x=n,i.y=o}}else hn.getCurrentpage().usepdfjs&&hn.pages.length>1&&!hn.pagelocked?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos),t=hn.getCurrentpage().getdscale(),a=hn.getCurrentpage().getdx(),s=hn.getCurrentpage().getdy(),i.started&&(r=t/i.orgscale,n=(i.startx-i.orgdx)*r,o=(i.starty-i.orgdy)*r,n+=a,o+=s,i.x=n,i.y=o))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){var s=Zp(t,e);if(null!=hn&&null!=hn)if(0==e.button)if(i.started)d?(r=0!=hn.getCurrentpage().getpageRotation()?Mn(l):l,i.w=r.x,i.h=r.y):(i.w=s.x,i.h=s.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair",i.started=!0,d){if(0!=hn.getCurrentpage().getpageRotation())var r=Mn(l);else r=l;i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y}else i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y;i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else c=s.x,h=s.y},this.mousedown=function(e){var s=Zp(t,e);if(0==e.button)if(i.started)d?(r=0!=hn.getCurrentpage().getpageRotation()?Mn(l):l,i.w=r.x,i.h=r.y):(i.w=s.x,i.h=s.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+n.toDataURL()+")15 15, auto",i.started=!0,d){if(0!=hn.getCurrentpage().getpageRotation())var r=Mn(l);else r=l;i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y}else i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y;i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else c=s.x,h=s.y},this.touchstart=function(e){if(!i.started){var a=qp(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y,i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy()}},this.MSPointerMove=function(e){var s=Zp(t,e);i.curmousepos=s,e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var r=c-s.x,n=h-s.y;if((l=hn.getCurrentpage().getsnap(s)).found?(d=!0,Qp(a,l)):(d=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(hn.getCurrentpage().pan_update(r,n),c=s.x,h=s.y),i.started){if(d){if(0!=hn.getCurrentpage().getpageRotation())var o=Mn(l);else o=l;i.w=o.x,i.h=o.y}else i.w=s.x,i.h=s.y;a.clearRect(0,0,t.width,t.height),2==e.buttons&&(i.x-=r,i.y-=n),i.w-i.x!=0&&i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+n.toDataURL()+")15 15, auto";var s=Zp(t,e);i.curmousepos=s,i.drawCross(a,s);var r=c-s.x,o=h-s.y;if((l=hn.getCurrentpage().getsnap(s)).found?(d=!0,Qp(a,l)):d=!1,2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(r,o),c=s.x,h=s.y),i.started){if(d){if(0!=hn.getCurrentpage().getpageRotation())var p=Mn(l);else p=l;i.w=p.x,i.h=p.y}else i.w=s.x,i.h=s.y;a.clearRect(0,0,t.width,t.height),2!=e.button&&2!=e.buttons||(i.x-=r,i.y-=o),d&&Qp(a,l),i.w-i.x!=0&&i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var s=qp(t,e,0);i.w=s.x,i.h=s.y,a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))}},mn.calibrate=function(){var e,i=this,s=0,r=0,n=!1;this.started=!1,this.name="calibrate",this.anglelengthsupport=!1,this.refreshSupport=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0},this.dialogfieldtext="",Vp(Bp("calibrate")),this.scrollhandling=function(e){gi&&!hn.getCurrentpage().usevector3Dxml&&(e<0?hn.getCurrentpage().usepdfjs&&hn.pages.length>1?hn.getCurrentpage().pan_update(0,-e):(op(1.1,i.curmousepos)?hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos):qd(),i.started&&(i.setdimoffset(!1),i.draw(a))):hn.getCurrentpage().usepdfjs&&hn.pages.length>1?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos),i.started&&(i.setdimoffset(!1),i.draw(a))))},this.belowlimitExtent=function(e){var t=!0,a=hn.getCurrentpage().getpagedim(),s=ti-60,r=ai-60;a.w/e<s&&a.h/e<r&&(t=!1);var n=hn.getCurrentpage().ZoomOutTest(e,!1,i.curmousepos),o=ai-30,l=ti-30;return n.y,n.h,n.y,n.w/n.h<ti/ai?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ui||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.setdimoffset=function(e){e&&(i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y);var t=hn.getCurrentpage().getdscale(),a=hn.getCurrentpage().getdx(),s=hn.getCurrentpage().getdy(),r=t/i.orgscale;if(i.started){var n=(i.startx-i.orgdx)*r,o=(i.starty-i.orgdy)*r;n+=a,o+=s,i.x=n,i.y=o}},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.dialogtext=function(){hn.getCurrentpage().scaleObject.Unitlabel;var e=i.w-i.x,t=i.h-i.y,a=i.getdiag(e,t),s=Js;s=hn.getCurrentpage().scaleObject.getMeasureScale(),k&&(s=k.scaleObject.getMeasureScale()),Js=1,i.distance=$o(a/lo()),hn.getCurrentpage().scaleObject.setMeasureScaledirect(1),$s=$o(a/lo()),hn.getCurrentpage().scaleObject.setMeasureScaledirect(s),hn.getCurrentpage().scaleChanged(),Js=s},this.draw=function(e){var t=hn.getCurrentpage().getdscale()/hn.getCurrentpage().fixedScale,a=er*t,s=22.5/(180/Math.PI),r=i.w-i.x,n=i.h-i.y,o=Math.atan2(n,r),l=Math.abs(a/Math.cos(s)),c=Math.PI+o,h=c+s,d=c-s,p=this.w+Math.cos(h)*l,u=this.h+Math.sin(h)*l,g=this.w+Math.cos(d)*l,f=this.h+Math.sin(d)*l,m=o+s,y=o-s,v=this.x+Math.cos(m)*l,x=this.y+Math.sin(m)*l,b=this.x+Math.cos(y)*l,w=this.y+Math.sin(y)*l;"#000000"==hn.backgroundColor?e.strokeStyle="white":e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(v,x),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(b,w),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.w,this.h),e.lineTo(p,u),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.w,this.h),e.lineTo(g,f),e.closePath(),e.stroke()},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(o){var l=Zp(t,o);if(0==o.button)if(i.started)n?(c=0!=hn.getCurrentpage().getpageRotation()?Mn(e):e,i.w=c.x,i.h=c.y):(i.w=l.x,i.h=l.y),i.started=!1,i.dialogtext(),null!=Wt&&Wt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height);else{if(o.preventDefault(),o.stopPropagation(),i.started=!0,n){if(0!=hn.getCurrentpage().getpageRotation())var c=Mn(e);else c=e;i.x=c.x,i.y=c.y,i.w=c.x,i.h=c.y}else i.x=l.x,i.y=l.y,i.w=l.x,i.h=l.y;i.setdimoffset(!0)}else s=l.x,r=l.y},this.mousedown=function(o){var l=Zp(t,o);if(0==o.button)if(i.started)n?(c=0!=hn.getCurrentpage().getpageRotation()?Mn(e):e,i.w=c.x,i.h=c.y):(i.w=l.x,i.h=l.y),i.started=!1,i.dialogtext(),null!=Wt&&Wt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height);else{if(o.preventDefault(),o.stopPropagation(),i.started=!0,n){if(0!=hn.getCurrentpage().getpageRotation())var c=Mn(e);else c=e;i.x=c.x,i.y=c.y,i.w=c.x,i.h=c.y}else i.x=l.x,i.y=l.y,i.w=l.x,i.h=l.y;i.setdimoffset(!0)}else s=l.x,r=l.y},this.touchstart=function(e){if(!i.started){var a=qp(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y}},this.MSPointerMove=function(o){var l=Zp(t,o);o.preventDefault(),o.stopPropagation(),i.curmousepos=l;var c=s-l.x,h=r-l.y;if((e=hn.getCurrentpage().getsnap(l)).found&&null!=e?(n=!0,Qp(a,e)):(n=!1,a.clearRect(0,0,t.width,t.height)),2==o.buttons&&(hn.getCurrentpage().pan_update(c,h),s=l.x,r=l.y),i.started){if(n){if(0!=hn.getCurrentpage().getpageRotation())var d=Mn(e);else d=e;i.w=d.x,i.h=d.y}else i.w=l.x,i.h=l.y;a.clearRect(0,0,t.width,t.height),2==o.buttons&&(i.x-=c,i.y-=h),i.setdimoffset(!1),Qp(a,e),i.draw(a)}},this.mousemove=function(o){o.preventDefault(),o.stopPropagation();var l=Zp(t,o);i.curmousepos=l;var c=s-l.x,h=r-l.y;if((e=hn.getCurrentpage().getsnap(l)).found&&null!=e?(n=!0,Qp(a,e)):(n=!1,a.clearRect(0,0,t.width,t.height)),2!=o.button&&2!=o.buttons||(hn.getCurrentpage().pan_update(c,h),s=l.x,r=l.y),i.started){if(n){if(0!=hn.getCurrentpage().getpageRotation())var d=Mn(e);else d=e;i.w=d.x,i.h=d.y}else i.w=l.x,i.h=l.y;a.clearRect(0,0,t.width,t.height),2!=o.button&&2!=o.buttons||(i.x-=c,i.y-=h),i.setdimoffset(!1),Qp(a,e),i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var s=qp(t,e,0);i.w=s.x,i.h=s.y,a.clearRect(0,0,t.width,t.height),i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),null!=Wt&&Wt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),null!=Wt&&Wt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height))}},mn.overlayscale=function(e){var i=this,s=e.p1;this.started=!1,this.points=[],this.compareref=s,this.name="overlayscale",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0};var r=document.createElement("canvas");r.width=30,r.height=30;var n=r.getContext("2d");n.strokeStyle="gray",n.lineWidth=1,n.strokeRect(0,0,30,30),n.beginPath(),n.moveTo(15,0),n.lineTo(15,14),n.moveTo(15,30),n.lineTo(15,16),n.moveTo(0,15),n.lineTo(14,15),n.moveTo(30,15),n.lineTo(16,15),n.closePath(),n.stroke();var o,l=0,c=0,h=!1;this.dialogfieldtext="",this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.dialogtext=function(){hn.getCurrentpage().scaleObject.Unitlabel;var e=i.w-i.x,t=i.h-i.y,a=i.getdiag(e,t),s=i.x-i.compareref.pages[i.compareref.scaleindex].getdx(),r=i.y-i.compareref.pages[i.compareref.scaleindex].getdy(),n=i.compareref.pages[i.compareref.scaleindex].getdscale();if(i.distance=a,i.compareref.pages[i.compareref.scaleindex].usevectorxml&&i.compareref.pages[i.compareref.scaleindex].VectorPageObj){var o=n*i.compareref.pages[i.compareref.scaleindex].VectorPageObj.width;s/=i.compareref.pages[i.compareref.scaleindex].dscalevector,r/=i.compareref.pages[i.compareref.scaleindex].dscalevector}else if(i.compareref.pages[i.compareref.scaleindex].usepdfjs){switch(i.compareref.scaleindex){case 0:var l=i.compareref.backgroundgpage.getPageScale();o=i.compareref.backgroundgpage.getwidth();break;case 1:l=i.compareref.overlaypage.getPageScale(),o=i.compareref.overlaypage.getwidth()}o=i.compareref.pages[i.compareref.scaleindex].offscreenwidth,s/=l=i.compareref.pages[i.compareref.scaleindex].offscreenwidth/i.compareref.pages[i.compareref.scaleindex].pdfpagewidth,r/=l}else o=n*i.compareref.pages[i.compareref.scaleindex].MainImageWidth,s/=i.compareref.pages[i.compareref.scaleindex].dscale,r/=i.compareref.pages[i.compareref.scaleindex].dscale;i.compareref.setdistance(i.distance,{x:s,y:r},o)},this.draw=function(e){e.strokeStyle="blue",e.lineWidth=2,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.strokeRect(this.x-15,this.y-15,30,30),e.beginPath(),e.moveTo(this.x,this.y-15),e.lineTo(this.x,this.y-1),e.moveTo(this.x,this.y+15),e.lineTo(this.x,this.y+1),e.moveTo(this.x-15,this.y),e.lineTo(this.x-1,this.y),e.moveTo(this.x+15,this.y),e.lineTo(this.x+1,this.y),e.closePath(),e.stroke(),e.strokeRect(this.w-15,this.h-15,30,30),e.beginPath(),e.moveTo(this.w,this.h-15),e.lineTo(this.w,this.h-1),e.moveTo(this.w,this.h+15),e.lineTo(this.w,this.h+1),e.moveTo(this.w-15,this.h),e.lineTo(this.w-1,this.h),e.moveTo(this.w+15,this.h),e.lineTo(this.w+1,this.h),e.closePath(),e.stroke()},this.scrollhandling=function(e){if(gi&&!hn.getCurrentpage().usevector3Dxml)if(e<0)if(hn.getCurrentpage().usepdfjs&&hn.pages.length>1)hn.currentpage,hn.NumPages,hn.getCurrentpage().pan_update(0,-e);else{hn.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos);var t=hn.getCurrentpage().getdscale(),a=hn.getCurrentpage().getdx(),s=hn.getCurrentpage().getdy();if(i.started){var r=t/i.orgscale,n=(i.startx-i.orgdx)*r,o=(i.starty-i.orgdy)*r;n+=a,o+=s,i.x=n,i.y=o}}else hn.getCurrentpage().usepdfjs&&hn.pages.length>1?(hn.currentpage,hn.getCurrentpage().pan_update(0,-e)):(hn.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos),t=hn.getCurrentpage().getdscale(),a=hn.getCurrentpage().getdx(),s=hn.getCurrentpage().getdy(),i.started&&(r=t/i.orgscale,n=(i.startx-i.orgdx)*r,o=(i.starty-i.orgdy)*r,n+=a,o+=s,i.x=n,i.y=o))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){var s=Zp(t,e);if(0==e.button)if(i.started)h?(r=0!=hn.getCurrentpage().getpageRotation()?Mn(o):o,i.w=r.x,i.h=r.y):(i.w=s.x,i.h=s.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair",i.started=!0,h){if(0!=hn.getCurrentpage().getpageRotation())var r=Mn(o);else r=o;i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y}else i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y;i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else l=s.x,c=s.y},this.mousedown=function(e){var s=Zp(t,e);if(0==e.button)if(i.started)h?(n=0!=hn.getCurrentpage().getpageRotation()?Mn(o):o,i.w=n.x,i.h=n.y):(i.w=s.x,i.h=s.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+r.toDataURL()+")15 15, auto",i.started=!0,h){if(0!=hn.getCurrentpage().getpageRotation())var n=Mn(o);else n=o;i.x=n.x,i.y=n.y,i.w=n.x,i.h=n.y}else i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y;i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else l=s.x,c=s.y},this.touchstart=function(e){if(!i.started){var a=qp(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y,i.orgscale=hn.getCurrentpage().getdscale(),i.orgdx=hn.getCurrentpage().getdx(),i.orgdy=hn.getCurrentpage().getdy()}},this.MSPointerMove=function(e){var s=Zp(t,e);e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var r=l-s.x,n=c-s.y;if((o=hn.getCurrentpage().getsnap(s)).found?(h=!0,Qp(a,o)):(h=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(hn.getCurrentpage().pan_update(r,n),l=s.x,c=s.y),i.started){if(h){if(0!=hn.getCurrentpage().getpageRotation())var d=Mn(o);else d=o;i.w=d.x,i.h=d.y}else i.w=s.x,i.h=s.y;a.clearRect(0,0,t.width,t.height),2==e.buttons&&(i.x-=r,i.y-=n),i.w-i.x!=0&&i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+r.toDataURL()+")15 15, auto";var s=Zp(t,e),n=l-s.x,d=c-s.y;if((o=hn.getCurrentpage().getsnap(s)).found?(h=!0,Qp(a,o)):(h=!1,a.clearRect(0,0,t.width,t.height)),2!=e.button&&2!=e.buttons||(hn.getCurrentpage().pan_update(n,d),l=s.x,c=s.y),i.started){if(h){if(0!=hn.getCurrentpage().getpageRotation())var p=Mn(o);else p=o;i.w=p.x,i.h=p.y}else i.w=s.x,i.h=s.y;a.clearRect(0,0,t.width,t.height),2!=e.button&&2!=e.buttons||(i.x-=n,i.y-=d),i.w-i.x!=0&&i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var s=qp(t,e,0);i.w=s.x,i.h=s.y,a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))}},function(){(e=null!=u?document.getElementById(u):document.getElementById("rxcontainer")).className=null!=g?g:"rxcontainer";const p=Hl();if((navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i))&&(Cs=!0,ws=16777216),i=document.createElement("canvas"),null!=u?(i.id=u+"rxcanvas",i.className="rxcanvas"):i.id="rxcanvas",i)if(i.innerHTML="<p>Unfortunately, your browser is currently unsupported by our web \n",i.innerHTML+="application.  We are sorry for the inconvenience. Please use one of the\n",i.innerHTML+="supported browsers listed below, or draw the image you want using an\n",i.innerHTML+="offline tool.</p>\n",i.innerHTML+="<p>Supported browsers: <a href='http://www.opera.com'>Opera</a>,\n",i.innerHTML+="<a href='http://www.mozilla.com'>Firefox</a>,\n",i.innerHTML+="<a href='http://www.apple.com/safari'>Safari</a>, and\n",i.innerHTML+="<a href='https://www.google.com/chrome'>Chrome</a>.</p>",cu(),e.appendChild(i),i.getContext)if(i.oncontextmenu=function(){return!1},s=i.getContext("2d")){s.scale(p,p),nu(!1);var f=i.parentNode;if(function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?((d=new THREE.WebGLRenderer({alpha:!0,antialias:!0,precision:"highp",preserveDrawingBuffer:!0})).clippingPlanes=Re,d.localClippingEnabled=!1,null!=u?(d.domElement.id=u+"canv3D",d.domElement.className="canv3D"):d.domElement.id="canv3D",console.log("webgl enabled"),d.physicallyCorrectLights=!0):(console.log("webgl not available"),console.log("No 3D support")),f.appendChild(d.domElement),d.domElement.oncontextmenu=function(){return!1},d.setSize(ti,ai),d.setPixelRatio(p),d.domElement.style.visibility="hidden",r=document.createElement("canvas"))if(null!=u?(r.id=u+"imageDisp",r.className="imageDisp",r.style.zIndex="3"):(r.id="imageDisp",r.style.zIndex="3"),lu(r,ii,si),f.appendChild(r),r.oncontextmenu=function(){return!1},(n=r.getContext("2d")).scale(p,p),t=document.createElement("canvas"))if(null!=u?(t.id=u+"imageTemp",t.className="imageTemp",t.style.zIndex="3"):(t.id="imageTemp",t.style.zIndex="3"),lu(t,ii,si),f.appendChild(t),t.oncontextmenu=function(){return!1},(a=t.getContext("2d")).scale(p,p),o=document.createElement("canvas")){var m,y;null!=u?(o.id=u+"imagemag",o.className="imagemag"):o.id="imagemag",Se.width=Se.width/p,Se.height=Se.height/p,lu(o,Se.width,Se.height),f.appendChild(o),o.oncontextmenu=function(){return!1},(l=o.getContext("2d")).scale(p,p),l.fillStyle="white",l.fillRect(0,0,Se.width,Se.height),o.style.visibility="hidden",o.style.zIndex="3",(c=document.createElement("canvas"))||alert("Error: I cannot create a new canvas element!"),h=c.getContext("2d"),le||(m=te,(y=gn).addEventListener("load",Rh,!1),y.src=m,function e(){ui?function(){hi=gn.width,di=gn.height,hi=gn.naturalWidth,di=gn.naturalHeight;var e=ai/di,t=ti/hi,a=Math.min(t,e),i=(ti-hi*a)/2,s=(ai-di*a)/2;gi||(Ch(gn,i,s,a),hu(!0))}():window.setTimeout(e,500)}()),t.addEventListener("touchstart",tu,!1),d.domElement.addEventListener("touchstart",tu,!1),t.addEventListener("touchmove",tu,!0),d.domElement.addEventListener("touchmove",tu,!0),t.addEventListener("touchend",tu,!1),t.addEventListener("touchcancel",tu,!1),d.domElement.addEventListener("touchend",tu,!1),d.domElement.addEventListener("touchcancel",tu,!1),t.addEventListener("dbltap",tu,!1),t.addEventListener("dblclick",tu,!1),window.addEventListener("keydown",tu,!0),window.addEventListener("keyup",tu,!0),window.addEventListener("keypress",tu,!0),t.addEventListener("wheel",tu,!0),t.addEventListener("mousewheel",tu,!0),d.domElement.addEventListener("wheel",tu,!0),d.domElement.addEventListener("mousewheel",tu,!0),t.addEventListener("DOMMouseScroll",tu,!0),d.domElement.addEventListener("DOMMouseScroll",tu,!0),d.domElement.addEventListener("drop",tu,!1),d.domElement.addEventListener("dragover",tu,!1),t.addEventListener("drop",tu,!1),t.addEventListener("dragover",tu,!1),Hi?(t.addEventListener("mousemove",tu,!1),d.domElement.addEventListener("mousemove",tu,!1),t.addEventListener("mousedown",tu,!1),d.domElement.addEventListener("mousedown",tu,!1),t.addEventListener("mouseup",tu,!1),d.domElement.addEventListener("mouseup",tu,!1),t.addEventListener("mouseout",tu,!1),d.domElement.addEventListener("mouseout",tu,!1)):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerMove",tu,!1),d.domElement.addEventListener("MSPointerMove",tu,!1),t.addEventListener("MSPointerDown",tu,!1),d.domElement.addEventListener("MSPointerDown",tu,!1),t.addEventListener("MSPointerUp",tu,!1),d.domElement.addEventListener("MSPointerUp",tu,!1),t.addEventListener("MSPointerOut",tu,!1),d.domElement.addEventListener("MSPointerOut",tu,!1)):(t.addEventListener("mousemove",tu,!1),d.domElement.addEventListener("mousemove",tu,!1),t.addEventListener("mousedown",tu,!1),d.domElement.addEventListener("mousedown",tu,!1),t.addEventListener("mouseup",tu,!1),d.domElement.addEventListener("mouseup",tu,!1),t.addEventListener("mouseout",tu,!1),d.domElement.addEventListener("mouseout",tu,!1)),ie?(""!=(tn=location.search)&&(en=!0),ne&&function(){if(null==X)return!1;if(null==oe)return!1;var e=JSON.stringify(oe);return Eh("POST",X,e).then((function(e){iu(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)})),!0}()||lh(re)):(Po(),kr=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"],null!=Gt&&Gt.setMarkupStamps(kr),ye=!0),function(){if("undefined"!=typeof Storage)if(null!=localStorage.getItem("RxLic")){var e=localStorage.getItem("RxLic");localStorage.removeItem("RxLic"),uh(e,!0)}else ph()}()}else alert("Error: I cannot create a new canvas element!");else alert("Error: I cannot create a new canvas element!");else alert("Error: I cannot create a new canvas element!")}else alert("Error: failed to getContext!");else alert("Error: no canvas.getContext!");else alert("Error: I cannot find the canvas element!")}(),function e(){requestAnimationFrame(e),_s&&!mi&&zi&&hn.draw_mpagepdf(!1),Xs&&(10==++Ws&&pp(5,!1),20==Ws&&(pp(6,!1),Ws=0),!Hs)||yd()||gi&&hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj&&!fi&&(d.render(hn.getCurrentpage().Vector3DPageObj.scene,hn.getCurrentpage().camera),xi&&hn.getCurrentpage().Vector3DPageObj.renderMarkupPoints(n),hn.getCurrentpage().walkthroughcontrol.update&&"Walkthrough3D"==hn.curcontrol3D&&hn.getCurrentpage().walkthroughcontrol.update())}()};"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?f():document.addEventListener("DOMContentLoaded",f),window.addEventListener("resize",(function(){Pe.absolute||hu(!0)}),!1)}},initFoxit:su,insertPoint:function(){"markupedit"==cn.name&&cn.enablePointInsert()},instanceReset:function(){me=!1,ve=!1,document.getElementById("rxcanvas").remove(),document.getElementById("canv3D").remove(),document.getElementById("imageDisp").remove(),document.getElementById("imageTemp").remove(),document.getElementById("imagemag").remove()},keepvectorColor:function(e){Ai=e},limitZoomOut:function(e){Ui=e},loadIFCSpaces:function(){if(yd())return-1;hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().loadGLTFSpaces()},loadThumbnails:function(){if(!yd()){for(var e=0;e<hn.thumbnails.length;e++)hn.thumbnails[e].thumbnailobj.source=hn.thumbnails[e].ThumbnailImageSRC,hn.thumbnails[e].thumbloaded=!0,hn.thumbnails[e].thumbload();null!=ht&&ht.setThumbnails(hn.thumbnails)}},loadThumbnail:function(e){yd()||hn.loadThumbnail(e)},loadThumbnailPDF:function(e){yd()||hn.loadThumbnailPDF(e)},lockMarkupbyGUID:function(e,t){if(!yd())for(var a=0;a<yn.length;a++)yn[a].lockMarkupbyGUID(e,t)},lockMarkup:function(e){yd()||(hn.bMarkupLocked=e)},loadMarkupJSON:function(e,t,a){if(!yd()&&null!=I){null==a&&(a=hn);var i=[{Command:"GetMarkup",LicenseID:os,FileName:t,Folder:e}],s=JSON.stringify(i);Eh("POST",I,s).then((function(e){cp(e,a)})).catch((function(e){e.status?404==e.status?console.log("Get Markup failed, error 404"):503==e.status?console.log("Get Markup failed, error 503"):console.log(e.status):console.log(e)}))}},magnifyGlass:function(e){yd()||hn.getCurrentpage().usevector3Dxml||(Dl(),bl(),e?(o.addEventListener("mousemove",tu,!1),o.addEventListener("mousedown",tu,!1),o.addEventListener("mouseup",tu,!1),o.addEventListener("mouseout",tu,!1),o.addEventListener("wheel",tu,!1),eu("magnify",{})):(o.style.visibility="hidden",o.removeEventListener("mousemove",tu,!1),o.removeEventListener("mousedown",tu,!1),o.removeEventListener("mouseup",tu,!1),o.removeEventListener("mouseout",tu,!1),o.removeEventListener("wheel",tu,!1),eu("markupedit",{p1:!1})))},movetoBack:function(){yd()||Hr||mi||function(){for(var e=null,t=hn.markupdraworder.length;t>0;t--){var i=hn.markupdraworder[t-1];if(hn.markuplist[i].selected||hn.markuplist[i].selectedit){var s=i;e=t-1;break}}null!=e&&(hn.markupdraworder.splice(e,1),hn.markupdraworder.unshift(s)),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Dl(),Vl(n),Nl(a)}()},movetoFront:function(){yd()||Hr||mi||function(){for(var e=null,t=hn.markupdraworder.length;t>0;t--){var i=hn.markupdraworder[t-1];if(hn.markuplist[i].selected||hn.markuplist[i].selectedit){var s=i;e=t-1;break}}null!=e&&(hn.markupdraworder.splice(e,1),hn.markupdraworder.push(s)),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),null!=ht&&ht.setThumbnails(hn.thumbnails),Dl(),Vl(n),Nl(a)}()},toggleCycleSelect:function(){yd()||Hr||mi||(D=!D)},setdebug:function(e){Nr=e},markupAddBlockText:function(e,t,a,i){if(!yd()&&!Hr&&!mi){if(hn.getCurrentpage().usevectorxml){var s=hn.getCurrentpage().getBlockCentroid(e),r=.75*hn.getCurrentpage().getpixeldist(t),o=new cl(9,1,0);o.scaling=hn.getCurrentpage().getdscale(),o.xoffset=hn.getCurrentpage().getdx(),o.yoffset=hn.getCurrentpage().getdy(),o.font.setFontname(Pn.fontName),o.font.setHeight(r),o.font.setBold(Pn.bold),o.font.setItalic(Pn.italic);var l=function(e,t,a){var i=0,s=a.height,r=t.split("\n");e.save(),e.font=a.fontstringScaled;for(var n=0;n<r.length;n++){var o=e.measureText(r[n]);i<o.width&&(i=o.width)}return s=s*n+s/2*n,i+=10,e.restore(),{w:i,h:s}}(n,a,o.font);o.linewidth=.5,o.w=l.w,o.h=l.h,o.x=s.x-o.w/2,o.y=s.y-o.h/2,o.text=a,o.fillcolor="rgba(255,255,255, 0.9)",o.textcolor=i,o.strokecolor=i,o.pagerotation=hn.getCurrentpage().getpageRotation(),o.pagenumber=hn.getcurPage(),o.viewname=hn.getcur3DView(),null!=o.viewname&&(o.bfor3D=!0,o.pageheight=ai,o.pagewidth=ti),o.savemetolistDraw()}Vl(n)}},markupAddMulti:function(e){Gs=e},markupAngleSwitch:function(){yd()||Hr||yl(18)},markUpArea:function(e,t){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:8,p2:0}):eu("markupedit",{p1:!1}))},markUpAreaHole:function(e){if(!yd()&&!Hr&&!mi){var t=gl();if(t.isempty||8!=t.type)return eu("markupedit",{p1:!1}),Dl(),void bl();Dl(),bl(),e?eu("area",{p1:8,p2:2,p3:t}):eu("markupedit",{p1:!1})}},markupAreaRect:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("measure",{p1:3,p2:6}):eu("markupedit",{p1:!1}))},markupRectToAreaSwitch:function(e){yd()||Hr||mi||(ap(),function(e){var t=8,a=0,i=e.rotatedrect,s={x:i.x,y:i.y},r=new cl(t,a,Lr);r.pagenumber=hn.getcurPage(),r.viewname=hn.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=ai,r.pagewidth=ti);var o={scale:void 0,xoffset:void 0,yoffset:void 0};o.scale=lo();var l=ro();o.xoffset=l.x,o.yoffset=l.y,r.scaling=o.scale,r.xoffset=o.xoffset,r.yoffset=o.yoffset,r.x=s.x,r.y=s.y,r.seteditaction(0),hn&&(hn.bMarkupchanged=!0),function(e,t){if(null==t)return;let a=e.rotatedrect,i=[{x:a.x,y:a.y},{x:a.x+a.w,y:a.y},{x:a.x+a.w,y:a.y+a.h},{x:a.x,y:a.y+a.h}];t.points=i,t.findrectangle(),Gs||(Ms=!0),Us=hn.markuplist.length,t.savemetolistDraw(),t.saved,t=null,Dh(),Vl(n),$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}(e,r)}(e))},markUpArrow:function(e,t){yd()||Hr||mi||(Dl(),bl(),e?eu("arrow",{p1:t}):eu("markupedit",{p1:!1}))},measureArc:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("measurearc",{p1:0}):eu("markupedit",{p1:!1}))},markupButton:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("symbol",{p1:3}):eu("markupedit",{p1:!1}))},markupButtonFromMatch:function(e,i,s,r){if(!yd()&&!Hr&&!mi){Dl(),bl();var o=new cl(11,3,0);o.scaling=lo();var l=ro(i);o.xoffset=l.x,o.yoffset=l.y,o.pagenumber=i,o.seteditaction(0),o.x=e.x-r.left,o.y=e.y-r.top,o.w=s.width,o.h=s.height,o.image=new Image,a.clearRect(0,0,t.width,t.height),ru(!1,n),Ms=!0,Us=hn.markuplist.length,o.savemetolistDraw();var c,h,d,p=(c=o.image,h=s,d=hn.markuplist[Us],new Promise((function(e,t){c.onload=function(t){d.savemetolistDraw(),Dh(),Vl(n),e(d)},c.onerror=function(e){t()},c.src=h.src})));return o=null,p}},markupChanged:function(){if(!yd())return!(!hn.bMarkupchanged||Hr)},getnumMarkups:function(){if(!yd())return hn.markuplist.length},markupCircle:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("arrow",{p1:10}):eu("markupedit",{p1:!1}))},markupCount:function(e,t){yd()||Hr||mi||(Dl(),bl(),e?("count"==cn.name&&cn.started&&cn.apply(),eu("count",{p1:13,p2:t})):("count"==cn.name&&cn.started&&cn.apply(),eu("markupedit",{p1:!1})))},markUpDimension:function(e,t){yd()||Hr||mi||(Dl(),bl(),e?hn.getCurrentpage().usevector3Dxml?Np(e,"measure3D",null):eu("measure",{p1:7,p2:t}):hn.getCurrentpage().usevector3Dxml?Np(e,"measure3D",null):eu("markupedit",{p1:!1}))},markupDisplay:function(e){yd()||Hr||yl(e?15:14)},markUpEdged:function(){if(!yd()&&!Hr&&!mi){var e=Lr;Lr=2,yl(3),zr||(Lr=e)}},markUpErase:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("pencil",{p1:1}):("pencil"==cn.name&&cn.started&&cn.apply(),eu("markupedit",{p1:!1})))},markUpFilled:function(e){if(!yd()&&!Hr&&!mi){var t=Lr;Lr=1,e?ml(e,3):yl(3),zr||(Lr=t)}},markUpFreePen:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("pencil",{p1:0}):("pencil"==cn.name&&cn.started&&cn.apply(),eu("markupedit",{p1:!1})))},markUpHatched:function(){if(!yd()&&!Hr&&!mi){var e=Lr;Lr=3+Or,yl(3),zr||(Lr=e)}},markUpHighlight:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("rect",{p1:3,p2:3,redact:!1}):eu("markupedit",{p1:!1}))},markuphoverevent:function(e){Yi=e},markUpLayerDialog:function(){yd()||mi||null!=Be&&Be.setMarkupLayers(Dr)},markupLine:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("arrow",{p1:9}):eu("markupedit",{p1:!1}))},markupLinkRect:function(e,t,a,i,s){if(!yd()&&!Hr&&!mi){Dl(),bl();var r=0;e&&(r=3);var o=new cl(3,r,0);e&&(o.transparency=30,o.fillcolor=An(o.fillcolor,o.transparency)),o.scaling=lo();var l,c=ro(a);o.xoffset=c.x,o.yoffset=c.y,o.pagenumber=a,o.viewname=(l=null,yd()||hn.getCurrentpage().usevector3Dxml&&(l=hn.getCurrentpage().getcur3DView()),l),null!=o.viewname&&(o.bfor3D=!0,o.pageheight=ai,o.pagewidth=ti),s?(o.x=t.x-s.left,o.y=t.y-s.top,o.w=t.w+s.right,o.h=t.h+s.bottom):(o.x=t.x,o.y=t.y,o.w=t.w,o.h=t.h),o.savemetolistDraw(),i&&""!=i&&o.setLink(i,!0),Dh(),Vl(n),o=null}},markupAngle:function(e,t){yd()||Hr||mi||(Dl(),bl(),e?eu("area",t?{p1:1,p2:5}:{p1:1,p2:4}):eu("markupedit",{p1:!1}))},markupMeasurePath:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:1,p2:3}):eu("markupedit",{p1:!1}))},markupMeasureSegment:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:1,p2:6}):(6==cn.subtype&&cn.started&&cn.apply(),eu("markupedit",{p1:!1})))},markupMultiselect:function(e){fs=e},multiselect3Dpart:function(e){ys=e},markUpNote:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("note",{}):eu("markupedit",{p1:!1}))},markUpOutlined:function(e){if(!yd()&&!Hr&&!mi){var t=Lr;Lr=0,e?ml(e,3):yl(3),zr||(Lr=t)}},markUpPolycurve:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("Polycurve",{p1:1}):eu("markupedit",{p1:!1}))},markUpPolyline:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:1,p2:1}):eu("markupedit",{p1:!1}))},markuprevCloud:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:1,p2:7}):eu("markupedit",{p1:!1}))},markUpRedraw:jd,redactRect:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("rect",{p1:3,p2:4,redact:!0}):eu("markupedit",{p1:!1}))},markUpRotate:function(e){if(!yd()&&!Hr){var t=gl();t.isempty||(t.rotation=e*(Math.PI/180)),Vl(n),Nl(a)}},markUpSave:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?(e||(Dl(),bl()),oh(E,Fr,Ir)):(e||(Dl(),bl()),hn.bLargePDF?nh(E,Fr,Ir):oh(E,Fr,Ir)))},markupGetJSON:function(e){yd()||Hr||mi||(e||(Dl(),bl()),hn.bLargePDF?function(e,t){var a=new bn(hn);a.setOncomplete((function(e){Bt.setMarkupList(e,hn.bActive)})),a.createjson(e,t)}(Fr,Ir):function(e,t){if(!yd()){var a=ah(!0,!1,!0,e);Bt.setMarkupList(a,hn.bActive)}}(Fr))},markupSaveJSON:function(e,t){if(!yd()&&null!=I){var a=ih(!0,!1,!1,Fr,Ir),i=(new XMLSerializer).serializeToString(a),s=window.btoa(i),r=[{Command:"SaveMarkup",LicenseID:os,OutputName:t,DestFolder:e,MarkupData:s}],n=JSON.stringify(r);Fh("POST",I,"",n).then((function(e){null!=Ra&&Ra.markupSaved()})).catch((function(e){e.status?404==e.status?console.log("Markup save failed, error 404"):503==e.status?console.log("Markup save failed, error 503"):console.log(e.status):console.log(e)}))}},setMarkupfromJSON:function e(t,a){null!=a&&null!=a||(a=hn);var i=!1,s=!1,r=!1,o=JSON.parse(t);null!=o.operation?o.operation.created?i=!0:o.operation.deleted?s=!0:r=!0:r=!0;var l=o.Entity.Type,c=o.Entity.Subtype,h=o.Entity.Alternative;if(i){if(null!=o.Entity.Signature){var d=o.Entity.Signature;wr[0].Signature!=d&&(Pr=Dr[o.Entity.Layer].Color,wr.push(new qn(d,o.Entity.Name,o.Entity.Layer,Pr,!1)))}var p=o.Entity.ID?o.Entity.ID:null,u=9==l&&2==c;if(null!=o.Entity.HaveLeader)var g=1==o.Entity.HaveLeader;if((g||u)&&null!=o.Entity.Entity){var f=(E=o.Entity.Entity).Entity.Type,m=E.Entity.Subtype,y=E.Entity.Alternative,v=E.Entity.ID?E.Entity.ID:null,x=new cl(f,m,y);E=JSON.stringify(E),(F=x.setfromJSON(a,E))&&(x.savemetolistLoad(a,!1),x.markupnumber=v)}if(null!=o.Entity.Hole)var b=!0;var w=[],k=[];if(b&&null!=o.Entity.Holes)for(var D=o.Entity.Holes,C=0;D.length>0;){var R=D[0].Type,P=D[0].Subtype,S=D[0].Alternative,M=D[0].ID?D[0].ID:null;R=parseInt(R),P=parseInt(P),S=parseInt(S),w.push(new cl(R,P,S)),k.push(w[C].setfromJSON(a,D[0])),k[C]&&(w[C].savemetolistLoad(a,!1),w[C].markupnumber=M),C++}var T=new cl(l,c,h);if(T.markupID=p,T.setfromJSON(a,t)){if(F&&g&&null!=x){if(T.bhasArrow=g,T.markupArrowConnected=x,x.bisTextArrow=!0,x.textBoxConnected=T,x.setArrowPoint(T),F=!1,g=!1,b)for(C=0;C<w.length;C++)k[C]&&(w[C].parent=T,T.holes.push(w[C]));Vl(n)}T.savemetolistLoad(a,!1)}else console.log("adding markup failed ",T.markupID)}else if(s)Ml(o.Entity.ID);else if(r){if(null==(T=a.getmarkupobjbyID(o.Entity.ID)))return null==o.operation&&(o.operation={}),o.operation.created=!0,o.operation.deleted=!1,o.operation.modified=!1,void e(JSON.stringify(o),a);if(T.subtype=c,T.alternative=h,T.setfromJSON(a,t),u=9==T.type&&2==T.subtype,T.bhasArrow&&(g=1==o.Entity.HaveLeader),(T.bhasArrow||u)&&null!=o.Entity.Entity){var E=o.Entity.Entity;x=T.markupArrowConnected,E=JSON.stringify(E);var F=x.setfromJSON(a,E);x.setfromJSON(a,E),x.setArrowPoint(T)}}null!=Nt&&Nt.setMarkupList(a.getmarkuplist(),a.bActive),null!=je&&je.setUserlist(wr,a.bActive),Vl(n)},setUniqueMarkupfromJSON:function e(t,a){null!=a&&null!=a||(a=hn);var i=!1,s=!1,r=!1,o=JSON.parse(t);null!=o.operation?o.operation.created?i=!0:o.operation.deleted?s=!0:r=!0:r=!0;var l=o.Entity.Type,c=o.Entity.Subtype,h=o.Entity.Alternative;if(i){if(null!=o.Entity.Signature){var d=o.Entity.Signature;wr[0].Signature!=d&&(Pr=Dr[o.Entity.Layer].Color,wr.push(new qn(d,o.Entity.Name,o.Entity.Layer,Pr,!1)))}var p=o.Entity.ID?o.Entity.ID:null,u=o.Entity.UniqueID?o.Entity.UniqueID:null;if(null!=(k=a.getmarkupobjbyGUID(u)))return;var g=9==l&&2==c;if(null!=o.Entity.HaveLeader)var f=1==o.Entity.HaveLeader;if((f||g)&&null!=o.Entity.Entity){var m=(j=o.Entity.Entity).Entity.Type,y=j.Entity.Subtype,v=j.Entity.Alternative,x=j.Entity.ID?j.Entity.ID:null,b=j.Entity.UniqueID?j.Entity.UniqueID:null,w=new cl(m,y,v);j=JSON.stringify(j),(A=w.setfromJSON(a,j))&&(w.savemetolistLoad(a,!1),w.markupnumber=x,w.uniqueID=b)}var k=new cl(l,c,h);if(k.markupID=p,k.uniqueID=u,k.setfromJSON(a,t)?(A&&f&&null!=w&&(k.bhasArrow=f,k.markupArrowConnected=w,w.bisTextArrow=!0,w.textBoxConnected=k,w.setArrowPoint(k),A=!1,f=!1,Vl(n)),k.savemetolistLoad(a,!1)):console.log("adding markup failed ",k.uniqueID),null!=o.Entity.Holes)var D=!0;var C=[],R=[];if(D){if(null!=o.Entity.Holes)for(var P=o.Entity.Holes,S=0;P.length>S;){var M=P[0],T=M.Entity.Type,E=M.Entity.Subtype,F=M.Entity.Alternative,I=M.Entity.ID?M.Entity.ID:null;T=parseInt(T),E=parseInt(E),F=parseInt(F),C.push(new cl(T,E,F)),M=JSON.stringify(M),R.push(C[S].setfromJSON(a,M)),R[S]&&(C[S].markupnumber=I,C[S].savemetolistLoad(a,!1)),S++}for(k.holes=[],S=0;S<C.length;S++)R[S]&&(C[S].parent=k,k.holes.push(C[S]))}}else if(s){if(0==o.Entity.UniqueID)return void console.log("not a unique markup id");xl(o.Entity.UniqueID)}else if(r){if(0==o.Entity.UniqueID)return void(k=null);if(null!=(k=a.getmarkupobjbyGUID(o.Entity.UniqueID))){if(k.subtype=c,k.alternative=h,k.setfromJSON(a,t),g=9==k.type&&2==k.subtype,k.bhasArrow&&(f=1==o.Entity.HaveLeader),(k.bhasArrow||g)&&null!=o.Entity.Entity){var j=o.Entity.Entity;w=k.markupArrowConnected,j=JSON.stringify(j);var A=w.setfromJSON(a,j);w.setfromJSON(a,j),w.setArrowPoint(k)}if(null!=o.Entity.Holes&&(D=!0),C=[],R=[],D){if(null!=o.Entity.Holes)for(P=o.Entity.Holes,S=0;P.length>S;)T=(M=P[0]).Entity.Type,E=M.Entity.Subtype,F=M.Entity.Alternative,I=M.Entity.ID?M.Entity.ID:null,T=parseInt(T),E=parseInt(E),F=parseInt(F),C.push(new cl(T,E,F)),M=JSON.stringify(M),R.push(C[S].setfromJSON(a,M)),R[S]&&(C[S].savemetolistLoad(a,!1),C[S].setDrawdim(),C[S].markupnumber=I),S++;for(k.holes=[],S=0;S<C.length;S++)R[S]&&(C[S].parent=k,k.holes.push(C[S]))}}else{if(0!=o.Entity.UniqueID)return o.operation||(o.operation={}),o.operation.created=!0,o.operation.deleted=!1,o.operation.modified=!1,void e(JSON.stringify(o),a);console.log("adding or modifying markup failed ",k.markupID)}}null!=Nt&&Nt.setMarkupList(a.getmarkuplist(),a.bActive),null!=je&&je.setUserlist(wr,a.bActive),Vl(n)},addWatermarkToAllPages:function(e,t){hn&&null!=hn.foxitdoc&&hn.foxitdoc.addWatermarkToAllPages(e,t)},removeWatermarkFromAllPages:function(){hn&&null!=hn.foxitdoc&&hn.foxitdoc.removeWatermarkFromAllPages()},addWatermarkToPage:function(e,t,a){hn&&null!=hn.foxitdoc&&hn.foxitdoc.addWatermarkToPage(e,t,a)},removeWatermarkFromPage:function(e){hn&&null!=hn.foxitdoc&&hn.foxitdoc.removeWatermarkFromPage(e)},addWatermarkRender:function(e,t){hn&&null!=hn.foxitdoc&&hn.foxitdoc.addWatermarkRender(e,t)},setMarkup3DSavefile:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.setMarkup3DSavefile(e)},setMarkupCursor:function(e,t){for(var a=0;a<xr.length;a++)e==xr[a].name&&(xr[a].cursor=t)},setViews3DSavefile:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.setViews3DSavefile(e)},markupSaveCheck:function(e){Si=e},markUpSelected:function(e){e&&"function"==typeof e&&$t.connect(e)},markUpShape:function(e,t,a){if(!yd()&&!Hr&&!mi)if(Dl(),bl(),e)switch(t){case 0:eu("rect",{p1:3,p2:a,redact:!1});break;case 1:eu("rect",{p1:4,p2:a,redact:!1});break;case 2:eu("rect",{p1:5,p2:a,redact:!1});break;case 3:eu("area",{p1:1,p2:2})}else if(hn.getCurrentpage().usevector3Dxml)switch(hn.curcontrol3D){case"Walkthrough3D":Rd(!0);break;case"orbitControl":Cd();break;case"markupedit":eu("markupedit",{p1:!1})}else eu("markupedit",{p1:!1})},markupSpace:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("area",{p1:8,p2:1}):eu("markupedit",{p1:!1}))},markUpStamp:function(e){gi&&(Hr||mi||(Dl(),bl(),eu("rectStamp",{p1:e})))},markupSymbol:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("symbol",{p1:1}):eu("markupedit",{p1:!1})))},markupImageStamp:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("symbol",{p1:12}):eu("markupedit",{p1:!1})))},markupQRCode:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("symbol",{p1:13}):eu("markupedit",{p1:!1})))},markupinteractiveStamp:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("interactiveStamp",{p1:21}):eu("markupedit",{p1:!1})))},markupLink:function(e){yd()||Hr||mi||(hn.getCurrentpage().usevector3Dxml?Np(e,"add3dsymbol",{p1:"drag"}):(Dl(),bl(),e?eu("link",{p1:20}):eu("markupedit",{p1:!1})))},markUpSubType:function(e){if(!yd()&&!Hr){var t=gl();t.isempty||(t.subtype=e),Vl(n),Nl(a)}},markUpText:function(e){yd()||Hr||mi||(Dl(),bl(),e?eu("text",{}):eu("markupedit",{p1:!1}))},markUpTextRect:function(e,t){yd()||Hr||mi||(e?(Dl(),bl(),eu("rectText",{})):eu("markupedit",{p1:!1}),qt&&t&&"function"==typeof t&&qt.connect(t))},markUpTextRectArrow:function(e){yd()||Hr||mi||(e?(Dl(),bl(),eu("arrow",{p1:6})):eu("markupedit",{p1:!1}))},markUpRedo:function(){yd()||mi||(Dl(),bl(),function(){if(null!=hn&&null!=hn){var e=hn.markupredolist.pop();if(e)for(;e.bcurstate&&hn.markupredolist.length>0;)hn.markupundolist.push(e),e=hn.markupredolist.pop();if(e)if(e.bMultiOp){el(e);var t=[],a=e.multiOpId,i=0;for(i=0;i<hn.markupredolist.length;i++)hn.markupredolist[i].bMultiOp&&hn.markupredolist[i].multiOpId==a?el(hn.markupredolist[i]):t.push(hn.markupredolist[i]);hn.markupredolist=t}else el(e);0==hn.markupredolist.length&&null!=Je&&Je.listempty(!1,!0)}}(),Vl(n),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive))},markUpUndo:function(){yd()||mi||(Dl(),bl(),function(){if(null!=hn&&null!=hn){var e=hn.markupundolist.pop();if(e)if(e.bMultiOp){al(e);var t=[],a=e.multiOpId,i=0;for(i=0;i<hn.markupundolist.length;i++)hn.markupundolist[i].bMultiOp&&hn.markupundolist[i].multiOpId==a?al(hn.markupundolist[i]):t.push(hn.markupundolist[i]);hn.markupundolist=t}else al(e);0==hn.markupundolist.length&&null!=Je&&Je.listempty(!0,!1)}}(),Vl(n),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive))},markUpUserDialog:function(){yd()||null!=je&&je.setUserlist(wr,hn.bActive)},measure:function(e){yd()||(Dl(),bl(),e?eu("measuretool",{twoopoints:!1}):eu("markupedit",{p1:!1}))},measuredistance:function(e){yd()||(Dl(),bl(),e?eu("measuretool",{twoopoints:!0}):eu("markupedit",{p1:!1}))},metricUnit:vp,elementMetricUnit:function(e){var t=Zd();null!=t&&null!=t.scaleObject&&(t.hasScale=!0,t.scaleObject.metricUnit(e),null!=Qt&&Qt.setMarkupSelected(t,9))},modifyMarkup:function(e,t){var a=function(e){for(var t={isempty:!0},a=0;a<yn.length;a++)for(var i=0;i<yn[a].markuplist.length;i++)null!=yn[a].markuplist[i]&&yn[a].markuplist[i].getUniqueID()==e&&(t=yn[a].markuplist[i]);return t}(e);if(!a.isempty){nl(a);var i=So(t);if(null!=i.getElementsByTagName("FileVersion")&&0!=i.getElementsByTagName("FileVersion").length)var s=i.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=i.getElementsByTagName("Entity")){for(var r=i.getElementsByTagName("Entity"),o=0;o<r.length;o++){if(null!=r[o].getElementsByTagName("HaveLeader")[0])var l=1==parseInt(r[o].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(l&&null!=r[o].getElementsByTagName("Entity")[0]){var c=r[o].getElementsByTagName("Entity")[0],h=c.getElementsByTagName("Alternative")[0].firstChild.nodeValue;a.SetfromXML(hn,c,s)&&(r[o].removeChild(c),a.alternative=h,null!=a.textBoxConnected&&(a=a.textBoxConnected))}var d=r[o].getElementsByTagName("Alternative")[0].firstChild.nodeValue;d=parseInt(d),a.SetfromXML(hn,r[o],s)&&(a.alternative=d)}a&&a.notify(),0==r.length&&null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n)}}},moveimageMarkup:function(e,t){if(!yd()&&!Hr&&!mi){Dl(),bl();var a=function(e){var t=0,a=null;for(t=0;t<hn.markuplist.length;t++)null!=hn.markuplist[t]&&11==hn.markuplist[t].type&&hn.markuplist[t].subtype==e&&(a=hn.markuplist[t]);return a}(2);null!=a&&a.movedirect(e,t)}},moveLabelEnable:function(e){"markupedit"==cn.name&&cn.enableMoveLabel(e)},moveTo3DNavPos:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&(null!=da&&Cs&&da.setWalkthroughGUI(!0),eu("Walkthrough3D",{}),hn.curcontrol3D="Walkthrough3D",hn.getCurrentpage().walkthroughcontrol.setCameraXYPos(e))},moveTo3DPart:function(){if(!yd())if(hn.getCurrentpage().usevector3DGLTF)!function(){if(hn.getCurrentpage().usevector3Dxml){if(null!=hn.getCurrentpage().Vector3DPageObj.getcur3DView())return;var e=hn.getCurrentpage().Vector3DPageObj.getMeshChildren(),t=hn.getCurrentpage().Vector3DPageObj.getMarkupChildren(),a=hn.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==e.length)return;var i=hn.getCurrentpage().Vector3DPageObj.getSelectedPart();if(-1!=i.index){new THREE.Raycaster,hn.getCurrentpage().Vector3DPageObj.scene.updateMatrixWorld(),hn.getCurrentpage().Vector3DPageObj.scene.position.x,hn.getCurrentpage().Vector3DPageObj.scene.position.y,hn.getCurrentpage().Vector3DPageObj.scene.position.z,hn.getCurrentpage().Vector3DPageObj.scale;var s=hn.getCurrentpage().Vector3DPageObj.getmminUnit(2500),r=hn.getCurrentpage().Vector3DPageObj.getmminUnit(10),n=(hn.getCurrentpage().Vector3DPageObj.getfloorheight(),[]);if(i.isadded)if(i.group)var o=a[i.addedmeshindex][i.index].children[i.groupindex].geometry.boundingSphere.center.clone();else o=a[i.addedmeshindex][i.index].geometry.boundingSphere.center.clone();else o=i.group?e[i.index].children[i.groupindex].geometry.boundingSphere.center.clone():i.markup?t[i.index].position.clone():e[i.index].geometry.boundingSphere.center.clone();var l=new THREE.Vector3(1,0,0).normalize(),c=new THREE.Vector3(-1,0,0).normalize(),h=new THREE.Vector3(0,-1,0).normalize(),d=new THREE.Vector3(0,1,0).normalize(),p=hn.getCurrentpage().camera.far;n.push({direction:c,raycaster:new THREE.Raycaster(o,c,r,p),intersects:null,distance:0}),n.push({direction:l,raycaster:new THREE.Raycaster(o,l,r,p),intersects:null,distance:0}),n.push({direction:h,raycaster:new THREE.Raycaster(o,h,r,p),intersects:null,distance:0}),n.push({direction:d,raycaster:new THREE.Raycaster(o,d,r,p),intersects:null,distance:0});for(var u=0,g=0,f=0;f<n.length;f++)if(i.isadded?n[f].intersects=n[f].raycaster.intersectObjects(a,!0):n[f].intersects=n[f].raycaster.intersectObjects(e,!0),n[f].intersects.length>0)for(var m=0;m<n[f].intersects.length;m++)if(n[f].intersects[m].object.visible&&null!=n[f].intersects[m].face){if(i.markup){n[f].distance=n[f].intersects[m].distance,n[f].distance>u&&(u=n[f].distance,g=f);break}if(!n[f].intersects[m].object.userData.selected){n[f].distance=n[f].intersects[m].distance,n[f].distance>u&&(u=n[f].distance,g=f);break}}hn.getCurrentpage().camera.position.copy(o),hn.getCurrentpage().camera.lookAt(o),(new THREE.Vector3).subVectors(hn.getCurrentpage().camera.position,o).normalize(),n[g].distance>=s?hn.getCurrentpage().camera.position.copy(n[g].direction.multiplyScalar(s).add(o)):hn.getCurrentpage().camera.position.copy(n[g].direction.multiplyScalar(n[g].distance).add(o)),hn.getCurrentpage().camera.lookAt(o);var y=hn.getCurrentpage().Vector3DPageObj.checkfloorheight();null!=y&&(hn.getCurrentpage().camera.position.copy(y),hn.getCurrentpage().camera.lookAt(o),hn.getCurrentpage().walkthroughcontrol.setTempWalkHeight(y.z),hn.getCurrentpage().camera.lookAt(o),hn.getCurrentpage().Vector3DPageObj.checkcurfloor(),hn.getCurrentpage().Vector3DPageObj.getfloorElevation(0)),new THREE.Vector3(o.x,o.y,o.z),hn.getCurrentpage().camera.rotation.x,hn.getCurrentpage().camera.rotation.y,hn.getCurrentpage().camera.rotation.z}}null!=da&&Cs&&da.setWalkthroughGUI(!0),eu("Walkthrough3D",{}),hn.curcontrol3D="Walkthrough3D"}();else{if(hn.getCurrentpage().usevector3Dxml){var e=hn.getCurrentpage().Vector3DPageObj.getSelectedPart();if(-1!=e){hn.getCurrentpage().Vector3DPageObj.scene.updateMatrixWorld();var t=hn.getCurrentpage().Vector3DPageObj.scene.position.x,a=hn.getCurrentpage().Vector3DPageObj.scene.position.y,i=hn.getCurrentpage().Vector3DPageObj.scene.position.z,s=hn.getCurrentpage().Vector3DPageObj.scale,r=-hn.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.x*s,n=-hn.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.y*s,o=-hn.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.z*s,l=hn.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.z-hn.getCurrentpage().Vector3DPageObj.partlist[e].minz,c=t-r,h=a-n,d=i-o,p=new THREE.Vector3(c,h,d);"IFC"==hn.Format.substring(0,3)?hn.getCurrentpage().camera.up.set(0,0,1):hn.getCurrentpage().camera.up.set(0,1,0);var u=hn.getCurrentpage().Vector3DPageObj.getfloorheight(),g=s*hn.getCurrentpage().Vector3DPageObj.getmeterunit(),f=(u-l)*s;hn.getCurrentpage().camera.position.x=c,hn.getCurrentpage().camera.position.y=h-g,hn.getCurrentpage().camera.position.z=d+f,hn.getCurrentpage().camera.lookAt(p);var m=hn.getCurrentpage().camera.rotation.x;hn.getCurrentpage().camera.rotation.y,hn.getCurrentpage().camera.rotation.z,hn.getCurrentpage().walkthroughcontrol.setInitial(-m*(180/Math.PI),90,0,0)}}null!=da&&Cs&&da.setWalkthroughGUI(!0),eu("Walkthrough3D",{}),hn.curcontrol3D="Walkthrough3D"}},mSIEeventCheck:function(e){Hi=e},nav3Dreplacediag:function(){null!=ga&&(0==xn.length&&kd(),ga.CompareDialog())},navigateBookmark:function(e){yd()||gi&&hn.navigateBookmark(e)},nextMarkup:function(){yd()||mi||(Dl(),bl(),hn.getCurrentpage().MarkupZoom())},nextPage:function(){yd()||mi||(Dl(),bl(),hn.GotoPage(hn.currentpage+1),eu("markupedit",{p1:!1}))},noteFocus:function(e){yd()||(js=e)},noSelect3D:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.setNoSelectAll(e)},onNotePlaced:function(e){Zt.callback=e},onTextPlaced:function(e){Yt.callback=e},openFile:function(e,t,a){null!=la&&la.setDownload("show"),he=!1;var i=!1,s=Od(e);null!=s&&(null!=s.filename&&(i=!0),i?zc(s,t,a):null!=la&&la.setDownload("hide"))},openFloorplanFile:function(e,t){if(!yd()&&yn[e].pages[0].usevector3DGLTF){var a=yn[e].getFloorplans();if(a.length>0)for(var i=0;i<a.length;i++)if(a[i].index==t){RxCore_openFile(a[i].SRC);break}}},openFileCustom:function(e){null!=la&&la.setDownload("show"),he=!0,fe=e,function(e){Ii=!1,wi&&(null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp(),Eh("GET",e+"data.xml").then((function(t){gi&&Li&&Qd(),w=t,null==hn||null==hn?(fn=yn.push(new Mc(t)),(hn=yn[fn-1]).setfileindex(fn-1),hn.relativepath=e):(fn=yn.push(new Mc(t)),hn.enableTextSelect(!1),(hn=yn[fn-1]).setfileindex(fn-1),hn.relativepath=e),Wo(hn.OriginalURL),hn.Format.substring(0,9);var a=t.getElementsByTagName("Layout");if(hn.createPages(a,hn.FileName),md()){yn[fn-1]=hn,null!=ht&&ht.setThumbnails(hn.thumbnails);var i={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"getfileCustom"};null!=Jt&&Jt.setGUIState(i);var s={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(s)}})).catch((function(e){fd(e)})))}(e)},openFileLayouts:function(e,t,a){null!=la&&la.setDownload("show"),he=!1,Bc(e,t,!0,a)},openFileLayoutsEx:function(e,t,a){null!=la&&la.setDownload("show"),he=!1;var i=!1,s=Od(e);null!=s&&(null!=s.filename&&(i=!0),i?Nc(s,t,!0,a):null!=la&&la.setDownload("hide"))},openFilePages:function(e,t,a){null!=la&&la.setDownload("show"),he=!1,Bc(e,t,!1,a)},openFilePagesPDFdoc:function(e,i,r,o){null!=la&&la.setDownload("show"),he=!1,function(e,i,r,o){if(Ii=!1,wi){null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0));var l=_o(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height),yp(),mp();var c='<?xml version="1.0" encoding="UTF-8"?>';c+="<RxViewServer>",c+="<Command>GetFile</Command>",c+="<LicenseID>"+os+"</LicenseID>",c+="<FileURL>"+e+"</FileURL>",Eh("POST",C,c+="</RxViewServer>",[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=la&&la.setDownload("hide");var s=0,n=0;fn=yn.push(new Mc(e)),(hn=yn[fn-1]).setfileindex(fn-1),hn.usepagesload=!0,hn.setPDFdocument(i,!1);var o=Wo(hn.OriginalURL),c=e.getElementsByTagName("Layout");for(t=0;t<c.length;t++){var h=c[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;hn.addlayout(h);var d=c[t].getElementsByTagName("Page");for(a=0;a<d.length;a++)0==a&&0==t?r.indexOf(a)>=0&&(hn.addthumbnail(new bc(d[a],h,hn,a)),hn.addpage(new Sc(d[a],h,!0,o,a,hn),!0),n++):r.indexOf(a)>=0&&(0==n?(hn.addpage(new Sc(d[a],h,!0,o,a+s,hn),!0),hn.addthumbnail(new bc(d[a],h,hn,a+s)),n++):(hn.addpage(new Sc(d[a],h,!1,"",a+s,hn),!1),hn.addthumbnail(new bc(d[a],h,hn,a+s)),n++));s+=a}md()&&(hn.FileName=l,yn[fn-1]=hn,null!=ht&&ht.setThumbnails(hn.thumbnails))})).catch((function(e){gd("getfilePagesPDFdoc",e)}))}}(e,i,r,o)},openFileSilent:function(e,t,a){null!=la&&la.setDownload("show"),he=!1,Hc(e,t,a)},open3DFloorplan:function(e,t,a){null!=la&&la.setDownload("show"),he=!1,ue=!0,Hc(e,t,a)},open3DFloorplanPage:function(e,t){null!=la&&la.setDownload("show"),he=!1,ue=!0,ge=t,"string"==typeof e&&zc({filename:e,displayname:null})},openFileGLTF:function(e){if(null!=la&&la.setDownload("show"),"object"==typeof e){var t="",a=!1;null!=e.filepath&&null!=e.filepath&&(t=e.filepath,a=!0),null!=e.mime&&null!=e.mime&&(t=t+"?x-mimetype="+e.mime),null!=e.cacheid&&null!=e.cacheid&&(t=t+"&amp;cacheid="+e.cacheid);var i={filename:t,displayname:null};null!=e.displayname&&null!=e.displayname&&(i.displayname=e.displayname),a?Sh(e.filepath):null!=la&&la.setDownload("hide")}else"string"==typeof e&&(i={filename:e,displayname:null},Sh(e))},openMarkup:function(e){yd()||Kc(e,hn)},openRecent:function(e){null!=la&&la.setDownload("show");var t=zc({filename:e,displayname:null});null!=t&&"Require Password"==t&&console.log("Require Password")},orbit3D:Cd,overlayFiles:function(e,t){Gd(e,t,1)},overlay:function(e){_d(e,1)},overlaymode:function(e){return Qr=!Qr},overrideLinewidth:function(e,t){Ka=e,$a=t},penTabledialog:function(){if(!yd()&&hn.getCurrentpage().usevectorxml&&null!=Ae){var e=hn.getCurrentpage().getPenTable();Ae.setPentablelist(e.pens,hn.bActive)}},setSnapSize:function(e){Qa=e},setPenTable:function(e){gi&&(mi||hn.getCurrentpage().setPenTable(e))},setpentablePen:function(e,t){gi&&(mi||(t?hn.getCurrentpage().resetPenTablepen(e):hn.getCurrentpage().setPenTablepen(e)))},setPenTableScaled:function(e){gi&&(mi||hn.getCurrentpage().setpentableScaled(e))},setPenwidth:function(e){gi&&(mi||hn.getCurrentpage().setPenwidth(e))},pageLock:function(e){yd()||hn.pagelock(e)},pageOnlyMarkup:function(e){yd()||null!=Nt&&(e&&Nt.pageonly?Nt.pageonly=!1:Nt.pageonly=!0,Nt.setMarkupList(hn.getmarkuplist(),hn.bActive))},pagePos:rp,panPage:function(e,t){yd()||hn.getCurrentpage().usevector3Dxml||hn.getCurrentpage().pan_page(e,t,!0)},setPagePosPan:function(e,t){yd()||hn.getCurrentpage().usevector3Dxml||hn.getCurrentpage().setpagepos_pan(e,t)},panWindow:function(e){yd()||hn.getCurrentpage().usevector3Dxml||(Dl(),bl(),e?eu("pan",{}):eu("markupedit",{p1:!1}))},pasteMarkUp:function(){yd()||mi||(function(){if("undefined"!=typeof Storage){if(null!=localStorage.getItem("MarkupPostfixlist"))var e=localStorage.MarkupPostfixlist.split(",");else e=[""];var t=!1;e.length>1&&(t=!0,bi+=1);var a=hn.getCurrentpage();if(a)var i=a.getpagerect();for(var s=10,r=10,n=0;n<e.length;n++){var o=e[n];if(null!=localStorage.getItem("Type"+o)){var l=parseInt(localStorage.getItem("Type"+o));if(null!=localStorage.getItem("Subtype"+o)){var c=parseInt(localStorage.getItem("Subtype"+o));if(null!=localStorage.getItem("Alternative"+o)&&null!=localStorage.getItem("Rect"+o)){var h=parseInt(localStorage.getItem("Alternative"+o)),d=new cl(l,c,h);if(d.bRedact=1==parseInt(localStorage.getItem("Alternative"+o)),d.pagenumber=hn.getcurPage(),d.viewname=hn.getcur3DView(),null==d.viewname?d.bfor3D=!1:(d.bfor3D=!0,d.pageheight=ai,d.pagewidth=ti),d.fillcolor=localStorage.getItem("fillcolor"+o),d.strokecolor=localStorage.getItem("strokecolor"+o),d.textcolor=localStorage.getItem("textcolor"+o),d.markercolor=localStorage.getItem("markercolor"+o),d.color=localStorage.getItem("Color"+o),d.dimtext=localStorage.getItem("DimText"+o),d.font.setFontname(localStorage.getItem("FontName"+o)),d.font.setHeight(localStorage.getItem("FontHeight"+o)),d.font.bold=1==parseInt(localStorage.getItem("bold"+o)),d.font.italic=1==parseInt(localStorage.getItem("italic"+o)),d.transparency=localStorage.getItem("Transparency"+o),d.rotation=localStorage.getItem("Rotation"+o),12==l&&(d.stampsmalltheight=localStorage.getItem("Stampsmalltheight"+o)),11==l){var p=new Image;d.markupcdataload(p,localStorage.getItem("image"+o))}null!=localStorage.getItem("LeaderOffset"+o)&&(d.leaderoffset=parseFloat(localStorage.getItem("LeaderOffset"+o))),null!=localStorage.getItem("LabelOffsetX"+o)&&(d.labeloffsetx=parseFloat(localStorage.getItem("LabelOffsetX"+o))),null!=localStorage.getItem("LabelOffsetY"+o)&&(d.labeloffsety=parseFloat(localStorage.getItem("LabelOffsetY"+o))),null!=localStorage.getItem("LabelColor"+o)&&(d.labelfillcolor=localStorage.getItem("LabelColor"+o)),null!=localStorage.getItem("Arrowlength"+o)&&(d.arrowlength=parseFloat(localStorage.getItem("Arrowlength"+o))),d.text=localStorage.getItem("Text"+o),d.dimtext=localStorage.getItem("DimText"+o),d.textwidth=parseFloat(localStorage.getItem("TextWidth"+o)),d.scaling=parseFloat(localStorage.getItem("Scaling"+o)),d.xoffset=parseFloat(localStorage.getItem("Xoffset"+o)),d.yoffset=parseFloat(localStorage.getItem("Yoffset"+o)),d.pageheight=parseFloat(localStorage.getItem("Pageheight"+o)),d.pagewidth=parseFloat(localStorage.getItem("Pagewidth"+o)),d.linewidth=parseInt(localStorage.getItem("LineWidth"+o)),d.outerRadius=parseInt(localStorage.getItem("OuterRadius"+o)),d.innerRadius=parseInt(localStorage.getItem("InnerRadius"+o));var u=localStorage.getItem("Rect"+o).split(" "),g=u[0].split("="),f=u[1].split("="),m=u[2].split("="),y=u[3].split("=");if(d.x=parseInt(g[1]),d.y=parseInt(f[1]),d.w=parseInt(m[1]),d.h=parseInt(y[1]),i){var v=.5*i.w,x=.5*i.h;v+=i.x,x+=i.y,s=d.x<v&&d.w<v?10:-10,r=d.y<x&&d.h<x?10:-10}var b=4==d.type&&0==d.subtype;if(3==d.type||b||5==d.type||9==d.type||10==d.type||11==d.type||12==d.type||20==NewMarkupObj.type?(d.x+=s,d.y+=r):(d.x+=s,d.y+=r,d.w+=s,d.h+=r),null!=localStorage.getItem("Points"+o)){var w=localStorage.getItem("Points"+o);d.points=JSON.parse(w);for(var k=0;k<d.points.length;k++)d.points[k].x+=s,d.points[k].y+=r}if(null!=localStorage.getItem("Countshapes"+o)){var D=localStorage.getItem("Countshapes"+o);for(d.countshapes=JSON.parse(D),k=0;k<d.countshapes.length;k++)d.countshapes[k].x+=s,d.countshapes[k].y+=r}if(null!=localStorage.getItem("Pointlist"+o)){w=localStorage.getItem("Pointlist"+o),d.pointlist=JSON.parse(w);var C=0,R=0;for(C=0;C<d.pointlist.length;C++)for(R=0;R<d.pointlist[C].length;R++)d.pointlist[C][R].x+=s,d.pointlist[C][R].y+=r}if(null!=localStorage.getItem("Sides"+o)){var P=localStorage.getItem("Sides"+o);d.sides=JSON.parse(P)}Us=hn.markuplist.length,d.savemetolistLoad(hn),d.display=!0,d.setfirstDraw(),t&&hn.markuplist[Us].setmultiValues(bi),hn.markuplist[Us].savemarkupstate(hn,2),Ms=!0,null!=$t&&$t.setMarkupSelected(hn.markuplist[Us],{created:!0,modified:!1,deleted:!1})}}}}}}(),Vl(n))},getBlockInsert:function(e){if(!yd()&&!mi){if(!e)return eu("markupedit",{p1:!1}),void kl();Dl(),eu("pickPolygon",{p1:!1,p2:!1,p3:!0,p4:!1,p5:!0})}},getVectorEntity:function(e){yd()||mi||(e?(Dl(),eu("pickPolygon",{p1:!1,p2:!1,p3:!0,p4:!0,p5:!1})):eu("markupedit",{p1:!1}))},pickPolygon:function(e,t){yd()||mi||(e?(Dl(),eu("pickPolygon",{p1:t,p2:!1,p3:!0,p4:!1,p5:!1})):eu("markupedit",{p1:!1}))},pickRxSpace:function(e,t){yd()||mi||(e?(Dl(),eu("pickPolygon",{p1:t,p2:!1,p3:!1,p4:!1})):eu("markupedit",{p1:!1}))},prevPage:function(){yd()||mi||(Dl(),bl(),hn.GotoPage(hn.currentpage-1),eu("markupedit",{p1:!1}))},print:function(){yd()||(parseInt(hn.getCurrentpage().height)>parseInt(hn.getCurrentpage().width)?(ss=210,rs=297):(ss=297,rs=210),il(),mi||(hn.checkprintready()?wh():hn.loadAllPages()))},printDoc:function(){return hn},printEx:function(e){if(!yd()){if(hn.getCurrentpage().height>hn.getCurrentpage().width)var t=210,a=297;else t=297,a=210;tp(0,{width:t,height:a})}},printSizeEx:function(e,t){if(!yd()){if(0==t.mode)if(hn.getCurrentpage().height>hn.getCurrentpage().width){if(t.width>t.height){var a=t.width;t.width=t.height,t.height=a}}else t.height>t.width&&(a=t.width,t.width=t.height,t.height=a);else 1==t.mode?t.width>t.height&&(a=t.width,t.width=t.height,t.height=a):2==t.mode&&t.height>t.width&&(a=t.width,t.width=t.height,t.height=a);tp(0,t)}},printhelper:uu,refreshThumbnails:function(){yd()||hn.refreshThumbnails()},redrawPage:function(e){yd()||gi&&null!=hn.getPageObject(e)&&hn.getPageObject(e).redraw()},redrawCurrentPage:function(){yd()||gi&&hn.getCurrentpage().redraw()},removeFloorplan:function(e){yd()||Hr||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().removefloorplan(e)},removeLastPoint:function(){cn.multipoint&&cn.started&&cn.removelastPoint()},reset3DModel:function(){yd()||hn.getCurrentpage().usevector3Dxml&&(hn.getCurrentpage().reset3DParts(),hn.getCurrentpage().Vector3DPageObj.active3DView=!1,hn.getCurrentpage().Vector3DPageObj.doexplode=!0,hn.getCurrentpage().Vector3DPageObj.newExplode(0),hn.getCurrentpage().Vector3DPageObj.doexplode=!1,hn.getCurrentpage().Vector3DPageObj.resetTransparency(),hn.getCurrentpage().Vector3DPageObj.clipping(-1,0,!1),hn.curcontrol3D="orbitControl",Cd(),Fd())},restoreStartCam:function(){yd()||gi&&hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.restorestartcam()},saveresetCam:Ed,setresetCam:Fd,resetBlocks:function(){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().resetBlocks()},resetLayers:function(){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().resetLayers()},restoreBlockStates:function(){yd()||(function(){var e=0;for(e=hn.markuplist.length;e>0;e--)null!=hn.markuplist[e-1]&&hn.markuplist[e-1].display&&hn.markuplist[e-1].pagenumber==hn.getcurPage()&&8==hn.markuplist[e-1].type&&1==hn.markuplist[e-1].subtype&&(hn.markuplist[e-1].alternative=0);Vl(n),Nl(a)}(),hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().restoreBlockStates())},restoreCamera:function(){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.restoreCamera()},restoreCameraByName:function(e){if(!yd()){var t=hn.getCurrentpage();t&&(t.usevector3Dxml&&t.unSelect3DmarkupAll(),t.usevector3Dxml&&t.restoreCameraByName(e))}},restoreDefault:Lp,reverseNavMouse:function(e){Zi=e},birdseyetool:function(){yd()||hn.getCurrentpage().usevector3Dxml||hn.setBirdseyeTool()},restoreMouseInput:function(){cn.anglelengthsupport&&cn.started&&"area"==cn.name&&cn.useMouseInput()},restrictPan:function(e){Bi=e},renderBirdseye:function(){yd()||hn.renderBirdsEye()},rotate:function(e,t){if(!yd()&&!yi)if(mi)dn.rotateimage(e,t);else if(e)switch(hn.getCurrentpage().getpageRotation()){case 0:hn.getCurrentpage().rotateimage(90);break;case 90:hn.getCurrentpage().rotateimage(180);break;case 270:hn.getCurrentpage().rotateimage(0);break;case 180:hn.getCurrentpage().rotateimage(270)}else"0"==t&&hn.getCurrentpage().rotateimage(0),"90"==t&&hn.getCurrentpage().rotateimage(90),"180"==t&&hn.getCurrentpage().rotateimage(180),"270"==t&&hn.getCurrentpage().rotateimage(270)},rotatePage:function(e,t){yd()||yi||(hn.getPageObject(e).rotateimage(t),0==e&&hn.getPageObject(e).redraw())},rotateThumbnail:function(e,t){yd()||hn.rotateThumbnail(e,t)},rotateClockwise:Xd,saveTop3DCamera:function(){if(!yd()){var e=hn.getCurrentpage();e&&e.usevector3Dxml&&e.Vector3DPageObj.saveResetCam()}},save3DCamera:Pd,find3DViewAttribute:function(e,t,a){if(!yd()){var i=hn.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.findViewAttribute(e,t,a)}},update3DViewAttribute:function(e,t,a){if(!yd()){var i=hn.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.updateViewAttribute(e,t,a)}},delete3DViewAttribute:function(e,t){if(!yd()){var a=hn.getCurrentpage();a&&a.usevector3Dxml&&a.Vector3DPageObj.deleteViewAttribute(e,t)}},get3DViewAttributes:function(e){if(!yd()){var t=hn.getCurrentpage(),a=void 0;return t&&t.usevector3Dxml&&(a=t.Vector3DPageObj.getViewAttributes(e)),a}},add3DViewAttribute:function(e,t,a){if(!yd()){var i=hn.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.addViewAttribute(e,t,a)}},get3DViewAttribute:function(e,t){if(!yd()){var a=hn.getCurrentpage();a&&a.usevector3Dxml&&a.Vector3DPageObj.getViewAttribute(e,t)}},savePDF:function(){yd()||hn&&null!=hn.foxitdoc&&hn.foxitdoc.savePDF()},scale:bp,elementScale:function(e){var t=Zd();t.isempty||null!=t.scaleObject&&(t.scaleObject.setMeasureScale(e),t.hasScale=!0,hn.bMarkupchanged=!0,null!=Qt&&Qt.setMarkupSelected(t,9))},setScaleLabel:wp,setElementScaleLabel:function(e){var t=Zd();t.isempty||null!=t.scaleObject&&(t.hasScale=!0,t.scaleObject.setScaleLabel(e),null!=Qt&&Qt.setMarkupSelected(t,9))},setElementDimPrecision:kp,resetToDefaultScaleValueForMarkup:function(e){for(var t=hn.markuplist,a=0;a<t.length;a++){var i=t[a];i.hasScale&&i.scaleObject.scaleLabel===e&&(i.scaleObject.resetToDefaultValue(),i.hasScale=!1)}hn.bMarkupchanged=!0,jd()},setElementDimPrecision:kp,scaleOnResize:function(e){Vi=e},select3D:function(e){Np(e,"select3d",{p1:0})},select3DMarkup:function(e){Np(e,"select3d",{p1:1})},search3dAttribute:function(e){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().search3DAttribute(e):void 0},search3dAttributes:function(e){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().search3DAttributes(e):void 0},search3dAttributesEx:function(e,t){return yd()?-1:hn.getCurrentpage().usevector3Dxml?t?hn.getCurrentpage().search3DAttributes(e):hn.getCurrentpage().search3DAttributesEx(e):void 0},select3DVectorBlock:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().select3DBlock(e,!0)},selectMarkUp:lp,SearchStoreyAttributes:function(e,t){return yd()?-1:hn.getCurrentpage().usevector3Dxml?hn.getCurrentpage().searchStoreyAttributes(e,t):void 0},selectMarkupbyGUID:function(e){if(!yd()){var t=hn.getmarkupbyGUID(e);-1==t||null==hn.markuplist[t].markupnumber?Yp(-1):Yp(hn.markuplist[t].markupnumber)}},selectMarkupbyGUIDs:function(e){yd()||fs&&(hn.selectmarkupbyGUIDs(e),Vl(n),Nl(a),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive))},select3DMarkUpByID:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().select3Dmarkup(e)},selectMarkUpByIndex:Yp,selectSymbName:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Libname")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","",t).then((function(e){var t={type:2,data:e};null!=Ht&&Ht.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("library name not returned error 404"):503==e.status?console.log("library name not returned error 503"):501==e.status&&console.log("library name not returned error 501"):console.log(e)}))}(e)},selectSymblib:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Selectlib")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Fh("POST",R+"?FormRequest","",t).then((function(t){var a={type:6,data:e};null!=Ht&&Ht.onSymbolReceived(a)})).catch((function(e){e.status?404==e.status?console.log("symbol data not returned error 404"):503==e.status?console.log("symbol data not returned error 503"):501==e.status&&console.log("symbol data not returned error 501"):console.log(e)}))}(e)},selectVectorBlock:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().selectBlock(e)},selectVectorBlockInsert:function(e,t){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().selectBlockInsert(e,t)},unselectAllBlocks:function(){yd()||kl()},selectRxSpace:function(e,t){yd()||mi||hn.getCurrentpage().usevector3Dxml||function(e,t){var i=[],s=[],r={isempty:!0},o=0,l=-1,c=Cl(e),h=null!=c;for(o=hn.markuplist.length;o>0;o--){if(h)var d=c.markupnumber==hn.markuplist[o-1].markupnumber;else d=!1;null==hn.markuplist[o-1]||d||8==hn.markuplist[o-1].type&&1==hn.markuplist[o-1].subtype&&(t&&hn.markuplist[o-1].spaceselected?(r={id:l=hn.markuplist[o-1].markupnumber,attr:i=hn.markuplist[o-1].GetAttributes(),isempty:!1},s.push(r)):(hn.markuplist[o-1].spaceselected=!1,hn.markuplist[o-1].linewidth=1))}h&&(l=c.markupnumber,c.spaceselected=!c.spaceselected,i=c.GetAttributes(),c.spaceselected?(c.linewidth=2,r={id:l,attr:i,isempty:!1},s.push(r)):c.linewidth=1),0!=s.length||c.spaceselected?dp(!0):dp(!1),t?null!=Et&&Et.set2DBlockID(s):null!=Et&&Et.set2DBlockID(r),Vl(n),Nl(a)}(e,t)},selectRxSpaceEdit:function(e){if(!yd()&&!mi&&!hn.getCurrentpage().usevector3Dxml){var t=Cl(e);if(null!=t){var i=t.selectedit;if(fs||hn.getMarkupMultiselected()||(Dl(),bl()),hn.getcurPage()!=t.pagenumber&&hn.GotoPage(t.pagenumber),i){t.selectedit=!1;var s=-1}else t.selectedit=!0,s=hn.getmarkupbynumber(t.markupnumber),null!=$t&&$t.setMarkupSelected(hn.markuplist[s],{created:!1,modified:!0,deleted:!1});Vl(n),Nl(a),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist())}}},set3DBlockDistance:function(e,t,a,i){yd()||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().set3DBlockDistance(e,t,a,i)},set3DBlockPosition:function(e,t,a){yd()||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().set3DBlockPosition(e,t,a)},set3DmodelcurFloor:function(e){yd()||hn.setbirdseyefloor(e)},setActiveFile:Dd,setActiveFileEx:function(e){new Promise((function(e,t){Ke.connect((function(t){for(var a=!1,i=0;i<yn.length;i++)yn[i].bRenderinProgress&&(a=!0);a||e(t)}));for(var a=0;a<yn.length;a++)yn[a].checkRender()})).then(Dd(e))},setAreaPerimeter:function(e){yd()||Hr||yl(e?16:17)},setArrowSize:function(e){var t=er;er=e,yd()||Hr||(yl(10),zr||(er=t))},setTextheightFactor:function(e){pr=e},setTopOffsetFactor:function(e){ur=e},setLeftOffsetFactor:function(e){gr=e},setAuthorization:function(e,t){_r=!0,Wr=!0,Yr=e,Xr=t},set3DViewSelectedMesh:function(e){if(!yd()){var t=hn.getCurrentpage();t&&t.usevector3Dxml&&t.set3DViewSelectedMesh(e)}},setMarkupMarkedColor:function(e){hs=e},setBirdseyeFloor:function(e){yd()||hn.setbirdseyefloor(e)},setBlockColor:wd,setBlockFill:function(e,t,a){if(!yd()&&!mi){var i=Io(t);if("hatch"==i)bd(e,t,a);else if("color"==i){var s=jo(t);Fo(t,a),wd(e,s,a)}}},setBlockHatch:bd,setCalibration:function(e){yd()||hn.getCurrentpage().setCalibrateScale(e)},setCompareFiles:function(e,t){if(null!=e){xn.length<e+1||0==xn.length?kd().length>e&&(xn[e].state=t):xn[e].state=t;for(var a=0;a<xn.length;a++)xn[a].state==t&&a!=e&&(xn[a].state=0);null!=pa&&pa.CompareDialog()}},setCompareColors:function(e,t){if(!yd()){Rs=e,Ps=t;var a=Ud();null!=a&&a.setColors(e,t)}},changeSpaceCustomLabel:function(e,t){if(!yd()&&!mi&&!hn.getCurrentpage().usevector3Dxml){var i=Cl(e);i&&i.busecustomlabel&&(i.customlabeltext=t),Vl(n),Nl(a)}},setCompareScale:function(e){if(!yd()){Dl(),bl();var t=Ud();null!=t&&t.setcomparescale(e)}},setConfiguration:function(e){re=e,pe=!0},setJSONConfiguration:function(e){ne=!0,oe=e},setCustomLabelText:function(e,t){if(!yd()&&!Hr){var i=gl();i.isempty||(i.customlabeltext=e,i.busecustomlabel=t),Vl(n),Nl(a)}},setDimOffset:function(e){if(!yd()&&!Hr){var t=gl();t.isempty||7!=t.type||(t.leaderoffset=e),Vl(n),Nl(a)}},setFoxitSnap:function(e){Fi=e},useFoxitRotateTo:function(e){},setinitFile:Ld,ScrollFoxitDiv:function(){yd()||hn.ScrollFoxitDiv()},setcollabBlock:np,setdisplayBackground:function(e){xs=e,yd()||(hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().draw_vector(!0),Vl(n))},setdisplay:function(e){yd()||Hr||function(e){var t=0;for(t=0;t<hn.markuplist.length;t++)(hn.markuplist[t].selected||hn.markuplist[t].selectedit)&&(e?hn.markuplist[t].show():hn.markuplist[t].hide());Vl(n),Nl(a)}(e)},setcollabBlock:np,setFont:function(e){var t=Pn.fontName;Pn.setFontname(e),yd()||Hr||(yl(4),zr||Pn.setFontname(t))},setFontFull:function(e){var t={name:Pn.fontName,size:Pn.height,bold:Pn.bold,italic:Pn.italic};Pn.setFontname(e.font),Pn.setHeight(e.size),Pn.setBold(e.style.bold),Pn.setItalic(e.style.italic),yd()||Hr||(yl(4),zr||(Pn.setFontname(t.name),Pn.setHeight(t.size),Pn.setBold(t.bold),Pn.setItalic(t.italic)))},setFontBold:function(e){var t=Pn.bold;Pn.setBold(e),yd()||Hr||(yl(4),zr||Pn.setBold(t))},setFontHeight:function(e){var t=Pn.height;Pn.setHeight(e),yd()||Hr||(yl(4),zr||Pn.setHeight(t))},setFontItalic:function(e){var t=Pn.italic;Pn.setItalic(e),yd()||Hr||(yl(4),zr||Pn.setItalic(t))},setGlobalStyle:function(e){zr=e},setGUIDMarkupSelected:function(){if(!yd()&&!Hr){var e=gl();e.isempty||e.setRxUniqueID()}},setHatch:To,addFill:function(e,t,a,i,s,r){"color"==e?Mo(t,s,r):"hatch"==e&&To(a,t,i,s,r)},addHatch:To,addColorFill:Mo,setHatchDescription:function(e,t){for(var a=0;a<Cr.length;a++)if(e==Cr[a].name){Cr[a].description=t;break}},setCameraTumbWidth:function(e){rr=e},setCountSize:function(e){var t=sr;sr=e,yd()||Hr||(yl(13),zr||(sr=t))},setCountSizeAll:function(e){var t=sr;sr=e,yd()||Hr||(yl(13,!0),zr||(sr=t))},setLabelSize:function(e){var t=ir;ir=e,yd()||Hr||(yl(11),zr||(ir=t))},setLabelSizeAll:function(e){var t=ir;ir=e,yd()||Hr||(yl(11,!0),zr||(ir=t))},setRotateOffsetbirdseye:function(e,t){},setPageRect:function(e){if(yd())return;const t=hn.getCurrentpage();t&&t.setpagerect(e.x,e.y,e.w,e.h,!0)},setLargePDFpageLimit:function(e){ks=e},setLayout:function(e,t,a){null!=e&&(Pe.offsetWidth=e),null!=t&&(Pe.offsetHeight=t),null!=a&&(Pe.absolute=a)},setLineStyle:function(e){var t=Vr;Vr=e,yd()||Hr||(yl(9),zr||(jr=t))},setLineWidth:function(e){var t=jr;jr=e,yd()||Hr||(yl(2),zr||(jr=t))},setLineWidthAll:function(e){var t=jr;jr=e,yd()||Hr||(yl(2,!0),zr||(jr=t))},setLineWidthMarkup:function(e,t){var a=jr;jr=t,yd()||Hr||(ml(e,2),zr||(jr=a))},setLineWidthUnits:function(e,t){var a=jr,i=hn.getCurrentpage().fixedScale;jr=Zo(e),jr*=i,yd()||Hr||(yl(2),zr||(jr=a))},setSegmentLineWidthUnits:function(e){var t=Ar,a=hn.getCurrentpage().fixedScale;Ar=Zo(e),Ar*=a,yd()||Hr||(yl(19),zr||(Ar=t))},setMarkupLayer:function(e){yd()||mi||(Rr=e,Pr=Dr[e].Color,Mr=Pr,Tr=Pr)},setmarkupRxGUID:function(){var e=0;for(e=0;e<hn.markuplist.length;e++)if(null!=hn.markuplist[e]&&!hn.markuplist[e].isempty)if("0"==hn.markuplist[e].getUniqueID())hn.markuplist[e].setRxUniqueID();else{var t=hn.markuplist[e].getUniqueID();8==hn.markuplist[e].type&&1==hn.markuplist[e].subtype&&hn.markuplist[e].updateAttribute("SpaceID",t)}},setMarkupSearchPadding:function(e){Ee.x=e.x,Ee.y=e.y,Ee.w=e.w,Ee.h=e.h},setMarkupXMLData:function(e){yd()||mi||function(e){var t=0,a=XMLParser(e);if(null!=a.getElementsByTagName("FileVersion")&&0!=a.getElementsByTagName("FileVersion").length)var i=a.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=a.getElementsByTagName("User")&&0!=a.getElementsByTagName("User").length){var s=a.getElementsByTagName("User");for(t=0;t<s.length;t++){var r=s[t].getElementsByTagName("Name")[0].firstChild.nodeValue,o=s[t].getElementsByTagName("ID")[0].firstChild.nodeValue;if(null!=s[t].getElementsByTagName("Layer")[0])var l=s[t].getElementsByTagName("Layer")[0].firstChild.nodeValue;else l=Rr;if(null!=s[t].getElementsByTagName("Color")[0])var c=s[t].getElementsByTagName("Color")[0].firstChild.nodeValue;else c=Pr;wr[0].Signature==o||wr.push(new qn(o,r,l,c,!1))}}else if(null!=a.getElementsByTagName("Name")){var h=a.getElementsByTagName("Name");wr[0].Signature!=h[0].firstChild.nodeValue&&wr.push(new qn(h[0].firstChild.nodeValue,h[0].firstChild.nodeValue,Rr,Pr,!1))}if(null!=a.getElementsByTagName("Entity")){var d=a.getElementsByTagName("Entity");for(t=0;t<d.length;t++){var p=d[t].getElementsByTagName("Type")[0].firstChild.nodeValue,u=d[t].getElementsByTagName("Subtype")[0].firstChild.nodeValue,g=d[t].getElementsByTagName("Alternative")[0].firstChild.nodeValue,f=d[t].getAttribute("ID")?d[t].getAttribute("ID"):null;if(null!=d[t].getElementsByTagName("HaveLeader")[0])var m=1==parseInt(d[t].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(m&&null!=d[t].getElementsByTagName("Entity")[0]){var y=d[t].getElementsByTagName("Entity")[0],v=y.getElementsByTagName("Type")[0].firstChild.nodeValue,x=y.getElementsByTagName("Subtype")[0].firstChild.nodeValue,b=y.getElementsByTagName("Alternative")[0].firstChild.nodeValue;y.getAttribute("ID")&&y.getAttribute("ID"),v=parseInt(v),x=parseInt(x),b=parseInt(b);var w=new cl(v,x,b),k=w.SetfromXML(hn,y,i);k&&(d[t].removeChild(y),w.savemetolistLoad(hn,!1))}p=parseInt(p),u=parseInt(u),g=parseInt(g);var D=new cl(p,u,g);D.markupID=f,D.SetfromXML(hn,d[t],i)&&(k&&m&&null!=w&&(D.bhasArrow=m,D.markupArrowConnected=w,w.bisTextArrow=!0,w.textBoxConnected=D,w.setArrowPoint(D),k=!1,m=!1),D.savemetolistLoad(hn))}D&&D.notify(),0==d.length&&null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n)}}(e)},setMonoChrome:function(e){yd()||mi||yi||(hn.getCurrentpage().usevectorxml&&(ep(e),hn.refreshBirdsEye(),hn.renderBirdsEye()),Vl(n))},setpageAs3DNavigator:function(e,t){yd()||yn[e.docindex].pages[e.pageindex]&&yn[e.docindex].pages[e.pageindex].setAs3DNavigator(t,e.floorindex)},draw3DBirdseye:function(){yd()||hn.getCurrentpage().bis3Dnavigator&&hn.getCurrentpage().drawcamerapos()},drawFoxitAnnotation:function(e){Ki=e},setnavigationScaleOffset:function(e,t,a){yd()||null!=e&&null!=t&&yn[e].pages[0].usevector3DGLTF&&yn[e].setFloorNavScaleOffset(t,a)},setnavScaleOffsetPage:function(e){yd()||hn.getCurrentpage().setFloorNavScaleOffset(e)},get3DmodelboxCenter:function(e){var t=null;return yd()||yn[e].pages[0].usevector3DGLTF&&(t=yn[e].pages[0].Vector3DPageObj.boxCenter),t},set3dNavcameraPos:function(e,t,a){yd()||a&&hn.setpagecamerapos(e,t,a)},setPageInfoDim:function(e){yd()||hn&&hn.getpageinfodim(e)},setPageDimensions:function(e,t,a,i,s){yd()||hn.setPageDim(e,t,a,i,s)},setPDFAnimateRender:function(e){zi=e},setPDFinitalZoomAll:function(e){},setPDFLayers:function(e){yd()||gi&&hn.setPDFLayers(e)},setPDFBookmarks:function(e){yd()||gi&&hn.setPDFBookmarks(e)},getPDFBookmarks:function(){yd()||gi&&hn.getPDFBookmarks()},setrxprintdiv:function(e){De=e},setRxSpaceColor:function(e,t,a){yd()||mi||Rl(e,t,a)},setscrollZoomKey:function(e,t){As=e,bs=t},singlePageScrollPan:function(e){Os=e},setSingleDocument:function(e){Li=e},setSpaceID:function(e){!function(e,t){var a=0;for(a=0;a<hn.markuplist.length;a++)(hn.markuplist[a].selected||hn.markuplist[a].selectedit)&&8==hn.markuplist[a].type&&1==hn.markuplist[a].subtype&&hn.markuplist[a].updateAttribute(e,t)}("SpaceID",e.toString())},setText:function(e){Yt.setText(e)},setUnit:gp,setElementUnit:function(e){var t=Zd();t.isempty||t.scaleObject.setUnit(e)},setVectorBlockArea:function(e,t,a){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().setVectorBlockArea(e,t,a)},showMarkupLabels:function(e){Xi=e,Wi=e},show3DViewMarkers:function(e){if(!yd()){var t=hn.getCurrentpage();t&&t.usevector3Dxml&&t.show3DViewMarker(e)}},spaceEdit:function(){yd()||hn.getCurrentpage().usevector3Dxml||eu("markupedit",{p1:!0})},suspendDraw:function(e){if(!yd()&&(Ni=e,!e)){var t=hn.getcurPage();if(null==hn.getPageObject(t))return;hn.getPageObject(t).redraw()}},switchPages:function(e,i,r){null!=la&&la.setDownload("show"),he=!1,function(e,i,r){var o;null!=ja&&(ja.hastext=!1,ja.hasText(ja.hastext,!0)),_o(e),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),s.clearRect(0,0,t.width,t.height);var l='<?xml version="1.0" encoding="UTF-8"?>';l+="<RxViewServer>",l+="<Command>GetFile</Command>",l+="<LicenseID>"+os+"</LicenseID>",l+="<FileURL>"+e+"</FileURL>",Eh("POST",C,l+="</RxViewServer>",[{event:"callback",func:r}]).then((function(e){var t,a=0;null!=la&&la.setDownload("hide");var s=0,r=0;if(null!=hn&&null!=hn){hn.closePages(!1);var n=Wo(hn.OriginalURL),l=e.getElementsByTagName("Layout");for(t=0;t<l.length;t++){var c=l[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue,h=l[t].getElementsByTagName("Page");for(a=0;a<h.length;a++)0==a&&0==t?i.indexOf(a)>=0&&(o=new Sc(h[a],c,!1,n,a,hn),hn.addthumbnail(new bc(h[a],c,hn,a)),hn.addpage(o,!0),r++):i.indexOf(a)>=0&&(0==r?(o=new Sc(h[a],c,!1,n,a+s,hn),hn.addthumbnail(new bc(h[a],c,hn,a+s)),hn.addpage(o,!0),r++):(o=new Sc(h[a],c,!1,"",a+s,hn),hn.addthumbnail(new bc(h[a],c,hn,a+s)),hn.addpage(o,!1),r++));s+=a}if(md()){o.usepdfjs&&hn.loadPDFpages(),null!=ht&&ht.setThumbnails(hn.thumbnails);var d={iscompare:mi,numOpenFiles:yn.length,isPDF:hn.getCurrentpage().usepdfjs,is3D:hn.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:hn.getCurrentpage().usevectorxml,numpages:hn.pages.length,currentpage:hn.getcurPage(),activefile:hn.bActive,source:"switchdocpages"};null!=Jt&&Jt.setGUIState(d);var p={numpages:hn.pages.length,currentpage:hn.getcurPage()};null!=Kt&&Kt.pageEvent(p)}}})).catch((function(e){gd("switchDocPages",e)}))}(e,i,r)},textSearch:function(e,t,a){yd()||mi||hn.textsearch(e,t,a)},markupTextSearch:function(e,t,a,i){yd()||mi||hn.markupTextSearch(e,t,a,i)},textSelect:function(e){yd()||mi||hn.enableTextSelect(e)},toggle3DVisible:function(e){Np(e,"hide3d",null)},toggleBackground:function(e){yd()||yi||(hn.getCurrentpage().usepdfjs?hn.backgroundColor="#FFFFFF":gs?hn.backgroundColor==us?hn.backgroundColor="#A0A0A0":"#A0A0A0"==hn.backgroundColor?hn.backgroundColor="#FFFFFF":"#FFFFFF"==hn.backgroundColor?hn.backgroundColor="#000000":"#000000"==hn.backgroundColor&&(hn.backgroundColor=us,e&&(Ai=!Ai)):"#A0A0A0"==hn.backgroundColor?hn.backgroundColor="#FFFFFF":"#FFFFFF"==hn.backgroundColor?hn.backgroundColor="#000000":"#000000"==hn.backgroundColor&&(hn.backgroundColor="#A0A0A0",e&&(Ai=!Ai)),hn.getCurrentpage().usevectorxml&&("#FFFFFF"!=hn.backgroundColor&&"#000000"!=hn.backgroundColor||hn.getCurrentpage().invert_images(hn.backgroundColor),hn.getCurrentpage().draw_vector(!0),hn.refreshBirdsEye(),hn.renderBirdsEye()),Vl(n),null!=Pa&&Pa.backgroundColorChange(hn.backgroundColor))},transparency3D:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.setTransparency(e)},transparency3DEx:function(e){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.setTransparencyEx(e)},unSelectAllMarkup:function(){yd()||(Dl(),bl(),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive))},unSelectMarkupbyGUID:function(e){if(!yd()){var t=hn.getmarkupbyGUID(e);-1!=t&&Hp(hn.markuplist[t].markupnumber)}},unSelectMarkupbyGUIDs:function(e){yd()||(hn.unselectmarkupbyGUIDs(e),null!=Nt&&Nt.setMarkupList(hn.getmarkuplist(),hn.bActive),Vl(n),Nl(a))},unSelectMarkupbyIndex:Hp,uploadSignature:function(e,t,a){if(null!=V&&(!a||null!=B)){var i=V+"&"+t;a&&(i=B+"&"+t);var s=zn(e);Fh("POST",i,"",s).then((function(e){null!=Ve&&Ve.oncomplete(t,a)})).catch((function(e){e.status?console.log("uploadSignature",e.status):console.log("uploadSignature",e)}))}},useCompanyFeature:function(e){Ci=!0,ci=e},useCredentials:function(e){ji=e},useFixedScale:function(e){Mi=e},useMarkupscaling:function(e){Di=e},usesharepointmarkup:function(e){lr=e},usedbmarkup:function(e){cr=e},useNoScale:function(e){Ti=e},useFraction:function(e){mr=e},useOrtho:function(e,t){Vs=e,Bs=t},userFromLocalStorage:function(){var e=void 0,t=void 0;return"undefined"!=typeof Storage&&(null!=localStorage.getItem("User")&&(e=localStorage.getItem("User")),null!=localStorage.getItem("UserName")&&(t=localStorage.getItem("UserName"))),{user:e,displayname:t}},userToLocalStorage:ch,vectorBlocksAll:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().turnBlockAllOnOff(e)},vectorLayersAll:function(e){yd()||hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().turnLayerAllOnOff(e)},getlayerlist:Md,viewMode:ep,walkThrough3D:Rd,xmlurl:function(e){Ii=!1,Eh("GET",e).then((function(e){e.getElementsByTagName("IMAGE_INFO");for(var t=e.getElementsByTagName("URL")[0].firstChild.nodeValue,a=e.getElementsByTagName("MARKUP_URL"),i=(e.getElementsByTagName("USER_MARKUPPOSTURL"),0);i<a.length;i++)yr[i]=a[i].firstChild.nodeValue;nr=!0,null!=la&&la.setDownload("show"),zc({filename:t,displayname:null})})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},xmlurlEx:function(e){Ii=!1,Eh("GET",e).then((function(e){e.getElementsByTagName("IMAGE_INFO");for(var t=e.getElementsByTagName("URL")[0].firstChild.nodeValue,a=e.getElementsByTagName("MARKUP_URL"),i=(e.getElementsByTagName("USER_MARKUPPOSTURL"),0);i<a.length;i++)yr[i]=a[i].firstChild.nodeValue;or=!0,null!=la&&la.setDownload("show"),zc({filename:t,displayname:null})})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},zoomToBlock:function(e){if(!yd()&&!mi&&!hn.getCurrentpage().usevector3Dxml){var t=Cl(e);t?hn.getCurrentpage().MarkupZoombyMarkup(t):hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().ZoomToBlock(e)}},zoomToBlockInsert:function(e){if(!yd()&&!mi&&!hn.getCurrentpage().usevector3Dxml){var t=Cl(e);t?hn.getCurrentpage().MarkupZoombyMarkup(t):hn.getCurrentpage().usevectorxml&&hn.getCurrentpage().ZoomToBlockInsert(e)}},zoomFit:function(){yd()||hn.getCurrentpage().usevector3Dxml||yi||(mi?dn.zoomall():hn.getCurrentpage().zoomall())},zoomHeight:function(){yd()||hn.getCurrentpage().usevector3Dxml||yi||(mi?dn.zoomheight():hn.getCurrentpage().zoomheight())},zoomWidth:function(){yd()||hn.getCurrentpage().usevector3Dxml||yi||(mi?dn.zoomwidth():hn.getCurrentpage().zoomwidth())},zoomIn:function(){yd()||hn.getCurrentpage().usevector3Dxml||yi||(mi?dn.ZoomIn(1.1,!1,!1):hn.getCurrentpage().ZoomIn(1.1,!1,!1))},zoomOut:function(){var e,t,a,i,s;yd()||hn.getCurrentpage().usevector3Dxml||yi||(mi?dn.ZoomOut(1.1,!1,!1):(e=1.1,t=!0,a=hn.getCurrentpage().getpagedim(),i=ti-30,s=ai-30,hn.getCurrentpage().usepdfjs&&(i=ii-30,s=si-30),a.w/e<i&&a.h/e<s&&(t=!1),Ui||(t=!0),t&&hn.getCurrentpage().ZoomOut(1.1,!1,!1)))},zoomPageUpdate:function(e,t){yd()||hn.getCurrentpage().usevector3Dxml||hn.getCurrentpage().ZoomPageUpdate(e,t)},zoomWindow:function(e){yd()||hn.getCurrentpage().usevector3Dxml||yi||(Dl(),bl(),e?eu("zoomwindow",{p1:!1,p2:!1}):eu("markupedit",{p1:!1}))},scrollBarCheck:function(){yd()||hn&&hn.ScrollBarCheck()},setRxResize:function(e){yd()||hn&&null!=hn.foxitdoc&&hn.foxitdoc.setRxResize(e)},setEndPoints:function(e,t,a,i,s){P=e,E=t,_=a,Z=i,ce=s,Ri=!0},setMarkUpHatch:function(e){if(!yd()&&!Hr&&!mi){var t=Or;Or=e,yl(3),zr||(Or=t)}},setBirdseyeCanvas:function(e,t,a){if(!yd()){var i=hn.getThumb(hn.currentpage);null!=i&&i.setGUIbirdseyeCnv(e,t,a)}},setdimPrecision:function(e){be=e},setDimPrecisionForPage:Gp,usePanToMarkup:function(e){ms=e},usePentableUpload:function(){ni=!0},useConvertUpload:function(){oi=!0},setNoteText:function(e){Zt.setText(e)},setTextInputText:function(e){return qt.setText(e)},getTextMarkup:function(){return qt.getText()},getTextInputText:function(){return qt.getText().text},setThumbnailctx:function(e,t){yd()||(hn.thumbnails[t].thumbctx=e)},setThumbnailSize:function(e,t){as=e,is=t},setBirdsEyeFoxit:function(e,t){yd()||hn.thumbnails[t].foxitcreateBirdseye(e)},setPageBitmap:function(e,t){yd()||(mi?dn.setPageBitmap(e,t):hn.setPageBitmap(e,t))},setThumbnailFoxit:function(e,t){yd()||hn.thumbnails[t].foxitcreatethumb(e)},getBirdseyeDim:function(e,t,a){if(!yd())return hn.thumbnails[e].getBirdseyeDim(t,a)},setUser:function(e,t){if(Ur){if(Dl(),bl(),""==e)return void function(){for(var e=Fr,t=Ir,a=0;a<wr.length;a++)wr[a].default&&(e=wr[a].Signature,t=wr[a].DisplayName);Fr=e,Ir=t}();Fr=e,""!=t&&(Ir=t);for(var a=!1,i=0,s=0;s<wr.length;s++)wr[s].Signature==e&&(a=!0,i=s);a?(Fr=wr[i].Signature,Ir=wr[i].DisplayName):wr.push(new qn(Fr,Ir,Rr,Pr,!1)),null!=je&&je.setUserlist(wr,!0)}},transparent3DOn:function(){yd()||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().Vector3DPageObj.setTransparency(.5)},set3DBlockTransparency:function(e,t,a){yd()||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().set3DBlockTransparency(e,t,a)},set3DBlockNoSelect:function(e,t){yd()||mi||hn.getCurrentpage().usevector3Dxml&&hn.getCurrentpage().set3DBlockNoSelect(e,t)},zoomMarkup:function(e,t,a){yd()||mi||hn.getCurrentpage().SetMarkupZoom(e,t,a)},GUI_DocumentSearch:La,GUI_RemovePage:x,GUI_PageCountChanged:Va,GUI_ActivateFile:Ie,GUI_2DBlockID:Et,GUI_2DBlock:Ot,GUI_2DBlockUnselectAll:Vt,GUI_2DBlockHover:Lt,GUI_2DBlockInfo:Ft,GUI_2DBlockInfoPos:It,GUI_2DEntityInfoScreen:jt,GUI_2DEntityInfo:At,GUI_3DCameraSave:Ct,GUI_3DPartInfo:Rt,GUI_3DPartState:Pt,GUI_3DMarkupInfo:St,GUI_3DMarkup:Tt,GUI_3DCameraSaves:f,GUI_3DParts:kt,GUI_3DWalkthrough:da,GUI_3DView:rt,GUI_Calibratediag:Wt,GUI_CalibrateComplete:Xt,GUI_CameraPos:na,GUI_CanSaveTop3DView:Ye,GUI_CreationComplete:$e,GUI_ContextMenuEvt:ua,GUI_UpdatebirdsEye:oa,GUI_CompareDiag:pa,GUI_Nav3DreplaceDiag:ga,GUI_compareLoadComplete:Xe,GUI_CompareMeasure:Xa,GUI_CompareAlign:fa,GUI_Consolidate:ma,GUI_ConsolidateMarkup:ya,GUI_Download:la,GUI_exportComplete:Ge,GUI_Servercompare:ze,GUI_FileInfo:He,GUI_FileLoadComplete:_e,GUI_fileLoadError:p,GUI_search3Denabled:We,GUI_FileActivated:u,GUI_floorLoadComplete:Qe,GUI_3DNavPosition:st,GUI_floorlevel:et,GUI_getResponsHeaders:Za,GUI_HasText:ja,GUI_MarkupHover:Ue,GUI_Markup:$t,GUI_MarkupChanged:Qt,GUI_MarkupDrawValue:ia,GUI_MarkupIndex:ea,GUI_MarkupLayers:Be,GUI_MarkupLink:ta,GUI_Markuplist:Nt,GUI_MarkuplistJSON:Bt,GUI_FoxitAnnotlist:Ut,GUI_3DMarkupList:Mt,GUI_MarkupLoadComplete:tt,GUI_foxitmarkupLoadComplete:it,GUI_markupdrawParams:Ya,GUI_markupParamsError:qa,GUI_MarkupAreaEdit:b,GUI_inputEvent:Ua,GUI_HatchChange:Aa,GUI_MarkupSave:Ra,GUI_MarkupPaths:Ma,GUI_MarkupUnselect:aa,GUI_Measurediag:_t,GUI_Notediag:Zt,GUI_NumMathces:Oa,GUI_NumMathcesMarkup:Na,GUI_NumMathcesRect:Ba,GUI_MathcesRectsPage:Ga,GUI_pageLoadComplete:nt,GUI_scaleListLoadComplete:ot,GUI_pagedimLoadComplete:mt,GUI_pagethumbs:ht,GUI_pagethumb:dt,GUI_pageScale:pt,GUI_floorthumb:ut,GUI_FloorplanCanvas:gt,GUI_birdseye:ft,GUI_PagePosition:m,GUI_Page:Kt,GUI_PanUpdate:ba,GUI_PanUpdated:wa,GUI_PDFBookmarks:xa,GUI_PDFRenderComplete:g,GUI_PDFPassWord:ct,GUI_Permissions:va,GUI_TextCopied:ka,GUI_PrintRect:Ia,onPrintProgress:Ha,onPrintComplete:_a,GUI_ClipRect:v,GUI_Read3DComplete:Dt,GUI_Ready:Ta,GUI_FoxitReady:Ea,GUI_RotatePage:Fa,GUI_RotateDocument:y,GUI_Resize:ca,GUI_Resize_ext:ha,GUI_Stamps:Gt,GUI_CustomStamps:zt,GUI_State:Jt,GUI_Symbols:Ht,GUI_Textdiag:Yt,GUI_TextInput:qt,GUI_Upload:sa,GUI_UploadComplete:ra,GUI_UndoRedoEmpty:Je,GUI_Users:je,GUI_penTable:Ae,GUI_penTableJSON:Oe,GUI_getsignatureComplete:Le,GUI_putsignatureComplete:Ve,GUI_VectorBlocks:xt,GUI_VectorBlocksLoaded:bt,GUI_VectorLayers:yt,GUI_VectorLayerVisibilityChange:vt,GUI_VectorBlockVisibilityChange:wt,GUI_ZoomUpdate:Da,GUI_ZoomUpdated:Ca,GUI_BackgroundColorChanged:Pa,GUI_ViewModeChanged:Sa,GUI_MarkupMeasureRealTimeData:Ja}},RxCore=RxCoreMulti();