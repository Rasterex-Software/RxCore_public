var RxCoreMulti=RxCore=function(){"use strict";var e,t,a,i,r,s,n,o,l,c,h,u,d=RxConfig.baseURLBinWeb,p=RxConfig.xmlurl,g=RxConfig.xmlurldirect,m=RxConfig.xmlurlmarkup,f=(RxConfig.opensessionurl,RxConfig.openMsessionurl,RxConfig.openUsessionurlEx),y=RxConfig.openUsessionurl,v=RxConfig.closesessionurl,b=RxConfig.xmlurlmarkupsave,x=RxConfig.serverComparefiles,w=(RxConfig.markupsave,RxConfig.savefile),k=RxConfig.FileuploadURL,D=RxConfig.websocketURL,C=RxConfig.PenTableUpload,P=RxConfig.putSignature,S=RxConfig.getSignature,R=RxConfig.putInitial,M=RxConfig.getInitial,T=RxConfig.PenTableFile,E=RxConfig.serverJSONcommand,F=RxConfig.ConvertUpload,I=!0,j=RxConfig.PDFExportURL,O=RxConfig.PDFExportPageURL,L=(E=RxConfig.serverJSONcommand,RxConfig.PDFPrintPrepare),V=RxConfig.PDFPrintCreate,N=RxConfig.CanvasSaveUrl,A=RxConfig.UploadServerfolder,B=RxConfig.UploadServerfolderd,U=RxConfig.xmlurlrel,G=RxConfig.xmlurlrelmarkup,H=(RxConfig.uploadfolderURL,RxConfig.htmlviewerurl),z=RxConfig.splashscreen,W=RxConfig.noteImgSrc,_=RxConfig.bGetconfig,X=RxConfig.bUseID,Y=RxConfig.configurationLocation,q=!1,Z=null,J=!1,K="",Q=!1,$=!1,ee=!1,te=null,ae="",ie=!1,re=!1,se=!1,ne=3,oe=window.devicePixelRatio,le=!1,ce=void 0;new OffscreenCanvas(256,256).getContext("2d");var he,ue,de,pe,ge,me=void 0,fe=null,ye=Object.freeze([]),ve={offsetWidth:0,offsetHeight:0,absolute:!1},be={width:225,height:150},xe=1920,we=1080,ke={x:50,y:50,w:50,h:100},De=void 0,Ce=void 0,Pe=void 0,Se=void 0,Re=void 0,Me=void 0,Te=void 0,Ee=void 0,Fe=void 0,Ie=void 0,je=void 0,Oe=void 0,Le=void 0,Ve=void 0,Ne=void 0,Ae=void 0,Be=void 0,Ue=void 0,Ge=void 0,He=void 0,ze=void 0,We=void 0,_e=void 0,Xe=void 0,Ye=void 0,qe=void 0,Ze=void 0,Je=void 0,Ke=void 0,Qe=void 0,$e=void 0,et=void 0,tt=void 0,at=void 0,it=void 0,rt=void 0,st=void 0,nt=void 0,ot=void 0,lt=void 0,ct=void 0,ht=void 0,ut=void 0,dt=void 0,pt=void 0,gt=void 0,mt=void 0,ft=void 0,yt=void 0,vt=void 0,bt=void 0,xt=void 0,wt=void 0,kt=void 0,Dt=void 0,Ct=void 0,Pt=void 0,St=void 0,Rt=void 0,Mt=void 0,Tt=void 0,Et=void 0,Ft=void 0,It=void 0,jt=void 0,Ot=void 0,Lt=void 0,Vt=void 0,Nt=void 0,At=void 0,Bt=void 0,Ut=void 0,Gt=void 0,Ht=void 0,zt=void($e=void 0),Wt=void 0,_t=void 0,Xt=void 0,Yt=void 0,qt=void 0,Zt=void 0,Jt=void 0,Kt=void 0,Qt=void 0,$t=void 0,ea=void 0,ta=void 0,aa=void 0,ia=void 0,ra=void 0,sa=void 0,na=void 0,oa=void 0,la=void 0,ca=void 0,ha=void 0,ua=void 0,da=void 0,pa=void 0,ga=void 0,ma=void 0,fa=void 0,ya=void 0,va=void 0,ba=void 0,xa=void 0,wa=void 0,ka=void 0,Da=void 0,Ca=void 0,Pa=void 0,Sa=void 0,Ra=void 0,Ma=void 0,Ta=void 0,Ea=void 0,Fa=void 0,Ia=void 0,ja=!0,Oa=.5,La=!0,Va=!1,Na=0,Aa=0,Ba=0,Ua=0,Ga=!1,Ha=!1,za=!1,Wa="initial",_a="",Xa="",Ya=0,qa=0,Za=1.5,Ja=!1,Ka=!1,Qa=!1,$a=!1,ei=!1,ti=!1,ai=0,ii=0,ri=!1,si=!1,ni=!1,oi=!1,li=!1,ci=!0,hi=!0,ui=!0,di=!1,pi=!1,gi=!0,mi=!1,fi=!1,yi=!1,vi=!1,bi=!1,xi=!0,wi=!1,ki=!1,Di=!0,Ci=!0,Pi=!0,Si=!1,Ri=!1,Mi=!0,Ti=!1,Ei=!1,Fi=!0,Ii=!1,ji=!1,Oi=!1,Li=[],Vi=[],Ni=[],Ai=[],Bi=!0,Ui=180,Gi=250,Hi=100,zi=100,Wi=void 0,_i="",Xi="",Yi="#FFFFFF",qi="rgba(236, 236, 236, 0.5)",Zi="rgba(0, 0, 0, 1)",Ji=2,Ki="#FF0000",Qi=!1,$i=!1,er=!1,tr=!1,ar=!0,ir="rgb(62,62,62)",rr=17,sr=64e6,nr=30,or=30,lr=!1,cr="#0000ff",hr="#ff8000",ur=!1,dr="",pr={open:ur,url:dr,custom:!1,filepath:dr,mime:null,cacheid:null,displayname:null,openfileobj:null},gr=!1,mr=!1,fr=[],yr=!1,vr=!1,br=!1,xr=!1,wr=!1,kr=90,Dr=-1,Cr=!1,Pr=!1,Sr=!1,Rr=!1,Mr=!1,Tr=0,Er=!1,Fr=1,Ir="mm",jr="mmÂ²",Or=1,Lr=1,Vr=0,Nr=0,Ar=20,Br=15,Ur=12,Gr=12,Hr=210,zr=!1,Wr=!1,_r=1,Xr=.95,Yr=.75,qr=1,Zr=!0,Jr=[],Kr=[],Qr=[{name:"hide3d",cursor:"crosshair"},{name:"measure3D",cursor:"crosshair"},{name:"select3d",cursor:"crosshair"},{name:"Walkthrough3D",cursor:"default"},{name:"orbitControl",cursor:"default"},{name:"magnify",cursor:"default"},{name:"note",cursor:"default"},{name:"pencil",cursor:"crosshair"},{name:"rect",cursor:"crosshair"},{name:"count",cursor:"crosshair"},{name:"symbol",cursor:"default"},{name:"zoomwindow",cursor:"crosshair"},{name:"rectText",cursor:"default"},{name:"rectStamp",cursor:"default"},{name:"PickPolygon",cursor:"crosshair"},{name:"pan",cursor:"move"},{name:"selectText",cursor:"text"},{name:"markupedit",cursor:"default"},{name:"arrow",cursor:"crosshair"},{name:"callout",cursor:"default"},{name:"area",cursor:"crosshair"},{name:"measuretool",cursor:"crosshair"},{name:"measure",cursor:"crosshair"},{name:"calibrate",cursor:"crosshair"},{name:"link",cursor:"default"},{name:"interactiveStamp",cursor:"default"}],$r=[],es=[],ts=[],as=[],is=[],rs=1,ss="#FF0000",ns="#FF0000",os="#FF0000",ls="#FF0000",cs=100,hs="Default",us="Default",ds=4,ps=4,gs=0,ms=0,fs=0,ys=!0,vs=!1,bs=!1,xs=!1,ws=!1,ks=!1,Ds=!1,Cs="",Ps="",Ss="",Rs="",Ms=!1,Ts=!1,Es=!1,Fs=!1,Is=!1,js="",Os="",Ls=[],Vs={isactive:!1,consolidatelist:[],add:function(e,t,a){var i={markup:e,settings:t};if(this.consolidatelist.push(i),a)for(;this.consolidatelist.length>0;){var r=this.consolidatelist.pop();r.markup.Consolidate(r.settings)}}},Ns=new Image;W&&(Ns.src=W),(new Image).src="";var As,Bs,Us,Gs,Hs=document.createElement("canvas"),zs=document.createElement("img"),Ws=0,_s={},Xs=[],Ys=[],qs=[];class Zs{constructor(e){this.jsonmarkup=null,this.DocRef=e,this.pages=[],this.pcounter=0,this.bnotcomplete=!0,null!=e&&null!=e&&(e.markupsave=this),this.callback=void 0}setOncomplete(e){this.callback=e}setDocObj(e){null!=e&&null==e&&(this.DocRef=e)}oncomplete(){if("function"==typeof this.callback){var e=JSON.stringify(this.jsonmarkup);this.callback(e)}}createjsonexport(e,t,a){this.jsonmarkup=JSON.parse(wc(!1,a,ci,e,0,this)),this.getnonloadedpages()}createjson(e,t){this.jsonmarkup=JSON.parse(wc(!0,!1,!0,e,0,this)),this.getnonloadedpages()}addpage(e){for(var t=!1,a=0;a<this.pages.length;a++)this.pages[a]==e&&(t=!0);t||this.pages.push(e)}getnonloadedpages(){if(this.pages.length>0){if(null!=this.DocRef){var e=this.pages.pop();null!=e&&this.DocRef.getPageObjectLoad(e)}}else this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}setpage(e){if(null!=this.DocRef&&null!=this.jsonmarkup)for(var t=0;t<this.DocRef.markuplist.length;t++)if(this.DocRef.markuplist[t].pagenumber==e.pagenumber&&!this.DocRef.markuplist[t].pdfannotproxy){if(this.DocRef.markuplist[t].bhasArrow&&null!=this.DocRef.markuplist[t].markupArrowConnected);else var a=JSON.parse(bc(this.DocRef.markuplist[t],this.DocRef,this.jsonmarkup,e,!1));null!=a&&this.jsonmarkup.push(a)}this.pages.length>0?this.getnonloadedpages():this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}}class Js{constructor(e){this.xmlmarkup=null,this.DocRef=e,this.pages=[],this.pcounter=0,this.bnotcomplete=!0,null!=e&&null!=e&&(e.markupsave=this),this.callback=void 0}setOncomplete(e){this.callback=e}setDocObj(e){null!=e&&null==e&&(this.DocRef=e)}oncomplete(){"function"==typeof this.callback&&this.callback(this.xmlmarkup)}createxmlexport(e,t,a){this.xmlmarkup=kc(!1,a,ci,e,t,this),this.getnonloadedpages()}createxml(e,t){this.xmlmarkup=kc(!0,!1,!1,e,t,this),this.getnonloadedpages(),this.pages.length}addpage(e){for(var t=!1,a=0;a<this.pages.length;a++)this.pages[a]==e&&(t=!0);t||this.pages.push(e)}getnonloadedpages(){if(this.pages.length>0){if(null!=this.DocRef){var e=this.pages.pop();null!=e&&this.DocRef.getPageObjectLoad(e)}}else this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}setpage(e){if(null!=this.DocRef&&null!=this.xmlmarkup)for(var t=0;t<this.DocRef.markuplist.length;t++)if(this.DocRef.markuplist[t].pagenumber==e.pagenumber){if(this.DocRef.markuplist[t].bhasArrow&&null!=this.DocRef.markuplist[t].markupArrowConnected);else var a=xc(this.DocRef.markuplist[t],this.DocRef,this.xmlmarkup,e,!1);null!=a&&this.xmlmarkup.getElementsByTagName("Entities")[0].appendChild(a)}this.pages.length>0?this.getnonloadedpages():this.bnotcomplete&&(this.oncomplete(),this.bnotcomplete=!1)}}class Ks{constructor(e,t,a,i){var r=this;this.color=i,this.imagesrc=e,this.w=t,this.h=a,this.width=t,this.height=a,this.imageloaded=!1,this.textureimage=new Image,this.threeTexture=null,this.threeTexture2=null,this.canvas2=null,this.context2=null,this.markupmaterial=null,this.markupmaterialblank=null,this.imageload=function(){r.imageloaded=!0},this.setimage=function(){r.textureimage.addEventListener("load",r.imageload,!1),r.textureimage.src=r.imagesrc},e&&r.setimage(e)}}class Qs{constructor(e,t,a,i){this.startx=e,this.starty=t,this.endx=a,this.endy=i,this.width=a-e,this.height=i-t;var r=e-a,s=t-i;this.angle=Math.atan2(this.height,this.width),this.reangle=Math.atan2(s,r),this.rehangle=Math.atan2(this.height,r),this.rewangle=Math.atan2(s,this.width)}}class $s{constructor(e,t,a){this.pointID=e,this.x=t,this.y=a}}class en{constructor(e,t,a,i){var r=this;this.fontName=e,this.height=t,this.bold=a,this.italic=i,this.scale=1,this.scalepx=1;var s=this.height*this.scale;function n(){var e=r.height*r.scale;r.bold?(r.fontstring="bold "+r.height+"pt "+r.fontName,r.fontstringScaled="bold "+e+"pt "+r.fontName):r.italic?(r.fontstring="italic "+r.height+"pt "+r.fontName,r.fontstringScaled="italic "+e+"pt "+r.fontName):(r.fontstring="normal "+r.height+"pt "+r.fontName,r.fontstringScaled="normal "+e+"pt "+r.fontName)}a?(this.fontstring="bold "+this.height+"pt "+this.fontName,this.fontstringScaled="bold "+s+"pt "+this.fontName,this.fontstringpx="bold "+this.height+"px "+this.fontName):i?(this.fontstring="italic "+this.height+"pt "+this.fontName,this.fontstringScaled="italic "+s+"pt "+this.fontName,this.fontstringpx="italic "+this.height+"px "+this.fontName):(this.fontstring="normal "+this.height+"pt "+this.fontName,this.fontstringScaled="normal "+s+"pt "+this.fontName,this.fontstringpx="normal "+this.height+"px "+this.fontName),this.setFontname=function(e){this.fontName=e,n()},this.setHeight=function(e){this.height=e,n()},this.setBold=function(e){this.bold=e,e&&(this.italic=!1),n()},this.setItalic=function(e){this.italic=e,e&&(this.bold=!1),n()},this.setScale=function(e){var t=ll();this.scale=e,this.scalepx=this.scale/t,n()},this.getScaledHeight=function(){return s}}}var tn=new en("Arial",18,!1,!1);function an(e,t,a,i,r,s,n,o){if(e===a&&t===i||r===n&&s===o)return!1;var l=(o-s)*(a-e)-(n-r)*(i-t);if(0===l)return!1;var c=((n-r)*(t-s)-(o-s)*(e-r))/l,h=((a-e)*(t-s)-(i-t)*(e-r))/l;return!(c<0||c>1||h<0||h>1)&&{x:e+c*(a-e),y:t+c*(i-t)}}function rn(e){var t=Na/2,a=Aa/2,i=0,r={found:e.found,x:e.x,y:e.y},s=!1;switch(Bs.getCurrentpage().drotation){case 0:i=Bs.getCurrentpage().drotation*(Math.PI/180),s=!0;break;case 90:case 270:case 180:i=Bs.getCurrentpage().drotation*(Math.PI/180)}var n=Math.cos(i),o=Math.sin(i),l=r.x-t,c=r.y-a,h=l*n-c*o,u=l*o+c*n;return s||(r.x=t+h,r.y=a+u),r}function sn(e,t){var a=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(a.length!=i.length)return!1;for(var r=0;r<a.length;r++){var s=a[r];if(e[s]!==t[s])return!1}return!0}function nn(e,t,a,i){var r=Na/2,s=Aa/2,n=0,o={x1:e,x2:a,y1:t,y2:i};switch(Bs.getCurrentpage().drotation){case 0:return n=Bs.getCurrentpage().drotation*(Math.PI/180),o;case 90:n=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:n=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:n=Bs.getCurrentpage().drotation*(Math.PI/180)}var l=Math.cos(n),c=Math.sin(n),h=e-r,u=t-s,d=a-r,p=i-s;switch((o={x1:h*l-u*c,y1:h*c+u*l,x2:d*l-p*c,y2:d*c+p*l}).x1=r+o.x1,o.y1=s+o.y1,o.x2=r+o.x2,o.y2=s+o.y2,Bs.getCurrentpage().drotation){case 90:var g=o.y2;o.y2=o.y1,o.y1=g;break;case 270:var m=o.x2;o.x2=o.x1,o.x1=m;break;case 180:g=o.y2,o.y2=o.y1,o.y1=g,m=o.x2,o.x2=o.x1,o.x1=m}return o}function on(e,t){var a=Na/2,i=Aa/2,r=0,s={x:e,y:t};switch(Bs.getCurrentpage().drotation){case 0:return r=Bs.getCurrentpage().drotation*(Math.PI/180),s;case 90:r=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:r=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:r=Bs.getCurrentpage().drotation*(Math.PI/180)}var n=Math.cos(r),o=Math.sin(r),l=e-a,c=t-i;return(s={x:l*n-c*o,y:l*o+c*n}).x=a+s.x,s.y=i+s.y,s}function ln(e,t,a,i){return i=i*Math.PI/180,{x:Math.cos(i)*(e.x-t)-Math.sin(i)*(e.y-a)+t,y:Math.sin(i)*(e.x-t)+Math.cos(i)*(e.y-a)+a}}function cn(e){t=!1;var t=/^#[0-9A-F]{6}$/i.test(e);return 9==e.length&&(t=/^#[0-9A-F]{6}[0-9a-f]{0,2}$/i.test("#AABBCC80")),t}function hn(e,t){var a=e.split(","),i=a[0].split("(");if(null!=i[1]){cn(e)&&(e=pn(e,t)),i=i[1].trim();var r=a[1].trim(),s=a[2].trim();return a[3].trim(),"rgba("+i+","+r+","+s+","+t/100+")"}}function un(e,t){var a=t.split("$").join("\\$").split("*").join(".*");return new RegExp("^"+a+"$","i").test(e)}function dn(e){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function a(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+a(t[1])+a(t[2])+a(t[3])}function pn(e,t){e=e.replace("#","");var a=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return 8==e.length&&(a=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16)),"rgba("+a+","+i+","+r+","+t/100+")"}function gn(e){return e=e.replace("#",""),{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function mn(e,t){if(!(t<1&&t>0))throw"scale must be a positive number <1 ";var a=t*t,i=e.width,r=e.height,s=Math.ceil(i*t),n=Math.ceil(r*t),o=0,l=0,c=0,h=0,u=0,d=0,p=0,g=0,m=0,f=0,y=0,v=0,b=0,x=0,w=0,k=!1,D=!1,C=e.getContext("2d").getImageData(0,0,i,r).data,P=new Float32Array(4*i*r),S=0,R=0,M=0,T=0;for(l=0;l<r;l++)for(d=4*(m=0|(u=l*t))*s,(D=m!=(0|u+t))&&(x=m+1-u,w=u+t-m-1),o=0;o<i;o++,c+=4)p=d+4*(g=0|(h=o*t)),(k=g!=(0|h+t))&&(v=g+1-h,b=h+t-g-1),S=C[c],R=C[c+1],M=C[c+2],T=C[c+3],k||D?k&&!D?(f=v*t,P[p]+=S*f,P[p+1]+=R*f,P[p+2]+=M*f,P[p+3]+=T*f,y=b*t,P[p+4]+=S*y,P[p+5]+=R*y,P[p+6]+=M*y,P[p+7]+=T*y):D&&!k?(f=x*t,P[p]+=S*f,P[p+1]+=R*f,P[p+2]+=M*f,P[p+3]+=T*f,y=w*t,P[p+4*s]+=S*y,P[p+4*s+1]+=R*y,P[p+4*s+2]+=M*y,P[p+4*s+3]+=T*y):(f=v*x,P[p]+=S*f,P[p+1]+=R*f,P[p+2]+=M*f,P[p+3]+=T*f,y=b*x,P[p+4]+=S*y,P[p+5]+=R*y,P[p+6]+=M*y,P[p+7]+=T*y,y=v*w,P[p+4*s]+=S*y,P[p+4*s+1]+=R*y,P[p+4*s+2]+=M*y,P[p+4*s+3]+=T*y,y=b*w,P[p+4*s+4]+=S*y,P[p+4*s+5]+=R*y,P[p+4*s+6]+=M*y,P[p+4*s+7]+=T*y):(P[p]+=S*a,P[p+1]+=R*a,P[p+2]+=M*a,P[p+3]+=T*a);var E=document.createElement("canvas");E.width=s,E.height=n;var F=E.getContext("2d"),I=F.getImageData(0,0,s,n),j=I.data,O=0;for(c=0,p=0;O<s*n;c+=4,p+=4,O++)j[p]=Math.ceil(P[c]),j[p+1]=Math.ceil(P[c+1]),j[p+2]=Math.ceil(P[c+2]),j[p+3]=Math.ceil(P[c+3]);return F.putImageData(I,0,0),C=null,j=null,P=null,E}function fn(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}function yn(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0);var a=t.toDataURL("image/png");return a="<![CDATA["+a+"]]>"}function vn(e){return new Promise((function(t,a){const i=new Image;i.onload=function(e){const a=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}(e.currentTarget);t(a)},i.src=e}))}function bn(e,t,a,i){for(var r=t,s=!1,n=e.measureText(r);n.width>a&&r.length>1;)r=r.substring(0,r.length-1),n=e.measureText(r);if(t!=r){i.push(r);var o=t.substr(r.length);(n=e.measureText(o)).width>a?s=!0:(s=!1,i.push(o))}else i.push(r),s=!1;return{bNeedSplit:s,remainer:o,resultarray:i}}function xn(e,t,a,i,r,s){var n,o,l="",c=t.split("\n"),h=[],u=[],d=[];r-=e.measureText(" ").width;for(var p=0;p<c.length;p++)l="",n=0,e.measureText(c[p]).width>r?(h=h.concat(c[p].split(" "))).push("\n"):(h.push(c[p]),h.push("\n"));for(n=0;n<h.length;n++)if("\n"!=h[n])for(var g=bn(e,h[n],r,u);g.bNeedSplit;)g=bn(e,g.remainer,r,u);else u.push(h[n]);for(n=0;n<u.length;n++)"\n"!=u[n]?(o=l+u[n]+" ",e.measureText(o).width>r&&n>0?(""!=l&&d.push(l),l=u[n]+" "):l=o):(""!=l&&d.push(l),l="");for(n=0;n<d.length;n++)"\n"!=d[n]&&(e.fillText(d[n],a,i),i+=s)}Gs=function(e,t){this.x=e,this.y=t};class wn{constructor(e,t){this.width=e,this.height=t}}class kn{constructor(e,t,a,i){this.x=e,this.y=t,this.w=a,this.h=i}}class Dn{constructor(e,t,a,i,r){this.Signature=e,this.DisplayName=t,this.Layer=a,this.Color=i,this.display=!0,this.default=r}}class Cn{constructor(e,t,a,i){this.Layer=e,this.Name=a,this.Color=t,this.display=i}}function Pn(e){for(var t="default user",a=0;a<es.length;a++)es[a].Signature==e&&(t=es[a].DisplayName);return t}function Sn(e){for(var t=!0,a=0;a<es.length;a++)es[a].Signature==e&&(t=es[a].display);return t}function Rn(e){for(var t="#FF0000",a=0;a<as.length;a++)as[a].Layer==e&&(t=as[a].Color);return t}function Mn(e){for(var t=!0,a=0;a<as.length;a++)as[a].Layer==e&&(t=as[a].display);return t}function Tn(e){return e%2==0}function En(e){var t=Number(e).toString(16);return t="#"+(t=(t="000000".substr(0,6-t.length)+t).toUpperCase())}function Fn(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)}function In(e,t,a,i){if(a)var r=tn.height*a/.75,s=100*a;else r=tn.height/.75,s=100;return i&&(1==i?t-=.5*r:2==i?(e-=s,t-=.5*r):3==i?(e-=.5*s,t-=r):4==i&&(e-=.5*s)),{x:e,y:t,w:s,h:r}}function jn(e){var t={x:0,y:0};if(jh())return t;if(null!=e)var a=Bs.getpage(e);else a=Bs.getCurrentpage();return a.usevectorxml?(t.x=a.dxvector,t.y=a.dyvector):a.usepdfjs?(t.x=a.dxpdf,t.y=a.dypdf):(0==Bs.Type?t.x=Bs.pages[0].dx:t.x=a.dx,t.y=a.dy),a.usevector3Dxml&&(t.x=.5*Na,t.y=.5*Aa),t}function On(e){if(null!=e)var t=Bs.getpage(e);else t=Bs.getCurrentpage();return t.fixedScale}function Ln(e){if(jh())return 1;if(null!=e)var t=Bs.getpage(e);else t=Bs.getCurrentpage();var a=t.dscale;return t.usevectorxml?a=t.dscalevector:t.usepdfjs?a=t.curpagescale*t.dscalepdf:(a=t.dscale,0==Bs.Type&&(a=Bs.pages[0].dscale)),t.usevector3Dxml&&(a=1),a}function Vn(e){var t=!1;return null==e||(t=!e.usevectorxml&&!e.usepdfjs,e.usevector3Dxml&&(t=!0)),t}function Nn(e,t){var a=!1;if(jh())return a;var i=Fn(Math.max(e.x,t.x)-Math.min(e.x,t.x),Math.max(e.y,t.y)-Math.min(e.y,t.y)),r=e.x-i,s=e.x+i,n=e.y-i,o=e.y+i;if(0==Bs.getCurrentpage().drotation)r>Bs.getCurrentpage().startx&&s<Bs.getCurrentpage().endx&&n>Bs.getCurrentpage().starty&&o<Bs.getCurrentpage().endy&&(a=!0),a&&t.x>Bs.getCurrentpage().startx&&t.x<Bs.getCurrentpage().endx&&t.y>Bs.getCurrentpage().starty&&t.y<Bs.getCurrentpage().endy&&(a=!0);else{var l=Bs.getCurrentpage().rotatedRect();r>l.x&&s<l.w&&n>l.y&&o<l.h&&(a=!0),a&&t.x>l.x&&t.x<l.w&&t.y>l.y&&t.y<l.h&&(a=!0)}return Bs.getCurrentpage().usevector3Dxml&&(a=!0),a}function An(e){var t=!1;if(jh())return t;var a=e.x,i=e.y,r=e.x+e.w,s=e.y+e.h;if(0==Bs.getCurrentpage().drotation)a>Bs.getCurrentpage().startx&&a<Bs.getCurrentpage().endx&&i>Bs.getCurrentpage().starty&&i<Bs.getCurrentpage().endy&&r>Bs.getCurrentpage().startx&&r<Bs.getCurrentpage().endx&&s>Bs.getCurrentpage().starty&&s<Bs.getCurrentpage().endy&&(t=!0);else{var n=Bs.getCurrentpage().rotatedRect();a>n.x&&a<n.w&&i>n.y&&i<n.h&&r>n.x&&r<n.w&&s>n.y&&s<n.h&&(t=!0)}return Bs.getCurrentpage().usevector3Dxml&&(t=!0),t}function Bn(e){var t=!1;if(jh())return t;var a=e.x,i=e.y;if(e.busepadding&&(a=e.xpadding,i=e.ypadding),0==Bs.getCurrentpage().drotation)a>Bs.getCurrentpage().startx&&a<Bs.getCurrentpage().endx&&i>Bs.getCurrentpage().starty&&i<Bs.getCurrentpage().endy&&(t=!0);else{var r=Bs.getCurrentpage().rotatedRect();a>r.x&&a<r.w&&i>r.y&&i<r.h&&(t=!0)}return Bs.getCurrentpage().usevector3Dxml&&(t=!0),t}function Un(e){return e*e}function Gn(e,t){return Un(e.x-t.x)+Un(e.y-t.y)}function Hn(e){var t=[],a=(t=e.slice())[0],i=t[t.length-1];a.x==i.x&&a.y==i.y||t.push(a);for(var r,s,n,o=0,l=0,c=0,h=t.length,u=0,d=h-1;u<h;d=u++)r=t[u],s=t[d],o+=n=r.x*s.y-s.x*r.y,l+=(r.x+s.x)*n,c+=(r.y+s.y)*n;return{x:l/(n=3*o),y:c/n}}function zn(e,t,a,i,r,s,n){var o,l,c,h,u;if((c=Math.atan2(t-i,e-a))<0&&(c+=2*Math.PI),s<0&&(s+=2*Math.PI),(h=s+n)<s&&(u=s,s=h,h=u),function(e,t,a){e=(e+2*Math.PI)%(2*Math.PI);let i=((t=(t+2*Math.PI)%(2*Math.PI))+a+2*Math.PI)%(2*Math.PI);return a>=0?t<i?e>=t&&e<=i:e>=t||e<=i:t>i?e<=t&&e>=i:e<=t||e>=i}(c,s,n))o=a+r*Math.cos(c),l=i+r*Math.sin(c);else{let e=Math.abs((c-s+2*Math.PI)%(2*Math.PI))<Math.abs((c-(s+n)+2*Math.PI)%(2*Math.PI))?s:s+n;o=a+r*Math.cos(e),l=i+r*Math.sin(e)}return Math.sqrt(Math.pow(o-e,2)+Math.pow(l-t,2))}function Wn(e,t,a){return Math.sqrt(function(e,t,a){var i=Gn(t,a);if(0==i)return Gn(e,t);var r=((e.x-t.x)*(a.x-t.x)+(e.y-t.y)*(a.y-t.y))/i;return Gn(e,r<0?t:r>1?a:{x:t.x+r*(a.x-t.x),y:t.y+r*(a.y-t.y)})}(e,t,a))}function _n(e,t,a,i,r,s,n,o){var l=i-t,c=e-a,h=a*t-e*i,u=l*r+c*s+h,d=l*n+c*o+h;if(u>0&&d>0)return 0;if(u<0&&d<0)return 0;var p=o-s,g=r-n,m=n*s-r*o;return d=p*a+g*i+m,(u=p*e+g*t+m)>0&&d>0||u<0&&d<0?0:l*g-p*c==0?2:1}function Xn(e,t,a,i,r,s,n,o,l){for(var c=0,h=l.x,u=l.y,d=o.x,p=o.y,g=0,m=0,f=0,y=0,v=0;v<n.points.length;v+=2)g=(n.points[v]-i)*e,m=(s-n.points[v+1])*e,v+3<n.points.length?(f=(n.points[v+2]-i)*e,y=(s-n.points[v+3])*e):(f=(n.points[0]-i)*e,y=(s-n.points[1])*e),c+=_n(h,u,d,p,g+=t,m+=a,f+=t,y+=a);if(n.gotsubpath)for(var b=0;b<n.subpaths.length;b++)for(v=0;v<n.subpaths[b].points.length;v+=2)g=(n.subpaths[b].points[v]-i)*e,m=(s-n.subpaths[b].points[v+1])*e,v+3<n.subpaths[b].points.length?(f=(n.subpaths[b].points[v+2]-i)*e,y=(s-n.subpaths[b].points[v+3])*e):(f=(n.subpaths[b].points[0]-i)*e,y=(s-n.subpaths[b].points[1])*e),c+=_n(h,u,d,p,g+=t,m+=a,f+=t,y+=a);return!Tn(c)}function Yn(e,t,a,i,r,s,n,o){for(var l=0,c=o.x,h=o.y,u=n.x,d=n.y,p=0;p<s.length;p++){var g=(s[p].x1-i)*e;g+=t;var m=(s[p].y1-r)*e;m+=a;var f=(s[p].x2-i)*e;f+=t;var y=(s[p].y2-r)*e;l+=_n(c,h,u,d,g,m,f,y+=a)}return!Tn(l)}function qn(e){var t=0,a=0,i=e.length;for(t=0;t<i-1;t++)a+=e[t].x*e[t+1].y-e[t+1].x*e[t].y;return a+=e[i-1].x*e[0].y-e[0].x*e[i-1].y,Math.abs(a/2)}function Zn(){as[0]=new Cn(0,"#ffffff","Layer 0",!0),as[1]=new Cn(1,"#ff0000","Layer 1",!0),as[2]=new Cn(2,"#0000ff","Layer 2",!0),as[3]=new Cn(3,"#008000","Layer 3",!0),as[4]=new Cn(4,"#ffff00","Layer 4",!0),as[5]=new Cn(5,"#a52a2a","Layer 5",!0),as[6]=new Cn(6,"#ffd700","Layer 6",!0),as[7]=new Cn(7,"#fff5ee","Layer 7",!0),as[8]=new Cn(8,"#fff8dc","Layer 8",!0),as[9]=new Cn(9,"#fffacd","Layer 9",!0),as[10]=new Cn(10,"#ffffe0","Layer 10",!0),as[11]=new Cn(11,"#98fb98","Layer 11",!0),as[12]=new Cn(12,"#afeeee","Layer 12",!0),as[13]=new Cn(13,"#e0ffff","Layer 13",!0),as[14]=new Cn(14,"#e6e6fa","Layer 14",!0),as[15]=new Cn(15,"#dda0dd","Layer 15",!0),as[16]=new Cn(16,"#d3d3d3","Layer 16",!0),as[17]=new Cn(17,"#ffc0cb","Layer 17",!0),as[18]=new Cn(18,"#ffe4c4","Layer 18",!0),as[19]=new Cn(19,"#ffe4b5","Layer 19",!0),as[20]=new Cn(20,"#f0e68c","Layer 20",!0),as[21]=new Cn(21,"#90ee90","Layer 21",!0),as[22]=new Cn(22,"#20b2aa","Layer 22",!0),as[23]=new Cn(23,"#87cefa","Layer 23",!0),as[24]=new Cn(24,"#6495ed","Layer 24",!0),as[25]=new Cn(25,"#ee82ee","Layer 25",!0),as[26]=new Cn(26,"#c0c0c0","Layer 26",!0),as[27]=new Cn(27,"#f08080","Layer 27",!0),as[28]=new Cn(28,"#f4a460","Layer 28",!0),as[29]=new Cn(29,"#000000","Layer 29",!0)}function Jn(e){var t=null;if(window.DOMParser)t=(new DOMParser).parseFromString(e,"text/xml");else{if(!window.ActiveXObject)throw new Error("Cannot parse XML");(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)}return t}function Kn(e,t,a){is.push({type:"color",name:e,ptrn:null,tilesize:0,color:t,description:a,inuse:!1})}function Qn(e,t,a,i,r){is.push({type:"hatch",name:t,ptrn:e,tilesize:a,color:i,description:r,inuse:!1})}function $n(){return is}function eo(e,t){for(var a=0;a<is.length;a++)if(e==is[a].name){is[a].inuse=t,null!=xa&&xa.setHatchchange(is[a]);break}}function to(e){for(var t=null,a=0;a<is.length;a++)if(e==is[a].name){t=is[a].type;break}return t}function ao(e){for(var t=null,a=0;a<is.length;a++)if(e==is[a].name){t=is[a].color;break}return t}function io(e,t){for(var a=null,i=0;i<is.length;i++)if(t==is[i].name&&"hatch"==is[i].type){null!=is[i].ptrn&&(a=e.createPattern(is[i].ptrn,"repeat"));break}return a}function ro(e){return"diagonal-forward"==e?3:"diagonal-back"==e?2:"diagonal-cross"==e?5:"hatch-horizontal"==e?0:"hatch-vertical"==e?1:"hatch-cross"==e?4:-1}function so(e){var t="diagonal-forward";switch(e){case 0:t="hatch-horizontal";break;case 1:t="hatch-vertical";break;case 2:t="diagonal-back";break;case 3:t="diagonal-forward";break;case 4:t="hatch-cross";break;case 5:t="diagonal-cross"}return t}function no(e,t){var a=function(e){for(var t=null,a=0;a<is.length;a++)if(e==is[a].name){t=is[a];break}return t}(so(e));null!=a&&(function(e){return e instanceof HTMLCanvasElement}(a.ptrn)?a.color!=t&&oo(a.ptrn.getContext("2d"),e,t):lo(e,t))}function oo(e,t,a){switch(e.strokeStyle=a,e.lineWidth=1,t){case 3:e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.moveTo(10,16),e.lineTo(16,10),e.moveTo(2,16),e.lineTo(16,2),e.moveTo(0,2),e.lineTo(2,0),e.stroke();break;case 2:e.beginPath(),e.moveTo(0,14),e.lineTo(2,16),e.moveTo(0,6),e.lineTo(10,16),e.moveTo(2,0),e.lineTo(16,14),e.moveTo(10,0),e.lineTo(16,6),e.stroke();break;case 5:e.beginPath(),e.moveTo(0,10),e.lineTo(10,0),e.moveTo(10,16),e.lineTo(16,10),e.moveTo(2,16),e.lineTo(16,2),e.moveTo(0,2),e.lineTo(2,0),e.moveTo(0,14),e.lineTo(2,16),e.moveTo(0,6),e.lineTo(10,16),e.moveTo(2,0),e.lineTo(16,14),e.moveTo(10,0),e.lineTo(16,6),e.stroke();break;case 0:e.beginPath(),e.moveTo(0,4),e.lineTo(16,4),e.moveTo(0,12),e.lineTo(16,12),e.stroke();break;case 1:e.beginPath(),e.moveTo(4,0),e.lineTo(4,16),e.moveTo(12,0),e.lineTo(12,16),e.stroke();break;case 4:e.beginPath(),e.moveTo(0,4),e.lineTo(16,4),e.moveTo(0,12),e.lineTo(16,12),e.moveTo(4,0),e.lineTo(4,16),e.moveTo(12,0),e.lineTo(12,16),e.stroke()}}function lo(e,t){var a=document.createElement("canvas");a.width=16,a.height=16;var i=a.getContext("2d"),r=so(e);oo(i,e,t),Qn(a,r,{w:16,h:16},t,"no description")}function co(e,t,a){return(Hs=document.createElement("canvas")).width=16,Hs.height=16,oo(Hs.getContext("2d"),t,a),e.createPattern(Hs,"repeat")}function ho(e){for(var t=e.split("/"),a=0;a<t.length-1;a++)t[a];return t[t.length-1]}function uo(e){var t="";if(e){for(var a=e.split("/"),i=0;i<a.length-1;i++)t+=a[i]+"/";X&&(t=U)}return t}function po(e){for(var t="",a=e.split("\\"),i=0;i<a.length-1;i++)t+=a[i]+"\\";return t||(t=e),t}function go(e){var t="";if(e)if(e.indexOf("https://")>-1)t=ho(e);else if(e.indexOf("http://")>-1)t=ho(e);else{for(var a=e.split("\\"),i=0;i<a.length-1;i++)a[i];t=a[a.length-1]}return t}function mo(e){for(var t="",a=e.split("\\"),i=0;i<a.length;i++)i<a.length-1&&(t+=a[i]+"\\\\");return t||(t=e),t}function fo(e,t,a,i){var r=[{minX:e*Math.cos(Math.PI/180*22.5),maxX:e*Math.cos(0)},{minX:e*Math.cos(Math.PI/180*67.5),maxX:e*Math.cos(Math.PI/180*22.5)},{minX:e*Math.cos(Math.PI/180*112.5),maxX:e*Math.cos(Math.PI/180*67.5)},{minX:e*Math.cos(Math.PI/180*157.5),maxX:e*Math.cos(Math.PI/180*112.5)},{minX:e*Math.cos(Math.PI/180*180),maxX:e*Math.cos(Math.PI/180*157.5)},{minX:e*Math.cos(Math.PI/180*202.5),maxX:e*Math.cos(Math.PI/180*247.5)},{minX:e*Math.cos(Math.PI/180*247.5),maxX:e*Math.cos(Math.PI/180*292.5)},{minX:e*Math.cos(Math.PI/180*292.5),maxX:e*Math.cos(Math.PI/180*337.5)}],s=Math.sqrt(Math.abs(t)*Math.abs(t)+Math.abs(a)*Math.abs(a)),n=new THREE.Vector2(t,a).normalize().clone().multiplyScalar(e);n.x>=0&&n.y>=0?s>50?r[0].maxX>=n.x&&n.x>=r[0].minX?Bs.getCurrentpage().walkthroughcontrol.movedirection(4,1==i):r[1].maxX>=n.x&&n.x>=r[1].minX||r[2].maxX>=n.x&&n.x>=r[2].minX&&Bs.getCurrentpage().walkthroughcontrol.movedirection(1,1==i):Bs.getCurrentpage().walkthroughcontrol.movedirection(5,1==i):n.x<=0&&n.y>=0?s>50?r[2].maxX>=n.x&&n.x>=r[2].minX?Bs.getCurrentpage().walkthroughcontrol.movedirection(1,1==i):r[3].maxX>=n.x&&n.x>=r[3].minX||r[4].maxX>=n.x&&n.x>=r[4].minX&&Bs.getCurrentpage().walkthroughcontrol.movedirection(3,1==i):Bs.getCurrentpage().walkthroughcontrol.movedirection(5,1==i):n.x<=0&&n.y<=0?s>50?r[4].maxX>=n.x&&n.x>=r[4].minX?Bs.getCurrentpage().walkthroughcontrol.movedirection(3,1==i):r[5].maxX>=n.x&&n.x>=r[5].minX||r[6].maxX>=n.x&&n.x>=r[6].minX&&Bs.getCurrentpage().walkthroughcontrol.movedirection(2,1==i):Bs.getCurrentpage().walkthroughcontrol.movedirection(6,1==i):n.x>=0&&n.y<=0&&(s>50?r[6].maxX>=n.x&&n.x>=r[6].minX?Bs.getCurrentpage().walkthroughcontrol.movedirection(2,1==i):r[7].maxX>=n.x&&n.x>=r[7].minX||r[0].maxX>=n.x&&n.x>=r[0].minX&&Bs.getCurrentpage().walkthroughcontrol.movedirection(4,1==i):Bs.getCurrentpage().walkthroughcontrol.movedirection(6,1==i))}function yo(){return Bs.selectedmarkup}function vo(e){var t=Bs.getCurrentpage().scaleObject.Unitofmeasure;ge&&(t=ge.scaleObject.Unitofmeasure);var a=0,i=Bs.getCurrentpage().DPI,r=i/25.4,s=i,n=Bs.getCurrentpage().scaleObject.getMeasureScale();ge&&(n=ge.scaleObject.getMeasureScale()),null==n&&(n=Or),Bs.getCurrentpage().usepdfjs&&(r=(i=72)/25.4,s=i);var o=r*r,l=s*s,c=n*n;if(Bs.getCurrentpage().usevectorxml)var h=Bs.getCurrentpage().OriginalScale*Bs.getCurrentpage().OriginalScale;else h=Bs.getCurrentpage().usepdfjs?Bs.getCurrentpage().OriginalScale*Bs.getCurrentpage().OriginalScale:Bs.getCurrentpage().MainImageScaling*Bs.getCurrentpage().MainImageScaling;Bs.getCurrentpage().dscale,Bs.getCurrentpage().dscale,Bs.getCurrentpage().usevectorxml?(Bs.getCurrentpage().dscalevector,Bs.getCurrentpage().dscalevector):Bs.getCurrentpage().usepdfjs&&(Bs.getCurrentpage().curpagescale,Bs.getCurrentpage().dscalepdf,Bs.getCurrentpage().curpagescale,Bs.getCurrentpage().dscalepdf);var u=Bs.getCurrentpage().OriginalScale*Bs.getCurrentpage().OriginalScale;a=e/h*c;var d=Bs.getCurrentpage().scaleObject.getUnitScale();if(ge&&(d=ge.scaleObject.getUnitScale()),a/=d*d,0!=i)switch(t){case 1:a/=o;break;case 2:a/=l}else Bs.getCurrentpage().usevectorxml||(a/=u);return a}function bo(e,t){var a=0;if(jh())return a;var i=Bs.getCurrentpage().DPI,r=Bs.getCurrentpage().scaleObject.Unitofmeasure,s=i/25.4,n=i;Bs.getCurrentpage().usepdfjs&&(s=(i=72)/25.4,n=i),e*=_r;var o=Bs.getCurrentpage().scaleObject.getMeasureScale();if(ge&&(o=ge.scaleObject.getMeasureScale()),null==o&&(o=Or),a=Bs.getCurrentpage().usevectorxml||Bs.getCurrentpage().usepdfjs||Bs.getCurrentpage().usevector3Dxml?e/o*Bs.getCurrentpage().OriginalScale:e/o*Bs.getCurrentpage().MainImageScaling,0!=i)switch(r){case 1:a*=s;break;case 2:a*=n}return a}var xo=function(e,t){return t<1e-7?e:xo(t,Math.floor(e%t))};function wo(e){var t,a=0,i=0;if(!jh()){var r=Bs.getCurrentpage().DPI,s=r,n=Bs.getCurrentpage().scaleObject.getMeasureScale();ge&&(n=ge.scaleObject.getMeasureScale()),null==n&&(n=Or),Bs.getCurrentpage().usepdfjs&&(s=r=72),a=Bs.getCurrentpage().usevectorxml||Bs.getCurrentpage().usepdfjs||Bs.getCurrentpage().usevector3Dxml?e/Bs.getCurrentpage().OriginalScale*n:e/Bs.getCurrentpage().MainImageScaling*n;var o=Bs.getCurrentpage().scaleObject.getUnitScale();ge&&(o=ge.scaleObject.getUnitScale()),a/=o,0!=r?a/=s:Bs.getCurrentpage().usevectorxml||(a/=Bs.getCurrentpage().OriginalScale);var l=Math.floor(a/_r);t=a%_r;var c=Math.floor(t);if(i=t-c,(i=Math.round(32*i)/32)>.03125){var h=i.toString().length-2,u=Math.pow(10,h),d=i*u,p=xo(d,u);d/=p,u/=p;var g=Math.floor(d),m=Math.floor(u)}else g=0,m=0;return{quot:l,rem:c,remdec:i,numerator:g,denominator:m}}}function ko(e){var t=0;if(jh())return t;var a=Bs.getCurrentpage().scaleObject.Unitofmeasure;ge&&(a=ge.scaleObject.Unitofmeasure);var i=Bs.getCurrentpage().DPI,r=i/25.4,s=i,n=Bs.getCurrentpage().scaleObject.getMeasureScale();ge&&(n=ge.scaleObject.getMeasureScale()),null==n&&(n=Or),Bs.getCurrentpage().usepdfjs&&(r=(i=72)/25.4,s=i),t=Bs.getCurrentpage().usevectorxml||Bs.getCurrentpage().usepdfjs||Bs.getCurrentpage().usevector3Dxml?e/Bs.getCurrentpage().OriginalScale*n:e/Bs.getCurrentpage().MainImageScaling*n;var o=Bs.getCurrentpage().scaleObject.getUnitScale();if(ge&&(o=ge.scaleObject.getUnitScale()),t/=o,0!=i)switch(a){case 1:t/=r;break;case 2:t/=s}else Bs.getCurrentpage().usevectorxml||(t/=Bs.getCurrentpage().OriginalScale);return t}function Do(e){var t=!1;if(e&&(e.bredoonly?(Bs.markupredolist.push(e),e=function(e){var t,a=0;for(a=0;a<e.length;a++)if(e[a].bredoonly){t=e[a],e.splice(a,1);break}return t}(Bs.markupredolist)):Bs.markupundolist.push(e)),null!=e){e.markupnumber;var a=0;for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&Bs.markuplist[a].markupnumber==e.markupnumber&&(e.PerformUndo(Bs.markuplist[a],Bs),t=!0);t||e.PerformUndo(void 0,Bs)}}function Co(e){var t=function(e,t){var a=0,i=void 0,r=[];for(a=0;a<t.tempundolist.length;a++)null!=t.tempundolist[a]&&(t.tempundolist[a].markupnumber==e?i=t.tempundolist[a]:r.push(t.tempundolist[a]));return t.tempundolist=[],t.tempundolist=r,i}(e.markupnumber,Bs);null!=t&&(function(e,t){var a=0,i=0;for(a=0;a<t.length;a++)t[a].markupnumber==e&&t[a].bmodify&&i++;return 0==i}(e.markupnumber,Bs.markupundolist)&&(t.isfirstbmodify=!0),Bs.markupundolist.push(t),function(e,t){var a=0,i=[],r=0;for(a=0;a<t.markupredolist.length;a++)null!=t.markupredolist[a]&&t.markupredolist[a].markupnumber==e&&(t.markupredolist[a].bredoonly||(i[r]=t.markupredolist[a],r++));t.markupredolist=[],t.markupredolist=i}(e.markupnumber,Bs))}function Po(e){var t=!1;if(e&&(e.bcreate||e.bdelete||(function(e,t){var a=0,i=!0;for(a=0;a<t.markupredolist.length;a++)null!=t.markupredolist[a]&&t.markupredolist[a].markupnumber==e&&t.markupredolist[a].bredoonly&&(i=!1);return i}(e.markupnumber,Bs)&&function(e){var t,a=0;for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&Bs.markuplist[a].markupnumber==e.markupnumber&&(t=new Eo(e.markupnumber),e.bMultiOp&&t.setmultiValues(e.multiOpId),t.bmodify=!0,t.bredoonly=!0,t.SetUndoValues(Bs.markuplist[a]),Bs.markupredolist.unshift(t))}(e),function(e,t){var a=0;for(a=0;a<t.length;a++)t[a].markupnumber==e&&(t[a].bcurstate=!1)}(e.markupnumber,Bs.markupredolist),e.bcurstate=!0),Bs.markupredolist.push(e)),null!=e){var a=0;for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&Bs.markuplist[a].markupnumber==e.markupnumber&&(e.PerformUndo(Bs.markuplist[a],Bs),t=!0);t||e.PerformUndo(void 0,Bs)}}function So(){var e,t=0;for($r=[],t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&(Bs.markuplist[t].drawn=!1,(e=new Eo(Bs.markuplist[t].markupnumber)).SetUndoValues(Bs.markuplist[t]),$r.push(e))}function Ro(e,t){var a=0;for(a=0;a<Bs.markuplist.length;a++)if(null!=Bs.markuplist[a]&&Bs.markuplist[a].markupnumber==e){if(Bs.markuplist[a].bisTextArrow)continue;Bs.markuplist[a].savemarkupstateChanged(Bs,t)}}function Mo(e,t){var a=0;for(a=0;a<Bs.markuplist.length;a++)if(null!=Bs.markuplist[a]&&Bs.markuplist[a].markupnumber==e){if(Bs.markuplist[a].bisTextArrow)continue;Bs.markuplist[a].savemarkupstate(Bs,t)}}function To(e){var t=new Eo(e.markupnumber);e.bMultiOp&&(t.setmultiValues(e.multiOpId),e.resetmultiValues()),t.SetUndoValues(e),Bs.markupundolist.push(t)}class Eo{constructor(e){var t=this;this.markupnumber=e,this.bMultiOp=!1,this.multiOpId=null,this.type=0,this.subtype=0,this.alternative=0,this.consolidated=!1,this.bRedact=!1,this.bdelete=!1,this.bmodify=!1,this.islastbmodify=!1,this.isfirstbmodify=!1,this.bcurstate=!1,this.bcreate=!1,this.bredoonly=!1,this.bhasArrow=!1,this.markupArrowConnected=null,this.bisTextArrow=!1,this.textBoxConnected=null,this.savetolist=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.rotatedrect=new kn(0,0,0,0),this.timestamp=0,this.layer=0,this.pagenumber=0,this.layout="Default",this.signature="",this.color="",this.transparency=100,this.fillcolor="rgba(255,0,0,1.0)",this.strokecolor="rgba(255,0,0,1.0)",this.textcolor="rgba(255,0,0,1.0)",this.markercolor="rgba(255,0,0,1.0)",this.scaling=0,this.xoffset=0,this.yoffset=0,this.leaderoffset=0,this.scalingext=0,this.xoffsetext=0,this.yoffsetext=0,this.rotation=0,this.textrotate=0,this.dimtext="",this.dimtextx="",this.dimtexty="",this.linewidth=0,this.textheight=0,this.measuretextheight=0,this.textwidth=0,this.text="",this.font=new en("Helvetica",24,!1,!1),this.points=[],this.pointlist=[],this.countshapes=[],this.comments=[],this.customattributes=[],this.holes=[],this.holepointlist=[],this.innerRadius=1,this.outerRadius=1,this.image=void 0,this.restoreDeleted=function(){return new Fo(t.type,t.subtype,t.alternative)},this.saverestoredtolist=function(e,a){e&&(e.savemetolistLoad(a),e.markupnumber=t.markupnumber,e.drawmescaled(n),null!=zt&&zt.setMarkupSelected(e,{created:!0,modified:!1,deleted:!1}))},this.PerformUndoCommon=function(e,a){e.type=t.type,e.subtype=t.subtype,e.alternative=t.alternative,e.bRedact=t.bRedact,e.consolidated=t.consolidated,e.pagenumber=t.pagenumber,e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e.xscaled=t.xscaled,e.yscaled=t.yscaled,e.wscaled=t.wscaled,e.hscaled=t.hscaled,e.timestamp=t.timestamp,e.layer=t.layer,e.signature=t.signature,e.color=t.color,e.fillcolor=t.fillcolor,e.strokecolor=t.strokecolor,e.textcolor=t.textcolor,e.scaling=t.scaling,e.xoffset=t.xoffset,e.yoffset=t.yoffset,e.docdx=t.docdx,e.docdy=t.docdy,e.docdscale=t.docdscale,e.scalingext=t.scalingext,e.xoffsetext=t.xoffsetext,e.yoffsetext=t.yoffsetext,e.rotation=t.rotation,e.textrotate=t.textrotate,e.dimtext=t.dimtext,e.leaderoffset=t.leaderoffset,e.linewidth=t.linewidth,e.textheight=t.textheight,e.measuretextheight=t.measuretextheight,e.textwidth=t.textwidth,e.text=t.text,e.parent=t.parent,e.font=t.font,e.editcurpoint=0,e.points=t.points.slice(),e.countshapes=t.countshapes.slice(),e.innerRadius=t.innerRadius,e.outerRadius=t.outerRadius,e.numpoints=t.points.length-1;for(var i=0;i<t.pointlist.length;i++)e.pointlist[i]=t.pointlist[i].slice();e.comments=t.comments.slice(),e.customattributes=t.customattributes.slice(),e.holes=t.holes.slice(),e.bhasArrow&&null!=e.markupArrowConnected&&e.markupArrowConnected.setTextboxConnectionPoint(e.x,e.y,e.w,e.h),e.findrectangle(),t.savetolist&&(t.saverestoredtolist(e,a),e.addsides(),t.savetolist=!1)},this.PerformRedo=function(e,a){t.bcreate,t.bdelete&&(t.bdelete=!1,t.bcreate=!0),t.PerformUndo(e,a)},this.PerformUndo=function(e,a){if(6!=t.type||6!=t.subtype){if(t.bcreate)return t.bhasArrow&&t.markupArrowConnected&&Xo(t.markupArrowConnected.markupnumber),e&&11==e.type&&e.image&&(t.image=e.image),Xo(t.markupnumber),t.bdelete=!0,void(t.bcreate=!1);t.bdelete&&(e=t.restoreDeleted(),t.bhasArrow&&t.markupArrowConnected&&(e.markupArrowConnected=t.markupArrowConnected.restoreDeleted(),e.bhasArrow=!0,e.markupArrowConnected.textBoxConnected=e,e.markupArrowConnected.bisTextArrow=!0,t.markupArrowConnected.savetolist=!0),8==e.type&&2==e.subtype&&t.parent.holes.push(e),11==e.type&&(e.image=t.image,e.imageloaded=!0),t.savetolist=!0,t.bdelete=!1,t.bcreate=!0,e.setfirstDraw()),e&&(t.PerformUndoCommon(e,a),t.bhasArrow&&t.markupArrowConnected&&null!=e.markupArrowConnected&&t.markupArrowConnected.PerformUndoCommon(e.markupArrowConnected,a))}},this.checkduplicate=function(e){var t=0,a=0,i=!0;if((i=this.type==e.type&&i)&&(i=this.subtype==e.subtype&&i),i&&(i=this.alternative==e.alternative&&i),i&&(i=this.bRedact==e.bRedact&&i),i&&(i=this.consolidated==e.consolidated&&i),i&&(i=this.display==e.display&&i),i&&(i=this.x==e.x&&i),i&&(i=this.y==e.y&&i),i&&(i=this.w==e.w&&i),i&&(i=this.h==e.h&&i),i&&(i=this.xscaled==e.xscaled&&i),i&&(i=this.yscaled==e.yscaled&&i),i&&(i=this.wscaled==e.wscaled&&i),i&&(i=this.hscaled==e.hscaled&&i),i&&(i=this.rotatedrect==e.rotatedrect&&i),i&&(i=this.timestamp==e.timestamp&&i),i&&(i=this.layer==e.layer&&i),i&&(i=this.pagenumber==e.pagenumber&&i),i&&(i=this.layout==e.layout&&i),i&&(i=this.signature==e.signature&&i),i&&(i=this.color==e.color&&i),i&&(i=this.transparency==e.transparency&&i),i&&(i=this.fillcolor==e.fillcolor&&i),i&&(i=this.strokecolor==e.strokecolor&&i),i&&(i=this.textcolor==e.textcolor&&i),i&&(i=this.markercolor==e.markercolor&&i),i&&(i=this.scaling==e.scaling&&i),i&&(i=this.xoffset==e.xoffset&&i),i&&(i=this.yoffset==e.yoffset&&i),i&&(i=this.scalingext==e.scalingext&&i),i&&(i=this.xoffsetext==e.xoffsetext&&i),i&&(i=this.yoffsetext==e.yoffsetext&&i),i&&(i=this.rotation==e.rotation&&i),i&&(i=this.textrotate==e.textrotate&&i),i&&(i=this.dimtext==e.dimtext&&i),i&&(i=this.linewidth==e.linewidth&&i),i&&(i=this.textheight==e.textheight&&i),i&&(i=this.measuretextheight==e.measuretextheight&&i),i&&(i=this.textwidth==e.textwidth&&i),i&&(i=this.text==e.text&&i),i&&(i=this.font==e.font&&i),i&&(i=this.innerRadius==e.innerRadius&&i),i&&(i=this.outerRadius==e.outerRadius&&i),i)for(a=0;a<this.countshapes.length;a++)i=e.countshapes[a].x==this.countshapes[a].x&&i,i=e.countshapes[a].y==this.countshapes[a].y&&i;if(i)for(t=0;t<this.points.length;t++)i=e.points[t].x==this.points[t].x&&i,i=e.points[t].y==this.points[t].y&&i;return i},this.setmultiValues=function(e){this.bMultiOp=!0,this.multiOpId=e},this.SetUndoValues=function(e){var t=0,a=0,i=0,r=0,s=0;for(this.image=e.image,this.parent=e.parent,this.type=e.type,this.subtype=e.subtype,this.alternative=e.alternative,this.bRedact=e.bRedact,this.consolidated=e.consolidated,this.display=e.display,this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this.xscaled=e.xscaled,this.yscaled=e.yscaled,this.wscaled=e.wscaled,this.hscaled=e.hscaled,this.rotatedrect=e.rotatedrect,this.timestamp=e.timestamp,this.layer=e.layer,this.pagenumber=e.pagenumber,this.viewname=e.viewname,this.bfor3D=e.bfor3D,this.layout=e.layout,this.signature=e.signature,this.color=e.color,this.transparency=e.transparency,this.fillcolor=e.fillcolor,this.strokecolor=e.strokecolor,this.textcolor=e.textcolor,this.markercolor=e.markercolor,this.scaling=e.scaling,this.xoffset=e.xoffset,this.yoffset=e.yoffset,this.leaderoffset=e.leaderoffset,this.scalingext=e.scalingext,this.xoffsetext=e.xoffsetext,this.yoffsetext=e.yoffsetext,this.rotation=e.rotation,this.textrotate=e.textrotate,this.dimtext=e.dimtext,this.linewidth=e.linewidth,this.textheight=e.textheight,this.measuretextheight=e.measuretextheight,this.textwidth=e.textwidth,this.text=e.text,this.font=e.font,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,a=0;a<e.countshapes.length;a++)this.countshapes[a]=new Gs(e.countshapes[a].x,e.countshapes[a].y);if(e.bhasArrow&&null!=e.markupArrowConnected){this.bhasArrow=!0;var n=new Eo(e.markupArrowConnected.markupnumber);n.SetUndoValues(e.markupArrowConnected),this.markupArrowConnected=n}for(t=0;t<e.points.length;t++)this.points[t]=new Gs(e.points[t].x,e.points[t].y);for(var o=0;o<e.pointlist.length;o++){this.pointlist[o]=[];for(var l=0;l<e.pointlist[o].length;l++)this.pointlist[o][l]=new Gs(e.pointlist[o][l].x,e.pointlist[o][l].y)}for(this.holes=[],s=0;s<e.holes.length;s++)this.holes.push(e.holes[s]);for(this.comments=[],i=0;i<e.comments.length;i++)this.comments.push(e.comments[i]);for(this.customattributes=[],r=0;r<e.customattributes.length;r++)this.customattributes.push(e.customattributes[i])}}}class Fo{constructor(e,i,r){var s=this;this.markupnumber=0,this.type=e,this.subtype=i,this.alternative=r,this.bRedact=!1,r>=3?this.hatchStyle=r-3:this.hatchprt=0,this.saved=!1,this.firstpointrotAdjusted=!1,this.markupID=0,this.uniqueID=0,this.locked=!1,this.timestamp=(new Date).getTime(),this.layer=rs,this.signature=hs,this.color=ss,this.transparency=cs,this.labeltransparency=100,this.showlabel=!0,this.consolidated=!1,this.linkURL="",this.actionName="",this.imagehref="",this.bhaveLink=!1,this.noDraw=!1,this.addedfoxit=!1,this.bCanHaveLink=1==s.type&&2==s.subtype||3==s.type||4==s.type||5==s.type||9==s.type||11==s.type,this.anglelengthsupport=6==s.type,this.widthHeightsupport=3==s.type,this.setRadiusSupport=4==s.type&&1==s.subtype,this.setPointSupport=1==s.type||8==s.type;var o=1==s.type&&s.subtype;this.editcurpoint=0,this.bpointEdit=!1,this.fillcolor=pn(ns,this.transparency),this.selectSpaceColor="rgba(191,58,209,0.6)",this.selectSpaceStopColor="rgba(255,255,255,0.3)",this.strokecolor=pn(os,100),this.strokecolorSegment=pn("#FFFF00",30),this.textcolor=pn(ls,100),this.markercolor=pn(ns,30),this.labelfillcolor="rgba(255,255,255,1)",this.orthoDrawAngle=0,this.orthoDrawAngledeg=0,this.pagenumber=0,this.viewname=null,this.bfor3D=!1,this.takeOffObject=void 0,this.pagerotation=0,this.documentName=Bs.OriginalURL,this.layout="Default",this.display=!0,this.relativeWH=!1,this.drawn=!1,this.imageloaded=!1,this.arrowTextPos=0,this.padding=void 0,this.labeltype=1,this.bmodyfied=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.origx=0,this.origy=0,this.origw=0,this.origh=0,this.origset=!1,this.radius=0,this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.radiusScaled=0,this.leaderoffset=0,this.labelpos={x:this.x,y:this.y,w:this.w,h:this.h},this.labeloffsetx=0,this.labeloffsety=0,this.labelRect={x:0,y:0,w:0,h:0},this.transformobj={a:1,b:0,c:0,d:1,e:0,f:0},this.rotatedrect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerRightRect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerLeftRect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperLeftRect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperRightRect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.RotmarkerRect=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerRightRectRot=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.LowerLeftRectRot=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperLeftRectRot=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.UpperRightRectRot=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.RotmarkerRectRot=new kn(this.xscaled,this.yscaled,this.wscaled,this.hscaled),this.fixedscaleFactor=1,this.printscale=1,this.pageheight=0,this.pagewidth=0,this.scaling=1,this.xoffset=0,this.yoffset=0,this.scalingext=1,this.xoffsetext=0,this.yoffsetext=0,this.rotation=0,this.textrotate=0,this.bUsemouseinput=!0,this.docdx=Bs.getCurrentpage().getdx(),this.docdy=Bs.getCurrentpage().getdy(),this.docdscale=Bs.getCurrentpage().getdscale(),this.dimtext="",this.dimtextx="",this.dimtexty="",this.dimarea=0,this.dimlength=0,this.hidevaluelabel=!1,this.parentmarkupnumber=0,this.parent=void 0,this.holes=[],this.dimtextangle="",this.customlabeltext="",this.linewidth=ds,this.linewidthSegment=ps,this.linestyle=fs,this.selected=!1,this.marked=!1,this.unselected=!1,this.spaceselected=!1,this.lastselected=!1,this.selectedit=!1,this.setmarkededit=!1,this.firstpointset=!1,this.lastpointset=!1,this.hasScale=!1,this.editaction=0,this.scalecorner=0,this.linesegment={p1:-1,p2:-1},this.multilinesegment={p1:[],p2:[]},this.selectedpoint=-1,this.selectedmultipoint=[],this.bispartofGroup=!1,this.groupRect={x:0,y:0,w:0,h:0},this.textheight=24,this.textwidth=0,this.textdim={width:0,height:0},this.stampsmalltwidth=0,this.stampsmalltheight=0,this.measuretextheight=Ur,this.bhasArrow=!1,this.bisTextArrow=!1,this.markupArrowConnected=null,this.textBoxConnected=null,this.busecustomlabel=!1,this.carpos=0,this.text="",this.intialtextset=!1,this.smalltext="",this.cursorblink=!0,this.fontname="Helvetica",o=1==e&&3==i;var l=1==e&&(4==i||5==i),c=3==e&&6==i,h=8==e,u=7==e,d=1==e&&6==i,g=4==e&&1==i;this.ismeasure=o||l||h||u||d||g,this.font=new en("Helvetica",7==e||8==e||o||l||c?Ur:24,!1,!1),this.arrowlength=Ar+this.linewidth,this.pointlist=[],this.points=[],this.sides=[],this.countshapes=[],this.innerRadius=1,this.outerRadius=1,this.numpoints=-1,this.customattributes=[],this.comments=[],this.delayedloadobj={DocRef:null,xmlDoc:null,fileVersion:null,pageobject:null},this.status="none",this.bMultiOp=!1,this.multiOpId=null;var m=!1,f=!1,y=!1,v=!1,b=!1,x=!1,w=20,k={w:0,h:0},D=22.5,C=(this.linewidth,Math.PI,.5522848);function P(){var e=t.getBoundingClientRect(),a=s.rotatedrect.x+e.left,i=s.rotatedrect.y+e.top,r=s.wscaled,n=s.hscaled,o=Na/2,l=Aa/2,c=a+.5*r,h=i+.5*n,u=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var d=s.getRotatedMarkup(o,l,c,h,u);c=d.x,h=d.y}c+=e.left,h+=e.top;var p=new kn(a,i,r,n);return p.rotation=Bs.getCurrentpage().drotation,p.rotation=s.pagerotation,p}this.scaleObject=new Yl,this.PerformUndo=function(e){this.type=e.type,this.subtype=e.subtype,this.alternative=e.alternative,this.bRedact=e.bRedact,this.consolidated=e.consolidated,this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this.xscaled=e.xscaled,this.yscaled=e.yscaled,this.wscaled=e.wscaled,this.hscaled=e.hscaled,this.timestamp=e.timestamp,this.layer=e.layer,this.signature=e.signature,this.color=e.color,this.fillcolor=e.fillcolor,this.strokecolor=e.strokecolor,this.textcolor=e.textcolor,this.scaling=e.scaling,this.xoffset=e.xoffset,this.yoffset=e.yoffset,this.docdx=e.docdx,this.docdy=e.docdy,this.docdscale=e.docdscale,this.scalingext=e.scalingext,this.xoffsetext=e.xoffsetext,this.yoffsetext=e.yoffsetext,this.rotation=e.rotation,this.textrotate=e.textrotate,this.dimtext=e.dimtext,this.linewidth=e.linewidth,this.textheight=e.textheight,this.measuretextheight=e.measuretextheight,this.textwidth=e.textwidth,this.text=e.text,this.font=e.font,this.editcurpoint=0,this.points=e.points.slice(),this.countshapes=e.countshapes.slice(),this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.numpoints=e.points.length-1;for(var t=0;t<e.pointlist.length;t++)this.pointlist[t]=e.pointlist[t].slice();e.bdelete&&(this.addsides(),Xo(e.markupnumber))},this.setmultiValues=function(e){this.bMultiOp=!0,this.multiOpId=e},this.resetmultiValues=function(){this.bMultiOp=!1,this.multiOpId=null},this.resetmarkupmodified=function(){s.bmodyfied=!1},this.getJSONUniqueID=function(e){return new Promise((function(t,a){ze.connect((function(e,i,r){if(r){var n=bc(s,Bs,Bs.getPageObject(s.pagenumber),!1,i);t(n)}else a(e)})),function(e,t){if(e.created||0==t.uniqueID){var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetGUID</Command>",a+="<LicenseID>"+_i+"</LicenseID>",Kc("POST",p,"",a+="</RxViewServer>").then((function(a){var i=a;t.setUniqueID(i),null!=ze&&ze.guidcomplete(i,e,!0)})).catch((function(t){t.status?console.log(t.status):console.log(t),null!=ze&&ze.guidcomplete(t,e,!1)}))}else null!=ze&&ze.guidcomplete(t.uniqueID,e,!0)}(e,s)}))},this.getJSON=function(e){return bc(s,Bs,Bs.getPageObject(s.pagenumber),!1,e)},this.setmarkupmodified=function(e){s.bmodyfied||Co(s),s.bmodyfied=e},this.getmarkupmodified=function(){return s.bmodyfied},this.multipoint=function(){return 8==s.type||1==s.type||13==s.type},this.isSelected=function(e){var t=!1,a=s.selectedit&&9!=s.type,i=s.selected||a;return!(9==s.type&&s.bhasArrow)&&i&&s.pagenumber==e&&(t=!0),t},this.getselected=function(){return s.multipoint()?s.selectedit:s.selected},this.getmarked=function(){return s.marked},this.setselectedit=function(e){s.signature==hs?s.selectedit=e:(s.setmarkededit=e,s.setmarked(e))},this.setTextBoxArrowSelect=function(e){s.selected=e},this.setmarked=function(e){s.marked=e},this.onselect=function(e,t){var a=!0;if(s.bhaveLink&&(Bs.bMarkupLocked||s.locked)){var i={found:!1,blink:!0,id:s.markupnumber,locked:s.locked,index:e};return i}if(s.selectedit){if(s.setselect(!1),s.bUsemouseinput=!0,i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},4==s.editaction||8==s.editaction)return i}else{if(2==s.editaction||3==s.editaction)return a&&(s.setselect(!0),i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},a=!1,s.bUsemouseinput=!0),i;switch($i||s.getselected()||(Ho(),a=!0),s.type){case 1:a&&(s.setselectedit(!0),s.setselect(!1),s.bUsemouseinput=!0,s.lastselected=!0,i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},s.lengthangleCallbackSelect(),a=!1);break;case 8:(t||1!=s.subtype)&&a&&(s.setselectedit(!0),s.setselect(!1),s.bUsemouseinput=!0,s.lastselected=!0,i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},s.lengthangleCallbackSelect(),a=!1);break;case 13:a&&(s.setselectedit(!0),s.setselect(!1),s.bUsemouseinput=!0,s.lastselected=!0,i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},a=!1);break;default:a&&(s.setselect(!0),s.lastselected=!0,i={found:!0,blink:!1,id:s.markupnumber,locked:!1,index:e},s.lengthangleCallbackSelect(),a=!1)}}return i},this.unselect=function(){s.selected&&(s.setselect(!1),s.bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(s)),s.selectedit&&(s.selectedit=!1,s.bpointEdit=!1,s.bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(s))},this.selectSet=function(){s.multipoint()?s.setselectedit(!0):s.setselect(!0),null!=zt&&(9==s.type&&s.subtype,zt.setMarkupSelected(s,{created:!1,modified:!1,deleted:!1}))},this.setselect=function(e){if(s.signature==hs){if(s.selected=e,s.bhasArrow&&null!=s.markupArrowConnected)return void s.markupArrowConnected.setselect(e);s.bisTextArrow&&null!=s.textBoxConnected&&s.textBoxConnected.setTextBoxArrowSelect(e)}else if(s.setmarkededit&&!e)s.setmarked(s.setmarkededit),s.setmarkededit=!1;else{if(s.setmarked(e),s.bhasArrow&&null!=s.markupArrowConnected)return void s.markupArrowConnected.setmarked(e);s.bisTextArrow&&null!=s.textBoxConnected&&s.textBoxConnected.setmarked(e)}},this.getTextSize=function(){var e={numlines:0,textheight:0,rect:null};if(9==s.type){if(ui){var t=s.fixedscaleFactor;t*=Xr}else t=scalefactor;var a=this.font.height*t,i=this.font.height/4*2*t;e.textheight=a+i,e.numlines=s.text.split("\n").length,e.rect=P()}return e},this.editTextmarkupRect=function(){if(null!=Bt){Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.edit=!0,Bt.operation.save=!1,Bt.operation.markup=s;var e=t.getBoundingClientRect(),a=s.rotatedrect.x+e.left,i=s.rotatedrect.y+e.top,r=s.wscaled,n=s.hscaled,o=Na/2,l=Aa/2,c=a+.5*r,h=i+.5*n,u=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var d=s.getRotatedMarkup(o,l,c,h,u);c=d.x,h=d.y}c+=e.left,h+=e.top;var p=new kn(a,i,r,n);p.rotation=Bs.getCurrentpage().drotation,p.rotation=s.pagerotation;var g=ll();p.x=(p.x-e.left)/g+e.left,p.y=(p.y-e.top)/g+e.top,p.w=p.w/g,p.h=p.h/g,Bt.setTextInput(p),Bs.selectedmarkup.edit=!1}},this.ChangeMarkup=function(e){switch(e){case 0:s.savemarkupstate(Bs,1),s.layer=rs;break;case 1:s.savemarkupstate(Bs,1),s.strokecolor=pn(os,100);break;case 2:if(s.linewidth=ds,6==s.type||7==s.type){var t=Ar;t+=ds,s.arrowlength=t}s.setmarkupmodified(!0);break;case 3:s.savemarkupstate(Bs,1),s.alternative=ms,s.alternative>=3&&(s.hatchStyle=s.alternative-3);break;case 4:s.savemarkupstate(Bs,1),s.font.setFontname(tn.fontName),s.font.setHeight(tn.height),s.font.setBold(tn.bold),s.font.setItalic(tn.italic);break;case 5:break;case 6:cn(s.fillcolor)&&(s.fillcolor=pn(s.fillcolor,100)),cn(s.strokecolor)&&(s.strokecolor=pn(s.strokecolor,100)),s.fillcolor=hn(s.fillcolor,cs),s.strokecolor=hn(s.strokecolor,100),s.transparency=cs,s.setmarkupmodified(!0);break;case 7:s.savemarkupstate(Bs,1),s.fillcolor=pn(ns,s.transparency);break;case 8:s.savemarkupstate(Bs,1),s.textcolor=pn(ls,100);break;case 9:s.savemarkupstate(Bs,1),s.linestyle=fs;break;case 10:s.savemarkupstate(Bs,1),(6==s.type||7==s.type)&&(t=Ar,t+=s.linewidth,s.arrowlength=t);break;case 11:s.savemarkupstate(Bs,1);var a=1==s.type&&3==s.subtype,i=1==s.type&&(4==s.subtype||5==s.subtype);(8==s.type||7==s.type||a||i)&&s.font.setHeight(Ur);break;case 12:s.labelfillcolor=hn(s.labelfillcolor,cs),s.labeltransparency=cs,s.setmarkupmodified(!0);break;case 13:s.savemarkupstate(Bs,1),13==s.type&&s.setCountSize(Gr);break;case 14:s.savemarkupstate(Bs,1),s.setdisplay(!1);break;case 15:s.savemarkupstate(Bs,1),s.setdisplay(!0);break;case 16:s.savemarkupstate(Bs,1),s.showperimeter(!0);break;case 17:s.savemarkupstate(Bs,1),s.showperimeter(!1);break;case 18:s.savemarkupstate(Bs,1),1==s.type&&4==s.subtype?s.subtype=5:1==s.type&&5==s.subtype&&(s.subtype=4);break;case 19:s.linewidthSegment=ps,s.setmarkupmodified(!0)}if(null!=Wt){var r=s.editaction;Wt.setMarkupSelected(s,r)}},this.settxtboxArrow=function(e){if(9==s.type||1==s.subtype){s.bhasArrow=!0,s.markupArrowConnected=e,e.bisTextArrow=!0;var t=Ln(),a=On();if(s.fixedscaleFactor=t/a,ui){var i=s.fixedscaleFactor;i*=Xr}else i=t;s.font.setScale(i),e.textBoxConnected=s}},this.setLink=function(e,t){s.linkURL=e,s.bhaveLink=t},this.setAction=function(e,t){s.actionName=e,s.bhaveLink=t},this.getLink=function(){return{bCanHaveLink:s.bCanHaveLink,link:s.linkURL,bhavelink:s.bhaveLink}},this.getUniqueID=function(){return s.uniqueID},this.setdelete=function(){x=!0},this.getdelete=function(){return x},this.setUniqueID=function(e){0==s.uniqueID&&function(e){for(var t=!0,a=0;a<Xs.length;a++)for(var i=0;i<Xs[a].markuplist.length;i++)null!=Xs[a].markuplist[i]&&Xs[a].markuplist[i].getUniqueID()==e&&(t=!1);return t}(e)&&(s.uniqueID=e)},this.setRxUniqueID=function(){pc(s)},this.onRotate=function(){},this.SetFromStorage=function(){},this.calculateDrawAngle=function(e){var t=Math.atan2(e.h-e.y,e.w-e.x);t<0&&(t+=2*Math.PI),s.orthoDrawAngle=t,s.orthoDrawAngledeg=s.orthoDrawAngle*(180/Math.PI)},this.calculateLength=function(e){var t=Math.max(e[0].x,e[1].x)-Math.min(e[0].x,e[1].x),a=Math.max(e[0].y,e[1].y)-Math.min(e[0].y,e[1].y);return s.getdiag(t,a)},this.calculateOrthoPoints=function(e){return Math.atan2(-(e[1].y-e[0].y),e[1].x-e[0].x)},this.getClosestDegree=function(e,t){var a=0,i=!0,r=0,s=Math.abs(t-r);for(a=r;i;){r+=e;var n=Math.abs(t-r);n<s&&(s=n,a=r,360==r&&(a=0)),360==r&&(i=!1)}return a},this.calculateOrthoDraw=function(e,t){var a=s.calculateLength([{x:e.x,y:e.y},{x:t.x,y:t.y}]),i=s.calculateOrthoPoints([{x:e.x,y:e.y},{x:t.x,y:t.y}]);i<0&&(i+=2*Math.PI);var r=i*(180/Math.PI),n=s.getClosestDegree(kr,r);return s.setAnglelengthUnscaled(e,a,n,void 0)},this.calculateOrtho=function(e,t,a){var i=s.calculateLength([{x:this.x,y:this.y},{x:a.x,y:a.y}]),r=s.calculateOrthoPoints([{x:this.x,y:this.y},{x:this.w,y:this.h}]);Bs.getCurrentpage().drotation,Math.PI,r<0&&(r+=2*Math.PI);var n=r*(180/Math.PI),o=s.getClosestDegree(kr,n);a=s.setAnglelengthUnscaled({x:this.x,y:this.y},i,o,void 0),e&&1==t?(this.x=a.w,this.y=a.h):(this.w=a.w,this.h=a.h)},this.ClearAttributes=function(){this.customattributes=[]},this.ClearComments=function(){this.comments=[]},this.ConsolidateList=function(e,t){Vs.add(s,e,t)},this.Consolidate=function(e){To(s),Bs.bMarkupchanged=!0,s.bhasArrow&&null!=s.markupArrowConnected&&s.markupArrowConnected.Consolidate(e),s.consolidated=!0,s.setdisplay(Sn(hs)),s.signature=hs,e.changeStrokeColor&&(s.strokecolor=e.strokecolor),e.changeTexColort&&(s.textcolor=e.textcolor),e.changeLayer&&(s.layer=e.layer),al(n),il(a),null!=oa&&oa.Consolidatevt(s),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive)},this.AddAttribute=function(e,t){var a={name:e,value:t};s.customattributes.push(a)},this.CreateComment=function(e){9==s.type||10==s.type||(s.text=e)},this.AddCommentInternal=function(e,t,a){var i={id:e,signature:t,value:a};s.comments.push(i)},this.AddComment=function(e,t,a){var i={id:e,signature:t,value:a};if(s.comments.push(i),s.comments.length>0&&s.savemarkupstate(Bs,1),null!=Wt){var r=s.editaction;Wt.setMarkupSelected(s,r)}},this.GetComments=function(){return s.comments},this.GetAttribute=function(e){for(var t=void 0,a=0;a<s.customattributes.length;a++)s.customattributes[a].name==e&&(t=s.customattributes[a]);return t},this.GetAttributes=function(){return s.customattributes},this.deleteAttribute=function(e){for(var t=-1,a=0;a<s.customattributes.length;a++)s.customattributes[a].name==e&&(t=a);-1!=t&&s.customattributes.splice(t,1)},this.deleteComment=function(e){for(var t=-1,a=0;a<s.comments.length;a++)s.comments[a].id==e&&(t=a);if(-1!=t&&s.comments.splice(t,1),null!=Wt){var i=s.editaction;Wt.setMarkupSelected(s,i)}},this.findAttribute=function(e,t){for(var a=!1,i=0;i<s.customattributes.length;i++)s.customattributes[i].name==e&&s.customattributes[i].value==t&&(a=!0);return a},this.updateAttribute=function(e,t){for(var a=0;a<s.customattributes.length;a++)s.customattributes[a].name==e&&(s.customattributes[a].name=e,s.customattributes[a].value=t)},this.editComment=function(e,t){for(var a=0;a<s.comments.length;a++)s.comments[a].id==e&&(s.comments[a].value=t);if(null!=Wt){var i=s.editaction;Wt.setMarkupSelected(s,i)}},this.restorestampfontSize=function(){s.font.setHeight(.16*s.w),0==s.alternative?(s.stampsmalltheight=.08*s.w-4,s.stampsmalltheight<1&&(s.stampsmalltheight=1),s.textheight+s.stampsmalltheight+s.h/10*2>s.h&&(s.font.setHeight(s.h/2-s.h/10*2),s.stampsmalltheight=s.textheight/2-4,s.stampsmalltheight<1&&(s.stampsmalltheight=1))):.6*s.w>=s.h?s.font.setHeight(s.h/4):s.font.setHeight(.16*s.w)},this.updatePageMarkup=function(e){null!=s.delayedloadobj.DocRef&&null!=s.delayedloadobj.xmlDoc&&null!=s.delayedloadobj.fileVersion&&(s.delayedloadobj.pageobject=e,s.SetfromXML(s.delayedloadobj.DocRef,s.delayedloadobj.xmlDoc,s.delayedloadobj.fileVersion))},this.setfromJSON=function(e,t){b=!1;var a=JSON.parse(t);if(null!=a.Entity&&null!=a.Entity){null!=a.Entity.View?this.pagenumber=a.Entity.View:this.pagenumber=0,null!=a.Entity.ViewName3D?(this.viewname=a.Entity.ViewName3D,null!=a.Entity.For3DView&&(this.bfor3D=1==a.Entity.For3DView),null!=a.Entity.PageHeight3D&&(this.pageheight=PageHeight3D),null!=a.Entity.PageWidth3D&&(this.pagewidth=PageWidth3D)):(this.viewname=null,this.bfor3D=!1),f=!0,y=!0;var i=e.getPageObject(this.pagenumber);if(null!=a.Entity.Rect&&(this.x=a.Entity.Rect.x,this.y=a.Entity.Rect.y,this.w=a.Entity.Rect.w,this.h=a.Entity.Rect.h),isNaN(this.x)&&(this.x=10),isNaN(this.y)&&(this.y=10),isNaN(this.w)&&(this.w=100),isNaN(this.h)&&(this.h=100),null!=a.Entity.FixedScale&&(m=1==a.Entity.FixedScale),null!=a.Entity.Redaction?this.bRedact=1==a.Entity.Redaction:this.bRedact=!1,0==this.h&&0==this.w&&8!=this.type&&1!=this.type&&2!=this.type&&0!=this.type)return!1;if(8==this.type||1==this.type||this.type,this.bCanHaveLink=1==this.type&&2==this.subtype||3==this.type||4==this.type||5==this.type||9==this.type||11==this.type,null!=a.Entity.HaveLink&&(this.bhaveLink=1==a.Entity.HaveLink),null!=a.Entity.LinkURL&&(this.linkURL=a.Entity.LinkURL),null!=a.Entity.Layer?this.layer=a.Entity.Layer:this.layer=rs,null!=a.Entity.TimeStamp&&(this.timestamp=a.Entity.TimeStamp),null!=a.Entity.Rotation&&(this.rotation=a.Entity.Rotation),null!=a.Entity.Extended)for(var r=0;r<a.Entity.Extended.length;r++)this.AddAttribute(a.Entity.Extended[r].tagname,a.Entity.Extended[r].tagvalue);if(null!=a.Entity.Comments){s.comments=[];for(var n=0;n<a.Entity.Comments.length;n++)s.AddCommentInternal(a.Entity.Comments[n].id,a.Entity.Comments[n].signature,a.Entity.Comments[n].value)}if(null!=a.Entity.Consolidated&&(this.consolidated=1==a.Entity.Consolidated),null!=a.Entity.TextRotation&&(this.textrotate=a.Entity.TextRotation),null!=a.Entity.PageRotation&&(this.pagerotation=a.Entity.PageRotation),null!=a.Entity.FileName&&(this.documentName=a.Entity.FileName),null!=a.Entity.Layout&&(this.layout=a.Entity.Layout),null!=a.Entity.Color&&(this.color=a.Entity.Color),null!=a.Entity.UniqueID&&(this.uniqueID=a.Entity.UniqueID),null!=a.Entity.DocOffsetX?this.docdx=a.Entity.DocOffsetX:this.docdx=null!=i?i.getdx():0,null!=a.Entity.DocOffsetY?this.docdy=a.Entity.DocOffsetY:this.docdy=null!=i?i.getdy():0,null!=a.Entity.DocScale?this.docdscale=a.Entity.DocScale:this.docdscale=null!=i?i.getdscale():1,null!=a.Entity.Transparency&&(this.transparency=a.Entity.Transparency),3==this.type&&3==this.subtype&&(this.transparency=30,this.fillcolor=hn(this.fillcolor,this.transparency)),null!=a.Entity.LineColor&&(this.strokecolor=a.Entity.LineColor,cn(this.strokecolor)?this.strokecolor=pn(this.strokecolor,100):this.strokecolor=hn(this.strokecolor,100)),null!=a.Entity.TextColor&&(this.textcolor=a.Entity.TextColor,cn(this.textcolor)?this.textcolor=pn(this.textcolor,100):this.textcolor=hn(this.textcolor,100)),null!=a.Entity.Scaling&&(this.scaling=a.Entity.Scaling,isFinite(this.scaling)||(this.scaling=1),isNaN(this.scaling)&&(this.scaling=1)),null!=a.Entity.FillColor&&(this.fillcolor=a.Entity.FillColor,cn(this.fillcolor)?this.fillcolor=pn(this.fillcolor,this.transparency):this.fillcolor=hn(this.fillcolor,this.transparency)),null!=a.Entity.Font.Font.facename&&(this.fontname=a.Entity.Font.Font.facename),null!=a.Entity.Font.height&&(this.textheight=a.Entity.Font.Font.height),null==this.fontname&&null==this.textheight||(this.font=new en(this.fontname,this.textheight,!1,!1)),null!=a.Entity.Font){var o=a.Entity.Font.Font.facename,l=a.Entity.Font.Font.height,c=1==a.Entity.Font.Font.bold,h=1==a.Entity.Font.Font.italic;this.font=new en(o,l,c,h),this.textheight=l}if(null!=a.Entity.Signature&&(this.signature=a.Entity.Signature),null!=a.Entity.Xoffset&&(this.xoffset=a.Entity.Xoffset),null!=a.Entity.Yoffset&&(this.yoffset=a.Entity.Yoffset),isNaN(this.xoffset)&&(this.xoffset=0),isNaN(this.yoffset)&&(this.yoffset=0),7==this.type&&null!=a.Entity.LeaderLineOffset&&(this.leaderoffset=a.Entity.LeaderLineOffset),8==this.type&&(null!=a.Entity.LabelOffsetX&&(this.labeloffsetx=a.Entity.LabelOffsetX),null!=a.Entity.LabelOffsetY&&(this.labeloffsety=a.Entity.LabelOffsetY),null!=a.Entity.LabelColor&&(this.labelfillcolor=a.Entity.LabelColor)),null!=a.Entity.LineWidth&&(this.linewidth=a.Entity.LineWidth),null!=a.Entity.LineWidthSegment?this.linewidthSegment=a.Entity.LineWidthSegment:this.linewidthSegment=ps,null!=a.Entity.ArrowSize&&(this.arrowlength=a.Entity.ArrowSize),null!=a.Entity.LineStyle&&(this.linestyle=a.Entity.LineStyle),null!=a.Entity.Text?(this.text=a.Entity.Text,"."==this.text&&(this.text="")):this.text="",null!=a.Entity.Status&&(this.status=a.Entity.Status),null!=a.Entity.SmallText&&(this.smalltext=a.Entity.SmallText,"."==this.smalltext&&(this.smalltext="")),null!=a.Entity.DimText?(this.dimtext=a.Entity.DimText,"."==this.dimtext&&(this.dimtext="")):this.dimtext="",null!=a.Entity.CustomLabelText?(this.customlabeltext=a.Entity.CustomLabelText,"."==this.customlabeltext&&(this.customlabeltext="")):this.customlabeltext="",null!=a.Entity.CustomLabelOn&&(this.busecustomlabel=1==a.Entity.CustomLabelOn),13==this.type&&(null!=a.Entity.innerRadius&&(this.innerRadius=a.Entity.innerRadius),null!=a.Entity.outerRadius&&(this.outerRadius=a.Entity.outerRadius),this.removepoints(),null!=a.Entity.Points)){if(0==(v=a.Entity.Points.Point).length)return!1;for(var u=0;u<v.length;u++){var d=v[u].x,p=v[u].y;s.addcountLoad({x:d,y:p})}}var g=1==this.type&&6==this.subtype;if((1==this.type||2==this.type||8==this.type)&&!g&&(this.removepoints(),null!=a.Entity.Points)){var v;if(0==(v=a.Entity.Points.Point).length)return!1;for(u=0;u<v.length;u++)d=v[u].x,p=v[u].y,s.addpoint(d,p);s.findrectangle()}if(0==this.type||g){if(this.removepoints(),null==a.Entity.Line||0==a.Entity.Line.length)return!1;var x=a.Entity.Line;for(u=0;u<x.length;u++){for(var w=x[u].Point,k=0;k<w.length;k++){d=w[k].x,p=w[k].y;var D=new Gs(d,p);this.points.push(D)}this.pointlist.push(this.points),this.points=[]}}if(12==this.type&&(null==this.transparency&&(this.transparency=30,this.fillcolor=hn(this.fillcolor,this.transparency)),100==this.subtype&&(this.text=a.Entity.Text),this.font.setFontname("Times New Roman"),this.font.setBold(!0)),11==this.type){var C=new Image;if(null!=a.Entity.SvgContent&&(s.svgContent=a.Entity.SvgContent,s.markupsvgload(a.Entity.SvgContent,C)),null!=a.Entity.Image){var P=a.Entity.Image.image;P=P.slice(9,P.length-3),s.markupcdataload(C,P)}else if(null!=a.Entity.Imagehref){var S=a.Entity.Imagehref;s.imagehref=S,s.markupimageload(S,C)}else this.type=3,this.subtype=0,this.alternative=0}}return!0},this.SetfromXML=function(e,t,a){null!=t.getElementsByTagName("View")[0]?this.pagenumber=parseInt(t.getElementsByTagName("View")[0].firstChild.nodeValue):this.pagenumber=0,null!=t.getElementsByTagName("ViewName3D")[0]?(this.viewname=t.getElementsByTagName("ViewName3D")[0].firstChild.nodeValue,null!=t.getElementsByTagName("For3DView")[0]&&(this.bfor3D=1==parseInt(t.getElementsByTagName("For3DView")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageHeight3D")[0]&&(this.pageheight=parseInt(t.getElementsByTagName("PageHeight3D")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageWidth3D")[0]&&(this.pagewidth=parseInt(t.getElementsByTagName("PageWidth3D")[0].firstChild.nodeValue))):(this.viewname=null,this.bfor3D=!1),f="C360"==a||"C365"==a||"C366"==a||"C370"==a,y="C370"==a;var i=e.getPageObject(this.pagenumber);if(this.x=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("x").value),this.y=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("y").value),this.w=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("w").value),this.h=parseFloat(t.getElementsByTagName("Rect")[0].attributes.getNamedItem("h").value),isNaN(this.x)&&(this.x=10),isNaN(this.y)&&(this.y=10),isNaN(this.w)&&(this.w=100),isNaN(this.h)&&(this.h=100),null!=t.getElementsByTagName("FixedScale")[0]&&(m=1==parseFloat(t.getElementsByTagName("FixedScale")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("Redaction")[0]&&(this.bRedact=1==parseInt(t.getElementsByTagName("Redaction")[0].firstChild.nodeValue)),0==this.h&&0==this.w&&8!=this.type&&1!=this.type&&2!=this.type&&0!=this.type)return!1;if(8==this.type||1==this.type||this.type,this.bCanHaveLink=1==this.type&&2==this.subtype||3==this.type||4==this.type||5==this.type||9==this.type||11==this.type,null!=t.getElementsByTagName("HaveLink")[0]&&(this.bhaveLink=1==parseInt(t.getElementsByTagName("HaveLink")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("LinkURL")[0]&&null!=t.getElementsByTagName("LinkURL")[0].firstChild&&(this.linkURL=t.getElementsByTagName("LinkURL")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Layer")[0]?this.layer=t.getElementsByTagName("Layer")[0].firstChild.nodeValue:this.layer=rs,this.timestamp=parseInt(t.getElementsByTagName("TimeStamp")[0].firstChild.nodeValue),this.rotation=parseFloat(t.getElementsByTagName("Rotation")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Extended")[0]){var r=t.getElementsByTagName("Extended")[0].childNodes;this.customattributes=[];for(var n=0;n<r.length;n++)if(null!=r[n].firstChild){var o=r[n].nodeName,l=r[n].firstChild.nodeValue;this.AddAttribute(o,l)}}if(null!=t.getElementsByTagName("Comments")[0]){var c=t.getElementsByTagName("Comments")[0].childNodes;for(this.comments=[],n=0;n<c.length;n++)if(null!=c[n].firstChild){var h=c[n].nodeName,u=(l=c[n].firstChild.nodeValue,c[n].attributes.getNamedItem("Signature").value);this.AddCommentInternal(h,u,l)}}if(null!=t.getElementsByTagName("Consolidated")[0]&&(this.consolidated=1==parseInt(t.getElementsByTagName("Consolidated")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("TextRotation")[0]&&(this.textrotate=parseFloat(t.getElementsByTagName("TextRotation")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("PageRotation")[0]&&(this.pagerotation=parseFloat(t.getElementsByTagName("PageRotation")[0].firstChild.nodeValue)),this.documentName=t.getElementsByTagName("FileName")[0].firstChild.nodeValue,this.layout=t.getElementsByTagName("Layout")[0].firstChild.nodeValue,null!=t.getElementsByTagName("Color")[0]&&(this.color=t.getElementsByTagName("Color")[0].firstChild.nodeValue),null!=t.getElementsByTagName("Handle")[0]&&(this.markupID=parseInt(t.getElementsByTagName("Handle")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("UniqueID")[0]&&(this.uniqueID=t.getElementsByTagName("UniqueID")[0].firstChild.nodeValue,"0"==this.uniqueID&&(this.uniqueID=parseInt(this.uniqueID))),Va&&0==s.uniqueID&&pc(s),null!=t.getElementsByTagName("DocOffsetX")[0]?this.docdx=parseFloat(t.getElementsByTagName("DocOffsetX")[0].firstChild.nodeValue):this.docdx=null!=i?i.getdx():0,null!=t.getElementsByTagName("DocOffsetY")[0]?this.docdy=parseFloat(t.getElementsByTagName("DocOffsetY")[0].firstChild.nodeValue):this.docdy=null!=i?i.getdy():0,null!=t.getElementsByTagName("DocScale")[0]?this.docdscale=parseFloat(t.getElementsByTagName("DocScale")[0].firstChild.nodeValue):this.docdscale=null!=i?i.getdscale():1,null!=t.getElementsByTagName("Transparency")[0]&&(this.transparency=parseInt(t.getElementsByTagName("Transparency")[0].firstChild.nodeValue)),3==this.type&&3==this.subtype&&(this.transparency=30,this.fillcolor=hn(this.fillcolor,this.transparency)),null!=t.getElementsByTagName("LineColor")[0]&&(this.strokecolor=t.getElementsByTagName("LineColor")[0].firstChild.nodeValue,cn(this.strokecolor)?this.strokecolor=pn(this.strokecolor,100):this.strokecolor=hn(this.strokecolor,100)),null!=t.getElementsByTagName("TextColor")[0]&&(this.textcolor=t.getElementsByTagName("TextColor")[0].firstChild.nodeValue,cn(this.textcolor)?this.textcolor=pn(this.textcolor,100):this.textcolor=hn(this.textcolor,100)),this.scaling=parseFloat(t.getElementsByTagName("Scaling")[0].firstChild.nodeValue),isFinite(this.scaling)||(this.scaling=1),isNaN(this.scaling)&&(this.scaling=1),null!=t.getElementsByTagName("FillColor")[0]&&(this.fillcolor=t.getElementsByTagName("FillColor")[0].firstChild.nodeValue,cn(this.textcolor)?this.fillcolor=pn(this.fillcolor,this.transparency):this.fillcolor=hn(this.fillcolor,this.transparency)),null!=t.getElementsByTagName("FontName")[0]&&(this.fontname=t.getElementsByTagName("FontName")[0].firstChild.nodeValue),null!=t.getElementsByTagName("FontHeight")[0]&&(this.textheight=t.getElementsByTagName("FontHeight")[0].firstChild.nodeValue),null==this.fontname&&null==this.textheight||(this.font=new en(this.fontname,this.textheight,!1,!1)),null!=t.getElementsByTagName("Font")[0]){var d=t.getElementsByTagName("Font")[0].attributes.getNamedItem("facename").value,p=parseFloat(t.getElementsByTagName("Font")[0].attributes.getNamedItem("height").value),g=1==parseInt(t.getElementsByTagName("Font")[0].attributes.getNamedItem("bold").value),v=1==parseInt(t.getElementsByTagName("Font")[0].attributes.getNamedItem("italic").value);this.font=new en(d,p,g,v),this.textheight=p}if(this.signature=t.getElementsByTagName("Signature")[0].firstChild.nodeValue,this.xoffset=parseFloat(t.getElementsByTagName("Xoffset")[0].firstChild.nodeValue),this.yoffset=parseFloat(t.getElementsByTagName("Yoffset")[0].firstChild.nodeValue),isNaN(this.xoffset)&&(this.xoffset=0),isNaN(this.yoffset)&&(this.yoffset=0),7==this.type&&null!=t.getElementsByTagName("LeaderLineOffset")[0]&&(this.leaderoffset=t.getElementsByTagName("LeaderLineOffset")[0].firstChild.nodeValue),8==this.type&&(null!=t.getElementsByTagName("LabelOffsetX")[0]&&(this.labeloffsetx=t.getElementsByTagName("LabelOffsetX")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LabelOffsetY")[0]&&(this.labeloffsety=t.getElementsByTagName("LabelOffsetY")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LabelColor")[0]&&(this.labelfillcolor=t.getElementsByTagName("LabelColor")[0].firstChild.nodeValue)),this.linewidth=parseFloat(t.getElementsByTagName("LineWidth")[0].firstChild.nodeValue),null!=t.getElementsByTagName("LineWidthSegment")[0]?this.linewidthSegment=parseFloat(t.getElementsByTagName("LineWidthSegment")[0].firstChild.nodeValue):this.linewidthSegment=ps,null!=t.getElementsByTagName("ArrowSize")[0]&&(this.arrowlength=parseInt(t.getElementsByTagName("ArrowSize")[0].firstChild.nodeValue)),null!=t.getElementsByTagName("LineStyle")[0]&&(this.linestyle=parseFloat(t.getElementsByTagName("LineStyle")[0].firstChild.nodeValue)),this.text=t.getElementsByTagName("Text")[0].firstChild.nodeValue,"."==this.text&&(this.text=""),null!=t.getElementsByTagName("Status")[0]&&(this.status=t.getElementsByTagName("Status")[0].firstChild.nodeValue),null!=t.getElementsByTagName("SmallText")[0]&&(this.smalltext=t.getElementsByTagName("SmallText")[0].firstChild.nodeValue,"."==this.smalltext&&(this.smalltext="")),null!=t.getElementsByTagName("DimText")[0]&&null!=t.getElementsByTagName("DimText")[0].firstChild?(this.dimtext=t.getElementsByTagName("DimText")[0].firstChild.nodeValue,"."==this.dimtext&&(this.dimtext="")):this.dimtext="",null!=t.getElementsByTagName("CustomLabelText")[0]&&null!=t.getElementsByTagName("CustomLabelText")[0].firstChild?(this.customlabeltext=t.getElementsByTagName("CustomLabelText")[0].firstChild.nodeValue,"."==this.customlabeltext&&(this.customlabeltext="")):this.customlabeltext="",null!=t.getElementsByTagName("CustomLabelOn")[0]&&(this.busecustomlabel=1==parseInt(t.getElementsByTagName("CustomLabelOn")[0].firstChild.nodeValue)),13==this.type){if(this.innerRadius=parseFloat(t.getElementsByTagName("innerRadius")[0].firstChild.nodeValue),this.outerRadius=parseFloat(t.getElementsByTagName("outerRadius")[0].firstChild.nodeValue),this.removepoints(),0==t.getElementsByTagName("Point").length)return!1;for(var b=t.getElementsByTagName("Point"),x=0;x<b.length;x++){var w=parseFloat(b[x].attributes.getNamedItem("x").value),k=parseFloat(b[x].attributes.getNamedItem("y").value);s.addcountLoad({x:w,y:k})}}var D=1==this.type&&6==this.subtype;if((1==this.type||2==this.type||8==this.type)&&!D){if(this.removepoints(),0==t.getElementsByTagName("Point").length)return!1;for(b=t.getElementsByTagName("Point"),x=0;x<b.length;x++)w=parseFloat(b[x].attributes.getNamedItem("x").value),k=parseFloat(b[x].attributes.getNamedItem("y").value),s.addpoint(w,k);s.findrectangle()}if(0==this.type||D){if(this.removepoints(),0==t.getElementsByTagName("Line").length)return!1;var C=t.getElementsByTagName("Line");for(x=0;x<C.length;x++){for(var P=C[x].getElementsByTagName("Point"),S=0;S<P.length;S++){w=parseFloat(P[S].attributes.getNamedItem("x").value),k=parseFloat(P[S].attributes.getNamedItem("y").value);var R=new Gs(w,k);this.points.push(R)}this.pointlist.push(this.points),this.points=[]}}if(12==this.type&&(null==this.transparency&&(this.transparency=30,this.fillcolor=hn(this.fillcolor,this.transparency)),100==this.subtype&&(this.text=t.getElementsByTagName("Text")[0].firstChild.nodeValue),this.font.setFontname("Times New Roman"),this.font.setBold(!0)),11==this.type){var M=new Image;if(null!=t.getElementsByTagName("SvgContent")[0]&&null!=t.getElementsByTagName("SvgContent")[0].firstChild){var T=t.getElementsByTagName("SvgContent")[0].firstChild.nodeValue;s.svgContent=T,s.markupsvgload(T,M)}if(null!=t.getElementsByTagName("Image")[0]&&null!=t.getElementsByTagName("Image")[0].firstChild){if(""!=t.getElementsByTagName("Image")[0].firstChild.nodeValue){if("\n"==t.getElementsByTagName("Image")[0].firstChild.nodeValue)var E=t.getElementsByTagName("Image")[0].firstChild.nextSibling.nodeValue;else E=(E=t.getElementsByTagName("Image")[0].firstChild.nodeValue).slice(9,E.length-3);s.markupcdataload(M,E)}}else if(null!=t.getElementsByTagName("Imagehref")[0]&&null!=t.getElementsByTagName("Imagehref")[0].firstChild){var F=t.getElementsByTagName("Imagehref")[0].firstChild.nodeValue;s.imagehref=F,s.markupimageload(F,M)}else this.type=3,this.subtype=0,this.alternative=0}return!0},this.markupcdataload=function(e,t){e.onload=function(t){s.image=e,s.imageloaded=!0,al(n),il(a)},e.src=t},this.markupcdataset=function(e,t,a){e.onload=function(t){s.image=e,s.imageloaded=!0,a(s.image)},e.src=t},this.markupimageblob=function(e,t){return new Promise((function(a,i){var r=(window.URL||window.webkitURL).createObjectURL(e);r&&s.markupcdataset(t,r,a)}))},this.markupimageload=function(e,t){Kc("GET",e,"blob").then((function(e){var a=URL.createObjectURL(e);a&&s.markupcdataload(t,a)})).catch((function(e){e.status?console.log("markupimageload",e.status):console.log("markupimageload",e)}))},this.markupsvgload=function(e,t){var a="data:image/svg+xml;base64,"+btoa(e);null!=Ke&&Ke.loadComplete(e,s),this.markupcdataload(t,a)},this.GetLinestyle=function(e,t,a){switch(e){case 0:break;case 1:t.setLineDash([10*a]);break;case 2:t.setLineDash([2*a,5*a]);break;case 3:t.setLineDash([10*a,5*a,2*a,5*a,2*a,5*a]);break;case 4:t.setLineDash([10*a,5*a,2*a,5*a]);break;case 5:t.setLineDash([0,15*a,15*a,0]);break;case 6:t.setLineDash([15*a,15*a])}},this.GetDateTime=function(e){var t=new Date(s.timestamp),a=t.getDate(),i=t.getMonth();i+=1;var r=t.getFullYear(),n=(t.getHours()<10?"0":"")+t.getHours(),o=(t.getMinutes()<10?"0":"")+t.getMinutes(),l=(t.getSeconds()<10?"0":"")+t.getSeconds();return e?a+"."+i+"."+r+" "+n+":"+o+":"+l:a+"."+i+"."+r},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.onPanScale=function(){},this.setDimDrawme=function(){if(6==this.type||7==this.type||3==this.type)var e={x:this.x,y:this.y,w:this.w,h:this.h};else if(1==this.type||8==this.type){if(!(t=this.getlastpoint()))return{x:0,y:0,w:0,h:0};e={x:t.x,y:t.y,w:t.x,h:t.y}}else if(13==this.type){var t;if(!(t=this.getlastcount()))return{x:0,y:0,w:0,h:0};e={x:t.x,y:t.y,w:t.x,h:t.y}}var a=Bs.getCurrentpage().drotation,i=Ln();i/=s.scaling;var r,n,o=jn(),l=id({x:r=o.x,y:n=o.y}),c=id({x:this.xoffset,y:this.yoffset});switch(a){case 0:6==this.type||7==this.type?(e.x=(this.x-r)/i+this.xoffset,e.y=(this.y-n)/i+this.yoffset,e.w=(this.w-r)/i+this.xoffset,e.h=(this.h-n)/i+this.yoffset):1==this.type||8==this.type||13==this.type?(e.w=(t.x-r)/i+this.xoffset,e.h=(t.y-n)/i+this.yoffset):3==this.type&&(e.x=(this.x-r)/i+this.xoffset,e.y=(this.y-n)/i+this.yoffset,e.w=(this.x+this.w-r)/i+this.xoffset,e.h=(this.y+this.h-n)/i+this.yoffset,e.w=e.w-this.x,e.h=e.h-this.y);break;case 90:case 180:case 270:6==this.type||7==this.type?(e.x=(this.x-l.x)/i+c.x,e.y=(this.y-l.y)/i+c.y,e.w=(this.w-l.x)/i+c.x,e.h=(this.h-l.y)/i+c.y):1==this.type||8==this.type||13==this.type?(e.w=(t.x-l.x)/i+c.x,e.h=(t.y-l.y)/i+c.y):3==this.type&&(e.x=(this.x-l.x)/i+c.x,e.y=(this.y-l.y)/i+c.y,e.w=(this.x+this.w-l.x)/i+c.x,e.h=(this.y+this.h-l.y)/i+c.y,e.w=e.w-this.x,e.h=e.h-this.y)}return Math.PI,0==Bs.Type?Bs.pages[0].dx:Bs.getCurrentpage().dx,e},this.SetDim3D=function(e,t,a,i){switch(this.xscaled=(this.x-this.xoffset)*e,this.yscaled=(this.y-this.yoffset)*e,this.wscaled=this.w*e,this.hscaled=this.h*e,this.type){case 0:case 1:case 2:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i;break;case 3:this.xscaled+=a,this.yscaled+=i;break;case 4:this.xscaled+=a,this.yscaled+=i,1==this.subtype&&(this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i);break;case 5:this.xscaled+=a,this.yscaled+=i;break;case 6:case 7:case 8:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i;break;case 9:this.xscaled+=a,this.yscaled+=i,1!=this.subtype&&2!=this.subtype&&(this.wscaled=this.textwidth,this.hscaled=this.textheight*e);break;case 10:this.xscaled+=a,this.yscaled+=i,ui?(this.wscaled=this.w*s.fixedscaleFactor,this.hscaled=this.h*s.fixedscaleFactor):(this.wscaled=this.w*e,this.hscaled=this.h*e);break;case 11:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i;break;case 12:this.xscaled+=a,this.yscaled+=i;break;case 13:this.xscaled+=a,this.yscaled+=i,ui&&(this.wscaled=this.w*s.fixedscaleFactor,this.hscaled=this.h*s.fixedscaleFactor)}this.rotatedrect.x=this.xscaled,this.rotatedrect.y=this.yscaled,this.rotatedrect.w=this.wscaled,this.rotatedrect.h=this.hscaled},this.setFirstdrawDim=function(e,t,a){0==e&&(e=1),0==t&&(t=1),isNaN(e)&&(e=1),isNaN(t)&&(t=1);var i=function(e){if(jh())return 1;var t=1;if(null!=e)var a=Bs.getpage(e);else a=Bs.getCurrentpage();return Vn(a)&&(t=a.MainImageScaling),t}(s.pagenumber),r=e;y&&(r*=i);var n=s.font.height;if(ni&&(r=s.scaling),12!=s.type&&(n=a?m&&!ni?Math.round(n*t/s.scaling):s.font.height:m&&f&&!ni?Math.round(n*t):Math.round(n*r),isNaN(s.font.height)&&(n=11),s.textheight=n,s.font.setHeight(n)),f&&(a?(m&&!ni&&(s.linewidth=s.linewidth*t/r,s.linewidthSegment=s.linewidthSegment*t/r),s.arrowlength=s.arrowlength+s.linewidth):(m&&!ni?(s.linewidth*=t,s.linewidthSegment*=t):(s.linewidth*=r,s.linewidthSegment*=r),s.arrowlength=s.arrowlength+s.linewidth),isNaN(s.linewidth)&&(s.linewidth=1,s.linewidthSegment=ps),isNaN(s.arrowlength)&&(s.arrowlength=Ar+s.linewidth)),f&&!a){this.x=(this.x+this.xoffset)*r,this.y=(this.y+this.yoffset)*r;var o=4==this.type&&1==this.subtype&&y;0==this.type||1==this.type||2==this.type||6==this.type||7==this.type||8==this.type||o?(this.w=(this.w+this.xoffset)*r,this.h=(this.h+this.yoffset)*r):10==this.type&&m?(this.w*=t,this.h*=t):(this.w*=r,this.h*=r)}if(7==this.type&&f&&!a&&(s.leaderoffset*=r),8==this.type&&(f&&!a&&(s.labeloffsetx*=r),f&&!a&&(s.labeloffsety*=r)),13==this.type){f&&(a?m&&!ni&&(s.innerRadius=s.innerRadius*t/r,s.outerRadius=s.outerRadius*t/r):m&&!ni?(this.innerRadius*=t,this.outerRadius*=t):(this.innerRadius*=r,this.outerRadius*=r));for(var l=0;l<s.countshapes.length;l++)f&&!a&&(s.countshapes[l].x=(s.countshapes[l].x+this.xoffset)*r,s.countshapes[l].y=(s.countshapes[l].y+this.yoffset)*r);s.findrectangle()}var c=1==this.type&&6==this.subtype;if((1==this.type||2==this.type||8==this.type)&&!c){for(var h=0;h<s.points.length;h++)f&&!a&&(s.points[h].x=(s.points[h].x+this.xoffset)*r,s.points[h].y=(s.points[h].y+this.yoffset)*r);s.findrectangle()}if(0==this.type||c){for(var u=0;u<this.pointlist.length;u++)for(var d=0;d<this.pointlist[u].length;d++)f&&!a&&(this.pointlist[u][d].x=(this.pointlist[u][d].x+this.xoffset)*r,this.pointlist[u][d].y=(this.pointlist[u][d].y+this.yoffset)*r);s.findrectangle()}f&&!a&&(this.xoffset*=r,this.yoffset*=r,isNaN(this.docdx)&&(this.docdx=Bs.getpage(s.pagenumber).getdx()),isNaN(this.docdy)&&(this.docdy=Bs.getpage(s.pagenumber).getdy()),isNaN(this.docdscale)&&(this.docdscale=Bs.getpage(s.pagenumber).getdscale())),12==this.type&&(this.stampsmalltheight=.08*this.w-4,this.textheight+this.stampsmalltheight+this.h/10*2>this.h&&(this.textheight=this.h/2-this.h/10*2,this.stampsmalltheight=this.textheight/2-4)),12==this.type&&s.restorestampfontSize(),s.scaling=e},this.SetDimensions=function(e,t,a,i){if(this.bfor3D)s.SetDim3D(e,t,a,i);else{var r=Math.PI/180*360,n=!0;switch(this.xscaled=(this.x-this.xoffset)*e,this.yscaled=(this.y-this.yoffset)*e,this.wscaled=this.w*e,this.hscaled=this.h*e,0==Bs.Type?Bs.pages[0].dx:Bs.getCurrentpage().dx,this.type){case 0:case 1:case 2:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0;break;case 3:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 4:this.xscaled+=a,this.yscaled+=i,1==this.subtype?(this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0):n=!1;break;case 5:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 6:case 7:case 8:this.xscaled+=a,this.yscaled+=i,this.wscaled=(this.w-this.xoffset)*e,this.hscaled=(this.h-this.yoffset)*e,this.wscaled+=a,this.hscaled+=i,n=!0;break;case 9:this.xscaled+=a,this.yscaled+=i,1==this.subtype||2==this.subtype?n=!1:(this.wscaled=this.textwidth,this.hscaled=this.textheight*e),n=!1;break;case 10:this.xscaled+=a,this.yscaled+=i,ui?(this.wscaled=this.w*s.fixedscaleFactor,this.hscaled=this.h*s.fixedscaleFactor):(this.wscaled=this.w*e,this.hscaled=this.h*e),n=!1;break;case 11:2==this.subtype?(this.wscaled=this.w,this.hscaled=this.h):(this.wscaled=this.w*e,this.hscaled=this.h*e),this.xscaled+=a,this.yscaled+=i,n=!1;break;case 12:this.xscaled+=a,this.yscaled+=i,n=!1;break;case 13:this.xscaled+=a,this.yscaled+=i,ui&&(this.wscaled=this.w*s.fixedscaleFactor,this.hscaled=this.h*s.fixedscaleFactor)}var o=t*(Math.PI/180),l=Na/2,c=Aa/2;if(this.rotatedrect.x=this.xscaled,this.rotatedrect.y=this.yscaled,this.rotatedrect.w=this.wscaled,this.rotatedrect.h=this.hscaled,0!=t&&s.setRotatedMarkuprect(l,c,n,o),9==this.type&&0==this.subtype&&0!=this.textrotate){Math.min(this.rotatedrect.x,this.rotatedrect.w),Math.max(this.rotatedrect.x,this.rotatedrect.w),Math.min(this.rotatedrect.y,this.rotatedrect.h),Math.max(this.rotatedrect.y,this.rotatedrect.h);var h=s.textrotate-r,u=s.getRotatedMarkup(this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.h,h);this.rotatedrect.w=u.x,this.rotatedrect.h=u.y,this.textrotate/(Math.PI/180)==180&&0==t&&(h=s.textrotate,u=s.getRotatedMarkup(this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.h,h),this.rotatedrect.w=u.x,this.rotatedrect.h=u.y)}9==this.type&&(1==this.subtype||this.subtype)}},this.SquareArea=function(){return Math.abs(this.w)*Math.abs(this.h)},this.PolygonHoleArea=function(e){var t=0,a=0,i=e.points.length;for(t=0;t<i-1;t++)a+=e.points[t].x*e.points[t+1].y-e.points[t+1].x*e.points[t].y;return a+=e.points[i-1].x*e.points[0].y-e.points[0].x*e.points[i-1].y,Math.abs(a/2)},this.PolygonArea=function(){var e=0,t=0,a=this.points.length;for(e=0;e<a-1;e++)t+=this.points[e].x*this.points[e+1].y-this.points[e+1].x*this.points[e].y;return t+=this.points[a-1].x*this.points[0].y-this.points[0].x*this.points[a-1].y,Math.abs(t/2)},this.PolygonCentre=function(e){var t,a=0,i=this.points.length;if("x"==e){if(i>0){for(t=0;t<i;t++)a+=this.points[t].x;a/=i}}else if(i>0){for(t=0;t<i;t++)a+=this.points[t].y;a/=i}return a},this.FindText=function(e,t){var a=!1;if(t)i=e,r=this.text;else var i=e.toLowerCase(),r=this.text.toLowerCase();var s=r.search(i);return-1==s?a=!1:s>=0&&(a=!0),a},this.RotateText=function(){},this.AdjustPointForRotation=function(e){var t=Bs.getCurrentpage().drotation*(Math.PI/180);switch(Bs.getCurrentpage().drotation){case 0:t=Bs.getCurrentpage().drotation*(Math.PI/180);break;case 90:t=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:t=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:t=Bs.getCurrentpage().drotation*(Math.PI/180)}var a=Na/2,i=Aa/2;return new Gs,s.getRotatedMarkup(a,i,e.x,e.y,t)},this.AdjustForRotation=function(e){var t=(360-Bs.getCurrentpage().drotation)*(Math.PI/180),a=Bs.getCurrentpage().drotation*(Math.PI/180),i=Bs.getCurrentpage().drotation*(Math.PI/180);switch(Bs.getCurrentpage().drotation){case 0:i=Bs.getCurrentpage().drotation*(Math.PI/180);break;case 90:i=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:i=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:i=Bs.getCurrentpage().drotation*(Math.PI/180)}var r=Na/2,n=Aa/2,o=0,l=0,c=new Gs,h=0,u=0,d=0,p=0;if(0!=Bs.getCurrentpage().drotation){switch(Bs.getCurrentpage().drotation){case 0:return;case 90:h=this.x,u=this.y+this.h,d=this.x+this.w,p=this.y;break;case 180:h=this.x,u=this.y,d=this.x+this.w,p=this.y+this.h;break;case 270:h=this.x+this.w,u=this.y,d=this.x,p=this.y+this.h}switch(this.type){case 0:for(l=0;l<this.pointlist.length;l++)for(o=0;o<this.pointlist[l].length;o++)c=s.setinitRotatedMarkupPoint(r,n,this.pointlist[l][o].x,this.pointlist[l][o].y,t),this.pointlist[l][o].x=c.x,this.pointlist[l][o].y=c.y;s.findrectangle();break;case 1:s.firstpointset||(c=s.setinitRotatedMarkupPoint(r,n,this.points[0].x,this.points[0].y,t),this.points[0].x=c.x,this.points[0].y=c.y,s.firstpointset=!0);var g=this.points.length-1;c=s.setinitRotatedMarkupPoint(r,n,this.points[g].x,this.points[g].y,t),this.points[g].x=c.x,this.points[g].y=c.y,s.findrectangle();break;case 2:for(o=0;o<this.points.length;o++)c=s.setinitRotatedMarkupPoint(r,n,this.points[o].x,this.points[o].y,t),this.points[o].x=c.x,this.points[o].y=c.y;s.findrectangle();break;case 3:c=s.setinitRotatedMarkupPoint(r,n,d,p,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,h,u,t),this.w=c.x-this.x,this.h=c.y-this.y;break;case 4:1!=s.subtype?(c=s.setinitRotatedMarkupPoint(r,n,d,p,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,h,u,t),this.w=c.x-this.x,this.h=c.y-this.y):e?(c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,a),this.x=c.x,this.y=c.y):(c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,this.w,this.h,t),this.w=c.x,this.h=c.y);break;case 5:c=s.setinitRotatedMarkupPoint(r,n,d,p,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,h,u,t),this.w=c.x-this.x,this.h=c.y-this.y;break;case 6:case 7:e?(wr&&(c=s.setinitRotatedMarkupPoint(r,n,this.w,this.h,a),this.w=c.x,this.h=c.y),c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,a),this.x=c.x,this.y=c.y):(c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,this.w,this.h,t),this.w=c.x,this.h=c.y);break;case 8:this.firstpointrotAdjusted||(c=s.setinitRotatedMarkupPoint(r,n,this.points[0].x,this.points[0].y,t),this.points[0].x=c.x,this.points[0].y=c.y,this.firstpointrotAdjusted=!0),this.points.length,(g=s.getlastpoint())&&(c=s.getRotatedMarkup(r,n,g.x,g.y,i),s.setlastpoint(c.x,c.y)),s.findrectangle();break;case 9:1==this.subtype||2==this.subtype?(c=s.setinitRotatedMarkupPoint(r,n,d,p,t),this.x=c.x,this.y=c.y,c=s.setinitRotatedMarkupPoint(r,n,h,u,t),this.w=c.x-this.x,this.h=c.y-this.y):(c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,t),this.x=c.x,this.y=c.y,this.textrotate=t);break;case 10:case 11:c=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,t),this.x=c.x,this.y=c.y;break;case 12:c=s.setinitRotatedMarkupPoint(r,n,d,p,t),this.x=c.x,this.y=c.y,this.textrotate=t,c=s.setinitRotatedMarkupPoint(r,n,h,u,t),this.w=c.x-this.x,this.h=c.y-this.y;break;case 13:var m=this.countshapes.length>0;!this.firstpointrotAdjusted&&m&&(this.firstpointrotAdjusted=!0),(g=s.getlastcount())&&(c=s.getRotatedMarkup(r,n,g.x,g.y,i),s.setlastcount(c.x,c.y))}}},this.notify=function(){Et.notify()},this.addsides=function(){if(this.sides=[],Ln(),this.points.length>0){var e={x1:this.points[0].x,y1:this.points[0].y,x2:this.points[0].x,y2:this.points[0].y},t=0;for(t=0;t<this.points.length;t++)0==t?e={x1:this.points[t].x,y1:this.points[t].y,x2:this.points[t].x,y2:this.points[t].y}:t>0&&(e.x2=this.points[t].x,e.y2=this.points[t].y,this.sides.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),e.x1=this.points[t].x,e.y1=this.points[t].y);null!=this.sides[0]&&(e.x2=this.sides[0].x1,e.y2=this.sides[0].y1,this.sides.push({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}))}},this.savemarkupstateChanged=function(e,t){var a=new Eo(s.markupnumber);s.bMultiOp&&(a.setmultiValues(s.multiOpId),s.resetmultiValues()),a.SetUndoValues(s),1==t?(a.bmodify=!0,a.bdelete=!1,a.bcreate=!1):2==t?(a.bmodify=!1,a.bdelete=!1,a.bcreate=!0):3==t&&(a.bmodify=!1,a.bdelete=!0,a.bcreate=!1),e.tempundolist.push(a),s.resetmarkupmodified()},this.savemarkupstate=function(e,t){var a=new Eo(s.markupnumber);s.bMultiOp&&(a.setmultiValues(s.multiOpId),s.resetmultiValues()),a.SetUndoValues(s),1==t?(a.bmodify=!0,a.bdelete=!1,a.bcreate=!1):2==t?(a.bmodify=!1,a.bdelete=!1,a.bcreate=!0):3==t&&(a.bmodify=!1,a.bdelete=!0,a.bcreate=!1),e.markupundolist.push(a)},this.savemetolistLoadMulti=function(e,t){s.savemetolist(e,!0,!1,!1,t)},this.setfirstDraw=function(){b=!0},this.savemetolistLoad=function(e,t){
//!last undefined = true
s.savemetolist(e,!t,!1,t),s.setdisplay(I)},this.savemetolistDraw=function(){b=!0,s.savemetolist(Bs,!1,!0),Va&&0==s.uniqueID&&pc(s)},this.savemetolist=function(e,t,a,i,r){if(!((1==s.type&&2==s.subtype||8==s.type)&&s.points.length<3)){s.saved=!0;var n=4==s.type&&1==s.subtype;(0==s.type||6==s.type||7==s.type||9==s.type||10==s.type||11==s.type||n)&&(a&&s.bUsemouseinput&&s.AdjustForRotation(!0),s.bUsemouseinput=!0),s.markupnumber=$o(),e.markupdraworder[e.markupdraworder.length]=e.markuplist.length,e.markuplist[e.markuplist.length]=s,a&&(s.bisTextArrow||s.savemarkupstate(e,2)),e.nummarkups++,null!=Et&&Et.setMarkupList(e.getmarkuplist(),Bs.bActive,t),i&&null!=Je&&Je.loadComplete(e.markuplist,e.fileindex,e.bActive)}},this.zoomTo=function(e){Bs.getcurPage()!=s.pagenumber?au(s.pagenumber).then((function(t){Bs.pages[s.pagenumber].MarkupZoombyMarkup(s,e)})):Bs.pages[s.pagenumber].MarkupZoombyMarkup(s,e)},this.rotate=function(e,t,a){if(s.getselected()&&!pi){var i=e,r=t,n=Bs.getCurrentpage().drotation*(Math.PI/180),o=Na/2,l=Aa/2,c=Math.PI/180*360,h=Math.PI/180*-180,u=Math.PI/180*180,d=0;d=Ln(),d/=s.scaling;var p=(this.x-this.xoffset)*d,g=(this.y-this.yoffset)*d,m=this.w*d,f=this.h*d,y=jn();p+=y.x,g+=y.y;var v=s.rotation,b=s.rotation,x=!0;if(s.bfor3D)w=0,k=Na,D=0,C=Aa;else var w=Bs.getCurrentpage().startx,k=Bs.getCurrentpage().endx,D=Bs.getCurrentpage().starty,C=Bs.getCurrentpage().endy;var P=p+m/2,S=g+f/2;if(9==this.type&&0==this.subtype){P=p+m/2,S=g-f/2;var R=0;if(0!=this.textrotate){R=c-this.textrotate;var M=this.textheight*d,T=this.textwidth*d,E=s.getMarkupSelectPointRot(T/2,-M/2,s.textrotate);P=p+E.x,S=g+E.y}}var F=P-i,I=S-r,j=Math.atan2(I,F);j<-.5*Math.PI&&(j+=2*Math.PI);var O=s.getRotatedMarkup(o,l,P,S,n);switch(s.getRotatedMarkup(o,l,p,g,n),Bs.getCurrentpage().drotation){case 0:b=9==this.type&&0==this.subtype?j-.5*Math.PI+R:j-.5*Math.PI;break;case 90:F=i-O.x,I=r-O.y,j=Math.atan2(I,F),b=9==this.type&&0==this.subtype?j-.5*Math.PI+n+R:j-.5*Math.PI+n;break;case 180:F=i-O.x,I=r-O.y,j=Math.atan2(I,F),b=9==this.type&&0==this.subtype?j-.5*Math.PI+R:j-.5*Math.PI;break;case 270:F=i-O.x,I=r-O.y,j=Math.atan2(I,F),b=9==this.type&&0==this.subtype?j-.5*Math.PI+n+R:j-.5*Math.PI+n}switch(this.type){case 0:case 1:case 2:s.rotation=0;break;case 3:6==s.subtype&&(s.rotation=0);break;case 4:case 5:break;case 6:case 7:case 8:s.rotation=0}b<h&&(b+=c),b>u&&(b-=c);var L=s.rotrectrot(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,b);if((L.x<w||L.x>k)&&(x=!1),(L.y<D||L.y>C)&&(x=!1),(L.x+L.w<w||L.x+L.w>k)&&(x=!1),(L.y+L.h<D||L.y+L.h>C)&&(x=!1),s.rotation=x?b:v,s.setmarkupmodified(!0),null!=Wt){var V=s.editaction;Wt.setMarkupSelected(s,V)}}},this.withinboundspoint=function(e,t){var a=!1,i=Bs.getCurrentpage().startx,r=Bs.getCurrentpage().starty,s=Bs.getCurrentpage().endx,n=Bs.getCurrentpage().endy;return e>i&&t>r&&e<s&&t<n&&(a=!0),a},this.withinbounds=function(e,t){var a=!1,i=Bs.getCurrentpage().startx,r=Bs.getCurrentpage().starty,n=Bs.getCurrentpage().endx,o=Bs.getCurrentpage().endy,l=Ln();l/=s.scaling;var c=this.x*l,h=this.y*l,u=this.w*l,d=this.h*l;switch(this.type){case 0:case 1:case 2:break;case 3:case 4:case 5:c=this.xscaled,h=this.yscaled,u=this.xscaled+this.wscaled,d=this.yscaled+this.hscaled;break;case 6:case 7:case 8:break;case 9:0==this.subtype?(c=this.xscaled,h=this.yscaled,u=this.xscaled+this.textwidth,d=this.yscaled-this.textheight):1!=this.subtype&&2!=this.subtype||(c=this.xscaled,h=this.yscaled,u=this.xscaled+this.wscaled,d=this.yscaled+this.hscaled);break;case 10:case 11:case 12:c=this.xscaled,h=this.yscaled,u=this.xscaled+this.wscaled,d=this.yscaled+this.hscaled}return c+e>i&&h+t>r&&u+e<n&&d+t<o&&(a=!0),a},this.rotrect=function(e,t,a,i){var r=e+(a-e)/2,n=t+(i-t)/2,o=s.getMarkupSelectPointRot(-(a-e)/2,-(i-t)/2,s.rotation),l=s.getMarkupSelectPointRot((a-e)/2,(i-t)/2,s.rotation),c=s.getMarkupSelectPointRot(-(a-e)/2,(i-t)/2,s.rotation),h=s.getMarkupSelectPointRot((a-e)/2,-(i-t)/2,s.rotation),u=Math.min(r+o.x,r+l.x,r+c.x,r+h.x),d=Math.min(n+o.y,n+l.y,n+c.y,n+h.y);return{x:u,y:d,w:Math.max(r+o.x,r+l.x,r+c.x,r+h.x)-u,h:Math.max(n+o.y,n+l.y,n+c.y,n+h.y)-d}},this.rotrectrot=function(e,t,a,i,r){var n=e+(a-e)/2,o=t+(i-t)/2,l=s.getMarkupSelectPointRot(-(a-e)/2,-(i-t)/2,r),c=s.getMarkupSelectPointRot((a-e)/2,(i-t)/2,r),h=s.getMarkupSelectPointRot(-(a-e)/2,(i-t)/2,r),u=s.getMarkupSelectPointRot((a-e)/2,-(i-t)/2,r),d=Math.min(n+l.x,n+c.x,n+h.x,n+u.x),p=Math.min(o+l.y,o+c.y,o+h.y,o+u.y);return{x:d,y:p,w:Math.max(n+l.x,n+c.x,n+h.x,n+u.x)-d,h:Math.max(o+l.y,o+c.y,o+h.y,o+u.y)-p}},this.setCurPoint=function(e){return 1!=s.type||1!=s.subtype&&3!=s.subtype?s.editcurpoint>=0&&(s.editcurpoint=e):s.editcurpoint>0&&(s.editcurpoint=e),s.editcurpoint},this.resetcupoint=function(){s.editcurpoint=0},this.movePoints=function(e,t){var a=e,i=t,r=!0,n=!0;switch(Bs.getCurrentpage().drotation){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var o=0,l=0,c=0;c=Ln(),c/=s.scaling,s.bfor3D&&(c=Aa/this.pageheight),this.x,this.y,this.w,this.h;var h=Bs.getCurrentpage().getpagerectdirect(),u=h.x,d=h.w,p=h.y,g=h.h;s.bfor3D&&(u=0,d=Na,p=0,g=Aa);var m=0;if(this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),this.bispartofGroup)(this.groupRect.x-a<u||this.groupRect.x-a>d)&&(this.groupRect.x+=a,this.groupRect.w+=a,r=!1),(this.groupRect.y-i<p||this.groupRect.y-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1),(this.groupRect.w-a<u||this.groupRect.w-a>d)&&(this.groupRect.x+=a,this.groupRect.w+=a,r=!1),(this.groupRect.h-i<p||this.groupRect.h-i>g)&&(this.groupRect.y+=i,this.groupRect.h+=i,n=!1);else{for(o=0,l=0,r=!1,n=!1,m=0;m<this.points.length;m++){if(o=(this.points[m].x-this.xoffset)*c,o+=u,!((o-=a)>u&&o<d)){r=!1;break}if(r=!0,l=(this.points[m].y-this.yoffset)*c,l+=p,!((l-=i)>p&&l<g)){n=!1;break}n=!0}if(!n||!r)return;for(m=0;m<this.points.length;m++)o=this.points[m].x*c,o-=a,r&&(this.points[m].x=o/c),l=this.points[m].y*c,l-=i,n&&(this.points[m].y=l/c)}if(this.findrectangle(),s.setmarkupmodified(!0),null!=Wt){var f=s.editaction;Wt.setMarkupSelected(s,f)}},this.movedirect=function(e,t){var a=0;a=Ln(),a/=s.scaling;var i=this.x,r=this.y;i=e,r=t,this.x=i/a,this.y=r/a},this.movemultiPoints=function(e,t){if(!s.pdfannotproxy){var a=e,i=t;switch(Bs.getCurrentpage().drotation){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var r=0,n=0,o=0;o=Ln(),o/=s.scaling,s.bfor3D&&(o=Aa/this.pageheight),this.x,this.y,this.w,this.h;var l=Bs.getCurrentpage().getpagerectdirect(),c=l.x,h=l.w,u=l.y,d=l.h;s.bfor3D&&(c=0,h=Na,u=0,d=Aa);var p=!0,g=!0,m=0,f=0;if(0!=s.rotation)var y=s.rotrect(this.xscaled,this.yscaled,this.wscaled,this.hscaled);else y={x:this.xscaled,y:this.yscaled,w:this.wscaled-this.xscaled,h:this.hscaled-this.yscaled};if(this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),this.bispartofGroup)(this.groupRect.x-a<c||this.groupRect.x-a>h)&&(this.groupRect.x+=a,this.groupRect.w+=a,p=!1),(this.groupRect.y-i<u||this.groupRect.y-i>d)&&(this.groupRect.y+=i,this.groupRect.h+=i,g=!1),(this.groupRect.w-a<c||this.groupRect.w-a>h)&&(this.groupRect.x+=a,this.groupRect.w+=a,p=!1),(this.groupRect.h-i<u||this.groupRect.h-i>d)&&(this.groupRect.y+=i,this.groupRect.h+=i,g=!1);else{if(r=0,n=0,p=!1,g=!1,this.bispartofGroup?((this.groupRect.x-a<c||this.groupRect.x+a>h)&&(this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.y-i<u||this.groupRect.y-i>d)&&(this.groupRect.y+=i,this.groupRect.h+=i)):(p=!(y.x-a<c||y.x+a>h||y.x+y.w-a<c||y.x+y.w-a>h),g=!(y.y-i<u||y.y-i>d||y.y+y.h-i<u||y.y+y.h-i>d)),!g||!p)return;for(m=0;m<this.pointlist.length;m++)for(f=0;f<this.pointlist[m].length;f++)r=this.pointlist[m][f].x*o,r-=a,p&&(this.pointlist[m][f].x=r/o),n=this.pointlist[m][f].y*o,n-=i,g&&(this.pointlist[m][f].y=n/o)}if(this.findrectangle(),s.setmarkupmodified(!0),null!=Wt){var v=s.editaction;Wt.setMarkupSelected(s,v)}}},this.moveShape=function(e,t){var a=e,i=t;switch(Bs.getCurrentpage().drotation){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var r=0;r=Ln(),r/=s.scaling,s.bfor3D&&(r=Aa/this.pageheight);var n=this.x*r,o=this.y*r,l=(this.w,this.h,Bs.getCurrentpage().getpagerectdirect()),c=l.x,h=l.w,u=l.y,d=l.h;if(s.bfor3D&&(c=0,h=Na,u=0,d=Aa),n-=a,o-=i,this.bispartofGroup&&(this.groupRect.x-=a,this.groupRect.y-=i,this.groupRect.w-=a,this.groupRect.h-=i),0!=s.rotation){var p=s.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled);0==s.type&&(p=s.rotrect(this.xscaled,this.yscaled,this.wscaled,this.hscaled))}else p={x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled},0==s.type&&(p={x:this.xscaled,y:this.yscaled,w:this.wscaled-this.xscaled,h:this.hscaled-this.xscaled});var g=11==this.type&&2==this.subtype;if(g||(this.bispartofGroup?((this.groupRect.x-a<c||this.groupRect.x+a>h)&&(n+=a,this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.y-i<u||this.groupRect.y-i>d)&&(o+=i,this.groupRect.y+=i,this.groupRect.h+=i)):((p.x-a<c||p.x+a>h)&&(n+=a),(p.y-i<u||p.y-i>d)&&(o+=i))),0==this.type?s.movemultipoints(a,i,r):(this.x=n/r,this.y=o/r),g||(this.bispartofGroup?((this.groupRect.w-a<c||this.groupRect.w-a>h)&&(n+=a,this.groupRect.x+=a,this.groupRect.w+=a),(this.groupRect.h-i<u||this.groupRect.h-i>d)&&(o+=i,this.groupRect.y+=i,this.groupRect.h+=i)):((p.x+p.w-a<c||p.x+p.w-a>h)&&(n+=a),(p.y+p.h-i<u||p.y+p.h-i>d)&&(o+=i)),0==this.type?s.movemultipoints(a,i,r):(this.x=n/r,this.y=o/r)),s.setmarkupmodified(!0),null!=Wt){var m=s.editaction;Wt.setMarkupSelected(s,m)}},this.move=function(e,t,a){if(s.getselected())if(3==this.type||5==this.type||4==this.type&&0==this.subtype||10==this.type||11==this.type||12==this.type)s.moveShape(e,t);else{var i=8==this.type||1==this.subtype;if(1!=this.type&&8!=this.type)if(0!=this.type){var r=e,n=t,o=!0;switch(Bs.getCurrentpage().drotation){case 0:r=e,n=t;break;case 90:r=t,n=-e;break;case 180:r=-e,n=-t;break;case 270:r=-t,n=e}var l=0,c=0,h=0;h=Ln(),h/=s.scaling,s.bfor3D&&(h=Aa/this.pageheight);var u=this.x*h,d=this.y*h,p=this.w*h,g=this.h*h,m=Bs.getCurrentpage().getpagerectdirect(),f=m.x,y=m.w,v=m.y,b=m.h;switch(s.bfor3D&&(f=0,y=Na,v=0,b=Aa),this.type){case 0:var x=0,w=0;if(u-=r,d-=n,p-=r,g-=n,this.transformobj)var k=this.transformobj.a,D=this.transformobj.d;else k=1,D=1;if(this.x=u/h,this.y=d/h,1==this.subtype||0==this.subtype)if(this.w=p/h,this.h=g/h,o)for(w=0;w<this.pointlist.length;w++)for(x=0;x<this.pointlist[w].length;x++)l=this.pointlist[w][x].x*h,c=this.pointlist[w][x].y*h,l*=k,c*=D,l-=r,c-=n,this.pointlist[w][x].x=l/h/k,this.pointlist[w][x].y=c/h/D;else this.findrectangle();break;case 2:var C=0;if(u-=r,d-=n,p-=r,g-=n,(this.xscaled-r<f||this.xscaled-r>y)&&(u+=r,p+=r,o=!1),(this.yscaled-n<v||this.yscaled-n>b)&&(d+=n,g+=n,o=!1),(p<f||p>y)&&(u+=r,p+=r,o=!1),(this.hscaled-n<v||this.hscaled-n>b)&&(d+=n,g+=n,o=!1),this.x=u/h,this.y=d/h,this.w=p/h,this.h=g/h,o)for(C=0;C<this.points.length;C++)l=this.points[C].x*h,c=this.points[C].y*h,l-=r,c-=n,this.points[C].x=l/h,this.points[C].y=c/h;else this.findrectangle();break;case 4:this.bispartofGroup&&(this.groupRect.x-=r,this.groupRect.y-=n,this.groupRect.w-=r,this.groupRect.h-=n),u-=r,d-=n;var P=(this.x-this.xoffset)*h,S=(this.y-this.yoffset)*h;if(P+=f,S+=v,P-=r,S-=n,1==this.subtype){p-=r,g-=n;var R=Math.max(u,p)-Math.min(u,p),M=Math.max(d,g)-Math.min(d,g),T=s.getdiag(R,M);this.bispartofGroup?((this.groupRect.x-r<f||this.groupRect.x-r>y)&&(u+=r,p+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.y-n<v||this.groupRect.y-n>b)&&(d+=n,g+=n,this.groupRect.y+=n,this.groupRect.h+=n),(this.groupRect.w-r<f||this.groupRect.w-r>y)&&(u+=r,p+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(d+=n,g+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((P-T<f||P+T>y)&&(u+=r,p+=r),(S-T<v||S+T>b)&&(d+=n,g+=n)),this.w=p/h,this.h=g/h,this.x=u/h,this.y=d/h}else{if(0!=s.rotation)var E=s.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled);else E={x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled};this.bispartofGroup?((this.groupRect.x-r<f||this.groupRect.x+r>y)&&(u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.y-n<v||this.groupRect.y-n>b)&&(d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((E.x-r<f||E.x-r>y)&&(u+=r),(E.y-n<v||E.y-n>b)&&(d+=n)),this.x=u/h,this.y=d/h,this.bispartofGroup?((this.groupRect.w-r<f||this.groupRect.w-r>y)&&(u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((E.x+E.w-r<f||E.x+E.w-r>y)&&(u+=r),(E.y+E.h-n<v||E.y+E.h-n>b)&&(d+=n)),this.x=u/h,this.y=d/h}break;case 6:if(6==this.subtype)break;this.bispartofGroup&&(this.groupRect.x-=r,this.groupRect.y-=n,this.groupRect.w-=r,this.groupRect.h-=n),u-=r,d-=n,this.bispartofGroup?((this.groupRect.x-r<f||this.groupRect.x-r>y)&&(p+=r,u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.y-n<v||this.groupRect.y-n>b)&&(g+=n,d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.xscaled-r<f||this.xscaled-r>y)&&(p+=r,u+=r),(this.yscaled-n<v||this.yscaled-n>b)&&(g+=n,d+=n)),p-=r,g-=n,this.bispartofGroup?((this.groupRect.w-r<f||this.groupRect.w-r>y)&&(p+=r,u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(g+=n,d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.wscaled-r<f||this.wscaled-r>y)&&(p+=r,u+=r),(this.hscaled-n<v||this.hscaled-n>b)&&(g+=n,d+=n)),this.x=u/h,this.y=d/h,this.w=p/h,this.h=g/h;break;case 7:this.bispartofGroup&&(this.groupRect.x-=r,this.groupRect.y-=n,this.groupRect.w-=r,this.groupRect.h-=n),u-=r,d-=n,this.bispartofGroup?((this.groupRect.x-r<f||this.groupRect.x-r>y)&&(p+=r,u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.y-n<v||this.groupRect.y-n>b)&&(g+=n,d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.xscaled-r<f||this.xscaled-r>y)&&(p+=r,u+=r),(this.yscaled-n<v||this.yscaled-n>b)&&(g+=n,d+=n)),p-=r,g-=n,this.bispartofGroup?((this.groupRect.w-r<f||this.groupRect.w-r>y)&&(p+=r,u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(g+=n,d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((this.wscaled-r<f||this.wscaled-r>y)&&(p+=r,u+=r),(this.hscaled-n<v||this.hscaled-n>b)&&(g+=n,d+=n)),this.x=u/h,this.y=d/h,this.w=p/h,this.h=g/h;break;case 9:this.textwidth,this.bispartofGroup&&(this.groupRect.x-=r,this.groupRect.y-=n,this.groupRect.w-=r,this.groupRect.h-=n),u-=r,d-=n;var F=p;switch(this.textrotate/(Math.PI/180)){case 0:break;case 90:p=g,g=F;break;case 180:break;case 270:p=g,g=F}E=0!=s.rotation?s.rotrect(this.xscaled,this.yscaled,this.xscaled+p,this.yscaled+g):{x:this.xscaled,y:this.yscaled,w:p,h:g},this.bispartofGroup?((this.groupRect.x-r<f||this.groupRect.x+r>y)&&(u+=r,this.groupRect.x+=r,this.groupRect.w+=r),(this.groupRect.y-n<v||this.groupRect.y-n>b)&&(d+=n,this.groupRect.y+=n,this.groupRect.h+=n)):((E.x-r<f||E.x-r>y)&&(u+=r),(E.y-n<v||E.y-n>b)&&(d+=n)),this.bispartofGroup?(this.groupRect.w-r<f||this.groupRect.w-r>y)&&(u+=r,this.groupRect.x+=r,this.groupRect.w+=r):(E.x+E.w-r<f||E.x+E.w-r>y)&&(u+=r),1==this.subtype||2==this.subtype?this.bispartofGroup?(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(d+=n,this.groupRect.y+=n,this.groupRect.h+=n):(E.y+E.h-n<v||E.y+E.h-n>b)&&(d+=n):this.bispartofGroup?(this.groupRect.h-n<v||this.groupRect.h-n>b)&&(d+=n,this.groupRect.y+=n,this.groupRect.h+=n):(E.y-E.h-n<v||E.y-E.h-n>b)&&(d+=n),this.x=u/h,this.y=d/h,this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h);break;case 10:case 11:u-=r,d-=n,((E=0!=s.rotation?s.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled):{x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled}).x-r<f||E.x+r>y)&&(u+=r),(E.y-n<v||E.y-n>b)&&(d+=n),(E.x+E.w-r<f||E.x+E.w-r>y)&&(u+=r),(E.y+E.h-n<v||E.y+E.h-n>b)&&(d+=n),this.x=u/h,this.y=d/h;break;case 12:u-=r,d-=n,((E=0!=s.rotation?s.rotrect(this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled):{x:this.xscaled,y:this.yscaled,w:this.wscaled,h:this.hscaled}).x-r<f||E.x-r>y)&&(u+=r),(E.y-n<v||E.y-n>b)&&(d+=n),(E.x+E.w-r<f||E.x+E.w-r>y)&&(u+=r),(E.y+E.h-n<v||E.y+E.h-n>b)&&(d+=n),this.x=u/h,this.y=d/h}if(s.setmarkupmodified(!0),null!=Wt){var I=s.editaction;Wt.setMarkupSelected(s,I)}}else s.movemultiPoints(e,t);else i&&!Oi||s.movePoints(e,t)}},this.setArrowPoint=function(e){s.setTextboxConnectionPoint(e.x,e.y,e.w,e.h)},this.setTextboxConnectionPointDraw=function(){if(6==s.type&&6==s.subtype){var e=s.fixedscaleFactor;e*=Xr,tn.height;var t=In(s.w,s.h,e),a=s.w-.5*t.w,i=s.w+.5*t.w;switch(s.x>a&&s.x<i?t.y>s.y?s.arrowTextPos=4:t.y<s.y&&(s.arrowTextPos=3):s.x<a?s.arrowTextPos=1:s.x>i&&(s.arrowTextPos=2),s.pagerotation){case 90:switch(s.arrowTextPos){case 2:s.arrowTextPos=4;break;case 1:s.arrowTextPos=3;break;case 4:s.arrowTextPos=1;break;case 3:s.arrowTextPos=2}break;case 270:switch(s.arrowTextPos){case 2:s.arrowTextPos=3;break;case 1:s.arrowTextPos=4;break;case 4:s.arrowTextPos=2;break;case 3:s.arrowTextPos=1}}}},this.setTextboxConnectionPoint=function(e,t,a,i){6==s.type&&6==s.subtype&&(this.x<e?(s.w=e,s.h=t+.5*i,s.arrowTextPos=1):e<this.x&&this.x<e+a?t>this.y?(s.w=e+.5*a,s.h=t,s.arrowTextPos=4):t<this.y&&(s.w=e+.5*a,s.h=t+i,s.arrowTextPos=3):this.x>e&&(s.w=e+a,s.h=t+.5*i,s.arrowTextPos=2))},this.movelabel=function(e,t){var a=e,i=t;switch(Bs.getCurrentpage().drotation){case 0:a=e,i=t;break;case 90:a=t,i=-e;break;case 180:a=-e,i=-t;break;case 270:a=-t,i=e}var r=Ln();r/=s.scaling;var n=s.labeloffsetx*r,o=s.labeloffsety*r,l=s.labeloffsetx<s.labeloffsetx-a,c=s.labeloffsetx>s.labeloffsetx-a,h=s.labeloffsety>s.labeloffsety-i,u=s.labeloffsety<s.labeloffsety-i,d=s.labelRect.x>s.xscaled,p=s.labelRect.x+s.labelRect.w<s.wscaled,g=s.labelRect.y>s.yscaled,m=s.labelRect.y+s.labelRect.h<s.hscaled;if((d||l)&&(p||c)&&(g||u)&&(m||h)&&(n-=a,o-=i,s.labeloffsetx=n/r,s.labeloffsety=o/r),s.setmarkupmodified(!0),null!=Wt){var f=s.editaction;Wt.setMarkupSelected(s,f)}},this.dimextend=function(e,t){var a=Na/2,i=Aa/2,r=Bs.getCurrentpage().drotation*(Math.PI/180);switch(Bs.getCurrentpage().drotation){case 0:r=Bs.getCurrentpage().drotation*(Math.PI/180);break;case 90:r=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:r=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:r=Bs.getCurrentpage().drotation*(Math.PI/180)}if(0!=Bs.getCurrentpage().drotation){var n=s.getRotatedMarkup(a,i,e,t,r);e=n.x,t=n.y}var o=Ln();o/=s.scaling;var l={x:e,y:t},c={x:this.xscaled,y:this.yscaled},h={x:this.wscaled,y:this.hscaled},u=(l.x-c.x)*(h.y-c.y)-(l.y-c.y)*(h.x-c.x),d=Wn(l,c,h);if(s.leaderoffset=u>0?-d/o:d/o,d<1&&(s.leaderoffset=0),s.setmarkupmodified(!0),null!=Wt){var p=s.editaction;Wt.setMarkupSelected(s,p)}},this.setSize=function(e){wscaled=e.width,hscaled=e.height,(this.xscaled+wscaled<startx||this.xscaled+wscaled>endx)&&(wscaled=this.w*scalefactor),(this.yscaled+hscaled<starty||this.yscaled+hscaled>endy)&&(hscaled=this.h*scalefactor),this.w=wscaled/scalefactor,this.h=hscaled/scalefactor},this.setinitialtext=function(e){s.intialtextset=e},this.setText=function(e){if(s.text=e,null!=Wt){var t=s.editaction;Wt.setMarkupSelected(s,t)}},this.getTextDim=function(){return s.textdim},this.setTextboxSize=function(e,t){if(9==this.type){var a=Ln();if(a/=s.scaling,s.bfor3D)i=0,r=Na,n=0,o=Aa,a=Aa/this.pageheight;else var i=Bs.getCurrentpage().startx,r=Bs.getCurrentpage().endx,n=Bs.getCurrentpage().starty,o=Bs.getCurrentpage().endy;this.x,this.y;var l=this.w*a,c=this.h*a;if(1==this.subtype||2==this.subtype)null!=e&&(l=e),null!=t&&(c=t),(this.xscaled+l<i||this.xscaled+l>r)&&(l=this.wscaled),(this.yscaled+c<n||this.yscaled+c>o)&&(c=this.hscaled),l<0&&(l=1),c<0&&(c=1),this.w=l/a,this.h=c/a;else{var h=this.textheight*a,u=this.textwidth*a;this.textrotate,Math.PI,this.font.setHeight(h/a),ctx.font=this.font.fontstring,ctx.measureText(this.text).width,(this.xscaled+l<i||this.xscaled+l>r)&&(l=this.wscaled),(this.yscaled-c<n||this.yscaled-c>o)&&(c=this.hscaled),this.w=l/a,this.h=c/a,this.textheight=h/a,this.textwidth=u/a}return this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h),P()}},this.scale=function(e,t,a,i){if(s.getselected()){var r=e,n=t,o=0,l=0;switch(Bs.getCurrentpage().drotation){case 0:r=e,n=t;break;case 90:r=t,n=-e;break;case 180:r=-e,n=-t;break;case 270:r=-t,n=e}if(0!=s.rotation){o=r,l=n;var c=-s.rotation;r=o*Math.cos(c)-l*Math.sin(c),n=o*Math.sin(c)+l*Math.cos(c)}var h=Ln();h/=s.scaling;var u=Bs.getCurrentpage().getpagerectdirect(),d=u.x,p=u.w,g=u.y,m=u.h;s.bfor3D&&(d=0,p=Na,g=0,m=Aa);var f=this.x*h,y=this.y*h,v=this.w*h,b=this.h*h;switch(this.type){case 0:case 1:case 2:break;case 3:switch(a){case 4:v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n),this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v-=r,f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(y+=n,b-=n),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),this.y=y/h,this.w=v/h,this.h=b/h}break;case 4:switch(a){case 4:if(1==this.subtype){var x=(this.w-this.xoffset)*h,w=(this.h-this.yoffset)*h;x+=d,w+=g,x-=r,w-=n,v-=r,b-=n;var k=Math.max(this.xscaled,this.wscaled)-Math.min(this.xscaled,this.wscaled),D=Math.max(this.yscaled,this.hscaled)-Math.min(this.yscaled,this.hscaled),C=Math.max(this.xscaled,x)-Math.min(this.xscaled,x),P=Math.max(this.yscaled,w)-Math.min(this.yscaled,w),S=(s.getdiag(k,D),s.getdiag(C,P));(this.xscaled-S<d||this.xscaled+S>p)&&(v+=r,b+=n),(this.yscaled-S<g||this.yscaled+S>m)&&(v+=r,b+=n),s.radiusCallback(this.x,this.y,this.w,this.h,!0)}else v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n);this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),this.y=y/h,this.w=v/h,this.h=b/h}break;case 5:switch(a){case 4:v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n),this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),this.y=y/h,this.w=v/h,this.h=b/h}break;case 6:if(4==a){if(6==this.subtype)return;v-=r,b-=n,(this.wscaled-r<d||this.wscaled-r>p)&&(v+=r),(this.hscaled-n<g||this.hscaled-n>m)&&(b+=n),this.w=v/h,this.h=b/h}1==a&&(f-=r,y-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n),this.x=f/h,this.y=y/h),6==this.subtype&&null!=this.textBoxConnected&&this.setTextboxConnectionPoint(this.textBoxConnected.x,this.textBoxConnected.y,this.textBoxConnected.w,this.textBoxConnected.h),s.lengthangleCallback(this.x,this.y,this.w,this.h,Bs.getCurrentpage().drotation),wr&&s.calculateOrtho(!0,a,{x:r,y:n});break;case 7:4==a&&(v-=r,b-=n,(this.wscaled-r<d||this.wscaled-r>p)&&(v+=r),(this.hscaled-n<g||this.hscaled-n>m)&&(b+=n),this.w=v/h,this.h=b/h),1==a&&(f-=r,y-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n),this.x=f/h,this.y=y/h),wr&&s.calculateOrtho(!0,a,{x:r,y:n}),s.setdimvalue(this.x,this.y,this.w,this.h);break;case 8:break;case 9:if(1==this.subtype||2==this.subtype)switch(a){case 4:v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n),v<0&&(v=1),b<0&&(b=1),this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v-=r,f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(y+=n,b-=n),v<0&&(v=1),b<0&&(b=1),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),v<0&&(v=1),b<0&&(b=1),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),v<0&&(v=1),b<0&&(b=1),this.y=y/h,this.w=v/h,this.h=b/h}else{var R=this.textheight*h,M=this.textwidth*h;switch(this.textrotate/(Math.PI/180)){case 0:case 90:case 180:break;case 270:r=-t,n=e}R-=.25*n,M-=.25*r,v-=.25*r,b-=.25*n,this.font.setHeight(R/h),i.font=this.font.fontstring,i.measureText(this.text).width,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r,M+=r,R+=n),(this.yscaled-this.hscaled-n<g||this.yscaled-this.hscaled-n>m)&&(b+=n,R+=n),this.w=v/h,this.h=b/h,this.textheight=R/h,this.textwidth=M/h}this.bhasArrow&&null!=this.markupArrowConnected&&this.markupArrowConnected.setTextboxConnectionPoint(this.x,this.y,this.w,this.h);break;case 11:switch(a){case 4:v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n),this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v-=r,f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(y+=n,b-=n),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),this.y=y/h,this.w=v/h,this.h=b/h}break;case 12:switch(a){case 4:v-=r,b-=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v+=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n),v<0&&(v=1),b<0&&(b=1),this.w=v/h,this.h=b/h;break;case 1:f-=r,y-=n,v+=r,b+=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(v-=r,f+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(y+=n,b-=n),v<0&&(v=1),b<0&&(b=1),this.x=f/h,this.y=y/h,this.w=v/h,this.h=b/h;break;case 3:f-=r,v+=r,b-=n,(this.xscaled-r<d||this.xscaled-r>p)&&(f+=r,v-=r),(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f+=r,v-=r),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b+=n,y-=n),v<0&&(v=1),b<0&&(b=1),this.x=f/h,this.w=v/h,this.h=b/h;break;case 2:y-=n,v-=r,b+=n,(this.xscaled+this.wscaled-r<d||this.xscaled+this.wscaled-r>p)&&(f-=r,v+=r),(this.yscaled-n<g||this.yscaled-n>m)&&(y+=n,b-=n),(this.yscaled+this.hscaled-n<g||this.yscaled+this.hscaled-n>m)&&(b-=n,y+=n),v<0&&(v=1),b<0&&(b=1),this.y=y/h,this.w=v/h,this.h=b/h}this.font.setHeight(.16*this.w),0==this.alternative?(this.stampsmalltheight=.08*this.w-4,this.stampsmalltheight<1&&(this.stampsmalltheight=1),this.textheight+this.stampsmalltheight+this.h/10*2>this.h&&(this.font.setHeight(this.h/2-this.h/10*2),this.stampsmalltheight=this.textheight/2-4,this.stampsmalltheight<1&&(this.stampsmalltheight=1))):.6*this.w>=this.h?this.font.setHeight(this.h/4):this.font.setHeight(.16*this.w)}if(s.setmarkupmodified(!0),null!=Wt){var T=s.editaction;Wt.setMarkupSelected(s,T)}}},this.rotatedRectangle=function(){this.rotatedrect.x,this.rotatedrect.y,this.rotatedrect.w,this.rotatedrect.w},this.findrotatedrectangle=function(){if(0==this.type||1==this.type||13==this.type||8==this.type){var e=0,t=0;if(13==this.type)for(var a=s.getrotatedPoint(s.countshapes[0].x,s.countshapes[0].y),i=a.x,r=a.y,n=a.x,o=a.y,l=1;l<s.countshapes.length;l++)(a=s.getrotatedPoint(s.countshapes[l].x,s.countshapes[l].y)).x<i&&(i=a.x),a.y<r&&(r=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y);else if(0==this.type||1==this.type&&6==this.subtype){if(0!=this.pointlist.length)for(i=(a=s.getrotatedPoint(this.pointlist[0][0].x,this.pointlist[0][0].y)).x,r=a.y,n=a.x,o=a.y,t=0;t<this.pointlist.length;t++)for(e=0;e<this.pointlist[t].length;e++)(a=s.getrotatedPoint(this.pointlist[t][e].x,this.pointlist[t][e].y)).x<i&&(i=a.x),a.y<r&&(r=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y)}else if(this.points.length>0){var c=Ln();this.points[0].scale;a=s.getrotatedPoint(this.points[0].x,this.points[0].y);var h=s.getrotatedPoint(this.points[0].offsetx,this.points[0].offsety);for(a.x,h.x,a.y,h.y,i=a.x,r=a.y,n=a.x,o=a.y,e=0;e<this.points.length;e++)c/this.points[e].scale,a=s.getrotatedPoint(this.points[e].x,this.points[e].y),h=s.getrotatedPoint(this.points[e].offsetx,this.points[e].offsety),a.x,h.x,a.y,h.y,a.x<i&&(i=a.x),a.y<r&&(r=a.y),a.x>n&&(n=a.x),a.y>o&&(o=a.y)}return{x:i,y:r,w:n,h:o}}},this.findrectangle=function(){if(0==this.type||1==this.type||13==this.type||8==this.type){var e=0,t=0;if(13==this.type)for(var a=s.countshapes[0].x,i=s.countshapes[0].y,r=s.countshapes[0].x,n=s.countshapes[0].y,o=1;o<s.countshapes.length;o++)s.countshapes[o].x<a&&(a=s.countshapes[o].x),s.countshapes[o].y<i&&(i=s.countshapes[o].y),s.countshapes[o].x>r&&(r=s.countshapes[e].x),s.countshapes[o].y>n&&(n=s.countshapes[o].y);else if(0==this.type||1==this.type&&6==this.subtype){if(0!=this.pointlist.length)for(a=this.pointlist[0][0].x,i=this.pointlist[0][0].y,r=this.pointlist[0][0].x,n=this.pointlist[0][0].y,t=0;t<this.pointlist.length;t++)for(e=0;e<this.pointlist[t].length;e++)this.pointlist[t][e].x<a&&(a=this.pointlist[t][e].x),this.pointlist[t][e].y<i&&(i=this.pointlist[t][e].y),this.pointlist[t][e].x>r&&(r=this.pointlist[t][e].x),this.pointlist[t][e].y>n&&(n=this.pointlist[t][e].y)}else if(this.points.length>0){var l=Ln();this.points[0].scale;for(this.points[0].x,this.points[0].offsetx,this.points[0].y,this.points[0].offsety,a=this.points[0].x,i=this.points[0].y,r=this.points[0].x,n=this.points[0].y,e=0;e<this.points.length;e++)l/this.points[e].scale,this.points[e].x,this.points[e].offsetx,this.points[e].y,this.points[e].offsety,this.points[e].x<a&&(a=this.points[e].x),this.points[e].y<i&&(i=this.points[e].y),this.points[e].x>r&&(r=this.points[e].x),this.points[e].y>n&&(n=this.points[e].y)}this.x=a,this.y=i,this.w=r,this.h=n,this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,0!=this.type||this.origset||(this.origx=a,this.origy=i,this.origw=r,this.origh=n,this.origset=!0),(1==this.type&&2==this.subtype||8==this.type)&&this.addsides()}},this.removepoints=function(){this.pointlist=[],this.points=[],this.sides=[],this.countshapes=[]},this.addpoint=function(e,t){if(1==this.type&&6==this.subtype&&0==this.points.length){this.points.push({x:e,y:t});var a=s.setDimDrawme();this.setlastpoint(a.w,a.h)}this.points.push({x:e,y:t})},this.addrectpoint=function(e,t){this.points.push({x:e,y:t})},this.hidelabelmarkupobj=function(){this.hidevaluelabel=!0},this.showlabelmarkupobj=function(){this.hidevaluelabel=!1},this.addline=function(){this.pointlist.push(s.points),this.points=[]},this.snapToCorner=function(e,t,a){var i=s.getsnappoint(e,t);1==a?(this.x=i.x,this.y=i.y):4==a&&(this.w=i.x,this.h=i.y),s.setmarkupmodified(!0)},this.snapTo=function(e,t,a){var i=s.getsnappoint(e,t);a>=0&&a<=this.points.length-1&&(this.points[a].x=i.x,this.points[a].y=i.y),s.setmarkupmodified(!0)},this.getsnappoint=function(e,t){var a,i,r=jn();a=r.x,i=r.y;var n=Ln();return s.bfor3D&&(n=Aa/this.pageheight),{x:(e-a)/(n/=s.scaling)+this.xoffset,y:(t-i)/n+this.yoffset}},this.getSelectedpoint=function(){var e=void 0;return-1!=s.selectedpoint&&(this.points[s.selectedpoint]&&s.selectedpoint>=0&&s.selectedpoint<=this.points.length-1&&(e=this.points[s.selectedpoint]),this.countshapes[s.selectedpoint]&&s.selectedpoint>=0&&s.selectedpoint<=this.countshapes.length-1&&(e=this.countshapes[s.selectedpoint])),0!=s.selectedmultipoint.length&&this.pointlist[s.selectedmultipoint[0]][s.selectedmultipoint[1]]&&s.selectedmultipoint[1]>=0&&s.selectedmultipoint[1]<=this.pointlist[s.selectedmultipoint[0]].length-1&&(e=this.pointlist[s.selectedmultipoint[0]][s.selectedmultipoint[1]]),e},this.editpoint=function(e,t,a){if(4==s.editaction){var i=this.getSelectedpoint(a),r=e,n=t,o=Ln();if(s.bfor3D&&(o=Aa/this.pageheight),o/=s.scaling,s.bfor3D)l=0,c=Na,h=0,u=Aa;else var l=Bs.getCurrentpage().startx,c=Bs.getCurrentpage().endx,h=Bs.getCurrentpage().starty,u=Bs.getCurrentpage().endy;switch(Bs.getCurrentpage().drotation){case 0:r=e,n=t;break;case 90:r=t,n=-e;break;case 180:r=-e,n=-t;break;case 270:r=-t,n=e}if(null!=i){if(13==this.type){var d=0,p=0;d=i.x*o,p=i.y*o,d-=r,p-=n,i.x=d/o,i.y=p/o}else{d=0,p=0;var g=0,m=0;g=(i.x-this.xoffset)*o,g+=l,g-=r,m=(i.y-this.yoffset)*o,m+=h,m-=n,d=i.x*o,p=i.y*o,d-=r,p-=n,g>l&&g<c&&(i.x=d/o),m>h&&m<u&&(i.y=p/o)}this.findrectangle()}if(s.setmarkupmodified(!0),null!=Wt){var f=s.editaction;Wt.setMarkupSelected(s,f)}}},this.deletepoint=function(e){(1!=this.type||4!=this.subtype&&5!=this.subtype)&&(e>=0&&e<=this.points.length-1&&this.points.splice(e,1),e>=0&&e<=this.countshapes.length-1&&this.countshapes.splice(e,1),this.selectedpoint=-1,s.setmarkupmodified(!0))},this.insertcount=function(e){s.addcount(e),s.findrectangle(),s.setmarkupmodified(!0)},this.insertpoint=function(){if(1!=this.type||4!=this.subtype&&5!=this.subtype){var e=s.linesegment.p1>=0&&s.linesegment.p1<=this.points.length-1,t=s.linesegment.p2>=0&&s.linesegment.p2<=this.points.length-1;if(e&&t)if(1==s.type&&6==s.subtype);else{var a=this.points[s.linesegment.p1].x,i=this.points[s.linesegment.p1].y,r=a+.5*(this.points[s.linesegment.p2].x-a),n=i+.5*(this.points[s.linesegment.p2].y-i);0!=s.linesegment.p2?this.points.splice(s.linesegment.p2,0,{x:r,y:n}):2==this.points.length?this.points.splice(-1,0,{x:r,y:n}):this.points.push({x:r,y:n})}s.setmarkupmodified(!0)}},this.movepoint=function(e,t,a){a>=0&&a<=this.points.length-1&&(this.points[a].x=e,this.points[a].y=t)},this.setlastcount=function(e,t){this.countshapes[this.countshapes.length-1]&&(this.countshapes[this.countshapes.length-1].x=e,this.countshapes[this.countshapes.length-1].y=t)},this.getnumpoints=function(){var e=this.points.length;if(1==this.type&&6==this.subtype)for(var t=0;t<this.pointlist.length;t++)e+=this.pointlist[t].length;return e},this.setlastpoint=function(e,t){this.points.length>0&&(this.points[this.points.length-1].x=e,this.points[this.points.length-1].y=t,this.findrectangle())},this.getprevpoint=function(){return this.points.length>1&&{x:this.points[this.points.length-2].x,y:this.points[this.points.length-2].y}},this.getlastcount=function(){return this.countshapes.length>0&&{x:this.countshapes[this.countshapes.length-1].x,y:this.countshapes[this.countshapes.length-1].y}},this.getlastpoint=function(){return this.points.length>0&&{x:this.points[this.points.length-1].x,y:this.points[this.points.length-1].y}},this.startdraw=function(e){1==this.type&&6==this.subtype||(e.beginPath(),e.moveTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y))},this.displayurl=function(e,t,a){if(11!=s.type||3!=s.subtype){var i=1,r=s.linkURL;e.save(),e.font="10pt Arial";var n=e.measureText(r).width;n>i&&(i=n),i+=10,e.strokeStyle="black",e.fillStyle="rgba(113, 114, 118, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,i,20),e.fillRect(t,a+30,i,20),e.fillStyle="white",e.fillText(r,t+3,a+42),e.restore()}},this.hide=function(){s.display=!1},this.show=function(){s.display=!0},this.showlabeltype=function(e){8==this.type&&(this.labeltype=e)},this.getMarkupProperties=function(){var e=this.getMarkupType();return Lh({label:e.label,typename:e.type,type:this.type,subtype:this.subtype})},this.getMarkupType=function(){var e={label:"",type:"",groups:[]};switch(this.type){case 0:0==this.subtype&&(e.label="Freehand pen",e.type="PEN"),1==this.subtype&&(e.label="Eraser",e.type="ERASE");break;case 1:0==this.subtype&&(e.label="Polygon",e.type="POLYGON"),1==this.subtype&&(e.label="Polyline",e.type=["PEN","POLYLINE"]),2==this.subtype&&(e.label="Polygon",e.type="POLYGON"),3==this.subtype&&(e.label="Measure Path",e.type="PATH");break;case 2:e.label="Polycurve",e.type=["SHAPE","POLYCURVE"];break;case 3:0==this.subtype&&(e.label="Rectangle",e.type=["SHAPE","RECTANGLE"]),1==this.subtype&&(e.label="Rounded Rectangle",e.type=["SHAPE","ROUNDED_RECTANGLE"]),3==this.subtype&&(e.label="Marker",e.type="MARKER"),6==this.subtype&&(e.label="Rectanglular Area",e.type="AREARECT");break;case 4:0==this.subtype&&(e.label="Oval",e.type=["SHAPE","ELLIPSE"]),1==this.subtype&&(e.label="Circle",e.type=["SHAPE","CIRCLE"]);break;case 5:e.label="Revision Cloud",e.type=["SHAPE","CLOUD"];break;case 6:9==this.subtype?(e.label="Line",e.type=["ARROW","NO_ENDS"]):6==this.subtype?(e.label="Callout",e.type="TEXTARROW"):0==this.subtype?(e.label="Arrow",e.type=["ARROW","OPEN_SINGLE_END"]):1==this.subtype?(e.label="Arrow",e.type=["ARROW","FILLED_SINGLE_END"]):2==this.subtype?(e.label="Arrow",e.type=["ARROW","OPEN_BOTH_ENDS"]):3==this.subtype?(e.label="Arrow",e.type=["ARROW","FILLED_BOTH_ENDS"]):e.label="Arrow";break;case 7:e.label="Dimension Line",0==this.subtype?e.type=["DIMENSION","BAR"]:1==this.subtype&&(e.type=["DIMENSION","OPEN_ARROW"]);break;case 8:1==this.subtype?(e.label="Space",e.type="SPACE"):(e.label="Area",e.type="AREA");break;case 9:this.bhasArrow?(e.label="Callout",e.type="TEXT"):(e.label="Text",e.type="TEXT");break;case 11:switch(i){case 0:e.label="Image",e.type="IMAGE";break;case 1:e.label="Symbol",e.type="SYMBOL";break;case 3:e.label="Button",e.type="BUTTON";break;case 4:e.label="Signature",e.type="SIGNATURE";break;case 12:e.label="Stamp",e.type="IMAGESTAMP";break;case 20:e.label="Link",e.type="Link";break;case 21:e.label="InteractiveStamp",e.type="InteractiveStamp"}break;case 10:e.label="Note",e.type="NOTE";break;case 12:e.label="Stamp",e.type="STAMP";break;case 13:e.label="Count",e.type="COUNT"}return e},this.getDisplayName=function(){return Pn(s.signature)},this.getLayerName=function(){return as[s.layer].Name},this.replaceImage=function(e){if(11==s.type&&2==s.subtype)s.w=e.width,s.h=e.height,(t=new Image).src=e.src,s.image=t,s.imageloaded=!0;else if(11==s.type&&3==s.subtype){var t;s.w=e.width,s.h=e.height,(t=new Image).src=e.src,s.image=t,s.imageloaded=!0,s.subtype=4}},this.displaylabel=function(e,t,a){if(null!=Ie&&Ie.setMarkupHover(s,t,a),Ei){var i=s.getMarkupType(),r=s.getDisplayName(),n=s.getLayerName(),o=s.GetDateTime(!0),l="",c=1,h=50,u=!1;switch(e.save(),e.font="10pt Arial",this.type){case 9:l=this.text;var d=e.measureText(l),p=d.width;break;case 10:var g=function(e,t){var a,i="\n",r=!1,s="";do{for(var n=!1,o=t-1;o>=0;o--)if(a=e.charAt(o),new RegExp(/^\s$/).test(a.charAt(0))){s+=[e.slice(0,o),i].join(""),e=e.slice(o+1),n=!0;break}n||(s+=[e.slice(0,t),i].join(""),e=e.slice(t)),e.length<t&&(r=!0)}while(!r);return s+e}(l=null!=this.text?this.text:"",30).split("\n");d=0;for(var m=0;m<g.length;m++)e.measureText(g[m])>d&&(d=e.measureText(g[m]));(p=d.width)>c&&(c=p),h=60,u=!0}var f=e.measureText(i).width;f>c&&(c=f);var y=e.measureText(r).width;y>c&&(c=y);var v=e.measureText(n).width;v>c&&(c=v);var b=e.measureText(o).width;if(b>c&&(c=b),10!=this.type)c+=10,e.strokeStyle="black",e.fillStyle="rgba(113, 114, 118, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,c,h),e.fillRect(t,a+30,c,h),e.fillStyle="white",e.fillText(i,t+3,a+42),e.fillText(r,t+3,a+54),e.fillText(n,t+3,a+66),e.fillText(o,t+3,a+78),u&&e.fillText(l,t+3,a+90);else{if(c<200?c=200:c+=10,h=150,e.strokeStyle="black",e.fillStyle="rgba(255, 255, 0, 0.8)",e.lineWidth=1,e.strokeRect(t,a+30,c,h),e.fillRect(t,a+30,c,h),e.fillStyle="black",e.save(),e.beginPath(),e.rect(t,a+30,c,h),e.clip(),e.fillText(r,t+5,a+46),e.fillText(o,t+5,a+60),e.fillText(n,t+5,a+74),u){var x=a+100;for(m=0;m<g.length;m++)e.fillText(g[m],t+5,x),x+=12}e.restore()}e.restore()}},this.Rect=function(e,t,a,i,r,n,o,l,c,h){if(e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n,0!=s.rotation&&9!=s.type){var u=t+i/2,d=a+r/2;e.translate(u,d),e.rotate(s.rotation),e.translate(-u,-d)}e.beginPath(),e.moveTo(t,a),e.lineTo(t+i,a),e.lineTo(t+i,a+r),e.lineTo(t,a+r),e.closePath(),o&&e.fill(),l&&e.stroke(),e.restore()},this.drawradius=function(e,t,a,i,r,n,o,l,c){e.save(),e.strokeStyle=l,e.lineWidth=2;var h=Math.max(t,i)-Math.min(t,i),u=Math.max(a,r)-Math.min(a,r);s.getdiag(h,u),e.beginPath(),e.moveTo(t-n,a),e.lineTo(t+n,a),e.moveTo(t,a-n),e.lineTo(t,a+n),e.stroke(),e.restore()},this.radiusDimLeader=function(e,t,a,i,r,s,n){},this.Circle=function(e,t,a,i,r,n,o,l,c,h){e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n;var u=Math.max(t,i)-Math.min(t,i),d=Math.max(a,r)-Math.min(a,r),p=s.getdiag(u,d);e.beginPath(),e.arc(t,a,p,0,2*Math.PI),o&&e.fill(),l&&e.stroke(),e.restore()},this.Oval=function(e,t,a,i,r,n,o,l,c,h){var u=i/2*C,d=r/2*C,p=t+i,g=a+r,m=t+i/2,f=a+r/2;if(e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n,0!=s.rotation){var y=t+i/2,v=a+r/2;e.translate(y,v),e.rotate(s.rotation),e.translate(-y,-v)}e.beginPath(),e.moveTo(t,f),e.bezierCurveTo(t,f-d,m-u,a,m,a),e.bezierCurveTo(m+u,a,p,f-d,p,f),e.bezierCurveTo(p,f+d,m+u,g,m,g),e.bezierCurveTo(m-u,g,t,f+d,t,f),e.closePath(),o&&e.fill(),l&&e.stroke(),e.restore()},this.addcountLoad=function(e){s.countshapes.push({x:e.x,y:e.y})},this.addcount=function(e){s.countshapes.push({x:e.x,y:e.y});var t=s.setDimDrawme();this.setlastcount(t.w,t.h)},this.getcount=function(){return s.dimtext=s.countshapes.length.toString(),s.countshapes.length},this.setCountSize=function(e){s.outerRadius=e,s.innerRadius=.4*e},this.shapes=function(e,t,a,i,r,n,o,l,c,h){if(0!=s.countshapes.length){var u=0,d=a*s.fixedscaleFactor,p=i*s.fixedscaleFactor;di&&(d=a,p=i);var g=0,m=0;for(u=0;u<s.countshapes.length;u++)switch(g=(s.countshapes[u].x-this.xoffset)*l,m=(s.countshapes[u].y-this.yoffset)*l,g+=c,m+=h,t){case 0:Lu(e,g,m,d,0,r,n,n);break;case 1:Au(e,g,m,d,0,r,n,n);break;case 2:Nu(e,g,m,d,0,r,n,n);break;case 3:Vu(e,g,m,d,0,r,n,n);break;case 4:Hu(e,g,m,d,p=(i=.4*Gr)*s.fixedscaleFactor,r,n,n);break;case 5:Uu(e,g,m,d,p=(i=.5*Gr)*s.fixedscaleFactor,r=.8*p,0,n);break;case 6:Gu(e,g,m,d,p=(i=.5*Gr)*s.fixedscaleFactor,r=.8*p,0,n);break;case 7:Bu(e,g,m,d,p=(i=.5*Gr)*s.fixedscaleFactor,r=.8*p,0,n)}}},this.polygoncloud=function(e,t,a,i,r,n,o,l,c,h,u,d){if(0!=this.points.length){var p=2*t,g=0,m=(this.points[0].x-this.xoffset)*l,f=(this.points[0].y-this.yoffset)*l;u&&(m+=c,f+=h);var y=m,v=f,b=m,x=f;for(e.save(),e.lineWidth=ui?a*s.fixedscaleFactor:a*l,di&&(e.lineWidth=a),e.fillStyle=n,e.strokeStyle=o,e.beginPath(),g=1;g<s.points.length;g++){y=m,v=f,m=(this.points[g].x-this.xoffset)*l,f=(this.points[g].y-this.yoffset)*l,u&&(m+=c,f+=h),b=m,x=f;const a=Math.sqrt((b-y)**2+(x-v)**2),i=Math.atan2(x-v,b-y);p=2*t;for(let r=0;r<=a;r+=p){const a=y+r*Math.cos(i),s=v+r*Math.sin(i);g>1&&0==r?e.arc(a,s,t,.5*Math.PI+i,0+i):e.arc(a,s,t,Math.PI+i,0+i)}r&&(e.stroke(),e.beginPath())}if(d&&s.points.length>2){y=b,v=x,m=(this.points[0].x-this.xoffset)*l,f=(this.points[0].y-this.yoffset)*l,u&&(m+=c,f+=h),b=m,x=f;const a=Math.sqrt((b-y)**2+(x-v)**2),i=Math.atan2(x-v,b-y);p=2*t;for(let r=0;r<=a;r+=p){const a=y+r*Math.cos(i),s=v+r*Math.sin(i);g>1&&0==r?e.arc(a,s,t,.5*Math.PI+i,0+i):e.arc(a,s,t,Math.PI+i,0+i)}r&&e.stroke()}i&&e.fill(),e.restore()}},this.polygonhole=function(e,t,a,i,r,s,n,o,l,c,h){if(0!=h.points.length){var u=h.points.length-1,d=u;for(n/=h.scaling,d=u;d>=0;d--){var p=(h.points[d].x-h.xoffset)*n,g=(h.points[d].y-h.yoffset)*n;c&&(p+=o,g+=l),d==u&&e.moveTo(p,g),e.lineTo(p,g)}e.closePath()}},this.polygon=function(e,t,a,i,r,n,o,l,c,h){if(0!=this.points.length){var u=0,d=(this.points[0].x-this.xoffset)*o,p=(this.points[0].y-this.yoffset)*o;for(h&&(d+=l,p+=c),e.save(),e.strokeStyle=n,e.lineWidth=ui?t*s.fixedscaleFactor:t*o,di&&(e.lineWidth=t),e.fillStyle=r,e.beginPath(),e.moveTo(d,p),u=1;u<s.points.length;u++)d=(this.points[u].x-this.xoffset)*o,p=(this.points[u].y-this.yoffset)*o,h&&(d+=l,p+=c),e.lineTo(d,p);e.closePath();var g=o*s.scaling;if(0!=this.holes.length)for(var m=0;m<this.holes.length;m++)this.polygonhole(e,t,a,i,r,n,g,l,c,h,this.holes[m]);a&&e.fill(),i&&e.stroke(),e.restore()}},this.getangleofline=function(e,t,a,i,r){var s=0,n=0;return r?(s=Math.abs(a-e),n=Math.abs(i-t)):(s=a-e,n=i-t),{angle:Math.atan2(n,s),pointx:a,pointy:i}},this.polylineSegments=function(e,t,a,i,r,n,o){var l=0,c=0,h=0,u=0;for(e.save(),e.strokeStyle=a,e.lineWidth=ui?t*s.fixedscaleFactor:t*i,di&&(e.lineWidth=t),e.beginPath(),h=0;h<s.points.length;h++)l=(this.points[h].x-this.xoffset)*i,c=(this.points[h].y-this.yoffset)*i,o&&(l+=r,c+=n),0==h?e.moveTo(l,c):e.lineTo(l,c);for(e.stroke(),e.beginPath(),u=0;u<this.pointlist.length;u++)for(h=0;h<this.pointlist[u].length;h++)l=(this.pointlist[u][h].x-this.xoffset)*i,c=(this.pointlist[u][h].y-this.yoffset)*i,o&&(l+=r,c+=n),0==h?e.moveTo(l,c):e.lineTo(l,c);e.stroke(),e.restore()},this.polyline=function(e,t,a,i,r,n,o){if(0!=this.points.length){var l=0,c=(this.points[0].x-this.xoffset)*i,h=(this.points[0].y-this.yoffset)*i;for(o&&(c+=r,h+=n),e.save(),e.strokeStyle=a,e.lineWidth=ui?t*s.fixedscaleFactor:t*i,di&&(e.lineWidth=t),e.beginPath(),e.moveTo(c,h),l=1;l<s.points.length;l++)c=(this.points[l].x-this.xoffset)*i,h=(this.points[l].y-this.yoffset)*i,o&&(c+=r,h+=n),e.lineTo(c,h);e.stroke(),e.restore()}},this.drawangle=function(e,t,a,i,r,n,o,l){if(0!=this.points.length){var c=0,h=0,u=0,d=0,p=[],g=0,m=0,f=!1,y=0,v="",b=0,x=(this.points[0].x-this.xoffset)*i,w=(this.points[0].y-this.yoffset)*i;o&&(x+=r,w+=n);var k=x,D=w;if(e.save(),e.strokeStyle=a,ui){e.lineWidth=t*s.fixedscaleFactor;var C=50*s.fixedscaleFactor}else e.lineWidth=t*i,C=50*i;for(di&&(e.lineWidth=t,C=50),e.beginPath(),e.moveTo(x,w),b=1;b<s.points.length;b++){x=(this.points[b].x-this.xoffset)*i,w=(this.points[b].y-this.yoffset)*i,o&&(x+=r,w+=n),p.push(s.getangleofline(k,D,x,w,!1));var P={x1:k,y1:D,x2:x,y2:w};e.lineTo(x,w);var S=this.getlinelength(P.x1,P.y1,P.x2,P.y2);S<C&&(C=S),k=x,D=w}if(2==p.length&&(c=p[0].angle,c-=Math.PI,h=p[1].angle,g=p[0].pointx,m=p[0].pointy,f=!0),e.stroke(),f){if(e.beginPath(),e.arc(g,m,C,c,h,l),e.strokeStyle="blue",e.lineWidth=4,e.stroke(),l){var R=c;c=h,h=R}u=c<0?c+2*Math.PI:c,d=h<0?h+2*Math.PI:h;var M=u*(180/Math.PI);(y=d*(180/Math.PI)-M)<0&&(y=360+y),v=y.toFixed(1),v+="Â°"}return e.restore(),v}},this.polycurves=function(e,t,a,i){var r=0,n=new Gs,o=new Gs,l=(this.points[0].x-this.xoffset)*i,c=(this.points[0].y-this.yoffset)*i;for(Bs.getCurrentpage().usevectorxml?(l+=Bs.getCurrentpage().dxvector,c+=Bs.getCurrentpage().dyvector):Bs.getCurrentpage().usepdfjs?(l+=Bs.getCurrentpage().dxpdf,c+=Bs.getCurrentpage().dypdf):(l+=Bs.getCurrentpage().dx,c+=Bs.getCurrentpage().dy),e.save(),e.strokeStyle=a,e.lineWidth=t*i,e.beginPath(),e.moveTo(l,c),o.x=l,o.y=c,r=1;r<s.points.length;r++)l=(this.points[r].x-this.xoffset)*i,c=(this.points[r].y-this.yoffset)*i,Bs.getCurrentpage().usevectorxml?(l+=Bs.getCurrentpage().dxvector,c+=Bs.getCurrentpage().dyvector):Bs.getCurrentpage().usepdfjs?(l+=Bs.getCurrentpage().dxpdf,c+=Bs.getCurrentpage().dypdf):(l+=Bs.getCurrentpage().dx,c+=Bs.getCurrentpage().dy),Tn(r)?(e.moveTo(o.x,o.y),e.quadraticCurveTo(n.x,n.y,l,c),o.x=l,o.y=c):(r+1==s.points.length&&e.lineTo(l,c),n.x=l,n.y=c);e.stroke(),e.restore()},this.dimensionLeader=function(e,t,a,i,r,s,n,o,l,c,h,u){var d=i-t,p=r-a,g=90/(180/Math.PI),m=o/(180/Math.PI),f=Math.atan2(p,d),y=Math.abs(n/Math.cos(m)),v=n/2,b=Math.PI+f,x=b+m,w=b-m,k=b+g,D=b-g,C=i+Math.cos(x)*y,P=r+Math.sin(x)*y,S=i+Math.cos(w)*y,R=r+Math.sin(w)*y,M=i+Math.cos(k)*v,T=r+Math.sin(k)*v,E=i+Math.cos(D)*v,F=r+Math.sin(D)*v,I=i+Math.cos(D)*s,j=r+Math.sin(D)*s,O=t+Math.cos(f)*v,L=a+Math.sin(f)*v,V=i-Math.cos(f)*v,N=r-Math.sin(f)*v,A=f+m,B=f-m,U=f+g,G=f-g,H=t+Math.cos(A)*y,z=a+Math.sin(A)*y,W=t+Math.cos(B)*y,_=a+Math.sin(B)*y,X=t+Math.cos(U)*v,Y=a+Math.sin(U)*v,q=t+Math.cos(G)*v,Z=a+Math.sin(G)*v,J=t+Math.cos(U)*s,K=a+Math.sin(U)*s,Q=I+Math.cos(x)*y,$=j+Math.sin(x)*y,ee=I+Math.cos(w)*y,te=j+Math.sin(w)*y,ae=J+Math.cos(A)*y,ie=K+Math.sin(A)*y,re=J+Math.cos(B)*y,se=K+Math.sin(B)*y;if(e.save(),e.lineWidth=l,e.strokeStyle=u,e.fillStyle=h,9==this.subtype?e.lineCap="butt":e.lineCap="round",e.beginPath(),1==c||3==c?(1==c?e.moveTo(t,a):3==c&&e.moveTo(O,L),e.lineTo(V,N)):0==s?(e.moveTo(t,a),e.lineTo(i,r)):(e.moveTo(J,K),e.lineTo(I,j)),e.stroke(),0==c&&(e.beginPath(),e.moveTo(i,r),e.lineTo(C,P),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(S,R),e.stroke()),1==c&&(e.beginPath(),e.moveTo(i,r),e.lineTo(C,P),e.lineTo(S,R),e.closePath(),e.fill()),2==c&&(e.beginPath(),e.moveTo(t,a),e.lineTo(H,z),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(W,_),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(C,P),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(S,R),e.stroke()),3==c&&(e.beginPath(),e.moveTo(t,a),e.lineTo(H,z),e.lineTo(W,_),e.closePath(),e.fill(),e.lineCap="round",e.beginPath(),e.moveTo(i,r),e.lineTo(C,P),e.lineTo(S,R),e.closePath(),e.fill(),e.lineCap="round"),4==c&&(e.beginPath(),e.moveTo(t,a),0==s?e.lineTo(X,Y):e.lineTo(J,K),e.stroke(),0==s&&(e.beginPath(),e.moveTo(t,a),e.lineTo(q,Z),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(M,T),e.stroke()),e.beginPath(),e.moveTo(i,r),0==s?e.lineTo(E,F):e.lineTo(I,j),e.stroke()),5==c){if(0==s)var ne=t,oe=a,le=i,ce=r,he=H,ue=z,de=W,pe=_,ge=C,me=P,fe=S,ye=R;else ne=J,oe=K,le=I,ce=j,he=ae,ue=ie,de=re,pe=se,ge=Q,me=$,fe=ee,ye=te;e.beginPath(),e.moveTo(ne,oe),e.lineTo(he,ue),e.stroke(),e.beginPath(),e.moveTo(ne,oe),e.lineTo(de,pe),e.stroke(),e.beginPath(),e.moveTo(le,ce),e.lineTo(ge,me),e.stroke(),e.beginPath(),e.moveTo(le,ce),e.lineTo(fe,ye),e.stroke(),e.beginPath(),e.moveTo(t,a),0==s?e.lineTo(X,Y):e.lineTo(J,K),e.stroke(),0==s&&(e.beginPath(),e.moveTo(t,a),e.lineTo(q,Z),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(M,T),e.stroke()),e.beginPath(),e.moveTo(i,r),0==s?e.lineTo(E,F):e.lineTo(I,j),e.stroke()}return e.restore(),{x:J,y:K,w:I,h:j}},this.barhead=function(e,t,a,i,r,s,n,o,l){var c=i-t,h=r-a,u=90/(180/Math.PI),d=Math.atan2(h,c),p=n/2,g=Math.PI+d,m=g+u,f=g-u,y=i+Math.cos(m)*p,v=r+Math.sin(m)*p,b=i+Math.cos(f)*p,x=r+Math.sin(f)*p,w=(Math.cos(d),Math.sin(d),Math.cos(d),Math.sin(d),d+u),k=d-u,D=t+Math.cos(w)*p,C=a+Math.sin(w)*p,P=t+Math.cos(k)*p,S=a+Math.sin(k)*p;e.save(),e.lineCap="round",e.lineWidth=o,e.strokeStyle=l,s.start&&(e.beginPath(),e.moveTo(t,a),e.lineTo(D,C),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(P,S),e.stroke()),s.end&&(e.beginPath(),e.moveTo(i,r),e.lineTo(y,v),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(b,x),e.stroke()),e.restore()},this.getPadding=function(e){return s.padding&&(e.x>s.x?e.xpadding=e.x+s.padding.w:e.x<s.x&&(e.xpadding=e.x-s.padding.w),e.y>s.y?e.ypadding=e.y+s.padding.h:e.y<s.y&&(e.ypadding=e.y-s.padding.h),e.busepadding=!0),e},this.calloutbox=function(e,t,a,i,r,n){if(e.save(),e.lineWidth=r,e.strokeStyle=n,0!=s.pagerotation&&180!=s.pagerotation){var o=s.pagerotation*(Math.PI/180),l=a,c=i;e.translate(l,c),e.rotate(o),e.translate(-l,-c)}e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+t.w,t.y),e.lineTo(t.x+t.w,t.y+t.h),e.lineTo(t.x,t.y+t.h),e.closePath(),e.stroke(),e.restore()},this.arrowhead=function(e,t,a,i,r,s,n,o,l,c,h){var u=i-t,d=r-a,p=n/(180/Math.PI),g=Math.atan2(d,u),m=Math.abs(o/Math.cos(p)),f=Math.PI+g,y=f+p,v=f-p,b=i+Math.cos(y)*m,x=r+Math.sin(y)*m,w=i+Math.cos(v)*m,k=r+Math.sin(v)*m,D=g+p,C=g-p,P=t+Math.cos(D)*m,S=a+Math.sin(D)*m,R=t+Math.cos(C)*m,M=a+Math.sin(C)*m;e.save(),e.lineCap="round",e.lineWidth=l,e.strokeStyle=c,s.start&&(h?(e.beginPath(),e.moveTo(t,a),e.lineTo(P,S),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(R,M),e.closePath(),e.stroke()):(e.beginPath(),e.moveTo(t,a),e.lineTo(P,S),e.lineTo(R,M),e.closePath(),e.fill(),e.lineCap="round")),s.end&&(h?(e.beginPath(),e.moveTo(i,r),e.lineTo(b,x),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(w,k),e.closePath(),e.stroke()):(e.beginPath(),e.moveTo(i,r),e.lineTo(b,x),e.lineTo(w,k),e.closePath(),e.fill())),e.restore()},this.getdrawBox=function(e){var t=s.fixedscaleFactor;return tn.height,e||(e={x:s.w,y:s.h}),In(e.x,e.y,t,s.arrowTextPos)},this.arrow=function(e,t,a,i,r,n,o,l,c,h,u){var d={repheight:r,repwidth:i,width:i,height:r,arrowl:n},p=i-t,g=r-a,m=Math.atan2(g,p),f=n/2,y=t+Math.cos(m)*f,v=a+Math.sin(m)*f,b=i-Math.cos(m)*f,x=r-Math.sin(m)*f,w={start:!1,end:!1};if(e.save(),e.lineWidth=l,e.strokeStyle=u,e.fillStyle=h,9==this.subtype?e.lineCap="butt":e.lineCap="round",e.beginPath(),1==c||3==c)1==c?e.moveTo(t,a):3==c&&e.moveTo(y,v),e.lineTo(b,x);else if(6==c){var k=s.fixedscaleFactor;k*=Xr,tn.height;var D=In(i,r,k,s.arrowTextPos);e.moveTo(t,a),d=function(e){if(s.saved)switch(s.arrowTextPos){case 1:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;case 2:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;case 3:e.repheight=e.height+e.arrowl,e.repwidth=e.width;break;case 4:e.repheight=e.height-e.arrowl,e.repwidth=e.width}else switch(s.arrowTextPos){case 1:switch(s.pagerotation){case 90:e.repwidth=e.width,e.repheight=e.height-e.arrowl;break;case 270:e.repwidth=e.width,e.repheight=e.height+e.arrowl;break;default:e.repwidth=e.width-e.arrowl,e.repheight=e.height}break;case 2:switch(s.pagerotation){case 90:e.repwidth=e.width,e.repheight=e.height+e.arrowl;break;case 270:e.repwidth=e.width,e.repheight=e.height-e.arrowl;break;default:e.repwidth=e.width+e.arrowl,e.repheight=e.height}break;case 3:switch(s.pagerotation){case 90:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;case 270:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;default:e.repheight=e.height+e.arrowl,e.repwidth=e.width}break;case 4:switch(s.pagerotation){case 90:e.repwidth=e.width+e.arrowl,e.repheight=e.height;break;case 270:e.repwidth=e.width-e.arrowl,e.repheight=e.height;break;default:e.repheight=e.height-e.arrowl,e.repwidth=e.width}}return e}(d),e.lineTo(d.repwidth,d.repheight),e.lineTo(i,r)}else e.moveTo(t,a),e.lineTo(i,r);e.stroke(),0==c&&(w.end=!0,w.start=!1,s.arrowhead(e,t,a,i,r,w,o,n,l,u,!0)),1==c&&(w.end=!0,w.start=!1,s.arrowhead(e,t,a,i,r,w,o,n,l,u,!1)),2==c&&(w.end=!0,w.start=!0,s.arrowhead(e,t,a,i,r,w,o,n,l,u,!0)),3==c&&(w.end=!0,w.start=!0,s.arrowhead(e,t,a,i,r,w,o,n,l,u,!1)),4==c&&(w.end=!0,w.start=!0,s.barhead(e,t,a,i,r,w,n,l,u)),5==c&&(w.end=!0,w.start=!0,s.arrowhead(e,t,a,i,r,w,o,n,l,u,!0),w.end=!0,w.start=!0,s.barhead(e,t,a,i,r,w,n,l,u)),6==c&&(w.end=!1,w.start=!0,s.arrowhead(e,t,a,d.repwidth,d.repheight,w,o,n,l,u,!0),s.saved?s.padding=void 0:(s.padding={maxx:D.x+D.w,maxy:D.y+D.h,minx:D.x,miny:D.y,w:D.w,h:D.h},s.calloutbox(e,D,i,r,l,u))),e.restore()},this.setdimvaluearea=function(){s.dimarea=0;var e=0,t=0,a="",i=Bs.getCurrentpage().scaleObject.AreaUnitlabel,r=Bs.getCurrentpage().scaleObject.ndimprecision;s.hasScale&&(i=s.scaleObject.AreaUnitlabel,r=s.scaleObject.ndimprecision,ge=s);var n=this.scaling*this.scaling;if(3==this.type)s.dimarea=s.SquareArea(),a=(a=(a=vo(s.dimarea/n)).toFixed(ne))+" "+i;else if(0==this.points.length)a="";else{if(s.dimarea=s.PolygonArea(),s.holes.length>0)for(t=0;t<s.holes.length;t++)e=s.PolygonHoleArea(s.holes[t]),s.holes[t].dimarea=e,s.dimarea-=e,s.holes[t].dimarea=vo(s.holes[t].dimarea/n);s.dimarea=vo(s.dimarea/n),a=(a=s.dimarea.toFixed(r))+" "+i}return ge=null,a},this.setdimvalueperimeter=function(){var e="",t=!1,a=Bs.getCurrentpage().scaleObject.Unitofmeasure,i=Bs.getCurrentpage().scaleObject.Unitlabel;Bs.getCurrentpage().scaleObject.ndimprecision,s.hasScale&&(a=s.scaleObject.Unitofmeasure,i=s.scaleObject.Unitlabel,s.scaleObject.ndimprecision,ge=s);for(var r=0,n=0;n<s.points.length;n++)if(n>0){var o=s.points[n].x-s.points[n-1].x,l=s.points[n].y-s.points[n-1].y;r+=s.getdiag(o,l)}if(o=s.points[0].x-s.points[s.points.length-1].x,l=s.points[0].y-s.points[s.points.length-1].y,r+=s.getdiag(o,l),2==a){Zr&&(t=!0);var c=s.setfractionvalue(r)}return e=(e=(e=ko(r/s.scaling)).toFixed(ne))+" "+i,ge=null,t&&(e=c),e},this.setdimvaluepolySegments=function(){for(var e=0,t="",a=!1,i=[],r=[],n=Bs.getCurrentpage().scaleObject.Unitofmeasure,o=Bs.getCurrentpage().scaleObject.Unitlabel,l=0,c=0,h=0,u=0;u<s.points.length;u++)if(u>0){var d=s.points[u].x-s.points[u-1].x,p=s.points[u].y-s.points[u-1].y;e+=s.getdiag(d,p)}for(c=0;c<this.pointlist.length;c++)for(l=0;l<this.pointlist[c].length;l++)l>0&&(d=s.pointlist[c][l].x-s.pointlist[c][l-1].x,p=s.pointlist[c][l].y-s.pointlist[c][l-1].y,i.push(s.getdiag(d,p)),e+=s.getdiag(d,p));for(h=0;h<i.length;h++)if(0==i[h])r.push("");else{if(2==n){Zr&&(a=!0);var g=s.setfractionvalue(i[h])}t=(t=(t=ko(i[h]/s.scaling)).toFixed(ne))+" "+o,a&&(t=g),r.push(t)}return 0==e?t="":(2==n&&(Zr&&(a=!0),g=s.setfractionvalue(e)),t=(t=(t=ko(e/s.scaling)).toFixed(ne))+" "+o,a&&(t=g)),r.push(t),r},this.getlinelength=function(e,t,a,i){var r=a-e,n=i-t;return s.getdiag(r,n)},this.setdimvaluepoly=function(){var e=0,t="",a=!1,i=Bs.getCurrentpage().scaleObject.Unitofmeasure,r=Bs.getCurrentpage().scaleObject.Unitlabel;Bs.getCurrentpage().scaleObject.ndimprecision,s.hasScale&&(i=s.scaleObject.Unitofmeasure,r=s.scaleObject.Unitlabel,s.scaleObject.ndimprecision,ge=s);for(var n=0;n<s.points.length;n++)if(n>0){var o=s.points[n].x-s.points[n-1].x,l=s.points[n].y-s.points[n-1].y;e+=s.getdiag(o,l)}if(0==e)t="";else{if(2==i){Zr&&(a=!0);var c=s.setfractionvalue(e)}t=(t=(t=ko(e/s.scaling)).toFixed(ne))+" "+r,ge=null,a&&(t=c)}return t},this.setfractionvalue=function(e){var t=Bs.getCurrentpage().scaleObject.SubmeasureUnit;s.hasScale&&(t=s.scaleObject.SubmeasureUnit);var a=wo(e/this.scaling),i=a.quot,r=a.rem;if(1==t){var n=i+'"';0!=a.numerator&&0!=a.denominator&&(n=a.numerator==a.denominator?i+'"':i+" "+a.numerator+"/"+a.denominator+'"')}return 2==t&&(n=0!=r?i+"' - "+r+'"':i+"'",0!=a.numerator&&0!=a.denominator&&(n=a.numerator==a.denominator?i+"' - "+r+'"':0!=r?i+"' - "+r+" "+a.numerator+"/"+a.denominator+'"':i+"' - "+a.numerator+"/"+a.denominator+'"')),n},this.setdimvalue=function(e,t,a,i){var r=Math.abs(a-e),n=Math.abs(i-t),o=s.getdiag(r,n),l=!1,c=Bs.getCurrentpage().scaleObject.Unitofmeasure,h=Bs.getCurrentpage().scaleObject.Unitlabel,u=Bs.getCurrentpage().scaleObject.ndimprecision;if(s.hasScale&&(c=s.scaleObject.Unitofmeasure,h=s.scaleObject.Unitlabel,u=s.scaleObject.ndimprecision,ge=s),2==c){Zr&&(l=!0);var d=s.setfractionvalue(o),p=s.setfractionvalue(r),g=s.setfractionvalue(n)}this.dimtext=ko(o/this.scaling),this.dimtext=this.dimtext.toFixed(u),this.dimtext=this.dimtext+" "+h,this.dimtextx=ko(r/this.scaling),this.dimtextx=this.dimtextx.toFixed(u),this.dimtextx=this.dimtextx+" "+h,this.dimtexty=ko(n/this.scaling),this.dimtexty=this.dimtexty.toFixed(u),this.dimtexty=this.dimtexty+" "+h,ge=null,l&&(this.dimtext=d,this.dimtextx=p,this.dimtexty=g)},this.getUnitLength=function(e){var t="",a=!1,i=Bs.getCurrentpage().scaleObject.Unitofmeasure,r=Bs.getCurrentpage().scaleObject.Unitlabel,n=Bs.getCurrentpage().scaleObject.ndimprecision;if(s.hasScale&&(i=s.scaleObject.Unitofmeasure,r=s.scaleObject.Unitlabel,n=s.scaleObject.ndimprecision,ge=s),2==i){Zr&&(a=!0);var o=s.setfractionvalue(e)}return t=(t=(t=ko(e/this.scaling)).toFixed(n))+" "+r,a&&(t=o),ge=null,t},this.customlabeldraw=function(e,t,a,i,r,n,o){e.textAlign="start",s.font.setScale(o),e.font=s.font.fontstringScaled;var l=e.measureText(dimtext).width,c=n;a+=s.labeloffsetx*o,i+=s.labeloffsety*o,a-=l/2,i+=c/2,e.lineWidth=1,e.strokeStyle=r,e.fillStyle="white",e.fillRect(a-10*o,i-20*o,l+20*o,n+15*o),e.strokeRect(a-10*o,i-20*o,l+20*o,n+15*o)},this.insidelabel=function(e,t){var a=!1;return!s.busecustomlabel&&1==s.subtype||Es||e>s.labelRect.x&&e<s.labelRect.x+s.labelRect.w&&t>s.labelRect.y&&t<s.labelRect.y+s.labelRect.h&&(a=!0),a},this.areavaluedraw=function(e,t,a,i,r,n,o,l){e.textAlign="start",di&&(o=1),s.font.setScale(o),e.font=s.font.fontstringScaled;var c=s.font.height/12,h=10*c,u=20*c,d=20*c,p=15*c,g=e.measureText(t).width,m=n,f=s.font.height*o;di?(a+=1*s.labeloffsetx,i+=1*s.labeloffsety):(a+=s.labeloffsetx*l,i+=s.labeloffsety*l),a-=g/2,i+=m/2,e.lineWidth=1,e.strokeStyle=r,e.fillStyle=s.labelfillcolor,s.labelRect.x=a-h*o,s.labelRect.y=i-u*o,s.labelRect.w=g+d*o,s.labelRect.h=f+p*o,e.fillRect(a-h*o,i-u*o,g+d*o,f+p*o),e.strokeRect(a-h*o,i-u*o,g+d*o,f+p*o),e.fillStyle="black",e.fillText(t,a,i)},this.dimvaluedraw=function(e,t,a,i,r,n,o,l){if(!s.hidevaluelabel){e.save(),di&&(o=1);var c=i-t,h=r-a;3==s.type&&(c=i,h=r),s.getdiag(c,h);var u=Math.atan2(h,c);e.textAlign="start",s.font.setScale(o);var d=s.font.height*o;this.textheight=s.font.height;var p=s.font.height/12,g=10*p,m=5*p,f=20*p,y=10*p;e.font=s.font.fontstringScaled;var v=e.measureText(this.dimtext).width;if(s.saved)var b=t+c/2-v/2,x=a+h/2+d/2;else b=i+15*o,x=r,3==s.type&&(b=i+t+15*o,x=r+a);if((u>.5*Math.PI||u<-.5*Math.PI)&&0==s.pagerotation&&(u+=Math.PI),l&&s.saved){var w=t+c/2,D=a+h/2;e.translate(w,D),e.rotate(u),e.translate(-w,-D)}e.lineWidth=1;var C=x-d;e.fillStyle="white",e.strokeStyle=this.strokecolor,e.fillRect(b-g*o,C-m*o,v+f*o,d+y*o),e.strokeRect(b-g*o,C-m*o,v+f*o,d+y*o),k.w=v+f*o,k.h=d+y*o,e.fillStyle="black",e.fillText(this.dimtext,b,x),e.restore()}},this.roundedRect=function(e,t,a,i,r,n,o,l,c,h,u,d){if(e.save(),e.strokeStyle=d,e.fillStyle=u,e.lineWidth=l,0!=n){var p=t+i/2,g=a+r/2;e.translate(p,g),e.rotate(s.rotation),e.translate(-p,-g)}e.beginPath(),e.moveTo(t+o,a),e.lineTo(t+i-o,a),e.arcTo(t+i,a,t+i,a+o,o),e.lineTo(t+i,a+r-o),e.arcTo(t+i,a+r,t+i-o,a+r,o),e.lineTo(t+o,a+r),e.arcTo(t,a+r,t,a+r-o,o),e.lineTo(t,a+o),e.arcTo(t,a,t+o,a,o),c&&e.fill(),h&&e.stroke(),e.restore()},this.newcloud=function(e,t,a,i,r,n,o,l,c,h,u){if(0!=i&&0!=r){(i<=0||r<=0)&&(i<0&&(t+=i,i=Math.abs(i)),r<0&&(a+=r,r=Math.abs(r)));var d,p,g=2*n,m=Math.floor(i/g),f=Math.floor(r/g),y=!1,v=1,b=1,x=8,w=i/x,k=r/w;k<6&&(k=6,x=i/(w=r/6));var D=w,C=2*D;if(d=C*(m=Math.floor(i/C)),p=C*(f=Math.floor(r/C)),e.save(),e.strokeStyle=u,e.fillStyle=h,e.lineWidth=o,0!=s.rotation){var P=t+i/2,S=a+r/2;e.translate(P,S),e.rotate(s.rotation),e.translate(-P,-S)}i>d&&(v=i/d,y=!0),r>p&&(b=r/p,y=!0),y&&(e.translate(t,a),e.scale(v,b),e.translate(-t,-a)),e.beginPath(),e.arc(t+D,a+D,D,.5*Math.PI,0,!1);for(var R=2;R<m;R++){var M=t+D+C*(R-1);e.arc(M,a+D,D,Math.PI,0,!1)}for(e.arc(t+d-D,a+D,D,Math.PI,.5*Math.PI,!1),R=2;R<f;R++){var T=a+D+C*(R-1);e.arc(t+d-D,T,D,1.5*Math.PI,.5*Math.PI,!1)}for(e.arc(t+d-D,a+p-D,D,1.5*Math.PI,Math.PI,!1),R=m-1;R>1;R--){var E=t+D+C*(R-1);e.arc(E,a+p-D,D,0,Math.PI,!1)}for(e.arc(t+D,a+p-D,D,0,1.5*Math.PI,!1),R=f-1;R>1;R--){var F=a+D+C*(R-1);e.arc(t+D,F,D,.5*Math.PI,1.5*Math.PI,!1)}l&&e.fill(),c&&e.stroke(),e.restore()}},this.cloudline=function(e,t,a,i,r,s,n,o,l,c,h){var u=2*s,d=Math.floor(i/u),p=Math.floor(r/u),g=u*d;if(e.save(),e.strokeStyle=h,e.fillStyle=c,e.lineWidth=n,e.beginPath(),i<2*u&&r<2*u)e.arc(t+s,a+s,i/2,0,Math.PI,!1);else{if(e.moveTo(t+s,a+u),e.arc(t+s,a+s,s,.5*Math.PI,0,!1),d>2)for(var m=2;m<d;m++){var f=t+s+u*(m-1);e.arc(f,a+s,s,Math.PI,0,!1)}if(e.arc(t+g-s,a+s,s,Math.PI,.5*Math.PI,!1),p>2)for(m=2;m<p;m++){var y=a+s+u*(m-1);e.arc(t+g-s,y,s,1.5*Math.PI,.5*Math.PI,!1)}}e.stroke(),e.restore()},this.cloud=function(e,t,a,i,r,n,o,l,c,h,u){var d=2*n,p=Math.floor(i/d),g=Math.floor(r/d),m=d*p,f=d*g;if(e.save(),e.strokeStyle=u,e.fillStyle=h,e.lineWidth=o,0!=s.rotation){var y=t+i/2,v=a+r/2;e.translate(y,v),e.rotate(s.rotation),e.translate(-y,-v)}if(e.beginPath(),i<2*d&&r<2*d)e.arc(t+n,a+n,i/2,0,2*Math.PI,!1);else{if(e.moveTo(t+n,a+d),e.arc(t+n,a+n,n,.5*Math.PI,0,!1),p>2)for(var b=2;b<p;b++){var x=t+n+d*(b-1);e.arc(x,a+n,n,Math.PI,0,!1)}if(e.arc(t+m-n,a+n,n,Math.PI,.5*Math.PI,!1),g>2)for(b=2;b<g;b++){var w=a+n+d*(b-1);e.arc(t+m-n,w,n,1.5*Math.PI,.5*Math.PI,!1)}if(e.arc(t+m-n,a+f-n,n,1.5*Math.PI,Math.PI,!1),p>2)for(b=p-1;b>1;b--){var k=t+n+d*(b-1);e.arc(k,a+f-n,n,0,Math.PI,!1)}if(e.arc(t+n,a+f-n,n,0,1.5*Math.PI,!1),g>2)for(b=g-1;b>1;b--){var D=a+n+d*(b-1);e.arc(t+n,D,n,.5*Math.PI,1.5*Math.PI,!1)}}l&&e.fill(),c&&e.stroke(),e.restore()},this.markpolygon=function(e,t){var a=0;e.save(),e.fillStyle="rgba(236, 236, 236, 0.5)";var i=0,r=0,n=jn();if(13==s.type)for(a=0,a=0;a<s.countshapes.length;a++){i=(s.countshapes[a].x-this.xoffset)*t,r=(s.countshapes[a].y-this.yoffset)*t,i+=n.x,r+=n.y;var o=s.outerRadius*s.fixedscaleFactor;di&&(o=s.outerRadius),e.beginPath(),e.arc(i,r,o+3,0,2*Math.PI,!1),e.closePath(),e.fill()}e.restore()},this.editpolygonhole=function(e,t,a){var i=0;e.save(),e.strokeStyle="red",e.fillStyle="white",e.lineWidth=1;var r=0,s=0,n=jn();for(i=0;i<a.points.length;i++){r=(a.points[i].x-a.xoffset)*t,s=(a.points[i].y-a.yoffset)*t,r+=n.x,s+=n.y;var o=a.editcurpoint+1>a.points.length-1&&0==i;a.bpointEdit&&(a.editcurpoint==i||a.editcurpoint+1==i||o)?(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(r-5,s-5,10,10),e.strokeRect(r-5,s-5,10,10),e.restore()):(e.fillRect(r-5,s-5,10,10),e.strokeRect(r-5,s-5,10,10))}e.restore()},this.editpolygon=function(e,t){var a=0,i=0;e.save(),e.strokeStyle="red",e.fillStyle="white",e.lineWidth=1;var r=0,n=0,o=jn();for(a=0;a<s.points.length;a++){r=(this.points[a].x-this.xoffset)*t,n=(this.points[a].y-this.yoffset)*t,r+=o.x,n+=o.y;var l=1==this.type&&(1==this.subtype||3==this.subtype),c=(s.points.length,s.editcurpoint+1>s.points.length-1),h=!l&&c&&0==a,u=l&&c;!s.bpointEdit||s.editcurpoint!=a&&s.editcurpoint+1!=a&&!h||u?(e.fillRect(r-5,n-5,10,10),e.strokeRect(r-5,n-5,10,10)):(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(r-5,n-5,10,10),e.strokeRect(r-5,n-5,10,10),e.restore())}if(1==this.type&&6==this.subtype)for(i=0;i<this.pointlist.length;i++)for(a=0;a<this.pointlist[i].length;a++)r=(this.pointlist[i][a].x-this.xoffset)*t,n=(this.pointlist[i][a].y-this.yoffset)*t,r+=o.x,n+=o.y,h=(c=s.editcurpoint+1>this.pointlist[i].length-1)&&0==a,u=c,!s.bpointEdit||s.editcurpoint!=a&&s.editcurpoint+1!=a&&!h||u?(e.fillRect(r-5,n-5,10,10),e.strokeRect(r-5,n-5,10,10)):(e.save(),e.fillStyle="blue",e.lineWidth=2,e.fillRect(r-5,n-5,10,10),e.strokeRect(r-5,n-5,10,10),e.restore());if(13==s.type)for(a=0,a=0;a<s.countshapes.length;a++){r=(s.countshapes[a].x-this.xoffset)*t,n=(s.countshapes[a].y-this.yoffset)*t,r+=o.x,n+=o.y;var d=s.outerRadius*s.fixedscaleFactor;di&&(d=s.outerRadius),e.strokeStyle="blue",e.beginPath(),e.arc(r,n,d+3,0,2*Math.PI,!1),e.closePath(),e.stroke()}e.restore()},this.selectLabel=function(e,t,a,i,r,s,n){e.save(),e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,e.beginPath();var o=t+(i-t)/2,l=a+(r-a)/2;e.arc(o,l,10,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),e.restore()},this.mark=function(e,t,a,i,r,n,o){var l=t+(i-t)/2,c=a+(r-a)/2;e.save(),e.fillStyle=qi,0!=s.rotation&&(e.translate(l,c),e.rotate(s.rotation),e.translate(-l,-c)),e.beginPath(),e.moveTo(t,a),e.lineTo(i,a),e.lineTo(i,r),e.lineTo(t,r),e.closePath(),e.fill(),e.restore()},this.select=function(e,t,a,i,r,n,o){pi&&(o=!pi);var l=Na/2,c=Aa/2,h=Bs.getCurrentpage().drotation*(Math.PI/180),u=(Math.PI,10),d=new Gs,p=new Gs;d.x=t,d.y=a,p.x=i,p.y=r;var g=t+(i-t)/2,m=a+(r-a)/2;if(0!=Bs.getCurrentpage().drotation&&(d=s.getRotatedMarkup(l,c,t,a,h),p=s.getRotatedMarkup(l,c,i,r,h)),e.save(),n){if(0!=s.textrotate&&9==s.type&&0==s.subtype&&(e.translate(t,a),e.rotate(s.textrotate),e.translate(-t,-a)),0!=s.rotation){if(e.translate(g,m),e.rotate(s.rotation),e.translate(-g,-m),9==s.type&&0==s.subtype){m=a-(a-r)/2;var f=(r-a)/2;if(0!=s.textrotate){var y=s.getMarkupSelectPointRot((i-t)/2,-(r-a)/2,s.rotation),v=s.getMarkupSelectPointRot(y.x,y.y,s.textrotate),b=s.getMarkupSelectPointRot((i-t)/2,f,s.textrotate);g=t+b.x,m=a+b.y,this.LowerRightRectRot.x=g+v.x-u,this.LowerRightRectRot.y=m+v.y-u,this.LowerRightRectRot.w=g+v.x+u,this.LowerRightRectRot.h=m+v.y+u}else{var x=s.getMarkupSelectPointRot(-(i-t)/2,- -(r-a)/2,s.rotation);this.UpperLeftRectRot.x=g+x.x-u,this.UpperLeftRectRot.y=m+x.y-u,this.UpperLeftRectRot.w=g+x.x+u,this.UpperLeftRectRot.h=m+x.y+u,y=s.getMarkupSelectPointRot((i-t)/2,-(r-a)/2,s.rotation),this.LowerRightRectRot.x=g+y.x-u,this.LowerRightRectRot.y=m+y.y-u,this.LowerRightRectRot.w=g+y.x+u,this.LowerRightRectRot.h=m+y.y+u}}else{x=s.getMarkupSelectPointRot(-(i-t)/2,-(r-a)/2,s.rotation),this.UpperLeftRectRot.x=g+x.x-u,this.UpperLeftRectRot.y=m+x.y-u,this.UpperLeftRectRot.w=g+x.x+u,this.UpperLeftRectRot.h=m+x.y+u,y=s.getMarkupSelectPointRot((i-t)/2,(r-a)/2,s.rotation),this.LowerRightRectRot.x=g+y.x-u,this.LowerRightRectRot.y=m+y.y-u,this.LowerRightRectRot.w=g+y.x+u,this.LowerRightRectRot.h=m+y.y+u;var w=s.getMarkupSelectPointRot(-(i-t)/2,(r-a)/2,s.rotation);this.LowerLeftRectRot.x=g+w.x-u,this.LowerLeftRectRot.y=m+w.y-u,this.LowerLeftRectRot.w=g+w.x+u,this.LowerLeftRectRot.h=m+w.y+u;var k=s.getMarkupSelectPointRot((i-t)/2,-(r-a)/2,s.rotation);this.UpperRightRectRot.x=g+k.x-u,this.UpperRightRectRot.y=m+k.y-u,this.UpperRightRectRot.w=g+k.x+u,this.UpperRightRectRot.h=m+k.y+u}if(0!=Bs.getCurrentpage().drotation){var D=s.getRotatedMarkup(l,c,this.UpperLeftRectRot.x,this.UpperLeftRectRot.y,h),C=s.getRotatedMarkup(l,c,this.UpperLeftRectRot.w,this.UpperLeftRectRot.h,h);this.UpperLeftRectRot.x=Math.min(D.x,C.x),this.UpperLeftRectRot.y=Math.min(D.y,C.y),this.UpperLeftRectRot.w=Math.max(D.x,C.x),this.UpperLeftRectRot.h=Math.max(D.y,C.y);var P=s.getRotatedMarkup(l,c,this.UpperRightRectRot.x,this.UpperRightRectRot.y,h),S=s.getRotatedMarkup(l,c,this.UpperRightRectRot.w,this.UpperRightRectRot.h,h);this.UpperRightRectRot.x=Math.min(P.x,S.x),this.UpperRightRectRot.y=Math.min(P.y,S.y),this.UpperRightRectRot.w=Math.max(P.x,S.x),this.UpperRightRectRot.h=Math.max(P.y,S.y);var R=s.getRotatedMarkup(l,c,this.LowerLeftRectRot.x,this.LowerLeftRectRot.y,h),M=s.getRotatedMarkup(l,c,this.LowerLeftRectRot.w,this.LowerLeftRectRot.h,h);this.LowerLeftRectRot.x=Math.min(R.x,M.x),this.LowerLeftRectRot.y=Math.min(R.y,M.y),this.LowerLeftRectRot.w=Math.max(R.x,M.x),this.LowerLeftRectRot.h=Math.max(R.y,M.y);var T=s.getRotatedMarkup(l,c,this.LowerRightRectRot.x,this.LowerRightRectRot.y,h),E=s.getRotatedMarkup(l,c,this.LowerRightRectRot.w,this.LowerRightRectRot.h,h);this.LowerRightRectRot.x=Math.min(T.x,E.x),this.LowerRightRectRot.y=Math.min(T.y,E.y),this.LowerRightRectRot.w=Math.max(T.x,E.x),this.LowerRightRectRot.h=Math.max(T.y,E.y)}if(o){if(9==s.type&&0==s.subtype)if(0==s.textrotate)var F=s.getMarkupSelectPointRot(0,- -(f-20),s.rotation);else{F=s.getMarkupSelectPointRot(0,- -(f-20),s.rotation),F=s.getMarkupSelectPointRot(F.x,F.y,s.textrotate);var I=s.getMarkupSelectPointRot((i-t)/2,f,s.textrotate);s.getMarkupSelectPointRot((i-t)/2,f,s.rotation),g=t+I.x,m=a+I.y}else F=s.getMarkupSelectPointRot(0,-((r-a)/2+20),s.rotation);if(this.RotmarkerRectRot.x=g+F.x-u,this.RotmarkerRectRot.y=m+F.y-u,this.RotmarkerRectRot.w=g+F.x+u,this.RotmarkerRectRot.h=m+F.y+u,0!=Bs.getCurrentpage().drotation){var j=s.getRotatedMarkup(l,c,this.RotmarkerRectRot.x,this.RotmarkerRectRot.y,h),O=s.getRotatedMarkup(l,c,this.RotmarkerRectRot.w,this.RotmarkerRectRot.h,h);this.RotmarkerRectRot.x=Math.min(j.x,O.x),this.RotmarkerRectRot.y=Math.min(j.y,O.y),this.RotmarkerRectRot.w=Math.max(j.x,O.x),this.RotmarkerRectRot.h=Math.max(j.y,O.y)}}}if(9==s.type&&0==s.subtype?0==s.textrotate?(this.LowerLeftRect.x=t-u,this.LowerLeftRect.y=a-u,this.LowerLeftRect.w=t+u,this.LowerLeftRect.h=a+u,this.LowerRightRect.x=i-u,this.LowerRightRect.y=a-u,this.LowerRightRect.w=i+u,this.LowerRightRect.h=a+u,this.UpperRightRect.x=i-u,this.UpperRightRect.y=r-u,this.UpperRightRect.w=i+u,this.UpperRightRect.h=r+u,this.UpperLeftRect.x=t-u,this.UpperLeftRect.y=r-u,this.UpperLeftRect.w=t+u,this.UpperLeftRect.h=r+u):(y=s.getMarkupSelectPointRot(i-t,0,s.textrotate),this.LowerRightRect.x=t+y.x-u,this.LowerRightRect.y=a+y.y-u,this.LowerRightRect.w=t+y.x+u,this.LowerRightRect.h=a+y.y+u,0!=Bs.getCurrentpage().drotation&&(this.LowerRightRect.x=this.rotatedrect.w-u,this.LowerRightRect.y=this.rotatedrect.y-u,this.LowerRightRect.w=this.rotatedrect.w+u,this.LowerRightRect.h=this.rotatedrect.y+u)):(this.UpperLeftRect.x=d.x-u,this.UpperLeftRect.y=d.y-u,this.UpperLeftRect.w=d.x+u,this.UpperLeftRect.h=d.y+u,this.LowerLeftRect.x=d.x-u,this.LowerLeftRect.y=p.y-u,this.LowerLeftRect.w=d.x+u,this.LowerLeftRect.h=p.y+u,this.UpperRightRect.x=p.x-u,this.UpperRightRect.y=d.y-u,this.UpperRightRect.w=p.x+u,this.UpperRightRect.h=d.y+u,this.LowerRightRect.x=p.x-u,this.LowerRightRect.y=p.y-u,this.LowerRightRect.w=p.x+u,this.LowerRightRect.h=p.y+u),e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,10!=s.type&&(11!=s.type||3!=s.subtype&&5!=s.subtype?(e.beginPath(),e.arc(t,a,u,0,2*Math.PI,!1),e.moveTo(t+u,r),e.arc(t,r,u,0,2*Math.PI,!1),e.moveTo(i+u,a),e.arc(i,a,u,0,2*Math.PI,!1),e.moveTo(i+u,r),e.arc(i,r,u,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()):(e.lineWidth=3,e.beginPath(),e.moveTo(t-3,a-3),e.lineTo(i+3,a-3),e.lineTo(i+3,r+3),e.lineTo(t-3,r+3),e.closePath(),e.stroke())),e.strokeStyle="red",e.strokeRect((t+i)/2-3,a-3,6,6),e.strokeRect(t-3,(r+a)/2-3,6,6),e.strokeRect(i-3,(r+a)/2-3,6,6),e.strokeRect((i+t)/2-3,r-3,6,6),o&&(9==s.type&&0==s.subtype?(e.beginPath(),e.moveTo((t+i)/2,r-3),e.lineTo((t+i)/2,r-15),e.closePath(),e.stroke(),e.strokeStyle="blue",e.lineWidth=1,e.beginPath(),e.arc((t+i)/2,r-20,u,0,2*Math.PI,!1),e.stroke(),0==s.textrotate?(this.RotmarkerRect.x=(t+i)/2-u,this.RotmarkerRect.y=r-20-u,this.RotmarkerRect.w=(t+i)/2+u,this.RotmarkerRect.h=r-20+u):(F=s.getMarkupSelectPointRot((i-t)/2,-(a-r+20),s.textrotate),this.RotmarkerRect.x=t+F.x-u,this.RotmarkerRect.y=a+F.y-u,this.RotmarkerRect.w=t+F.x+u,this.RotmarkerRect.h=a+F.y+u)):(e.beginPath(),e.moveTo((t+i)/2,a-3),e.lineTo((t+i)/2,a-15),e.closePath(),e.stroke(),e.strokeStyle="blue",e.lineWidth=1,e.beginPath(),e.arc((t+i)/2,a-20,u,0,2*Math.PI,!1),e.fill(),e.stroke(),this.RotmarkerRect.x=(t+i)/2-u,this.RotmarkerRect.y=a-20-u,this.RotmarkerRect.w=(t+i)/2+u,this.RotmarkerRect.h=a-20+u),0!=Bs.getCurrentpage().drotation)){var L=s.getRotatedMarkup(l,c,this.RotmarkerRect.x,this.RotmarkerRect.y,h),V=s.getRotatedMarkup(l,c,this.RotmarkerRect.w,this.RotmarkerRect.h,h);this.RotmarkerRect.x=Math.min(L.x,V.x),this.RotmarkerRect.y=Math.min(L.y,V.y),this.RotmarkerRect.w=Math.max(L.x,V.x),this.RotmarkerRect.h=Math.max(L.y,V.y)}}else e.strokeStyle="blue",e.fillStyle="white",e.lineWidth=1,e.beginPath(),e.arc(t,a,u,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke(),6==this.type&&6==this.subtype||(e.beginPath(),e.arc(i,r,u,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.fill());e.restore()},this.setAnglelengthPoints=function(e,t){var a=s.points.length-2;return s.setAngleLengthinternalPoints(e,t,!0,a)},this.setWidthHeight=function(e,t){var a=e*s.scaling,i=t*s.scaling;return{w:bo(a),h:bo(i)}},this.setWidthHeightEdit=function(e,t){return s.setWidthHeight(e,t)},this.setAnglelengthUnscaled=function(e,t,a,i){return s.setAngleLengthinternalUnscaled(e,t,a,i,!0)},this.setAnglelength=function(e,t,a){return s.setAngleLengthinternal(e,t,a,!0)},this.setAngleLenghtEdit=function(e,t,a){return s.setAngleLengthinternal(e,t,a,!1)},this.setAngleLengthPointsEdit=function(e,t){var a=s.editcurpoint;return s.bpointEdit=!0,s.setAngleLengthinternalPoints(e,t,!1,a)},this.setAngleLengthinternalPoints=function(e,t,a,i){if(i>=0&&i<=this.points.length-1){var r=1==this.type&&(1==this.subtype||3==this.subtype),n=Na/2,o=Aa/2,l=(360-Bs.getCurrentpage().drotation)*(Math.PI/180);Bs.getCurrentpage().drotation,Math.PI,t>0?t*=-1:t=360-t,a||(t+=360-Bs.getCurrentpage().drotation)>360&&(t-=360);var c=bo(e*s.scaling),h=t*(Math.PI/180),u=s.points[0].x,d=s.points[0].y,p=s.points[i].x+c*Math.cos(h),g=s.points[i].y+c*Math.sin(h);if(s.bUsemouseinput=!1,0!=Bs.getCurrentpage().drotation&&a){var m=s.setinitRotatedMarkupPoint(n,o,s.points[i].x,s.points[i].y,l);s.points[i].x=m.x,s.points[i].y=m.y,p=(m=s.setinitRotatedMarkupPoint(n,o,p,g,l)).x,g=m.y}return i==s.points.length-1?(s.editcurpoint=0,r&&(p=u,g=d)):s.editcurpoint=i+1,{w:p,h:g,p:s.editcurpoint}}},this.setAngleLengthinternalUnscaled=function(e,t,a,i,r){Bs.getCurrentpage().drotation,Math.PI,Bs.getCurrentpage().drotation,Math.PI,a>0?a*=-1:a=360-a,r||(a+=360-Bs.getCurrentpage().drotation)>360&&(a-=360);var s=a*(Math.PI/180);return{w:e.x+t*Math.cos(s),h:e.y+t*Math.sin(s)}},this.setAngleLengthinternal=function(e,t,a,i){var r=Na/2,n=Aa/2,o=(360-Bs.getCurrentpage().drotation)*(Math.PI/180);Bs.getCurrentpage().drotation,Math.PI,t>0?t*=-1:t=360-t,i||(t+=360-Bs.getCurrentpage().drotation)>360&&(t-=360);var l=bo(e*s.scaling),c=t*(Math.PI/180),h=this.x+l*Math.cos(c),u=this.y+l*Math.sin(c);if(s.bUsemouseinput=!1,0!=Bs.getCurrentpage().drotation&&i){var d=s.setinitRotatedMarkupPoint(r,n,this.x,this.y,o);this.x=d.x,this.y=d.y,h=(d=s.setinitRotatedMarkupPoint(r,n,h,u,o)).x,u=d.y}return{w:h,h:u}},this.lengthangleCallbackSelect=function(){s.anglelengthsupport&&s.lengthangleCallback(this.x,this.y,this.w,this.h,Bs.getCurrentpage().drotation),s.setRadiusSupport&&s.radiusCallback(this.x,this.y,this.w,this.h,!0),s.setPointSupport&&s.lengthangleCallbackPointSelect(),s.widthHeightsupport&&s.widthHeightCallback(this.w,this.h)},this.lengthangleCallbackPointSelect=function(){if(!(this.points.length<2)){var e=Bs.getCurrentpage().drotation;if(0==s.editcurpoint?s.points.length:s.editcurpoint,s.editcurpoint==s.points.length-1)var t=0;else t=s.editcurpoint+1;var a=this.points[s.editcurpoint].x,i=this.points[s.editcurpoint].y,r=this.points[t].x,n=this.points[t].y,o=s.anglelength(a,i,r,n,!1);o.length=ko(o.length/s.scaling),null!=Ma&&(s.bUsemouseinput||(o.angle-=e),Ma.onDrawEvent(o))}},this.lengthangleCallbackPoints=function(e){if(!(this.points.length<2)){var t=this.points[this.points.length-2].x,a=this.points[this.points.length-2].y,i=this.points[this.points.length-1].x,r=this.points[this.points.length-1].y,n=s.anglelength(t,a,i,r,!1);n.length=ko(n.length/s.scaling),null!=Ma&&(s.bUsemouseinput||(n.angle-=e),Ma.onDrawEvent(n))}},this.widthHeightCallback=function(e,t){var a={width:e,height:t};a.width=ko(e/s.scaling),a.height=ko(t/s.scaling),null!=Ma&&Ma.onDrawEvent(a)},this.lengthangleCallback=function(e,t,a,i,r){var n=s.anglelength(e,t,a,i,!1);n.length=ko(n.length/s.scaling),null!=Ma&&(s.bUsemouseinput||(n.angle-=r),Ma.onDrawEvent(n))},this.radiusCallback=function(e,t,a,i,r){var n=s.anglelength(e,t,a,i,r);n.length=ko(n.length/s.scaling),null!=Ma&&Ma.onDrawEvent(n)},this.anglelength=function(e,t,a,i,r){var s=0,n=0;s=Math.abs(a-e),n=Math.abs(i-t);var o=Math.pow(s,2),l=Math.pow(n,2),c=Math.sqrt(o+l);r?(s=Math.abs(a-e),n=Math.abs(i-t)):(s=a-e,n=i-t);var h=Math.atan2(n,s)*(180/Math.PI);return h<0?h*=-1:h=360-h,{length:c,angle:h}},this.drawme=function(e){var t=Ln();switch(b=!0,s.fixedscaleFactor=t/Bs.getCurrentpage().fixedScale,ui?(this.linewidth,s.fixedscaleFactor):this.linewidth,ui?(this.arrowlength,s.fixedscaleFactor):this.arrowlength,di&&(this.linewidth,this.arrowlength),this.type){case 0:this.drawmescaled(e);break;case 1:var a=s.setDimDrawme();if(this.setlastpoint(a.w,a.h),s.bUsemouseinput&&this.AdjustForRotation(!1),xr){var i=s.getlastpoint(),r=s.getprevpoint();if(i&&r){var n=s.calculateOrthoDraw({x:r.x,y:r.y},{x:i.x,y:i.y});s.setlastpoint(n.w,n.h)}}s.lengthangleCallbackPoints(Bs.getCurrentpage().drotation),this.drawmescaled(e);break;case 2:switch(this.subtype){case 1:s.polycurves(e,s.linewidth,s.color,1)}break;case 3:a=s.setDimDrawme(),6==this.subtype&&(this.w=a.w,this.h=a.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),s.widthHeightCallback(this.w,this.h),this.drawmescaled(e);break;case 4:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),1==this.subtype&&s.radiusCallback(this.x,this.y,this.w,this.h,!0),this.drawmescaled(e);break;case 5:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),this.drawmescaled(e);break;case 6:a=s.setDimDrawme(),this.w=a.w,this.h=a.h,s.bUsemouseinput&&this.AdjustForRotation(!1),xr&&(i=s.calculateOrthoDraw({x:this.x,y:this.y},{x:this.w,y:this.h}),this.w=i.w,this.h=i.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,s.lengthangleCallback(this.x,this.y,this.w,this.h,Bs.getCurrentpage().drotation),this.setTextboxConnectionPointDraw(),this.drawmescaled(e);break;case 7:a=s.setDimDrawme(),this.w=a.w,this.h=a.h,s.bUsemouseinput&&this.AdjustForRotation(!1),xr&&(i=s.calculateOrthoDraw({x:this.x,y:this.y},{x:this.w,y:this.h}),this.w=i.w,this.h=i.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,s.lengthangleCallback(this.x,this.y,this.w,this.h,Bs.getCurrentpage().drotation),this.drawmescaled(e);break;case 8:a=s.setDimDrawme(),this.setlastpoint(a.w,a.h),s.bUsemouseinput&&this.AdjustForRotation(!1),xr&&(i=s.getlastpoint(),r=s.getprevpoint(),i&&r&&(n=s.calculateOrthoDraw({x:r.x,y:r.y},{x:i.x,y:i.y}),s.setlastpoint(n.w,n.h))),s.lengthangleCallbackPoints(Bs.getCurrentpage().drotation),this.drawmescaled(e);break;case 9:e.font=this.font.fontstring;var o=e.measureText(this.text);this.textwidth=o.width,this.w=this.textwidth,this.h=this.textheight,e.textAlign="start",e.fillStyle=s.fillcolor,1==this.subtype||2==this.subtype?(s.Rect(e,this.x,this.y,this.w,this.h,this.linewidth,!0,!0,s.fillcolor,s.strokecolor),e.fillText(this.text,this.x+10,this.y+this.h+10)):(e.fillText(this.text,this.x,this.y),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h);break;case 10:this.w=Ns.width,this.h=Ns.height,ui?e.drawImage(Ns,this.x,this.y,this.w*s.fixedscaleFactor,this.h*s.fixedscaleFactor):e.drawImage(Ns,this.x,this.y,this.w,this.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h;break;case 11:this.w=this.image.width,this.h=this.image.height,s.imageloaded&&e.drawImage(this.image,this.x,this.y,this.w,this.h),this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h;break;case 12:this.xscaled=this.x,this.yscaled=this.y,this.wscaled=this.w,this.hscaled=this.h,this.AdjustForRotation(!1),this.drawmescaled(e);break;case 13:this.AdjustForRotation(!1),this.drawmescaled(e)}},this.isdrawn=function(){return b},this.offscreendrawdim=function(e){if(!b){v=Vn(e),v=!1;var t=function(e){if(null==e)return 1;var t=e.dscale;return e.usevectorxml?t=e.dscalevector:e.usepdfjs?t=e.curpagescale*e.dscalepdf:(t=e.dscale,0==Bs.Type&&(t=e.dscale)),e.usevector3Dxml&&(t=1),t}(e),a=function(e){return e.fixedScale}(e);s.setFirstdrawDim(t,a,v),b=!0}},this.drawmescaled=function(e){var t;t=!1,jh()||(t=!Bs.getCurrentpage().usevectorxml&&!Bs.getCurrentpage().usepdfjs,Bs.getCurrentpage().usevector3Dxml&&(t=!0)),v=t,v=!1;var a,i=On(s.pagenumber),r=Ln(s.pagenumber),n=(a=!0,Bs.getCurrentpage().usevectorxml&&(a=Bs.getCurrentpage().vectorloaded),a),o=Bs.getpage(s.pagenumber).drotation;if(!b&&n){if(s.pagenumber!=Bs.currentpage)return;s.setFirstdrawDim(r,i,v),b=!0}s.fixedscaleFactor=r/i,r/=s.scaling;var l,c,h=jn(s.pagenumber);l=h.x,c=h.y,s.bfor3D&&(r=Aa/this.pageheight);var u=0,d=0;if(ui)var p=this.arrowlength*s.fixedscaleFactor;else p=this.arrowlength*r;if(ui)var g=10*s.fixedscaleFactor;else g=10*r;if(this.h,ui)var m=this.linewidth*s.fixedscaleFactor,f=5*s.fixedscaleFactor;else m=this.linewidth*r,f=5*r;var y=this.leaderoffset*r,x=0,w=0;di&&(p=this.arrowlength,m=this.linewidth,g=10);var k=null;if(null!=s.hatchStyle&&(no(s.hatchStyle,this.color),k=io(e,so(s.hatchStyle))),0!=o){var C=Na/2,P=Aa/2;e.save(),e.translate(C,P),e.rotate(o*(Math.PI/180)),e.translate(-C,-P)}switch(this.type){case 0:m=ui?this.linewidth*s.fixedscaleFactor:this.linewidth*r;var S=0,R=0;if(s.SetDimensions(r,o,l,c),e.save(),1==this.subtype?(null!=Bs.backgroundColor?e.strokeStyle=Bs.backgroundColor:e.strokeStyle="white",e.lineWidth=10*m):(e.strokeStyle=this.strokecolor,e.lineWidth=m,s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor)),e.beginPath(),this.points.length>0)for(S=0;S<this.points.length;S++)u=(this.points[S].x-this.xoffset)*r,d=(this.points[S].y-this.yoffset)*r,u+=l,d+=c,0==S?e.moveTo(u,d):e.lineTo(u,d);for(R=0;R<this.pointlist.length;R++)for(S=0;S<this.pointlist[R].length;S++)u=(this.pointlist[R][S].x-this.xoffset)*r,d=(this.pointlist[R][S].y-this.yoffset)*r,u+=l,d+=c,0==S?e.moveTo(u,d):e.lineTo(u,d);e.stroke(),e.restore(),s.selected&&s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);break;case 1:switch(s.SetDimensions(r,o,l,c),this.subtype){case 1:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polyline(e,s.linewidth,s.strokecolor,r,l,c,!0),e.restore();break;case 2:0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!1,!0,s.fillcolor,s.strokecolor,r,l,c,!0),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!0,!0,s.fillcolor,s.strokecolor,r,l,c,!0),e.restore()),2==this.alternative&&s.polygon(e,s.linewidth,!0,!0,"white",s.color,r,l,c,!0),this.alternative>=3&&(null!=k?s.polygon(e,s.linewidth,!0,!0,k,s.color,r,l,c,!0):s.polygon(e,s.linewidth,!0,!0,"white",s.color,r,l,c,!0));break;case 3:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polyline(e,s.linewidth,s.strokecolor,r,l,c,!0),e.restore(),s.dimtext=s.setdimvaluepoly(),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),Es||s.hidevaluelabel||(ui?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r,!1));break;case 4:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.dimtext=s.drawangle(e,s.linewidth,s.strokecolor,r,l,c,!0,!1),e.restore(),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),Es||s.hidevaluelabel||(ui?""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r,!1));break;case 5:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.dimtext=s.drawangle(e,s.linewidth,s.strokecolor,r,l,c,!0,!0),e.restore(),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),Es||s.hidevaluelabel||(ui?""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r,!1));break;case 6:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polylineSegments(e,s.linewidth,s.strokecolor,r,l,c,!0),s.polylineSegments(e,s.linewidthSegment,s.strokecolorSegment,r,l,c,!0),e.restore(),s.dimtext=s.setdimvaluepolySegments(),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),!Es&&s.hidevaluelabel;break;case 7:e.save(),s.polygoncloud(e,g,s.linewidth,!1,!0,s.fillcolor,s.strokecolor,r,l,c,!0,!0),e.restore()}s.selected&&s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),s.selectedit&&s.editpolygon(e,r),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);break;case 2:switch(s.SetDimensions(r,o,l,c),this.subtype){case 1:s.polycurves(e,s.linewidth,s.color,r)}s.selected&&s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),s.selectedit&&s.editpolygon(e,r);break;case 3:if(s.SetDimensions(r,o,l,c),6==this.subtype&&(s.dimtext=s.setdimvaluearea()),2==this.subtype){if(null!=Bs.backgroundColor)var M=Bs.backgroundColor;else M="white";s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,M,M)}if(4==this.subtype&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,1,!0,!0,s.fillcolor,s.fillcolor),this.subtype,3==this.subtype&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,s.fillcolor,s.fillcolor),1==this.subtype&&(0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,m,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,m,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=k?s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,m,!0,!0,k,this.color):s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,m,!0,!0,"white",this.color))),0==this.subtype&&(0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=k?s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,k,this.color):s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color))),6==this.subtype){var T=1==s.alternative;s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,T,!0,s.fillcolor,s.strokecolor),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),Es||s.hidevaluelabel||(ui?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r,!1))}s.selected&&5!=s.subtype&&(6==s.subtype?s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1):s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 4:s.SetDimensions(r,o,l,c),0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),1==this.subtype?(s.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,s.fillcolor,s.strokecolor),s.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,s.strokecolor,!1)):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),1==this.subtype?(s.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,s.fillcolor,s.strokecolor),s.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,f,m,s.strokecolor,!1)):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=k?s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,k,this.color):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,"white",this.color)),s.selected&&(1==this.subtype?s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1):s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 5:s.SetDimensions(r,o,l,c),0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,m,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,m,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,m,!0,!0,"white",this.color),this.alternative>=3&&(null!=k?s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,m,!0,!0,k,this.color):s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,m,!0,!0,"white",this.color)),s.selected&&s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 6:s.SetDimensions(r,o,l,c),e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.arrow(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,D,m,this.subtype,s.strokecolor,s.strokecolor),e.restore(),s.selected&&s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1);break;case 7:s.SetDimensions(r,o,l,c);var E=this.subtype+4;s.setdimvalue(this.x,this.y,this.w,this.h),e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),this.labelpos=s.dimensionLeader(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,y,p,D,m,E,s.strokecolor,s.strokecolor),e.restore(),s.selected&&(s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1),0==this.leaderoffset?s.selectLabel(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1):s.selectLabel(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,!1,!1)),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!1,!1),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),ui?0==this.leaderoffset?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!0):s.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,s.fixedscaleFactor,!0):0==this.leaderoffset?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,r,!0):s.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,r,!0);break;case 8:if(0==s.points.length)break;if(s.SetDimensions(r,o,l,c),ui)var F=s.fixedscaleFactor;else F=r;if(s.bshowperimeter?s.dimtext=s.setdimvalueperimeter():(s.dimtext=s.setdimvaluearea(),1==s.subtype&&s.updateAttribute("Rx_Area",this.dimtext)),s.spaceselected||1!=s.subtype||(s.linestyle=0),s.spaceselected&&1==s.subtype){e.save();var I=e.createLinearGradient(this.xscaled,this.yscaled,this.wscaled,this.hscaled);I.addColorStop(0,s.selectSpaceColor),I.addColorStop(.5,s.selectSpaceStopColor),I.addColorStop(1,s.selectSpaceColor),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!0,!0,I,s.strokecolor,r,l,c,!0),e.restore()}else 2==s.subtype&&s.saved||(0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!1,!0,s.fillcolor,s.strokecolor,r,l,c,!0),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!0,!0,s.fillcolor,s.strokecolor,r,l,c,!0),e.restore()),2==this.alternative&&s.polygon(e,s.linewidth,!0,!0,"white",s.color,r,l,c,!0),this.alternative>=3&&(null!=k?s.polygon(e,s.linewidth,!0,!0,k,s.color,r,l,c,!0):s.polygon(e,s.linewidth,!0,!0,"white",s.color,r,l,c,!0)));if(s.selected&&s.select(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1),s.selectedit&&s.editpolygon(e,r),s.holes.length>0)for(var j=0;j<s.holes.length;j++)s.holes[j].selectedit&&(r=r*s.scaling/s.holes[j].scaling,s.holes[j].editpolygon(e,r));s.marked&&s.mark(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,!0,!1);var O=Hn(this.points);1==s.subtype&&s.updateAttribute("Rx_Area",this.dimtext);var L=O.x,V=O.y,N=(L-this.xoffset)*r,A=(V-this.yoffset)*r,B=jn(),U=(N+=B.x,A+=B.y,this.measuretextheight*r);ui&&(U=this.measuretextheight*s.fixedscaleFactor),di&&(U=1*this.measuretextheight),s.saved||(null!=qt&&qt.setdimtext(s.dimtext),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),Es||!s.busecustomlabel||s.hidevaluelabel||2==s.subtype||s.areavaluedraw(e,s.customlabeltext,N,A,s.strokecolor,U,F,r),Es||s.busecustomlabel||1==s.subtype||s.hidevaluelabel||2==s.subtype||s.areavaluedraw(e,s.dimtext,N,A,s.strokecolor,U,F,r);break;case 9:if(s.SetDimensions(r,o,l,c),s.selectedit)break;if(ui){var G=s.fixedscaleFactor;G*=Xr}else G=r;this.font.setScale(G);var H=this.font.height*G;e.font=this.font.fontstringScaled;var z=e.measureText(this.text);if(this.textwidth=z.width,e.save(),x=this.xscaled,w=this.yscaled,0!=s.textrotate&&0==s.subtype&&(e.translate(x,w),e.rotate(s.textrotate),e.translate(-x,-w)),0!=s.rotation&&(x=this.xscaled+this.wscaled/2,w=0==s.subtype?this.yscaled-this.hscaled/2:this.yscaled+this.hscaled/2,e.translate(x,w),e.rotate(s.rotation),e.translate(-x,-w)),e.textAlign="start",e.fillStyle=s.textcolor,1==this.subtype||2==this.subtype){var W=4*G,_=this.font.height*Yr*G,X=this.font.height/10*2*G;0==s.linewidth?s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!1,s.fillcolor,s.strokecolor):(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,!0,!0,s.fillcolor,s.strokecolor),e.restore()),e.save(),e.beginPath(),e.rect(this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.clip(),this.text.split("\n");var Y=this.yscaled+H+X,q=this.xscaled,Z=this.yscaled;switch(s.textrotate,Math.PI,s.pagerotation){case 0:var J=this.xscaled+W,K=this.wscaled;break;case 90:J=this.xscaled+W-this.hscaled,e.translate(q,Z),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-q,-Z),K=this.hscaled;break;case 270:J=this.xscaled+W,Y=this.yscaled+H+X-this.wscaled,e.translate(q,Z),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-q,-Z),K=this.hscaled;break;case 180:J=this.xscaled+W,q=this.xscaled+this.wscaled/2,Z=this.yscaled+this.hscaled/2,e.translate(q,Z),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-q,-Z),K=this.wscaled}K-=5,xn(e,this.text,J,Y,K,H+_),s.textdim=function(e,t,a,i,r,s){var n,o,l="",c=0,h=0,u=t.split("\n"),d=[],p=[],g=[];r-=e.measureText(" ").width;for(var m=0;m<u.length;m++){var f;l="",c=0,n=0,(f=e.measureText(u[m])).width>r?(d=d.concat(u[m].split(" "))).push("\n"):(d.push(u[m]),d.push("\n"),f.width>h&&(h=f.width))}for(n=0;n<d.length;n++)if("\n"!=d[n])for(var y=bn(e,d[n],r,p);y.bNeedSplit;)y=bn(e,y.remainer,r,p);else p.push(d[n]);for(n=0;n<p.length;n++)"\n"!=p[n]?(o=l+p[n]+" ",(f=e.measureText(o)).width>r&&n>0?(""!=l&&g.push(l),l=p[n]+" ",f.width>h&&(h=f.width)):l=o):(""!=l&&g.push(l),f.width>h&&(h=f.width),l="");for(n=0;n<g.length;n++)"\n"!=g[n]&&c++;return{width:h,height:(c+1)*s}}(e,this.text,0,0,K,H+_),e.restore()}else e.fillText(this.text,this.xscaled,this.yscaled);e.restore(),s.selected&&(1==this.subtype||2==this.subtype?this.bhasArrow?s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1):s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0):s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled-this.hscaled,!0,!0)),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);break;case 10:s.SetDimensions(r,o,l,c),e.save(),s.rotatecnvs(e,s.xscaled,s.yscaled,s.wscaled,s.hscaled,s.rotation),di?e.drawImage(Ns,this.xscaled,this.yscaled,this.w,this.h):e.drawImage(Ns,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore(),s.selected&&(di?s.select(e,this.xscaled,this.yscaled,this.xscaled+this.w,this.yscaled+this.h,!0,!1):s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1)),s.marked&&(di?s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.w,this.yscaled+this.h,!0,!1):s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1));break;case 11:if(!s.imageloaded)break;s.SetDimensions(r,o,l,c),1==this.subtype?(e.save(),s.rotatecnvs(e,s.xscaled,s.yscaled,s.wscaled,s.hscaled,s.rotation),s.imageloaded&&e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore()):2==this.subtype||(3==this.subtype||5==this.subtype||4==this.subtype||12==this.subtype||20==this.subtype)&&(e.save(),s.rotatecnvs(e,s.xscaled,s.yscaled,s.wscaled,s.hscaled,s.rotation),s.imageloaded&&e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore()),1==this.subtype?(s.selected&&s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)):2==this.subtype||(3==this.subtype||5==this.subtype?(s.selected&&s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!1)):4==this.subtype||(12==this.subtype||20==this.subtype)&&(s.selected&&s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0)));break;case 12:s.SetDimensions(r,o,l,c);var Q=this.font.height*r;this.font.setScale(r);var $=s.stampsmalltheight*r;ui?s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,3*s.fixedscaleFactor,!0,!0,s.fillcolor,s.strokecolor):s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,g,3*r,!0,!0,s.fillcolor,s.strokecolor),s.selected&&s.select(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0),s.marked&&s.mark(e,this.xscaled,this.yscaled,this.xscaled+this.wscaled,this.yscaled+this.hscaled,!0,!0);var ee=Pn(s.signature),te=s.GetDateTime(!1);this.smalltext="By "+ee+", ",this.smalltext+=te,e.save(),0!=s.rotation&&(x=this.xscaled+this.wscaled/2,w=this.yscaled+this.hscaled/2,e.translate(x,w),e.rotate(s.rotation),e.translate(-x,-w)),e.fillStyle=s.strokecolor,e.font=this.font.fontstringScaled;var ae=e.measureText(this.text);this.textwidth=ae.width,x=this.xscaled+this.wscaled/2,0==this.alternative?w=this.yscaled+(this.hscaled/4+Q/2):(w=this.yscaled+this.hscaled/2,w+=Q/4),0!=s.textrotate&&(w=this.yscaled+this.hscaled/2,e.translate(x,w),e.rotate(s.textrotate),e.translate(-x,-w),x=this.xscaled+this.wscaled/2,0==this.alternative?w=this.yscaled+(this.hscaled/4+Q/2):(w=this.yscaled+this.hscaled/2,w+=Q/4)),e.textAlign="center",e.fillText(this.text,x,w),0==this.alternative&&(e.fillStyle=this.color,e.font="bold "+$+"pt Times New Roman",w=this.yscaled+this.hscaled/4*3,e.fillText(this.smalltext,x,w)),e.restore();break;case 13:s.SetDimensions(r,o,l,c),s.shapes(e,s.subtype,s.outerRadius,s.innerRadius,s.linewidth,s.fillcolor,s.strokecolor,r,l,c),s.saved||(null!=qt&&qt.setdimtext(s.getcount()),null!=Ia&&Ia.setMarkupMeasureRealTimeData(s)),s.selectedit&&s.editpolygon(e,r),s.marked&&s.markpolygon(e,r)}0!=o&&e.restore()},this.rotatecnvs=function(e,t,a,i,r,n){var o,l;0!=n&&(o=t+i/2,l=a+r/2,e.translate(o,l),e.rotate(s.rotation),e.translate(-o,-l))},this.drawbirdseye=function(e){if(null!=e.birdseyemarkupctx&&null!=e.birdseyeobj.birdseye&&!s.bfor3D){var t=0,a=0;if(0!=e.birdseyeobj.rotation){var i=e.birdseyeobj.birdseye.width/2,r=e.birdseyeobj.birdseye.height/2;90==e.birdseyeobj.rotation?(t=i-r,a=i-r):270==e.birdseyeobj.rotation&&(t=r-i,a=r-i),e.birdseyemarkupctx.save(),e.birdseyemarkupctx.translate(i,r),e.birdseyemarkupctx.rotate(e.birdseyeobj.rotation*(Math.PI/180)),e.birdseyemarkupctx.translate(-i,-r)}this.drawprint(e.birdseyemarkupctx,t,a,e.birdseyeobj.dscalebirdseye,e.birdseyeobj.rotation,!0),0!=e.birdseyeobj.rotation&&e.birdseyemarkupctx.restore()}},this.drawfloorplan=function(e,t,a,i){this.drawprint(e,a,i,t,0,!1)},this.drawWidthHeight=function(e,t,a){if(s.bfor3D){var i=a/s.pageheight;s.pagewidth}var r=.5*t,n=.5*a;9==this.type&&this.selectedit||this.drawprint(e,r,n,i,0,!0)},this.drawthumb=function(e){Bs.getCurrentThumb()&&this.drawprint(e,Bs.getCurrentThumb().dxthumb,Bs.getCurrentThumb().dythumb,Bs.getCurrentThumb().dscalethumb,0,!0)},this.drawprint=function(e,t,a,i,r,n){s.fixedscaleFactor=i/Bs.getCurrentpage().fixedScale;var o=i/s.scaling,l=t,c=a,h=0,u=0;if(ui&&!n)var d=this.arrowlength*s.fixedscaleFactor;else d=this.arrowlength*o;if(ui&&!n)var p=10*s.fixedscaleFactor;else p=10*o;if(this.h,ui&&!n)var g=this.linewidth*s.fixedscaleFactor;else g=this.linewidth*o;var m=this.leaderoffset*o,f=0,y=0,v=null;if(null!=s.hatchStyle&&(no(s.hatchStyle,this.color),v=io(e,so(s.hatchStyle))),ui&&!n){g=this.linewidth*s.fixedscaleFactor;var b=5*s.fixedscaleFactor}else g=this.linewidth*o,b=5*o;switch(this.type){case 0:var x=0,w=0;for(s.SetDimensions(o,r,l,c),e.save(),1==this.subtype?(e.strokeStyle="white",e.lineWidth=10*this.linewidth*o):(e.strokeStyle=this.strokecolor,e.lineWidth=this.linewidth*o,s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor)),e.beginPath(),w=0;w<this.pointlist.length;w++)for(x=0;x<this.pointlist[w].length;x++)h=(this.pointlist[w][x].x-this.xoffset)*o,u=(this.pointlist[w][x].y-this.yoffset)*o,h+=t,u+=a,0==x?e.moveTo(h,u):e.lineTo(h,u);e.stroke(),e.restore();break;case 1:switch(s.SetDimensions(o,r,l,c),this.subtype){case 1:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polyline(e,s.linewidth,s.strokecolor,o,t,a,!0),e.restore();break;case 2:0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!1,!0,s.fillcolor,s.strokecolor,o,t,a,!0),e.restore()),1==this.alternative&&s.polygon(e,s.linewidth,!0,!0,s.fillcolor,s.strokecolor,o,t,a,!0),2==this.alternative&&s.polygon(e,s.linewidth,!0,!0,"white",s.color,o,t,a,!0),this.alternative>=3&&(null!=v?s.polygon(e,s.linewidth,!0,!0,v,s.color,o,t,a,!0):s.polygon(e,s.linewidth,!0,!0,"white",s.color,o,t,a,!0));break;case 3:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polyline(e,s.linewidth,s.strokecolor,o,t,a,!0),e.restore(),s.dimtext=s.setdimvaluepoly(),ui&&!n?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1);break;case 4:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.dimtext=s.drawangle(e,s.linewidth,s.strokecolor,o,l,c,!0,!1),e.restore(),Es||s.hidevaluelabel||(ui?""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1));break;case 5:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.dimtext=s.drawangle(e,s.linewidth,s.strokecolor,o,l,c,!0,!0),e.restore(),Es||s.hidevaluelabel||(ui?""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):""!=s.dimtext&&s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1));break;case 6:e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polylineSegments(e,s.linewidth,s.strokecolor,o,l,c,!0),s.polylineSegments(e,s.linewidthSegment,s.strokecolorSegment,o,l,c,!0),e.restore(),s.dimtext=s.setdimvaluepolySegments(),!Es&&s.hidevaluelabel}break;case 2:switch(s.SetDimensions(o,r,l,c),this.subtype){case 1:s.polycurves(e,s.linewidth,s.color,o)}break;case 3:if(s.SetDimensions(o,r,l,c),2==this.subtype){if(null!=Bs.backgroundColor)var k=Bs.backgroundColor;else k="white";s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,k,k)}4==this.subtype&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,s.fillcolor,s.fillcolor),3==this.subtype&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,s.fillcolor,s.fillcolor),1==this.subtype&&(0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,g,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,g,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,g,!0,!0,v,this.color):s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,g,!0,!0,"white",this.color))),0==this.subtype&&(0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,v,this.color):s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color))),6==this.subtype&&(s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,s.fillcolor,s.strokecolor),s.dimtext=s.setdimvaluearea(),Es||s.hidevaluelabel||(ui?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!1):s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!1)));break;case 4:s.SetDimensions(o,r,l,c),0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),1==this.subtype?(s.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,s.fillcolor,s.strokecolor),s.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,b,g,s.strokecolor,!1)):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),1==this.subtype?(s.Circle(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,s.fillcolor,s.strokecolor),s.drawradius(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,b,g,s.strokecolor,!1)):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,v,this.color):s.Oval(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,"white",this.color));break;case 5:s.SetDimensions(o,r,l,c),0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,g,!1,!0,s.fillcolor,s.strokecolor),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,g,!0,!0,s.fillcolor,s.strokecolor),e.restore()),2==this.alternative&&s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,g,!0,!0,"white",this.color),this.alternative>=3&&(null!=v?s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,g,!0,!0,v,this.color):s.newcloud(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,p,g,!0,!0,"white",this.color));break;case 6:s.SetDimensions(o,r,l,c),e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.arrow(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,d,D,g,this.subtype,s.strokecolor,s.strokecolor),e.restore();break;case 7:s.SetDimensions(o,r,l,c);var C=this.subtype+4;e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.labelpos=s.dimensionLeader(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,m,d,D,g,C,s.strokecolor,s.strokecolor),e.restore(),s.setdimvalue(this.x,this.y,this.w,this.h),ui&&!n?0==this.leaderoffset?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,s.fixedscaleFactor,!0):s.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,s.fixedscaleFactor,!0):0==this.leaderoffset?s.dimvaluedraw(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,this.strokecolor,o,!0):s.dimvaluedraw(e,this.labelpos.x,this.labelpos.y,this.labelpos.w,this.labelpos.h,this.strokecolor,o,!0);break;case 8:if(s.SetDimensions(o,r,l,c),ui&&!n)var P=s.fixedscaleFactor;else P=o;if(s.spaceselected||1!=s.subtype||(s.linestyle=0),s.spaceselected&&1==s.subtype){e.save();var S=e.createLinearGradient(this.xscaled,this.yscaled,this.wscaled,this.hscaled);S.addColorStop(0,s.selectSpaceColor),S.addColorStop(.5,s.selectSpaceStopColor),S.addColorStop(1,s.selectSpaceColor),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!0,!0,S,s.strokecolor,o,l,c,!0),e.restore()}0==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!1,!0,s.fillcolor,s.strokecolor,o,l,c,!0),e.restore()),1==this.alternative&&(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.polygon(e,s.linewidth,!0,!0,s.fillcolor,s.strokecolor,o,l,c,!0),e.restore()),2==this.alternative&&s.polygon(e,s.linewidth,!0,!0,"white",s.color,o,l,c,!0),this.alternative>=3&&(null!=v?s.polygon(e,s.linewidth,!0,!0,v,s.color,o,l,c,!0):s.polygon(e,s.linewidth,!0,!0,"white",s.color,o,l,c,!0)),s.bshowperimeter?s.dimtext=s.setdimvalueperimeter():(s.dimtext=s.setdimvaluearea(),1==s.subtype&&s.updateAttribute("Rx_Area",this.dimtext));var R=Hn(this.points),M=R.x,T=R.y,E=(M-this.xoffset)*o,F=(T-this.yoffset)*o;E+=t,F+=a;var I=this.measuretextheight*o;ui&&!n&&(I=this.measuretextheight*s.fixedscaleFactor),!Es&&s.busecustomlabel&&s.areavaluedraw(e,s.customlabeltext,E,F,s.strokecolor,I,P,o),Es||1==s.subtype||s.areavaluedraw(e,s.dimtext,E,F,s.strokecolor,I,P,o);break;case 9:if(s.SetDimensions(o,r,l,c),s.selectedit)break;if(ui&&!n)var j=s.fixedscaleFactor;else j=o;this.font.setScale(j);var O=this.font.height*j;e.font=this.font.fontstringScaled;var L=e.measureText(this.text);if(this.textwidth=L.width,e.save(),f=this.xscaled,y=this.yscaled,0!=s.textrotate&&0==s.subtype&&(e.translate(f,y),e.rotate(s.textrotate),e.translate(-f,-y)),0!=s.rotation&&(f=this.xscaled+this.wscaled/2,y=0==s.subtype?this.yscaled-this.hscaled/2:this.yscaled+this.hscaled/2,e.translate(f,y),e.rotate(s.rotation),e.translate(-f,-y)),e.textAlign="start",e.fillStyle=s.textcolor,1==this.subtype||2==this.subtype){var V=4*j,N=this.font.height*Yr*j,A=this.font.height/10*2*j;0==s.linewidth?s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!1,s.fillcolor,s.strokecolor):(e.save(),s.GetLinestyle(s.linestyle,e,s.fixedscaleFactor),s.Rect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,g,!0,!0,s.fillcolor,s.strokecolor),e.restore()),e.save(),e.beginPath(),e.rect(this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.clip(),this.text.split("\n");var B=this.yscaled+O+A,U=this.xscaled,G=this.yscaled;switch(s.textrotate,Math.PI,s.pagerotation){case 0:var H=this.xscaled+V,z=this.wscaled;break;case 90:H=this.xscaled+V-this.hscaled,e.translate(U,G),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-U,-G),z=this.hscaled;break;case 270:H=this.xscaled+V,B=this.yscaled+O+A-this.wscaled,e.translate(U,G),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-U,-G),z=this.hscaled;break;case 180:H=this.xscaled+V,U=this.xscaled+this.wscaled/2,G=this.yscaled+this.hscaled/2,e.translate(U,G),e.rotate(-s.pagerotation*(Math.PI/180)),e.translate(-U,-G),z=this.wscaled}xn(e,this.text,H,B,z,O+N),e.restore()}else e.fillText(this.text,this.xscaled,this.yscaled);e.restore();break;case 10:s.SetDimensions(o,r,l,c),e.save(),s.rotatecnvs(e,s.xscaled,s.yscaled,s.wscaled,s.hscaled,s.rotation),e.drawImage(Ns,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore();break;case 11:if(!s.imageloaded)break;s.SetDimensions(o,r,l,c),e.save(),s.rotatecnvs(e,s.xscaled,s.yscaled,s.wscaled,s.hscaled,s.rotation),e.drawImage(this.image,this.xscaled,this.yscaled,this.wscaled,this.hscaled),e.restore();break;case 12:s.SetDimensions(o,r,l,c);var W=this.font.height*o;this.font.setScale(o);var _=s.stampsmalltheight*o;ui&&!n?s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,3*s.fixedscaleFactor,!0,!0,s.fillcolor,s.strokecolor):s.roundedRect(e,this.xscaled,this.yscaled,this.wscaled,this.hscaled,s.rotation,p,3*o,!0,!0,s.fillcolor,s.strokecolor);var X=Pn(s.signature),Y=s.GetDateTime(!1);this.smalltext="By "+X+", ",this.smalltext+=Y,e.save(),0!=s.rotation&&(f=this.xscaled+this.wscaled/2,y=this.yscaled+this.hscaled/2,e.translate(f,y),e.rotate(s.rotation),e.translate(-f,-y)),e.fillStyle=s.strokecolor,e.font=s.font.fontstringScaled;var q=e.measureText(this.text);this.textwidth=q.width,f=this.xscaled+this.wscaled/2,0==this.alternative?y=this.yscaled+(this.hscaled/4+W/2):(y=this.yscaled+this.hscaled/2,y+=W/4),0!=s.textrotate&&(e.translate(f,y),e.rotate(s.textrotate),e.translate(-f,-y),f=this.xscaled+this.wscaled/2,0==this.alternative?y=this.yscaled+(this.hscaled/4+W/2):(y=this.yscaled+this.hscaled/2,y+=W/4)),e.textAlign="center",e.fillText(this.text,f,y),0==this.alternative&&(e.fillStyle=this.color,e.font="bold "+_+"pt Times New Roman",y=this.yscaled+this.hscaled/4*3,e.fillText(this.smalltext,f,y)),e.restore();break;case 13:s.SetDimensions(o,r,l,c),s.shapes(e,s.subtype,s.outerRadius,s.innerRadius,s.linewidth,s.fillcolor,s.strokecolor,o,l,c)}},this.setinitRotatedMarkupPoint=function(e,t,a,i,r){var s=Math.cos(r),n=Math.sin(r),o=a-e,l=i-t,c=new Gs(o*s-l*n,o*n+l*s);return c.x=e+c.x,c.y=t+c.y,c},this.setRotatedMarkuprect=function(e,t,a,i){var r=this.rotatedrect.x,n=this.rotatedrect.y,o=this.rotatedrect.w,l=this.rotatedrect.h,c=Math.cos(i),h=Math.sin(i),u=r-e,d=n-t,p=u*c-d*h,g=u*h+d*c;p=e+p,g=t+g,this.rotatedrect.x=p,this.rotatedrect.y=g,a?(u=o-e,d=l-t):9==this.type&&0==this.subtype?(u=r+o-e,d=n-l-t):(u=r+o-e,d=n+l-t);var m=u*c-d*h,f=u*h+d*c;m=e+m,f=t+f,0!=s.textrotate&&(c=Math.cos(s.textrotate),h=Math.sin(s.textrotate)),this.rotatedrect.w=m,this.rotatedrect.h=f},this.getRotatedMarkup=function(e,t,a,i,r){var s=Math.cos(r),n=Math.sin(r),o=a-e,l=i-t,c=new Gs(o*s-l*n,o*n+l*s);return c.x=e+c.x,c.y=t+c.y,c},this.getMarkupSelectPointRot=function(e,t,a){var i=e,r=t,s=Math.cos(a),n=Math.sin(a);return new Gs(i*s-r*n,i*n+r*s)},this.getTopLeftRot=function(e,t,a){var i=-e/2,r=-t/2,s=Math.cos(a),n=Math.sin(a);return new Gs(i*s-r*n,i*n+r*s)},this.getBottomRightRot=function(e,t,a){var i=e/2,r=t/2,s=Math.cos(a),n=Math.sin(a);return new Gs(i*s-r*n,i*n+r*s)},this.getRotSelectRot=function(e,t,a){var i=-t/2-15,r=Math.cos(a),s=Math.sin(a);return new Gs(0*r-i*s,0*s+i*r)},this.seteditaction=function(e){s.signature==hs&&(s.editaction=e)},this.GetwithinCorner=function(e,t){var a=!1,i=0,r=0,n=Bs.getCurrentpage().drotation;if(0!=s.rotation){var o=this.LowerRightRectRot.x,l=this.LowerRightRectRot.w,c=this.LowerRightRectRot.y,h=this.LowerRightRectRot.h;s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=4,r=2),o=this.UpperLeftRectRot.x,l=this.UpperLeftRectRot.w,c=this.UpperLeftRectRot.y,h=this.UpperLeftRectRot.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=1,r=2),o=this.UpperRightRectRot.x,l=this.UpperRightRectRot.w,c=this.UpperRightRectRot.y,h=this.UpperRightRectRot.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=2,r=2),o=this.LowerLeftRectRot.x,l=this.LowerLeftRectRot.w,c=this.LowerLeftRectRot.y,h=this.LowerLeftRectRot.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=3,r=2),o=this.RotmarkerRectRot.x,l=this.RotmarkerRectRot.w,c=this.RotmarkerRectRot.y,h=this.RotmarkerRectRot.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=5,r=3)}else o=this.LowerRightRect.x,l=this.LowerRightRect.w,c=this.LowerRightRect.y,h=this.LowerRightRect.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=4,r=2),o=this.UpperLeftRect.x,l=this.UpperLeftRect.w,c=this.UpperLeftRect.y,h=this.UpperLeftRect.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=1,r=2),o=this.UpperRightRect.x,l=this.UpperRightRect.w,c=this.UpperRightRect.y,h=this.UpperRightRect.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=90==n||270==n?3:2,r=2),o=this.LowerLeftRect.x,l=this.LowerLeftRect.w,c=this.LowerLeftRect.y,h=this.LowerLeftRect.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=90==n||270==n?2:3,r=2),o=this.RotmarkerRect.x,l=this.RotmarkerRect.w,c=this.RotmarkerRect.y,h=this.RotmarkerRect.h,s.Getwithin(e,t,o,l,c,h)&&(a=!0,i=5,r=3);return{within:a,scalecorner:i,editaction:r}},this.Getwithin=function(e,t,a,i,r,s){var n=!1;return e>Math.min(a,i)&&e<Math.max(a,i)&&t>Math.min(r,s)&&t<Math.max(r,s)&&(n=!0),n},this.normalizeRect=function(e){var t={x:e.x,y:e.y,w:e.w,h:e.h};return t.x=Math.min(e.x,e.w),t.y=Math.min(e.y,e.h),t.w=Math.max(e.x,e.w),t.h=Math.max(e.y,e.h),t},this.GetwithinRect=function(e,t,a){var i=!1;return e>a.x&&e<a.w&&t>a.y&&t<a.h&&(i=!0),i},this.iswithin=function(e,t){if(Bs.getcurPage()!=s.pagenumber)return!1;var a=Na/2,i=Aa/2,r=Bs.getCurrentpage().drotation*(Math.PI/180);switch(Bs.getCurrentpage().drotation){case 0:r=Bs.getCurrentpage().drotation*(Math.PI/180);break;case 90:r=(Bs.getCurrentpage().drotation+180)*(Math.PI/180);break;case 270:r=(Bs.getCurrentpage().drotation-180)*(Math.PI/180);break;case 180:r=Bs.getCurrentpage().drotation*(Math.PI/180)}var n=jn(),o=n.x,l=n.y,c=Ln();c/=s.scaling;this.xscaled,this.wscaled,this.yscaled,this.hscaled;var h=0,u=0,d=0,p=0,g=0;if(0!=s.rotation){g=s.rotation;var m=s.getBottomRightRot(this.wscaled,this.hscaled,g);m.x,m.y,(m=s.getRotSelectRot(this.wscaled,this.hscaled,g)).x,m.y}var f=!1,y={x:e,y:t};if(0!=Bs.getCurrentpage().drotation){var v=s.getRotatedMarkup(a,i,e,t,r);e=v.x,t=v.y}var b=Math.min(this.xscaled,this.xscaled+this.wscaled),x=Math.max(this.xscaled,this.xscaled+this.wscaled),D=Math.min(this.yscaled,this.yscaled+this.hscaled),C=Math.max(this.yscaled,this.yscaled+this.hscaled),P=(Math.min(this.xscaled,this.wscaled),Math.max(this.xscaled,this.wscaled),Math.min(this.yscaled,this.hscaled),Math.max(this.yscaled,this.hscaled),this.type);switch(s.linesegment={p1:-1,p2:-1},s.multilinesegment={p1:[],p2:[]},s.selectedpoint=-1,s.selectedmultipoint=[],P){case 0:e>this.xscaled&&e<this.wscaled&&t>this.yscaled&&t<this.hscaled&&(f=!0,s.seteditaction(1)),e>this.wscaled-w&&e<this.wscaled+w&&t>this.hscaled-w&&t<this.hscaled+w&&(f=!0);break;case 1:var S=5==s.subtype||4==s.subtype,R=6==s.subtype,M=1==s.subtype||3==s.subtype||7==s.subtype;if(7==s.subtype)var T=15;else T=5;s.bfor3D&&(c=Aa/s.pageheight);var E={x:e,y:t},F={x:this.xscaled,y:this.yscaled},I={x:this.wscaled,y:this.hscaled},j={x:F.x-(I.x-F.x)/10,y:I.y-(I.y-F.y)/2};if(2==s.subtype)f=Yn(c,o,l,s.xoffset,s.yoffset,s.sides,E,j),s.seteditaction(1);else if(R){var O=0;for(N=0,O=0;O<s.pointlist.length;O++)for(N=0;N<s.pointlist[O].length;N++){if(h=(s.pointlist[O][N].x-s.xoffset)*c,u=(s.pointlist[O][N].y-s.yoffset)*c,h+=o,u+=l,N==s.pointlist[O].length-1){d=(s.pointlist[O][0].x-s.xoffset)*c,p=(s.pointlist[O][0].y-s.yoffset)*c;var L=[O,N],V=[O,0]}else d=(s.pointlist[O][N+1].x-s.xoffset)*c,p=(s.pointlist[O][N+1].y-s.yoffset)*c,L=[O,N],V=[O,N+1];Wn(E={x:e,y:t},F={x:h,y:u},I={x:d+=o,y:p+=l})<T&&(f=!0,s.seteditaction(1),s.multilinesegment={p1:L,p2:V})}}else if(M||S){var N=0;for(N=0;N<s.points.length;N++)h=(s.points[N].x-this.xoffset)*c,u=(s.points[N].y-this.yoffset)*c,h+=o,u+=l,N==s.points.length-1?(d=(s.points[0].x-this.xoffset)*c,p=(s.points[0].y-this.yoffset)*c,d+=o,p+=l,L=N,V=0):(d=(s.points[N+1].x-this.xoffset)*c,p=(s.points[N+1].y-this.yoffset)*c,d+=o,p+=l,L=N,V=N+1),Wn(E={x:e,y:t},F={x:h,y:u},I={x:d,y:p})<T&&(f=!0,s.seteditaction(1))}if(s.selectedit){if(6==s.subtype){for(O=0,N=0,O=0;O<s.pointlist.length;O++)for(N=0;N<s.pointlist[O].length;N++)if(h=(s.pointlist[O][N].x-s.xoffset)*c,u=(s.pointlist[O][N].y-s.yoffset)*c,h+=o,u+=l,N==s.pointlist[O].length-1?(d=(s.pointlist[O][0].x-s.xoffset)*c,p=(s.pointlist[O][0].y-s.yoffset)*c,L=[O,N],V=[O,0]):(d=(s.pointlist[O][N+1].x-s.xoffset)*c,p=(s.pointlist[O][N+1].y-s.yoffset)*c,L=[O,N],V=[O,N+1]),Wn(E={x:e,y:t},F={x:h,y:u},I={x:d+=o,y:p+=l})<5&&(f=!0,f=!0,s.seteditaction(7),s.multilinesegment={p1:L,p2:V}),e>h-8&&e<h+8&&t>u-8&&t<u+8){f=!0,s.selectedmultipoint=[O,N],s.seteditaction(4);break}}else for(N=0,N=0;N<s.points.length;N++)if(h=(s.points[N].x-this.xoffset)*c,u=(s.points[N].y-this.yoffset)*c,h+=o,u+=l,N==s.points.length-1?(d=(s.points[0].x-this.xoffset)*c,p=(s.points[0].y-this.yoffset)*c,d+=o,p+=l,L=N,V=0):(d=(s.points[N+1].x-this.xoffset)*c,p=(s.points[N+1].y-this.yoffset)*c,d+=o,p+=l,L=N,V=N+1),Wn(E={x:e,y:t},F={x:h,y:u},I={x:d,y:p})<5&&(f=!0,s.seteditaction(7),s.linesegment={p1:L,p2:V}),e>h-8&&e<h+8&&t>u-8&&t<u+8){f=!0,s.selectedpoint=N,s.seteditaction(4);break}return f}break;case 2:if(e>this.xscaled&&e<this.wscaled&&t>this.yscaled&&t<this.hscaled&&(f=!0,s.seteditaction(1)),e>this.wscaled-w&&e<this.wscaled+w&&t>this.hscaled-w&&t<this.hscaled+w&&(f=!0),s.selectedit)for(N=0,N=0;N<s.points.length;N++)h=(s.points[N].x-this.xoffset)*c,u=(s.points[N].y-this.yoffset)*c,u+=l,e>(h+=o)-8&&e<h+8&&t>u-8&&t<u+8&&(f=!0,s.selectedpoint=N,s.seteditaction(4));break;case 3:s.Getwithin(e,t,b,x,D,C)&&(f=!0,s.seteditaction(1));var A=s.GetwithinCorner(y.x,y.y);A.within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner);break;case 4:if(1==this.subtype){var B=Math.max(this.xscaled,this.wscaled)-Math.min(this.xscaled,this.wscaled),U=Math.max(this.yscaled,this.hscaled)-Math.min(this.yscaled,this.hscaled),G=s.getdiag(B,U);Math.sqrt((e-this.xscaled)*(e-this.xscaled)+(t-this.yscaled)*(t-this.yscaled))<G&&(f=!0,s.seteditaction(1));var H=this.wscaled,z=this.hscaled;e>H-w&&e<H+w&&t>z-w&&t<z+w&&(f=!0,s.seteditaction(2),this.scalecorner=4)}else s.Getwithin(e,t,b,x,D,C)&&(f=!0,s.seteditaction(1)),(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner);break;case 5:s.Getwithin(e,t,b,x,D,C)&&(f=!0,s.seteditaction(1)),(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner);break;case 6:Wn(E={x:e,y:t},F={x:this.xscaled,y:this.yscaled},I={x:this.wscaled,y:this.hscaled})<10&&(f=!0,s.seteditaction(1)),e>this.wscaled-w&&e<this.wscaled+w&&t>this.hscaled-w&&t<this.hscaled+w&&6!=this.subtype&&(f=!0,s.seteditaction(2),this.scalecorner=4),e>this.xscaled-w&&e<this.xscaled+w&&t>this.yscaled-w&&t<this.yscaled+w&&6!=this.subtype&&(f=!0,s.seteditaction(2),this.scalecorner=4),e>this.xscaled-w&&e<this.xscaled+w&&t>this.yscaled-w&&t<this.yscaled+w&&(f=!0,s.seteditaction(2),this.scalecorner=1);break;case 7:if(Wn(E={x:e,y:t},F={x:this.xscaled,y:this.yscaled},I={x:this.wscaled,y:this.hscaled})<10&&(f=!0,s.seteditaction(1)),e>this.wscaled-w&&e<this.wscaled+w&&t>this.hscaled-w&&t<this.hscaled+w&&(f=!0,s.seteditaction(2),this.scalecorner=4),e>this.xscaled-w&&e<this.xscaled+w&&t>this.yscaled-w&&t<this.yscaled+w&&(f=!0,s.seteditaction(2),this.scalecorner=4),e>this.xscaled-w&&e<this.xscaled+w&&t>this.yscaled-w&&t<this.yscaled+w&&(f=!0,s.seteditaction(2),this.scalecorner=1),0==this.leaderoffset)var W=this.xscaled+(this.wscaled-this.xscaled)/2,_=this.yscaled+(this.hscaled-this.yscaled)/2;else W=this.labelpos.x+(this.labelpos.w-this.labelpos.x)/2,_=this.labelpos.y+(this.labelpos.h-this.labelpos.y)/2;if(0!=k.w&&0!=k.h){var X=.5*k.w;e>W-X&&e<W+X&&t>_-X&&t<_+X&&(f=!0,s.seteditaction(6))}else e>W-w&&e<W+w&&t>_-w&&t<_+w&&(f=!0,s.seteditaction(6));break;case 8:if(E={x:e,y:t},F={x:this.xscaled,y:this.yscaled},I={x:this.wscaled,y:this.hscaled},j={x:F.x-(I.x-F.x)/10,y:I.y-(I.y-F.y)/2},f=Yn(c,o,l,s.xoffset,s.yoffset,s.sides,E,j),this.holes.length>0)for(var Y=0;Y<this.holes.length;Y++)this.holes[Y].selectedit&&(f=!1);if(f&&s.seteditaction(1),s.selectedit){var q=0;for(q=0;q<s.points.length;q++)if(h=(s.points[q].x-this.xoffset)*c,u=(s.points[q].y-this.yoffset)*c,h+=o,u+=l,q==s.points.length-1?(d=(s.points[0].x-this.xoffset)*c,p=(s.points[0].y-this.yoffset)*c,d+=o,p+=l,L=q,V=0):(d=(s.points[q+1].x-this.xoffset)*c,p=(s.points[q+1].y-this.yoffset)*c,d+=o,p+=l,L=q,V=q+1),Wn(E={x:e,y:t},F={x:h,y:u},I={x:d,y:p})<5&&(f=!0,s.seteditaction(7),s.linesegment={p1:L,p2:V}),e>h-8&&e<h+8&&t>u-8&&t<u+8){f=!0,s.selectedpoint=q,s.seteditaction(4);break}return s.insidelabel(e,t)&&(f=!0,s.seteditaction(8)),f}break;case 9:if(1==this.subtype||2==this.subtype)s.Getwithin(e,t,b,x,D,C)&&(f=!0,s.seteditaction(1)),(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner);else if(0==this.subtype){this.hscaled=this.textheight*c,this.wscaled=this.textwidth;var Z=this.wscaled,J=this.hscaled,K=Z;switch(this.textrotate/(Math.PI/180)){case 0:0==this.subtype?s.Getwithin(e,t,this.xscaled,this.xscaled+Z,this.yscaled-J,this.yscaled)&&(f=!0,s.seteditaction(1)):1!=this.subtype&&2!=this.subtype||s.Getwithin(e,t,this.xscaled,this.xscaled+Z,this.yscaled+J,this.yscaled)&&(f=!0,s.seteditaction(1));break;case 90:Z=J,J=K;var Q=Math.min(this.xscaled,this.xscaled+Z),$=Math.max(this.xscaled,this.xscaled+Z),ee=Math.min(this.yscaled,this.yscaled+J),te=Math.max(this.yscaled,this.yscaled+J);s.Getwithin(e,t,Q,$,ee,te)&&(f=!0,s.seteditaction(1));break;case 180:Q=Math.min(this.xscaled,this.xscaled-Z),$=Math.max(this.xscaled,this.xscaled-Z),ee=Math.min(this.yscaled,this.yscaled+J),te=Math.max(this.yscaled,this.yscaled+J),s.Getwithin(e,t,Q,$,ee,te)&&(f=!0,s.seteditaction(1));break;case 270:Z=J,J=K,Q=Math.min(this.xscaled,this.xscaled-Z),$=Math.max(this.xscaled,this.xscaled-Z),ee=Math.min(this.yscaled,this.yscaled-J),te=Math.max(this.yscaled,this.yscaled-J),s.Getwithin(e,t,Q,$,ee,te)&&(f=!0,s.seteditaction(1))}(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner)}break;case 10:di?e>this.xscaled&&e<this.xscaled+this.w&&t>this.yscaled&&t<this.yscaled+this.h&&(f=!0,s.seteditaction(1)):e>this.xscaled&&e<this.xscaled+this.wscaled&&t>this.yscaled&&t<this.yscaled+this.hscaled&&(f=!0,s.seteditaction(1));break;case 11:(1==s.subtype||3==s.subtype||12==s.subtype||20==s.subtype||21==s.subtype)&&(s.Getwithin(e,t,this.xscaled,this.xscaled+this.wscaled,this.yscaled,this.yscaled+this.hscaled)&&(f=!0,s.seteditaction(1)),(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner));break;case 12:e>this.xscaled&&e<this.xscaled+this.wscaled&&t>this.yscaled&&t<this.yscaled+this.hscaled&&(f=!0,s.seteditaction(1)),(A=s.GetwithinCorner(y.x,y.y)).within&&(f=!0,s.seteditaction(A.editaction),this.scalecorner=A.scalecorner);break;case 13:s.bfor3D&&(c=Aa/s.pageheight);var ae=0;for(ae=0;ae<s.countshapes.length;ae++)if(h=(s.countshapes[ae].x-this.xoffset)*c,u=(s.countshapes[ae].y-this.yoffset)*c,E={x:e,y:t},F={x:h+=o,y:u+=l},e>h-8&&e<h+8&&t>u-8&&t<u+8){f=!0,s.selectedpoint=ae,s.seteditaction(4);break}}return f},this.ispointwithinarea=function(e,t){if(s.noDraw)return!1;var a=jn(),i=a.x,r=a.y,n=Ln();n/=s.scaling;var o=!1,l={x:e,y:t},c=Math.min(this.xscaled,this.xscaled+this.wscaled),h=Math.max(this.xscaled,this.xscaled+this.wscaled),u=Math.min(this.yscaled,this.yscaled+this.hscaled),d=Math.max(this.yscaled,this.yscaled+this.hscaled);switch(this.type){case 3:s.Getwithin(e,t,c,h,u,d)&&(o=!0),s.GetwithinCorner(l.x,l.y).within&&(o=!0);break;case 8:var p={x:e,y:t},g={x:this.xscaled,y:this.yscaled},m={x:this.wscaled,y:this.hscaled},f={x:g.x-(m.x-g.x)/10,y:m.y-(m.y-g.y)/2};o=Yn(n,i,r,s.xoffset,s.yoffset,s.sides,p,f)}return o},this.setdisplay=function(e){0==s.type&&1==s.subtype||(s.display=e)},this.showperimeter=function(e){s.bshowperimeter=e}}}function Io(e,t){var a=0,i=!1,r=-1;for(a=Bs.markupdraworder.length;a>0;a--){var s=Bs.markupdraworder[a-1];if(null!=Bs.markuplist[s]){var n=el(Bs.markuplist[s]);if(Bs.markuplist[s].iswithin(e,t)&&Bs.markuplist[s].signature==hs&&Bs.markuplist[s].display&&n)switch(Bs.markuplist[s].type){case 9:Ho(),Uo(),Bs.markuplist[s].setselectedit(!0),Bs.markuplist[s].setselect(!1),i=!0,r=Bs.markuplist[s].markupnumber}}if(i)break}return r}function jo(e,t){var a=0,i=-1;if(!Fi)return i;for(a=0;a<Bs.markuplist.length;a++)if(Bs.markupdraworder[a],null!=Bs.markuplist[a]){var r=el(Bs.markuplist[a]);Bs.markuplist[a].iswithin(e,t)&&Bs.markuplist[a].display&&r&&(i=Bs.markuplist[a].markupnumber)}return i}function Oo(){for(var e={isempty:!0},t=0;t<Bs.markuplist.length;t++)(Bs.markuplist[t].selected||Bs.markuplist[t].selectedit)&&(e=Bs.markuplist[t].bhasArrow&&null!=Bs.markuplist[t].markupArrowConnected?Bs.markuplist[t].markupArrowConnected:Bs.markuplist[t]);return e}function Lo(e,t){var a=0;for(a=0;a<Bs.markuplist.length;a++)Bs.markuplist[a].markupnumber==e&&Vo(Bs.markuplist[a],t)}function Vo(e,t){e&&null!=e.ChangeMarkup&&"function"==typeof e.ChangeMarkup&&e.ChangeMarkup(t)}function No(e,t){var i=0;if($i)var r=ai+=1;for(i=0;i<Bs.markuplist.length;i++)(Bs.markuplist[i].selected||Bs.markuplist[i].selectedit||t)&&($i&&Bs.markuplist[i].setmultiValues(r),Vo(Bs.markuplist[i],e));4==e&&-1!=Bs.selectedmarkup.id&&Bs.selectedmarkup.edit&&Bs.selectedmarkup.selected&&Vo(Bs.markuplist[Bs.selectedmarkup.id],e),al(n),il(a)}function Ao(e){for(var t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&Bs.markuplist[t].markupnumber==e&&(Bs.markuplist[t].selected&&(Bs.markuplist[t].setselect(!1),Bs.markuplist[t].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[t])),Bs.markuplist[t].selectedit&&(Bs.markuplist[t].setselectedit(!1),Bs.markuplist[t].bpointEdit=!1,Bs.markuplist[t].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[t])))}function Bo(e){for(var t=0;t<Xs.length;t++)for(var a=0;a<Xs[t].markuplist.length;a++)null!=Xs[t].markuplist[a]&&Xs[t].markuplist[a].getUniqueID()==e&&(Xs[t].markuplist[a].bhasArrow&&null!=Xs[t].markuplist[a].markupArrowConnected&&Xs[t].markuplist[a].markupArrowConnected.setdelete(),Xs[t].markuplist[a].setdelete());Jo()}function Uo(){for(var e=0;e<Bs.markuplist.length;e++)null!=Bs.markuplist[e]&&Bs.markuplist[e].selectedit&&(Bs.markuplist[e].setselectedit(!1),Bs.markuplist[e].bpointEdit=!1,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[e]));al(n),il(a)}function Go(e){for(var t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&Bs.markuplist[t].selectedit&&13==Bs.markuplist[t].type&&(Bs.markuplist[t].insertcount(e),"markupedit"==As.name&&As.disablePointInsert())}function Ho(){for(var e=0;e<Bs.markuplist.length;e++)null!=Bs.markuplist[e]&&(Bs.markuplist[e].selected&&(Bs.markuplist[e].setselect(!1),Bs.markuplist[e].bUsemouseinput=!0,Bs.markuplist[e].unselected=!0),Bs.markuplist[e].marked&&Bs.markuplist[e].setmarked(!1));al(n),il(a)}function zo(e){var t=0,a=void 0;for(t=Bs.markuplist.length;t>0;t--)if(null!=Bs.markuplist[t-1]&&Bs.markuplist[t-1].display&&Bs.markuplist[t-1].pagenumber==Bs.getcurPage()&&8==Bs.markuplist[t-1].type&&1==Bs.markuplist[t-1].subtype){var i=e.toString();Bs.markuplist[t-1].findAttribute("SpaceID",i)&&(a=Bs.markuplist[t-1])}return a}function Wo(e,t,i){var r=0,s=!1;for(r=Bs.markuplist.length;r>0;r--)if(null!=Bs.markuplist[r-1]&&Bs.markuplist[r-1].display&&Bs.markuplist[r-1].pagenumber==Bs.getcurPage()&&8==Bs.markuplist[r-1].type&&1==Bs.markuplist[r-1].subtype){var o=e.toString();Bs.markuplist[r-1].findAttribute("SpaceID",o)&&(s=!0,i?(Bs.markuplist[r-1].alternative=1,Bs.markuplist[r-1].fillcolor=t):Bs.markuplist[r-1].alternative=0)}return al(n),il(a),s}function _o(e,t,i){var r=0,s=[],o={found:!1,blink:!1,id:-1,locked:!1,index:-1};if(null==Bs||null==Bs)return;Bs.setMarkupMultiselected(),$i||Bs.getMarkupMultiselected()||Ho();let l=[];for(r=Bs.markupdraworder.length;r>0;r--){var c=Bs.markupdraworder[r-1];if(null!=Bs.markuplist[c]){var h=el(Bs.markuplist[c]);if(Bs.markuplist[c].display&&h&&Bs.markuplist[c].iswithin(e,t)){var u=r-1;s.push(u),o=Bs.markuplist[c].onselect(c,i),l.push(c)}}}if(Bs.markupdraworderChange){for(var d=0;d<s.length;d++){var p=Bs.markupdraworder[s[d]],g=Bs.markupdraworder[Bs.markupdraworder.length-1];Bs.markupdraworder[Bs.markupdraworder.length-1]=p,Bs.markupdraworder[s[d]]=g}s.length>0&&(Bs.markupdraworderChange=!1)}else s.length>0&&(Bs.markupdraworderChange=!0);if($i||Bs.getMarkupMultiselected()||function(e){for(var t=!1,i=!1,r=0;r<Bs.markuplist.length;r++)t=Bs.markuplist[r].markupnumber!=e,Bs.markuplist[r].bhasArrow&&null!=Bs.markuplist[r].markupArrowConnected&&(i=e==Bs.markuplist[r].markupArrowConnected.markupnumber),Bs.markuplist[r].bisTextArrow&&null!=Bs.markuplist[r].textBoxConnected&&(i=e==Bs.markuplist[r].textBoxConnected.markupnumber),t=!i&&Bs.markuplist[r].markupnumber!=e,null!=Bs.markuplist[r]&&t&&(Bs.markuplist[r].selected&&(Bs.markuplist[r].setselect(!1),Bs.markuplist[r].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[r])),Bs.markuplist[r].selectedit&&(Bs.markuplist[r].setselectedit(!1),Bs.markuplist[r].bpointEdit=!1,Bs.markuplist[r].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[r])));al(n),il(a)}(o.id),!o.found)for(r=0;r<Bs.markuplist.length;r++)null!=Bs.markuplist[r]&&(Bs.markuplist[r].setselect(!1),Bs.markuplist[r].bUsemouseinput=!0,Bs.markuplist[r].setselectedit(!1),Bs.markuplist[r].bpointEdit=!1,Bs.markuplist[r].resetcupoint());return Bs.setMarkupMultiselected(),function(){for(var e=0;e<Bs.markuplist.length;e++)null!=Bs.markuplist[e]&&!Bs.markuplist[e].selected&&Bs.markuplist[e].unselected&&(Bs.markuplist[e].unselected=!1,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[e]))}(),function(e,t,a){a?null!=zt&&null!=t&&(9==t.type&&t.subtype,zt.setMarkupSelected(t,{created:!1,modified:!0,deleted:!1})):null!=zt&&(-1==e?zt.setMarkupSelected(e,{created:!1,modified:!1,deleted:!1}):(9==t.type&&t.subtype,zt.setMarkupSelected(t,{created:!1,modified:!1,deleted:!1})))}(o.id,Bs.markuplist[o.index],o.found),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),{id:o.id,blink:o.blink,index:o.index,locked:o.locked}}function Xo(e){var t=0,i=0,r=[];for(t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&(Bs.markuplist[t].signature,e==Bs.markuplist[t].markupnumber?(8==Bs.markuplist[t].type&&2==Bs.markuplist[t].subtype&&qo(Bs.markuplist[t].parent,e),null!=zt&&zt.setMarkupSelected(Bs.markuplist[t],{created:!1,modified:!1,deleted:!0})):(r[i]=Bs.markuplist[t],i++));Bs.markuplist=r,Bs.nummarkups=Bs.markuplist.length,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=st&&st.setThumbnails(Bs.thumbnails),al(n),il(a)}function Yo(e){var t=0,i=0,r=[];for(Bs.markupdraworder=[],$i&&(ai+=1),t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&(Bs.markuplist[t].markupID==e||(r[i]=Bs.markuplist[t],Bs.markupdraworder[i]=i,i++));Bs.markuplist=r,Bs.nummarkups=Bs.markuplist.length,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=st&&st.setThumbnails(Bs.thumbnails),al(n),il(a)}function qo(e,t){var a=0,i=0,r=(t=-1,[]),s=!0;for(a=0;a<e.holes.length;a++)(e.holes[a].id=t)?(t=e.markupnumber,s=!1,null!=zt&&zt.setMarkupSelected(e.holes[a],{created:!1,modified:!1,deleted:!0})):(r[i]=e.holes[a],i++);return e.holes=r,s}function Zo(e){var t=0,a=0,i=[],r=!0;for(t=0;t<e.holes.length;t++)e.holes[t].selectedit?(e.markupnumber,r=!1,null!=zt&&zt.setMarkupSelected(e.holes[t],{created:!1,modified:!1,deleted:!0})):(i[a]=e.holes[t],a++);return e.holes=i,r}function Jo(){var e=0,t=0,i=-1,r=[];if(Bs.markupdraworder=[],$i)var s=ai+=1;for(e=0;e<Bs.markuplist.length;e++)if(null!=Bs.markuplist[e]){var o=Bs.markuplist[e].signature==hs,l=8==Bs.markuplist[e].type&&2==Bs.markuplist[e].subtype,c=Bs.markuplist[e].getdelete(),h=Bs.markuplist[e].selected||Bs.markuplist[e].selectedit;o&&h||c?(i=Bs.markuplist[e].markupnumber,$i&&Bs.markuplist[e].setmultiValues(s),l&&Bs.markuplist[e].parent.holes.length>0&&(h=Zo(Bs.markuplist[e].parent)),Mo(i,3),null!=zt&&zt.setMarkupSelected(Bs.markuplist[e],{created:!1,modified:!1,deleted:!0})):(r[t]=Bs.markuplist[e],Bs.markupdraworder[t]=t,t++)}Bs.markuplist=r,Bs.nummarkups=Bs.markuplist.length,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=st&&st.setThumbnails(Bs.thumbnails),al(n),il(a)}function Ko(e,t,a,i,r,s){if(null!=Bs&&null!=Bs){var n=0;if(Bs.Drawmarkup)for(n=0;n<Bs.markuplist.length;n++)null!=Bs.markuplist[n]&&Bs.markuplist[n].pagenumber==t&&Bs.markuplist[n].display&&Bs.markuplist[n].drawprint(e,a,i,r,s,!1)}}function Qo(e,t,a,i,r){var s=0;if(null!=bd().docObj){for(s=0;s<bd().docObj.markuplist.length;s++){var n=el(Bs.markuplist[s]);null!=bd().docObj.markuplist[s]&&bd().docObj.markuplist[s].pagenumber==t&&bd().docObj.markuplist[s].display&&(bd().docObj.markuplist[s].bfor3D?n&&bd().docObj.markuplist[s].drawprint(e,a,i,r,0,!1):bd().docObj.markuplist[s].drawprint(e,a,i,r,0,!1))}null!=Pa&&(null!=bd().docObj.pages[t]?Pa.printpageComplete(bd().docObj.pages[t].printobj):Vi[t]=!0)}}function $o(){var e=0,t=function(){var e=0,t=0,a=0,i=0;for(e=0;e<Bs.markuplist.length;e++)null!=Bs.markuplist[e]&&(a=t,(t=Bs.markuplist[e].markupnumber)>a&&(i=t));return i}();t>e&&(e=t);var a=function(){var e=0,t=0,a=0,i=0;for(e=0;e<Bs.markupundolist.length;e++)null!=Bs.markupundolist[e]&&(a=t,(t=Bs.markupundolist[e].markupnumber)>a&&(i=t));return i}();a>e&&(e=a);var i=function(){var e=0,t=0,a=0,i=0;for(e=0;e<Bs.markupredolist.length;e++)null!=Bs.markupundolist[e]&&(a=t,(t=Bs.markupredolist[e].markupnumber)>a&&(i=t));return i}();return i>e&&(e=i),e+1}function el(e){return e.bfor3D?e.viewname==Bs.getcur3DView():Bs.visiblepage(e.pagenumber)}function tl(e){var t=0;for(t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&Bs.markuplist[t].setdisplay(e)}function al(e){if(null!=Bs&&null!=Bs){var t=rl();if(ti&&t)e.clearRect(0,0,Na,Aa);else{var a=0,i=!0;if(e.clearRect(0,0,Na,Aa),null!=Bs.getCurrentThumb()&&(Bs.getCurrentThumb().draw_thumbnail(),Bs.getCurrentThumb().clearBirdseyeMarkupctx()),Bs.drawHoverSpace(e),!ki&&Bs.getCurrentpage()){if(Bs.getCurrentpage().Vector3DPageObj&&(Bs.getCurrentpage().Vector3DPageObj.renderMarkupPoints(n),i=!1),Bs.Drawmarkup){for(a=0;a<Bs.markuplist.length;a++)if(null!=Bs.markuplist[a]){if(!Bs.markuplist[a].selected&&!Bs.markuplist[a].selectedit&&Bs.markuplist[a].display&&null!=Bs.pages[Bs.markuplist[a].pagenumber]&&i){var r=Bs.getThumb(Bs.markuplist[a].pagenumber);Bs.markuplist[a].bfor3D&&(r=void 0),null!=r&&Bs.markuplist[a].drawbirdseye(r)}if(el(Bs.markuplist[a])){var s=!1;if(Bs.markuplist[a].holes.length>0)for(var o=0;o<Bs.markuplist[a].holes.length;o++)(Bs.markuplist[a].holes[o].selected||Bs.markuplist[a].holes[o].selectedit)&&(s=!0);Bs.markuplist[a].selected||Bs.markuplist[a].selectedit||s||!Bs.markuplist[a].display||(r=Bs.getThumb(Bs.markuplist[a].pagenumber),Bs.markuplist[a].drawthumb(r.thumbctx),Bs.markuplist[a].drawmescaled(e))}}}else for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&el(Bs.markuplist[a])&&0==Bs.markuplist[a].type&&1==Bs.markuplist[a].subtype&&Bs.markuplist[a].display&&(i&&null!=Bs.getCurrentThumb()&&(Bs.markuplist[a].drawthumb(Bs.getCurrentThumb().thumbctx),Bs.markuplist[a].drawbirdseye(Bs.getCurrentThumb())),Bs.markuplist[a].drawmescaled(e));jh()||$a||Bs.drawselectedBlocks()}}}}function il(e){if(null!=Bs&&null!=Bs&&null!=As&&null!=As){var t=rl();if(ti&&t)e.clearRect(0,0,Na,Aa);else{var a=0;if(e.clearRect(0,0,Na,Aa),Bs)if(Bs.Drawmarkup)for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&el(Bs.markuplist[a])&&(Bs.markuplist[a].selected||Bs.markuplist[a].selectedit)&&Bs.markuplist[a].display&&(null!=Bs.getCurrentThumb()&&(Bs.markuplist[a].drawbirdseye(Bs.getCurrentThumb()),Bs.markuplist[a].drawthumb(Bs.getCurrentThumb().thumbctx)),8==Bs.markuplist[a].type&&2==Bs.markuplist[a].subtype?Bs.markuplist[a].parent&&Bs.markuplist[a].parent.drawmescaled(e):Bs.markuplist[a].drawmescaled(e));else for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&el(Bs.markuplist[a])&&0==Bs.markuplist[a].type&&1==Bs.markuplist[a].subtype&&Bs.markuplist[a].display&&(null!=Bs.getCurrentThumb()&&(Bs.markuplist[a].drawbirdseye(Bs.getCurrentThumb()),Bs.markuplist[a].drawthumb(Bs.getCurrentThumb().thumbctx)),8==Bs.markuplist[a].type&&2==Bs.markuplist[a].subtype?Bs.markuplist[a].parent&&Bs.markuplist[a].parent.drawmescaled(e):Bs.markuplist[a].drawmescaled(e))}}}function rl(){return null==Bs||null==Bs||null==Bs.getcur3DView()}function sl(e){for(var t=0,a=0;a<e.length;a++)t+=e[a],a<e.length-1&&(t<<=8);return t}function nl(e,t){for(var a=0;a<e.chunks.length;a++)if(e.chunks[a].name=t)return e.chunks[a];return null}function ol(e,t){var a=sl(e.slice(t,t+4)),i="";i+=String.fromCharCode(e[t+4]),i+=String.fromCharCode(e[t+5]),i+=String.fromCharCode(e[t+6]),i+=String.fromCharCode(e[t+7]);for(var r=[],s=t+8;s<a+t+8;s++)r.push(e[s]);return{start:t,end:Number(t)+Number(a)+12,length:a,name:i,data:r,crc:[e[a+t+8],e[a+t+9],e[a+t+10],e[a+t+11]],crcChecked:!1}}function ll(){var e=window.devicePixelRatio||1;return e!=oe&&(le||(le=!0,alert("the browser window scaling has changed, restart the viewer"))),e/1}function cl(e){ll();e.transform(1,0,0,1,.5,.5)}function hl(e){return e+(e>0?.5:-.5)<<0}class ul{constructor(e,t,a,i,r){var s=this;this.type="text",this.textwidthset=!1,this.textwidth=a.height,this.parent=t,this.blockname=i,this.index=r,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.height=a.height,this.fontname=a.name,this.weight=a.weight,this.rotation=-a.rotation*(Math.PI/180),this.underline=a.underline,this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.text=e.text,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.selected=!1,this.hasArea=!1,this.entityType=e.entityType,this.mouseon=!1;var n=!1;this.role=e.role,this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1,u=s.getRectangle(a,i,r,n,o,l);return e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0),h},this.getArea=function(){var e=s.x1,t=s.y1,a=t+s.height,i=e+s.textwidth;if(e>i){var r=e;e=i,i=r}if(t>a){var n=t;t=a,a=n}return(i-e)*(a-t)},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x1-i)*e,l=(n-s.y1)*e,c=l+s.height*e,h=o+s.textwidth*e;if((o+=t)>(h+=t)){var u=o;o=h,h=u}if((l+=a)>(c+=a)){var d=l;l=c,c=d}var p={x:o,y:l};if(0!=s.rotation){var g=function(e,t,a){var i=e.x,r=e.y,s=e.w,n=e.h,o=t,l=Math.cos(o),c=Math.sin(o),h=a.x,u=a.y,d=i-h,p=r-u,g=d*l-p*c,m=d*c+p*l;g=h+g,m=u+m;var f=(d=s-h)*l-(p=n-u)*c,y=d*c+p*l;return f=h+f,y=u+y,{x:Math.min(g,f),y:Math.min(m,y),w:Math.max(f,g),h:Math.max(y,m)}}({x:o,y:l,w:h,h:c},s.rotation,p);o=g.x,l=g.y,h=g.w,c=g.h}return{found:!0,x:o,y:l,w:h-o,h:c-l,wp:(h-o)/10,hp:(c-l)/10}},this.findsnapPoint=function(e,t,a,i,r,s,n,o){return{found:!1,x:0,y:0,type:1}},this.gettextwidth=function(e,t){return e.measureText(t)},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),a=t=s.stroketempcolor,s.stroketempcolor=a):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor,s.filltempcolor=s.fillcolor,a=s.filltempcolor):(s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),this.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor))),e&&"#FFFFFF"==s.strokecolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),e&&"#FFFFFF"==s.fillcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?(t=s.parent.backgroundColor,a=s.parent.backgroundColor):2==s.role&&(t=s.parent.overlayColor,a=s.parent.overlayColor)),n&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.setTextWidth=function(e){if(!s.textwidthset){var t="normal "+s.height+"px "+s.fontname+", Helvetica";s.textwidth=function(e,t,a){e.save(),e.font=a;const i=e.measureText(t);return e.restore(),i.width}(e,s.text,t),s.textwidthset=!0}},this.highlight=function(e,t,a,i,r,o,l){n=!0,s.drawme(e,t,a,i,r,o,l,1,1,!1,!1),n=!1},this.drawme=function(e,t,a,i,r,o,l,c,h,u,d){var p=(s.x1-r)*t,g=(l-s.y1)*t,m=s.height*t;if(g+=m,0!=c&&0!=h&&Bs){var f=s.getdrawColors(u);if(e.fillStyle=f.fillcolor,e.strokeStyle=f.linecolor,m<5)var y="normal "+m+"px "+s.fontname+", Helvetica";else y="normal "+m+"px "+s.fontname+", Helvetica";if(n&&(y="normal "+m+"1px "+s.fontname+", Helvetica"),e.font=y,g+=i,p=hl(p+=a),g=hl(g),e.save(),0!=s.rotation&&(e.translate(p,g-m),e.rotate(s.rotation),e.translate(-p,-(g-m))),e.fillText(s.text,p,g),1==s.underline){var v=m/8,b=m/20,x=s.gettextwidth(e,s.text);e.fillRect(p,g+v,x.width,b)}e.restore(),s.setTextWidth(e),s.drawcompare=!1}},this.Close=function(){}}}class dl{constructor(e,t,a,i,r){var s=this;this.parent=t,this.index=r,this.type="image",this.magnify=e.magnify,this.pagenumber=0,this.pdfisrendered=!1,this.pdfpagewidth=0,this.pdfpageheight=0,this.cleanupAfterRender=!0,this.pageRendering=!1,this.pdfrenderopque=0,this.dimset=!1,this.bMaxzoom=!1,this.nPDFMaxFactor=4,this.viewport=null,this.dscalepdf=1,this.pdfpagescale=1,this.pagedrawcnv=document.createElement("canvas"),this.pagedrawctx=this.pagedrawcnv.getContext("2d"),this.image=void 0,this.blockname=a,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this.width=this.x2-t.x-(this.x1-t.x),this.height=t.h-this.y1-(t.h-this.y2),this.role=e.role,this.isoverlay=!1,this.isbackground=!1,this.bdrawn=!1,this.numcolors=0,this.mouseon=!1,this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.selected=!1,this.hasArea=!1,this.imageloaded=!1,this.invertible=!1,this.imagecnv=document.createElement("canvas"),this.imagectx=this.imagecnv.getContext("2d",{willReadFrequently:!0}),1!=e.role&&2!=e.role||(this.invertible=!0),this.setpdfScale=function(e,t){s.dscalepdf=e,s.pdfpagescale=t},this.renderPDFpagescale=function(e){if(!s.pageRendering){if(s.pageRendering=!0,1==s.role)var a=s.parent.bgDocObjref,i=s.parent.bgpageindex;else 2==s.role&&(a=s.parent.fgDocObjref,i=s.parent.fgpageindex);null!=a&&null!=i&&a.pdfDoc.getPage(i+1).then((function(a){if(0!=a.view[3])var i=Math.abs(a.view[2]-a.view[0]),r=Math.abs(a.view[3]-a.view[1]),n=Math.abs(a.view[2]-a.view[0]);else i=Math.abs(a.view[2]-a.view[0]),r=Math.abs(a.view[3]-a.view[1]),n=Math.abs(a.view[2]-a.view[0]);switch(a._pageInfo.rotate){case 0:break;case 90:i=r,r=n;break;case 180:break;case 270:i=r,r=n}if(s.dimset||(s.x1=0,s.y1=0,s.x2=i,s.y2=r,s.dimset=!0),s.nPDFMaxFactor=Math.sqrt(sr/(i*r)),e>s.nPDFMaxFactor){var o=e/s.nPDFMaxFactor;e=s.nPDFMaxFactor,s.bMaxzoom=!0}else o=1,s.bMaxzoom=!1;s.viewport=a.getViewport({scale:e}),s.pagedrawcnv.width=s.viewport.width,s.pagedrawcnv.height=s.viewport.height,s.setpdfScale(o,e);var l={canvasContext:s.pagedrawctx,viewport:s.viewport};s.renderTask=a.render(l),s.renderTask.promise.then((function(){s.pageRendering=!1,s.pdfrenderopque-=1,s.pdfrenderopque<=0&&(s.pdfrenderopque=0),s.pdfisrendered=!0,s.imagecnv.width=s.pagedrawcnv.width,s.imagecnv.height=s.pagedrawcnv.height,s.imagectx.drawImage(s.pagedrawcnv,0,0),s.bdrawn=!0,t&&(0==t.comparemode?(1==s.role&&s.invert(t.backgroundColor),2==s.role&&s.invert(t.overlayColor)):1==t.comparemode&&2==s.role&&s.invert(),1!=s.role&&2!=s.role||s.imageloaded||(s.imageloaded=!0,t.imageloadcomplete(s.role)),s.magnify||t.refreshdraw())})).catch((function(e){s.renderTask=null,"RenderingCancelledException"===e.name&&(s.pagedrawcnv=document.createElement("canvas"),s.pagedrawctx=s.pagedrawcnv.getContext("2d"),s.pdfisrendered=!1)}))}))}},this.imageload=function(e){s.image=e.currentTarget,s.imagectx.drawImage(s.image,0,0),s.imageloaded=!0,t&&(1!=s.role&&2!=s.role||t.imageloadcomplete(s.role),t.refreshdraw())},this.getnumColors=function(){var e=s.imagectx.getImageData(0,0,s.imagecnv.width,s.imagecnv.height);s.numcolors=function(e){for(var t=1,a={r:e[0],g:e[1],b:e[2]},i={r:e[0],g:e[1],b:e[2]},r=0;r<e.length;r+=4)(i={r:e[r],g:e[r+1],b:e[r+2]}).r==a.r&&i.g==a.g&&i.b==a.b||(t++,a.r=i.r,a.g=i.g,a.b=i.b);return t}(e)},this.invert=function(e){if(s.bdrawn&&s.invertible){var a=s.imagectx.getImageData(0,0,s.imagecnv.width,s.imagecnv.height);e?function(e,t){for(var a=gn(t),i=0;i<e.length;i+=4)255==e[i]&&255==e[i+1]&&255==e[i+2]||254==e[i]&&254==e[i+1]&&254==e[i+2]?e[i+3]=100:(e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b)}(a.data,e):1==t.comparemode&&function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]&&(e[t+3]=100)}(a.data),s.imagectx.putImageData(a,0,0)}},this.countColors=function(e){},this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1,u=s.getRectangle(a,i,r,n,o,l);return e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0),h},this.getArea=function(){var e=s.x1,t=s.y1,a=s.x2,i=s.y2;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x1-i)*e,l=(n-s.y1)*e,c=(s.x2-i)*e,h=(n-s.y2)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.findsnapPoint=function(e,t,a,i,r,s,n,o){return{found:!1,x:0,y:0,type:1}},this.highlight=function(e,t,a,i,r,n,o){s.drawme(e,t,a+2,i+2,r,n,o,1,1,!1,!1)},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=(this.x1-r)*t,p=(o-this.y1)*t,g=(this.x2-r)*t,m=(o-this.y2)*t;if(0!=l&&0!=c&&Bs&&(s.magnify||!u)&&(!s.magnify||u)){var f=(p+=i)-(m+=i),y=(g+=a)-(d+=a);d=hl(d),m=hl(m),s.imageloaded&&(s.pdfpagescale!=t&&(s.pdfrenderopque+=1,s.renderPDFpagescale(t)),e.drawImage(s.imagecnv,d,m,y,f),this.bdrawn=!0)}},this.Close=function(){},s.renderPDFpagescale(1)}}class pl{constructor(e,t,a,i,r){var s=this;this.parent=t,this.index=r,this.type="image",this.image=void 0,this.blockname=a,this.blockstate=1,this.layerstate=1,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this.width=this.x2-t.x-(this.x1-t.x),this.height=t.h-this.y1-(t.h-this.y2),this.entityType=e.entityType,this.entityType.type=18,this.role=e.role,this.isoverlay=!1,this.isbackground=!1,this.bdrawn=!1,this.numcolors=0,this.mouseon=!1,this.layer=e.layer,this.layerstate=e.layerstate,this.drawmode=e.drawmode,this.selected=!1,this.hasArea=!1,this.imageloaded=!1,this.invertible=!1,this.imagecnv=document.createElement("canvas"),this.imagectx=this.imagecnv.getContext("2d",{willReadFrequently:!0});var n=new Image;function o(e){var t,a,i=function(e){var t={};if(t.headerIsValid=137==e[0]&&80==e[1]&&78==e[2]&&71==e[3]&&13==e[4]&&10==e[5]&&26==e[6]&&10==e[7],!t.headerIsValid)return console.warn("Provided data does not belong to a png"),t;var a=[],i=ol(e,8);for(a.push(i);"IEND"!==i.name;)i=ol(e,i.end),a.push(i);return t.chunks=a,t}(function(e){e=e.split("base64,")[1];for(var t=atob(e),a=new Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Uint8Array(a)}(e)),r=(a=nl(t=i,"IDHR"),t.width=sl(a.data.slice(0,4)),t.height=sl(a.data.slice(4,8)),t.bitDepth=sl(a.data.slice(8,9)),t.colorType=sl(a.data.slice(9,10)),t.compressionMethod=sl(a.data.slice(10,11)),t.filterMethod=sl(a.data.slice(11,12)),t.interlaceMethod=sl(a.data.slice(12,13)),t.isGreyScale=0==t.colorType||4==t.colorType,t.isRgb=2==t.colorType||6==t.colorType,t.hasAlpha=4==t.colorType||6==t.colorType,t.hasPaletteMode=3==t.colorType&&null!=nl(t,"PLTE"),t),o=function(e,t){e=e.split("base64,")[1];const a=atob(e),i=[];for(let e=0;e<a.length;e+=512){const t=a.slice(e,e+512),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);const s=new Uint8Array(r);i.push(s)}return new Blob(i,{type:t})}(e,"image/png");s.imagecnv.width=r.width,s.imagecnv.height=r.height,1==r.bitDepth&&(s.invertible=!0);var l=(window.URL||window.webkitURL).createObjectURL(o);n.onload=s.imageload,n.onerror=s.imageerror;try{n.src=l}catch(e){console.log("failed to read image",e)}}if(n.onload=this.imageload,1!=e.role&&2!=e.role||(s.invertible=!0),this.imageloadbypass=function(){s.imageloaded=!0,t&&(1!=s.role&&2!=s.role||t.imageloadcomplete(s.role),t.refreshdraw())},this.imageerror=function(e){console.log("failed to read image",e)},this.imageload=function(e){s.image=e.currentTarget,s.imagectx.drawImage(s.image,0,0),s.imageloaded=!0,t&&(1!=s.role&&2!=s.role||t.imageloadcomplete(s.role),t.refreshdraw())},this.getnumColors=function(){var e=s.imagectx.getImageData(0,0,s.imagecnv.width,s.imagecnv.height);s.numcolors=function(e){for(var t=1,a={r:e[0],g:e[1],b:e[2]},i={r:e[0],g:e[1],b:e[2]},r=0;r<e.length;r+=4)(i={r:e[r],g:e[r+1],b:e[r+2]}).r==a.r&&i.g==a.g&&i.b==a.b||(t++,a.r=i.r,a.g=i.g,a.b=i.b);return t}(e)},this.invert=function(e){if(s.imageloaded&&s.invertible){var t=s.imagectx.getImageData(0,0,s.imagecnv.width,s.imagecnv.height);!function(e){for(var t=0;t<e.length;t+=4){var a=255==e[t]&&255==e[t+1]&&255==e[t+2];(0==e[t]&&0==e[t+1]&&0==e[t+2]||a)&&(e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2])}}(t.data),s.imagectx.putImageData(t,0,0)}},this.countColors=function(e){},this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1,u=s.getRectangle(a,i,r,n,o,l);return e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0),h},this.getArea=function(){var e=s.x1,t=s.y1,a=s.x2,i=s.y2;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x1-i)*e,l=(n-s.y1)*e,c=(s.x2-i)*e,h=(n-s.y2)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.findsnapPoint=function(e,t,a,i,r,s,n,o){return{found:!1,x:0,y:0,type:1}},this.highlight=function(e,t,a,i,r,n,o){var l=s.getRectangle(t,a,i,r,n,o);e.strokeRect(l.x,l.y,l.w,l.h)},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=(s.x1-r)*t,p=(o-s.y1)*t,g=(s.x2-r)*t,m=(o-s.y2)*t;if(0!=l&&0!=c&&Bs){var f=(p+=i)-(m+=i),y=(g+=a)-(d+=a);if(d=hl(d),m=hl(m),(!s.parent.backgroundrender||u)&&!h){var v=Na,b=Aa;if(u&&(v=be.width,b=be.height),d<0&&g<0)return;if(p<0&&m<0)return;if(d>v&&g>v)return;if(p>b&&m>b)return}s.imageloaded&&(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(s.imagecnv,d,m,y,f),e.imageSmoothingEnabled=!1,this.bdrawn=!0)}},this.Close=function(){},e.useref){if(e.addcache)var l=uo(Bs.FileNameSRC)+e.image;else l=e.image;vn(l).then((function(e){o(e)}))}else o(e.image)}}function gl(e,t,a,i,r,s,n,o,l,c,h,u){var d=(e.x1-s)*a,p=(o-e.y1)*a,g=(e.x2-s)*a,m=(o-e.y2)*a;if(0!=l&&0!=c&&Bs&&(d+=i,p+=r,g+=i,m+=r,!(Fn(Math.max(d,g)-Math.min(d,g),Math.max(p,m)-Math.min(p,m))<.5))){if((!e.parent.backgroundrender||u)&&!h){var f=Na,y=Aa;if(u&&(f=be.width,y=be.height),d<0&&g<0)return;if(p<0&&m<0)return;if(d>f&&g>f)return;if(p>y&&m>y)return}t.lineCap="round",t.strokeStyle=e.getlineColor(h),t.lineWidth=e.getlinewidth(a,h),d=hl(d),p=hl(p),g=hl(g),m=hl(m),t.beginPath(),t.moveTo(d,p),t.lineTo(g,m),t.stroke(),e.drawcompare=!1}}class ml{constructor(e,t,a,i,r){var s=this;this.parent=t,this.index=r,this.type="line",this.blockname=a,this.blockstate=1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.entityType=e.entityType,this.role=e.role,this.hasArea=!1,this.selected=!1,this.linewidth=e.linewidth,this.originallinewidth=e.linewidth,this.mouseon=!1;var n=e.linewidth;this.linewidth=0==n?1:n,this.layerstate=e.layerstate,this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2;var o=!1;this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x1-i)*e,l=(n-s.y1)*e,c=(s.x2-i)*e,h=(n-s.y2)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.findInterSections=function(e){return an(this.x1,this.y1,this.x2,this.y2,e.x1,e.y1,e.x2,e.y2)},this.getInterSection=function(e,t,a,i,r,n,o,l,c){var h=(s.x1-o)*i,u=(c-s.y1)*i,d=(s.x2-o)*i,p=(c-s.y2)*i;h+=r,u+=n,d+=r,p+=n;var g=(a.x1-o)*i,m=(c-a.y1)*i,f=(a.x2-o)*i,y=(c-a.y2)*i,v=an(h,u,d,p,g+=r,m+=n,f+=r,y+=n);return!!(v&&v.x>e-10&&v.x<e+10&&v.y>t-10&&v.y<t+10)&&v},this.iswithin=function(e,t,a,i,r,n,o,l,c){return s.closeToMouse(e,t,a,i,r,n,o,l)},this.closeToMouse=function(e,t,a,i,r,n,o,l){var c=!1,h=(s.x1-n)*a,u=(l-s.y1)*a,d=(s.x2-n)*a,p=(l-s.y2)*a;return Wn({x:e,y:t},{x:h+=i,y:u+=r},{x:d+=i,y:p+=r})<5&&(c=!0),c},this.getArea=function(){var e=s.x1,t=s.y1,a=s.x2,i=s.y2;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return 0},this.findsnapPoint=function(e,t,a,i,r,n,o,l){var c=(s.x1-n)*a,h=(l-s.y1)*a,u=(s.x2-n)*a,d=(l-s.y2)*a,p=10,g=.5*((c+=i)+(u+=i)),m=.5*((h+=r)+(d+=r));return c>e-p&&c<e+p&&h>t-p&&h<t+p?{found:!0,x:c,y:h,type:1}:u>e-p&&u<e+p&&d>t-p&&d<t+p?{found:!0,x:u,y:d,type:1}:g>e-p&&g<e+p&&m>t-p&&m<t+p?{found:!0,x:g,y:m,type:3}:{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth*e<1?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),o&&(a=Ji),a},this.getlineColor=function(e){var t=s.stroketempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor):s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),e&&"#FFFFFF"==s.stroketempcolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?t=s.parent.backgroundColor:2==s.role&&(t=s.parent.overlayColor)),o&&(t=Zi),t},this.highlight=function(e,t,a,i,r,n,l){o=!0,s.drawme(e,t,a,i,r,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=(s.x1-r)*t,p=(o-s.y1)*t,g=(s.x2-r)*t,m=(o-s.y2)*t;if(0!=l&&0!=c&&Bs){if(d+=a,p+=i,g+=a,m+=i,!s.parent.backgroundrender||u){var f=Na,y=Aa;if(u&&(f=be.width,y=be.height),d<0&&g<0)return;if(p<0&&m<0)return;if(d>f&&g>f)return;if(p>y&&m>y)return}e.lineCap="round",e.strokeStyle=s.getlineColor(h),e.lineWidth=s.getlinewidth(t,h),e.beginPath(),e.moveTo(d,p),e.lineTo(g,m),e.stroke(),s.drawcompare=!1}},this.Close=function(){}}}class fl{constructor(e,t,a,i,r){var s=this;this.type="linesArray",this.parent=t,this.index=r,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.linesarray=e.lines,this.x=0,this.y=0,this.w=0,this.h=0;var o=!1;this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.closeToMouse=function(e,t,a,i,r,n,o,l){var c=s.getRectangle(a,i,r,n,o,l),h=!1;return Wn({x:e,y:t},{x:c.x,y:c.y},{x:c.x+c.w,y:c.y+c.h})<5&&(h=!0),h},this.findrectangle=function(){for(var e=Math.min(s.linesarray[0].x1,s.linesarray[0].x2),t=Math.min(s.linesarray[0].y1,s.linesarray[0].y2),a=e,i=t,r=1;r<s.linesarray.length;r++){var n=Math.min(s.linesarray[r].x1,s.linesarray[r].x2),o=Math.min(s.linesarray[r].y1,s.linesarray[r].y2);n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}this.x=e,this.y=t,this.w=a,this.h=i},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1;if(0==s.entityType.type)h=s.closeToMouse(e,t,a,i,r,n,o,l);else if(17==s.entityType.type){var u=s.getRectangle(a,i,r,n,o,l);e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0)}return h},this.getArea=function(){var e=s.x,t=s.y,a=s.w,i=s.h;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x-i)*e,l=(n-s.y)*e,c=(s.w-i)*e,h=(n-s.h)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.findsnapPoint=function(e,t,a,i,r,s,n,o){return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth*e<1?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),o&&(a=Ji),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor,s.filltempcolor=s.fillcolor,a=s.filltempcolor):(s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),this.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor))),e&&"#FFFFFF"==s.strokecolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),e&&"#FFFFFF"==s.fillcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?(t=s.parent.backgroundColor,a=s.parent.backgroundColor):2==s.role&&(t=s.parent.overlayColor,a=s.parent.overlayColor)),o&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,r,n,l){o=!0,s.drawme(e,t,a,i,r,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=0,p=0,g=0,m=0;if(0!=l&&0!=c&&Bs){s.render=!0;var f=(s.x-r)*t,y=(o-s.y)*t,v=(s.w-r)*t,b=(o-s.h)*t;if(f+=a,v+=a,y+=i,b+=i,Fn(Math.max(f,v)-Math.min(f,v),Math.max(y,b)-Math.min(y,b))<20)s.render=!1;else{if((!s.parent.backgroundrender||u)&&!h){var x=Na,w=Aa;if(u&&(x=be.width,w=be.height),f<0&&v<0||y<0&&b<0)return void(s.render=!1);if(f>x&&v>x||y>w&&b>w)return void(s.render=!1)}var k=s.getdrawColors(h);e.fillStyle=k.fillcolor,e.strokeStyle=k.linecolor,e.lineWidth=s.getlinewidth(t,h),e.beginPath();for(var D=0;D<s.linesarray.length;D++)d=(s.linesarray[D].x1-r)*t,p=(o-s.linesarray[D].y1)*t,g=(s.linesarray[D].x2-r)*t,m=(o-s.linesarray[D].y2)*t,d+=a,p+=i,g+=a,m+=i,e.moveTo(d,p),e.lineTo(g,m);e.stroke(),s.drawcompare=!1}}},this.Close=function(){},this.findrectangle()}}class yl{constructor(e,t,a,i,r){var s=this;this.type="dotArray",this.parent=t,this.index=r,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.dotarray=e.dots,this.r=this.linewidth,this.x=0,this.y=0,this.w=0,this.h=0;var o=!1;this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.closeToMouse=function(e,t,a,i,r,n,o,l){var c=s.getRectangle(a,i,r,n,o,l),h=!1;return Wn({x:e,y:t},{x:c.x,y:c.y},{x:c.x+c.w,y:c.y+c.h})<5&&(h=!0),h},this.findrectangle=function(){for(var e=s.dotarray[0].x,t=s.dotarray[0].y,a=s.dotarray[0].x,i=s.dotarray[0].y,r=2;r<s.dotarray.length;r++){var n=s.dotarray[r].x,o=s.dotarray[r].y;n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}this.x=e,this.y=t,this.w=a,this.h=i},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1;if(0==s.entityType.type)h=s.closeToMouse(e,t,a,i,r,n,o,l);else if(17==s.entityType.type){var u=s.getRectangle(a,i,r,n,o,l);e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0)}return h},this.getArea=function(){var e=s.x,t=s.y,a=s.w,i=s.h;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x-i)*e,l=(n-s.y)*e,c=(s.w-i)*e,h=(n-s.h)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.findsnapPoint=function(e,t,a,i,r,s,n,o){return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth*e<1?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor,s.filltempcolor=s.fillcolor,a=s.filltempcolor):(s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),this.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor))),e&&"#FFFFFF"==s.strokecolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),e&&"#FFFFFF"==s.fillcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?(t=s.parent.backgroundColor,a=s.parent.backgroundColor):2==s.role&&(t=s.parent.overlayColor,a=s.parent.overlayColor)),o&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,r,n,l){o=!0,s.drawme(e,t,a,i,r,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){s.dotarray[0].x,s.dotarray[0].y;var d=0,p=0;if(0!=l&&0!=c&&Bs){s.render=!0;var g=(s.x-r)*t,m=(o-s.y)*t,f=(s.w-r)*t,y=(o-s.h)*t;if(g+=a,f+=a,m+=i,y+=i,Fn(Math.max(g,f)-Math.min(g,f),Math.max(m,y)-Math.min(m,y))<20)s.render=!1;else if(0!=l&&0!=c&&Bs){if((!s.parent.backgroundrender||u)&&!h){var v=Na,b=Aa;if(u&&(v=be.width,b=be.height),g<0&&f<0||m<0&&y<0)return void(s.render=!1);if(g>v&&f>v||m>b&&y>b)return void(s.render=!1)}var x=s.getdrawColors(h),w=s.getlinewidth(t,h);e.fillStyle=x.fillcolor,e.strokeStyle=x.linecolor,e.lineWidth=w;for(var k=0;k<s.dotarray.length;k++)d=(s.dotarray[k].x-r)*t,p=(o-s.dotarray[k].y)*t,d+=a,p+=i,e.beginPath(),e.arc(d,p,w,0,2*Math.PI,!1),e.fill(),e.stroke();s.drawcompare=!1}}},this.Close=function(){},this.findrectangle()}}class vl{constructor(e,t,a,i,r){var s=this;this.type="circle",this.parent=t,this.index=r,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.hasArea=!0,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.filled=e.filled,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor,this.mouseon=!1;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.cx=e.cx,this.cy=e.cy,this.r=e.cr;var o=!1;this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1,u=s.getRectangle(a,i,r,n,o,l);return e>u.x&&e<u.x+u.w&&t>u.y&&t<u.y+u.h&&(h=!0),h},this.getRectangle=function(e,t,a,i,r,n){var o=(s.cx-i)*e,l=(n-s.cy)*e,c=s.r*e,h=o-c,u=l-c,d=o+c,p=l+c;if((h+=t)>(d+=t)){var g=h;h=d,d=g}if((u+=a)>(p+=a)){var m=u;u=p,p=m}return{found:!0,x:h,y:u,w:d-h,h:p-u,wp:(d-h)/10,hp:(p-u)/10}},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.findsnapPoint=function(e,t,a,i,r,s,n,o){var l=(this.cx-s)*a,c=(o-this.cy)*a;return c+=r,(l+=i)>e-10&&l<e+10?c>t-10&&c<t+10?{found:!0,x:l,y:c,type:1}:void 0:{found:!1,x:0,y:0,type:1}},this.getArea=function(){return s.r*s.r*Math.PI},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth*e<1?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),o&&(a=Ji),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor,s.filltempcolor=s.fillcolor,a=s.filltempcolor):(s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),this.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor))),e&&"#FFFFFF"==s.strokecolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),e&&"#FFFFFF"==s.fillcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000",a="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF",a="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?(t=s.parent.backgroundColor,a=s.parent.backgroundColor):2==s.role&&(t=s.parent.overlayColor,a=s.parent.overlayColor)),o&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,r,n,l){o=!0,s.drawme(e,t,a,i,r,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,a,i,r,n,o,l,c,h,u,d){var p=(s.cx-n)*a,g=(l-s.cy)*a,m=s.r*a;if(0!=c&&0!=h&&Bs){if(p+=i,g+=r,(!s.parent.backgroundrender||d)&&!u){var f=Na,y=Aa;if(d&&(f=be.width,y=be.height),p<0&&p+m<0)return;if(g<0&&g+m<0)return;if(p>f&&p-m>f)return;if(g>y&&g-m>y)return}var v=s.getdrawColors(u);if(e.fillStyle=v.fillcolor,e.strokeStyle=v.linecolor,e.lineCap="round",e.lineWidth=s.getlinewidth(a,u),e.beginPath(),e.arc(p,g,m,0,2*Math.PI,!1),1==this.filled){if(s.drawcompare)e.fillStyle=s.comparecolor;else if(t.blocklist[s.blockname].overridecolor)e.fillStyle=t.blocklist[s.blockname].color;else if(s.selected){var b=this.getRectangle(a,i,r,n,o,l),x=b.x,w=b.y,k=rext.w+b.x,D=rext.h+b.y,C=e.createLinearGradient(k,w,x,D);C.addColorStop(0,t.selectColor),C.addColorStop(.5,t.gradientStop),C.addColorStop(1,t.selectColor),e.fillStyle=C}else e.fillStyle=s.filltempcolor;e.fill()}e.stroke(),s.drawcompare=!1}},this.Close=function(){}}}class bl{constructor(e,t,a,i,r){var s=this;this.type="arc",this.parent=t,this.index=r,this.blockname=a,this.blockstate=1,this.entityType=e.entityType,this.role=e.role,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.selected=!1,this.mouseon=!1,this.hasArea=!1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.clockwise=e.clockwise,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.drawcompare=!1,this.comparecolor=this.fillcolor;var n=e.linewidth;0==n?(this.linewidth=1,this.originallinewidth=1):(this.linewidth=n,this.originallinewidth=n),this.cx=e.ax,this.cy=e.ay,this.r=e.ar,this.sa=e.asa,this.ea=e.aea,this.fullcircle=2*Math.PI;var o=!1;this.insidePolygon=function(e,t,a,i,r,s,n,o){return!1},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h=!1;return s.getdisttoArc(e,t,a,i,r,n,o,l)<10&&(h=!0),h},this.getArea=function(){var e=s.cx,t=s.cy,a=s.r,i=e-a,r=t-a,n=e+a,o=t+a;if(i>n){var l=i;i=n,n=l}if(r>o){var c=r;r=o,o=c}return{area:(n-i)*(o-r),x:i,y:r,w:n-i,h:o-r,wp:(n-i)/10,hp:(o-r)/10}},this.getdisttoArc=function(e,t,a,i,r,n,o,l){var c=(s.cx-n)*a,h=(l-s.cy)*a,u=s.r*a;c+=i,h+=r;let d=s.ea-s.sa;return zn(e,t,c,h,u,s.sa,d)},this.getcenterandradius=function(e,t,a,i,r,n){var o=(s.cx-i)*e,l=(n-s.cy)*e;return{x:o+=t,y:l+=a,r:s.r*e}},this.getRectangle=function(e,t,a,i,r,n){var o=(s.cx-i)*e,l=(n-s.cy)*e,c=s.r*e,h=o-c,u=l-c,d=o+c,p=l+c;if((h+=t)>(d+=t)){var g=h;h=d,d=g}if((u+=a)>(p+=a)){var m=u;u=p,p=m}return{found:!0,x:h,y:u,w:d-h,h:p-u,wp:(d-h)/10,hp:(p-u)/10}},this.toggleselect=function(){var e=!s.selected;s.selected=e},this.findsnapPoint=function(e,t,a,i,r,s,n,o){var l=(this.cx-s)*a,c=(o-this.cy)*a;return c+=r,(l+=i)>e-10&&l<e+10?c>t-10&&c<t+10?{found:!0,x:l,y:c,type:1}:void 0:{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth*e<1?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),o&&(a=Ji),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor),yi?(s.stroketempcolor=s.strokecolor,s.filltempcolor=s.fillcolor,t=s.stroketempcolor,a=s.filltempcolor):(s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor)),this.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor))),e&&"#FFFFFF"==s.strokecolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor,a=s.filltempcolor),e&&"#FFFFFF"==s.fillcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(t="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(t="#FFFFFF")):t=s.stroketempcolor,0==s.parent.comparemode&&(1==s.role?(a=s.parent.backgroundColor,t=s.parent.backgroundColor):2==s.role&&(a=s.parent.overlayColor,t=s.parent.overlayColor)),o&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.highlight=function(e,t,a,i,r,n,l){o=!0,s.drawme(e,t,a,i,r,n,l,1,1,!1,!1),o=!1},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=(s.cx-r)*t,p=(o-s.cy)*t,g=s.r*t;if(0!=l&&0!=c&&Bs){if(d+=a,p+=i,(!s.parent.backgroundrender||u)&&!h){var m=Na,f=Aa;if(u&&(m=be.width,f=be.height),d<0&&d+g<0)return;if(p<0&&p+g<0)return;if(d>m&&d-g>m)return;if(p>f&&p-g>f)return}var y=s.getdrawColors(h);e.fillStyle=y.fillcolor,e.strokeStyle=y.linecolor,e.lineCap="round",e.lineWidth=s.getlinewidth(t,h),e.beginPath(),e.arc(d,p,g,s.fullcircle-s.sa,s.fullcircle-s.ea,s.clockwise),e.stroke(),s.drawcompare=!1}},this.Close=function(){}}}class xl{constructor(e,t,a,i,r){var s=this;this.type="subpath",this.precision=i,this.parentpath=t,this.blockname=t.blockname,this.blockstate=t.blockstate,this.layer=t.layer,this.layerstate=t.layerstate,this.drawmode=t.drawmode,this.strokecolor=t.strokecolor,this.fillcolor=t.fillcolor,this.stroketempcolor=t.strokecolor,this.filltempcolor=t.fillcolor,this.filled=t.filled,this.selected=!1,this.pen=t.pen,this.penarrindex=t.penarrindex,this.linewidth=t.linewidth,this.originallinewidth=t.originallinewidth,this.linestyle=t.linestyle,this.role=t.role,this.svgpathstr="",0==s.precision?this.points=new Float32Array(e.length):1==s.precision&&(this.points=new Float64Array(e.length));var n=e.length;this.last=a;for(var o=0;o<n;)this.points[o]=e[o],o++;this.findsnapPoint=function(e,t,a,i,r,s,n,o){var l=(this.points[0]-s)*a,c=(o-this.points[1])*a,h=0,u=0;c+=r;var d=10;if((l+=i)>e-d&&l<e+d&&c>t-d&&c<t+d)return{found:!0,x:l,y:c,type:1};for(var p=2;p<this.points.length;p+=2)if(h=(this.points[p]-s)*a,u=(o-this.points[p+1])*a,u+=r,(h+=i)>e-d&&h<e+d&&u>t-d&&u<t+d)return{found:!0,x:h,y:u,type:1};return{found:!1,x:0,y:0,type:1}},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parentpath.parent.applypentable&&s.parent.pentable.changed?(null!=s.parentpath.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parentpath.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth||(a=1),s.linewidth*e<1&&0==s.filled?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parentpath.parent.applypentable&&s.parentpath.parent.pentable.changed?s.parentpath.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parentpath.parent.applypentable&&(a=Oa),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return 0==s.filled&&(s.parentpath.parent.applypentable&&s.parent.pentable.changed?null!=s.parentpath.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parentpath.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor)),yi?(s.stroketempcolor=s.strokecolor,s.filltempcolor=s.fillcolor,t=s.stroketempcolor,a=s.filltempcolor):s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",s.filltempcolor="#000000",t=s.stroketempcolor,a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",s.filltempcolor="#FFFFFF",t=s.stroketempcolor,a=s.filltempcolor)),e&&"#FFFFFF"==s.stroketempcolor&&(s.stroketempcolor="#000000",s.filltempcolor="#000000",t=s.stroketempcolor,a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parentpath.viewmode?("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",t="#000000",a="#000000"),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",t="#FFFFFF",a="#FFFFFF")):t=s.stroketempcolor,0==s.parentpath.parent.comparemode&&(1==s.role?(t=s.parentpath.parent.backgroundColor,a=s.parentpath.parent.backgroundColor):2==s.role&&(t=s.parentpath.parent.overlayColor,a=s.parentpath.parent.overlayColor)),{linecolor:t,fillcolor:a}},this.drawme=function(e,t,a,i,r,n,o,l,c,h,u){var d=(s.points[0]-r)*t,p=(o-s.points[1])*t,g=0,m=0;if(0!=l&&0!=c&&Bs&&(d+=a,p+=i,s.parentpath.render)){e.lineWidth=s.getlinewidth(t,h),d=hl(d),p=hl(p),e.moveTo(d,p);for(var f=2;f<this.points.length;f+=2)g=(s.points[f]-r)*t,m=(o-s.points[f+1])*t,m+=i,g=hl(g+=a),m=hl(m),e.lineTo(g,m);e.closePath(),this.drawcompare=!1}},this.Close=function(){this.points=null}}}class wl{constructor(e,t,a,i,r){var s=this;if(this.type="path",this.precision=e.precision,this.parent=t,this.index=r,this.x=0,this.y=0,this.w=0,this.h=0,this.centroid={x:0,y:0},this.render=!0,this.selected=!1,this.hasArea=!0,this.Area=void 0,this.svgpathstr="",this.drawcompare=!1,this.comparecolor=this.fillcolor,this.shape=e.shape,this.blockname=a,this.blockstate=1,this.closed=!1,this.layer=e.layer,this.layerstate=1,this.drawmode=e.drawmode,this.entityType=e.entityType,this.pen=e.pen,this.penarrindex=t.pentable.getPenArrindex(this.pen),this.role=e.role,this.overridefill=!1,this.drawoverride=!1,this.strokecolor=e.strokecolor,this.fillcolor=e.fillcolor,this.stroketempcolor=e.strokecolor,this.filltempcolor=e.fillcolor,this.filled=e.filled,this.gotsubpath=e.gotsubpath,this.subpaths=[],this.linestyle=0,this.mouseover=!1,this.mouseon=!1,this.linewidth=e.linewidth,this.originallinewidth=e.linewidth,0==this.linewidth&&(this.linewidth=1,this.originallinewidth=1),e.gotsubpath){this.gotsubpath=!0,0==this.precision?this.points=new Float32Array(e.numpoints):1==this.precision&&(this.points=new Float64Array(e.numpoints));for(var n=0,o=e.numpoints,l=e.points[0];n<o;)this.points[n]=l[n],n++;for(var c=e.points.length,h=1,u=!1;h<c;)l=e.points[h],h==c-1&&(u=!0),h++,this.subpaths.push(new xl(l,s,u,s.precision,!0))}else for(0==this.precision?this.points=new Float32Array(e.numpoints):1==this.precision&&(this.points=new Float64Array(e.numpoints)),n=0,o=e.numpoints;n<o;)this.points[n]=e.points[n],n++;2==this.shape&&this.points[0]==this.points[this.points.length-2]&&this.points[1]==this.points[this.points.length-1]&&(this.closed=!0);var d=!1;this.mouseoff=function(){s.mouseover=!1},this.toggleselect=function(){var e=!s.selected;s.selected=e;for(var t=0;t<s.subpaths.length;t++)s.subpaths[t].selected=e},this.unselect=function(){s.selected=!1;for(var e=0;e<s.subpaths.length;e++)s.subpaths[e].selected=!1},this.select=function(){s.selected=!0;for(var e=0;e<s.subpaths.length;e++)s.subpaths[e].selected=!0},this.findcentroid=function(){for(var e=[],t=0,a=0;a<this.points.length;a+=2)e[t]={x:this.points[a],y:this.points[a+1]},t++;if(this.gotsubpath)for(var i=0;i<s.subpaths.length;i++)for(a=0;a<s.subpaths[i].points.length;a+=2)e[t]={x:s.subpaths[i].points[a],y:s.subpaths[i].points[a+1]},t++;s.centroid=Hn(e)},this.getcentroid=function(e,t,a,i,r,n){0==s.centroid.x&&0==s.centroid.y&&s.findcentroid();var o=(s.centroid.x-i)*e,l=(n-s.centroid.y)*e;return{x:o+=t,y:l+=a}},this.findrectangle=function(){for(var e=this.points[0],t=this.points[1],a=this.points[0],i=this.points[1],r=2;r<this.points.length;r+=2){var n=this.points[r],o=this.points[r+1];n<e&&(e=n),o<t&&(t=o),n>a&&(a=n),o>i&&(i=o)}if(this.gotsubpath)for(var l=0;l<s.subpaths.length;l++)for(r=0;r<s.subpaths[l].points.length;r+=2)(n=s.subpaths[l].points[r])<e&&(e=n),(o=s.subpaths[l].points[r+1])<t&&(t=o),n>a&&(a=n),o>i&&(i=o);this.x=e,this.y=t,this.w=a,this.h=i},this.getblockPath=function(){return s},this.getblockPathPoints=function(){return s.points},this.getRectangle=function(e,t,a,i,r,n){var o=(s.x-i)*e,l=(n-s.y)*e,c=(s.w-i)*e,h=(n-s.h)*e;if((o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}},this.getpath=function(e,t,a,i,r,n,o,l){return s.insidePolygon(e,t,a,i,r,n,o,l)?s:null},this.getpathPoints=function(e,t,a,i,r,n,o,l){return s.insidePolygon(e,t,a,i,r,n,o,l)?s.points:[]},this.iswithin=function(e,t,a,i,r,n,o,l,c){var h={x:e,y:t},u=(s.x-n)*a,d=(l-s.y)*a,p=(s.w-n)*a,g=(l-s.h)*a;if((u+=i)>(p+=i)){var m=u;u=p,p=m}if((d+=r)>(g+=r)){var f=d;d=g,g=f}return!(u<0&&p<0||d<0&&g<0)&&(!(u>Na&&p>Na||d>Aa&&g>Aa)&&(!(h.x<u||h.x>p||h.y<d||h.y>g)&&Xn(a,i,r,n,0,l,s,h,{x:u-(p-u)/100,y:g-(g-d)/2})))},this.insidePolygon=function(e,t,a,i,r,n,o,l,c){var h=3==s.shape||6==s.shape||23==s.shape||26==s.shape,u=2==s.shape&&s.closed;if(s.shape,!h&&!u)return s.unselect(),!1;var d={x:e,y:t},p=(s.x-n)*a,g=(l-s.y)*a,m=(s.w-n)*a,f=(l-s.h)*a;if((p+=i)>(m+=i)){var y=p;p=m,m=y}if((g+=r)>(f+=r)){var v=g;g=f,f=v}return d.x<p||d.x>m||d.y<g||d.y>f?(s.parent.multiselect||c||s.unselect(),!1):Xn(a,i,r,n,0,l,s,d,{x:p-(m-p)/100,y:f-(f-g)/2})?(s.mouseon(),!0):(s.parent.multiselect||c||s.unselect(),s.mouseoff(),!1)},this.findsnapPoint=function(e,t,a,i,r,s,n,o){var l=(this.points[0]-s)*a,c=(o-this.points[1])*a,h=0,u=0;c+=r;var d=10;if((l+=i)>e-d&&l<e+d&&c>t-d&&c<t+d)return{found:!0,x:l,y:c,type:1};for(var p=2;p<this.points.length;p+=2)if(h=(this.points[p]-s)*a,u=(o-this.points[p+1])*a,u+=r,(h+=i)>e-d&&h<e+d&&u>t-d&&u<t+d)return{found:!0,x:h,y:u,type:1};return{found:!1,x:0,y:0,type:1}},this.getArea=function(){if(null==s.Area){var e=[],t=s.points[0]-s.parent.x,a=s.parent.h-s.points[1];e.push({x:t,y:a});for(var i=0,r=0,n=2;n<s.points.length;n+=2)i=s.points[n]-s.parent.x,r=s.parent.h-s.points[n+1],e.push({x:i,y:r});var o=qn(e),l=[];if(s.gotsubpath)for(var c=0;c<s.subpaths.length;c++){for(n=0;n<s.subpaths[c].points.length;n+=2)i=s.subpaths[c].points[n]-s.parent.x,r=s.parent.h-s.subpaths[c].points[n+1],l.push({x:i,y:r});var h=qn(l);h>o&&(e=l.slice(),l=[],o=h)}s.Area=o}return s.Area},this.setoverridepathlist=function(e){e&&(s.overridefill?s.parent.adddrawfirstlist(s):s.parent.removedrawfirstlist(s))},this.checkoverrideChange=function(e){var t=!1;return e&&(t=!1,e.overridefill||e.overridecolor?s.overridefill?t=!1:(s.overridefill=!0,t=!0):s.overridefill?(s.overridefill=!1,t=!0):t=!1),t},this.getlinewidth=function(e,t){var a=s.linewidth;return s.parent.applypentable&&s.parent.pentable.changed?(null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.linewidth=s.parent.pentable.getPendirect(s.penarrindex).getwidth()),a=s.linewidth):(s.linewidth=s.originallinewidth,a=s.linewidth),s.linewidth||(s.linewidth=1,a=1),s.linewidth*e<1&&0==s.filled?(a=s.parent.pentable.getscaled()?1:s.linewidth,t&&(a=4)):(a=s.parent.applypentable&&s.parent.pentable.changed?s.parent.pentable.getscaled()?s.linewidth*e:s.linewidth:s.linewidth*e,t&&(a=4)),ja&&!s.parent.applypentable&&(a=Oa),d&&(a=Ji),a},this.getdrawColors=function(e){var t=s.stroketempcolor,a=s.filltempcolor;return 0==s.filled&&(s.parent.applypentable&&s.parent.pentable.changed?null!=s.parent.pentable.getPendirect(s.penarrindex)&&(s.stroketempcolor=s.parent.pentable.getPendirect(s.penarrindex).getcolor(),t=s.stroketempcolor):(s.stroketempcolor=s.strokecolor,t=s.stroketempcolor)),yi?(s.stroketempcolor=s.strokecolor,s.filltempcolor=s.fillcolor,t=s.stroketempcolor,a=s.filltempcolor):(s.filltempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",a=s.filltempcolor),"#000000"==Bs.backgroundColor&&(s.filltempcolor="#FFFFFF",a=s.filltempcolor)),s.stroketempcolor==Bs.backgroundColor&&("#FFFFFF"==Bs.backgroundColor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),"#000000"==Bs.backgroundColor&&(s.stroketempcolor="#FFFFFF",t=s.stroketempcolor))),e&&"#FFFFFF"==s.stroketempcolor&&(s.stroketempcolor="#000000",t=s.stroketempcolor),e&&"#FFFFFF"==s.filltempcolor&&(s.filltempcolor="#000000",a=s.filltempcolor),s.drawcompare?t=s.comparecolor:1==s.parent.viewmode?("#FFFFFF"==Bs.backgroundColor&&(s.filltempcolor="#000000",t="#000000",a="#000000"),"#000000"!=Bs.backgroundColor&&"#A0A0A0"!=Bs.backgroundColor||(s.filltempcolor="#FFFFFF",t="#FFFFFF",a="#FFFFFF")):(0==s.parent.viewmode&&(s.filltempcolor=s.fillcolor,a=s.filltempcolor),t=s.stroketempcolor),0==s.parent.comparemode&&(1==s.role?(t=s.parent.backgroundColor,a=s.parent.backgroundColor):2==s.role&&(t=s.parent.overlayColor,a=s.parent.overlayColor)),d&&(a=Zi,t=Zi),{linecolor:t,fillcolor:a}},this.drawmefirst=function(e,t,a,i,r,n,o,l,c,h,u){s.drawoverride=!0,s.drawme(e,t,a,i,r,n,o,l,c,h,u),s.drawoverride=!1},this.highlight=function(e,t,a,i,r,n,o){d=!0,s.drawme(e,t,a,i,r,n,o,1,1,!1,!1),d=!1},this.drawme=function(e,a,i,r,n,o,l,c,h,u,d){var p=(s.points[0]-n)*a,g=(l-s.points[1])*a,m=0,f=0;if(0!=c&&0!=h&&Bs){var y=s.checkoverrideChange(t.blocklist[s.blockname]);if(s.setoverridepathlist(y),!s.overridefill||s.drawoverride){p+=i,g+=r,s.render=!0;var v=(s.x-n)*a,b=(l-s.y)*a,x=(s.w-n)*a,w=(l-s.h)*a;if(v+=i,x+=i,b+=r,w+=r,Fn(Math.max(v,x)-Math.min(v,x),Math.max(b,w)-Math.min(b,w))<.5)s.render=!1;else{if((!s.parent.backgroundrender||d)&&!u){var k=Na,D=Aa;if(d&&(k=be.width,D=be.height),v<0&&x<0||b<0&&w<0)return void(s.render=!1);if(v>k&&x>k||b>D&&w>D)return void(s.render=!1)}var C=s.getdrawColors(u);e.fillStyle=C.fillcolor,e.strokeStyle=C.linecolor,e.lineWidth=s.getlinewidth(a,u),e.beginPath(),p=hl(p),g=hl(g),e.moveTo(p,g);for(var P=2;P<this.points.length;P+=2)m=(s.points[P]-n)*a,f=(l-s.points[P+1])*a,f+=r,m=hl(m+=i),f=hl(f),e.lineTo(m,f);if(s.gotsubpath)for(var S=0;S<s.subpaths.length;S++)s.subpaths[S].drawme(e,a,i,r,n,o,l,c,h,u,!1);else{var R=!1,M=!1;if(null!=t.blocklist[s.blockname]&&(R=t.blocklist[s.blockname].overridecolor,M=t.blocklist[s.blockname].overridefill),1==s.filled||s.selected||R||M){if(e.lineWidth=1,e.closePath(),s.drawcompare)e.fillStyle=s.comparecolor;else if(s.selected){var T=e.createLinearGradient(x,b,v,w);T.addColorStop(0,t.selectColor),T.addColorStop(.5,t.gradientStop),T.addColorStop(1,t.selectColor),e.fillStyle=T}else if(null!=t.blocklist[s.blockname])if(t.blocklist[s.blockname].overridecolor)e.fillStyle=t.blocklist[s.blockname].color;else if(t.blocklist[s.blockname].overridefill&&null!=t.blocklist[s.blockname].fillstyle){if(3==t.blocklist[s.blockname].fillstyle&&null!=t.blocklist[s.blockname].hatchstyle){var E=io(e,t.blocklist[s.blockname].hatchstyle);null!=E&&(e.fillStyle=E)}}else e.fillStyle=s.filltempcolor;0==s.parent.comparemode&&(1==s.role?e.fillStyle=s.parent.backgroundColor:2==s.role&&(e.fillStyle=s.parent.overlayColor))}e.lineCap="round",e.lineJoin="round",s.filled}1==s.filled&&e.fill(),e.stroke(),s.drawcompare=!1}}}},this.Close=function(){if(s.gotsubpath)for(;0!=s.subpaths.length;)s.subpaths.pop();s.points=null},this.findrectangle()}}class kl{pens=[];curindex=0;constructor(){this.pens=[]}unit=1;scaled=!0;changed=!1;setunit(e){this.unit=e}setscaled(e){this.scaled=e}getscaled(){return this.scaled}getunit(){return this.unit}add(e){this.pens.push(e),this.curindex=this.pens.length-1}getcurIndex(){return this.pens.length}setcurIndex(e){for(var t=0;t<this.pens.length;t++)if(this.pens[t].penindex==e){this.curindex=t;break}}exists(e){for(var t=!1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=!0;break}return t}existSetcurrent(e){for(var t=!1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=!0,this.curindex=a;break}return t}getPen(e){for(var t=void 0,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=this.pens[a];break}return t}getPenArrindex(e){for(var t=-1,a=0;a<this.pens.length;a++)if(this.pens[a].penindex==e){t=this.pens[a].getarrindex();break}return t}getPendirect(e){return this.pens[e]}getCurrentPen(){return this.pens[this.curindex]}}class Dl{penindex=0;arrayindex=0;originalcolor="#FFFFFF";color="#FFFFFF";originalstyle=0;style=0;penwidth=0;originalpenwidth=0;displaywidth=0;unitwidth=0;constructor(e){this.penindex=e}setOriginalwidth(e){this.penwidth=e,this.originalpenwidth=e}setdisplaywidth(e){this.displaywidth=e}setOriginalcolor(e){this.color=e,this.originalcolor=e}setOriginalStyle(e){this.style=e,this.originalstyle=e}resetwidth(){this.penwidth=this.originalpenwidth,this.displaywidth=this.penwidth}resetcolor(){this.color=this.originalcolor}resetstyle(){this.style=this.originalstyle}setcolor(e){this.color=e}getcolor(){return this.color}setwidth(e){this.penwidth=e}getwidth(){return this.penwidth}getdisplaywidth(){return this.displaywidth}setstyle(e){this.style=e}setarrayindex(e){this.arrayindex=e}setunitwidth(e){this.unitwidth=e}getarrindex(){return this.arrayindex}}class Cl{constructor(e){this.x1=parseFloat(e.x1),this.x2=parseFloat(e.x2),this.y1=parseFloat(e.y1),this.y2=parseFloat(e.y2),this.page=e.page,this.dx1=parseFloat(e.dx1),this.dx2=parseFloat(e.dx2),this.dy1=parseFloat(e.dy1),this.dy2=parseFloat(e.dy2),this.mouseover=!1,this.currentpage=0}onhyperlinkClick(e,t){}Getwithin(e,t,a,i,r,s){var n=!1;return e>a&&e<i&&t>r&&t<s&&(n=!0),n}drawhyperlink(e,t,a,i,r,s,n){var o=(this.x1-r)*t,l=(n-this.y1)*t,c=(this.x2-r)*t,h=(n-this.y2)*t;if((o+=a)>(c+=a)){var u=o;o=c,c=u}if((l+=i)>(h+=i)){var d=l;l=h,h=d}e.strokeStyle="blue",e.lineWidth=2,e.strokeRect(o,l,c-o,h-l)}insideHyperlink(e,t,a,i,r,s,n,o,l,c){var h={x:e,y:t};this.currentpage=l;var u=(this.x1-s)*a,d=(o-this.y1)*a,p=(this.x2-s)*a,g=(o-this.y2)*a;if((u+=i)>(p+=i)){var m=u;u=p,p=m}if((d+=r)>(g+=r)){var f=d;d=g,g=f}if(h.x<u||h.x>p||h.y<d||h.y>g)return!1;if(this.Getwithin(h.x,h.y,u,p,d,g)){if(this.mouseon(),c)null!=Ae&&Ae.setMarkupHover(this,h.x,h.y);else if(null!=Be&&Be.markupLink(this),La){var y=parseInt(this.page)-1;y!=this.currentpage&&RxCore.gotoPage(y)}return!0}return this.mouseoff(),!1}mouseon(){this.mouseover=!0}mouseoff(){this.mouseover=!1}}class Pl{constructor(e,t){if(t){this.index=parseInt(e.getInt32(0,!0));var a=parseInt(e.getInt32(4,!0));this.color=En(a);var i=parseInt(e.getInt32(8,!0));this.state=i,this.isplottable=parseInt(e.getInt32(12,!0)),this.defaultstate=i;for(var r=e.getUint16(16,!0),s=0==r?" ":String.fromCharCode(r),n=18;n<=128;)s+=0==(r=e.getUint16(n,!0))?" ":String.fromCharCode(r),n+=2;this.name=s}else this.index=e.index,this.color=e.color,this.state=e.state,this.isplottable=!0,this.defaultstate=e.state,this.name=e.name;this.turnLayerOnOff=function(e){}}}class Sl{constructor(e,t,a,i,r){var s=this;this.index=e,this.name=t,this.state=a,this.defaultstate=a,this.defaultcolor=i,this.color=i,this.fillstyle=null,this.defaultfillstyle=null,this.overridecolor=!1,this.overridefill=!1,this.hatchstyle=null,this.selected=!1,this.listed=r,this.insert=void 0,this.drawn=!1,this.mouseon=!1,this.iswithin=function(e,t,a,i,r,n,o,l){var c=!1;if(null!=s.insert){var h=s.getRectangle(a,i,r,n,o,l);e>h.x&&e<h.x+h.w&&t>h.y&&t<h.y+h.h&&(c=!0)}return c},this.getArea=function(){if(null!=s.insert){var e=s.insert.MinX,t=s.insert.MinY,a=s.insert.MaxX,i=s.insert.MaxY;if(e>a){var r=e;e=a,a=r}if(t>i){var n=t;t=i,i=n}return(a-e)*(i-t)}return 0},this.select=function(){s.selected?s.selected=!1:s.selected=!0},this.unselect=function(){s.selected=!1},this.highlight=function(e,t,a,i,r,n,o){if(null!=s.insert){var l=s.getRectangle(t,a,i,r,n,o);e.save(),e.lineWidth=2,e.fillStyle="rgba(255,0,0,0.5)",e.fillRect(l.x,l.y,l.w,l.h),e.restore(),s.drawn=!0}},this.getRectangle=function(e,t,a,i,r,n){var o=0,l=0,c=0,h=0;if(null!=s.insert){if(o=(s.insert.MinX-i)*e,l=(n-s.insert.MinY)*e,c=(s.insert.MaxX-i)*e,h=(n-s.insert.MaxY)*e,(o+=t)>(c+=t)){var u=o;o=c,c=u}if((l+=a)>(h+=a)){var d=l;l=h,h=d}}return{found:!0,x:o,y:l,w:c-o,h:h-l,wp:(c-o)/10,hp:(h-l)/10}}}}class Rl{constructor(e){var t=this;this.document=e,this.optionalContentConfig=null,this.pdfDoc=null,this.initiate=function(e){console.log("pdfjs version",fe.version)},this.setfromreaddirect=function(e){t.pdfDoc=e,t.document.setPDFdocument(t.pdfDoc,!1)},this.openDocBinary=function(e){var a=fe.getDocument({data:e,cMapUrl:RxConfig.PDFcmap,cMapPacked:!0});a.onPassword=ou,a.promise.then((function(e){t.pdfDoc=e,t.document.setPDFdocument(t.pdfDoc,!0)}))},this.openDocument=function(e){if(null!=t.document.PDFPassword)var a=fe.getDocument({url:e,password:t.document.PDFPassword,cMapUrl:RxConfig.PDFcmap,cMapPacked:!0});else a=fe.getDocument({url:e,cMapUrl:RxConfig.PDFcmap,cMapPacked:!0});a.onPassword=ou,a.promise.then((function(e){t.pdfDoc=e,t.document.setPDFdocument(t.pdfDoc,!0)}))},this.getOptionalContentGroups=function(){t.pdfDoc.getOptionalContentConfig().then((function(e){t.document.setPDFContentGroups(e)}))}}}class Ml{constructor(e,t,a){var i,r,s,n,o,l,c=this,h=void 0,u=0,d=0,p=void 0,g=0,m=void 0,f=0,y=0,v=0,b=0,x=void 0,w=0,k="",D=void 0,C=0,P=void 0,S=P,R=-1,M=1,T=0,E=0,F=0,I={height:10,rotation:0,weight:100,italic:0,underline:0,name:"Arial"};this.role=0,this.x=0,this.y=0,this.w=0,this.h=0,this.scale=1,this.offsetx=0,this.offsety=0,this.numlayers=0,this.flag=-1,this.fileversion="",this.layerlist=[],this.penlist=[],this.bnameunique=!0,this.pathlist=[],this.numpaths=0,a&&(this.role=a.role),function(e,t,a){h=new DataView(t),String.fromCharCode(h.getUint8(0));for(var i=1;i<=15;)String.fromCharCode(h.getUint8(i)),i++;c.fileversion=parseInt(h.getInt32(16,!0)),c.flag=h.getInt32(20,!0);var r=52;if(0==c.flag?(c.x=h.getFloat32(24,!0),c.y=h.getFloat32(28,!0),c.w=h.getFloat32(32,!0),c.h=h.getFloat32(36,!0),c.scale=h.getFloat32(40,!0),c.offsetx=h.getFloat32(44,!0),c.offsety=h.getFloat32(48,!0),r=52):1==c.flag?(c.x=h.getFloat64(24,!0),c.y=h.getFloat64(32,!0),c.w=h.getFloat64(40,!0),c.h=h.getFloat64(48,!0),c.scale=h.getFloat64(56,!0),c.offsetx=h.getFloat64(64,!0),c.offsety=h.getFloat64(72,!0),r=80):console.log("no flag in binary file"),e.setdim(c,a),c.numlayers=parseInt(h.getInt32(r,!0)),u=144,d=r+4,c.numlayers,0!=c.numlayers){for(p=new DataView(t,d,u),g=0;g<c.numlayers;){var s=new Pl(p,!0);c.layerlist.push(s),g++,d+=u,g<c.numlayers&&(p=new DataView(t,d,u))}e.setlayers(c,a)}if(e.initpath(a),m=new DataView(t,d),f=0,32768!=parseInt(m.getInt32(0,!0))){for(y=parseInt(m.getInt32(4,!0)),v=parseInt(m.getInt32(8,!0)),c.bnameunique=1==v,b=parseInt(m.getInt32(12,!0)),x=new DataView(t,d+16,2*b),w=0,k=String.fromCharCode(x.getUint16(w,!0)),w+=2;w<2*b;)k+=String.fromCharCode(x.getUint16(w,!0)),w+=2;D=new DataView(t,d+16+2*b),e.updateblocks(new Sl(y,k,1,Yi),a),C=0,P=parseInt(D.getInt32(C,!0)),S=P,R=-1,M=1,T=0,E=0,F=0,I={height:10,rotation:0,weight:100,italic:0,underline:0,name:"Arial"}}}(e,t,c.role),i=c.role,l={objectid:P,prevobjectid:S,blockpart:f,maindvpos:C,dlayer:R,lstate:M,dpen:T,scolor:En(0),fcolor:En(0),lwidth:E,font:I,drawmode:13,transparency:1,role:i,entityType:{type:0,handleLow:0,handleHigh:0}},r=l,s=1e3,n=function(){l=function(t){switch(t.objectid){case 1:t.maindvpos+=4;var a=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var i=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var r=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var s=D.getFloat32(t.maindvpos,!0),n={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,x1:a,y1:i,x2:r,y2:s,entityType:t.entityType,role:t.role},o=new ml(n,e,t.blockpart,!0,c.numpaths);c.numpaths++,e.updatepathlist(o,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 2:t.maindvpos+=4,F=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0);var l=[];l.push(a),l.push(i);for(var h=1;h<F;)t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),h++;var u={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F,points:l,filled:0,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths);c.numpaths++,e.updatepathlist(d,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 3:for(t.maindvpos+=4,F=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<F;)t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,l.push(D.getFloat32(t.maindvpos,!0)),h++;u={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F,points:l,filled:1,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths),c.numpaths++,e.updatepathlist(d,t.role),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 13:t.maindvpos+=4;var p=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var g=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var m=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var f=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var y=D.getFloat32(t.maindvpos,!0),v={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,clockwise:y>0,ax:p,ay:g,ar:m,asa:f,aea:f+y,entityType:t.entityType,role:t.role},x=new bl(v,e,t.blockpart,!0,c.numpaths);e.updatepathlist(x,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 4:t.maindvpos+=4;var C=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var P=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var S=D.getFloat32(t.maindvpos,!0),R={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:C,cy:P,cr:S,filled:0,entityType:t.entityType,role:t.role},M=new vl(R,e,t.blockpart,!0,c.numpaths);e.updatepathlist(M,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 5:t.maindvpos+=4,C=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,P=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,S=D.getFloat32(t.maindvpos,!0),R={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:C,cy:P,cr:S,filled:1,entityType:t.entityType,role:t.role},M=new vl(R,e,t.blockpart,!0,c.numpaths),e.updatepathlist(M,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 6:var T=[],E=[],I=[];t.maindvpos+=4;for(var j=D.getInt32(t.maindvpos,!0),O=0;O<j;)t.maindvpos+=4,T.push(D.getInt32(t.maindvpos,!0)),O++;for(O=0;O<j;){for(var L=0;L<T[O];L++)t.maindvpos+=4,E.push(D.getFloat32(t.maindvpos,!0)),t.maindvpos+=4,E.push(D.getFloat32(t.maindvpos,!0));I.push(E),E=[],O++}u={precision:0,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*T[0],points:I,filled:1,gotsubpath:!0,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths),e.updatepathlist(d,t.role),c.numpaths++,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 7:t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,r=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,s=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4;var V=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;for(var N="",A=t.maindvpos;A<V+t.maindvpos;)N+=String.fromCharCode(D.getUint8(A)),A++;t.maindvpos=A;var B={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:r,y2:s,image:N,useref:!1,entityType:t.entityType,role:t.role},U=new pl(B,e,t.blockpart,!0,c.numpaths);e.updatepathlist(U,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 8:t.maindvpos+=4,a=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,i=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,r=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,s=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4;var G=D.getInt32(t.maindvpos,!0);for(t.maindvpos+=4,N="",A=t.maindvpos;A<G+t.maindvpos;)N+=String.fromCharCode(D.getUint8(A)),A++;t.maindvpos=A,B={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:r,y2:s,image:N,useref:!0,entityType:t.entityType,role:t.role},U=new pl(B,e,t.blockpart,!0,c.numpaths),e.updatepathlist(U,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 10:t.maindvpos+=4;var H=parseInt(D.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var z=t.maindvpos,W="";z<t.maindvpos+2*H;)W+=String.fromCharCode(D.getUint16(z,!0)),z+=2;t.maindvpos=z;var _=parseInt(D.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var X=t.maindvpos,Y="";X<t.maindvpos+2*_;)Y+=String.fromCharCode(D.getUint16(X,!0)),X+=2;t.maindvpos=X;var q={name:W,value:Y,blockref:t.blockpart};e.updateAttributes(q,t.role),t.prevobjectid=t.objectid,t.objectid=parseInt(D.getInt32(t.maindvpos,!0));break;case 11:t.maindvpos+=4;var Z=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var J=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var K=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Q=D.getFloat32(t.maindvpos,!0);if(t.maindvpos+=4,c.fileversion>=2){var $=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4}else $=0;var ee=D.getInt32(t.maindvpos,!0);ee*=2,t.maindvpos+=4;for(var te=t.maindvpos,ae="";te<t.maindvpos+ee;)ae+=String.fromCharCode(D.getUint16(te,!0)),te+=2;t.maindvpos=te;var ie={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:Z,y1:J,x2:K,y2:Q,rot:$,text:ae,draw:!1};e.updatetextlist(ie,t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 12:t.maindvpos+=4;var re=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var se=D.getFloat32(t.maindvpos,!0);for(t.maindvpos+=4,ee=D.getInt32(t.maindvpos,!0),ee*=2,t.maindvpos+=4,te=t.maindvpos,ae="";te<t.maindvpos+ee;)ae+=String.fromCharCode(D.getUint16(te,!0)),te+=2;t.maindvpos=te;var ne={strokecolor:t.scolor,fillcolor:t.fcolor,layer:t.dlayer,pen:t.dpen,drawmode:t.drawmode,layerstate:t.lstate,x1:re,y1:se,text:ae,entityType:t.entityType,role:t.role},oe=new ul(ne,e,t.font,t.blockpart,c.numpaths);e.updatepathlist(oe,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 14:t.maindvpos+=4;var le=D.getInt32(t.maindvpos,!0),ce=[];t.maindvpos+=4;for(var he=0;he<le;he++){var ue=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var de=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var pe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var ge=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4,ce.push({x1:ue,y1:de,x2:pe,y2:ge})}var me={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,lines:ce,entityType:t.entityType,role:t.role},fe=new fl(me,e,t.blockpart,!0,c.numpaths);e.updatepathlist(fe,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 15:t.maindvpos+=4,le=D.getInt32(t.maindvpos,!0);var ye=[];for(t.maindvpos+=4,he=0;he<le;he++){var ve=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var be=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4,ye.push({x:ve,y:be})}var xe={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,dots:ye,entityType:t.entityType,role:t.role},we=new yl(xe,e,t.blockpart,!0,c.numpaths);e.updatepathlist(we,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 16:t.maindvpos+=4;var ke=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var De=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Ce=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Pe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Se=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Re=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Me=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Te=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ee=D.getFloat32(t.maindvpos,!0);if(t.maindvpos+=4,c.fileversion>=5){var Fe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ie=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var je=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Oe=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4}else Fe=0,Ie=0,je=0,Oe=0;var Le={blockhandleLow:ke,blockhandleHigh:De,insertX:Ce,insertY:Pe,insertZ:Se,insertRot:Re,insertscaleX:Me,insertscaleY:Te,insertscaleZ:Ee,blockref:t.blockpart,MinX:Fe,MinY:Ie,MaxX:je,MaxY:Oe,type:"float"};e.updateBlockInsert(t.blockid,Le),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 21:t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),n={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,x1:a,y1:i,x2:r,y2:s,entityType:t.entityType,role:t.role},o=new ml(n,e,t.blockpart,!0,c.numpaths),e.updatepathlist(o,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 22:for(t.maindvpos+=4,F=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<F;)t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),h++;u={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F,points:l,filled:0,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths),e.updatepathlist(d,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 23:for(t.maindvpos+=4,F=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),(l=[]).push(a),l.push(i),h=1;h<F;)t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,l.push(D.getFloat64(t.maindvpos,!0)),h++;u={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*F,points:l,filled:1,gotsubpath:!1,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths),e.updatepathlist(d,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 24:t.maindvpos+=4,C=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,P=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,S=D.getFloat64(t.maindvpos,!0),R={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:C,cy:P,cr:S,filled:0,entityType:t.entityType,role:t.role},M=new vl(R,e,t.blockpart,!0,c.numpaths),e.updatepathlist(M,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 34:t.maindvpos+=4,p=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,g=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,m=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,f=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,y=D.getFloat64(t.maindvpos,!0),v={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,clockwise:y>0,ax:p,ay:g,ar:m,asa:f,aea:f+y,entityType:t.entityType,role:t.role},x=new bl(v,e,t.blockpart,!0,c.numpaths),e.updatepathlist(x,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 25:t.maindvpos+=4,C=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,P=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,S=D.getFloat64(t.maindvpos,!0),R={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,cx:C,cy:P,cr:S,filled:1,entityType:t.entityType,role:t.role},M=new vl(R,e,t.blockpart,!0,c.numpaths),e.updatepathlist(M,t.role),c.numpaths++,t.maindvpos+=8,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 26:for(T=[],E=[],I=[],t.maindvpos+=4,j=D.getInt32(t.maindvpos,!0),O=0;O<j;)t.maindvpos+=4,T.push(D.getInt32(t.maindvpos,!0)),O++;for(t.maindvpos+=4,O=0;O<j;){for(L=0;L<T[O];L++)E.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8,E.push(D.getFloat64(t.maindvpos,!0)),t.maindvpos+=8;I.push(E),E=[],O++}u={precision:1,layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,numpoints:2*T[0],points:I,filled:1,gotsubpath:!0,shape:t.objectid,entityType:t.entityType,role:t.role},d=new wl(u,e,t.blockpart,!0,c.numpaths),e.updatepathlist(d,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 27:for(t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,V=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,N="",A=t.maindvpos;A<V+t.maindvpos;)N+=String.fromCharCode(D.getUint8(A)),A++;t.maindvpos=A,B={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:r,y2:s,image:N,useref:!1,entityType:t.entityType,role:t.role},U=new pl(B,e,t.blockpart,!0,c.numpaths),e.updatepathlist(U,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 28:for(t.maindvpos+=4,a=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,i=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,r=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,s=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,G=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,N="",A=t.maindvpos;A<G+t.maindvpos;)N+=String.fromCharCode(D.getUint8(A)),A++;t.maindvpos=A,B={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:a,y1:i,x2:r,y2:s,image:N,useref:!0,entityType:t.entityType,role:t.role},U=new pl(B,e,t.blockpart,!0,c.numpaths),e.updatepathlist(U,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 31:for(t.maindvpos+=4,Z=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,J=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,K=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Q=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,c.fileversion>=2?($=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8):$=0,ee=D.getInt32(t.maindvpos,!0),ee*=2,t.maindvpos+=4,te=t.maindvpos,ae="";te<t.maindvpos+ee;)ae+=String.fromCharCode(D.getUint16(te,!0)),te+=2;t.maindvpos=te,ie={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,x1:Z,y1:J,x2:K,y2:Q,rot:$,text:ae,draw:!1},e.updatetextlist(ie,t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 32:for(t.maindvpos+=4,re=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,se=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ee=D.getInt32(t.maindvpos,!0),ee*=2,t.maindvpos+=4,te=t.maindvpos,ae="";te<t.maindvpos+ee;)ae+=String.fromCharCode(D.getUint16(te,!0)),te+=2;t.maindvpos=te,ne={strokecolor:t.scolor,fillcolor:t.fcolor,layer:t.dlayer,pen:t.dpen,drawmode:t.drawmode,layerstate:t.lstate,x1:re,y1:se,text:ae,entityType:t.entityType,role:t.role},oe=new ul(ne,e,t.font,t.blockpart,c.numpaths),e.updatepathlist(oe,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 35:for(t.maindvpos+=4,le=D.getInt32(t.maindvpos,!0),ce=[],t.maindvpos+=4,he=0;he<le;he++)ue=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,de=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,pe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ge=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ce.push({x1:ue,y1:de,x2:pe,y2:ge});me={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,lines:ce,entityType:t.entityType,role:t.role},fe=new fl(me,e,t.blockpart,!0,c.numpaths),e.updatepathlist(fe,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 36:for(t.maindvpos+=4,le=D.getInt32(t.maindvpos,!0),ye=[],t.maindvpos+=4,he=0;he<le;he++)ve=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,be=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,ye.push({x:ve,y:be});xe={layer:t.dlayer,drawmode:t.drawmode,layerstate:t.lstate,pen:t.dpen,strokecolor:t.scolor,fillcolor:t.fcolor,linewidth:t.lwidth,dots:ye,entityType:t.entityType,role:t.role},we=new yl(xe,e,t.blockpart,!0,c.numpaths),e.updatepathlist(we,t.role),c.numpaths++,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 37:t.maindvpos+=4,ke=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,De=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,Ce=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Pe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Se=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Re=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Me=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Te=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Ee=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,c.fileversion>=5?(Fe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Ie=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,je=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8,Oe=D.getFloat64(t.maindvpos,!0),t.maindvpos+=8):(Fe=0,Ie=0,je=0,Oe=0),Le={blockhandleLow:ke,blockhandleHigh:De,insertX:Ce,insertY:Pe,insertZ:Se,insertRot:Re,insertscaleX:Me,insertscaleY:Te,insertscaleZ:Ee,blockref:t.blockpart,MinX:Fe,MinY:Ie,MaxX:je,MaxY:Oe,type:"dobule"},e.updateBlockInsert(t.blockid,Le),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 64:t.maindvpos+=4;var Ve=D.getInt32(t.maindvpos,!0);t.scolor=En(Ve),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 65:t.maindvpos+=4;var Ne=D.getInt32(t.maindvpos,!0);t.fcolor=En(Ne),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 66:t.maindvpos+=4,t.lwidth=D.getFloat32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 67:t.maindvpos+=4,D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 68:t.maindvpos+=4,t.dlayer=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 69:t.maindvpos+=4,t.dpen=D.getInt32(t.maindvpos,!0),e.pentable.existSetcurrent(t.dpen)?(e.pentable.getCurrentPen().setOriginalwidth(t.lwidth),e.pentable.getCurrentPen().setdisplaywidth(t.lwidth),e.pentable.getCurrentPen().setOriginalcolor(t.scolor)):t.dpen>=0&&(e.pentable.add(new Dl(t.dpen,e.pentable.getcurIndex())),e.pentable.getCurrentPen().setOriginalwidth(t.lwidth),e.pentable.getCurrentPen().setdisplaywidth(t.lwidth),e.pentable.getCurrentPen().setOriginalcolor(t.scolor)),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 70:t.maindvpos+=4,D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 71:case 72:t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 73:t.maindvpos+=4;var Ae=D.getInt32(t.maindvpos,!0);t.drawmode=Ae,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 76:t.maindvpos+=4;var Be=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ue=D.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var Ge=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var He=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var ze=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var We=D.getInt32(t.maindvpos,!0);We*=2,t.maindvpos+=4;for(var _e=t.maindvpos,Xe="";_e<t.maindvpos+We;)0!=D.getUint16(_e,!0)&&(Xe+=String.fromCharCode(D.getUint16(_e,!0))),_e+=2;t.maindvpos=_e,t.font={height:Be,rotation:Ue,weight:Ge,italic:He,underline:ze,name:Xe},t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 77:t.maindvpos+=4;var Ye=D.getFloat32(t.maindvpos,!0);t.transparency=Ye,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 78:t.maindvpos+=4;var qe=D.getInt32(t.maindvpos,!0);t.maindvpos+=4;var Ze=D.getInt32(t.maindvpos,!0);t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 79:t.maindvpos+=4;var Je=D.getInt32(t.maindvpos,!0);t.maindvpos+=4,qe=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,Ze=D.getInt32(t.maindvpos,!0),t.maindvpos+=4,t.entityType={type:Je,handleLow:qe,handleHigh:Ze},t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 12288:t.objectid=12288,t.maindvpos+=4,t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 4096:t.objectid=4096,t.blockpart++,t.maindvpos+=4,t.blockid=parseInt(D.getInt32(t.maindvpos,!0)),t.maindvpos+=4;var Ke=parseInt(D.getInt32(t.maindvpos,!0));for(c.bnameunique=1==Ke,t.maindvpos+=4,b=parseInt(D.getInt32(t.maindvpos,!0)),t.maindvpos+=4,w=t.maindvpos,k="";w<t.maindvpos+2*b;)k+=String.fromCharCode(D.getUint16(w,!0)),w+=2;t.maindvpos=w;var Qe=!1;if(c.bnameunique){var $e=e.getblocklistlength(t.role,k,t.blockpart);Qe=$e.bexist,t.blockpart=$e.count}Qe||128==Ke||e.updateblocks(new Sl(t.blockid,k,1,t.fcolor),t.role),t.prevobjectid=t.objectid,t.objectid=D.getInt32(t.maindvpos,!0);break;case 32768:t.objectid=32768;break;default:console.log("default"),e.invalid=!0,console.log(t.objectid),console.log(t.prevobjectid),console.log(t.maindvpos),t.objectid=32768}return t}(l)},o=function(){!function(t){e.readbinarycomplete(t)}(l.role)},function e(){for(var t=0;t<s&&(n.call(null,r),32768!=r.objectid);++t);32768!=r.objectid?setTimeout(e,0):o.call(null)}(),function e(){D&&32768!=l.objectid&&setTimeout(e,10)}()}}class Tl{constructor(e,t,i,r){var s=this;this.parent=e,this.firstdraw=!1,this.firstdrawcompare=!1,this.offscreen=document.createElement("canvas"),this.offscreenctx=this.offscreen.getContext("2d"),this.offscreenprint=document.createElement("canvas"),this.offscreenprintctx=this.offscreenprint.getContext("2d"),this.thumboffscreen=document.createElement("canvas"),this.thumboffscreenctx=this.offscreen.getContext("2d"),this.renderinprogress=!1,this.backgroundrender=!0,this.docompare=!1,this.dooverlay=!1,this.bcompare=e.DocRef.bcompare,this.comparemode=e.OverlayComparemode,this.isbackground=!1,this.comparecolor="red",this.novectors=!1,this.bgimage=!1,this.ovimage=!1,this.layerlist=[],this.pentable=new kl;var o=s.parent.Unitofmeasure;this.pentable.setunit(o),this.pentable.setscaled(!0),this.layerlistbg=[],this.layerlistfg=[],this.vectorpagetime=0,this.textlayerset=!1,this.blocklist=[],this.filterblocklist=[],this.filterAttributelist=[],this.blocklistbg=[],this.filterblocklistbg=[],this.filterAttributelistbg=[],this.blocklistfg=[],this.filterblocklistfg=[],this.filterAttributelistfg=[],this.numblocks=-1,this.bnameunique=!1,this.selectedobject=void 0,this.selectColor="rgba(191,58,209,0.6)",this.gradientStop="rgba(255,255,255,0.3)",this.viewmode=0,this.applypentable=!1,this.multiselect=!1,this.selectedblocks=[],this.fileversion="",this.flag=-1,this.compare=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.width=0,this.height=0,this.scale=1,this.offsetx=0,this.offsety=0,this.numlayers=0,this.overlayscale=1,this.overlayoffsetx=0,this.overlayoffsety=0,this.nudgeScalefactor=0,this.overlayrotation=0,this.fgdrawangle=0,this.bnudgeangleused=!1,this.nOffsetX=0,this.nOffsetY=0,this.backupoverlayscale=1,this.backupoverlayoffsetx=0,this.backupoverlayoffsety=0,this.backupoverlayrotation=0,this.blocklistovoffset=0,this.layerlistovoffset=0,this.pathlist=[],this.pathlistoverride=[],this.textlist=[],this.attributes=[],this.intersections=[],this.pathlistbg=[],this.pathlistoverridebg=[],this.textlistbg=[],this.attributesbg=[],this.intersectionsbg=[],this.pathlistfg=[],this.pathlistoverridefg=[],this.textlistfg=[],this.attributesfg=[],this.intersectionsfg=[],this.numpaths=0,this.vectorloader=void 0,this.addvectorloader=void 0,this.bgDocObjref=void 0,this.fgDocObjref=void 0,this.bgpageindex=void 0,this.fgpageindex=void 0,this.cmprimagestoload=0,this.cmprvctrsrctoload=0;var l,c=[];if(r){this.backgroundColor=r.bgColor,this.overlayColor=r.fgColor,this.bgpageindex=s.parent.comparebgpageindex,this.fgpageindex=s.parent.comparefgpageindex;for(var h=0;h<Xs.length;h++)Xs[h].fileindex==s.parent.comparebgdocindex&&(this.bgDocObjref=Xs[h],this.bgDocObjref.setComparelink=new Mh(this.parent.DocRef.bgFileClosed)),Xs[h].fileindex==s.parent.comparefgdocindex&&(this.fgDocObjref=Xs[h],this.fgDocObjref.setComparelink=new Mh(this.parent.DocRef.fgFileClosed));s.parent.loadbackgroundimage&&(this.cmprimagestoload+=1),s.parent.loadoverlayimage&&(this.cmprimagestoload+=1),s.parent.loadbackgroundpdf&&(this.cmprimagestoload+=1),s.parent.loadoverlaypdf&&(this.cmprimagestoload+=1),s.parent.loadbackgroundvectors&&(this.cmprvctrsrctoload+=1),s.parent.loadoverlayvectors&&(this.cmprvctrsrctoload+=1)}function u(e,t){var a={index:0,color:e.bgColor,state:1,name:"backgroundlayer"},i={index:1,color:e.fgColor,state:1,name:"overlaylayer"},r=0;return t?(s.layerlist.push(new Pl(a,!1)),r=0):(s.layerlist.push(new Pl(i,!1)),r=1),r}function d(e,t){var a=0;return t?(s.blocklist.push(new Sl(0,"backgroundblock",1,e.bgColor,!0)),a=0):(s.blocklist.push(new Sl(1,"overlayblock",1,e.fgColor,!0)),a=1),a}function p(e){var t=!0;return s.blocklist.length>0&&null!=s.blocklist[s.pathlist[e].blockname]&&(2==s.pathlist[e].role?null!=s.blocklist[s.pathlist[e].blockname+s.blocklistovoffset]&&(t=1==s.blocklist[s.pathlist[e].blockname+s.blocklistovoffset].state):t=1==s.blocklist[s.pathlist[e].blockname].state),t}function g(e){var t=!0;return s.layerlist.length>0&&-1!=s.pathlist[e].layer&&null!=s.layerlist[s.pathlist[e].layer]&&(2==s.pathlist[e].role?null!=s.layerlist[s.pathlist[e].layer+s.layerlistovoffset]&&(t=1==s.layerlist[s.pathlist[e].layer+s.layerlistovoffset].state):t=1==s.layerlist[s.pathlist[e].layer].state),t}function m(e){for(var t=-1,a=0;a<s.blocklist.length;a++)if(s.blocklist[a].index==e){t=a;break}return t}function f(e){for(var t=void 0,a=0;a<s.blocklist.length;a++)if(s.blocklist[a].index==e){t=s.blocklist[a];break}return t}function y(e){for(var t=[],a=0;a<s.attributes.length;a++)s.attributes[a].blockref==e&&t.push(s.attributes[a]);return t}function v(e){var t="no type";switch(e){case 0:t="LINE";break;case 1:t="LWPOLYLINE";break;case 2:t="POLYLINE";break;case 3:t="SOLID";break;case 4:t="ARC";break;case 5:t="CIRCLE";break;case 6:t="TEXT";break;case 7:t="DIMENSION";break;case 8:t="MTEXT";break;case 9:t="VERTEX";break;case 10:t="ELLIPSE";break;case 11:t="POINT";break;case 12:t="3DFACE";break;case 13:t="3DSOLID";break;case 14:t="BODY";break;case 15:t="ATTDEF";break;case 16:t="ATTRIB";break;case 17:t="HATCH";break;case 18:t="IMAGE";break;case 19:t="INSERT";break;case 20:t="LEADER";break;case 21:t="MLINE";break;case 22:t="OLEFRAME";break;case 23:t="OLE2FRAME";break;case 24:t="RAY";break;case 25:t="REGION";break;case 26:t="SHAPE";break;case 27:t="SPLINE";break;case 28:t="TOLERANCE";break;case 29:t="TRACE";break;case 30:t="ACAD_PROXY_ENTITY";break;case 31:t="VIEWPORT";break;case 32:t="WIPEOUT";break;case 33:t="XLINE";break;default:t="other type"}return t}function b(e,t,a){e.save(),e.font=a;const i=e.measureText(t);return e.restore(),i.width}this.addpdfimage=function(e,t,a){var i=u(a,t),r=d(a,t),n=0;if(e={layer:i,drawmode:e.drawmode,layerstate:e.lstate,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,magnify:!1,useref:!0,addcache:!1,role:n},t){e.role=1,n=1,e.magnify=!0;var o=new dl(e,s,r,!0,s.pathlist.length);o.isbackground=!0,s.pathlistbg.unshift(o),e.magnify=!1,(o=new dl(e,s,r,!0,s.pathlist.length)).isbackground=!0,s.pathlistbg.unshift(o),s.bgimage=!0}else e.role=2,n=2,e.magnify=!0,(o=new dl(e,s,r,!0,s.pathlist.length)).isoverlay=!0,s.pathlistfg.push(o),e.magnify=!1,(o=new dl(e,s,r,!0,s.pathlist.length)).isoverlay=!0,s.pathlistfg.push(o),s.ovimage=!0;var l={x:e.x1,y:e.y1,w:e.x2,h:e.y2,scale:s.scale,offsetx:s.offsetx,offsety:s.offsety,fileversion:s.fileversion,flag:s.flag};s.novectors,s.pathlist=s.pathlistbg.concat(s.pathlistfg),s.setdim(l,n)},this.addimage=function(e,t,a){var i,r=u(a,t),n=d(a,t),o=0;e={layer:r,drawmode:e.drawmode,layerstate:e.lstate,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,image:e.imagestr,useref:!0,addcache:!1,role:o},t?(e.role=1,o=1,(i=new pl(e,s,n,!0,s.pathlist.length)).isbackground=!0,s.pathlistbg.unshift(i),s.bgimage=!0):(e.role=2,o=2,(i=new pl(e,s,n,!0,s.pathlist.length)).isoverlay=!0,s.pathlistfg.push(i),s.ovimage=!0);var l={x:e.x1,y:e.y1,w:e.x2,h:e.y2,scale:s.scale,offsetx:s.offsetx,offsety:s.offsety,fileversion:s.fileversion,flag:s.flag};s.novectors,s.pathlist=s.pathlistbg.concat(s.pathlistfg),s.setdim(l,o)},this.initpath=function(e){switch(s.pathlistoverride=[],s.intersections=[],e){case 0:s.pathlist=[],s.textlist=[],s.attributes=[],s.numpaths=0;break;case 1:s.pathlistbg=[],s.textlistbg=[],s.attributesbg=[],s.numpathsbg=0;break;case 2:s.pathlistfg=[],s.textlistfg=[],s.attributesfg=[],s.numpathsfg=0}},this.getblocklistlength=function(e,t,a){var i=!1,r=0;if(0==e){for(r=0;r<s.blocklist.length;r++)if(t==s.blocklist[r].name){a=r,i=!0;break}}else if(1==e){for(r=0;r<s.blocklistbg.length;r++)if(t==s.blocklistbg[r].name){a=r,i=!0;break}}else if(2==e)for(r=0;r<s.blocklistfg.length;r++)if(t==s.blocklistfg[r].name){a=r,i=!0;break}return{bexist:i,count:a}},this.updateBlockInsert=function(e,t){for(var a=0;a<s.blocklist.length;a++)s.blocklist[a].index==e&&(s.blocklist[a].insert=t)},this.updateblocks=function(e,t){0==t?s.blocklist.push(e):1==t?s.blocklistbg.push(e):2==t&&s.blocklistfg.push(e)},this.updatepentTable=function(e){s.pentable.add(e)},this.getpenTable=function(){return s.pentable},this.setpentableUnit=function(e){s.pentable.setunit(e)},this.setpentableScaled=function(e){s.pentable.setscaled(e)},this.setPenwidth=function(e){var t=s.pentable.getPen(e.penindex),a=s.pentable.getscaled(),i=s.pentable.getunit(),r=parseFloat(t.getdisplaywidth());if(a){if(NaN!=r){var n=s.parent.fixedScale,o=s.getScreenDim(parseFloat(e.penwidth));o*=n,t.setwidth(o)}}else NaN!=r&&(1==i&&t.setwidth(r/25.4*96),2==i&&t.setwidth(96*r))},this.setPenTablepen=function(e){var t=s.pentable.getPen(e.penindex);if(t.setcolor(e.color),NaN!=parseFloat(e.penwidth)){var a=s.parent.fixedScale,i=s.getScreenDim(parseFloat(e.penwidth));i*=a,t.setwidth(i),t.setdisplaywidth(e.penwidth)}NaN!=parseInt(e.style)&&-1!=parseInt(e.style)&&t.setstyle(e.style)},this.resetPenTablepen=function(e){var t=s.pentable.getPen(e.penindex);t.resetcolor(),t.resetwidth(),t.resetstyle()},this.setpencolor=function(e,t){s.pentable.getPen(e).setcolor(t)},this.resetpencolor=function(e){s.pentable.getPen(e).resetcolor()},this.resetpenwidth=function(e){s.pentable.getPen(e).resetwidth()},this.updatepathlist=function(e,t){switch(t){case 0:s.pathlist.push(e),s.numpaths++;break;case 1:s.pathlistbg.push(e),s.numpathsbg++;break;case 2:s.pathlistfg.push(e),s.numpathsfg++}},this.setlayers=function(e,t){switch(t){case 0:s.layerlist=e.layerlist.slice(),s.numlayers=e.numlayers,null!=ut&&ut.setVectorLayers(s.layerlist);break;case 1:s.layerlistbg=e.layerlist.slice();break;case 2:s.layerlistovoffset=s.layerlistbg.length,s.layerlistfg=e.layerlist.slice(),s.layerlist=s.layerlistbg.concat(s.layerlistfg),null!=ut&&ut.setVectorLayers(s.layerlist)}},this.getScreenDim=function(e,t){var a=0,i=s.parent.DPI,r=s.parent.Unitofmeasure,n=i/25.4,o=i;e*=_r;var l=s.parent.getMeasureScale();if(null==l&&(l=Or),a=e/l*s.parent.OriginalScale,0!=i)switch(r){case 1:a*=n;break;case 2:a*=o}return a},this.setdim=function(e,t){if(0==t&&(s.x=e.x,s.y=e.y,s.w=e.w,s.h=e.h,s.scale=e.scale,s.offsetx=e.offsetx,s.offsety=e.offsety,s.fileversion=e.flag,s.flag=e.flag,s.width=s.w-s.x,s.height=s.h-s.y),2==t)if(s.parent.loadbackgroundvectors){var a=e.w-e.x,i=e.h-e.y;s.overlayscale=Math.min(s.width/a,s.height/i),s.backupoverlayscale=s.overlayscale,s.overlayoffsetx=e.x,s.overlayoffsety=e.h,s.backupoverlayoffsetx=s.overlayoffsetx,s.backupoverlayoffsety=s.overlayoffsety,s.overlayrotation=0,s.backupoverlayrotation=s.overlayrotation}else s.parent.loadoverlayvectors?(s.x=e.x,s.y=e.y,s.w=e.w,s.h=e.h,s.scale=e.scale,s.offsetx=e.offsetx,s.offsety=e.offsety,s.fileversion=e.flag,s.flag=e.flag,s.width=s.w-s.x,s.height=s.h-s.y,a=e.w-e.x,i=e.h-e.y,s.overlayscale=Math.min(a/s.width,i/s.height),s.backupoverlayscale=s.overlayscale,s.overlayrotation=0,s.backupoverlayrotation=s.overlayrotation):(a=e.w-e.x,i=e.h-e.y,s.overlayscale=Math.min(s.width/a,s.height/i),s.backupoverlayscale=s.overlayscale,s.overlayoffsetx=e.x,s.overlayoffsety=e.h,s.backupoverlayoffsetx=s.overlayoffsetx,s.backupoverlayoffsety=s.overlayoffsety,s.overlayrotation=0,s.backupoverlayrotation=s.overlayrotation);1==t&&(s.parent.loadoverlayvectors&&!s.parent.loadbackgroundvectors?(a=e.w-e.x,i=e.h-e.y,s.overlayscale=Math.min(s.width/a,s.height/i),s.backupoverlayscale=s.overlayscale,s.overlayoffsetx=e.x,s.overlayoffsety=e.h,s.backupoverlayoffsetx=s.overlayoffsetx,s.backupoverlayoffsety=s.overlayoffsety,s.overlayrotation=0,s.backupoverlayrotation=s.overlayrotation):(s.x=e.x,s.y=e.y,s.w=e.w,s.h=e.h,s.scale=e.scale,s.offsetx=e.offsetx,s.offsety=e.offsety,s.fileversion=e.flag,s.flag=e.flag,s.width=s.w-s.x,s.height=s.h-s.y,a=e.w-e.x,i=e.h-e.y,s.overlayscale=Math.min(a/s.width,i/s.height),s.backupoverlayscale=s.overlayscale,s.overlayrotation=0,s.backupoverlayrotation=s.overlayrotation))},this.updateAttributes=function(e,t){switch(t){case 0:s.attributes.push(e);break;case 1:s.attributesbg.push(e);break;case 2:s.attributesfg.push(e)}},this.updatetextlist=function(e,t){switch(t){case 0:s.textlist.unshift(e);break;case 1:s.textlistbg.unshift(e);break;case 2:s.textlistfg.unshift(e)}},this.imageloadcomplete=function(e){s.parent.loadbackgroundimage&&1==e&&(s.setcompareColors(),s.parent.redraw(),s.cmprimagestoload>0&&(s.cmprimagestoload-=1)),s.parent.loadoverlayimage&&2==e&&(s.setcompareColors(),s.parent.redraw(),s.cmprimagestoload>0&&(s.cmprimagestoload-=1)),s.parent.loadbackgroundpdf&&1==e&&(s.parent.redraw(),s.cmprimagestoload>0&&(s.cmprimagestoload-=1)),s.parent.loadoverlaypdf&&2==e&&(s.parent.redraw(),s.cmprimagestoload>0&&(s.cmprimagestoload-=1));var t=0==s.cmprimagestoload,a=0==s.cmprvctrsrctoload;s.bcompare&&t&&a&&null!=Ue&&Ue.compareComplete(s.parent.DocRef.fileindex)},this.readbinarycomplete=function(e){s.pathlistoverride=[],s.intersections=[],0==e||(1==e||2==e)&&(s.blocklistovoffset=s.blocklistbg.length,s.blocklist=s.blocklistbg.concat(s.blocklistfg),s.pathlist=s.pathlistbg.concat(s.pathlistfg),s.textlist=s.textlistbg.concat(s.textlistfg),s.attributes=s.attributesbg.concat(s.attributesfg),s.cmprvctrsrctoload>0&&(s.cmprvctrsrctoload-=1)),s.filterblocklist=s.blocklist.filter((function(e){return e.listed})),s.filterAttributelist=s.attributes.slice(),null!=pt&&pt.setVectorBlocks(s.filterblocklist),null!=gt&&gt.setVectorBlocks(s.filterblocklist),s.docompare||(s.parent.redraw(),s.setcompareColors()),s.textlist.length>0?(null!=ba&&(ba.hastext=!0,s.parent.DocRef.hastext=!0,ba.hasText(s.parent.DocRef.hastext,s.parent.DocRef.bActive)),s.parent.DocRef.pages[s.parent.DocRef.currentpage]&&null!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].VectorPageObj&&s.parent.DocRef.pages[s.parent.DocRef.currentpage].settextdivs(!0)):null!=ba&&(ba.hastext=!1,s.parent.DocRef.hastext=!1,ba.hasText(s.parent.DocRef.hastext,s.parent.DocRef.bActive));var t=0==s.cmprimagestoload,a=0==s.cmprvctrsrctoload;if(s.bcompare&&t&&a&&null!=Ue&&Ue.compareComplete(s.parent.DocRef.fileindex),mr&&fr.length>0&&(null!=Se&&Se.setPentablelist(fr,s.parent.DocRef.bActive),null!=Re&&Re.setAutoPenLoad()),si){var i={iscompare:$a,numOpenFiles:Xs.length,isPDF:!1,is3D:!1,is2D:!0,numpages:parent.DocRef.pages.length,currentpage:parent.DocRef.getcurPage(),activefile:parent.DocRef.bActive,source:"vectorbinaryloadcomplete"};null!=Gt&&Gt.setGUIState(i);var r={numpages:parent.DocRef.pages.length,currentpage:parent.DocRef.getcurPage()};null!=Ht&&Ht.pageEvent(r),si=!1}},this.addvectors=function(e,t){t&&(s.addvectorloader=new Ml(s,e,t))},this.refreshdraw=function(){s.parent.redraw()},this.resetCompare=function(){s.overlayscale=s.backupoverlayscale,s.overlayoffsetx=s.backupoverlayoffsetx,s.overlayoffsety=s.backupoverlayoffsety,s.overlayrotation=s.backupoverlayrotation,s.nOffsetX=0,s.nOffsetY=0,s.refreshdraw()},this.setcomparescale=function(e){s.nudgeScale(2),s.resetCompare();var t=s.overlayscale,a=s.overlayoffsetx,i=s.overlayoffsety,r=s.overlayrotation,n=0;if(n=s.parent.loadbackgroundvectors?2:s.parent.loadoverlayvectors?1:2,2==e.length){if(1==n){if(t=e[1].scaleinfo.scaledDistance/e[0].scaleinfo.scaledDistance,a=e[1].offset.x/t-e[0].offset.x,i=e[1].offset.y/t-e[0].offset.y,r=e[0].angle-e[1].angle,s.overlayscale=t,a>0){s.overlayoffsetx=s.overlayoffsetx-a;var o=e[1].scaleinfo.pagedim.origw,l=e[0].scaleinfo.pagedim.origw*s.overlayscale+a*s.overlayscale}else s.x=s.x- -a*s.overlayscale,o=e[1].scaleinfo.pagedim.origw+-a*s.overlayscale,l=e[0].scaleinfo.pagedim.origw*s.overlayscale;if(i>0){s.overlayoffsety=s.overlayoffsety+i;var c=e[1].scaleinfo.pagedim.origh,h=e[0].scaleinfo.pagedim.origh*s.overlayscale+i*s.overlayscale}else s.h=s.h+-i*s.overlayscale,c=e[1].scaleinfo.pagedim.origh+-i*s.overlayscale,h=e[0].scaleinfo.pagedim.origh*s.overlayscale;if(s.overlayscale<1){var u=o-l;u=u>0?l+u:l}else s.overlayscale>1&&(u=(u=l-o)>0?o+u:o);if(s.overlayscale<1){var d=c-h;d=d>0?h+d:h}else s.overlayscale>1&&(d=(d=h-c)>0?c+d:c);u>s.width&&(s.width=u),d>s.height&&(s.height=d),s.overlayrotation=r}2==n&&(t=e[0].scaleinfo.scaledDistance/e[1].scaleinfo.scaledDistance,a=e[0].offset.x/t-e[1].offset.x,i=e[0].offset.y/t-e[1].offset.y,r=e[1].angle-e[0].angle,s.overlayscale=t,a>0?(s.overlayoffsetx=s.overlayoffsetx-a,o=e[0].scaleinfo.pagedim.origw,l=e[1].scaleinfo.pagedim.origw*s.overlayscale+a*s.overlayscale):(s.x=s.x- -a*s.overlayscale,o=e[0].scaleinfo.pagedim.origw+-a*s.overlayscale,l=e[1].scaleinfo.pagedim.origw*s.overlayscale),i>0?(s.overlayoffsety=s.overlayoffsety+i,c=e[0].scaleinfo.pagedim.origh,h=e[1].scaleinfo.pagedim.origh*s.overlayscale+i*s.overlayscale):(s.h=s.h+-i*s.overlayscale,c=e[0].scaleinfo.pagedim.origh+-i*s.overlayscale,h=e[1].scaleinfo.pagedim.origh*s.overlayscale),s.overlayscale<1?u=(u=l-o)>0?o+u:o:s.overlayscale>1&&(u=(u=o-l)>0?l+u:l),s.overlayscale<1?d=(d=h-c)>0?c+d:c:s.overlayscale>1&&(d=(d=c-h)>0?h+d:h),u>s.width&&(s.width=u),d>s.height&&(s.height=d),s.overlayrotation=r)}},this.nudgeRotate=function(e){e?s.fgdrawangle-=.001:s.fgdrawangle+=.001,s.bnudgeangleused=!0,s.refreshdraw()},this.nudgeScale=function(e){var t=s.overlayscale/5e3;switch(e){case 0:s.nudgeScalefactor+=t;break;case 1:s.nudgeScalefactor-=t;break;case 2:s.nudgeScalefactor=0}s.refreshdraw()},this.offsetdirect=function(e,t){s.nOffsetX=e,s.nOffsetY=t,s.refreshdraw()},this.nudgeoffset=function(e){if(null!=s.parent.fixedScale)var t=.1*s.parent.fixedScale;else t=.1;switch(e){case 0:s.nOffsetX+=t;break;case 1:s.nOffsetX-=t;break;case 2:s.nOffsetY-=t;break;case 3:s.nOffsetY+=t}s.refreshdraw()},this.scalecomparefinish=function(){iu(),Bh(s.parent.DocRef.fileindex),null!=De&&De.setActiveFile(s.parent.DocRef.fileindex)},this.alignpage=function(e){0==e&&(Bh(s.parent.comparebgdocindex),s.bgDocObjref.GotoPage(s.bgpageindex),s.bgDocObjref.pages[s.bgpageindex].enableSnap(!0),null!=De&&De.setActiveFile(s.parent.comparebgdocindex),null!=s.bgpageindex&&nd("getoverlayscale",{p1:s.bgDocObjref.pages[s.bgpageindex],p2:0})),1==e&&(Bh(s.parent.comparefgdocindex),s.fgDocObjref.GotoPage(s.fgpageindex),s.fgDocObjref.pages[s.fgpageindex].enableSnap(!0),null!=De&&De.setActiveFile(s.parent.comparefgdocindex),null!=s.fgpageindex&&nd("getoverlayscale",{p1:s.fgDocObjref.pages[s.fgpageindex],p2:1}))},this.scalecomparepage=function(e){var t=0;0==e.length?(s.resetCompare(),t=0,s.alignpage(t)):1==e.length?(t=1,s.alignpage(t)):2==e.length&&(s.setcomparescale(e),s.scalecomparefinish())},this.scalecompare=function(){s.resetCompare(),Bh(s.parent.comparebgdocindex),s.bgDocObjref.GotoPage(s.bgpageindex),s.bgDocObjref.pages[s.bgpageindex].enableSnap(!0),null!=sa&&sa.AlignComplete(0),nd("overlayscale",{p1:s})},this.setColors=function(e,t){s.backgroundColor=e,s.overlayColor=t,s.setcompareColors(),s.parent.redraw(),null!=aa&&aa.CompareDialog()},this.getColors=function(){return{bg:s.backgroundColor,fg:s.overlayColor}},this.getInterSections=function(){this.intersections=[];for(var e=0;e<this.pathlist.length;e++){var t=g(e),a=p(e);if(t&&a&&"line"==this.pathlist[e].type)for(var i=0;i<this.pathlist.length;i++)if(e!=i&&(t=g(i),a=p(i),t&&a&&"line"==this.pathlist[i].type)){var r=this.pathlist[i].findInterSections(this.pathlist[e]);r&&this.intersections.push(r)}}},this.getBlockswFill=function(){for(var e=[],t=0;t<s.blocklist.length;t++)(s.blocklist[t].overridecolor||s.blocklist[t].overridefill)&&e.push(s.blocklist[t]);return e},this.getBlocks=function(){return s.filterblocklist},this.getFilteredAttributes=function(){return s.filterAttributelist},this.restoreBlockStates=function(){for(var e=0;e<s.blocklist.length;e++)s.blocklist[e].overridecolor=!1,s.blocklist[e].color=s.blocklist[e].defaultcolor},this.setBlockColor=function(e,t,a){var i=m(e);s.blocklist[i].overridecolor=a,s.blocklist[i].color=a?t:s.blocklist[i].defaultcolor},this.adddrawfirstlist=function(e){s.pathlistoverride.push(e),s.parent.refresh_vectorPath(e)},this.removedrawfirstlist=function(e){for(var t=void 0,a=0;a<s.pathlistoverride.length;a++)e.index==s.pathlistoverride[a].index&&(t=a);null!=t&&s.pathlistoverride.splice(t,1),s.parent.refresh_vectorPath(e)},this.setBlockHatch=function(e,t,a){var i=m(e);s.blocklist[i].overridefill=a,a?(s.blocklist[i].fillstyle=3,s.blocklist[i].hatchstyle=t,eo(t,!0)):(s.blocklist[i].fillstyle=s.blocklist[i].defaultfillstyle,eo(t,!1))},this.hasAttribute=function(e,t){for(var a=m(e),i=!1,r=0;r<s.attributes.length;r++)if(s.attributes[r].name.toUpperCase()==t.toUpperCase()&&s.attributes[r].blockref==a){i=!0;break}return i},this.updateAttribute=function(e,t,a){for(var i=m(e),r=0;r<s.attributes.length;r++)if(s.attributes[r].name.toUpperCase()==t.toUpperCase()&&s.attributes[r].blockref==i){s.attributes[r].value=a;break}},this.appendCustomBlockAttribute=function(e,t,a){var i={name:t,value:a,blockref:m(e)};s.attributes.push(i)},this.deleteAttribute=function(e){for(var t=[],a=0;a<s.attributes.length;a++)s.attributes[a].name.toUpperCase()!=e.toUpperCase()&&t.push(s.attributes[a]);s.attributes=t.slice()},this.FindBlockByAttr=function(e,t){for(var a=-1,i=-1,r=0;r<s.attributes.length;r++)if(s.attributes[r].name.toUpperCase()==e.toUpperCase()&&s.attributes[r].value==t){a=s.attributes[r].blockref;break}return-1!=a&&(i=s.blocklist[a].index),i},this.ViewMode=function(e){s.viewmode=e},this.setPenTable=function(e){s.applypentable=e},this.getPenTableState=function(){return s.applypentable},this.unSelectAllBlockInserts=function(){for(var e=0;e<s.blocklist.length;e++)s.blocklist[e].unselect()},this.unSelectAllBlocks=function(e){for(var t=0;t<s.pathlist.length;t++)"path"==s.pathlist[t].type&&s.pathlist[t].unselect();e&&null!=Ct&&Ct.set2DBlockInfo([])},this.blockAttributes=function(e){return y(m(e))},this.selectBlockPath=function(e,t){for(var a=0;a<s.pathlist.length;a++){var i=g(a),r=p(a);i&&r&&s.pathlist[a].blockname==t&&"path"==s.pathlist[a].type&&(e?s.pathlist[a].select():s.pathlist[a].unselect())}},this.selectBlock=function(e){for(var t=[],a=m(e),i=0;i<s.pathlist.length;i++){var r=g(i),n=p(i);r&&n&&(s.pathlist[i].blockname==a?("path"==s.pathlist[i].type&&s.pathlist[i].toggleselect(),t=s.pathlist[i].selected?y(a):[]):"path"==s.pathlist[i].type&&s.pathlist[i].unselect())}null!=Dt&&Dt.set2DBlockID([s.blocklist[a].index]),null!=Ct&&Ct.set2DBlockInfo(t)},this.getblockcentroid=function(e,t,a,i){for(var r=m(e),n={},o=0;o<s.pathlist.length;o++){var l=g(o),c=p(o);if(l&&c&&s.pathlist[o].blockname==r){n=s.pathlist[o].getcentroid(t,a,i,s.x,s.y,s.h);break}}return n},this.getBlockRect=function(e,t,a,i){for(var r=m(e),n={found:!1,x:0,y:0,w:0,h:0,wp:0,hp:0},o=0;o<s.pathlist.length;o++){var l=g(o),c=p(o);if(l&&c&&s.pathlist[o].blockname==r){n=s.pathlist[o].getRectangle(t,a,i,s.x,s.y,s.h);break}}return n},this.getBlockInsertRect=function(e,t,a,i){m(e);for(var r={found:!1,x:0,y:0,w:0,h:0,wp:0,hp:0},n=0;n<s.blocklist.length;n++)if(s.blocklist[n].index==e){s.blocklist[n].state,s.blocklist[n]&&(r=s.blocklist[n].getRectangle(t,a,i,s.x,s.y,s.h));break}return r},this.setcompareColors=function(){for(var e=0;e<s.pathlist.length;e++){var t=g(e),a=p(e);t&&a&&"image"==s.pathlist[e].type&&(0==s.comparemode?(1==s.pathlist[e].role&&null!=s.pathlist[e].image&&s.pathlist[e].invert(s.backgroundColor),2==s.pathlist[e].role&&null!=s.pathlist[e].image&&s.pathlist[e].invert(s.overlayColor)):1==s.comparemode&&2==s.pathlist[e].role&&null!=s.pathlist[e].image&&s.pathlist[e].invert())}},this.setimageColor=function(e){for(var t=0;t<s.pathlist.length;t++){var a=g(t),i=p(t);a&&i&&"image"==s.pathlist[t].type&&s.pathlist[t].invert(e)}},this.getpathbyindex=function(e){var t=null,a=g(e),i=p(e);return a&&i&&(t=s.pathlist[e].getblockPath()),t},this.getpathbybId=function(e){for(var t=null,a=m(e),i=0;i<s.pathlist.length;i++){var r=g(i),n=p(i);if(r&&n&&s.pathlist[i].blockname==a){t=s.pathlist[i].getblockPath();break}}return t},this.getpathPointsBybId=function(e){for(var t=[],a=m(e),i=0;i<s.pathlist.length;i++){var r=g(i),n=p(i);if(r&&n&&s.pathlist[i].blockname==a){t=s.pathlist[i].getblockPathPoints();break}}return t},this.getpath=function(e,t,a,i,r){var n={x:e,y:t};0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].drotation&&(n=on(e,t)),e=n.x,t=n.y;for(var o=0;o<s.pathlist.length;o++){var l=g(o),c=p(o);if(l&&c&&s.pathlist[o].getpath&&"function"==typeof s.pathlist[o].getpath){var h=s.pathlist[o].getpath(e,t,a,i,r,s.x,s.y,s.h);if(null!=h)return h}}return null},this.getpathPoints=function(e,t,a,i,r){var n={x:e,y:t};0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].drotation&&(n=on(e,t)),e=n.x,t=n.y;for(var o=0;o<s.pathlist.length;o++){var l=g(o),c=p(o);if(l&&c&&s.pathlist[o].getpathPoints&&"function"==typeof s.pathlist[o].getpathPoints){var h=s.pathlist[o].getpathPoints(e,t,a,i,r,s.x,s.y,s.h);if(h.length>0)return h}}return[]},this.setBlockArea=function(e,t,a){var i=s.pathlist[e].getArea(),r=s.parent.scaleObject.AreaUnitlabel,n=s.parent.scaleObject.ndimprecision,o=vo(i);o=(o=o.toFixed(n))+" "+r,s.hasAttribute(t,a)?s.updateAttribute(t,a,o):s.appendCustomBlockAttribute(t,a,o)},this.createAreaAttributes=function(e){for(var t=0;t<s.pathlist.length;t++)s.pathlist[t].hasArea&&s.setBlockArea(t,s.pathlist[t].blockname,e)},this.getvectorinformation=function(e,t,a,i,r,o){var l={x:e,y:t},h={x:e,y:t},u=[],d={index:null},m=void 0,y=void 0,b=void 0;c=[];var x=void 0;0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].getpageRotation()&&(h=on(e,t)),e=h.x,t=h.y;for(var w=0;w<s.pathlist.length;w++){var k=g(w),D=p(w);k&&D&&(s.pathlist[w].mouseon=!1,s.pathlist[w].iswithin(e,t,a,i,r,s.x,s.y,s.h,o)&&c.push(s.pathlist[w]))}c.length>0?((m=function(e){for(var t=e[0].getArea(),a=e[0].getArea(),i=0,r=0;r<e.length;r++)(a=e[r].getArea())<t&&(i=r,t=a);return e[i]}(c))&&(m.mouseon=!0,al(n)),x=m.index,y=f(m.blockname),null!=s.layerlist[m.layer]&&(b=s.layerlist[m.layer].name),u={Index:x,Block:y,Layername:b,Entity:{type:m.entityType.type,handle:m.entityType.handleLow,typename:v(m.entityType.type)}},d.index=x):al(n),o?null!=St&&St.set2DBlockInfo(u,l,d):null!=Rt&&Rt.set2DBlockInfo(u,l,d)},this.getinsidePolygon=function(e,t,a,i,r,n,o){s.multiselect=n;var l=!1,c={x:e,y:t},h={x:e,y:t},u=[],d=[],m=[],f=[],v={index:null},b=void 0,x=0,w=0,k=void 0;0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].drotation&&(h=on(e,t)),e=h.x,t=h.y;for(var D=0;D<s.pathlist.length;D++){var C=g(D),P=p(D);if(C&&P)if(l=s.pathlist[D].insidePolygon(e,t,a,i,r,s.x,s.y,s.h,o))x=w,w=s.pathlist[D].getArea(),b&&w<x?(b=s.pathlist[D].blockname,k=D,f.unshift({foundblock:b,partindex:k,area:w})):(b=s.pathlist[D].blockname,k=D,f.push({foundblock:b,partindex:k,area:w}));else if(n&&s.pathlist[D].selected){var S=s.pathlist[D].blockname;m.push(s.blocklist[S].index)}}if(b)if(o){if(!s.pathlist[k].selected)if(f.length>1){v.index=f[0].partindex;for(var R=0;R<f.length;R++){var M=y(f[R].foundblock);M.push({index:f[R].partindex}),d.push(M)}}else d=y(b),v.index=k,d.push(v)}else s.pathlist[k].selected?s.selectBlockPath(!1,s.pathlist[k].blockname):s.selectBlockPath(!0,s.pathlist[k].blockname),s.pathlist[k].selected?(m.push(s.blocklist[b].index),n||(u=y(b),v.index=k,u.push(v))):n||(u=[]);return o||null!=Dt&&Dt.set2DBlockID(m),n||(o||null!=Ct&&Ct.set2DBlockInfo(u),o&&null!=Pt&&Pt.set2DBlockInfo(d,c,v)),l},this.markblockinsert=function(e,t,a,i){var r,s=void 0,o=On();(Ji=t/o*2)>4&&(Ji=4),al(n),r=(s=f(e)).insert,s&&r?(s.mouseon=!0,al(n)):al(n)},this.rendermouseonVectors=function(e,t,a,i){var r=Na/2,o=Aa/2,l=On();(Ji=e/l*2)>4&&(Ji=4),n.save(),n.translate(r,o),n.rotate(i*(Math.PI/180)),n.translate(-r,-o);for(var h=0;h<c.length;h++)c[h].mouseon&&c[h].highlight(n,e,t,a,s.x,s.y,s.h);n.restore()},this.renderSelectedBlocks=function(e,t,a,i){var r=Na/2,o=Aa/2,l=On();(Ji=e/l*2)>4&&(Ji=4),n.save(),n.translate(r,o),n.rotate(i*(Math.PI/180)),n.translate(-r,-o);for(var c=0;c<s.blocklist.length;c++)1==s.blocklist[c].state&&null!=s.blocklist[c].insert&&(s.blocklist[c].selected||s.blocklist[c].mouseon)&&s.blocklist[c].highlight(n,e,t,a,s.x,s.y,s.h);n.restore()},this.getinsideblockinsert=function(e,t,a,i,r,o,l){var c={x:e,y:t},h={x:e,y:t},u=[],d=void 0,p=On();(Ji=a/p*2)>4&&(Ji=4),0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].getpageRotation()&&(h=on(e,t)),e=h.x,t=h.y;for(var g=0;g<s.blocklist.length;g++)s.blocklist[g].mouseon=!1,1==s.blocklist[g].state&&null!=s.blocklist[g].insert&&s.blocklist[g].iswithin(e,t,a,i,r,s.x,s.y,s.h)&&u.push(s.blocklist[g]);u.length>0?(d=function(e){for(var t=e[0].getArea(),a=e[0].getArea(),i=0,r=0;r<e.length;r++)(a=e[r].getArea())<t&&(i=r,t=a);return e[i]}(u))&&l&&!d.selected&&(d.mouseon=!0,al(n)):al(n),l?null!=Tt&&d&&Tt.set2DBlockID(d,c):null!=Mt&&d&&(d.select(),Mt.set2DBlockID(d))},this.resetLayers=function(){for(var e=0;e<this.layerlist.length;e++)null!=this.layerlist[e]&&(this.layerlist[e].state=this.layerlist[e].defaultstate);null!=ut&&ut.setVectorLayers(this.layerlist)},this.filterAttributes=function(e){s.filterAttributelist=s.attributes.filter((function(t){return un(t.name,e)}))},this.filterBlocks=function(e){s.filterblocklist=s.blocklist.filter((function(t){return un(t.name,e)&&t.listed})),null!=pt&&pt.setVectorBlocks(s.filterblocklist)},this.turnBlockAllOnOff=function(e){for(var t=0;t<s.filterblocklist.length;t++)null!=s.filterblocklist[t]&&(s.filterblocklist[t].state=e?1:0);null!=pt&&pt.setVectorBlocks(s.filterblocklist)},this.turnLayerAllOnOff=function(e){for(var t=0;t<this.layerlist.length;t++)null!=this.layerlist[t]&&(this.layerlist[t].state=e?1:0);null!=ut&&ut.setVectorLayers(s.layerlist)},this.setActive=function(){null!=ut&&ut.setVectorLayers(s.layerlist),null!=pt&&pt.setVectorBlocks(s.filterblocklist)},this.getlayerlist=function(){return s.layerlist},this.turnLayerOnOff=function(e){for(var t=0;t<this.layerlist.length;t++)this.layerlist[t].index==e&&(1==this.layerlist[t].state?this.layerlist[t].state=0:this.layerlist[t].state=1)},this.resetBlocks=function(){for(var e=0;e<s.filterblocklist.length;e++)null!=s.filterblocklist[e]&&(s.filterblocklist[e].state=s.filterblocklist[e].defaultstate);for(e=0;e<s.blocklist.length;e++)null!=s.blocklist[e]&&(s.blocklist[e].state=s.blocklist[e].defaultstate);null!=pt&&pt.setVectorBlocks(s.filterblocklist)},this.turnBlockOnOff=function(e){for(var t=0;t<s.filterblocklist.length;t++)if(e==s.filterblocklist[t].index){var a=1==s.filterblocklist[t].state?0:1;s.filterblocklist[t].state=a}for(t=0;t<s.blocklist.length;t++)e==s.blocklist[t].index&&(a=1==s.blocklist[t].state?0:1,s.blocklist[t].state=a)},this.rotate_point=function(e,t,a,i,r){return r=r*Math.PI/180,{x:Math.cos(r)*(e-a)-Math.sin(r)*(t-i)+a,y:Math.sin(r)*(e-a)+Math.cos(r)*(t-i)+i}},this.gettextpos=function(e,t,a,i){var r=Math.min((e.x1-s.x)*t,(e.x2-s.x)*t),n=Math.min((s.h-e.y1)*t,(s.h-e.y2)*t),o=Math.max((e.x1-s.x)*t,(e.x2-s.x)*t),l=Math.max((s.h-e.y1)*t,(s.h-e.y2)*t),c=r+(o-r)/2,h=n+(l-n)/2,u=s.rotate_point(r,n,c,h,e.rot),d=s.rotate_point(o,l,c,h,e.rot);r=Math.min(u.x,d.x),n=Math.min(u.y,d.y),o=Math.max(u.x,d.x),l=Math.max(u.y,d.y);const p=ll();var g=(l-n)/p;return{top:n/p,left:r/p,width:Math.abs(o-r)/p,height:Math.abs(l-n)/p,fontsize:g}},this.TextLayerClear=function(e){if(null!=e.textLayerDiv)for(;e.textLayerDiv.firstChild;)e.textLayerDiv.removeChild(e.textLayerDiv.firstChild);s.textlayerset=!1},this.TextLayerBuilder=function(e){if(!s.textlayerset){ll();for(let t=0;t<s.textlist.length;t++){const i=s.textlist[t],r=s.gettextpos(i,e.scale,e.dx,e.dy),n=document.createElement("span");n.textContent=i.text,n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.fontSize=r.fontsize+"px",n.style.fontFamily="sans-serif",n.style.position="absolute",n.style.whiteSpace="pre";const o=r.fontsize+"px sans-serif",l=b(a,i.text,o),c=r.width/l;if(isFinite(c)&&c>0&&c<3&&(n.style.transform=`scaleX(${c})`,n.setAttribute("data-canvas-width",r.width.toFixed(3))),0!==i.rot){const e=-i.rot;n.style.transformOrigin="50% 50%";const t=n.style.transform||"";n.style.transform=`${t} rotate(${e}deg)`}e.textLayerDiv.appendChild(n)}s.textlayerset=!0}},this.TextLayerBuilderold=function(e){if(!s.textlayerset){for(var t=0;t<s.textlist.length;t++){var i=s.gettextpos(s.textlist[t],e.scale,e.dx,e.dy),r=document.createElement("div"),n=i.fontsize+"px sans-serif",o=b(a,s.textlist[t].text,n),l=(i.width-o)/(s.textlist[t].text.length-1);l<1&&(l=1);var c=l+"px",h=i.left,u=i.top;if(s.textlist[t].rot,r.style.left=h+"px",r.style.top=u+"px",r.style.width=i.width+"px",r.style.height=i.height+"px",r.style.fontFamily="sans-serif",r.style.fontSize=i.fontsize+"px",r.style.letterSpacing=c,r.textContent=s.textlist[t].text,0!=s.textlist[t].rot){r.style.transformOrigin="50% 50%";var d="rotate("+-s.textlist[t].rot+"deg)";r.style.transform=d}e.textLayerDiv.appendChild(r)}s.textlayerset=!0}},this.clearSearchAll=function(){for(var e=0;e<s.textlist.length;e++)s.textlist[e].draw=!1},this.textSearch=function(e,t){for(var a=t;a<s.textlist.length;a++)if(s.textlist[a].text==e)return{numtexts:s.textlist.length,position:a,textobject:s.textlist[a]};return{numtexts:s.textlist.length,position:a,textobject:s.textlist[a-1]}},this.highlightText=function(e){s.textlist[e].draw=!0},this.getsnapPoint=function(e,t,a,i,r){var n={found:!1,change:!1,x:0,y:0},o=[],l={x:e,y:t};0!=s.parent.DocRef.pages[s.parent.DocRef.currentpage].drotation&&(l=on(e,t)),e=l.x,t=l.y;for(var c=[],h=0;h<this.pathlist.length;h++){var u=g(h),d=p(h);u&&d&&(null==(n=this.pathlist[h].findsnapPoint(e,t,a,i,r,this.x,this.y,this.h))&&(n={found:!1,x:0,y:0,type:1}),n.found&&c.push(n),"line"==this.pathlist[h].type&&this.pathlist[h].closeToMouse(e,t,a,i,r,this.x,this.y,this.h)&&o.push(h))}for(var m=0;m<o.length;m++)for(var f=0;f<o.length;f++)if(m!=f){var y=this.pathlist[o[f]].getInterSection(e,t,this.pathlist[o[m]],a,i,r,this.x,this.y,this.h);y&&c.push({found:!0,x:y.x,y:y.y,type:2})}if(c.length>0){var v=e-c[0].x,b=t-c[0].y,x=Math.sqrt(v*v+b*b),w=Math.sqrt(v*v+b*b),k=0;for(h=0;h<c.length;h++)c[h].found&&(v=e-c[h].x,b=t-c[h].y,(w=Math.sqrt(v*v+b*b))<x&&(x=w,k=h));n=c[k]}else n={found:!1,change:!1,x:0,y:0};return n},this.offscreenscale=function(e){return this.backgroundrender?this.offscreen.width/(this.width*e):1},this.invert_images=function(e){if(!s.docompare)for(var t=0;t<s.pathlist.length;)"image"==s.pathlist[t].type&&s.pathlist[t].invert(e),t++},this.drawallmagnify=function(e,t,a,i){s.drawDirect(e,t,a,i,!0,!1,!0)},this.drawallnew=function(e,t,a,i,r,n){ll(),s.parent.DocRef.bRenderinProgress=!0;var o=(new Date).getTime();if(s.width*t*(s.height*t)>sr)s.backgroundrender=!1,s.drawDirect(e,t,a,i,r,n,!1);else{if(e.globalCompositeOperation="source-over",s.backgroundrender=!0,r){var l=1,c=1;l=s.width*t<1?1:s.width*t,c=s.height*t<1?1:s.height*t,l=Math.ceil(l+.5),c=Math.ceil(c+.5),n?(s.offscreenprint.width=l,s.offscreenprint.height=c,pd(!1,s.offscreenprintctx),s.offscreenprintctx.save(),cl(s.offscreenctx),s.drawDirect(s.offscreenprintctx,t,0,0,!0,n,!1),s.offscreenprintctx.restore()):(s.offscreen.width=l,s.offscreen.height=c,pd(!1,s.offscreenctx),s.offscreenctx.save(),cl(s.offscreenctx),s.drawDirect(s.offscreenctx,t,0,0,!0,n,!1),s.offscreenctx.restore())}n?s.offscreenprint.width>=1&&s.offscreenprint.height>=1&&e.drawImage(s.offscreenprint,a,i,this.width*t,this.height*t):s.offscreen.width>=1&&s.offscreen.height>=1&&e.drawImage(s.offscreen,a,i,this.width*t,this.height*t)}s.firstdraw=!0,s.docompare&&(s.firstdrawcompare=!0);var h=(new Date).getTime();s.vectorpagetime=h-o,r&&s.vectorpagetime>s.parent.vectorpagetime&&s.parent.changeinterval(s.vectorpagetime),s.parent.DocRef.bRenderinProgress=!1,null!=_e&&_e.renderComplete(s.parent.DocRef.fileindex)},this.drawDirect=function(e,t,a,i,r,n,o){var l=1,c=1,h=s.x,u=s.h,d=t,m=0;if(m=s.parent.loadbackgroundvectors?2:s.parent.loadoverlayvectors?1:2,!s.docompare){e.fillStyle=n?"white":s.parent.DocRef.backgroundColor,e.globalCompositeOperation="source-over";var f=s.width*t,y=s.height*t;f<1&&(f=1),y<1&&(y=1),e.fillRect(a,i,f,y)}for(var v=0;v<s.pathlistoverride.length;v++)l=g(s.pathlistoverride[v].index)?1:0,c=p(s.pathlistoverride[v].index)?1:0,s.pathlistoverride[v]&&s.pathlistoverride[v].drawmefirst(e,t,a,i,s.x,s.y,s.h,l,c,n,o);s.bcompare?(0==s.comparemode&&(e.globalCompositeOperation="multiply"),1==s.comparemode&&(e.globalCompositeOperation="source-over")):e.globalCompositeOperation="source-over";for(var b=0;b<s.pathlist.length;b++)l=g(b)?1:0,c=p(b)?1:0,s.pathlist[b]&&(s.pathlist[b].role==m?(h=s.overlayoffsetx+s.nOffsetX,u=s.overlayoffsety+s.nOffsetY,d=t*(s.overlayscale+s.nudgeScalefactor)):(h=s.x,u=s.h,d=t),"line"==s.pathlist[b].type?gl(s.pathlist[b],e,d,a,i,h,s.y,u,l,c,n,o):s.pathlist[b].drawme(e,d,a,i,h,s.y,u,l,c,n,o))},this.refreshPath=function(e,t,a,i,r){var n=1,o=1;s.width*a*(s.height*a)>sr?(s.backgroundrender=!1,s.layerlist.length>0&&-1!=e.layer&&null!=s.layerlist[e]&&(n=s.layerlist[e.layer].state),s.blocklist.length>0&&(o=s.blocklist[e.blockname].state),e&&e.drawmefirst(t,a,i,r,s.x,s.y,s.h,n,o)):(s.backgroundrender=!0,s.layerlist.length>0&&-1!=e.layer&&null!=s.layerlist[e.layer]&&(n=s.layerlist[e.layer].state),s.blocklist.length>0&&(o=s.blocklist[e.blockname].state),"line"==e.type?gl(e,s.offscreenctx,a,0,0,s.x,s.y,s.h,n,o,!1):e.drawmefirst(s.offscreenctx,a,0,0,s.x,s.y,s.h,n,o,!1),t.drawImage(s.offscreen,i,r,this.width*a,this.height*a))},this.drawSelected=function(e,t,a,i){if(null!=s.selectedobject){var r=1,n=1;s.width*t*(s.height*t)>sr?(s.backgroundrender=!1,s.layerlist.length>0&&-1!=s.selectedobject.layer&&null!=s.layerlist[s.selectedobject.layer]&&(r=s.layerlist[s.selectedobject.layer].state),s.blocklist.length>0&&(n=s.blocklist[s.selectedobject.blockname].state),s.selectedobject&&s.selectedobject.drawme(e,t,a,i,s.x,s.y,s.h,r,n)):(s.backgroundrender=!0,s.layerlist.length>0&&-1!=s.selectedobject.layer&&null!=s.layerlist[s.selectedobject.layer]&&(r=s.layerlist[s.selectedobject.layer].state),s.blocklist.length>0&&(n=s.blocklist[s.selectedobject.blockname].state),"line"==s.selectedobject.type?gl(s.selectedobject,s.offscreenctx,t,0,0,s.x,s.y,s.h,r,n,drawprint):s.selectedobject.drawme(s.offscreenctx,t,0,0,s.x,s.y,s.h,r,n,drawprint),e.drawImage(s.offscreen,a,i,this.width*t,this.height*t))}},this.Close=function(){for(s.bgDocObjref&&(s.bgDocObjref.setComparelink=void 0,s.bgDocObjref=void 0),s.fgDocObjref&&(s.fgDocObjref.setComparelink=void 0,s.fgDocObjref=void 0),s.layerlist=[],s.blocklist=[],s.filterblocklist=[];0!=this.pathlist.length;)this.pathlist[this.pathlist.length-1].Close(),this.pathlist.pop();s.pathlist=[]},i?s.vectorloader=r?new Ml(s,t,r):new Ml(s,t):t.iscompare&&(l=t,s.flag=1,s.novectors=!0,s.x=l.x,s.y=l.y,s.w=l.w,s.h=l.h,s.scale=l.scale,s.offsetx=l.offsetx,s.offsety=l.offsety,s.width=s.w-s.x,s.height=s.h-s.y,s.fileversion=1,s.flag=1,s.bcompare=!0)}}class El{constructor(){var e=this;this.camera=Bs.getCurrentpage().camera,this.domElement=u.domElement,this.position0=this.camera.position.clone(),this.movementSpeed=1,this.upmovementSpeed=1,this.resetmovementSpeed=1,this.autoSpeedFactor=0,this.quickSpeed=!1,this.autoForward=!1,this.lookdirection=new THREE.Vector3,this.modelCenter=new THREE.Vector3(0,0,0),this.isLocked=!1,this.walkheight=1.8,this.tempWalkheight=1.8,this.walkspeed=10,this.vectorup=new THREE.Vector3(0,0,0),this.unit=1,this.maxfloordist=1.8,this.mouseDragOn=!1,this.reversemouse=!1;var t,a=performance.now(),i=!1,r=!1,s=!1,n=!1,o=!1,l=!1,c=!1,h=0,d=0,p={degrees:0,radians:0},g=new THREE.Vector3,m=new THREE.Vector3,f=(new THREE.Vector3,new THREE.Vector3),y=[],v=new THREE.Euler(0,0,0,"ZYX"),b=(Math.PI,Math.PI,new THREE.Vector3);this.setinitial=function(t,a){e.modelCenter.copy(t),e.position0.copy(t),e.position0.z=0,e.maxfloordist=Bs.getCurrentpage().Vector3DPageObj.getfloorheight()},this.setDimPos=function(t,a,i){e.vectorup=t.clone(),e.update()},this.quickspeed=function(t){e.quickSpeed=t},this.movedirection=function(t,a){switch(t){case 1:i=a,a?(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y)):e.updatebirdseye();break;case 2:r=a,a?(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y)):e.updatebirdseye();break;case 3:s=a,a||(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 4:n=a,a||(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 5:o=a,a||(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),e.updatebirdseye());break;case 6:l=a,a||(y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),e.updatebirdseye())}},this.checkMoveToFloorDown=function(){var e=Bs.getCurrentpage().Vector3DPageObj.checkcurfloor();if(Bs.getCurrentpage().Vector3DPageObj.firstfloor(e))var t=e;else t=e-1;var a=Bs.getCurrentpage().Vector3DPageObj.getfloorElevation(t);return l=!1,a},this.checkMoveToFloorUp=function(){var e=Bs.getCurrentpage().Vector3DPageObj.checkcurfloor();if(Bs.getCurrentpage().Vector3DPageObj.lastfloor(e))var t=e;else t=e+1;return Bs.getCurrentpage().Vector3DPageObj.getfloorElevation(t)},this.checkmoveup=function(t){var a=Bs.getCurrentpage().Vector3DPageObj.checkNewHeight(t);if(null!=a.vec){var i=a.dist;h=i,e.tempWalkheight=a.vec.z+e.maxfloordist,e.tempWalkheight=Math.round(100*(e.tempWalkheight+Number.EPSILON))/100,(i=Math.round(100*(i+Number.EPSILON))/100)<e.maxfloordist?(e.movementSpeed=e.upmovementSpeed,e.jumpup()):e.movementSpeed=e.resetmovementSpeed}},this.setCameraXYPos=function(t){var a=new THREE.Vector3(0,0,0);a.x=t.x,a.y=t.y,null==t.z?a.z=e.camera.position.z:a.z=t.z,e.tempWalkheight=a.z,e.position0.copy(a),e.camera.position.copy(a),f.copy(e.camera.position),y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),e.setbirdseye(a,p),e.updatebirdseye()},this.setbirdseye=function(t,a){null!=Jt&&Jt.cameraPos(t,a,e.modelCenter),Bs.setthumcamerapos(t,a)},this.updatebirdseye=function(){Bs.draw3DNav(),null!=Kt&&Kt.drawbirdseye()},this.getObject=function(){return e.camera},this.setTempWalkHeight=function(t){e.tempWalkheight=t},this.setwalkHeight=function(t){e.walkheight=t},this.setwalkSpeed=function(t){e.walkspeed=t},this.setwalkUnit=function(t){e.unit=t,e.movementSpeed=4*t,e.upmovementSpeed=.25*e.movementSpeed,e.resetmovementSpeed=e.movementSpeed},this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus(),this.mouseDragOn=!0},this.onMouseUp=function(e){this.mouseDragOn=!1,t=void 0},this.onMouseMove=function(a){if(!1!==this.mouseDragOn){var i=a.movementX||a.mozMovementX||a.webkitMovementX||0,r=a.movementY||a.mozMovementY||a.webkitMovementY||0;if(0==i&&0==r&&null!=a.touches&&null!=a.touches[0]){const e=a.touches[0];null!=t&&(i=e.pageX-t.pageX,r=e.pageY-t.pageY),t=e}v.setFromQuaternion(e.camera.quaternion),ji?(v.z-=-.002*i,v.x-=-.002*r):(v.z-=.002*i,v.x-=.002*r),p.radians=v.z,p.radians+=.5*Math.PI,p.radians<0&&(p.radians+=2*Math.PI),e.updatebirdseye(),v.x=Math.max(-0,Math.min(Math.PI,v.x)),e.camera.quaternion.setFromEuler(v)}},this.getDirection=function(){var t=new THREE.Vector3(0,-1,0);return function(a){return a.copy(t).applyQuaternion(e.camera.quaternion)}}(),this.scrollbackward=function(t){t*=.5;var a=y.length>0,i=e.camera.position.z;e.camera.translateZ(t*e.unit),a?e.camera.position.z=i:e.tempWalkheight=e.camera.position.z,y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),g=e.camera.position.clone(),e.setbirdseye(g,p),e.updatebirdseye()},this.scrollforward=function(t){t*=.5;var a=y.length>0,i=e.camera.position.z;e.camera.translateZ(-t*e.unit),a?e.camera.position.z=i:e.tempWalkheight=e.camera.position.z,y=Bs.getCurrentpage().Vector3DPageObj.getBelowIntersections(f,e.walkheight),e.checkmoveup(y),g=e.camera.position.clone(),e.setbirdseye(g,p),e.updatebirdseye()},this.moveUp=function(e){},this.moveDown=function(e){},this.jumpup=function(){!0===c&&(m.z+=30),c=!1},this.moveForward=function(t){b.setFromMatrixColumn(e.camera.matrix,0),b.crossVectors(e.camera.up,b),t*=e.unit,e.camera.position.addScaledVector(b,t)},this.moveRight=function(t){b.setFromMatrixColumn(e.camera.matrix,0),t*=e.unit,e.camera.position.addScaledVector(b,t)},this.update=function(){if(!0===e.isLocked){f.copy(e.camera.position);var t=y.length>0,u=performance.now(),v=(u-a)/1e3;m.z-=9.8*100*v*e.unit;var b=v*e.movementSpeed,x=v*e.movementSpeed*.8;if(e.quickSpeed&&(b=v*e.movementSpeed*10,x=v*e.movementSpeed*.8*10),i||e.autoForward&&!r){var w=e.camera.position.z;e.camera.translateZ(-(b+e.autoSpeedFactor)),t?e.camera.position.z=w:e.tempWalkheight=e.camera.position.z}r&&(w=e.camera.position.z,e.camera.translateZ(b),t?e.camera.position.z=w:e.tempWalkheight=e.camera.position.z),s&&e.camera.translateX(-x),n&&e.camera.translateX(x),o&&(e.camera.position.z=e.checkMoveToFloorUp(),e.tempWalkheight=e.camera.position.z,e.updatebirdseye()),l&&(e.camera.position.z=e.checkMoveToFloorDown(),e.tempWalkheight=e.camera.position.z,e.updatebirdseye()),!0===t&&h<=e.maxfloordist&&(m.z=Math.max(0,m.z),c=!0),o||(e.camera.position.z+=m.z*v),e.camera.position.z<e.tempWalkheight&&!l&&(m.z=0,e.camera.position.z=e.tempWalkheight,c=!0),e.camera.position.z<e.walkheight&&!l&&(m.z=0,e.camera.position.z=e.walkheight,c=!0),(d+=1)>10&&(g=e.camera.position.clone(),e.setbirdseye(g,p),d=0),e.position0.copy(e.camera.position),a=u}}}}class Fl{constructor(){var e=this;this.object=Bs.getCurrentpage().camera,this.modelCenter=new THREE.Vector3(0,0,0),this.domElement=u.domElement,this.target=new THREE.Vector3(0,0,0),this.vectorup=new THREE.Vector3(0,0,0),this.enabled=!1,this.firstxyrecieved=!1,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=90,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.mouseMove=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.target0=this.target.clone(),this.position0=this.object.position.clone();var t=10;this.setinitial=function(t,a){e.movementSpeed=Math.round(.075*a),e.lookSpeed=.125,e.lookVertical=!0,e.modelCenter.copy(t),e.position0.copy(t)},this.domElement,document,this.setPartPos=function(t,a){e.target0.copy(t),e.position0.copy(a)},this.setPos=function(){e.target.set(0,5,0),e.update()},this.setCameraXYPos=function(t){var a=new THREE.Vector3(0,0,0);a.x=t.x,a.y=t.y,null==t.z?a.z=e.object.position.z:a.z=t.z,e.position0.copy(a),e.object.position.copy(a)},this.setDimPos=function(t,a,i){e.firstxyrecieved=!1,e.vectorup=t.clone(),e.target.copy(e.target0),e.object.position.copy(e.position0),e.update()},this.reset=function(){this.lat=0,this.lon=90,this.phi=0,this.theta=0},this.setInitial=function(e,t,a,i){this.lat=e,this.lon=t,this.phi=a,this.theta=i},this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.updatebirdseye=function(){Bs.draw3DNav(),null!=Kt&&Kt.drawbirdseye()},this.movedirection=function(t,a){switch(t){case 1:e.moveForward=a,a&&e.updatebirdseye();break;case 2:e.moveBackward=a,a&&e.updatebirdseye();break;case 3:e.moveLeft=a,a&&e.updatebirdseye();break;case 4:e.moveRight=a,a&&e.updatebirdseye();break;case 5:e.moveUp=a;break;case 6:e.moveDown=a}},this.onMouseDown=function(t){if(e.firstxyrecieved||(e.firstxyrecieved=!0),this.domElement!==document&&this.domElement.focus(),this.activeLook&&this.mouseMove)switch(t){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(this.activeLook&&this.mouseMove)switch(e){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(t,a){e.firstxyrecieved&&(this.domElement===document?(e.mouseX=-(t-e.viewHalfX),e.mouseY=-(a-e.viewHalfY)):e.mouseDragOn?(e.mouseX=t-e.domElement.offsetLeft-e.viewHalfX,e.mouseY=a-e.domElement.offsetTop-e.viewHalfY,e.updatebirdseye()):(e.mouseX=0,e.mouseY=0))},this.update=function(a){if(!1!==this.enabled&&!1!==e.firstxyrecieved){if(this.heightSpeed){if(1==e.vectorup.z)var i=THREE.Math.clamp(this.object.position.z,this.heightMin,this.heightMax),r=i-this.heightMin;else r=1==e.vectorup.y?THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin:(i=THREE.Math.clamp(this.object.position.z,this.heightMin,this.heightMax))-this.heightMin;this.autoSpeedFactor=a*(r*this.heightCoef)}else this.autoSpeedFactor=0;var s=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(s+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(s),this.moveLeft&&this.object.translateX(-s),this.moveRight&&this.object.translateX(s),this.moveUp&&this.object.translateY(s),this.moveDown&&this.object.translateY(-s);var n=a*this.lookSpeed;this.activeLook||(n=0);var o=1;e.constrainVertical&&(o=Math.PI/(e.verticalMax-e.verticalMin)),e.lon-=e.mouseX*n,e.lookVertical&&(e.lat-=e.mouseY*n*o),e.lat=Math.max(-85,Math.min(85,e.lat)),e.phi=THREE.Math.degToRad(90-e.lat),e.theta=THREE.Math.degToRad(e.lon),e.constrainVertical&&(e.phi=THREE.Math.mapLinear(e.phi,0,Math.PI,e.verticalMin,e.verticalMax));var l=e.target,c=e.object.position;if(1==e.vectorup.z?(l.x=c.x+Math.sin(e.phi)*Math.cos(e.theta)*100,l.y=c.y+100*Math.sin(e.phi)*Math.sin(e.theta),l.z=c.z+100*Math.cos(e.phi)):1==e.vectorup.y?(l.x=-(c.x+Math.sin(e.phi)*Math.cos(e.theta)*100),l.y=c.y+100*Math.cos(e.phi),l.z=c.z+100*Math.sin(e.phi)*Math.sin(e.theta)):(l.x=-(c.x+Math.sin(e.phi)*Math.cos(e.theta)*100),l.y=c.y+100*Math.sin(e.phi)*Math.sin(e.theta),l.z=c.z+100*Math.cos(e.phi)),this.object.lookAt(l),(t+=1)>2){var h={degrees:e.lon,radians:e.theta};null!=Jt&&Jt.cameraPos(c,h,e.modelCenter),Bs.setthumcamerapos(c,h),t=0}e.target0.copy(l),e.position0.copy(c)}},this.handleResize()}}class Il{constructor(e,t,a,i){var r=this;function s(e,t,a){r.maxx<e&&(r.maxx=e),r.maxy<t&&(r.maxy=t),r.maxz<a&&(r.maxz=a),r.minx>e&&(r.minx=e),r.miny>t&&(r.miny=t),r.minz>a&&(r.minz=a)}function n(e,t,i,n){for(;e<i;){var o=t.getFloat32(e,!0)-a.x;e+=4;var l=t.getFloat32(e,!0)-a.y;e+=4;var c=t.getFloat32(e,!0)-a.z;s(o,l,c),r.tarray[n].vectors[r.tarray[n].vindex]=o,r.tarray[n].vectors[r.tarray[n].vindex+1]=l,r.tarray[n].vectors[r.tarray[n].vindex+2]=c,r.tarray[n].vindex+=3,e+=4,o=t.getFloat32(e,!0)-a.x,e+=4,l=t.getFloat32(e,!0)-a.y,e+=4,s(o,l,c=t.getFloat32(e,!0)-a.z),r.tarray[n].vectors[r.tarray[n].vindex]=o,r.tarray[n].vectors[r.tarray[n].vindex+1]=l,r.tarray[n].vectors[r.tarray[n].vindex+2]=c,r.tarray[n].vindex+=3,e+=4,o=t.getFloat32(e,!0)-a.x,e+=4,l=t.getFloat32(e,!0)-a.y,e+=4,c=t.getFloat32(e,!0)-a.z,e+=4,s(o,l,c),r.tarray[n].vectors[r.tarray[n].vindex]=o,r.tarray[n].vectors[r.tarray[n].vindex+1]=l,r.tarray[n].vectors[r.tarray[n].vindex+2]=c,r.tarray[n].vindex+=3}}this.id=t,this.selected=!1,this.hasmesh=!1,this.attributes=[],this.format=Bs.Format.substring(0,3),this.meshcolors=[],this.meshrefs=[],this.meshref=0,this.openmesh=!1,this.curTrset=0,this.isLastBlock=!1,this.isLoadComplete=!1,this.vcentroid=new THREE.Vector3,this.minx=1e6,this.maxx=0,this.miny=1e6,this.maxy=0,this.minz=1e6,this.maxz=0,this.id=e.id,this.name=e.name,this.visible=e.visible,this.transparent=e.transparent,this.defaultcolor=En(e.color),this.facecolor=En(e.color),this.curColor=En(e.color),this.tempvisible=1==this.visible,this.tarray=[],this.addline=function(e,t){var i=En(t),r=e.X1-a.x,s=e.Y1-a.y,n=e.Z1-a.z,o=e.X2-a.x,l=e.Y2-a.y,c=e.Z2-a.z,h=new Float32Array([r,s,n,o,l,c]),u=new THREE.BufferGeometry;u.setAttribute("position",new THREE.BufferAttribute(h,3)),u.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var d=new THREE.LineBasicMaterial({color:i,linewidth:2}),p=new THREE.LineSegments(u,d);p.scale.x=a.scale,p.scale.y=a.scale,p.scale.z=a.scale,a.scene.add(p)},this.appendtriangles=function(e,t,a,i){var s=r.tarray[r.curTrset].vectors.length,n=9*t;r.tarray[r.curTrset].vectors=new Float32Array(s+n),r.tarray[r.curTrset].dv.push(e),r.tarray[r.curTrset].triangles.push(t)},this.addtriangles=function(e,t,a,i){var s=[],n=[];s.push(e),n.push(t);var o={dv:s,triangles:n,color:i,vindex:0,dvpos:0,geometry:new THREE.BufferGeometry,vectors:new Float32Array(9*t)};r.tarray.push(o),this.curTrset=r.tarray.length-1},this.addpart=function(e,t,a,i,s){if(e){var n=En(i);r.tarray.length>0?r.tarray[r.curTrset].color==n?(r.facecolor=n,r.appendtriangles(e,t,a,i)):r.addtriangles(e,t,a,n):(this.curColor=n,r.addtriangles(e,t,a,n))}},this.processmesh=function(){r.curTrset=0;for(var e=0;e<r.tarray.length;e++)for(var t=0;t<r.tarray[e].triangles.length;t++){var a=9*r.tarray[e].triangles[t]*4;n(0,r.tarray[e].dv[t],a,e)}r.addmesh(),Sr=!0},this.resetvisible=function(){r.tempvisible=1==r.visible},this.addmesh=function(){for(this.curTrset=0;0!=r.tarray.length;){r.hasmesh=!0;var e=r.tarray[r.curTrset].color;r.material=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide,shininess:20,shading:THREE.SmoothShading}),0!=r.transparent&&(r.material.transparent=!0,r.material.opacity=.3),r.tarray[r.curTrset].geometry.setAttribute("position",new THREE.BufferAttribute(r.tarray[r.curTrset].vectors,3)),r.tarray[r.curTrset].geometry.computeVertexNormals(),r.tarray[r.curTrset].geometry.computeBoundingSphere(),r.center=r.tarray[r.curTrset].geometry.boundingSphere.center.clone(),r.vcentroid.set(r.minx,r.miny,r.minz);var t=new THREE.Vector3(.5*(r.maxx-r.minx),.5*(r.maxy-r.miny),.5*(r.maxz-r.minz));r.vcentroid.add(t);var i=new THREE.Mesh(r.tarray[r.curTrset].geometry,r.material);i.name=r.id,i.scale.x=a.scale,i.scale.y=a.scale,i.scale.z=a.scale,0==this.visible&&(i.visible=!1,r.tempvisible=!1),a.scene.add(i),r.tarray.shift()}r.isLoadComplete=!0,r.isLastBlock&&a.blockreadComplete()},this.setlastblock=function(){r.isLastBlock=!0,!r.isLoadComplete&&r.hasmesh||a.blockreadComplete()},this.addAtrib=function(e,t){var a={name:e,value:t};this.attributes.push(a),"IfcSpace"==e.substring(0,8)&&(this.isSpace=!0)}}}class jl{constructor(e,t,a,i){var r=this;function s(e,t,a){r.maxx<e&&(r.maxx=e),r.maxy<t&&(r.maxy=t),r.maxz<a&&(r.maxz=a),r.minx>e&&(r.minx=e),r.miny>t&&(r.miny=t),r.minz>a&&(r.minz=a)}this.id=t,this.selected=!1,this.isSpace=!1,this.ifctype=0,this.hasmesh=!1,this.attributes=[],this.format=Bs.Format.substring(0,3),this.meshcolors=[],this.meshrefs=[],this.meshref=0,this.openmesh=!1,this.curTrset=0,this.isLastBlock=!1,this.isLoadComplete=!1,this.centroid=new THREE.Vector3,this.vcentroid=new THREE.Vector3,this.minx=1e6,this.maxx=0,this.miny=1e6,this.maxy=0,this.minz=1e6,this.maxz=0,this.tempz=0,this.id=e.id,this.name=e.name,this.visible=e.visible,this.transparent=e.transparent,this.defaultcolor=En(e.color),this.facecolor=En(e.color),this.tempvisible=1==this.visible,this.tarray=[],this.addline=function(e,t){var i=En(t),r=e.X1-a.x,s=e.Y1-a.y,n=e.Z1-a.z,o=e.X2-a.x,l=e.Y2-a.y,c=e.Z2-a.z,h=new Float32Array([r,s,n,o,l,c]),u=new THREE.BufferGeometry;u.setAttribute("position",new THREE.BufferAttribute(h,3)),u.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var d=new THREE.LineBasicMaterial({color:i,linewidth:2}),p=new THREE.LineSegments(u,d);p.scale.x=a.scale,p.scale.y=a.scale,p.scale.z=a.scale,a.scene.add(p)},this.addpart=function(e,t,a,i,s){if(e){var n=En(i),o=(r.getmeshstatus(),{dv:e,triangles:t,color:n,vindex:0,dvpos:0,geometry:new THREE.BufferGeometry,vectors:new Float32Array(9*t)});r.tarray.push(o)}},this.addAtrib=function(e,t){var a={name:e,value:t};this.attributes.push(a),"IfcSpace"==e.substring(0,8)&&(this.isSpace=!0)},this.getmeshstatus=function(){return{meshexist:this.hasmesh,color:this.facecolor,open:this.openmesh}},this.appendmesh=function(e,t,a,i){},this.createmesh=function(e,t,a,i){this.openmesh=!0,this.hasmesh=!0,this.facecolor=a,this.meshcolors.push(a),this.meshref++,this.meshrefs.push(this.meshref),"IFC"==this.format?this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:5,shading:THREE.SmoothShading}):(this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:40,shading:THREE.SmoothShading}),this.material.metal=!0),0!=this.transparent&&(this.material.transparent=!0,this.material.opacity=.3)},this.processmesh=function(){r.curTrset=0,null!=r.tarray[r.curTrset]&&function(e,t,a,i){var r=0;!function s(){for(var n=Math.min(r+t,e);r<n;++r)a.call(null,r);r<e?setTimeout(s,0):i.call(null)}()}(9*r.tarray[r.curTrset].triangles*4,1332,(function(){Sr=!1,function(){var e=r.tarray[r.curTrset];if(e.dvpos<9*e.triangles*4){var t=e.dv.getFloat32(e.dvpos,!0)-a.x;e.dvpos+=4;var i=e.dv.getFloat32(e.dvpos,!0)-a.y;e.dvpos+=4;var n=e.dv.getFloat32(e.dvpos,!0)-a.z;s(t,i,n),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3,e.dvpos+=4,t=e.dv.getFloat32(e.dvpos,!0)-a.x,e.dvpos+=4,i=e.dv.getFloat32(e.dvpos,!0)-a.y,e.dvpos+=4,s(t,i,n=e.dv.getFloat32(e.dvpos,!0)-a.z),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3,e.dvpos+=4,t=e.dv.getFloat32(e.dvpos,!0)-a.x,e.dvpos+=4,i=e.dv.getFloat32(e.dvpos,!0)-a.y,e.dvpos+=4,n=e.dv.getFloat32(e.dvpos,!0)-a.z,e.dvpos+=4,s(t,i,n),e.vectors[e.vindex]=t,e.vectors[e.vindex+1]=i,e.vectors[e.vindex+2]=n,e.vindex+=3}r.tarray[r.curTrset]=e,e.dvpos}()}),(function(){r.addmesh(),Sr=!0})),function e(){Sr=!0,null!=r.tarray[r.curTrset]&&r.tarray[r.curTrset].dvpos<9*r.tarray[r.curTrset].triangles*4&&setTimeout(e,10)}()},this.addmesh=function(){this.openmesh=!0,this.hasmesh=!0,this.facecolor=r.tarray[r.curTrset].color,this.meshcolors.push(r.tarray[r.curTrset].color),this.meshref++,this.meshrefs.push(this.meshref),"IFC"==this.format?this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:5,shading:THREE.SmoothShading}):this.material=new THREE.MeshPhongMaterial({color:this.facecolor,side:THREE.DoubleSide,shininess:20,shading:THREE.SmoothShading}),0!=this.transparent&&(this.material.transparent=!0,this.material.opacity=.3),r.tarray[r.curTrset].geometry.setAttribute("position",new THREE.BufferAttribute(r.tarray[r.curTrset].vectors,3)),r.tarray[r.curTrset].geometry.computeVertexNormals();var e=new THREE.Mesh(r.tarray[r.curTrset].geometry,r.material);e.name=r.id,e.scale.x=a.scale,e.scale.y=a.scale,e.scale.z=a.scale,e.geometry.computeBoundingSphere(),e.geometry.computeBoundingBox(),0==this.visible&&(e.visible=!1,r.tempvisible=!1),a.scene.add(e),r.center=e.geometry.boundingSphere.center.clone(),r.radius=e.geometry.boundingSphere.radius,r.boxmax=e.geometry.boundingBox.max.clone(),r.vcentroid.set(r.minx,r.miny,r.minz);var t=new THREE.Vector3(.5*(r.maxx-r.minx),.5*(r.maxy-r.miny),.5*(r.maxz-r.minz));r.vcentroid.add(t),a.blockadded(),r.isLoadComplete=!0,r.isLastBlock&&a.blockreadComplete(),r.tarray.length,r.tarray.shift(),r.tarray.length>0&&r.processmesh()},this.setlastblock=function(){r.isLastBlock=!0,!r.isLoadComplete&&r.hasmesh||a.blockreadComplete()},this.resetvisible=function(){r.tempvisible=1==r.visible}}}class Ol{constructor(e,t,a,i,r){var s=this;this.name=e,this.index=t,this.state=a,this.level=i,this.position=r,this.selected=!1,this.setSelected=function(e){s.selected=e}}}class Ll{constructor(e,t){var a=this;this.parent=t,this.scene=null;var i=new THREE.ObjectLoader;this.markuploaded=function(e){a.parent.setMarkupScene(e)},this.markupProgress=function(e){console.log(e.loaded/e.total*100+"% loaded")},this.markupError=function(e){console.log("An error happened ",e)},i.load(e,a.markuploaded,a.markupProgress,a.markupError)}}class Vl{constructor(e,t,a){var i=this;this.parent=t,this.scene=null;var r=a,s=new THREE.GLTFLoader;if(this.addScene=function(e,t){r=t,Qa=!0,s.load(e,i.gltfloaded,i.gltfprogress,i.gltferror)},this.gltfloaded=function(e){u.domElement.style.visibility="visible",Qa=!1,r?i.parent.setAddtoScene(e.scene):i.parent.setScene(e.scene),null!=Zt&&Zt.setUpload("hide")},this.gltfprogress=function(e){null!=Zt&&Zt.setUpload(Math.round(e.loaded/e.total*100))},this.gltferror=function(e){console.log("An error happened",e)},ks){var n=Zc();if(n.authset)var o={Authorization:n.authString+n.baseuserstring}}else o=void 0;s.load(e,i.gltfloaded,i.gltfprogress,i.gltferror,o)}}class Nl{constructor(e,i){var r=this,s=i;this.countparts=0,this.selectedpart=-1,this.clippingOn=!1,this.box=null,this.boxSize=null,this.boxCenter=null,this.navbox=null,this.navboxSize=null,this.navboxCenter=null,this.unit=1,this.pointTreshold=1,this.pointSize=1,this.explodebox=null,this.explodeboxSize=null,this.explodeboxCenter=null,this.modeluuid=null,this.modelidx=null,this.markupidx=null,this.hasmarkup=!1,this.markuplistknown=!1,this.markuploaded=!1,this.modelLoaded=!1,this.orbitcampos=null,this.shadowspotLight=null,this.orbitcamtarget=null,this.effectComposer=null,this.renderPass=null,this.saoPass=null,this.startcampos=null,this.originalpos=new THREE.Vector3,this.navboxmin=new THREE.Vector3,this.navboxmax=new THREE.Vector3,this.geometryutil=THREE.BufferGeometryUtils,i.clock=new THREE.Clock,this.gltfobject=new Vl(e,r,!1),this.scene=new THREE.Scene,this.navscene=new THREE.Scene,this.markupscene=new THREE.Scene,this.markupuuid=this.markupscene.uuid,this.floorplanTextures=[],this.filterAttributelist=[],this.addedScenes=[],this.MarkupPoints=[],this.storeys=[],this.temp2DPoints=[],this.addedMetaData=[],this.cameraSaves=[],this.viewattributes=[],this.cur3Dview=null,this.active3DView=!1,this.topView=null,this.isbim=!0,this.initialwalkthroughPosSet=!1,this.curfloor=0,this.floorelevation={min:null,max:null,index:0},this.curwidth=0,this.curdepth=0,this.curheight=0,this.curminx=0,this.curmaxx=0,this.curminy=0,this.curmaxy=0,this.curminz=0,this.curmaxz=0,this.font=new en("Helvetica",12,!1,!1);var o=Bs.Format.substring(0,3);"Autodesk Revit"==Bs.Format&&(o="RVT");var l=new THREE.Euler(0,0,0,"ZYX"),c=new THREE.Vector3;const h=new THREE.DirectionalLight(16777215,2.5),d=new THREE.DirectionalLight(16777215,1),p=new THREE.DirectionalLight(16777215,.05),g=new THREE.HemisphereLight(16777215,16777215,1.5),m=new THREE.HemisphereLight(16777215,4210752,1),f=new THREE.AmbientLight(4210752,4);function y(e){for(var t=null,a=0;a<r.cameraSaves.length;a++)r.cameraSaves[a].name==e&&(t=a);return t}function v(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e}function b(e){if("Group"==e.type)for(var t=0;t<e.children.length;t++)"Mesh"!=e.children[t].type&&"LineSegments"!=e.children[t].type||(e.children[t].position.x=0,e.children[t].position.y=0,e.children[t].position.z=0);else"Mesh"==e.type&&(e.position.x=0,e.position.y=0,e.position.z=0)}function x(e,t,a){var i=[];if("Group"==e.type){for(var s=0;s<e.children.length;s++)if(("Mesh"==e.children[s].type||"LineSegments"==e.children[s].type)&&null!=e.children[s].geometry.boundingSphere.center){var n=e.children[s].geometry.boundingSphere.center.clone();if(i=r.getAttachedMarkups(e.children[s].uuid),0!=a){var o=(h=n.clone()).multiplyScalar(a);if(h.multiplyScalar(r.scale),e.children[s].position.sub(o),i.length>0)for(var l=0;l<i.length;l++)i[l].position.sub(o)}if((c=n.multiplyScalar(t)).multiplyScalar(r.scale),e.children[s].position.add(c),i.length>0)for(l=0;l<i.length;l++)i[l].position.add(c)}}else if("Mesh"==e.type){if(""===e.name)return!1;if(null!=e.geometry.boundingSphere.center){var c,h;if(n=e.geometry.boundingSphere.center.clone(),i=r.getAttachedMarkups(e.uuid),0!=a)if(o=(h=n.clone()).multiplyScalar(a),h.multiplyScalar(r.scale),e.position.sub(o),i.length>0)for(l=0;l<i.length;l++)i[l].position.sub(o);if((c=n.multiplyScalar(t)).multiplyScalar(r.scale),e.position.add(c),i.length>0)for(l=0;l<i.length;l++)i[l].position.add(c)}}return!1}function w(e,t){var a=t.clone();return null==e.userData.originalpositionX&&(e.userData.originalpositionX=t.x),null==e.userData.originalpositionY&&(e.userData.originalpositionY=t.y),null==e.userData.originalpositionZ&&(e.userData.originalpositionZ=t.z),a.set(e.userData.originalpositionX,e.userData.originalpositionY,e.userData.originalpositionZ),a}function k(e,t){var a=t.clone();return null==e.userData.centerPosX&&(e.userData.centerPosX=t.x),null==e.userData.centerPosY&&(e.userData.centerPosY=t.y),null==e.userData.centerPosZ&&(e.userData.centerPosZ=t.z),a.set(e.userData.centerPosX,e.userData.centerPosY,e.userData.centerPosZ),a}function D(e,t,a){var i=[];if("Group"==e.type){for(var s=0;s<e.children.length;s++)if(("Mesh"==e.children[s].type||"LineSegments"==e.children[s].type)&&null!=e.children[s].geometry.boundingSphere.center){var n=k(e.children[s],e.children[s].geometry.boundingSphere.center);i=r.getAttachedMarkups(e.children[s].uuid);var o=n.sub(r.boxCenter);if(o.multiplyScalar(t),e.children[s].position.copy(o),i.length>0)for(var l=0;l<i.length;l++){var c=w(i[l],i[l].position);c.add(o),i[l].position.copy(c)}}}else if("Mesh"==e.type){if(""===e.name)return!1;if(null!=e.geometry.boundingSphere.center){var h=k(e,e.geometry.boundingSphere.center);i=r.getAttachedMarkups(e.uuid);var u=h.sub(r.boxCenter);if(u.multiplyScalar(t),e.position.copy(u),i.length>0)for(l=0;l<i.length;l++){var d=w(i[l],i[l].position);d.add(u),i[l].position.copy(d)}}}return!1}new THREE.HemisphereLight(16777215,16777215,1),r.isbim="IFC"==o||"RVT"==o,h.position.set(-500,-500,500),r.isbim?h.position.set(-500,-500,500):(h.position.set(-500,500,-500),d.position.set(500,500,-500),this.scene.add(d)),this.scene.add(h),r.isbim?p.position.set(0,0,-1e3):p.position.set(0,-1e3,0),this.scene.add(p),r.isbim?i.camera=new THREE.PerspectiveCamera(70,Na/Aa,.1,1e4):i.camera=new THREE.PerspectiveCamera(45,Na/Aa,.1,1e4),this.explodefactor=0,this.pxplodefactor=0,this.sceneoffset=void 0,this.sceneoffsetset=!1,this.partlist=[],this.blocklist=[],this.navlist=[],this.blocklistquick=[],this.globalPlaneX=new THREE.Plane(new THREE.Vector3(1,0,0),0),this.globalPlaneY=new THREE.Plane(new THREE.Vector3(0,1,0),0),this.globalPlaneZ=new THREE.Plane(new THREE.Vector3(0,0,-1),0),this.globalPlanes=[this.globalPlaneX,this.globalPlaneY,this.globalPlaneZ],ye=Object.freeze([]),this.xPlaneconst=null,this.xPlaneEnd=null,this.xPlaneStart=null,this.yPlaneconst=null,this.yPlaneEnd=null,this.yPlaneStart=null,this.zPlaneconst=null,this.zPlaneEnd=null,this.zPlaneStart=null,this.markupLoad=function(e){this.markupobject=new Ll(e,r)},this.setOrientationScene=function(e){r.navscene.up.set(e.x,e.y,e.z),i.navcamera.up.set(e.x,e.y,e.z);const t=new THREE.BoxGeometry(1,1,1),a=new THREE.BoxGeometry(2,2,2),s=new THREE.EdgesGeometry(t),n=new THREE.LineSegments(s,new THREE.LineBasicMaterial({color:16777215}));r.navscene.add(n);var o=(new THREE.TextureLoader).load("images/top.png"),l=(new THREE.TextureLoader).load("images/front.png"),c=(new THREE.TextureLoader).load("images/right.png"),h=(new THREE.TextureLoader).load("images/back.png"),u=(new THREE.TextureLoader).load("images/left.png"),d=(new THREE.TextureLoader).load("images/bottom.png"),p=[new THREE.MeshStandardMaterial({color:16777215,map:c}),new THREE.MeshStandardMaterial({color:16777215,map:u}),new THREE.MeshStandardMaterial({color:16777215,map:h}),new THREE.MeshStandardMaterial({color:16777215,map:l}),new THREE.MeshStandardMaterial({color:16777215,map:o}),new THREE.MeshStandardMaterial({color:16777215,map:d})];const g=new THREE.MeshStandardMaterial({color:16711680}),m=new THREE.Mesh(a,g),f=new THREE.Mesh(t,p);var y=new THREE.MeshBasicMaterial({color:13882323,opacity:.8}),v=new THREE.CircleGeometry(1,32),b=new THREE.Mesh(v,y);b.position.x=0,b.position.y=0,b.position.z=-.8,r.navscene.add(f),r.navscene.add(b);var x=new THREE.HemisphereLight(16777215,16777215,1);r.navscene.add(x),r.navbox=(new THREE.Box3).setFromObject(m),r.navboxSize=r.navbox.getSize(new THREE.Vector3).length(),r.navboxCenter=r.navbox.getCenter(new THREE.Vector3),r.framenavArea()},this.setMarkupScene=function(e){r.markupscene=e,r.markupuuid=r.markupscene.uuid,r.scene.add(r.markupscene),r.markupidx=null;for(var t=0;t<r.markupscene.children.length;t++)"camera"==r.markupscene.children[t].userData.type&&(r.markupscene.children[t].visible=!1),"resetView"==r.markupscene.children[t].userData.name&&(r.markupscene.children[t].geometry.dispose(),r.markupscene.children[t].material.dispose(),r.markupscene.remove(r.markupscene.children[t]));r.createsymbolTextures(),r.markuploaded=!0,r.load3Dmarkupcheck(),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)},this.load3Dmarkupcheck=function(){var e=i.DocRef.getmarkupfilesread();r.hasmarkup=i.DocRef.getnummarkupfiles()>0,e&&r.hasmarkup?r.markuploaded&&r.modelLoaded&&null!=Ge&&Ge.readComplete():e&&r.modelLoaded&&null!=Ge&&Ge.readComplete()},this.addToScene=function(e,t){r.gltfobject.addScene(e,!0),r.addedMetaData.push({metasrc:t,added:!1})},this.setAddtoScene=function(e){r.addedScenes.push({modeluuid:e.uuid,modelidx:null});var t=Bs.Format.substring(0,3);"Autodesk Revit"==Bs.Format&&(t="RVT"),"IFC"==t||"RVT"==t?e.up.set(0,0,1):this.scene.up.set(0,1,0),r.scene.add(e);for(var a=null,s=0;s<r.addedMetaData.length;s++)r.addedMetaData[s].added||(a=r.addedMetaData[s].metasrc,r.addedMetaData[s].added=!0);i.gltfAddLoadComplete(a)},this.getmodelUnit=function(){return r.unit},this.getmodelBox=function(){return r.box},this.setLightintensity=function(e,t){switch(e){case 1:h.intensity=t;break;case 2:p.intensity=t;break;case 3:g.intensity=t;break;case 4:m.intensity=t;break;case 5:f.intensity=t}},this.setCADmaterial=function(e){for(var t=r.getMeshChildren(),a=35/(180/Math.PI),i=0;i<t.length;i++){if("Group"==t[i].type)for(var s=0;s<t[i].children.length;s++)"Mesh"==t[i].children[s].type&&"MeshStandardMaterial"==t[i].children[s].material.type&&(e&&null!=r.geometryutil&&(t[i].children[s].geometry=r.geometryutil.toCreasedNormals(t[i].children[s].geometry,a)),t[i].children[s].material.flatShading=!1,r.isbim||(t[i].children[s].material.metalness=.1,t[i].children[s].material.roughness=.5),t[i].children[s].material.needsUpdate=!0,t[i].children[s].updateMatrixWorld());"Mesh"==t[i].type&&"MeshStandardMaterial"==t[i].material.type&&(e&&null!=r.geometryutil&&(t[i].geometry=r.geometryutil.toCreasedNormals(t[i].geometry,a)),t[i].material.flatShading=!1,r.isbim||(t[i].material.metalness=.1,t[i].material.roughness=.5),t[i].material.needsUpdate=!0,t[i].updateMatrixWorld())}},this.setScene=function(e){var t=new THREE.Vector3;r.modeluuid=e.uuid;var a=Bs.Format.substring(0,3);if("Autodesk Revit"==Bs.Format&&(a="RVT"),"IFC"==a||"RVT"==a?(r.isbim=!0,e.up.set(0,0,1)):(r.isbim=!1,e.up.set(0,1,0)),t.x=e.up.x,t.y=e.up.y,t.z=e.up.z,r.scene.up.set(t.x,t.y,t.z),r.scene.add(e),r.scene.add(r.markupscene),r.box=(new THREE.Box3).setFromObject(e),r.boxSize=r.box.getSize(new THREE.Vector3).length(),r.boxCenter=r.box.getCenter(new THREE.Vector3),r.isbim?(r.setLightintensity(5,4),r.setLightintensity(3,1)):(r.setLightintensity(4,2),r.setLightintensity(2,1),r.setLightintensity(1,1.2)),r.setCADmaterial(!0),r.scene.add(h.target),r.isbim?(r.scene.add(g),r.scene.add(f),u.toneMapping=THREE.NoToneMapping):(r.scene.add(m),u.toneMapping=THREE.NoToneMapping),p.position.set(r.boxCenter.x,r.boxCenter.y,r.boxCenter.z),r.isbim?p.translateZ(2*-r.boxSize):p.translateY(2*-r.boxSize),p.target.position.set(r.boxCenter.x,r.boxCenter.y,r.boxCenter.z),p.target.updateMatrixWorld(),r.isbim?(h.position.set(r.box.min.x,r.box.min.y,r.box.max.z),h.translateZ(r.boxSize),h.translateY(-r.boxSize),h.translateX(-r.boxSize)):(h.position.set(r.box.min.x,r.box.max.y,r.box.min.z),h.translateZ(-r.boxSize),h.translateY(r.boxSize),h.translateX(-r.boxSize),d.position.set(r.box.max.x,r.box.max.y,r.box.max.z),d.translateZ(r.boxSize),d.translateY(r.boxSize),d.translateX(r.boxSize),d.target.position.set(r.boxCenter.x,r.boxCenter.y,r.boxCenter.z),d.target.updateMatrixWorld()),r.boxSize<1e3?this.unit=1:this.unit=0,2==s.Unitofmeasure&&(this.unit=2),NaN!=parseFloat(s.DPI)){var n=Math.round(100*(1/parseFloat(s.DPI)*25.4+Number.EPSILON))/100;1e3==n&&0==this.unit&&(n=1)}else n=1e3;switch(n){case 1e3:this.unit=1,this.pointSize=.02,this.pointTreshold=.2,Cu(1),Ru("Meter");break;case 1:this.unit=0,this.pointSize=20,this.pointTreshold=200,Cu(1),Ru("Millimeter");break;case 304.8:this.unit=2,this.pointSize=.16,this.pointTreshold=1.6,Cu(2),Mu("Feet");break;case 25.4:this.unit=3,this.pointSize=1,this.pointTreshold=10,Cu(2),Mu("Inch");break;case 10:this.unit=4,this.pointSize=2,this.pointTreshold=20,Cu(1),Ru("Centimeter")}r.originalpos=new THREE.Vector3,r.originalpos=r.scene.position.clone(),i.camera.up.set(t.x,t.y,t.z),r.frameArea();var o=Math.max(r.box.max.x-r.box.min.x,r.box.max.y-r.box.min.y);i.glTFloadComplete(o,r.boxCenter,r.unit,r.box.min.z)},this.setCamera=function(){if(null==r.boxSize||null==r.boxCenter)return;const e=new THREE.Vector3(0,0,0),t=.5*r.boxSize*.5,a=THREE.MathUtils.degToRad(.5*i.camera.fov),s=t/Math.tan(a);(new THREE.Vector3).subVectors(e,r.boxCenter).multiply(new THREE.Vector3(0,1,-1)).normalize(),r.isbim?(i.camera.position.set(r.box.max.x,r.box.min.y,r.box.max.z),i.camera.translateY(-s)):(i.camera.position.set(r.box.max.x,r.box.max.y,r.box.min.z),i.camera.translateZ(2*-s)),i.camera.lookAt(r.boxCenter.x,r.boxCenter.y,r.boxCenter.z)},this.setnavCamera=function(){if(null==r.navboxSize||null==r.navboxCenter)return;new THREE.Vector3(0,0,0);const e=.5*r.navboxSize*.5,t=THREE.MathUtils.degToRad(.5*i.navcamera.fov),a=e/Math.tan(t);i.navcamera.position.set(r.navbox.max.x,r.navbox.min.y,r.navbox.max.z),i.navcamera.translateY(-a),i.navcamera.lookAt(r.navboxCenter.x,r.navboxCenter.y,r.navboxCenter.z)},this.framenavArea=function(){null!=r.navboxSize&&null!=r.navboxCenter&&(i.navcamera.near=r.navboxSize/1e3,i.navcamera.far=300*r.navboxSize,i.navcamera.updateProjectionMatrix(),r.setnavCamera())},this.frameArea=function(){if(null!=r.boxSize&&null!=r.boxCenter){i.camera.near=r.boxSize/1e3,i.camera.far=300*r.boxSize,i.camera.updateProjectionMatrix(),r.setCamera();var e=r.box.max.x-r.box.min.x,t=r.box.max.y-r.box.min.y,a=r.box.max.z-r.box.min.z,s=r.box.min.x,n=r.box.max.x,o=r.box.min.y,l=r.box.max.y,c=r.box.min.z,h=r.box.max.z;r.curwidth=e,r.curdepth=t,r.curheight=a,r.curminx=s,r.curmaxx=n,r.curminy=o,r.curmaxy=l,r.curminz=c,r.curmaxz=h,r.setClippingPlanes(e,t,a,s,n,o,l,c,h)}},this.setClippingPlanes=function(e,t,a,i,s,n,o,l,c){var h=u.domElement.width/e,d=u.domElement.height/a;this.scale=Math.min(h,d),r.xPlaneconst=e;var p=r.xPlaneconst/20;r.xPlaneconst+=p,r.xPlaneEnd=-i-e,r.xPlaneStart=s,r.xPlaneEnd-=p/2,r.yPlaneconst=t,p=r.yPlaneconst/20,r.yPlaneconst+=p,r.yPlaneEnd=-n-t,r.yPlaneStart=o,r.yPlaneEnd-=p/2,r.zPlaneconst=a,p=r.zPlaneconst/20,r.zPlaneconst+=p,r.zPlaneEnd=l,r.zPlaneStart=c,r.zPlaneEnd-=p/2,r.globalPlaneX.constant=r.xPlaneEnd+r.xPlaneconst,r.globalPlaneY.constant=r.yPlaneEnd+r.yPlaneconst,r.globalPlaneZ.constant=r.zPlaneEnd+r.zPlaneconst},this.setlightPosition=function(e,t,a){h.position.set(e,t,a)},this.closestVertex=function(e,t){var a=t.geometry.getAttribute("position");if(!(a.count<4)){var i=e.point,s=new THREE.Vector3(a.array[0],a.array[1],a.array[2]),n=new THREE.Vector3(a.array[3],a.array[4],a.array[5]),o=new THREE.Vector3(a.array[6],a.array[7],a.array[8]);s.sub(r.boxCenter),n.sub(r.boxCenter),o.sub(r.boxCenter);var l,c=i.distanceTo(s),h=i.distanceTo(n),u=i.distanceTo(o),d=Math.min(c,h);switch(d=Math.min(u,d)){case c:l=s,s.add(r.boxCenter);break;case h:l=n,n.add(r.boxCenter);break;case u:l=o,o.add(r.boxCenter)}return a=s=n=o=i=null,{vertex:l,distance:d}}},this.add2DPoints=function(e,t){if(!(t>2)){var a=[],i=e[0].point.clone();if(e[1]){var n=e[1].point.clone(),o=i.distanceTo(n),l=new THREE.Vector3;l.subVectors(i,n).setLength(.5*o).add(n)}for(var c=0;c<e.length;c++){var h=e[c].point.clone();a.push(h.x,h.y,h.z)}e[1]&&a.push(l.x,l.y,l.z);var u,d=new THREE.BufferGeometry;d.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),u=r.pointSize;var p=new THREE.PointsMaterial({color:8947848,size:u}),g=new THREE.Points(d,p);g.userData.pointx=h.x,g.userData.pointy=h.y,g.userData.pointz=h.z,e[1]&&(g.userData.dimtext=r.setdimvalue(o),g.userData.distance=o,g.userData.Unit=s.Unitofmeasure,g.userData.SubUnit=s.SubmeasureUnit),g.userData.type="dimension",g.userData.signature=hs,g.userData.id=g.uuid,r.markupscene.add(g),e[1]&&r.addDimLine(i,n,g.uuid),null!=kt&&kt.setMarkupSelected(g.userData,{created:!0,modified:!1,deleted:!1}),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)}},this.dimvaluedraw=function(e,t,a,i,s){t.save();var n={w:0,h:0};t.textAlign="start";var o=1*r.font.height;this.textheight=r.font.height;var l=r.font.height/12,c=10*l,h=5*l,u=20*l,d=10*l;t.font=r.font.fontstringScaled;var p=t.measureText(i).width;if(s)var g=e.x+15,m=e.y;else g=e.x-p/2,m=e.y+o/2;t.lineWidth=1;var f=m-o;t.fillStyle="white",t.strokeStyle=a,t.fillRect(g-1*c,f-1*h,p+1*u,o+1*d),t.strokeRect(g-1*c,f-1*h,p+1*u,o+1*d),n.w=p+1*u,n.h=o+1*d,t.fillStyle="black",t.fillText(i,g,m),t.restore()},this.draw2DPoints=function(e){if(n.save(),n.strokeStyle="black",n.fillStyle="rgba(0, 0, 255, 0.5)",n.beginPath(),n.arc(e[0].x,e[0].y,8,0,2*Math.PI),n.closePath(),n.arc(e[0].x,e[0].y,4,0,2*Math.PI,!0),n.closePath(),n.arc(e[1].x,e[1].y,8,0,2*Math.PI),n.closePath(),n.arc(e[1].x,e[1].y,4,0,2*Math.PI,!0),n.closePath(),e.length>1){n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.closePath();var t=!0}t&&n.stroke(),n.fill(),n.restore()},this.inViewCheck=function(e){i.camera.updateMatrix(),i.camera.updateMatrixWorld(),parseInt(THREE.REVISION)<=127?i.camera.matrixWorldInverse.getInverse(i.camera.matrixWorld):i.camera.matrixWorldInverse.copy(i.camera.matrixWorld).invert();var t=new THREE.Frustum;return t.setFromProjectionMatrix((new THREE.Matrix4).multiplyMatrices(i.camera.projectionMatrix,i.camera.matrixWorldInverse)),!!t.containsPoint(e.pos)},this.addDimLine=function(e,t,a){var i=new Float32Array([e.x,e.y,e.z,t.x,t.y,t.z]),s=new THREE.BufferGeometry;s.setAttribute("position",new THREE.BufferAttribute(i,3)),s.setIndex(new THREE.BufferAttribute(new Uint16Array([0,1]),1));var n=new THREE.LineBasicMaterial({color:255,linewidth:2}),o=new THREE.LineSegments(s,n);o.userData.type="dimension",o.userData.parentref=a,r.markupscene.add(o)},this.draw2DLine=function(e){n.save(),n.strokeStyle="black",n.beginPath(),n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.closePath(),n.stroke()},this.draw2DPoint=function(e,t){t.save(),t.strokeStyle="black",e.selected?t.fillStyle="rgba(255, 0, 0, 0.5)":t.fillStyle="rgba(0, 0, 255, 0.5)",t.beginPath(),t.arc(e.pos.x,e.pos.y,8,0,2*Math.PI),t.closePath(),t.arc(e.pos.x,e.pos.y,4,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()},this.setdimvalue=function(e){var t=e,a=!1;if(2==s.Unitofmeasure){Zr&&(a=!0);var i=wo(t),r=i.quot,n=i.rem;if(1==s.SubmeasureUnit){var o=r+'"';0!=i.numerator&&0!=i.denominator&&(o=i.numerator==i.denominator?r+'"':r+" "+i.numerator+"/"+i.denominator+'"')}2==s.SubmeasureUnit&&(o=0!=n?r+"' - "+n+'"':r+"'",0!=i.numerator&&0!=i.denominator&&(o=i.numerator==i.denominator?r+"' - "+n+'"':0!=n?r+"' - "+n+" "+i.numerator+"/"+i.denominator+'"':r+"' - "+i.numerator+"/"+i.denominator+'"'))}var l=ko(t);return l=(l=(l=ko(t)).toFixed(ne))+" "+s.Unitlabel,a&&(l=o),l},this.renderMarkupPoints=function(e){if(null!=i.DocRef&&null!=i.DocRef){var a=r.getMarkupChildren(),n=[],o=[];if(e.clearRect(0,0,t.width,t.height),a.length>0&&i.DocRef.Drawmarkup)for(var l=0;l<a.length;l++){a[l].updateMatrixWorld();var c=a[l].geometry.getAttribute("position");if("Points"==a[l].type&&c.count>1){for(var h=0;h<c.count;h++){var u=h*c.itemSize,d=c.array[u],p=c.array[u+1],g=c.array[u+2],m=new THREE.Vector3(d,p,g);a[l].localToWorld(m),o.push({pos:m,selected:a[l].userData.selected}),n.push({pos:r.posToScreen(m),selected:a[l].userData.selected})}null!=a[l].userData.Unit&&a[l].userData.Unit!=s.Unitofmeasure&&null!=a[l].userData.distance&&(a[l].userData.dimtext=r.setdimvalue(a[l].userData.distance),a[l].userData.Unit=s.Unitofmeasure),null!=a[l].userData.SubUnit&&a[l].userData.SubUnit!=s.SubmeasureUnit&&null!=a[l].userData.distance&&(a[l].userData.dimtext=r.setdimvalue(a[l].userData.distance),a[l].userData.SubUnit=s.SubmeasureUnit);var f=a[l].userData.dimtext;!!r.inViewCheck(o[0])&&r.draw2DPoint(n[0],e),!!r.inViewCheck(o[1])&&r.draw2DPoint(n[1],e),!!r.inViewCheck(o[2])&&r.dimvaluedraw(n[2].pos,e,"black",f,!1),n=[],o=[]}}}},this.posToScreen=function(e){var a=e.clone().project(s.camera);return a.x=(a.x+1)/2*t.width,a.y=-(a.y-1)/2*t.height,a},this.pointToScreen=function(e){var a=e.point.clone().project(s.camera);return a.x=(a.x+1)/2*t.width,a.y=-(a.y-1)/2*t.height,a},this.storeCamera=function(e,t){var a=new THREE.Vector3;a.copy(t);var i=new THREE.Vector3;i.copy(e),r.orbitcampos=a,r.orbitcamtarget=i},this.getfloorElevation=function(e){return i.floorplans.length>0?i.floorplans[e].Elevation:r.box.min.z},this.firstfloor=function(e){return 0==e},this.lastfloor=function(e){return e==i.floorplans.length-1},this.checkcurfloor=function(){if(!r.isbim)return 0;var e=0,t=0;r.floorelevation.max=null,r.floorelevation.min=null;for(var a=null,s=0;s<i.floorplans.length;s++)i.camera.position.z>i.floorplans[s].Elevation&&(r.floorelevation.min=s,a=i.floorplans[s].index),i.camera.position.z<i.floorplans[s].Elevation&&(r.floorelevation.max=s,i.floorplans[s].index);return null==r.floorelevation.max&&null!=r.floorelevation.min&&(r.floorelevation.max=r.floorelevation.min),null==r.floorelevation.max||null==r.floorelevation.min?(e=0,t=i.floorplans[0].index):(e=r.floorelevation.min,t=a),r.curfloor!=e&&null!=Ze&&Ze.setFloorLevel({floorindex:e,storeyindex:t}),r.curfloor=e,r.curfloor},this.setControl=function(e){null!=r.boxSize&&null!=r.boxCenter&&("orbitControl"==e.name?null==r.orbitcampos?e.setDimensions(10*r.boxSize,r.boxCenter,r.orbitcamtarget,i.camera.position):e.setDimensions(10*r.boxSize,r.boxCenter,r.orbitcamtarget,r.orbitcampos):"Walkthrough3D"==e.name&&i.walkthroughcontrol.setDimPos(r.scene.up,10*r.boxSize,r.boxCenter))},this.blockreadComplete=function(){null!=ft&&ft.readComplete(),i.DocRef.SetActive()},this.getModelCenter=function(){return{unit:r.unit,boxCenter:r.boxCenter}},this.filterAttributes=function(e){r.filterAttributelist=r.blocklist.filter((function(t){return un(t.name,e)}))},this.addstoreys=function(e,t,a,s,n){r.storeys.push({name:t,id:a,attributes:e.ID,index:s,Elevation:n}),r.storeys.length==i.StoreyMetadata.length&&i.glTFstoreyLoadComplete()},this.getstoreyNames=function(){var e=[];r.storeys[0].Elevation?r.storeys.sort((function(e,t){return e.Elevation-t.Elevation})):r.storeys.sort((e,t)=>e.index>t.index?1:t.index>e.index?-1:0);for(var t=0;t<r.storeys.length;t++)e.push(r.storeys[t].name);return e},this.addblockscombine=function(e){var t=e.BlockAttributes;r.blocklist=r.blocklist.concat(t);for(var a=0;a<t.length;a++)r.blocklistquick.push(t[a].GlobalID)},this.addNavlist=function(e){r.navlist=[],r.navlist=e,null!=mt&&(mt.isupdate=!0,mt.set3DParts(r.navlist))},this.addblocks=function(e){r.blocklist=[],r.blocklist=e.BlockAttributes;for(var t=0;t<r.blocklist.length;t++)r.blocklistquick.push(r.blocklist[t].GlobalID);null!=Ne&&Ne.loadComplete(i.DocRef.OriginalURL,i.DocRef.bActive)},this.updateblocklist=function(){var e=r.getMeshChildren();if(0!=e.length){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)e[t].children[a].type;e[t].type}var i=r.getAddedMeshChildren();for(t=0;t<i.length;t++)for(a=0;a<i[t].length;a++){if("Group"==i[t][a].type)for(var s=0;s<i[t][a].children.length;s++)i[t][a].children[s].type;i[t][a].type}null!=mt&&(mt.isupdate=!0,mt.set3DParts(this.navlist))}},this.getarrayMeshIDs=function(e,t,a){for(var i=0;i<t.length;i++)for(var r=0;r<e.length;r++)if("Group"===e[r].type)for(var s=0;s<e[r].children.length;s++){var n=v(e[r].children[s].name,e[r].children[s].type),o=e[r].children[s].name;t[i]==n&&a.push(o)}else{if(""===e[r].name)continue;t[i]==e[r].name&&a.push(e[r].name)}return a},this.getMeshIDs=function(e){var t=r.getMeshChildren(),a=r.getAddedMeshChildren(),i=[];i=r.getarrayMeshIDs(t,e,i);for(var s=0;s<a.length;s++)i=r.getarrayMeshIDs(a[s],e,i);return i},this.getmeshUserDataAll=function(e,t,a,i){for(var r=0;r<e.length;r++)if("Group"===e[r].type)for(var s=0;s<e[r].children.length;s++){var n=v(e[r].children[s].name,e[r].children[s].type);if(i){null==e[r].children[s].userData.visible&&(e[r].children[s].userData.visible=e[r].children[s].visible?1:0),null==e[r].children[s].userData.facecolor&&(e[r].children[s].userData.facecolor=e[r].children[s].material.color.getHex()),null==e[r].children[s].userData.tempvisible&&(e[r].children[s].userData.tempvisible=1==e[r].children[s].userData.visible),null==e[r].children[s].userData.transparent&&(e[r].children[s].userData.transparent=e[r].children[s].material.transparent?1:0),null==e[r].children[s].userData.opacity&&(e[r].children[s].userData.opacity=e[r].children[s].material.opacity),null==e[r].children[s].userData.uuid&&(e[r].children[s].userData.uuid=e[r].children[s].uuid),null==e[r].children[s].userData.name&&(e[r].children[s].userData.name=e[r].children[s].name);var o={name:n,userData:e[r].children[s].userData};t.push(o)}else for(var l=0;l<a.length;l++)a[l].GlobalID==n&&(null==e[r].children[s].userData.visible&&(e[r].children[s].userData.visible=e[r].children[s].visible?1:0),null==e[r].children[s].userData.facecolor&&(e[r].children[s].userData.facecolor=e[r].children[s].material.color.getHex()),null==e[r].children[s].userData.tempvisible&&(e[r].children[s].userData.tempvisible=1==e[r].children[s].userData.visible),null==e[r].children[s].userData.uuid&&(e[r].children[s].userData.uuid=e[r].children[s].uuid),null==e[r].children[s].userData.name&&(e[r].children[s].userData.name=e[r].children[s].name),o={name:a[l].GlobalID,userData:e[r].children[s].userData,attributes:a[l]},t.push(o))}else{if(""===e[r].name)continue;for(i&&(null==e[r].userData.visible&&(e[r].userData.visible=e[r].visible?1:0),null==e[r].userData.facecolor&&(e[r].userData.facecolor=e[r].material.color.getHex()),null==e[r].userData.tempvisible&&(e[r].userData.tempvisible=1==e[r].userData.visible),null==e[r].userData.uuid&&(e[r].userData.uuid=e[r].uuid),null==e[r].userData.name&&(e[r].userData.name=e[r].name),o={name:e[r].name,userData:e[r].userData},t.push(o)),l=0;l<a.length;l++)a[l].GlobalID==e[r].name&&(null==e[r].userData.visible&&(e[r].userData.visible=e[r].visible?1:0),null==e[r].userData.facecolor&&(e[r].userData.facecolor=e[r].material.color.getHex()),null==e[r].userData.tempvisible&&(e[r].userData.tempvisible=1==e[r].userData.visible),null==e[r].userData.uuid&&(e[r].userData.uuid=e[r].uuid),null==e[r].userData.name&&(e[r].userData.name=e[r].name),o={name:a[l].GlobalID,userData:e[r].userData,attributes:a[l]},t.push(o))}return t},this.getSelectedMesh=function(){for(var e=[],t=r.getMeshChildren(),a=r.getAddedMeshChildren(),i=0;i<t.length;i++)if("Group"===t[i].type)for(var s=0;s<t[i].children.length;s++)t[i].children[s].userData.selected&&e.push(t[i].children[s].name);else{if(""===t[i].name)continue;t[i].userData.selected&&e.push(t[i].name)}for(var n=0;n<a.length;n++)if("Group"===a[n].type)for(s=0;s<a[n].children.length;s++)a[n].children[s].userData.selected&&e.push(a[n].children[s].name);else{if(""===a[n].name)continue;a[n].userData.selected&&e.push(a[n].name)}return e},this.getmeshUserData=function(e,t){var a=r.getMeshChildren(),i=r.getAddedMeshChildren(),s=[];if(0==a.length)return s;s=r.getmeshUserDataAll(a,s,e,t);for(var n=0;n<i.length;n++)s=r.getmeshUserDataAll(i[n],s,e,t);return s},this.getStoreyRealIDs=function(e){for(var t=null,a=0;a<r.storeys.length;a++)r.storeys[a].name==e&&(t=a);return null!=t?(r.storeys[t].idreplaced||(r.storeys[t].attributes=r.getMeshIDs(r.storeys[t].attributes),r.storeys[t].idreplaced=!0),r.storeys[t].attributes):[]},this.getStoreyIDs=function(e){for(var t=null,a=0;a<r.storeys.length;a++)r.storeys[a].name==e&&(t=a);return null!=t?r.storeys[t].attributes:[]},this.getAttributeStorey=function(e){for(var t=[],a=null,i=0;i<r.storeys.length;i++)r.storeys[i].name==e&&(a=i);if(null!=a)for(var s=0;s<r.storeys[a].attributes.length;s++)t.push(r.storeys[a].attributes[s]);return r.getmeshUserData(t,!1)},this.searchAttributeStoreyEx=function(e,t){for(var a=[],i=null,s=0;s<r.storeys.length;s++)r.storeys[s].name==e&&(i=s);if(null!=i)for(var n=0;n<r.storeys[i].attributes.length;n++)for(let[e,s]of Object.entries(r.storeys[i].attributes[n]))if(s==t){a.push(r.storeys[i].attributes[n]);break}return r.getmeshUserData(a,!1)},this.searchAttributeStorey=function(e,t){for(var a=[],i=null,s=0;s<r.storeys.length;s++)r.storeys[s].name==e&&(i=s);if(null!=i)for(var n=0;n<r.storeys[i].attributes.length;n++)for(let[e,s]of Object.entries(r.storeys[i].attributes[n]))un(s,t)&&a.push(r.storeys[i].attributes[n]);return r.getmeshUserData(a,!1)},this.searchAttributeJSONEx=function(e){var t=[];if(null!=e)for(var a=0;a<r.blocklist.length;a++)for(let[i,s]of Object.entries(r.blocklist[a]))if(s==e){t.push(r.blocklist[a]);break}return r.getmeshUserData(t,!1)},this.searchAttributeJSON=function(e){var t=[];if(null!=e)for(var a=0;a<r.blocklist.length;a++)for(let[i,s]of Object.entries(r.blocklist[a]))if(un(s,e)){t.push(r.blocklist[a]);break}return r.getmeshUserData(t,!1)},this.searchAttribute=function(e){for(var t=-1,a=0;a<r.partlist.length;a++)for(var i=r.partlist[a],s=0;s<i.attributes.length;s++)i.attributes[s].value==e&&(t=r.partlist[a].id);return t},this.restoreClipping=function(e){if(null!=e){var t=e.x>0&&e.x<100,a=e.y>0&&e.y<100,i=e.z>0&&e.z<100;t||a||i?(r.clipping(0,e.x,!0),r.clipping(1,e.y,!0),r.clipping(2,e.z,!0)):r.clipping(-1,0,!1)}else r.clipping(-1,0,!1)},this.getClipfactor=function(){var e=(r.globalPlaneX.constant-r.xPlaneEnd)/r.xPlaneconst,t=(r.globalPlaneY.constant-r.yPlaneEnd)/r.yPlaneconst,a=(r.globalPlaneZ.constant-r.zPlaneEnd)/r.zPlaneconst;return{xplane:e,yplane:t,zplane:a,xplaneconst:100*e,yplaneconst:100*t,zplaneconst:100*a}},this.clipping=function(e,t,a){if(!r.active3DView)if(r.clippingOn=a,a){u.clippingPlanes=r.globalPlanes;var i=t/100;switch(e){case 0:var s=r.xPlaneEnd+r.xPlaneconst*i;r.globalPlaneX.constant=s;break;case 1:s=r.yPlaneEnd+r.yPlaneconst*i,r.globalPlaneY.constant=s;break;case 2:s=r.zPlaneEnd+r.zPlaneconst*i,r.globalPlaneZ.constant=s}}else u.clippingPlanes=ye},this.doexplode=!1,this.getCameraView=function(e){for(var t=null,a=0;a<r.cameraSaves.length;a++)r.cameraSaves[a].name==e&&(t=r.cameraSaves[a]);return t},this.deleteCameraView=function(e){for(var t=null,s=0;s<r.cameraSaves.length;s++)r.cameraSaves[s].name==e&&(t=s);r.cameraSaves.splice(t,1),i.delete3DMarkupbyName(e),function(e){var t=0,i=0,r=[];for(Bs.markupdraworder=[],t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&(Bs.markuplist[t].signature==hs&&Bs.markuplist[t].bfor3D&&Bs.markuplist[t].viewname==e||(r[i]=Bs.markuplist[t],Bs.markupdraworder[i]=i,i++));Bs.markuplist=r,Bs.nummarkups=Bs.markuplist.length,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=st&&st.setThumbnails(Bs.thumbnails),al(n),il(a)}(e),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)},this.addCameraViews=function(e){for(var t=0;t<e.length;t++){if(null==e[t].explodefactor)var a=0;else a=e[t].explodefactor;if(null==e[t].clipping)var i={x:0,y:0,z:0};else i={x:e[t].clipping.x,y:e[t].clipping.y,z:e[t].clipping.z};if(null==e[t].attributes)var s=[];else s=e[t].attributes;var n={position:e[t].position,name:e[t].name,tool:e[t].tool,explodefactor:a,clipping:i,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:e[t].selectedmesharray,attributes:s};n.image.src=e[t].image,zu(n,Hr).then((function(e){r.cameraSaves.push(e)}))}},this.getCameraSaves=function(){return r.cameraSaves},this.get3DResetView=function(){return r.topView},this.saveResetCam=function(){if(null==r.topView){var e=r.getmminUnit(200),t=new THREE.SphereBufferGeometry(e,32,32),a=new THREE.MeshBasicMaterial({color:16776960}),i=new THREE.Mesh(t,a);i.name="resetView";var n=u.domElement.toDataURL();r.topView={position:s.camera.matrix.toArray(),name:"resetView",tool:"orbitControl",explodefactor:0,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:[],attributes:[]},r.topView.image.src=n,zu(r.topView,Hr).then((function(e){r.cameraSaves.unshift(e)}));var o=new THREE.Vector3;o.copy(s.camera.position),o.sub(r.scene.position),i.position.copy(o),i.userData.type="camera",i.userData.name=i.name,i.userData.signature=hs,i.visible=!1,r.markupscene.add(i),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)}},this.refreshCameraImage=function(e){var t=r.getCameraView(e),a=u.domElement.toDataURL();t.image.src=a,zu(t,Hr).then((function(e){console.log("3D view thumbnail updated"),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)}))},this.findViewAttribute=function(e,t,a){var i=y(a),s=!1;if(null!=i&&null!=r.cameraSaves[i].attributes)for(var n=0;n<r.cameraSaves[i].attributes.length;n++)r.cameraSaves[i].attributes[n].name==e&&r.cameraSaves[i].attributes[n].value==t&&(s=!0);return s},this.updateViewAttribute=function(e,t,a){var i=y(a);if(null!=i&&null!=r.cameraSaves[i].attributes)for(var s=0;s<r.cameraSaves[i].attributes.length;s++)r.cameraSaves[i].attributes[s].name==e&&(r.cameraSaves[i].attributes[s].name=e,r.cameraSaves[i].attributes[s].value=t)},this.deleteViewAttribute=function(e,t){var a=y(t);if(null!=a&&null!=r.cameraSaves[a].attributes){for(var i=-1,s=0;s<r.cameraSaves[a].attributes.length;s++)r.cameraSaves[a].attributes[s].name==e&&(i=s);-1!=i&&r.cameraSaves[a].attributes.splice(i,1)}},this.getViewAttributes=function(e){var t=y(e);return null!=t&&null!=r.cameraSaves[t].attributes?r.cameraSaves[t].attributes:[]},this.addViewAttribute=function(e,t,a){var i={name:e,value:t},s=y(a);null!=s&&null!=r.cameraSaves[s].attributes&&r.cameraSaves[s].attributes.push(i)},this.getViewAttribute=function(e,t){var a=void 0,i=y(t);if(null!=i&&null!=r.cameraSaves[i].attributes)for(var s=0;s<r.cameraSaves[i].attributes.length;s++)r.cameraSaves[i].attributes[s].name==e&&(a=r.cameraSaves[i].attributes[s]);return a},this.saveCamera=function(){var e=r.getmminUnit(200),t=new THREE.SphereBufferGeometry(e,32,32),a=new THREE.MeshBasicMaterial({color:16776960}),i=new THREE.Mesh(t,a),n=r.cameraSaves.length+1;i.name="markuppos_"+i.uuid+n;var o=new THREE.Vector3;o.copy(s.camera.position),o.sub(r.scene.position),i.position.copy(o),i.userData.type="camera",i.userData.name=i.name,i.userData.signature=hs,i.visible=!0;var l=u.domElement.toDataURL();if(0!=r.pxplodefactor)var c=r.pxplodefactor/.2;else c=0;var h=r.getClipfactor();if(r.clippingOn)var d={x:h.xplaneconst,y:h.yplaneconst,z:h.zplaneconst};else d={x:0,y:0,z:0};var p={position:s.camera.matrix.toArray(),name:i.name,tool:s.DocRef.curcontrol3D,explodefactor:c,clipping:d,thumbnail:null,width:0,height:0,image:document.createElement("img"),selectedmesharray:[],attributes:[]};p.selectedmesharray=r.getSelectedMesh(),p.image.src=l,zu(p,Hr).then((function(e){r.cameraSaves.push(e),null!=yt&&yt.setCameraSave(e,Bs.bActive)})),r.markupscene.add(i),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)},this.getCameraimage=function(e){for(var t=null,a=0;a<r.cameraSaves.length;a++)r.cameraSaves[a].name==e&&(t={thumbnail:r.cameraSaves[a].thumbnail,width:r.cameraSaves[a].width,height:r.cameraSaves[a].height});return t},this.setcur3DViewnull=function(){for(var e=s.DocRef.curcontrol3D,t=0;t<r.cameraSaves.length;t++)r.cameraSaves[t].name==r.cur3Dview&&(e=r.cameraSaves[t].tool);s.DocRef.curcontrol3D=e,r.cur3Dview=null;var a={iscompare:!1,numOpenFiles:Xs.length,isPDF:!1,is3D:!0,markupOn3D:!1,is2D:!1,numpages:s.DocRef.pages.length,currentpage:0,activefile:s.DocRef.bActive};r.active3DView=!1,null!=Gt&&Gt.setGUIState(a),null!=$e&&$e.viewEvent(r.cur3Dview)},this.getcur3DView=function(){return r.cur3Dview},this.getRestoreControl=function(){for(var e=void 0,t=0;t<r.cameraSaves.length;t++)r.cameraSaves[t].name==r.cur3Dview&&(e=r.cameraSaves[t].tool);return e},this.updatebirdseye=function(){Bs.draw3DNav(),null!=Kt&&Kt.drawbirdseye()},this.setbirdseye=function(e,t){null!=Jt&&Jt.cameraPos(e,t,r.getModelCenter()),Bs.setthumcamerapos(e,t)},this.setbirdseyecamera=function(e){var t={degrees:0,radians:0};l.setFromQuaternion(e.quaternion),t.radians=l.z,t.radians+=.5*Math.PI,t.radians<0&&(t.radians+=2*Math.PI),c=e.position.clone(),r.setbirdseye(c,t),r.updatebirdseye()},this.saveresetCamera=function(){r.startcampos=s.camera.matrix.toArray()},this.restoreresetCam=function(){null!=r.startcampos&&(s.camera.matrix.fromArray(r.startcampos),s.camera.matrix.decompose(s.camera.position,s.camera.quaternion,s.camera.scale))},this.restorestartcam=function(){null!=r.startcampos&&(s.camera.matrix.fromArray(r.startcampos),s.camera.matrix.decompose(r.startcampos,s.camera.quaternion,s.camera.scale),r.orbitcampos=null,r.orbitcamtarget=r.boxCenter.clone())},this.set3DViewPos=function(e){for(var t=0;t<r.cameraSaves.length;t++)r.cameraSaves[t].name==e.userData.name&&(e.matrix.fromArray(r.cameraSaves[t].position),e.matrix.decompose(e.position,e.quaternion,e.scale))},this.restoreCameraName=function(e){for(var t=0;t<r.cameraSaves.length;t++)if(r.cameraSaves[t].name==e){if(r.cur3Dview=null,s.unselect3DBlockAll(),r.cur3Dview=e,r.active3DView=!1,nd("markupedit",{p1:!1}),s.DocRef.curcontrol3D="markupedit",s.camera.matrix.fromArray(r.cameraSaves[t].position),s.camera.matrix.decompose(s.camera.position,s.camera.quaternion,s.camera.scale),r.setbirdseyecamera(s.camera),r.cameraSaves[t].selectedmesharray)for(var a=0;a<r.cameraSaves[t].selectedmesharray.length;a++)if(r.cameraSaves[t].selectedmesharray[a]){var i=r.cameraSaves[t].selectedmesharray[a].substr(r.cameraSaves[t].selectedmesharray[a].length-2);"_0"==i&&s.select3DBlock(r.cameraSaves[t].selectedmesharray[a],!1),"_0"!=i&&"_1"!=i&&s.select3DBlock(r.cameraSaves[t].selectedmesharray[a],!1)}r.doexplode=!0,r.newExplode(0),r.doexplode=!1,null!=r.cameraSaves[t].explodefactor&&(r.doexplode=!0,r.newExplode(r.cameraSaves[t].explodefactor),r.doexplode=!1),r.restoreClipping(r.cameraSaves[t].clipping),r.active3DView=!0;var n={iscompare:!1,numOpenFiles:Xs.length,isPDF:!1,is3D:!0,markupOn3D:!0,is2D:!1,numpages:s.DocRef.pages.length,currentpage:0,activefile:s.DocRef.bActive};null!=Gt&&Gt.setGUIState(n),null!=$e&&$e.viewEvent(e);break}},this.set3DViewSelectedMesh=function(e){for(var t=0;t<r.cameraSaves.length;t++)r.cameraSaves[t].name==e&&(r.cameraSaves[t].selectedmesharray=r.getSelectedMesh(),r.refreshCameraImage(e))},this.restoreCamera=function(){if(r.cameraSaves.length>=1){var e=r.cameraSaves.pop();s.camera.matrix.fromArray(e.position),s.camera.matrix.decompose(s.camera.position,s.camera.quaternion,s.camera.scale)}},this.getmarkupScene=function(){if(null!=r.markupidx)return r.markupidx;for(var e=0;e<r.scene.children.length;e++)r.scene.children[e].uuid===r.markupuuid&&(r.markupidx=e);return r.markupidx},this.getmodelGroup=function(){if(null!=r.modelidx)return r.modelidx;for(var e=0;e<r.scene.children.length;e++)r.scene.children[e].uuid===r.modeluuid&&(r.modelidx=e);return r.modelidx},this.getAddeddScenes=function(){if(r.addedScenes.length>0)for(var e=0;e<r.addedScenes.length;e++)if(null==r.addedScenes[e].modelidx)for(var t=0;t<r.scene.children.length;t++)r.scene.children[t].uuid===r.addedScenes[e].modeluuid&&(r.addedScenes[e].modelidx=t);return r.addedScenes},this.getMarkupChildren=function(){return null==r.getmarkupScene()?[]:r.scene.children[r.markupidx].children},this.setAddedMeshUserData=function(e,t,a,i){null==a?r.getAddedMeshChildren()[e][t].userData=i:r.getAddedMeshChildren()[e][t].children[a]=i},this.setMeshUserData=function(e,t,a){null==t?r.getMeshChildren()[e].userData=a:r.getMeshChildren()[e].children[t]=a},this.getAddedMeshChildren=function(){var e=[];if(0==r.getAddeddScenes().length)return e;if(0==r.addedScenes.length)return e;for(var t=0;t<r.addedScenes.length;t++)e.push(r.scene.children[r.addedScenes[t].modelidx].children);return e},this.getModelScene=function(){return null==r.getmodelGroup()?[]:r.scene.children[r.modelidx]},this.getMeshByNameLoop=function(e){for(var t=null,a=0;a<mesharray.length;a++)if("Group"==mesharray[a].type){for(var i=0;i<mesharray[a].children.length;i++)if("Mesh"==mesharray[a].children[i].type&&mesharray[a].children[i].name==e)return t=mesharray[a].children[i]}else if("Mesh"==mesharray[a].type){if(""===mesharray[a].name)continue;if(mesharray[a].name==e)return t=mesharray[a]}return t},this.getmarkupMeshByName=function(e){var t=null;return null==r.getmodelGroup()||null==r.getmarkupScene()?t:t=r.scene.children[r.markupidx].getObjectByName(e,!0)},this.getMeshByName=function(e){var t=null;return null==r.getmodelGroup()?t:t=r.scene.children[r.modelidx].getObjectByName(e,!0)},this.getMeshChildren=function(){return null==r.getmodelGroup()?[]:r.scene.children[r.modelidx].children},this.getAttachedMarkups=function(e){for(var t=[],a=r.getMarkupChildren(),i=0;i<a.length;i++)a[i].userData.connectedMesh==e&&t.push(a[i]);return t},this.getBelowIntersections=function(e,t){var a=[],i=[],s=r.getfloorheight(),n=t-s,o=e.z-n;o>s&&(s=o+.1*o);var l=new THREE.Vector3(0,0,-1).normalize(),c=(new THREE.Vector3(0,0,1).normalize(),r.getMeshChildren()),h=r.getAddedMeshChildren(),u=new THREE.Raycaster(e,l,0,s);i=u.intersectObjects(c,!0);for(var d=0;d<i.length;d++)i[d].object.visible&&null!=i[d].face&&i[d].distance<s&&a.push(i[d]);for(var p=0;p<h.length;p++)for(i=u.intersectObjects(h[p],!0),d=0;d<i.length;d++)i[d].object.visible&&null!=i[d].face&&i[d].distance<s&&a.push(i[d]);return a},this.getmeterunit=function(){return 1==r.unit?1:0==r.unit?1e3:2==r.unit?3.3:3==r.unit?39.37:4==r.unit?100:void 0},this.getmminUnit=function(e){return 1==r.unit?e/1e3:0==r.unit?e:2==r.unit?e/25.4/12:3==r.unit?e/25.4:4==r.unit?e/10:void 0},this.getfloorheight=function(){return 1==r.unit?1.8:0==r.unit?1800:2==r.unit?5.9:3==r.unit?69:4==r.unit?180:void 0},this.setBlockRef=function(e){if(24==e.name.length){var t=v(e.name,e.type);-1!=(a=r.blocklistquick.indexOf(t))&&(e.userData.blockRef=a)}else if(22==e.name.length)-1!=(a=r.blocklistquick.indexOf(e.name))&&(e.userData.blockRef=a);else if(6==e.name.length){var a;-1!=(a=r.blocklistquick.indexOf(e.name))&&(e.userData.blockRef=a)}},this.checkNewHeight=function(e){var t=null,a=(r.getfloorheight(),0),i=null;if(e.length>0){for(var s=0;s<e.length;s++)if(e[s].object.visible&&null!=e[s].face){if(null==e[s].object.userData.blockRef&&r.setBlockRef(e[s].object),!e[s].object.userData.blockRef){a=e[s].distance,i=e[s].point.clone();break}var n=Number(r.blocklist[e[s].object.userData.blockRef].RxBimType);if(n>=31&&n<=36||23==n||3==n){a=e[s].distance,i=e[s].point.clone();break}}null!=i&&(t=i)}return{vec:t,dist:a}},this.checkfloorheightAll=function(e,t,a,i,s){var n=0,o=0,l=null;if(e.length>0){for(var c=0;c<e.length;c++)if(e[c].object.visible&&null!=e[c].face&&(null==e[c].object.userData.blockRef&&r.setBlockRef(e[c].object),e[c].object.userData.blockRef)){var h=Number(r.blocklist[e[c].object.userData.blockRef].RxBimType);if(h>=31&&h<=36||23==h||3==h){n=e[c].distance,l=e[c].point.clone();break}}o=Math.abs(t-n),null!=l&&(s=(new THREE.Vector3).copy(i.multiplyScalar(o).add(a)))}return s},this.checkfloorheight=function(){var e=null,t=r.getfloorheight(),a=r.getMeshChildren(),s=r.getAddedMeshChildren(),n=new THREE.Raycaster,o=i.camera.position.clone(),l=new THREE.Vector3(0,0,-1).normalize(),c=new THREE.Vector3(0,0,1).normalize();n.set(o,l);var h=n.intersectObjects(a,!0);e=r.checkfloorheightAll(h,t,o,c,e);for(var u=0;u<s.length;u++)h=n.intersectObjects(s[u],!0),e=r.checkfloorheightAll(h,t,o,c,e);return e},this.explode=function(e){if(r.doexplode){var t=r.getMeshChildren();if(0!=t.length){var a=r.getMarkupChildren(),i=r.getAddedMeshChildren(),s=r.originalpos.clone();if(0!=e){var n,o=Math.round(r.boxSize);for(e*=o*=15e-5,l=0;l<t.length;l++)x(t[l],e,this.pxplodefactor);if(i.length>0)for(h=0;h<i.length;h++)for(u=0;u<i[h].length;u++)x(i[h][u],e,this.pxplodefactor);r.explodebox=(new THREE.Box3).setFromObject(r.scene),r.explodeboxSize=r.explodebox.getSize(new THREE.Vector3).length(),r.explodeboxCenter=r.explodebox.getCenter(new THREE.Vector3),0!=this.pxplodefactor&&(p=(d=r.originalpos.clone()).multiplyScalar(this.pxplodefactor),r.scene.position.sub(p)),s.multiplyScalar(e),r.scene.updateMatrix(),r.pxplodefactor=e}else{if(t.length>0)for(var l=0;l<t.length;l++)b(t[l]);if(a.length>0)for(var c=0;c<a.length;c++)"Mesh"==(n=a[c]).type&&(n.position.x=n.userData.originalpositionX,n.position.y=n.userData.originalpositionY,n.position.z=n.userData.originalpositionZ);if(i.length>0)for(var h=0;h<i.length;h++)for(var u=0;u<i[h].length;u++)b(i[h][u]);if(0!=this.pxplodefactor){var d=r.originalpos.clone(),p=d.multiplyScalar(this.pxplodefactor);r.scene.position.sub(p)}this.pxplodefactor=0}}}},this.newExplode=function(e){if(r.doexplode&&!r.active3DView){var t=r.getMeshChildren();if(0!=t.length){var a=r.getAddedMeshChildren(),i=r.getMarkupChildren();if(0!=e){for(e*=.2,s=0;s<t.length;s++)D(t[s],e,r.pxplodefactor);if(a.length>0)for(l=0;l<a.length;l++)for(c=0;c<a[l].length;c++)D(a[l][c],e,r.pxplodefactor);r.scene.updateMatrix(),this.pxplodefactor,r.pxplodefactor=e}else{if(t.length>0)for(var s=0;s<t.length;s++){if("Group"==t[s].type)for(var n=0;n<t[s].children.length;n++)"Mesh"!=t[s].children[n].type&&"LineSegments"!=t[s].children[n].type||(t[s].children[n].position.x=0,t[s].children[n].position.y=0,t[s].children[n].position.z=0);"Mesh"==t[s].type&&(t[s].position.x=0,t[s].position.y=0,t[s].position.z=0)}if(i.length>0)for(var o=0;o<i.length;o++)"Mesh"==i[o].type&&(i[o].position.x=i[o].userData.originalpositionX,i[o].position.y=i[o].userData.originalpositionY,i[o].position.z=i[o].userData.originalpositionZ);if(a.length>0)for(var l=0;l<a.length;l++)for(var c=0;c<a[l].length;c++)b(a[l][c]);this.pxplodefactor=0}}}},this.setmeshTranspEx=function(e,t,a,i){a?i?("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.parent.userData.transparent,e.material.opacity=e.parent.userData.opacity):("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.userData.transparent,e.material.opacity=e.userData.opacity):"LineSegments"==e.type&&t<1?e.visible=!1:(e.userData.transparent,e.material.transparent=!0,e.material.opacity=t)},this.setintialTransp=function(e,t){null==e.userData.transparent&&(e.userData.transparent=t.material.transparent?1:0),null==e.userData.opacity&&(e.userData.opacity=t.material.opacity)},this.setmeshNoSelect=function(e,t){e.userData.temptransparent=!t},this.setmeshTransp=function(e,t,a,i){a?i?("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.parent.userData.transparent,e.userData.temptransparent=!1,e.material.opacity=e.parent.userData.opacity):("LineSegments"==e.type&&(e.visible=!0),e.material.transparent=1==e.userData.transparent,e.userData.temptransparent=!1,e.material.opacity=e.userData.opacity):i?0==e.parent.userData.transparent&&("LineSegments"==e.type&&t<1?e.visible=!1:(e.material.transparent=!0,e.userData.temptransparent=!0,e.material.opacity=t)):0==e.userData.transparent&&("LineSegments"==e.type&&t<1?e.visible=!1:(e.material.transparent=!0,e.userData.temptransparent=!0,e.material.opacity=t))},this.setBlockTransparencyOld=function(e,t,a){var i=r.getMeshChildren();if(0!=i.length){for(var s=0;s<i.length;s++){if("Group"==i[s].type)for(var n=0;n<i[s].children.length;n++)"Mesh"!=i[s].children[n].type&&"LineSegments"!=i[s].children[n].type||i[s].children[n].name==e&&(r.setintialTransp(i[s],i[s].children[n]),a?r.setmeshTranspEx(i[s].children[n],t,!1,!0):r.setmeshTranspEx(i[s].children[n],null,!0,!0));"Mesh"!=i[s].type&&"LineSegments"!=i[s].type||i[s].name==e&&(r.setintialTransp(i[s],i[s]),a?r.setmeshTranspEx(i[s],t,!1,!1):r.setmeshTranspEx(i[s],null,!0,!1))}r.doexplode=!0,0==t?r.explode(0):r.explode(.001),r.doexplode=!1,r.scene.updateMatrix()}},this.setBlockNoSelect=function(e,t){var a=r.getMeshByName(e);null!=a&&(t?r.setmeshNoSelect(a,!1):r.setmeshNoSelect(a,!0))},this.setBlockTransparency=function(e,t,a){var i=r.getMeshByName(e);null!=i&&("Group"==i.parent.type&&i.parent.uuid!=r.modeluuid?(r.setintialTransp(i.parent,i),a?r.setmeshTranspEx(i,t,!1,!0):r.setmeshTranspEx(i,null,!0,!0)):(r.setintialTransp(i,i),a?r.setmeshTranspEx(i,t,!1,!1):r.setmeshTranspEx(i,null,!0,!1)))},this.setTransparencyEx=function(e){r.setTransparency(e,!0)},this.setNoSelectAll=function(e){r.setNoSelect(e)},this.setNoSelectArray=function(e,t){for(var a=0;a<e.length;a++){if("Group"==e[a].type)for(var i=0;i<e[a].children.length;i++)"Mesh"!=e[a].children[i].type&&"LineSegments"!=e[a].children[i].type||(t?r.setmeshNoSelect(e[a].children[i],!1):r.setmeshNoSelect(e[a].children[i],!0));"Mesh"!=e[a].type&&"LineSegments"!=e[a].type||(t?r.setmeshNoSelect(e[a],!1):r.setmeshNoSelect(e[a],!0))}},this.setTransparencyArray=function(e,t,a){for(var i=0;i<e.length;i++){if("Group"==e[i].type)for(var s=0;s<e[i].children.length;s++)"Mesh"!=e[i].children[s].type&&"LineSegments"!=e[i].children[s].type||(r.setintialTransp(e[i],e[i].children[s]),a?r.setmeshTranspEx(e[i].children[s],t,!1,!0):r.setmeshTransp(e[i].children[s],t,!1,!0));"Mesh"!=e[i].type&&"LineSegments"!=e[i].type||(r.setintialTransp(e[i],e[i]),a?r.setmeshTranspEx(e[i],t,!1,!1):r.setmeshTransp(e[i],t,!1,!1))}},this.setExplodeTransparency=function(e){e?(r.doexplode=!0,0==value?r.newExplode(0):r.newExplode(.001),r.doexplode=!1):(r.doexplode=!0,r.newExplode(0),r.doexplode=!1)},this.setNoSelect=function(e){var t=r.getMeshChildren();if(0!=t.length){r.setNoSelectArray(t,e);for(var a=r.getAddedMeshChildren(),i=0;i<a.length;i++)r.setNoSelectArray(a[i],e)}},this.setTransparency=function(e,t){if(1!=e){var a=r.getMeshChildren();if(0!=a.length){r.setTransparencyArray(a,e,t);for(var i=r.getAddedMeshChildren(),s=0;s<i.length;s++)r.setTransparencyArray(i[s],e,t);r.scene.updateMatrix()}}else r.resetTransparency()},this.resetTransparencyArr=function(e){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"!=e[t].children[a].type&&"LineSegments"!=e[t].children[a].type||(r.setintialTransp(e[t],e[t].children[a]),r.setmeshTransp(e[t].children[a],null,!0,!0));"Mesh"!=e[t].type&&"LineSegments"!=e[t].type||(r.setintialTransp(e[t],e[t]),r.setmeshTransp(e[t],null,!0,!1))}},this.resetTransparency=function(){var e=r.getMeshChildren();if(0!=e.length){r.resetTransparencyArr(e);for(var t=r.getAddedMeshChildren(),a=0;a<t.length;a++)r.resetTransparencyArr(t[a]);r.scene.updateMatrix()}},this.createsymbolTextures=function(){for(var e=0;e<Ls.length;e++)Ls[e].canvas2=document.createElement("canvas"),Ls[e].canvas2.width=128,Ls[e].canvas2.height=128,Ls[e].context2=Ls[e].canvas2.getContext("2d"),"red"==Ls[e].color||"blue"==Ls[e].color||"green"==Ls[e].color?Ls[e].context2.drawImage(Ls[e].textureimage,15,0):Ls[e].context2.drawImage(Ls[e].textureimage,0,0),Ls[e].threeTexture=new THREE.Texture(Ls[e].canvas2),Ls[e].threeTexture.needsUpdate=!0,Ls[e].markupmaterial=new THREE.MeshBasicMaterial({map:Ls[e].threeTexture,side:THREE.DoubleSide}),Ls[e].markupmaterial.transparent=!0,Ls[e].markupmaterialblank=new THREE.MeshBasicMaterial({side:THREE.DoubleSide}),Ls[e].markupmaterialblank.transparent=!0},this.getfloorplantexture=function(e){for(var t=null,a=0;a<r.floorplanTextures.length;a++)r.floorplanTextures[a].floornum==e&&(t=r.floorplanTextures[a]);return t},this.addfloorplanTexture=function(e,t,a){if(0!=t.width&&0!=t.height){r.floorplanTextures=[];var i=t.width/t.height,s=t.width,n=t.height;t.width>t.height?(s=4096,n=2048):(s=2048,n=4096);var o=new Ks(null,s,n,"floor"+e);o.canvas2=document.createElement("canvas"),o.canvas2.width=t.width,o.canvas2.height=t.height,o.context2=o.canvas2.getContext("2d"),o.context2.drawImage(t,0,0),o.threeTexture=new THREE.CanvasTexture(o.canvas2),o.threeTexture.needsUpdate=!0,o.threeTexture.minFilter=THREE.LinearFilter,o.markupmaterial=new THREE.MeshBasicMaterial({map:o.threeTexture,side:THREE.DoubleSide}),o.markupmaterial.transparent=!1,o.markupmaterial.opacity=1,r.floorplanTextures.push({texture:o,floornum:e}),r.addfloorplanPlane(e,i,a)}else console.log("invalid canvas")},this.addfloorplanPlane=function(e,t,a){var s=r.box.max.x-r.box.min.x,n=r.box.max.y-r.box.min.y,o=s,l=n,c=0,h=0,u=r.box.max.z-r.box.min.z,d=o/l,p=i.floorplans[e].Scale,g=d/t;if(t>d?o=g>1?s*g:s/g:l=g>1?n*g:n/g,a){var m=a[1].dist/a[1].pwidth/(a[0].dist/a[0].pwidth),f=a[0].scaleinfo.scaledDistance,y=a[1].scaleinfo.scaledDistance;a[0].scaleinfo.curscale,a[1].scaleinfo.curscale,c=-.5*(s-(o/=m)),h=.5*(n-(l/=m));var v=f/y,b=a[1].offset.x*v,x=a[1].offset.y*v;c-=(b-a[0].offset.x)/p,h+=(x-a[0].offset.y)/p}for(var w=new THREE.PlaneBufferGeometry(o,l,4),k=0;k<r.floorplanTextures.length;k++)if(r.floorplanTextures[k].floornum==e)var D=r.floorplanTextures[k].texture;var C=r.getmminUnit(1),P=new THREE.Mesh(w,D.markupmaterial);P.position.copy(r.boxCenter),i.floorplans[e]&&(P.position.z=i.floorplans[e].Elevation+C),P.position.x+=c,P.position.y+=h;var S=P.position.x-.5*o,R=P.position.x+.5*o,M=P.position.y-.5*l,T=P.position.y+.5*l,E=r.box.min.z,F=r.box.max.z;r.curwidth<o&&(r.curwidth=o),r.curdepth<l&&(r.curdepth=l),r.curheight<u&&(r.curheight=u),r.curminx>S&&(r.curminx=S),r.curmaxx<R&&(r.curmaxx=R),r.curminy>M&&(r.curminy=M),r.curmaxy<T&&(r.curmaxy=T),r.curminz>E&&(r.curminz=E),r.curmaxz<F&&(r.curmaxz=F),r.setClippingPlanes(r.curwidth,r.curdepth,r.curheight,r.curminx,r.curmaxx,r.curminy,r.curmaxy,r.curminz,r.curmaxz),P.userData.signature=hs,P.userData.id=P.uuid,P.userData.type="floorplan",P.userData.floornum=e,r.markupscene.add(P),r.scene.updateMatrix()},this.scaleSymbol=function(){},this.add3DSymbol=function(e,t){var a=r.getmminUnit(400),s=new THREE.Vector3(0,0,0).sub(e.object.position),n=a,o=a/10,l=0,c=e.point,h=new THREE.Vector3;h.copy(r.scene.up),r.createsymbolTextures();for(var u=0;u<Ls.length;u++)Ls[u].color==t&&(l=u);e.object.up.set(h.x,h.y,h.z),e.object.geometry.computeVertexNormals();var d=e.face.normal.clone(),p=new THREE.Object3D;p.up.set(h.x,h.y,h.z),p.position.copy(c),d.transformDirection(e.object.matrixWorld),d.multiplyScalar(1),d.add(c),p.lookAt(d);var g=new THREE.BoxBufferGeometry(a,n,o),m=[Ls[l].markupmaterialblank,Ls[l].markupmaterialblank,Ls[l].markupmaterialblank,Ls[l].markupmaterialblank,Ls[l].markupmaterial,Ls[l].markupmaterial],f=new THREE.Mesh(g,m);f.userData.actionStatus=t,f.userData.signature=hs,f.userData.id=f.uuid,f.userData.type="symbol",f.userData.connectedMesh=e.object.uuid;var y=16776960;"red"==t?y=16711680:"blue"==t?y=255:"green"==t&&(y=65280),new THREE.MeshBasicMaterial({color:y,side:THREE.DoubleSide}),(new THREE.Vector3).copy(i.camera.position),f.rotation.copy(p.rotation),f.position.copy(c),f.geometry.computeBoundingSphere(),s=s.add(f.position.clone()),f.userData.originalpositionX=s.x,f.userData.originalpositionY=s.y,f.userData.originalpositionZ=s.z,r.markupscene.add(f),r.scene.updateMatrix(),null!=kt&&kt.setMarkupSelected(f.userData,{created:!0,modified:!1,deleted:!1}),null!=wt&&wt.setMarkupList(r.markupscene.children,Bs.bActive)},this.setSelectedPart=function(e){this.selectedpart=e},this.getPartAttributes=function(e){for(var t=void 0,a=0;a<r.blocklist.length;a++)r.blocklist[a].GlobalID===e&&(t=r.blocklist[a]);return t},this.getSelectedPart=function(){return this.selectedpart},this.Close=function(){for(u.clippingPlanes=ye;0!=this.partlist.length;)this.partlist.pop();for(;0!=this.blocklist.length;)this.blocklist.pop();for(;0!=this.scene.children.length;){var e=this.scene.children[this.scene.children.length-1];this.scene.remove(e),e=null}u.render(this.scene,i.camera)}}}class Al{constructor(e,t,a){for(var i=this,r=!1,s=a,n=new DataView(e),o=(String.fromCharCode(n.getUint8(0)),1);o<=15;)String.fromCharCode(n.getUint8(o)),o++;this.countparts=0,this.binaryreadcomplete=!1,this.selectedpart=-1,this.version=parseInt(n.getInt32(16,!0)),this.clippingOn=!1,this.x=parseFloat(n.getFloat32(24,!0)),this.y=parseFloat(n.getFloat32(28,!0)),this.z=parseFloat(n.getFloat32(32,!0)),this.w=parseFloat(n.getFloat32(36,!0))-this.x,this.h=parseFloat(n.getFloat32(40,!0))-this.y,this.d=parseFloat(n.getFloat32(44,!0))-this.z,this.w<1e3?this.unit=1:this.unit=0,this.orignalscale=parseFloat(n.getFloat32(48,!0)),n=null;var l=u.domElement.width/this.w,c=u.domElement.height/this.h;this.scale=Math.min(l,c),a.clock=new THREE.Clock,this.scene=new THREE.Scene;var h=Bs.Format.substring(0,3);"IFC"==h?this.scene.up.set(0,0,1):this.scene.up.set(0,1,0),this.explodefactor=0,this.pxplodefactor=0,this.partlist=[],this.blocklist=[];var d=this.scene.position.x,p=this.scene.position.y,g=this.scene.position.z;d+=-this.w/2*this.scale,p+=-this.h/2*this.scale,g+=-this.d/2*this.scale,this.scene.position.set(d,p,g),this.originalpos=new THREE.Vector3,this.originalpos=this.scene.position.clone(),this.scene.updateMatrix(),this.globalPlaneX=new THREE.Plane(new THREE.Vector3(1,0,0),0),this.globalPlaneY=new THREE.Plane(new THREE.Vector3(0,1,0),0),this.globalPlaneZ=new THREE.Plane(new THREE.Vector3(0,0,-1),0),this.globalPlanes=[this.globalPlaneX,this.globalPlaneY,this.globalPlaneZ],ye=Object.freeze([]),this.xPlaneconst=this.w*this.scale;var m=this.xPlaneconst/20;this.xPlaneconst+=m,this.xPlaneEnd=d,this.xPlaneStart=this.xPlaneconst-d,this.xPlaneEnd-=m/2,this.yPlaneconst=this.h*this.scale,m=this.yPlaneconst/20,this.yPlaneconst+=m,this.yPlaneEnd=p,this.yPlaneStart=this.yPlaneconst-p,this.yPlaneEnd-=m/2,this.zPlaneconst=this.d*this.scale,m=this.zPlaneconst/20,this.zPlaneconst+=m,this.zPlaneEnd=g,this.zPlaneStart=this.zPlaneconst-g,this.zPlaneEnd-=m/2,this.globalPlaneX.constant=this.xPlaneStart,this.globalPlaneY.constant=this.yPlaneStart,this.globalPlaneZ.constant=this.zPlaneStart,this.cameraSaves=[];var f=new THREE.DirectionalLight(16777215,1.2);f.position.set(-500,-500,500),this.scene.add(f);var y=new THREE.DirectionalLight(16777215,1);y.position.set(1e3,1e3,1e3),this.scene.add(y);var v=new THREE.DirectionalLight(16777215,.3);if(v.position.set(0,0,-1e3),this.scene.add(v),a.camera=new THREE.PerspectiveCamera(45,Na/Aa,.1,1e4),"IFC"==Bs.Format.substring(0,3)){var b=i.w/2*i.scale,x=-i.h*i.scale,w=i.d/2*i.scale;b=0,x*=2,w=0,a.camera.up.set(0,0,1)}else b=i.w/2*i.scale,x=i.h/2*i.scale,w=i.d*i.scale,b=0,x=0,w*=2,a.camera.up.set(0,1,0);a.camera.position.set(b,x,w),a.camera.lookAt(new THREE.Vector3(0,0,0)),this.scene.updateMatrix(),Sr=!1;var k=new DataView(e,52),D=parseInt(k.getInt32(0,!0)),C=-1;function P(){var t,a,r,s,n={objectid:D,blockpart:-1,bnewblock:!1,maindvpos:0,facecolor:0};t=n,a=200,r=function(){n=function(t){switch(t.objectid){case 9:t.maindvpos+=4;var a=k.getInt32(t.maindvpos,!0);t.maindvpos+=4;var r=36*a,s=new DataView(e,52+t.maindvpos,r);null!=i.partlist[t.blockpart]&&(i.partlist[t.blockpart].addpart(s,a,t.blockpart,t.facecolor,t.bnewblock),i.countparts++),t.maindvpos+=r,t.bnewblock=!1,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 10:t.maindvpos+=4;var n=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var o=t.maindvpos,l="";o<t.maindvpos+2*n;)0!=k.getUint8(o)&&(l+=String.fromCharCode(k.getUint16(o,!0))),o+=2;t.maindvpos=o;var c=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var u=t.maindvpos,d="";u<t.maindvpos+2*c;)0!=k.getUint8(u)&&(d+=String.fromCharCode(k.getUint16(u,!0))),u+=2;t.maindvpos=u,i.partlist[t.blockpart].addAtrib(l,d),t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 33:t.maindvpos+=4;var p=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var g=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var m=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var f=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var y=k.getFloat32(t.maindvpos,!0);t.maindvpos+=4;var v={X1:p,Y1:g,Z1:m,X2:f,Y2:y,Z2:k.getFloat32(t.maindvpos,!0)};null!=i.partlist[t.blockpart]&&(i.partlist[t.blockpart].addline(v,t.facecolor),i.countparts++),t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 74:t.maindvpos+=4,t.facecolor=parseInt(k.getInt32(t.maindvpos,!0)),t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 75:t.maindvpos+=4,C=parseInt(k.getInt32(t.maindvpos,!0)),i.partlist[t.blockpart].ifctype=C,t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 12288:if(t.maindvpos+=4,t.objectid=parseInt(k.getInt32(t.maindvpos,!0)),i.partlist.length>0&&"IFC"==h)switch(i.partlist[t.blockpart].ifctype){case 34:i.partlist[t.blockpart].visible=0;break;case 21:i.partlist[t.blockpart].tarray[i.partlist[t.blockpart].curTrset].triangles>5e3&&(i.partlist[t.blockpart].visible=0,i.partlist[t.blockpart].tempvisible=!1)}-1!=t.blockpart&&i.partlist.length>0&&i.partlist[t.blockpart].tarray.length>0&&i.partlist[t.blockpart].processmesh();break;case 4096:t.maindvpos+=4,t.blockpart=parseInt(k.getInt32(t.maindvpos,!0)),t.bnewblock=!0,t.maindvpos+=4,t.maindvpos+=4;var b=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var x=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var w=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;var D=parseInt(k.getInt32(t.maindvpos,!0));t.maindvpos+=4;for(var P=t.maindvpos,S="";P<t.maindvpos+2*D;)0!=k.getUint8(P)&&(S+=String.fromCharCode(k.getUint16(P,!0))),P+=2;t.maindvpos=P;var R={id:t.blockpart,visible:b,transparent:x,color:w,name:S};if("IFC"==h)var M=new jl(R,t.blockpart,i,!0);else(M=new Il(R,t.blockpart,i,!0)).addAtrib("Part name",S);i.partlist[t.blockpart]=M,t.objectid=parseInt(k.getInt32(t.maindvpos,!0));break;case 32768:i.partlist[i.partlist.length-1].setlastblock();break;default:t.objectid=32768,console.error("Failed!",t.objectid,t.maindvpos)}return t}(n)},s=function(){i.partlist[i.partlist.length-1].isLastBlock=!0,i.binaryreadcomplete=!0,k=null,Sr=!0,null!=Qt&&Qt.setDownload("hide"),i.partlist[i.partlist.length-1].isLoadComplete&&i.blockreadComplete(),i.updateblocklist()},function e(){for(var i=0;i<a;++i)r.call(null,t);32768!=t.objectid?setTimeout(e,0):s.call(null)}(),function e(){k&&32768!=n.objectid&&setTimeout(e,10)}()}s.has3Dnav?s.load3dnavigator():r=!0,this.blockadded=function(){i.countparts--,i.binaryreadcomplete&&0==i.countparts&&(i.blockreadComplete(),i.updateblocklist())},this.blockreadComplete=function(){null!=ft&&ft.readComplete(),a.DocRef.SetActive()},this.addblocks=function(e){this.blocklist=[],e.getElementsByTagName("navigator");for(var t=0,a=e.getElementsByTagName("partref"),i=0;i<a.length;i++){var r=a[i];for(t=0;"partref"==r.parentNode.nodeName;)r=r.parentNode,t++;if(null!=mt)var s=i*mt.listheight;else s=0;var n=a[i].attributes.getNamedItem("name").value,o=a[i].attributes.getNamedItem("index").value,l=a[i].attributes.getNamedItem("state").value,c=new Ol(n,o,l,t,s);this.blocklist.push(c)}P()},this.updateblocklist=function(){for(var e=0;e<this.blocklist.length;e++){var t=this.blocklist[e].index;null!=this.partlist[t]?this.blocklist[e].state=this.partlist[t].tempvisible:this.blocklist[e].state=!1,this.partlist[t].selected?this.blocklist[e].setSelected(!0):this.blocklist[e].setSelected(!1)}null!=mt&&(mt.isupdate=!0,mt.set3DParts(this.blocklist))},this.searchAttribute=function(e){for(var t=-1,a=0;a<i.partlist.length;a++)for(var r=i.partlist[a],s=0;s<r.attributes.length;s++)r.attributes[s].value==e&&(t=i.partlist[a].id);return t},this.addpartbinary=function(e,t){},this.addpart=function(e,t){var a=e.getElementsByTagName("part"),r=0;function s(e){setTimeout((function(){if(null!=e.attributes.getNamedItem("id"))var a=e.attributes.getNamedItem("id").value;var r=new jl(e,a,i);i.partlist[a]=r,r.hasmesh,Sr=t}),10)}for(;r<a.length;)s(a[r]),r++},this.clipping=function(e,t,a){if(i.clippingOn=a,a){u.clippingPlanes=i.globalPlanes;var r=t/100;switch(e){case 0:var s=i.xPlaneEnd+i.xPlaneconst*r;i.globalPlaneX.constant=s;break;case 1:s=i.yPlaneEnd+i.yPlaneconst*r,i.globalPlaneY.constant=s;break;case 2:s=i.zPlaneEnd+i.zPlaneconst*r,i.globalPlaneZ.constant=s}}else u.clippingPlanes=ye},this.doexplode=!1,this.saveCamera=function(){var e=new THREE.SphereBufferGeometry(10,32,32),t=new THREE.MeshBasicMaterial({color:16776960}),a=new THREE.Mesh(e,t),r=i.cameraSaves.length+1;a.name="markuppos_"+r,i.cameraSaves.push({position:s.camera.matrix.toArray(),name:a.name});var n=new THREE.Vector3;n.copy(s.camera.position),n.sub(i.scene.position),a.position.copy(n),i.scene.add(a)},this.restoreCameraName=function(e){for(var t=0;t<i.cameraSaves.length;t++)i.cameraSaves[t].name==e&&(s.camera.matrix.fromArray(i.cameraSaves[t].position),s.camera.matrix.decompose(s.camera.position,s.camera.quaternion,s.camera.scale))},this.restoreCamera=function(){if(i.cameraSaves.length>=1){var e=i.cameraSaves.pop();s.camera.matrix.fromArray(e.position),s.camera.matrix.decompose(s.camera.position,s.camera.quaternion,s.camera.scale)}},this.explode=function(e){if(i.doexplode){var t=i.originalpos.clone();if(0!=e){for(e/=10,l=0;l<i.scene.children.length;l++)if(""!==i.scene.children[l].name&&"Mesh"==i.scene.children[l].type&&null!=i.partlist[i.scene.children[l].name].center){var a=i.partlist[i.scene.children[l].name].vcentroid.clone();if(0!=this.pxplodefactor){var r=a.clone(),s=r.multiplyScalar(this.pxplodefactor);r.multiplyScalar(i.scale),i.scene.children[l].position.sub(s)}var n=a.multiplyScalar(e);n.multiplyScalar(i.scale),i.scene.children[l].position.add(n)}0!=this.pxplodefactor&&(h=(c=i.originalpos.clone()).multiplyScalar(this.pxplodefactor),i.scene.position.sub(h));var o=t.multiplyScalar(e);i.scene.position.add(o),i.scene.updateMatrix(),i.pxplodefactor=e}else{for(var l=0;l<i.scene.children.length;l++)"Mesh"==i.scene.children[l].type&&(i.scene.children[l].position.x=0,i.scene.children[l].position.y=0,i.scene.children[l].position.z=0);if(0!=this.pxplodefactor){var c=i.originalpos.clone(),h=c.multiplyScalar(this.pxplodefactor);i.scene.position.sub(h)}this.pxplodefactor=0}}},this.setTransparency=function(e){for(var t=0;t<i.scene.children.length;t++)"Mesh"==i.scene.children[t].type&&0==i.partlist[i.scene.children[t].name].transparent&&(i.scene.children[t].material.transparent=!0,i.scene.children[t].material.opacity=e);i.doexplode=!0,0==e?i.explode(0):i.explode(.001),i.doexplode=!1},this.resetTransparency=function(){for(var e=0;e<i.scene.children.length;e++)"Mesh"==i.scene.children[e].type&&0==i.partlist[i.scene.children[e].name].transparent&&(i.scene.children[e].material.transparent=!1,i.scene.children[e].material.opacity=1)},this.add3DSymbol=function(e,t){var a=new THREE.PlaneGeometry(5,20,32),i=new THREE.MeshBasicMaterial({color:16776960,side:THREE.DoubleSide});new THREE.Mesh(a,i)},this.setSelectedPart=function(e){this.selectedpart=e},this.getSelectedPart=function(){return this.selectedpart},this.Close=function(){for(;0!=this.partlist.length;)this.partlist.pop();for(;0!=this.blocklist.length;)this.blocklist.pop();for(;0!=this.scene.children.length;){var e=this.scene.children[this.scene.children.length-1];this.scene.remove(e),e=null}u.render(this.scene,a.camera)},r&&P()}}class Bl{constructor(e){var t=this;this.cx=0,this.cy=0,this.x=0,this.y=0,this.r=0,this.w=e.width,this.h=e.height,this.boxcenter=null,this.camerapos=null,this.cameraset=!1,this.canvas=e,this.strokecolor="rgba(211, 211, 211, 0.5)",this.xscaled=0,this.yscaled=0,this.wscaled=0,this.hscaled=0,this.pagerotation=0,this.linewidth=Math.max(this.w,this.h),this.selected=!1,this.editaction=0,this.setpageRotation=function(e){t.pagerotation=e},this.getcamera=function(e,t,a){var i=e.x-t,r=e.y-a;return i/=e.scale,r/=e.scale,{x:i=e.boxcenter.x-i,y:r=e.boxcenter.y+r,z:null}},this.setcamera=function(e){t.cx=e.x,t.cy=e.y,t.x=e.x,t.y=e.y,t.r=e.r,t.rotation=e.rotation;var a=e.boxcenter.x-e.camerapos.x,i=e.boxcenter.y-e.camerapos.y;t.x=e.x-a*e.scale,t.y=e.y+i*e.scale,t.cameraset=!0},this.setSize=function(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h},this.getRotatedMarkup=function(e,t,a,i,r){var s=Math.cos(r),n=Math.sin(r),o=a-e,l=i-t,c=new Gs(o*s-l*n,o*n+l*s);return c.x=e+c.x,c.y=t+c.y,c},this.eye=function(e,a,i,r,s,n,o,l){if(t.cameraset){e.save(),e.strokeStyle="black",e.fillStyle="rgba(0, 0, 255, 0.5)",e.lineWidth=1,t.canvas.width,t.canvas.height;var c=Math.PI+.375*Math.PI;(c-=(s.radians>0?s.radians:2*Math.PI+s.radians)-.5*Math.PI)<0?c+=2*Math.PI:c>2*Math.PI&&(c-=2*Math.PI);var h=c+.25*Math.PI;e.beginPath(),e.moveTo(a,i),e.arc(a,i,r,c,h),e.lineTo(a,i),e.arc(a,i,.25*r,0,2*Math.PI),e.fill(),e.restore()}},this.Rect=function(e,a,i,r,s,n,o){e.save(),e.strokeStyle="black",e.fillStyle=o,e.lineWidth=1;var l=t.canvas.width,c=t.canvas.height;e.beginPath(),e.moveTo(0,0),e.lineTo(l,0),e.lineTo(l,c),e.lineTo(0,c),e.lineTo(0,0),e.closePath(),e.moveTo(a,i),e.lineTo(a,i+s),e.lineTo(a+r,i+s),e.lineTo(a+r,i),e.lineTo(a,i),e.closePath(),e.fill(),e.stroke(),e.restore()},this.drawoffset=function(e,t,a){},this.drawme=function(e,a){var i=t.canvas.width,r=t.canvas.height;if(0!=t.pagerotation){var s=i/2,n=r/2;e.save(),e.translate(s,n),e.rotate(t.pagerotation*(Math.PI/180)),e.translate(-s,-n)}e.save(),a?t.eye(e,this.x,this.y,this.r,this.rotation,this.distancefromCenter,t.linewidth,t.strokecolor):t.Rect(e,this.x,this.y,this.w,this.h,t.linewidth,t.strokecolor),e.restore(),0!=t.pagerotation&&e.restore()},this.moveShape=function(e,a){var i=e,r=a;switch(t.pagerotation){case 0:i=e,r=a;break;case 90:i=a,r=-e;break;case 180:i=-e,r=-a;break;case 270:i=-a,r=e}var s=t.canvas.width,n=t.canvas.height;this.x=this.x-i,this.y=this.y-r;var o=this.x,l=this.y,c=this.w,h=this.h;(o-i<0||o+i>s)&&(this.x=this.x+i),(l-r<0||l-r>n)&&(this.y=this.y+r),(o+c-i<0||o+c-i>s)&&(this.x=this.x+i),(l+h-r<0||l+h-r>n)&&(this.y=this.y+r)},this.Getwithin=function(e,t,a,i,r,s){var n=!1;return e>a&&e<i&&t>r&&t<s&&(n=!0),n},this.GetwithinRect=function(e,t,a){var i=!1;return e>a.x&&e<a.w&&t>a.y&&t<a.h&&(i=!0),i},this.iswithin=function(e,a){var i=(d=t.canvas.width)/2,r=(p=t.canvas.height)/2,s=t.pagerotation*(Math.PI/180);switch(t.pagerotation){case 0:s=t.pagerotation*(Math.PI/180);break;case 90:s=(t.pagerotation+180)*(Math.PI/180);break;case 270:s=(t.pagerotation-180)*(Math.PI/180);break;case 180:s=t.pagerotation*(Math.PI/180)}var n=!1;if(0!=t.pagerotation){var o=t.getRotatedMarkup(i,r,e,a,s);e=o.x,a=o.y}var l=Math.min(this.x,this.x+this.w),c=Math.max(this.x,this.x+this.w),h=Math.min(this.y,this.y+this.h),u=Math.max(this.y,this.y+this.h);t.Getwithin(e,a,l,c,h,u)&&(n=!0,this.editaction=1);var d=t.canvas.width-2,p=t.canvas.height-2;return t.h>=p&&t.w>=d&&(n=!1),n}}}class Ul{constructor(e){var t=this;this.thumb=e,this.x0=0,this.y0=0;var a=0,i=0,r=0,s=0,n=0,o=0;function l(e){if(t.thumb.DocRef.pages[0].usevector3DGLTF&&t.thumb.floorplans.length>0)if("Walkthrough3D"==t.thumb.DocRef.curcontrol3D){var a=t.thumb.checkcurfloor(),i=t.thumb.getCurfloorElevation(a),r=t.thumb.birdseyemarker.getcamera(t.thumb.birdseyedispeye,e.xus,e.yus);r.z=i,t.thumb.set3dcamerapos(r),t.thumb.enableFloorcheck()}else"markupedit"==t.thumb.DocRef.curcontrol3D||(nd("Walkthrough3D",{}),a=t.thumb.checkcurfloor(),i=t.thumb.getCurfloorElevation(a),t.thumb.setbirdseyecamera(null,null,null),(r=t.thumb.birdseyemarker.getcamera(t.thumb.birdseyedispeye,e.xus,e.yus)).z=i,t.thumb.set3dcamerapos(r),t.thumb.enableFloorcheck(),t.thumb.DocRef.curcontrol3D="Walkthrough3D")}this.started=!1,this.operation=1,this.zoomUpdate=function(e,a,i,r){t.thumb.DocRef.bActive&&t.thumb.zoom_update(e,a,i,r)},this.panupdate=function(e,a){t.thumb.DocRef.bActive&&t.thumb.pan_update(e,a)},this.pointermove=function(e){t.MSPointerMove(e)},this.pointerdown=function(e){t.MSPointerDown(e)},this.pointerup=function(e){t.MSPointerUp(e)},this.MSPointerDown=function(e){if(t.thumb.birdseyeGUIindcnv&&t.thumb.DocRef.bActive){e.stopPropagation();var a=td(t.thumb.birdseyeGUIindcnv,e);t.x0=a.xus,t.y0=a.yus,2==e.button?(t.started=!0,t.operation=2,e.target.style.cursor="crosshair"):(t.thumb.birdseyemarker&&t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(a),n=t.x0,o=t.y0)}},this.mousedown=function(e){if(t.thumb.birdseyeGUIindcnv&&t.thumb.DocRef.bActive){e.preventDefault(),e.stopPropagation();var a=td(t.thumb.birdseyeGUIindcnv,e);t.x0=a.xus,t.y0=a.yus,2==e.button?(e.target.style.cursor="crosshair",t.started=!0,t.operation=2):(t.thumb.birdseyemarker&&(t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(a)),n=t.x0,o=t.y0)}},this.touchstart=function(e){if(t.thumb.DocRef.bActive){e.preventDefault(),t.started=!0;var a=ed(t.thumb.birdseyeGUIindcnv,e);t.operation=1,t.thumb.birdseyemarker&&(t.thumb.birdseyemarker.iswithin(a.xus,a.yus)&&(t.operation=1,t.started=!0),l(mousePos)),t.x0=a.xus,t.y0=a.yus,n=0,o=0}},this.MSPointerMove=function(e){if(t.thumb.DocRef.bActive&&(e.preventDefault(),e.stopPropagation(),2==t.operation&&(e.target.style.cursor="crosshair"),t.started)){var l=td(t.thumb.birdseyeGUIindcnv,e);if(a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),r=Math.abs(l.xus-t.x0),s=Math.abs(l.yus-t.y0),r&&s)if(2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF){if(1==t.operation){var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&t.panupdate(c,h),n=l.xus,o=l.yus}}else{var u="rgba(175, 175, 175, 0.3)";t.thumb.birdseyeGUIindctx.lineWidth=1,t.thumb.birdseyeGUIindctx.strokeStyle=u,t.thumb.birdseyeGUIindctx.fillStyle=u,t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height),t.thumb.birdseyeGUIindctx.fillRect(a,i,r,s)}}},this.mousemove=function(e){if(t.thumb.DocRef.bActive&&(e.stopPropagation(),t.started)){2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF||(e.target.style.cursor="crosshair");var l=td(t.thumb.birdseyeGUIindcnv,e);if(a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),r=Math.abs(l.xus-t.x0),s=Math.abs(l.yus-t.y0),r&&s)if(2!=t.operation||t.thumb.DocRef.pages[0].usevector3DGLTF){if(1==t.operation){var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&t.panupdate(c,h),n=l.xus,o=l.yus}}else{var u="rgba(175, 175, 175, 0.3)";t.thumb.birdseyeGUIindctx.lineWidth=1,t.thumb.birdseyeGUIindctx.strokeStyle=u,t.thumb.birdseyeGUIindctx.fillStyle=u,t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height),t.thumb.birdseyeGUIindctx.fillRect(a,i,r,s)}}},this.touchmove=function(e){if(t.thumb.DocRef.bActive&&(e.preventDefault(),t.started)){var l=ed(t.thumb.birdseyeGUIindcnv,e);a=Math.min(l.xus,t.x0),i=Math.min(l.yus,t.y0),r=Math.abs(l.xus-t.x0),s=Math.abs(l.yus-t.y0);var c=n-l.xus,h=o-l.yus;t.thumb.birdseyemarker&&1==t.operation&&t.panupdate(c,h),n=l.xus,o=l.yus}},this.mouseout=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height)))},this.MSPointerOut=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.thumb.birdseyeGUIindctx.clearRect(0,0,t.thumb.birdseyeGUIindcnv.width,t.thumb.birdseyeGUIindcnv.height)))},this.MSPointerUp=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.zoomUpdate(a,i,r,s)))},this.mouseup=function(e){t.thumb.DocRef.bActive&&(e.target.style.cursor="default",t.started&&(t.started=!1,2==t.operation&&t.zoomUpdate(a,i,r,s)))},this.touchcancel=function(e){t.thumb.DocRef.bActive&&t.started&&(t.started=!1)},this.touchend=function(e){t.thumb.DocRef.bActive&&t.started&&(t.started=!1)}}}class Gl{constructor(e,t,a,i){var r=this,s=U;this.DocRef=a,this.pagenumber=i,this.dxthumb=0,this.dythumb=0,this.dxthumbtemp=0,this.dythumbtemp=0,this.pageRendering=!1,this.dscalethumb=1,this.bserverthumbnail=!1,this.dscalebirdseye=1,this.pdftempthumbscale=1,this.pdfpagewidth=1,this.pdfpageheight=1,this.usefoxitthumb=!1,this.bautoloadthumbnails=Mi,this.bfinalsize=!1,this.floorplanWidth=4096,this.floorplanHeight=2048,this.birdseyeWidth=350,this.birdseyeHeight=275,this.floorplanimageWidth=1e3,this.floorplanimageHeight=1e3,this.floorplanreplaceScale=1,this.nav3dSize={width:0,height:0},this.birdseyeGUIimgcnv=null,this.birdseyeGUIindcnv=null,this.birdseyemarkupcnv=null,this.birdseyeGUIimgctx=null,this.birdseyeGUIindctx=null,this.birdseyemarkupctx=null,this.birdseyemarker=null,this.beventsSet=!1,this.birdseyedrawn=!1,this.floorplandrawn=!1,this.birdseyeEvents=void 0,this.floorelevation={min:null,max:null,index:0},this.camerapos=new THREE.Vector3(0,0,0),this.camerarot=new THREE.Euler(0,1,1.57,"XYZ"),this.boxcenter=new THREE.Vector3(0,0,0),this.floorplans=[],this.floorplanCallback=null,this.replacefloornavCallback=null,this.targetfloor=null,this.alignarray=null,this.floorplan3dobject=null,this.usefloorcheck=!0,this.birdseyedisprect={x:0,y:0,w:0,h:0},this.birdseyedispeye={x:0,y:0,r:0,scale:1,boxcenter:null,camerapos:null,rotation:0},this.birdseyeEventStates={started:!1,operation:1},this.birdseyeviewport=null,this.thumbnailviewport=null,this.floorplanviewport=null,this.floorplanrepviewport=null,this.LayoutName=t,this.title=this.LayoutName,null!=e.getElementsByTagName("PageName")[0]?this.PageName=e.getElementsByTagName("PageName")[0].firstChild.nodeValue:this.PageName=LayoutName,null!=e.getElementsByTagName("ThumbnailImageSRC")[0]&&null!=e.getElementsByTagName("ThumbnailImageSRC")[0].firstChild?(this.ThumbnailImageSRC=s+e.getElementsByTagName("ThumbnailImageSRC")[0].firstChild.nodeValue,this.bserverthumbnail=!0,this.bautoloadthumbnails=!0):this.bautoloadthumbnails=!1,null!=e.getElementsByTagName("VectorGLTF3DSRC")[0]&&(this.Vector3DSRC=encodeURI(s+e.getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue),this.usevector3Dxml=!0),null!=e.getElementsByTagName("Vector3DSRC")[0]&&(this.Vector3DSRC=encodeURI(s+e.getElementsByTagName("Vector3DSRC")[0].firstChild.nodeValue),this.usevector3Dxml=!0),null!=e.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailWidth=e.getElementsByTagName("ThumbnailWidth")[0].firstChild.nodeValue:this.ThumbnailWidth=Ui,null!=e.getElementsByTagName("ThumbnailWidth")[0]?this.ThumbnailHeight=e.getElementsByTagName("ThumbnailHeight")[0].firstChild.nodeValue:this.ThumbnailHeight=Gi,r.DocRef.Format.substring(0,9),this.thumbcanvas=document.createElement("canvas"),this.thumbcanvas.width=parseInt(this.ThumbnailWidth),this.thumbcanvas.height=parseInt(this.ThumbnailHeight),this.thumbctx=this.thumbcanvas.getContext("2d"),this.thumbloaded=this.bautoloadthumbnails,this.thumbnailobj={created:!1,thumbnail:document.createElement("canvas"),ctx:null,image:document.createElement("img"),imageData:null,canvasSource:document.createElement("img"),source:this.bautoloadthumbnails?this.ThumbnailImageSRC:null,name:this.PageName,number:i,displaynum:i+1,draw:function(e){r.thumbctx=e,r.draw_thumbnail()}},this.thumbnailobj.thumbnail.width=parseInt(this.ThumbnailWidth),this.thumbnailobj.thumbnail.height=parseInt(this.ThumbnailHeight),this.thumbnailobj.ctx=this.thumbnailobj.thumbnail.getContext("2d"),this.birdseyeobj={created:!1,birdseye:document.createElement("canvas"),ctx:null,rotation:0,dscalebirdseye:1,number:i},this.birdseyeobj.ctx=this.birdseyeobj.birdseye.getContext("2d"),this.floorplanobj={created:!1,floorplan:document.createElement("canvas"),ctx:null,rotation:0,dscalefloorplan:1,number:i},this.floorplanobj.ctx=this.floorplanobj.floorplan.getContext("2d"),this.ev_birdseye=function(e){if(e.layerX||0==e.layerY?(e._x=e.layerX,e._y=e.layerY):(e.offsetX||0==e.offsetY)&&(e._x=e.offsetX,e._y=e.offsetY),null!=r.birdseyeEvents){var t=r.birdseyeEvents[e.type];t&&t(e)}},this.disableFloorcheck=function(){r.usefloorcheck=!1},this.enableFloorcheck=function(){r.usefloorcheck=!0},this.connectCampos=function(e){e.walkthroughcontrol},this.setBirdseyeFloor=function(e){r.floorelevation.index!=e&&(r.floorelevation.index=e,r.birdseyedrawn=!1,r.set3DNavImage(2,!0)),r.disableFloorcheck()},this.setbirdseyecamera=function(e,t,a){if(r.birdseyeGUIindcnv&&r.DocRef.bActive&&!(null==a&&null==(a=r.DocRef.getBoxcenter())||null==e&&null==(e=r.DocRef.getBoxcenter()))){null==t&&(t={degrees:90,radians:.5*Math.PI}),r.birdseyedispeye.distance=e.distanceTo(a),r.birdseyedispeye.rotation=t;var i=r.birdseyeGUIindcnv.width,s=r.birdseyeGUIindcnv.height;r.birdseyedispeye.r=32,r.birdseyedispeye.x=.5*i,r.birdseyedispeye.y=.5*s,r.birdseyedispeye.scale=r.birdseyeobj.dscalebirdseye*r.floorplans[r.floorelevation.index].Scale,r.floorplans[r.floorelevation.index].replaced&&(r.birdseyedispeye.scale*=r.floorplans[r.floorelevation.index].replaceScale,r.birdseyedispeye.x+=-r.floorplans[r.floorelevation.index].offsetX,r.birdseyedispeye.y-=-r.floorplans[r.floorelevation.index].offsetY),r.birdseyedispeye.boxcenter=a,r.birdseyedispeye.camerapos=e,r.birdseyemarker.setcamera(r.birdseyedispeye);var n=r.checkcurfloor();r.floorelevation.index!=n&&(r.floorelevation.index=n,r.birdseyedrawn=!1,r.set3DNavImage(2,!1))}},this.birdseyecamera=function(){r.birdseyeGUIindcnv&&r.DocRef.bActive&&r.birdseyeGUIindctx&&(r.birdseyeGUIindctx.clearRect(0,0,r.birdseyeGUIindcnv.width,r.birdseyeGUIindcnv.height),r.birdseyemarker.drawme(r.birdseyeGUIindctx,!0))},this.birdseyerect=function(e){if(r.birdseyeGUIindcnv&&r.DocRef.bActive){var t=r.birdseyeGUIindcnv.width/e.w,a=r.birdseyeGUIindcnv.width,i=r.birdseyeGUIindcnv.height,s=Na-e.w,n=Aa-e.h;r.birdseyedisprect.w=s>0?a:a-Math.abs(s)*t,r.birdseyedisprect.h=n>0?i:i-Math.abs(n)*t,e.x>0?r.birdseyedisprect.x=0:r.birdseyedisprect.x=Math.abs(e.x)*t,e.y>0?r.birdseyedisprect.y=0:r.birdseyedisprect.y=Math.abs(e.y)*t,r.birdseyemarker.setSize(r.birdseyedisprect),r.birdseyeGUIindctx&&(r.birdseyeGUIindctx.clearRect(0,0,r.birdseyeGUIindcnv.width,r.birdseyeGUIindcnv.height),r.birdseyemarker.drawme(r.birdseyeGUIindctx,!1))}},this.set3dcamerapos=function(e){0!=r.DocRef.pages.lenght&&null!=r.DocRef.pages[r.pagenumber]&&r.DocRef.bActive&&r.DocRef.pages[0].usevector3DGLTF&&r.DocRef.pages[r.pagenumber].walkthroughcontrol.setCameraXYPos(e)},this.pan_update=function(e,t){if(0!=r.DocRef.pages.lenght&&null!=r.DocRef.pages[r.pagenumber]&&r.DocRef.bActive){var a=r.DocRef.pages[r.pagenumber].getpagerect().w/r.birdseyeGUIindcnv.width;e*=a,t*=a,r.DocRef.pages[r.pagenumber].pan_update(-e,-t)}},this.zoom_update=function(e,t,a,i){if(0!=r.DocRef.pages.lenght&&null!=r.DocRef.pages[r.pagenumber]&&r.DocRef.bActive){var s=r.DocRef.pages[r.pagenumber].getpagerect(),n=s.w/r.birdseyeGUIindcnv.width;e*=n,t*=n,a*=n,i*=n,e+=s.x,t+=s.y,r.DocRef.pages[r.pagenumber].zoom_update(e,t,a,i)}},this.setEventlisteners=function(){var e,t;null!=r.birdseyeGUIindcnv&&(r.birdseyeEvents=new Ul(r),e=r.birdseyeGUIindcnv,t=r.ev_birdseye,e.addEventListener("touchstart",t,!1),e.addEventListener("touchmove",t,!0),e.addEventListener("touchend",t,!1),e.addEventListener("touchcancel",t,!1),e.oncontextmenu=function(){return!1},Ri?(e.addEventListener("mousemove",t,!1),e.addEventListener("mousedown",t,!1),e.addEventListener("mouseup",t,!1),e.addEventListener("mouseout",t,!1)):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerMove",t,!1),e.addEventListener("MSPointerDown",t,!1),e.addEventListener("MSPointerUp",t,!1),e.addEventListener("MSPointerOut",t,!1)):(e.addEventListener("mousemove",t,!1),e.addEventListener("mousedown",t,!1),e.addEventListener("mouseup",t,!1),e.addEventListener("mouseout",t,!1)),r.beventsSet=!0)},this.setBirdseyeTool=function(){null!=r.birdseyeGUIindcnv&&(r.beventsSet||r.setEventlisteners())},this.setGUIbirdseyeCnv=function(e,t,a){null==r.birdseyeGUIimgcnv&&(r.birdseyeGUIimgcnv=e,r.birdseyeGUIindcnv=t,r.birdseyemarkupcnv=a,r.birdseyeGUIimgctx=r.birdseyeGUIimgcnv.getContext("2d"),r.birdseyeGUIindctx=r.birdseyeGUIindcnv.getContext("2d"),r.birdseyemarkupctx=r.birdseyemarkupcnv.getContext("2d")),r.setBirdseyeTool(),null==r.birdseyemarker&&(r.birdseyemarker=new Bl(r.birdseyeGUIindcnv))},this.getThumbnail=function(){return r.thumbnailobj},this.imageloadevent=function(e){r.thumbloaded=!0,r.bfinalsize=!0,r.thumbnailobj.ctx.drawImage(r.thumbnailobj.image,0,0),r.draw_thumbnail()},this.thumbload=function(){if(this.thumbnailobj.source){var e=new XMLHttpRequest;e.withCredentials=fi,e.open("GET",this.thumbnailobj.source,!0),e.responseType="blob",e.onload=function(t){var a=URL.createObjectURL(e.response);a&&(r.thumbnailobj.image.addEventListener("load",r.imageloadevent,!1),r.thumbnailobj.image.src=a)},e.send(null)}},this.setPDFdim=function(e,t){r.pdfpagewidth=e,r.pdfpageheight=t;var a=r.thumbnailobj.thumbnail.width/e,i=r.thumbnailobj.thumbnail.height/t;r.pdftempthumbscale=Math.min(a,i),r.setthumbnail(0,0,r.pdftempthumbscale)},this.setthumbnail=function(e,t,a){r.dxthumb=e,r.dythumb=t,r.dscalethumb=a,r.usevector3Dxml},this.drawcamerapos=function(){r.birdseyecamera()},this.camdirection=function(e){},this.setcamerapos=function(e,t,a){r.camerapos=e.clone(),r.boxcenter=a.clone(),r.setbirdseyecamera(r.camerapos,t,r.boxcenter)},this.getCurfloorElevation=function(e){if(null!=r.DocRef.pages[r.pagenumber].floorplans){var t=r.DocRef.getCurrentpage().Vector3DPageObj.getfloorheight();return r.floorplans[e].Elevation+t}return null},this.checkcurfloor=function(){var e=0;return r.DocRef.pages[r.pagenumber].Vector3DPageObj&&r.DocRef.pages[r.pagenumber].usevector3DGLTF&&(e=r.usefloorcheck?r.DocRef.pages[r.pagenumber].Vector3DPageObj.checkcurfloor():r.floorelevation.index),e},this.getfloor=function(e){null!=e&&0!=e.length&&(r.floorplans=e.slice(),r.floorelevation.index=r.checkcurfloor())},this.getfloorplanBsale=function(e,t,a,i){if(a>i)var r=e/a,s=t/i;else r=t/a,s=e/i;return Math.max(r,s),Math.max(r,s)},this.setFloorNavScaleOffset=function(e,t){r.getfloor(r.DocRef.pages[r.pagenumber].floorplans),r.floorplans[e].alignarray=t.slice();var a=t[0].dist/t[0].pwidth*r.floorplans[e].originalWidth,i=t[1].dist/t[1].pwidth*r.floorplans[e].width,s=(t[1].dist,t[1].pwidth,t[0].dist,t[0].pwidth,i/a),n=t[1].offset.x*r.floorplans[e].RScale,o=t[1].offset.y*r.floorplans[e].RScale;r.floorplans[e].BScale=r.getfloorplanBsale(r.birdseyeWidth,r.birdseyeHeight,r.floorplans[e].originalWidth,r.floorplans[e].originalHeight);var l=-(n-t[0].offset.x*s),c=-(o-t[0].offset.y*s);r.floorplans[e].offsetX=l,r.floorplans[e].offsetY=c,r.floorplans[e].replaceScale=s},this.setfloorplanreplace=function(e){r.floorplan3dobject=e},this.removefloorplanobject=function(){r.floorplan3dobject=null},this.setreplacefloornavCallback=function(e,t){r.replacefloornavCallback=e,r.targetfloor=t},this.removereplacefloornavCallback=function(){r.replacefloornavCallback=null,r.targetfloor=null},this.setfloorplanCallback=function(e,t,a){r.floorplanCallback=e,r.targetfloor=t,r.alignarray=a},this.removefloorplanCallback=function(){r.floorplanCallback=null,r.targetfloor=null,r.alignarray=null},this.set3DNavImage=function(e,t){if(null!=r.DocRef.pages[r.pagenumber].floorplans&&0!=r.DocRef.pages[r.pagenumber].floorplans.length&&(t||r.getfloor(r.DocRef.pages[r.pagenumber].floorplans),null!=r.floorplans[r.floorelevation.index])){if(2==e)var a=r.birdseyeWidth,i=r.birdseyeHeight;else 4==e&&(a=r.floorplans[r.floorelevation.index].width,i=r.floorplans[r.floorelevation.index].height);var s=r.floorplans[r.floorelevation.index].height,n=r.floorplans[r.floorelevation.index].width;if(n>s)var o=a/n,l=i/s;else o=i/n,l=a/s;var c=Math.max(o,l);r.birdseyeobj.dscalebirdseye=c,r.DocRef.pages[r.pagenumber].floorplans[r.floorelevation.index].BScale=c,2==e?r.birdseyedrawn||(r.birdseyeobj.birdseye.width=n*c,r.birdseyeobj.birdseye.height=s*c,r.birdseyeobj.ctx.drawImage(r.floorplans[r.floorelevation.index].canvas,0,0,r.birdseyeobj.birdseye.width,r.birdseyeobj.birdseye.height),r.birdseyedrawn=!0):4==e&&(r.birdseyeobj.birdseye.width=n,r.birdseyeobj.birdseye.height=s,r.birdseyeobj.ctx.drawImage(r.floorplans[r.floorelevation.index].canvas,0,0,r.birdseyeobj.birdseye.width,r.birdseyeobj.birdseye.height),r.birdseyedrawn=!0),r.drawGUIBirdseye(e)}},this.renderImage=function(e){if(2==e)var t=r.birdseyeWidth,a=r.birdseyeHeight;else 1==e?(t=r.ThumbnailWidth,a=r.ThumbnailHeight):3==e?(t=r.floorplanWidth,a=r.floorplanHeight):4==e&&(t=r.birdseyeWidth,a=r.birdseyeHeight);var i=r.DocRef.pages[r.pagenumber].SmallImageHeight,s=r.DocRef.pages[r.pagenumber].SmallImageWidth;if(r.birdseyeobj.rotation=r.DocRef.pages[r.pagenumber].drotation,s>i)var n=t/s,o=a/i;else n=a/s,o=t/i;var l=Math.max(n,o);r.birdseyeobj.dscalebirdseye=l,2==e?r.birdseyedrawn||(r.birdseyeobj.birdseye.width=s*l,r.birdseyeobj.birdseye.height=i*l,r.birdseyeobj.ctx.drawImage(r.DocRef.pages[r.pagenumber].smallimagecnv,0,0,r.birdseyeobj.birdseye.width,r.birdseyeobj.birdseye.height),r.birdseyedrawn=!0):1==e?(l=a/i,r.bserverthumbnail||(l=t/s,r.thumbnailobj.thumbnail.width=s*l,r.thumbnailobj.thumbnail.height=i*l,r.thumbnailobj.ctx.drawImage(r.DocRef.pages[r.pagenumber].smallimagecnv,0,0,r.thumbnailobj.thumbnail.width,r.thumbnailobj.thumbnail.height)),r.dxthumb=0,r.dythumb=0,r.dscalethumb=l,r.bfinalsize=!0,r.thumbloaded=!0,r.draw_thumbnail()):3==e?(r.floorplanobj.floorplan.width=s*l,r.floorplanobj.floorplan.height=i*l,r.floorplanobj.ctx.drawImage(r.DocRef.pages[r.pagenumber].smallimagecnv,0,0,r.floorplanobj.floorplan.width,r.floorplanobj.floorplan.height),r.floorplandrawn=!0):4==e&&(r.birdseyedrawn||(r.birdseyeobj.birdseye.width=s*l,r.birdseyeobj.birdseye.height=i*l,r.birdseyeobj.ctx.drawImage(r.DocRef.pages[r.pagenumber].smallimagecnv,0,0,r.birdseyeobj.birdseye.width,r.birdseyeobj.birdseye.height),r.birdseyedrawn=!0,r.floorplanreplaceScale=l)),r.drawGUIBirdseye(e)},this.refreshbirdseye=function(){r.birdseyedrawn=!1},this.renderVector=function(e){if(null!=r.DocRef.pages[r.pagenumber]){switch(e){case 1:var t=r.ThumbnailWidth,a=r.ThumbnailHeight;break;case 2:t=r.birdseyeWidth,a=r.birdseyeHeight;break;case 3:t=r.floorplanWidth,a=r.floorplanHeight;break;case 4:t=r.birdseyeWidth,a=r.birdseyeHeight}if(r.DocRef.pages[r.pagenumber].VectorPageObj){var i=r.DocRef.pages[r.pagenumber].VectorPageObj.height,s=r.DocRef.pages[r.pagenumber].VectorPageObj.width;if(r.birdseyeobj.rotation=r.DocRef.pages[r.pagenumber].drotation,s>i)var n=t/s,o=a/i;else n=a/s,o=t/i;var l=Math.max(n,o);r.birdseyeobj.dscalebirdseye=l,2==e?r.birdseyedrawn||(r.birdseyeobj.birdseye.width=s*l,r.birdseyeobj.birdseye.height=i*l,r.DocRef.pages[r.pagenumber].VectorPageObj.drawDirect(r.birdseyeobj.ctx,l,0,0,!1,!1,!1),r.birdseyedrawn=!0):1==e?(l=a/i,r.bserverthumbnail||(l=t/s,r.thumbnailobj.thumbnail.width=s*l,r.thumbnailobj.thumbnail.height=i*l,r.DocRef.pages[r.pagenumber].VectorPageObj.drawDirect(r.thumbnailobj.ctx,l,0,0,!1,!1,!1)),r.dxthumb=0,r.dythumb=0,r.dscalethumb=l,r.bfinalsize=!0,r.thumbloaded=!0,r.draw_thumbnail()):3==e?(r.floorplanobj.floorplan.width=s*l,r.floorplanobj.floorplan.height=i*l,r.DocRef.pages[r.pagenumber].VectorPageObj.drawDirect(r.floorplanobj.ctx,l,0,0,!1,!1,!1),function(e,t,a,i){var r=0;for(r=0;r<Bs.markuplist.length;r++)null!=Bs.markuplist[r]&&(Bs.markuplist[r].selected||Bs.markuplist[r].selectedit||Bs.markuplist[r].display&&null!=Bs.pages[Bs.markuplist[r].pagenumber]&&Bs.markuplist[r].drawfloorplan(e,t,a,i))}(r.floorplanobj.ctx,l,0,0),r.floorplandrawn=!0):4==e&&(r.birdseyedrawn||(r.birdseyeobj.birdseye.width=s*l,r.birdseyeobj.birdseye.height=i*l,r.DocRef.pages[r.pagenumber].VectorPageObj.drawDirect(r.birdseyeobj.ctx,l,0,0,!1,!1,!1),r.birdseyedrawn=!0,r.floorplanreplaceScale=l)),r.drawGUIBirdseye(e)}}},this.drawGUIBirdseye=function(e){2==e?null!=ct&&ct.setThumbnail(r.pagenumber,r):1==e?(null!=nt&&nt.setThumbnail(r.pagenumber,r),r.DocRef.refreshThumbnails()):3==e?r.floorplanCallback&&null!=r.targetfloor&&r.floorplanCallback(r.targetfloor,r.floorplanobj.floorplan,r.alignarray):4==e&&r.replacefloornavCallback&&null!=r.targetfloor&&r.replacefloornavCallback(r.targetfloor,r)},this.renderPDF=function(e){Mr&&2==e||r.pageRendering||(2==e&&(r.birdseyeobj.rotation=r.DocRef.pages[r.pagenumber].drotation),r.birdseyedrawn&&2==e||r.thumbnailobj.created&&1==e?r.drawGUIBirdseye(e):r.DocRef.pdfDoc.getPage(r.pagenumber+1).then((function(t){if(t.cleanupAfterRender=!0,0!=t.view[3])var a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),s=Math.abs(t.view[2]-t.view[0]);else a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),s=Math.abs(t.view[2]-t.view[0]);switch(t._pageInfo.rotate){case 0:break;case 90:a=i,i=s;break;case 180:break;case 270:a=i,i=s}if(2==e){var n=r.birdseyeWidth,o=r.birdseyeHeight;if(a>i)var l=n/a,c=o/i;else l=o/a,c=n/i;var h=Math.max(l,c);r.birdseyeobj.dscalebirdseye=h}else 1==e?(h=l=(n=r.ThumbnailWidth)/a,r.dxthumb=0,r.dythumb=0,r.dscalethumb=h):3==e?(n=r.floorplanWidth,o=r.floorplanHeight,a>i?(l=n/a,c=o/i):(l=o/a,c=n/i),h=Math.max(l,c),r.floorplanobj.dscalefloorplan=h):4==e&&(n=r.birdseyeWidth,o=r.birdseyeHeight,a>i?(l=n/a,c=o/i):(l=o/a,c=n/i),h=Math.max(l,c),r.birdseyeobj.dscalebirdseye=h,r.floorplanreplaceScale=h);var u=t.getViewport({scale:h});if(2==e){if(isNaN(u.height)||isNaN(u.width))return void(r.pageRendering=!1);r.birdseyeobj.birdseye.width=u.width,r.birdseyeobj.birdseye.height=u.height,r.birdseyeviewport=u;var d={canvasContext:r.birdseyeobj.ctx,viewport:r.birdseyeviewport}}else if(1==e){if(isNaN(u.height)||isNaN(u.width))return void(r.pageRendering=!1);r.thumbcanvas.width=u.width,r.thumbcanvas.height=u.height,r.thumbnailobj.thumbnail.width=u.width,r.thumbnailobj.thumbnail.height=u.height,r.thumbnailviewport=u,d={canvasContext:r.thumbnailobj.ctx,viewport:r.thumbnailviewport}}else if(3==e){if(isNaN(u.height)||isNaN(u.width))return void(r.pageRendering=!1);r.floorplanobj.floorplan.width=u.width,r.floorplanobj.floorplan.height=u.height,r.floorplanviewport=u,d={canvasContext:r.floorplanobj.ctx,viewport:r.floorplanviewport}}else if(4==e){if(isNaN(u.height)||isNaN(u.width))return void(r.pageRendering=!1);r.birdseyeobj.birdseye.width=u.width,r.birdseyeobj.birdseye.height=u.height,r.birdseyeviewport=u,d={canvasContext:r.birdseyeobj.ctx,viewport:r.birdseyeviewport}}var p=t.render(d);Mr=!0,r.pageRendering=!0,p.promise.then((function(){Mr=!1,r.pageRendering=!1,2==e?(r.birdseyedrawn=!0,r.drawGUIBirdseye(e)):1==e?(r.thumbloaded=!0,r.bfinalsize=!0,r.draw_thumbnail(),r.drawGUIBirdseye(e)):3==e?(r.floorplandrawn=!0,r.drawGUIBirdseye(e)):4==e&&(r.birdseyedrawn=!0,r.drawGUIBirdseye(e))}))})))},this.foxitcreatethumb=function(e){var t=document.createElement("canvas");t.width=parseInt(e.width),t.height=parseInt(e.height),t.getContext("2d"),r.thumbnailobj.thumbnail.width=e.width,r.thumbnailobj.thumbnail.height=e.height,r.thumbcanvas.width=e.width,r.thumbcanvas.height=e.height;var a=new Uint8ClampedArray(e.buffer);r.thumbnailobj.imageData=new ImageData(a,e.width,e.height),r.usefoxitthumb=!0,r.thumbloaded=!0,r.thumbnailobj.created=!0;var i=r.thumbnailobj.thumbnail.width/r.pdfpagewidth,s=r.thumbnailobj.thumbnail.height/r.pdfpageheight;r.pdftempthumbscale=Math.min(i,s),r.setthumbnail(0,0,r.pdftempthumbscale),r.bfinalsize=!0,null!=nt&&nt.setThumbnail(r.pagenumber,r)},this.clearBirdseyeMarkupctx=function(){null!=r.birdseyemarkupctx&&r.birdseyemarkupctx.clearRect(0,0,r.birdseyeobj.birdseye.width,r.birdseyeobj.birdseye.height)},this.draw_thumbnail=function(){if(r.thumbloaded)if(r.usefoxitthumb&&null!=r.thumbnailobj.imageData)r.thumbctx.clearRect(0,0,r.thumbnailobj.thumbnail.width,r.thumbnailobj.thumbnail.height),r.thumbctx.putImageData(r.thumbnailobj.imageData,0,0,0,0,r.thumbnailobj.thumbnail.width,r.thumbnailobj.thumbnail.height);else{if(!r.thumbnailobj.image.complete)return;r.thumbnailobj.thumbnail.width>0&&r.thumbnailobj.thumbnail.height>0&&(r.thumbctx.clearRect(0,0,r.thumbnailobj.thumbnail.width,r.thumbnailobj.thumbnail.height),r.thumbctx.drawImage(r.thumbnailobj.thumbnail,0,0))}},this.bautoloadthumbnails&&r.thumbload()}}class Hl{constructor(e,t){var a=this;if(this.pagenum=e,this.pageRendering=!0,this.pagePrinting=!1,this.visible=!1,this.pagescale=0,this.curpagescale=0,this.pageNumPending=0,this.pageloaded=!0,this.dxprint=0,this.dyprint=0,this.dscaleprint=1,this.startx=0,this.starty=0,this.endx=0,this.endy=0,this.paperobj=t,this.paperobj){t.width,t.height;var i=t.width/25.4*300,r=t.height/25.4*300}else this.paperobj={width:Hi,height:zi,printrect:Wi},t.width,t.height,i=t.width/25.4*300,r=t.height/25.4*300;this.setPDFdim=function(e,t,s){a.pageloaded=!0,a.dxprint=e,a.dyprint=t,a.dscaleprint=s,a.startx=a.dxprint,a.starty=a.dyprint,a.endx=i*a.dscaleprint+a.startx,a.endy=r*a.dscaleprint+a.starty,Qo(Li[a.pagenum],a.pagenum,a.dxprint,a.dyprint,a.dscaleprint)},this.queueRenderPage=function(){a.renderPDFpage()},this.renderPDFpage=function(){a.pageRendering=!0,a.pagePrinting=!0,null!=bd().docObj.pdfDoc&&bd().docObj.pdfDoc.getPage(a.pagenum+1).then((function(e){if(0!=e.view[3])var t=Math.abs(e.view[2]-e.view[0]),s=Math.abs(e.view[3]-e.view[1]),n=Math.abs(e.view[2]-e.view[0]);else t=Math.abs(e.view[2]-e.view[0]),s=Math.abs(e.view[3]-e.view[1]),n=Math.abs(e.view[2]-e.view[0]);switch(e._pageInfo.rotate){case 0:break;case 90:t=s,s=n;break;case 180:break;case 270:t=s,s=n}a.pagewidth=t,a.pageheight=s;var o=i/a.pagewidth,l=r/a.pageheight;a.pagescale=Math.min(o,l);var c=e.getViewport({scale:a.pagescale});a.curpagescale=a.pagescale,a.pdfdxtemp=0,a.pdfdytemp=0;var h={canvasContext:Li[a.pagenum],viewport:c};e.render(h).promise.then((function(){a.pageRendering=!1,a.pagescale,a.setPDFdim(a.pdfdxtemp,a.pdfdytemp,a.pagescale)}))}))}}}function zl(e){if(!e||0===e.items.length)return[];const t=[];let a={...e.items[0]},i=a.transform[5],r=a.transform[4],s=r+a.width,n=""!==a.str.trim()?a.width:0;for(let o=1;o<e.items.length;o++){const l=e.items[o],c=l.transform[5],h=l.transform[4],u=h+l.width,d=Math.abs(c-i)<.5,p=""===l.str.trim(),g=h-s,m=n/Math.max(a.str.trim().length,1)*1.5,f=p&&l.width<20;if(d&&(!p&&g>-.5&&g<=m||f))a.str+=l.str,a.width+=l.width,p?l.width<20&&(n+=l.width):(s=u,n+=l.width);else{const e=a.str,o=e.trimEnd(),d=e.length-o.length;if(d>0){const e=n/Math.max(o.length,1)*d;a.width-=e,n-=e}a.str=a.str.trim(),a.contentWidth=n,t.push(a);const p=""===l.str.trim();if(p&&l.width>20)continue;a={...l},i=c,r=h,s=u,n=p?0:l.width}}const o=a.str,l=o.trimEnd(),c=o.length-l.length;if(c>0){const e=n/Math.max(l.length,1)*c;a.width-=e,n-=e}return a.str=a.str.trim(),a.contentWidth=n,t.push(a),t}class Wl{constructor({textLayerDiv:e,pageIndex:t,viewport:a}){this.textLayerDiv=e,this.pageIndex=t,this.viewport=a,this.textContent=null,this.pixelratio=ll()}setTextContent(e){this.textContent=e}render(){if(!this.textContent||!this.viewport)return;const e=(this._measureCanvas=document.createElement("canvas")).getContext("2d"),t=this.textContent.items,a=this.textContent.styles,i=this.viewport.scale;t.forEach(t=>{if(!t.str||""===t.str.trim())return;const r=a[t.fontName]||{},s=r.fontFamily||"sans-serif",n=r.ascent||.8,o=Math.sqrt(t.transform[2]**2+t.transform[3]**2)*i;e.font=`${o}px ${s}`;const l=e.measureText(t.str).width,c=o*(t.width*i/l),h=/^\s+$/.test(t.str),u=t.width*i;if(h&&u>200)return;const[d,p]=this.viewport.convertToViewportPoint(t.transform[4],t.transform[5]),g=document.createElement("span");g.textContent=t.str,g.style.position="absolute",g.style.whiteSpace="pre",g.style.transformOrigin="0px 0px",g.style.fontFamily=s,g.style.fontSize=c+"px",g.style.left=d+"px",g.style.top=p-o*n+"px",g.style.width=t.width*i+"px",this.textLayerDiv.appendChild(g)})}}class _l{constructor(i,s,o,l,c,h){var d=this,p=U;Q&&(p=ae),this.DocRef=h,this.pagenumber=c,this.firstpage=o,this.camera=null,this.navcamera=null,this.birdseyemarker=null,this.bis3Dnavigator=!1,this.navfloorplan=null,this.camerapos=new THREE.Vector3(0,0,0),this.camerarot=new THREE.Euler(0,1,1.57,"XYZ"),this.boxcenter=new THREE.Vector3(0,0,0),this.birdseyedispeye={x:0,y:0,r:0,scale:1,boxcenter:null,camerapos:null,rotation:0},this.walkthroughcontrol={},this.currentimage=1,this.dx=0,this.dy=0,this.dscale=1,this.initialscale=1,this.scaleObject=new Yl,this.measurescale=Or,this.dxvector=0,this.dyvector=0,this.dxpdf=0,this.dypdf=0,this.dscalepdf=1,this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.useTextCallback=!0,this.curpagescale=1,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.role=0,this.bgpagewidth=0,this.bgpageheight=0,this.ovpageheight=0,this.ovpagewidth=0,this.overlayScale=1,this.overlayOffsetX=0,this.overlayOffsetY=0,this.backgroundScale=1,this.backgroundOffsetX=0,this.backgroundOffsetY=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=Mi,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.StoreyMetadata=[],this.hyperlinks=[],this.PDFsnapTransform=null,this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.dscalevector=1,this.fixedScale=1,this.vectorisrendered=!1,this.vectorischanged=!1,this.vectorstartrender=-1,this.vectorendrender=-1,this.vectorpagetime=-1,this.vectortimervar=null,this.bDorescaleonsizeChange=xi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.usedincomposite=!1,this.compositereference=void 0,this.compositePrintreference=void 0,this.isbackground=!1,this.isoverlay=!1,this.dxextent=0,this.dyextent=0,this.startx=0,this.starty=0,this.endx=0,this.endy=0,this.dscaleextent=1,this.bitmapratio=1,this.pagedimset=!1,this.dxprint=0,this.dyprint=0,this.dscaleprint=1,this.dxthumb=0,this.dythumb=0,this.dxthumbtemp=0,this.dythumbtemp=0,this.dscalethumb=1,this.pdftempthumbscale=1,this.drotation=0,this.pagelockrotation=0,this.textsearchindx=0,this.usevectorxml=!1,this.usevectorbinary=!1,this.usevectorbinarycompare=!1,this.loadbackgroundvectors=!1,this.loadoverlayvectors=!1,this.usepdfjs=!1,this.drawtextSearchRect=!1,this.usevector3Dxml=!1,this.usevector3Dbinary=!1,this.usevector3DGLTF=!1,this.has3Dnav=!1,this.pageloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.VectorPageObj=void 0,this.Vector3DPageObj=void 0,this.VectorPartfilelist=[],this.VectorBPartfilelist=[],this.largeimage=document.createElement("img"),this.smallimage=document.createElement("img"),this.smallimageloaded=!1,this.largeimageloaded=!1,this.vectorloaded=!1,this.rendercallback=!1,this.thumbnnailloaded=!1,this.CurrentMarkup=0,this.LayoutName=s;var g=null;null!=i.getElementsByTagName("PageName")[0]?this.PageName=i.getElementsByTagName("PageName")[0].firstChild.nodeValue:this.PageName=s,null!=i.getElementsByTagName("Compression")[0]&&(this.Compression=i.getElementsByTagName("Compression")[0].firstChild.nodeValue),null!=i.getElementsByTagName("DPI")[0]&&(this.DPI=i.getElementsByTagName("DPI")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetX")[0]&&(this.OffsetX=i.getElementsByTagName("OffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OffsetY")[0]&&(this.OffsetY=i.getElementsByTagName("OffsetY")[0].firstChild.nodeValue),null!=i.getElementsByTagName("OriginalScale")[0]&&(this.OriginalScale=i.getElementsByTagName("OriginalScale")[0].firstChild.nodeValue),null!=i.getElementsByTagName("VectorBinary2DSRC")[0]&&(this.Vector2DBinarySRC=encodeURI(p+i.getElementsByTagName("VectorBinary2DSRC")[0].firstChild.nodeValue),d.usevectorbinary=!0),null!=i.getElementsByTagName("OverlayComparemode")[0]&&(d.OverlayComparemode=parseInt(i.getElementsByTagName("OverlayComparemode")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("BckGrndDocindex")[0]&&(d.comparebgdocindex=parseInt(i.getElementsByTagName("BckGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("BckGrndPageindex")[0]&&(d.comparebgpageindex=parseInt(i.getElementsByTagName("BckGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("FrGrndDocindex")[0]&&(d.comparefgdocindex=parseInt(i.getElementsByTagName("FrGrndDocindex")[0].firstChild.nodeValue),null!=i.getElementsByTagName("FrGrndPageindex")[0]&&(d.comparefgpageindex=parseInt(i.getElementsByTagName("FrGrndPageindex")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0]&&(this.Vector2DBinarySRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCBckGrnd")[0].firstChild.nodeValue),d.usevectorbinarycompare=!0,d.loadbackgroundvectors=!0),null!=i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0]&&(this.Vector2DBinarySRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DBinarySRCFrGrnd")[0].firstChild.nodeValue),d.usevectorbinarycompare=!0,d.loadoverlayvectors=!0),null!=i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0]&&(this.Vector2DImageSRCBckGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCBckGrnd")[0].firstChild.nodeValue),d.usevectorbinarycompare=!0,d.loadbackgroundvectors=!1,d.loadbackgroundimage=!0,null!=i.getElementsByTagName("MainImageWidthBckGrnd")[0]&&(d.MainImageWidthBckGrnd=parseInt(i.getElementsByTagName("MainImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightBckGrnd")[0]&&(d.MainImageHeightBckGrnd=parseInt(i.getElementsByTagName("MainImageHeightBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingBckGrnd")[0]&&(d.MainImageScalingBckGrnd=parseInt(i.getElementsByTagName("MainImageScalingBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXBckGrnd")[0]&&(d.MainImageOffsetXBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYBckGrnd")[0]&&(d.MainImageOffsetYBckGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthBckGrnd")[0]&&(d.SmallImageWidthBckGrnd=parseInt(i.getElementsByTagName("SmallImageWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightBckGrnd")[0]&&(d.SmallImageHeightBckGrnd=parseInt(i.getElementsByTagName("SmallImageHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0]&&(this.Vector2DImageSRCFrGrnd=encodeURI(i.getElementsByTagName("Vector2DImageSRCFrGrnd")[0].firstChild.nodeValue),d.usevectorbinarycompare=!0,d.loadoverlayvectors=!1,d.loadoverlayimage=!0,null!=i.getElementsByTagName("MainImageWidthFrGrnd")[0]&&(d.MainImageWidthFrGrnd=parseInt(i.getElementsByTagName("MainImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageHeightFrGrnd")[0]&&(d.MainImageHeightFrGrnd=parseInt(i.getElementsByTagName("MainImageHeightFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageScalingFrGrnd")[0]&&(d.MainImageScalingFrGrnd=parseFloat(i.getElementsByTagName("MainImageScalingFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetXFrGrnd")[0]&&(d.MainImageOffsetXFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetXFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("MainImageOffsetYFrGrnd")[0]&&(d.MainImageOffsetYFrGrnd=parseInt(i.getElementsByTagName("MainImageOffsetYFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidthFrGrnd")[0]&&(d.SmallImageWidthFrGrnd=parseInt(i.getElementsByTagName("SmallImageWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageHeightFrGrnd")[0]&&(d.SmallImageHeightFrGrnd=parseInt(i.getElementsByTagName("SmallImageHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFBckGrnd")[0]&&(d.usevectorbinarycompare=!0,d.loadbackgroundvectors=!1,d.loadbackgroundpdf=!0,null!=i.getElementsByTagName("PDFWidthBckGrnd")[0]&&(d.PDFWidthBckGrnd=parseInt(i.getElementsByTagName("PDFWidthBckGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightBckGrnd")[0]&&(d.PDFHeightBckGrnd=parseInt(i.getElementsByTagName("PDFHeightBckGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("PDFFrGrnd")[0]&&(d.usevectorbinarycompare=!0,d.loadoverlayvectors=!1,d.loadoverlaypdf=!0,null!=i.getElementsByTagName("PDFWidthFrGrnd")[0]&&(d.PDFWidthFrGrnd=parseInt(i.getElementsByTagName("PDFWidthFrGrnd")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("PDFHeightFrGrnd")[0]&&(d.PDFHeightFrGrnd=parseInt(i.getElementsByTagName("PDFHeightFrGrnd")[0].firstChild.nodeValue))),null!=i.getElementsByTagName("Vector2DSRC")[0]&&(this.Vector2DSRC=encodeURI(p+i.getElementsByTagName("Vector2DSRC")[0].firstChild.nodeValue),this.usevectorbinary||(this.usevectorxml=!0));var m=!1;if(this.DocRef.PublisherVersion){var f=this.DocRef.PublisherVersion.split(".");parseInt(f[3].trim())>129&&(m=!0)}else m=!1;if(null!=i.getElementsByTagName("VectorBinary3DSRC")[0]&&(this.Vector3DBinarySRC=encodeURI(p+i.getElementsByTagName("VectorBinary3DSRC")[0].firstChild.nodeValue),this.usevector3Dbinary=!0,null!=i.getElementsByTagName("Navigator3DSRC")[0]&&(this.Navigator3DSRC=encodeURI(p+i.getElementsByTagName("Navigator3DSRC")[0].firstChild.nodeValue),this.has3Dnav=!0)),null!=i.getElementsByTagName("VectorGLTF3DSRC")[0]){if(this.Vector3DBinarySRC=encodeURI(p+i.getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue),null!=i.getElementsByTagName("VectorMetadataSRC")[0]&&(this.VectorMetadataSRC=encodeURI(p+i.getElementsByTagName("VectorMetadataSRC")[0].firstChild.nodeValue)),this.usevector3DGLTF=!0,this.usevector3Dxml=!0,this.usevector3Dbinary=!1,this.floorplans=[],null!=i.getElementsByTagName("Floorplan")[0]){var y=i.getElementsByTagName("Floorplan");for(O=0;O<y.length;O++){var v=y[O].getElementsByTagName("SRC")[0].firstChild.nodeValue,b="";null!=y[O].getElementsByTagName("Name")[0]&&null!=y[O].getElementsByTagName("Name")[0].firstChild.nodeValue&&(b=y[O].getElementsByTagName("Name")[0].firstChild.nodeValue),v=p+v;var x=parseFloat(y[O].getElementsByTagName("Elevation")[0].firstChild.nodeValue),w=parseFloat(y[O].getElementsByTagName("Scale")[0].firstChild.nodeValue),k=document.createElement("canvas"),D=k.getContext("2d"),C=document.createElement("canvas"),P=C.getContext("2d"),S=document.createElement("img");this.floorplans.push({index:O,SRC:v,Elevation:x,Name:b,Scale:w,BScale:w,RScale:w,replaceScale:1,image:S,canvas:k,ctx:D,thumbcanvas:C,thumbctx:P,thumbwidht:Ui,thumbheight:Gi,replaced:!1,originalWidth:0,originalHeight:0,width:0,height:0,offsetX:0,offsetY:0,alignarray:[]})}this.floorplans.sort((function(e,t){return e.Elevation-t.Elevation}))}if(null!=i.getElementsByTagName("Storey")[0])for(var R=i.getElementsByTagName("Storey"),M=0;M<R.length;M++)if(null!=R[M].getElementsByTagName("IDSRC")[0]){var T=encodeURI(p+R[M].getElementsByTagName("IDSRC")[0].firstChild.nodeValue);if(null!=R[M].getElementsByTagName("Name")[0])var E=R[M].getElementsByTagName("Name")[0].firstChild.nodeValue;if(null!=R[M].getElementsByTagName("GlobalID")[0])var F=R[M].getElementsByTagName("GlobalID")[0].firstChild.nodeValue;if(null!=R[M].getElementsByTagName("Elevation")[0])var I=R[M].getElementsByTagName("Elevation")[0].firstChild.nodeValue;E&&F&&this.StoreyMetadata.push({src:T,name:E,id:F,index:M,Elevation:I})}null!=i.getElementsByTagName("NavigatorJSONSRC")[0]&&(this.NavigatorJSONSRC=encodeURI(p+i.getElementsByTagName("NavigatorJSONSRC")[0].firstChild.nodeValue),this.has3Dnav=!0),null!=i.getElementsByTagName("Navigator3DSRC")[0]&&(this.Navigator3DSRC=encodeURI(p+i.getElementsByTagName("Navigator3DSRC")[0].firstChild.nodeValue),this.has3Dnav=!0)}if(null!=i.getElementsByTagName("Vector3DSRC")[0]&&(this.Vector3DSRC=encodeURI(p+i.getElementsByTagName("Vector3DSRC")[0].firstChild.nodeValue),this.usevector3Dbinary||(this.usevector3Dxml=!0),null!=i.getElementsByTagName("Parts3D")[0]))for(var j=i.getElementsByTagName("SRC"),O=0;O<j.length;O++)this.VectorPartfilelist[O]=encodeURI(p+j[O].firstChild.nodeValue);if("3"!=d.DocRef.Type&&"7"!=d.DocRef.Type||(this.TextSelectArea=document.createElement("div"),this.TextSelectArea.className="textLayer",this.TextSelectArea.addEventListener("wheel",od,!0),this.TextSelectArea.style.display="none"),"Adobe PDF"==d.DocRef.Format.substring(0,9)?(this.usepdfjs=!0,this.pagedrawCanvas=document.createElement("canvas"),this.pagedrawctx=this.pagedrawCanvas.getContext("2d"),this.pagecanvas=document.createElement("canvas"),this.pagectx=this.pagecanvas.getContext("2d"),this.magnifycanvas=document.createElement("canvas"),this.magnifypagectx=this.magnifycanvas.getContext("2d"),this.pageRendering=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=0,this.PDFTextArea=document.createElement("div"),this.textContent={},this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",od,!0),this.pdfpagetime=10,d.pdftimervar=setInterval((function(){d.pdftimer()}),d.pdfpagetime),this.viewport=null,this.magviewport=null,this.compareviewport=null):"ComparePage"==i||(null!=i.getElementsByTagName("MainImageSRC")[0]&&(this.MainImageSRC=encodeURI(p+i.getElementsByTagName("MainImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageSRC")[0]&&(this.SmallImageSRC=encodeURI(p+i.getElementsByTagName("SmallImageSRC")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("SmallImageWidth")[0]&&(this.SmallImageWidth=i.getElementsByTagName("SmallImageWidth")[0].firstChild.nodeValue,this.SmallImageWidth=parseInt(this.SmallImageWidth)),null!=i.getElementsByTagName("SmallImageHeight")[0]&&(this.SmallImageHeight=i.getElementsByTagName("SmallImageHeight")[0].firstChild.nodeValue,this.SmallImageHeight=parseInt(this.SmallImageHeight)),null!=i.getElementsByTagName("SmallImageScaling")[0]&&(this.SmallImageScaling=i.getElementsByTagName("SmallImageScaling")[0].firstChild.nodeValue,this.SmallImageScaling=parseFloat(this.SmallImageScaling))),"ComparePage"==i||(null!=i.getElementsByTagName("ThumbnailImageSRC")[0]&&null!=i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild&&(this.ThumbnailImageSRC=p+i.getElementsByTagName("ThumbnailImageSRC")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageWidth")[0]&&(this.MainImageWidth=i.getElementsByTagName("MainImageWidth")[0].firstChild.nodeValue,this.MainImageWidth=parseInt(this.MainImageWidth)),null!=i.getElementsByTagName("MainImageHeight")[0]&&(this.MainImageHeight=i.getElementsByTagName("MainImageHeight")[0].firstChild.nodeValue,this.MainImageHeight=parseInt(this.MainImageHeight)),null!=i.getElementsByTagName("MainImageScaling")[0]&&(this.MainImageScaling=i.getElementsByTagName("MainImageScaling")[0].firstChild.nodeValue,this.MainImageScaling=parseFloat(this.MainImageScaling)),null!=i.getElementsByTagName("MainImageOffsetX")[0]&&(this.MainImageOffsetX=i.getElementsByTagName("MainImageOffsetX")[0].firstChild.nodeValue),null!=i.getElementsByTagName("MainImageOffsetY")[0]&&(this.MainImageOffsetY=i.getElementsByTagName("MainImageOffsetY")[0].firstChild.nodeValue)),this.largeimagecnv=document.createElement("canvas"),this.largeimagectx=this.largeimagecnv.getContext("2d",{willReadFrequently:!0}),this.smallimagecnv=document.createElement("canvas"),this.smallimagectx=this.smallimagecnv.getContext("2d",{willReadFrequently:!0}),"ComparePage"==i?(this.ThumbnailWidth=180,this.ThumbnailHeight=250):(null!=i.getElementsByTagName("ThumbnailWidth")[0]&&(this.ThumbnailWidth=i.getElementsByTagName("ThumbnailWidth")[0].firstChild.nodeValue),null!=i.getElementsByTagName("ThumbnailWidth")[0]&&(this.ThumbnailHeight=i.getElementsByTagName("ThumbnailHeight")[0].firstChild.nodeValue)),null!=i.getElementsByTagName("Hyperlink")[0])for(var L={x1:0,x2:0,y1:0,y2:0,page:0,dx1:0,dx2:0,dy1:0,dy2:0},V=i.getElementsByTagName("Hyperlink"),N=0;N<V.length;N++)null!=V[N].getElementsByTagName("x1")[0]&&(L.x1=V[N].getElementsByTagName("x1")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("x2")[0]&&(L.x2=V[N].getElementsByTagName("x2")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("y1")[0]&&(L.y1=V[N].getElementsByTagName("y1")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("y2")[0]&&(L.y2=V[N].getElementsByTagName("y2")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("page")[0]&&(L.page=V[N].getElementsByTagName("page")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("dx1")[0]&&(L.dx1=V[N].getElementsByTagName("dx1")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("dx2")[0]&&(L.dx2=V[N].getElementsByTagName("dx2")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("sy1")[0]&&(L.dy1=V[N].getElementsByTagName("sy1")[0].firstChild.nodeValue),null!=V[N].getElementsByTagName("dy2")[0]&&(L.dy2=V[N].getElementsByTagName("dy2")[0].firstChild.nodeValue),d.hyperlinks.push(new Cl(L));this.printcanvas=document.createElement("canvas"),this.printctx=this.printcanvas.getContext("2d"),this.print3Dimage=document.createElement("img"),this.printobj={pagenumber:d.pagenumber,paperimage:d.printcanvas,paperwidth:297,paperheight:210,docwidth:1,docheight:1,inchtomm:25.4,DPI:300,scrDPI:96,scaleSet:!1,pdx:0,pdy:0,pscale:1,printctx:d.printctx,setRes:function(e){this.DPI=e},setPaperSize:function(e,t){this.paperwidth=e,this.paperheight=t,this.paperimage.width=e/this.inchtomm*this.DPI,this.paperimage.height=t/this.inchtomm*this.DPI},setDocSize:function(e,t){this.docwidth=e,this.docheight=t},setScale:function(e){if(null!=e){var t=e.x+e.w/2,a=e.y+e.h/2,i=this.paperimage.width/e.w,r=this.paperimage.height/e.h;this.pscale=Math.min(i,r),this.pdx=-t*this.pscale+this.paperimage.width/2,this.pdy=-a*this.pscale+this.paperimage.height/2}else i=this.paperimage.width/this.docwidth,r=this.paperimage.height/this.docheight,this.pscale=Math.min(i,r),this.pdx=(this.paperimage.width-this.docwidth*this.pscale)/2,this.pdy=(this.paperimage.height-this.docheight*this.pscale)/2;this.scaleSet=!0},print:function(){this.scaleSet&&(d.usepdfjs||(d.usevectorxml?d.draw_vectorPrint():d.usevector3Dxml?(d.print3Dimage.addEventListener("load",d.load3Dimage,!1),d.print3Dimage.src=u.domElement.toDataURL()):d.draw_imagePrint()))}};function A(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e}function B(e){var t=-1,a=e.split("(");if("scaleX"==a[0]){var i=a[1].split(")");t=parseFloat(i[0])}return t}function G(e,t,a){var i=a.replace(t,""),r=document.createTextNode(i),s=document.createElement("span");s.className="highlight";var n=document.createTextNode(t);s.appendChild(n),e.innerHTML="",e.appendChild(r),e.appendChild(s)}function H(e,t,a){return e.y>=0&&e.y+e.h<=a&&e.x>=0&&e.x+e.w<=t}function z(e,t,a,i){const r=ll();return{x:e/r,y:t/r,w:a/r,h:i/r}}function W(e,t){d.usevectorxml?(d.dxvector=e.dx,d.dyvector=e.dy,d.dscalevector=e.dscale,d.startx=e.startx,d.starty=e.starty,d.endx=e.endx,d.endy=e.endy,d.draw_vector(!1),t?d.vectorscrollbuffer(d.dscalevector,d.dxvector,d.dyvector):d.vectorischanged=!0,d.DocRef.textselect&&(d.cleartextdivs(),d.settextdivs())):d.usepdfjs?(d.dxpdf=e.dx,d.dypdf=e.dy,d.setpdfScale(e.dscale),d.startx=e.startx,d.starty=e.starty,d.endx=e.endx,d.endy=e.endy,d.pdfrenderopque+=1,d.pdfisrendered=!1,d.offscreenwidth,d.pdfpagewidth,d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf(!1),d.DocRef.textselect&&(d.PDFTextArea.style.display="none",d.renderPDFpagescaleTextnew())):(d.dx=e.dx,d.dy=e.dy,d.dscale=e.dscale,d.startx=e.startx,d.starty=e.starty,d.endx=e.endx,d.endy=e.endy,d.checkimageswitch(),0==d.DocRef.Type?d.DocRef.draw_mpage():d.draw_image(!0))}function _(){if(d.usevectorxml&&null!=d.VectorPageObj)var e={dscale:d.dscalevector,dx:d.dxvector,dy:d.dyvector,width:d.VectorPageObj.width,height:d.VectorPageObj.height};else e=d.usepdfjs?{dscale:d.dscalepdf,dx:d.dxpdf,dy:d.dypdf,width:d.pdfpagewidth,height:d.pdfpageheight}:{dscale:d.dscale,dx:d.dx,dy:d.dy,width:d.MainImageWidth,height:d.MainImageHeight};return e}function X(e,t,a,i){var r=(Na-a.width*a.dscale)/2,s=(Aa-a.height*a.dscale)/2,n=r-a.dx,o=s-a.dy;a.dscale=i?a.dscale*t:a.dscale/t;var l=(Na-a.width*a.dscale)/2,c=(Aa-a.height*a.dscale)/2;e?(a.dx=l,a.dy=c):i?(a.dx=l-n*t,a.dy=c-o*t):(a.dx=l-n/t,a.dy=c-o/t);var h=a.dx,u=a.dy,p=a.width*a.dscale+h,g=a.height*a.dscale+u;return d.setpagedimsize(h,u,p,g,!0),{dscale:a.dscale,dx:a.dx,dy:a.dy,startx:h,starty:u,endx:p,endy:g}}function Y(){al(n),il(a);var e=d.DocRef.getThumb(d.pagenumber);null!=e&&e.birdseyerect(d.getpagerect())}this.setpagedimsize=function(e,t,a,i,r){r?(d.startx=e,d.starty=t,d.endx=a,d.endy=i):(d.startx=e,d.starty=t,d.endx=a+e,d.endy=i+t);var s=d.DocRef.getThumb(d.pagenumber);null!=s&&s.birdseyerect({x:d.startx,y:d.starty,w:d.endx,h:d.endy})},this.getwidth=function(){return d.offscreenwidth},this.getheight=function(){return d.offscreenheight},this.transparentpdfCompare=function(e){var t=0;try{var a=d.pagectx.getImageData(0,0,d.pagecanvas.width,d.pagecanvas.height)}catch(e){alert("Error 1 - "+e),console.log(e,d.pagecanvas.width,d.pagecanvas.height),t=-1}e?d.setinvert(a.data):d.transparent(a.data),0==t&&d.pagectx.putImageData(a,0,0)},this.invertpdfCompare=function(e){var t=0;try{var a=d.pagectx.getImageData(0,0,d.pagecanvas.width,d.pagecanvas.height)}catch(e){alert("Error 1 - "+e),console.log(e,d.pagecanvas.width,d.pagecanvas.height),t=-1}var i=d.compositereference.getColors();if(e)d.setinvert(a.data);else switch(d.role){case 1:d.setcolor(a.data,i.bg);break;case 2:d.setcolor(a.data,i.fg)}0==t&&d.pagectx.putImageData(a,0,0)},this.initCompare=function(){1==d.role?(d.DocRef=d.compositereference.pages[0].DocRef,d.pdfpagewidth=d.compositereference.pages[0].pdfpagewidth,d.pdfpageheight=d.compositereference.pages[0].pdfpageheight,d.bgpagewidth=d.compositereference.pages[0].pdfpagewidth,d.bgpageheight=d.compositereference.pages[0].pdfpageheight,d.backgroundScale=d.compositereference.pages[0].getdscale(),d.backgroundOffsetX=d.compositereference.pages[0].getdx(),d.backgroundOffsetY=d.compositereference.pages[0].getdy(),d.getPDFdimensions(),d.dxpdf=d.backgroundOffsetX,d.dypdf=d.backgroundOffsetY,d.pdfisrendered=!1):2==d.role&&(d.DocRef=d.compositereference.pages[1].DocRef,d.pdfpagewidth=d.compositereference.pages[1].pdfpagewidth,d.pdfpageheight=d.compositereference.pages[1].pdfpageheight,d.ovpageheight=d.compositereference.pages[1].pdfpageheight,d.ovpagewidth=d.compositereference.pages[1].pdfpagewidth,d.overlayScale=d.compositereference.pages[1].getdscale(),d.overlayOffsetX=d.compositereference.pages[1].getdx(),d.overlayOffsetY=d.compositereference.pages[1].getdy(),d.getPDFdimensions(),d.dxpdf=d.overlayOffsetX,d.dypdf=d.overlayOffsetY,d.pdfisrendered=!1)},this.movepage=function(e){d.pagenumber=e,this.dxpdf=0,this.dypdf=0,this.setpdfScale(1),this.dscalebackup=1,this.pdfpageref=null,this.renderTask=null,this.rendercancel=!1,this.magnifyrestscale=1,this.dscalepdfabs=1,this.dxbackup=0,this.dybackup=0,this.resizepan=!1,this.curpagescale=1,this.curpagescalebackup=1,this.pdfpageheight=0,this.pdfpagewidth=0,this.bMaxzoom=!1,this.bMinzoom=!1,this.nPDFMaxFactor=4,this.pdfisrendered=!1,this.textareaset=!1,this.pdfrenderopque=0,this.pdfisfirstrendered=!1,this.offscreenwidth=0,this.offscreenheight=0,this.pdfstartrender=-1,this.pdfendrender=-1,this.pdfpagetime=-1,this.rxdrawtimestart=0,this.rxdrawtimeend=0,this.scrollzoomtime=0,this.scrollzoominterval=0,this.scrollzoomarray=[],this.debounce_timer=void 0,this.vectordebounce_timer=void 0,this.bautoloadthumbnails=Mi,this.pdftimervar=null,this.PDFTextArea=void 0,this.PDFPointArray=[],this.PDFsnapTransform=null,this.bpointlistSet=!1,this.PDFinternalScale=1,this.PDFpageRotate=0,this.pdfSnapScale=1,this.TextSelectArea=void 0,this.snapEnabled=!1,this.bDorescaleonsizeChange=xi,this.width=0,this.height=0,this.originalwidth=0,this.originalheight=0,this.OriginalScale=1,this.initialzoom=1,this.visible=!1,this.startx=0,this.starty=0,this.endx=0,this.endy=0,this.drotation=0,this.pagelockrotation=0,this.textsearchindx=0,this.drawtextSearchRect=!1,this.pageloaded=!1,this.pageloading=!1,this.pdfdiminitset=!1,this.usepdfjs&&(this.bautoloadthumbnails=!1,this.tilespending=!1,this.canvtileArray=[],this.annotArray=[],this.pageRendering=!1,this.pdfisrendered=!1,this.pagePrinting=!1,this.pageNumPending=null,this.pagescale=1.5,this.markupscaleadjust=1,this.pdfdxtemp=0,this.pdfdytemp=0,this.pdfdscaletemp=0,this.PDFTextArea=document.createElement("div"),this.PDFTextArea.className="textLayer",this.PDFTextArea.addEventListener("wheel",od,!0),this.pdfpagetime=10,this.viewport=null,this.magviewport=null,this.compareviewport=null,this.documentpageScale(d.DocRef.PDFDocumentPageScale,!0),this.getPDFdimensions(!0))},this.setMeasureScaledirect=function(e){d.measurescale=e},this.getMeasureScale=function(){return d.measurescale},this.setCalibration=function(e){return e?0!=Nr&&(Lr=1/(Lr=Vr/Nr),d.measurescale=Lr):Lr=1,Y(),Lr},this.setCalibrateScale=function(e){d.measurescale=e,Y()},this.setMeasureScale=function(e){var t=0,a=0;if("Calibration"!=e){var i=e.split(":");t=i[0],a=i[1],d.measurescale=Ts?a/t:t/a}else d.measurescale=Lr;Y()},this.rotatedRect=function(){var e=this.startx,t=this.starty,a=this.endx,i=this.endy,r=this.drotation*(Math.PI/180),s=Math.cos(r),n=Math.sin(r),o=Na/2,l=Aa/2,c=e-o,h=t-l,u=c*s-h*n,d=c*n+h*s;u=o+u,d=l+d;var p=(c=a-o)*s-(h=i-l)*n,g=c*n+h*s;return p=o+p,g=l+g,{x:Math.min(u,p),y:Math.min(d,g),w:Math.max(p,u),h:Math.max(g,d)}},this.load3Dimage=function(e){d.printobj.printctx.drawImage(e.currentTarget,d.printobj.pdx,d.printobj.pdy,d.printobj.docwidth*d.printobj.pscale,d.printobj.docheight*d.printobj.pscale),Qo(d.printobj.printctx,d.pagenumber,d.printobj.pdx,d.printobj.pdy,d.printobj.pscale)},this.floorplanloadevent=function(e){var t,a;t=e.srcElement.naturalWidth,a=e.srcElement.naturalHeight,d.SmallImageWidth=t,d.SmallImageHeight=a,d.smallimagecnv.width=t,d.smallimagecnv.height=a,d.smallimagectx.drawImage(d.smallimage,0,0,t,a)},this.smallimagecreatefromlarge=function(){var e,t,a,i,r,s,n;s=d.SmallImageWidth,n=d.SmallImageHeight;var o=d.SmallImageWidth/d.originalwidth;d.smallimagecnv.width=s,d.smallimagecnv.height=n,o<1?d.smallimagecnv=mn(d.largeimagecnv,o):d.smallimagectx.drawImage(d.largeimagecnv,0,0,s,n),e=Aa/d.SmallImageHeight,t=Na/d.SmallImageWidth,r=Math.min(t,e),a=(Na-d.SmallImageWidth*r)/2,i=(Aa-d.SmallImageHeight*r)/2,d.setimagedimsmall(a,i,r),null!=Qt&&Qt.setDownload("hide")},this.smallimageloadevent=function(e){var t,a,i,r,s,n,o;n=d.SmallImageWidth,o=d.SmallImageHeight,d.smallimagecnv.width=n,d.smallimagecnv.height=o,d.smallimagectx.drawImage(d.smallimage,0,0,n,o),t=Aa/d.SmallImageHeight,a=Na/d.SmallImageWidth,s=Math.min(a,t),i=(Na-d.SmallImageWidth*s)/2,r=(Aa-d.SmallImageHeight*s)/2,d.setimagedimsmall(i,r,s),null!=Qt&&Qt.setDownload("hide")},this.replacefloorplan=function(e,t){var a=t.birdseyeobj.birdseye.width,i=t.birdseyeobj.birdseye.height;d.floorplans[e].width=a,d.floorplans[e].height=i,d.floorplans[e].canvas.width=a,d.floorplans[e].canvas.height=i,d.floorplans[e].ctx.drawImage(t.birdseyeobj.birdseye,0,0,a,i),d.floorplans[e].replaced=!0,d.floorplans[e].RScale=t.floorplanreplaceScale},this.getFloorplans=function(){return d.floorplans},this.floorplanlolad=function(e){if(m){var t=d.floorplans[e].SRC;Kc("GET",t,"blob").then((function(t){var a=t;a&&(d.floorplans[e].image.addEventListener("load",(function(t){var a,i;a=t.srcElement.naturalWidth,i=t.srcElement.naturalHeight,d.floorplans[e].width=a,d.floorplans[e].height=i,d.floorplans[e].originalWidth=a,d.floorplans[e].originalHeight=i,d.floorplans[e].canvas.width=a,d.floorplans[e].canvas.height=i,d.floorplans[e].ctx.drawImage(d.floorplans[e].image,0,0,a,i);var r=d.floorplans[e].thumbwidht/a;d.floorplans[e].thumbcanvas.width=a*r,d.floorplans[e].thumbcanvas.height=i*r,d.floorplans[e].thumbctx.drawImage(d.floorplans[e].image,0,0,a*r,i*r),null!=ot&&ot.setThumbnail(e,d.floorplans[e])})),d.floorplans[e].image.src=URL.createObjectURL(a))})).catch((function(e){e.status||console.log(e)}))}},this.smallimageload=function(){var e=new XMLHttpRequest;if(e.withCredentials=fi,e.open("GET",d.SmallImageSRC,!0),ks){var t=Zc();t.authset&&e.setRequestHeader("Authorization",t.authString+t.baseuserstring)}e.responseType="blob",e.onload=function(t){var a=e.response;a&&(d.smallimage.addEventListener("load",d.smallimageloadevent,!1),d.smallimage.src=URL.createObjectURL(a))},e.onprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},e.send(null)},this.largeimageloadevent=function(e){var t,a,i,r,s,n=0,o=0;r=d.MainImageWidth,s=d.MainImageHeight,d.originalwidth=d.MainImageWidth,d.originalheight=d.MainImageHeight,d.largeimagecnv.width=r,d.largeimagecnv.height=s,d.largeimagectx.drawImage(d.largeimage,0,0,r,s),n=we/d.MainImageHeight,o=xe/d.MainImageWidth,d.fixedScale=Math.min(o,n),n=Aa/d.MainImageHeight,o=Na/d.MainImageWidth,d.printobj.setDocSize(d.MainImageWidth,d.MainImageHeight),d.width=r,d.height=s,i=Math.min(o,n),t=(Na-d.MainImageWidth*i)/2,a=(Aa-d.MainImageHeight*i)/2,d.setimagedimlarge(t,a,i),d.smallimagecreatefromlarge()},this.largeimageload=function(){var e=new XMLHttpRequest;if(e.withCredentials=fi,e.open("GET",d.MainImageSRC,!0),ks){var t=Zc();t.authset&&e.setRequestHeader("Authorization",t.authString+t.baseuserstring)}e.responseType="blob",e.onload=function(t){var a=e.response;a&&(d.largeimage.addEventListener("load",d.largeimageloadevent,!1),d.largeimage.src=URL.createObjectURL(a))},e.onprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},e.send(null)},this.getlayerlist=function(){return d.VectorPageObj.getlayerlist()},this.turnLayerOnOff=function(e){d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye(),d.VectorPageObj.turnLayerOnOff(e),d.draw_vector(!1),d.vectorischanged=!0},this.turnBlockAllOnOff=function(e){d.VectorPageObj.turnBlockAllOnOff(e),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.turnLayerAllOnOff=function(e){d.VectorPageObj.turnLayerAllOnOff(e),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.resetLayers=function(){d.VectorPageObj.resetLayers(),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.getBlocks=function(){return null==d.VectorPageObj?[]:d.VectorPageObj.getBlocks()},this.getPenTable=function(){return null==d.VectorPageObj?[]:d.VectorPageObj.getpenTable()},this.getBlockswFill=function(){return d.VectorPageObj.getBlockswFill()},this.getFilteredAttributes=function(){return d.VectorPageObj.getFilteredAttributes()},this.getpageRef=function(){return d.pdfpageref},this.filterBlocks=function(e){d.VectorPageObj.filterBlocks(e)},this.filterAttributes=function(e){d.VectorPageObj.filterAttributes(e)},this.turnBlockOnOff=function(e){d.VectorPageObj.turnBlockOnOff(e),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.state3dBlockAll=function(e,t){d.usevector3DGLTF&&d.set3DBlockStateNewAll(e,t)},this.state3dBlock=function(e,t,a){d.usevector3DGLTF&&d.set3DBlockStateNewGroup(e,t,a)},this.turn3DBlockOnOff=function(e,t){d.usevector3DGLTF?d.turn3DBlockOnOffNew(e,t):d.turn3DBlockOnOffOld(e)},this.change3DMarkupSize=function(e){var t=d.Vector3DPageObj.getMarkupChildren(),a=(d.Vector3DPageObj.getmminUnit(400),e),i=e,r=e;if(0!=t.length){for(var s=0;s<t.length;s++)t[s].userData.selected&&"symbol"==t[s].userData.type&&t[s].scale.set(a,i,r);this.Vector3DPageObj.updateblocklist()}},this.change3DMarkup=function(e){var t=d.Vector3DPageObj.getMarkupChildren(),a=null;if(0!=t.length){for(var i=0;i<Ls.length;i++)Ls[i].color==e&&(a=i);for(i=0;i<t.length;i++)t[i].userData.selected&&null!=a&&null!=Ls[a].markupmaterial&&(t[i].material[4]=Ls[a].markupmaterial,t[i].material[5]=Ls[a].markupmaterial,t[i].userData.actionStatus=e);this.Vector3DPageObj.updateblocklist()}},this.updatedimline=function(e,t,a){var i=d.Vector3DPageObj.getMarkupChildren();if(0!=i.length)for(var r=0;r<i.length;r++)if("dimension"==i[r].userData.type&&i[r].userData.parentref==e&&"LineSegments"==i[r].type){var s=new Float32Array([t.x,t.y,t.z,a.x,a.y,a.z]);i[r].geometry.setAttribute("position",new THREE.BufferAttribute(s,3)),i[r].geometry.attributes.position.needsUpdate=!0}},this.move3DMarkupdimPoint=function(e,t,a){var i=d.Vector3DPageObj.getMarkupChildren();if(0!=i.length&&null!=a){for(var r=!1,s=0;s<i.length;s++)if(i[s].userData.selected&&"dimension"==i[s].userData.type){var n=[];if(i[s].uuid==e&&"Points"==i[s].type){i[s].updateMatrixWorld();for(var o=i[s].geometry.getAttribute("position"),l=t.clone(),c=0;c<o.count-1;c++){var h=c*o.itemSize,u=o.array[h],p=o.array[h+1],g=o.array[h+2],m=new THREE.Vector3(u,p,g);i[s].localToWorld(m),a==c?n.push(l):n.push(m)}var f=n[0].distanceTo(n[1]),y=new THREE.Vector3;y.subVectors(n[0],n[1]).setLength(.5*f).add(n[1]),n.push(y);var v=new Float32Array([n[0].x,n[0].y,n[0].z,n[1].x,n[1].y,n[1].z,n[2].x,n[2].y,n[2].z]);i[s].geometry.setAttribute("position",new THREE.Float32BufferAttribute(v,3)),i[s].userData.dimtext=d.Vector3DPageObj.setdimvalue(f),i[s].userData.distance=f,d.updatedimline(e,n[0],n[1]),i[s].geometry.attributes.position.needsUpdate=!0,i[s].updateMatrixWorld(),r=!0}}r&&(null!=wt&&wt.setMarkupList(i,Bs.bActive),this.Vector3DPageObj.updateblocklist())}},this.moveSelected3DMarkup=function(e,t){var a=d.Vector3DPageObj.getMarkupChildren();if(d.Vector3DPageObj.getmarkupScene(),0!=a.length)for(var i=0;i<a.length;i++)if(a[i].userData.selected){if("symbol"==a[i].userData.type){d.move3DMarkup(a[i].uuid,e);break}if("Points"==a[i].type){d.move3DMarkupdimPoint(a[i].uuid,e,t);break}}},this.move3DMarkup=function(e,t){var a=d.Vector3DPageObj.getMarkupChildren();if(d.Vector3DPageObj.getmarkupScene(),0!=a.length){for(var i=!1,r=0;r<a.length;r++)a[r].userData.selected&&"symbol"==a[r].userData.type&&a[r].uuid==e&&(a[r].position.copy(t),i=!0);i&&(null!=wt&&wt.setMarkupList(a,Bs.bActive),this.Vector3DPageObj.updateblocklist())}},this.displayfloorplan=function(e,t,a){var i=d.Vector3DPageObj.getMarkupChildren(),r=d.Vector3DPageObj.getmarkupScene();if(0!=i.length)for(var s=0;s<i.length;s++)(i[s].userData.floornum==e||a)&&null!=d.Vector3DPageObj.getmarkupScene()&&d.Vector3DPageObj.scene.children[r]&&(i[s].userData.type="floorplan")&&(i[s].visible=t)},this.removefloorplan=function(e){var t=d.Vector3DPageObj.getMarkupChildren(),a=d.Vector3DPageObj.getmarkupScene();if(0!=t.length)for(var i=0;i<t.length;i++)t[i].userData.floornum==e&&(t[i].geometry.dispose(),t[i].material.dispose(),null!=d.Vector3DPageObj.getmarkupScene()&&d.Vector3DPageObj.scene.children[a]&&d.Vector3DPageObj.scene.children[a].remove(t[i]))},this.delete3DMarkupbyName=function(e){var t=d.Vector3DPageObj.getMarkupChildren(),a=d.Vector3DPageObj.getmarkupScene();if(0!=t.length){for(var i=[],r=0;r<t.length;r++)t[r].userData.name==e&&(t[r].geometry.dispose(),"symbol"==t[r].userData.type&&(t[r].material[0].dispose(),t[r].material[1].dispose(),t[r].material[2].dispose(),t[r].material[3].dispose(),t[r].material[4].dispose(),t[r].material[5].dispose()),"dimension"==t[r].userData.type&&t[r].material.dispose(),"camera"==t[r].userData.type&&t[r].material.dispose(),i.push(t[r]));for(var s=0;s<i.length;s++)null!=d.Vector3DPageObj.getmarkupScene()&&d.Vector3DPageObj.scene.children[a]&&d.Vector3DPageObj.scene.children[a].remove(i[s]);i=[],null!=wt&&wt.setMarkupList(t,Bs.bActive),this.Vector3DPageObj.updateblocklist()}},this.delete3DMarkup=function(){var e=d.Vector3DPageObj.getMarkupChildren(),t=d.Vector3DPageObj.getmarkupScene();if(0!=e.length){for(var a=[],i=0;i<e.length;i++)e[i].userData.selected&&(e[i].geometry.dispose(),"symbol"==e[i].userData.type&&(e[i].material[0].dispose(),e[i].material[1].dispose(),e[i].material[2].dispose(),e[i].material[3].dispose(),e[i].material[4].dispose(),e[i].material[5].dispose()),"dimension"==e[i].userData.type&&e[i].material.dispose(),a.push(e[i]));for(var r=0;r<a.length;r++)null!=d.Vector3DPageObj.getmarkupScene()&&d.Vector3DPageObj.scene.children[t]&&d.Vector3DPageObj.scene.children[t].remove(a[r]);a=[],null!=wt&&wt.setMarkupList(e,Bs.bActive),this.Vector3DPageObj.updateblocklist()}},this.setblockstateMeshAll=function(e,t){null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.visible=t,e.userData.tempvisible=t},this.setblockstateMesh=function(e,t,a,i){var r=!1;return null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.name==t&&(r=!0,e.visible=a,e.userData.tempvisible=a,null!=bt&&i&&bt.set3DPartInfo(e.userData)),r},this.setStateMeshGroup=function(e,t,a,i,r){var s=!1;if(null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),i)var n=A(t,e.type),o=A(e.name,e.type);else o=e.name,n=t;if(o==n){if(s=!0,e.visible=a,e.userData.tempvisible=a,e.userData.blockRef)var l=d.Vector3DPageObj.blocklist[e.userData.blockRef];else d.Vector3DPageObj.setBlockRef(e),l=d.Vector3DPageObj.blocklist[e.userData.blockRef];null!=l?(l.visible=e.userData.tempvisible,bt.set3DPartInfo(l)):null!=bt&&r&&bt.set3DPartInfo(e.userData)}return s},this.turnbloconoffMesh=function(e,t,a,i){var r=!1;if(null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),a)var s=t,n=A(e.name,e.type);else n=e.name,s=t;if(n==s){if(r=!0,e.visible?(e.visible=!1,e.userData.tempvisible=!1):(e.visible=!0,e.userData.tempvisible=!0),e.userData.blockRef)var o=d.Vector3DPageObj.blocklist[e.userData.blockRef];else d.Vector3DPageObj.setBlockRef(e),o=d.Vector3DPageObj.blocklist[e.userData.blockRef];null!=o?(o.visible=e.userData.tempvisible,bt.set3DPartInfo(o)):null!=bt&&i&&bt.set3DPartInfo(e.userData)}return r},this.set3DBlockStateNewAllArray=function(e,t){for(var a=0;a<e.length;a++)if("Group"===e[a].type)for(var i=0;i<e[a].children.length;i++)d.setblockstateMeshAll(e[a].children[i],t);else d.setblockstateMeshAll(e[a],t)},this.set3DBlockStateNewAll=function(e,t){var a=d.Vector3DPageObj.getMeshChildren();if(0!=a.length){d.set3DBlockStateNewAllArray(a,e);for(var i=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),r=0;r<i.length;r++)d.set3DBlockStateNewAllArray(i[r],e)}},this.set3DBlockStateOld=function(e,t,a){var i=d.Vector3DPageObj.getMeshChildren();if(0!=i.length)for(var r=0;r<i.length;r++){if("Group"===i[r].type)for(var s=0;s<i[r].children.length&&(d.setblockstateMesh(i[r].children[s],e,t),!a);s++);if(d.setblockstateMesh(i[r],e,t),a)break}},this.set3DBlockStateNewGroup=function(e,t,a){var i=d.Vector3DPageObj.getMeshChildren();if(0!=i.length){d.set3DBlockstateGroupAll(i,e,t,a);for(var r=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),s=0;s<r.length;s++)d.set3DBlockstateGroupAll(r[s],e,t,a);a&&this.Vector3DPageObj.updateblocklist()}},this.set3DBlockStateNew=function(e,t,a){var i=d.Vector3DPageObj.getMeshByName(e);if(null!=i){if(a)var r=d.setblockstateMesh(i,e,t,a);else d.setblockstateMeshAll(i,t);r&&a&&this.Vector3DPageObj.updateblocklist()}},this.set3DBlockstateGroupAll=function(e,t,a,i){for(var r=!1,s=0;s<e.length;s++){if("Group"===e[s].type)for(var n=0;n<e[s].children.length;n++)d.setStateMeshGroup(e[s].children[n],t,a,!0,i)&&(r=!0);if(r)break;if(d.setStateMeshGroup(e[s],t,a,!1,i))break}},this.turn3DBlockOnOffNewAll=function(e,t,a){for(var i=!1,r=0;r<e.length;r++){if("Group"===e[r].type)for(var s=0;s<e[r].children.length;s++)d.turnbloconoffMesh(e[r].children[s],t,!0,a)&&(i=!0);if(i)break;if(d.turnbloconoffMesh(e[r],t,!1,a))break}},this.turn3DBlockOnOffNew=function(e,t){var a=d.Vector3DPageObj.getMeshChildren();if(0!=a.length){d.turn3DBlockOnOffNewAll(a,e,t);for(var i=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),r=0;r<i.length;r++)d.turn3DBlockOnOffNewAll(i[r],e,t);this.Vector3DPageObj.updateblocklist()}},this.turn3DBlockOnOffOld=function(e){for(var t=0;t<d.Vector3DPageObj.scene.children.length;t++)if(d.Vector3DPageObj.scene.children[t].name==e)return d.Vector3DPageObj.scene.children[t].visible?(d.Vector3DPageObj.scene.children[t].visible=!1,this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].tempvisible=!1):(d.Vector3DPageObj.scene.children[t].visible=!0,this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].tempvisible=!0),null!=vt&&vt.set3DPartInfo(this.Vector3DPageObj.partlist[e]),void this.Vector3DPageObj.updateblocklist()},this.restoreBlockStates=function(){d.VectorPageObj.restoreBlockStates(),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.resetBlocks=function(){d.VectorPageObj.resetBlocks(),d.draw_vector(!1),d.vectorischanged=!0,d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()},this.reset3DParts=function(){d.usevector3DGLTF?d.reset3DPartsnew():d.reset3DPartsold()},this.resetMesh=function(e){var t=0;null==e.userData.visible&&e.visible,null==e.userData.tempvisible&&(e.userData.tempvisible=e.visible),e.userData.isSpace||(e.userData.visible?e.userData.tempvisible=1==e.userData.visible:e.userData.visible=e.visible?1:0,e.userData.tempvisible?e.visible=e.userData.tempvisible:e.userData.tempvisible=e.visible,e.userData.selected=!1,e.userData.usetempfacecolor=!1,null!=e.userData.facecolor&&(e.type,e.material.color.setHex(e.userData.facecolor)),e.userData.meshcolors&&(e.userData.meshcolors.length>1?(e.material.color=new THREE.Color(e.userData.meshcolors[t]),t<e.userData.meshcolors.length&&t++):e.userData.facecolor&&(e.material.color=setHex(e.userData.facecolor))))},this.reset3DPartsnewAll=function(e){for(var t=0;t<e.length;t++){if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"!=e[t].children[a].type&&"LineSegments"!=e[t].children[a].type||d.resetMesh(e[t].children[a]);"Mesh"!=e[t].type&&"LineSegments"!=e[t].type||d.resetMesh(e[t])}},this.reset3DPartsnew=function(){var e=d.Vector3DPageObj.getMeshChildren();if(0!=e.length){d.reset3DPartsnewAll(e);for(var t=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),a=0;a<t.length;a++)d.reset3DPartsnewAll(t[a]);this.Vector3DPageObj.updateblocklist()}},this.reset3DPartsold=function(){for(var e=0,t=0;t<d.Vector3DPageObj.scene.children.length;t++)"Mesh"==d.Vector3DPageObj.scene.children[t].type&&(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].isSpace||(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].resetvisible(),d.Vector3DPageObj.scene.children[t].visible=this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].tempvisible,d.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].selected=!1,d.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].meshcolors.length>1?(d.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].meshcolors[e]),e<d.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].meshcolors.length&&e++):d.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].facecolor)));this.Vector3DPageObj.updateblocklist()},this.deleteVectorAttribute=function(e){d.usevectorxml&&d.VectorPageObj.deleteAttribute(e)},this.appendCustomBlockAttribute=function(e,t,a){d.usevectorxml&&d.VectorPageObj.appendCustomBlockAttribute(e,t,a)},this.setBlockColor=function(e,t,a){d.usevectorxml&&(d.VectorPageObj.setBlockColor(e,t,a),d.draw_vector(!1),d.vectorischanged=!0)},this.setBlockHatch=function(e,t,a){d.usevectorxml&&(d.VectorPageObj.setBlockHatch(e,t,a),d.draw_vector(!1),d.vectorischanged=!0)},this.FindBlockByAttr=function(e,t){if(d.usevectorxml)return d.VectorPageObj.FindBlockByAttr(e,t)},this.search3DAttribute=function(e){return d.Vector3DPageObj.searchAttribute(e)},this.get3dVectorBlocks=function(){return d.Vector3DPageObj.getmeshUserData([],!0)},this.search3DAttributesEx=function(e){return d.Vector3DPageObj.searchAttributeJSONEx(e)},this.search3DAttributes=function(e){return d.Vector3DPageObj.searchAttributeJSON(e)},this.getstoreyNames=function(){var e=null;return d.Vector3DPageObj&&(e=d.Vector3DPageObj.getstoreyNames()),e},this.getStoreyRealIDs=function(e){return d.Vector3DPageObj.getStoreyRealIDs(e)},this.getStoreyIDs=function(e){return d.Vector3DPageObj.getStoreyIDs(e)},this.getStoreyAttributes=function(e){return d.Vector3DPageObj.getAttributeStorey(e)},this.searchStoreyAttributesEx=function(e,t){return d.Vector3DPageObj.searchAttributeStoreyEx(e,t)},this.searchStoreyAttributes=function(e,t){return d.Vector3DPageObj.searchAttributeStorey(e,t)},this.set3DBlockTransparency=function(e,t,a){d.Vector3DPageObj.setBlockTransparency(e,t,a)},this.set3DBlockNoSelect=function(e,t){d.Vector3DPageObj.setBlockNoSelect(e,t)},this.reset3DBlockColorsAll=function(e){for(var t=0;t<e.length;t++)if("Group"==e[t].type)for(var a=0;a<e[t].children.length;a++)"Mesh"==e[t].children[a].type&&(null==e[t].children[a].userData.facecolor?e[t].children[a].userData.facecolor=e[t].children[a].material.color.getHex():e[t].children[a].material.color.setHex(e[t].children[a].userData.facecolor));else if("Mesh"==e[t].type){if(""===e[t].name)continue;null==e[t].userData.facecolor?e[t].userData.facecolor=e[t].material.color.getHex():e[t].material.color.setHex(e[t].userData.facecolor)}},this.reset3DBlockColors=function(){var e=d.Vector3DPageObj.getMeshChildren();if(0!=e.length){d.reset3DBlockColorsAll(e);var t=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0!=t.length)for(var a=0;a<t.length;a++)d.reset3DBlockColorsAll(t[a])}},this.set3DBlockColorOld=function(e,t,a){var i=d.Vector3DPageObj.getMeshChildren();if(0!=i.length)for(var r=0;r<i.length;r++)if("Group"==i[r].type)for(var s=0;s<i[r].children.length;s++)"Mesh"==i[r].children[s].type&&(null==i[r].children[s].userData.facecolor&&(i[r].children[s].userData.facecolor=i[r].children[s].material.color.getHex()),i[r].children[s].name==e&&i[r].children[s].visible&&(a?i[r].children[s].material.color=new THREE.Color(t):i[r].children[s].material.color.setHex(i[r].children[s].userData.facecolor)));else if("Mesh"==i[r].type){if(""===i[r].name)continue;null==i[r].userData.facecolor&&(i[r].userData.facecolor=i[r].material.color.getHex()),i[r].name==e&&i[r].visible&&(a?i[r].material.color=new THREE.Color(t):i[r].material.color.setHex(i[r].userData.facecolor))}},this.set3DBlockDistance=function(e,t,a,i){var r=d.Vector3DPageObj.getMeshByName(e),s=new THREE.Vector3(a.x,a.y,a.z).normalize();s.multiplyScalar(t);var n=new THREE.Vector3;null!=r&&(null==r.userData.posX&&(r.userData.posX=r.position.x),null==r.userData.posY&&(r.userData.posY=r.position.y),null==r.userData.posZ&&(r.userData.posZ=r.position.z),r.visible&&(i?r.position.add(s):(n.set(r.userData.posX,r.userData.posY,r.userData.posZ),r.position.copy(n))))},this.set3DBlockPosition=function(e,t,a){var i=d.Vector3DPageObj.getMeshByName(e),r=new THREE.Vector3;null!=i&&(null==i.userData.posX&&(i.userData.posX=i.position.x),null==i.userData.posY&&(i.userData.posY=i.position.y),null==i.userData.posZ&&(i.userData.posZ=i.position.z),i.visible&&(a?(r.set(t.x,t.y,t.z),i.position=r.clone()):(r.set(i.userData.posX,i.userData.posY,i.userData.posZ),i.position=r.clone())))},this.set3DBlockColor=function(e,t,a){var i=d.Vector3DPageObj.getMeshByName(e);null!=i&&(null==i.userData.facecolor&&(i.userData.facecolor=i.material.color.getHex()),i.visible&&(a?(i.material.color=new THREE.Color(t),i.userData.tempfacecolor=i.material.color.getHex(),i.userData.usetempfacecolor=!0):null!=i.userData.facecolor&&(i.material.color.setHex(i.userData.facecolor),i.userData.usetempfacecolor=!1)))},this.getScreenPoint=function(e){return d.Vector3DPageObj.pointToScreen(e)},this.add3DSymbol=function(e,t){d.Vector3DPageObj.add3DSymbol(e,t)},this.get3DCamerasJSON=function(){for(var e=null,t=d.Vector3DPageObj.getCameraSaves(),a=[],i=0;i<t.length;i++)if("resetView"!=t[i].name){var r={position:null,name:null,tool:null,explodefactor:0,clipping:null,thumbnail:null,width:0,height:0,image:null,selectedmesharray:[],attributes:[]};r.position=t[i].position,r.name=t[i].name,r.tool=t[i].tool,r.explodefactor=t[i].explodefactor,r.clipping=t[i].clipping,r.attributes=t[i].attributes,r.image=fn(t[i].image),t[i].selectedmesharray&&(r.selectedmesharray=t[i].selectedmesharray.slice()),a.push(r)}return a.length>0&&(e=JSON.stringify(a)),e},this.get3DMarkupJSON=function(){var e=null,t=d.Vector3DPageObj.getMarkupChildren(),a=d.Vector3DPageObj.getmarkupScene();if(0!=t.length)return null!=d.Vector3DPageObj.getmarkupScene()&&(e=JSON.stringify(d.Vector3DPageObj.scene.children[a].toJSON())),e},this.select3DBlock=function(e,t,a){d.usevector3DGLTF?d.select3DBlocknew(e,t,a):d.select3DBlockold(e)},this.show3DViewMarker=function(e){var t=d.Vector3DPageObj.getMarkupChildren();if(0!=t.length)for(var a=0;a<t.length;a++)"camera"==t[a].userData.type&&(d.Vector3DPageObj.set3DViewPos(t[a]),t[a].visible=e)},this.show3Dmarkup=function(e){var t=d.Vector3DPageObj.getMarkupChildren();if(0!=t.length)for(var a=0;a<t.length;a++)"camera"!=t[a].userData.type&&(t[a].visible=e)},this.unSelect3DmarkupAll=function(){var e=d.Vector3DPageObj.getMarkupChildren();if(0!=e.length){for(var t=0;t<e.length;t++)e[t].userData.selected=!1,"symbol"==e[t].userData.type&&(e[t].material[0].transparent=!0,e[t].material[1].transparent=!0,e[t].material[2].transparent=!0,e[t].material[3].transparent=!0,e[t].material[4].transparent=!0,e[t].material[5].transparent=!0),"camera"==e[t].userData.type&&null!=e[t].userData.facecolor&&e[t].material.color.setHex(e[t].userData.facecolor),"dimension"==e[t].userData.type&&d.select3Ddimline(e[t].uuid,!1);null!=wt&&wt.setMarkupList(e,Bs.bActive)}},this.select3Ddimline=function(e,t){var a=d.Vector3DPageObj.getMarkupChildren();if(0!=a.length)for(var i=0;i<a.length;i++)"dimension"==a[i].userData.type&&a[i].userData.parentref==e&&"LineSegments"==a[i].type&&(a[i].userData.selected=t)},this.resize3DSymbol=function(){var e=d.Vector3DPageObj.getMarkupChildren();if(0!=e.length)for(var t=0;t<e.length;t++)e[t].userData.selected&&e[t].userData.type},this.get3DResetView=function(){var e=null;return d.usevector3DGLTF&&d.Vector3DPageObj&&(e=d.Vector3DPageObj.get3DResetView()),e},this.getCameraimage=function(e){var t=void 0;return d.usevector3DGLTF&&d.Vector3DPageObj&&(t=d.Vector3DPageObj.getCameraimage(e)),t},this.restoreCameraByName=function(e){d.usevector3DGLTF&&d.Vector3DPageObj&&d.Vector3DPageObj.restoreCameraName(e)},this.set3DViewSelectedMesh=function(e){d.usevector3DGLTF&&d.Vector3DPageObj&&d.Vector3DPageObj.set3DViewSelectedMesh(e)},this.select3Dmarkup=function(e){if(d.usevector3DGLTF&&d.Vector3DPageObj){var t=d.Vector3DPageObj.getMarkupChildren();if(0!=t.length){for(var a=0;a<t.length;a++)if(""!==t[a].uuid)if(t[a].uuid==e&&t[a].visible)if(t[a].userData.selected)t[a].userData.selected=!1,"symbol"==t[a].userData.type&&(t[a].material[0].transparent=!0,t[a].material[1].transparent=!0,t[a].material[2].transparent=!0,t[a].material[3].transparent=!0,t[a].material[4].transparent=!0,t[a].material[5].transparent=!0),"dimension"==t[a].userData.type&&d.select3Ddimline(t[a].uuid,!1),"camera"==t[a].userData.type&&null!=t[a].userData.facecolor&&t[a].material.color.setHex(t[a].userData.facecolor);else{"symbol"==t[a].userData.type&&(t[a].material[0].transparent=!1,t[a].material[1].transparent=!1,t[a].material[2].transparent=!1,t[a].material[3].transparent=!1,t[a].material[4].transparent=!1,t[a].material[5].transparent=!1),"dimension"==t[a].userData.type&&d.select3Ddimline(t[a].uuid,!0),"camera"==t[a].userData.type&&(null==t[a].userData.facecolor&&(t[a].userData.facecolor=t[a].material.color.getHex()),t[a].material.color=new THREE.Color(16220659)),t[a].userData.selected=!0;var i={name:t[a].name,index:a,group:!1,groupindex:-1,markup:!0};d.Vector3DPageObj.setSelectedPart(i),null!=xt&&xt.set3DPartInfo(t[a].userData)}else"Mesh"==t[a].type&&t[a].visible&&(t[a].material.transparent=!0,t[a].userData.selected=!1);null!=wt&&wt.setMarkupList(t,Bs.bActive)}}},this.setunselect=function(e){e.userData.selected&&(e.userData.usetempfacecolor?null!=e.userData.tempfacecolor&&e.material.color.setHex(e.userData.tempfacecolor):null!=e.userData.facecolor?e.material.color.setHex(e.userData.facecolor):e.userData.facecolor=e.material.color.getHex(),e.userData.selected=!1)},this.getMeshName=function(e,t){return parseInt(THREE.REVISION)<=127||"LineSegments"==t?e.substring(0,e.length-2):e},this.setselect=function(e,t){if(d.unSelect3DmarkupAll(),e.isgroup)var a=A(e.name,e.mesh.type),i=A(e.mesh.name,e.mesh.type);else i=e.mesh.name,a=e.name;if(i==a&&e.mesh.visible)if(e.mesh.userData.selected)e.mesh.userData.selected=!1,e.mesh.userData.usetempfacecolor?null!=e.mesh.userData.tempfacecolor&&e.mesh.material.color.setHex(e.mesh.userData.tempfacecolor):null!=e.mesh.userData.facecolor&&e.mesh.material.color.setHex(e.mesh.userData.facecolor);else{null==e.mesh.userData.facecolor&&(e.mesh.userData.facecolor=e.mesh.material.color.getHex()),"LineSegments"!=e.mesh.type&&(e.mesh.material.color=new THREE.Color(16220659)),e.mesh.userData.selected=!0;var r={name:e.name,index:e.meshindex,group:e.isgroup,groupindex:e.groupindex,isadded:e.isadded,addedmeshindex:e.addedmeshindex,markup:!1};if(d.Vector3DPageObj.setSelectedPart(r),e.mesh.userData.blockRef)var s=d.Vector3DPageObj.blocklist[e.mesh.userData.blockRef];else d.Vector3DPageObj.setBlockRef(e.mesh),s=d.Vector3DPageObj.blocklist[e.mesh.userData.blockRef];null!=vt&&t&&(null!=s?vt.set3DPartInfo(s):vt.set3DPartInfo(e.mesh.userData))}else tr||e.mesh.visible&&e.mesh.userData.selected&&(e.mesh.userData.usetempfacecolor?null!=e.mesh.userData.tempfacecolor&&e.mesh.material.color.setHex(e.mesh.userData.tempfacecolor):null==e.mesh.userData.facecolor?e.mesh.userData.facecolor=e.mesh.material.color.getHex():e.mesh.material.color.setHex(e.mesh.userData.facecolor),e.mesh.userData.selected=!1);return e},this.unselect3DBlockAllAdd=function(e){for(var t=0;t<e.length;t++)if("Group"===e[t].type)for(var a=0;a<e[t].children.length;a++)this.setunselect(e[t].children[a]);else this.setunselect(e[t])},this.unselect3DBlockAll=function(){if(null==d.Vector3DPageObj.cur3Dview){var e=d.Vector3DPageObj.getMeshChildren();d.unselect3DBlockAllAdd(e);for(var t=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),a=0;a<t.length;a++)d.unselect3DBlockAllAdd(t[a])}},this.select3DBlocknewAll=function(e,t,a,i,r){this.Vector3DPageObj.setSelectedPart({name:"",index:-1,group:!1,groupindex:-1,markup:!1,addedmesh:!1,addedmeshindex:-1});for(var s=0;s<e.length;s++)if("Group"===e[s].type)for(var n=0;n<e[s].children.length;n++){var o={mesh:e[s].children[n],name:i,meshindex:s,groupindex:n,isgroup:!0,isadded:t,addedmeshindex:a};o=this.setselect(o,r)}else{if(""===e[s].name)continue;o={mesh:e[s],name:i,meshindex:s,groupindex:-1,isgroup:!1,isadded:t,addedmeshindex:a},o=this.setselect(o,r)}},this.select3DBlocknew=function(e,t,a){var i=d.Vector3DPageObj.getMeshChildren();if(0!=i.length){if(a){var r=d.Vector3DPageObj.getAddedMeshChildren();if(0!=r.length)for(var s=0;s<r.length;s++)d.select3DBlocknewAll(r[s],!0,s,e,t)}else d.select3DBlocknewAll(i,!1,-1,e,t);this.Vector3DPageObj.updateblocklist()}},this.select3DBlockold=function(e){this.Vector3DPageObj.setSelectedPart(-1);for(var t=0;t<d.Vector3DPageObj.scene.children.length;t++)""!==d.Vector3DPageObj.scene.children[t].name&&(d.Vector3DPageObj.scene.children[t].name==e&&isNaN(e)?this.Vector3DPageObj.restoreCameraName(e):d.Vector3DPageObj.scene.children[t].name==e&&d.Vector3DPageObj.scene.children[t].visible?this.Vector3DPageObj.partlist[e].selected?(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].selected=!1,d.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].facecolor)):(d.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(16220659),this.Vector3DPageObj.partlist[e].selected=!0,this.Vector3DPageObj.setSelectedPart(e),null!=vt&&vt.set3DPartInfo(this.Vector3DPageObj.partlist[e])):"Mesh"!=d.Vector3DPageObj.scene.children[t].type||isNaN(d.Vector3DPageObj.scene.children[t].name)||d.Vector3DPageObj.scene.children[t].visible&&this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].selected&&(d.Vector3DPageObj.scene.children[t].material.color=new THREE.Color(this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].facecolor),this.Vector3DPageObj.partlist[d.Vector3DPageObj.scene.children[t].name].selected=!1));this.Vector3DPageObj.updateblocklist()},this.vectorbinaryloadBckGrnd=function(e){var t=0,a=0,i=0,r=0,s=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;if(o){var l={role:1,bgColor:cr,fgColor:hr,fvonly:!1};if(d.VectorPageObj=new Tl(d,o,!0,l),null==d.VectorPageObj)return;if(0==d.VectorPageObj.height||0==d.VectorPageObj.width)return;if(d.originalwidth=d.VectorPageObj.width,d.originalheight=d.VectorPageObj.height,t=we/d.VectorPageObj.height,a=xe/d.VectorPageObj.width,n=Math.min(a,t),d.fixedScale=n,t=Aa/d.VectorPageObj.height,a=Na/d.VectorPageObj.width,s=Math.min(a,t),i=(Na-d.VectorPageObj.width*s)/2,r=(Aa-d.VectorPageObj.height*s)/2,d.width=d.VectorPageObj.width,d.height=d.VectorPageObj.height,d.setvectordim(i,r,s),d.printobj.setDocSize(d.VectorPageObj.width,d.VectorPageObj.height),d.loadoverlayvectors&&d.loadfgvectors(),d.loadoverlayimage){var c={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:d.MainImageWidthFrGrnd,y2:d.MainImageHeightFrGrnd,imagestr:d.Vector2DImageSRCFrGrnd};d.VectorPageObj.addimage(c,!1,l)}d.loadoverlaypdf&&(c={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:d.PDFWidthFrGrnd,y2:d.PDFHeightFrGrnd},d.VectorPageObj.addpdfimage(c,!1,l))}}},this.vectorbinaryloadFrGrnd=function(e){var t=0,a=0,i=0,r=0,s=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;if(o){var l={role:2,bgColor:cr,fgColor:hr};if(d.loadbackgroundvectors?d.VectorPageObj.addvectors(o,l):d.VectorPageObj=new Tl(d,o,!0,l),null==d.VectorPageObj)return;if(0==d.VectorPageObj.height||0==d.VectorPageObj.width)return;if(null!=Qt&&Qt.setDownload("hide"),d.originalwidth=d.VectorPageObj.width,d.originalheight=d.VectorPageObj.height,t=we/d.VectorPageObj.height,a=xe/d.VectorPageObj.width,n=Math.min(a,t),d.fixedScale=n,t=Aa/d.VectorPageObj.height,a=Na/d.VectorPageObj.width,s=Math.min(a,t),i=(Na-d.VectorPageObj.width*s)/2,r=(Aa-d.VectorPageObj.height*s)/2,d.width=d.VectorPageObj.width,d.height=d.VectorPageObj.height,d.setvectordim(i,r,s),d.printobj.setDocSize(d.VectorPageObj.width,d.VectorPageObj.height),d.loadbackgroundimage){var c={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:d.MainImageWidthBckGrnd,y2:d.MainImageHeightBckGrnd,imagestr:d.Vector2DImageSRCBckGrnd};d.VectorPageObj.addimage(c,!0,l)}d.loadbackgroundpdf&&(c={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:d.PDFWidthBckGrnd,y2:d.PDFHeightBckGrnd},d.VectorPageObj.addpdfimage(c,!0,l))}}},this.vectorbinaryload=function(e){var t=0,a=0,i=0,r=0,s=0,n=0;if(200==e.currentTarget.status){var o=e.currentTarget.response;o&&(d.VectorPageObj=new Tl(d,o,!0),(null==d.VectorPageObj||d.VectorPageObj.invalid)&&(d.invalid=!0),0!=d.VectorPageObj.height&&0!=d.VectorPageObj.width||(d.invalid=!0),null!=Qt&&Qt.setDownload("hide"),d.invalid?d.DocRef.removepage(d):(d.originalwidth=d.VectorPageObj.width,d.originalheight=d.VectorPageObj.height,t=we/d.VectorPageObj.height,a=xe/d.VectorPageObj.width,n=Math.min(a,t),d.fixedScale=n,t=Aa/d.VectorPageObj.height,a=Na/d.VectorPageObj.width,s=Math.min(a,t),i=(Na-d.VectorPageObj.width*s)/2,r=(Aa-d.VectorPageObj.height*s)/2,d.width=d.VectorPageObj.width,d.height=d.VectorPageObj.height,d.setvectordim(i,r,s),d.printobj.setDocSize(d.VectorPageObj.width,d.VectorPageObj.height)))}},this.vectorbinprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},this.vectorprogress=function(e){e.currentTarget.getResponseHeader("Content-Length")>1e7&&(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&(alert("This file is currently too large for your device. Check back for an update shortly "),null!=Qt&&Qt.setDownload("hide"),e.currentTarget.abort()),e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},this.vectorabort=function(e){du()},this.vector3Dbinprogress=function(e){u.domElement.style.visibility="visible",e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},this.vector3Dprogress=function(e){e.lengthComputable&&100==Math.round(100*e.loaded/e.total)&&null!=Qt&&Qt.setDownload("hide")},this.vector3Dabort=function(e){du()},this.vector3DblocknavloadJSON=function(e){200==e.currentTarget.status&&JSON.parse(e.currentTarget.responseText)},this.vector3Dblocknavload=function(e){if(200==e.currentTarget.status){var t=e.currentTarget.responseXML;if(null==t||null==t.documentElement)try{t=Jn(this.responseText)}catch(e){return void alert("Error 1 - "+e)}d.Vector3DPageObj.addblocks(t)}},this.glTFstoreyLoadComplete=function(){null!=Ve&&Ve.loadComplete(d.DocRef.OriginalURL,d.DocRef.bActive)},this.gltfAddLoadComplete=function(e){null!=e&&d.loadAddIFCJSON(e)},this.glTFloadComplete=function(e,t,a,i){d.walkthroughcontrol=new El;var r=d.Vector3DPageObj.getfloorElevation(0),s=d.Vector3DPageObj.getfloorheight(),n=d.Vector3DPageObj.getmeterunit(),c=d.Vector3DPageObj.boxCenter.z;if(d.walkthroughcontrol.setwalkHeight(r+s),d.walkthroughcontrol.setTempWalkHeight(c),d.walkthroughcontrol.setwalkUnit(n),d.walkthroughcontrol.setwalkSpeed(50),d.walkthroughcontrol.setinitial(t,e),d.loadIFCJSON(),d.StoreyMetadata.length>0)for(var h=0;h<d.StoreyMetadata.length;h++)d.loadStoreyJSON(d.StoreyMetadata[h]);d.loadIFCNavigator(),o&&!d.DocRef.markuploaded&&(zr?lc(l,d.DocRef):Wr?oc(d.DocRef):cc(l,d.DocRef)),d.printobj.setDocSize(Na,Aa),Sr=!0,Ka=!0,yd(!0),Uh(),Xh(),d.Vector3DPageObj.modelLoaded=!0,d.Vector3DPageObj.load3Dmarkupcheck(),0==d.StoreyMetadata.length&&null!=Ve&&Ve.loadComplete(d.DocRef.OriginalURL,d.DocRef.bActive)},this.IFCJSONloadAdd=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}d.Vector3DPageObj.addblockscombine(t)}},this.loadAddIFCJSON=function(e){var t=[{event:"loadend",func:d.IFCJSONloadAdd}];qc("GET",e,"",t)},this.IFCJSONNavload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}d.Vector3DPageObj.addNavlist(t)}},this.loadIFCNavigator=function(){if(!d.NavigatorJSONSRC){var e=uo(d.Vector3DBinarySRC);this.NavigatorJSONSRC=e+"navigator.json"}var t=[{event:"loadend",func:d.IFCJSONNavload}];qc("GET",d.NavigatorJSONSRC,"",t)},this.IFCJSONload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}d.Vector3DPageObj.addblocks(t)}},this.loadIFCJSON=function(){if(!d.VectorMetadataSRC){var e=uo(d.Vector3DBinarySRC);d.VectorMetadataSRC=e+"1_1.json"}var t=[{event:"loadend",func:d.IFCJSONload}];qc("GET",d.VectorMetadataSRC,"",t)},this.storeyJSONload=function(e){if(200==e.currentTarget.status){try{var t=JSON.parse(e.currentTarget.responseText)}catch(e){return void alert("Error 1 - "+e)}d.Vector3DPageObj.addstoreys(t)}},this.loadStoreyJSON=function(e){Kc("GET",e.src,"").then((function(t){var a=JSON.parse(t);d.Vector3DPageObj.addstoreys(a,e.name,e.id,e.index,e.Elevation)})).catch((function(e){e.status||console.log(e)}))},this.loadGLTFSpaces=function(){if(d.usevector3DGLTF&&d.Vector3DPageObj){var e=uo(d.Vector3DBinarySRC);d.VectorSpaceDataSRC=e+"spaces.glb",d.addtoGLTFScene(d.VectorSpaceDataSRC)}},this.addtoGLTFScene=function(e,t){d.usevector3DGLTF&&d.Vector3DPageObj&&d.Vector3DPageObj.addToScene(e,t)},this.vector3DGltfload=function(){null!=Zt&&Zt.setUpload("show"),d.Vector3DPageObj=new Nl(d.Vector3DBinarySRC,d),uo(d.Vector3DBinarySRC)},this.vector3DBinaryload=function(e){200==e.currentTarget.status&&(g=e.currentTarget.response)&&(d.Vector3DPageObj=new Al(g,!0,d),d.walkthroughcontrol=new Fl,d.walkthroughcontrol.movementSpeed=10,d.walkthroughcontrol.lookSpeed=.125,d.walkthroughcontrol.lookVertical=!0,d.printobj.setDocSize(Na,Aa),Ka=!0,yd(!0),Uh())},this.vectorpart3Dload=function(e){if(200==e.currentTarget.status){var t=e.currentTarget.responseXML;if(null==t||null==t.documentElement)try{t=Jn(this.responseText)}catch(e){return void alert("Error 1 - "+e)}d.VectorPartfilelist.length}},this.vector3Dpartprogress=function(e){},this.load3dvectorPart=function(){for(var e=0;e<d.VectorPartfilelist.length;e++){var t=[{event:"load",func:d.vectorpart3Dload},{event:"progress",func:d.vector3Dpartprogress}];qc("GET",d.VectorPartfilelist[e],"",t)}},this.load3dnavigator=function(){var e=[{event:"load",func:d.vector3Dblocknavload},{event:"progress",func:d.vector3Dprogress},{event:"abort",func:d.vector3Dabort}];qc("GET",d.Navigator3DSRC,"",e)},this.loadvectors3DBinary=function(){null!=Qt&&Qt.setDownload("show");var e=[{event:"loadend",func:d.vector3DBinaryload},{event:"progress",func:d.vector3Dbinprogress},{event:"abort",func:d.vector3Dabort}];qc("GET",d.Vector3DBinarySRC,"arraybuffer",e)},this.loadvectors3D=function(){var e=[{event:"load",func:d.vector3Dload},{event:"progress",func:d.vector3Dprogress},{event:"abort",func:d.vector3Dabort}];qc("GET",d.Vector3DSRC,"",e)},this.loadcomparevectors=function(){d.loadbackgroundvectors?d.loadbgvectors():d.loadoverlayvectors?d.loadfgvectors():d.createEmptyVectorpage()},this.createEmptyVectorpage=function(){var e,t,a,i,r=0,s=0,n={role:1,bgColor:cr,fgColor:hr},o={x:0,y:0,w:0,h:0,scale:1,offsetx:0,offsety:0,iscompare:!0,bgcolor:cr,fgcolor:hr};if(d.loadbackgroundimage)null!=d.MainImageWidthBckGrnd&&(o.w=parseInt(d.MainImageWidthBckGrnd),o.h=parseInt(d.MainImageHeightBckGrnd),o.scaling=parseFloat(d.MainImageScalingBckGrnd));else if(d.loadoverlayimage)null!=d.MainImageWidthFrGrnd&&(o.w=parseInt(d.MainImageWidthFrGrnd),o.h=parseInt(d.MainImageHeightFrGrnd),o.scaling=parseFloat(d.MainImageScalingFrGrnd));else if(d.loadbackgroundpdf)null!=d.PDFWidthBckGrnd&&(o.w=d.PDFWidthBckGrnd,o.h=d.PDFHeightBckGrnd,o.scaling=1);else{if(!d.loadoverlaypdf)return;null!=d.PDFWidthFrGrnd&&(o.w=d.PDFWidthFrGrnd,o.h=d.PDFHeightFrGrnd,o.scaling=1)}if(d.VectorPageObj=new Tl(d,o,!1,n),null!=d.VectorPageObj&&0!=d.VectorPageObj.height&&0!=d.VectorPageObj.width){if(d.originalwidth=d.VectorPageObj.width,d.originalheight=d.VectorPageObj.height,r=we/d.VectorPageObj.height,s=xe/d.VectorPageObj.width,i=Math.min(s,r),d.fixedScale=i,r=Aa/d.VectorPageObj.height,s=Na/d.VectorPageObj.width,a=Math.min(s,r),e=(Na-d.VectorPageObj.width*a)/2,t=(Aa-d.VectorPageObj.height*a)/2,d.width=d.VectorPageObj.width,d.height=d.VectorPageObj.height,d.setvectordim(e,t,a),d.printobj.setDocSize(d.VectorPageObj.width,d.VectorPageObj.height),d.loadbackgroundimage){var l={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:d.MainImageWidthBckGrnd,y2:d.MainImageHeightBckGrnd,imagestr:d.Vector2DImageSRCBckGrnd};d.VectorPageObj.addimage(l,!0,n)}d.loadoverlayimage&&(l={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:d.MainImageWidthFrGrnd,y2:d.MainImageHeightFrGrnd,imagestr:d.Vector2DImageSRCFrGrnd},d.VectorPageObj.addimage(l,!1,n)),d.loadbackgroundpdf&&(l={dlayer:0,drawmode:13,lstate:1,x1:0,y1:0,x2:d.PDFWidthBckGrnd,y2:d.PDFHeightBckGrnd},d.VectorPageObj.addpdfimage(l,!0,n)),d.loadoverlaypdf&&(l={dlayer:1,drawmode:13,lstate:1,x1:0,y1:0,x2:d.PDFWidthFrGrnd,y2:d.PDFHeightFrGrnd},d.VectorPageObj.addpdfimage(l,!1,n))}},this.loadbgvectors=function(){var e=[{event:"load",func:d.vectorbinaryloadBckGrnd},{event:"progress",func:d.vectorbinprogress},{event:"abort",func:d.vectorabort}];qc("GET",d.Vector2DBinarySRCBckGrnd,"arraybuffer",e)},this.loadfgvectors=function(){var e=[{event:"load",func:d.vectorbinaryloadFrGrnd},{event:"progress",func:d.vectorbinprogress},{event:"abort",func:d.vectorabort}];qc("GET",d.Vector2DBinarySRCFrGrnd,"arraybuffer",e)},this.loadbinvectors=function(){null!=Qt&&Qt.setDownload("show");var e=[{event:"load",func:d.vectorbinaryload},{event:"progress",func:d.vectorbinprogress},{event:"abort",func:d.vectorabort}];qc("GET",d.Vector2DBinarySRC,"arraybuffer",e)},this.loadvectors=function(){var e=[{event:"load",func:d.vectorload},{event:"progress",func:d.vectorprogress},{event:"abort",func:d.vectorabort}];qc("GET",d.Vector2DSRC,"",e)},this.backupScaleAndOffset=function(){d.usevectorxml?(d.dscalebackup=d.dscalevector,d.dxbackup=d.dxvector,d.dybackup=d.dyvector):d.usepdfjs?(d.dscalebackup=d.dscalepdf,this.curpagescalebackup=d.curpagescale,d.dxbackup=d.dxpdf,d.dybackup=d.dypdf):(d.dscalebackup=d.dscale,d.dxbackup=d.dx,d.dybackup=d.dy)},this.getCurPageScale=function(){return d.curpagescale},this.restoreScaleAndOffset=function(){d.usevectorxml?(d.dscalevector=d.dscalebackup,d.dxvector=d.dxbackup,d.dyvector=d.dybackup):d.usepdfjs?(d.setpdfScale(d.dscalebackup),d.curpagescale=d.curpagescalebackup,d.dxpdf=d.dxbackup,d.dypdf=d.dybackup):(d.dscalebackup=d.dscale=d.dscalebackup,d.dx=d.dxbackup,d.dy=d.dybackup)},this.setPDFDiminit=function(e,t,a){this.pageloaded=!1,this.dxpdf=e,this.dypdf=t,d.setpdfScale(a),d.setpagedimsize(this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf,!1),this.pagedimset=!0,this.pdfdiminitset=!0,o&&(ei?$h(d.DocRef.FileName):(iu(),d.DocRef.SetActive())),null!=d.DocRef.markupsave&&d.DocRef.markupsave.setpage(d),d.pagenumber==d.DocRef.pages.length-1&&null!=ht&&ht.loadComplete(d.DocRef.FileName,d.DocRef.bActive)},this.setPFDdimnodraw=function(e,t,a,i){this.dxpdf=e,this.dypdf=t,i&&d.setpdfScale(a),d.setpagedimsize(this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf,!1),d.pagedimset=!0,d.backupScaleAndOffset()},this.setPDFdim=function(e,t,a){if(d.pageloaded=!0,d.pdfdiminitset||(d.dxpdf=e,d.dypdf=t,d.setpagedimsize(d.dxpdf,d.dypdf,d.offscreenwidth*d.dscalepdf,d.offscreenheight*d.dscalepdf,!1),this.pagedimset=!0,d.pdfdiminitset=!0),d.setpdfScale(1),o&&!d.DocRef.markuploaded&&(zr?lc(l,d.DocRef):Wr?oc(d.DocRef):cc(l,d.DocRef)),o&&!d.pdfdiminitset&&(ei?$h(d.DocRef.FileName):(iu(),d.DocRef.SetActive())),o){if(d.visible=!0,null!=Qt&&Qt.setDownload("hide"),Wu(),ee){if(null!=qe){var i={docindex:d.DocRef.fileindex,pageindex:d.pagenumber,floorindex:te};qe.loadComplete(d.DocRef.FileName,d.DocRef.bActive,i)}ee=!1,te=null}null!=Ve&&Ve.loadComplete(d.DocRef.OriginalURL,d.DocRef.bActive),d.draw_canvas(!0)}null!=et&&(et.loadComplete(d.pagenumber),d.DocRef.loadPageEvt(d.pagenumber)),null!=gt&&gt.setVectorBlocks([]),d.DocRef.draw_mpagepdf(),d.backupScaleAndOffset()},this.istextvisible=function(e,t){var a=!1;return Math.max(0,e),Math.min(Na,e),Math.max(Aa,t),Math.min(0,t),e>0&&e<Na&&t>0&&t<Aa&&(a=!0),a},this.ispagevisible=function(){var e=!1;if(d.usepdfjs){if(null!=d.DocRef.pages[d.DocRef.currentpage]){Math.max(0,d.DocRef.pages[d.DocRef.currentpage].dxpdf),Math.min(Na,d.DocRef.pages[d.DocRef.currentpage].endx);var t=d.DocRef.pages[d.DocRef.currentpage].endy,a=d.DocRef.pages[d.DocRef.currentpage].dypdf;d.DocRef.currentpage==d.pagenumber?e=!0:(d.pagenumber==d.DocRef.currentpage+1&&t<Aa&&(e=!0),d.pagenumber==d.DocRef.currentpage-1&&a>0&&(e=!0))}}else e=d.DocRef.currentpage==d.pagenumber;return e},this.changeinterval=function(e){clearInterval(d.vectortimervar),d.vectorpagetime=e,d.vectortimervar=setInterval((function(){d.vectortimer()}),d.vectorpagetime)},this.vectortimer=function(){if(null!=d.DocRef&&d.DocRef.bActive){if(null==d)return;if(null==d.DocRef.pages[d.DocRef.currentpage])return;d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&(d.VectorPageObj.offscreenscale(d.dscalevector),d.vectorischanged&&(d.draw_vector(!0),d.vectorischanged=!1))}},this.pdftimer=function(){0!=d.DocRef.pages.length&&null!=d.DocRef&&d.DocRef.bActive&&null!=d.DocRef.pages[d.DocRef.currentpage]&&d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&(d.pdfisrendered||d.pageRendering||d.renderPDFpagescale())},this.queRenderCompareScale=function(e){d.pageRendering?d.pageNumPending=d.pagenumber+1:d.renderPDFComparescale(e)},this.continueCallback=function(e){d.pagenumber,d.DocRef.pages[d.DocRef.currentpage].pagenumber,e()},this.setpagesize=function(e,t){d.pagedrawCanvas.width=e,d.pagedrawCanvas.height=t,d.offscreenwidth=e,d.offscreenheight=t},this.concatTextonheight=function(e){if(0!=e.items.length){for(var t=[],a=e.items[0],i=a.str,r=a.transform[5],s=(a.transform[4],a.width),n=e.items[0],o=n.str,l=n.transform[5],c=(n.transform[4],n.width),h=0,u="",d=0;h<e.items.length;)h>0&&(i=(a=e.items[h]).str,r=a.transform[5],s=a.width,r==l?(o=u=o+i,c=d=c+s):(n.str=u,n.width=d,t.push(n),d=0,u="",o=(n=e.items[h]).str,l=n.transform[5],c=n.width)),h++;return n.str=u,n.width=d,t.push(n),t}},this.renderPDFpagescaleTextnew=function(){if(null==d.DocRef.pdfDoc)return;const e=ll();d.DocRef.pdfDoc.getPage(d.pagenumber+1).then((function(t){if(d.PDFTextArea.style.left=d.startx/e+"px",d.PDFTextArea.style.top=d.starty/e+"px",d.PDFTextArea.style.width=d.offscreenwidth*d.dscalepdf/e+"px",d.PDFTextArea.style.height=d.offscreenheight*d.dscalepdf/e+"px",null!=d.PDFTextArea)for(;d.PDFTextArea.firstChild;)d.PDFTextArea.removeChild(d.PDFTextArea.firstChild);t.getTextContent().then((function(e){if(null==e.items)return;if(d.textContent=e,gi){var a=zl(e);null!=a&&(d.textContent.items=a)}if(null!=d.textContent.items&&e.items.length>0&&null!=ba&&(d.DocRef.hastext=!0,ba.hastext=!0),null!=ba&&ba.hasText(d.DocRef.hastext,d.DocRef.bActive),null==d.viewport)return;const i=ll();var r=d.viewport.scale/i,s=t.getViewport({scale:r});const n=new Wl({textLayerDiv:d.PDFTextArea,pageIndex:t.pageNumber-1,viewport:s});n.setTextContent(d.textContent),n.render(),d.useTextCallback&&(d.DocRef.loadPagetextEvt(d.pagenumber),d.useTextCallback=!1)}))}))},this.renderPDFpagescaleText=function(){if(null==d.DocRef.pdfDoc)return;const e=ll();d.DocRef.pdfDoc.getPage(d.pagenumber+1).then((function(t){if(d.PDFTextArea.style.left=d.startx/e+"px",d.PDFTextArea.style.top=d.starty/e+"px",d.PDFTextArea.style.width=d.offscreenwidth*d.dscalepdf/e+"px",d.PDFTextArea.style.height=d.offscreenheight*d.dscalepdf/e+"px",null!=d.PDFTextArea)for(;d.PDFTextArea.firstChild;)d.PDFTextArea.removeChild(d.PDFTextArea.firstChild);t.getTextContent().then((function(e){if(null==e.items)return;if(d.textContent=e,gi){var a=zl(e);null!=a&&(d.textContent.items=a)}if(null!=d.textContent.items&&e.items.length>0&&null!=ba&&(d.DocRef.hastext=!0,ba.hastext=!0),null!=ba&&ba.hasText(d.DocRef.hastext,d.DocRef.bActive),null==d.viewport)return;const i=ll();var r=d.viewport.scale/i,s=t.getViewport({scale:r});fe.renderTextLayer({textContent:d.textContent,container:d.PDFTextArea,viewport:s,textDivs:[]}).promise.then((function(){for(var e,t,a,i=d.PDFTextArea.children,r=i[0],s=0;s<i.length;){if("span"==(r=i[s]).tagName.toLowerCase()&&(r.style.position="absolute"),gi){var n=B(r.style.transform);if(-1!=n){var o=(e=r.style.fontSize,t=void 0,a=void 0,t=-1,"x"==(a=e.split("p"))[1]&&(t=parseFloat(a[0])),t);if(-1!=o){var l=o*n+"px";r.style.fontSize=l,r.style.transform="none"}}}s++}d.DocRef.searchobj.active&&null!=d.DocRef.searchobj.showsearchpage&&d.DocRef.searchobj.showsearchpage==d.pagenumber&&(d.showSearch(),d.DocRef.searchobj.showsearchpage=void 0)})).catch((function(e){console.log(e)}))}))}))},this.getRenderStatus=function(){return{rendercomplete:d.pdfisrendered,rendering:d.pageRendering}},this.renderwithscale=function(e){d.setpdfScale(e),d.pdfisrendered=!1,d.pageRendering=!1,d.renderPDFpagescale(!0)},this.renderPDFpagescale=function(e,t){if(null!=d.DocRef.pdfDoc){if(d.pdfisrendered)return d.rendercallback=!0,void d.DocRef.draw_mpagepdf();if(!d.pageRendering)if(d.pdfrenderopque>1)d.pdfrenderopque-=1;else{d.pdfstartrender=(new Date).getTime();var a=d.pdfstartrender;this.pageRendering=!0,d.DocRef.pdfDoc.getPage(d.pagenumber+1).then((function(e){if(d.renderTask&&d.rendercancel&&d.renderTask.cancel(),e.cleanupAfterRender=!0,!mi){if(0!=e.view[3])var i=Math.abs(e.view[2]-e.view[0]),r=Math.abs(e.view[3]-e.view[1]),s=Math.abs(e.view[2]-e.view[0]);else i=Math.abs(e.view[2]-e.view[0]),r=Math.abs(e.view[3]-e.view[1]),s=Math.abs(e.view[2]-e.view[0]);switch(e._pageInfo.rotate){case 0:break;case 90:i=r,r=s;break;case 180:break;case 270:i=r,r=s}d.pdfpagewidth=i,d.pdfpageheight=r,d.pdfpagewidth,d.pdfpageheight,d.pdfdiminitset&&d.setpagesize(d.offscreenwidth,d.offscreenheight);var n=d.offscreenwidth*d.dscalepdf/i,o=d.offscreenheight*d.dscalepdf/r,l=Math.min(n,o);if(d.pdfSnapScale=l,l>d.nPDFMaxFactor){var c=l/d.nPDFMaxFactor;l=d.nPDFMaxFactor,d.bMaxzoom=!0}else c=1,d.bMaxzoom=!1;d.viewport=e.getViewport({scale:l}),d.setpagesize(d.viewport.width,d.viewport.height),d.setpdfScale(c),d.markupscaleadjust=l/d.pagescale,d.offscreenwidth<=Na&&!d.DocRef.pagelocked&&(d.dxpdf=(Na-d.viewport.width)/2),d.curpagescale=d.offscreenwidth/d.pdfpagewidth;var h={canvasContext:d.pagedrawctx,viewport:d.viewport,optionalContentConfigPromise:d.DocRef.contentgroupconfig};d.renderTask=e.render(h),Rr=!0,t&&(d.renderTask.onContinue=t),d.renderTask.promise.then((function(){d.pageRendering=!1,Rr=!1,null!==d.pageNumPending&&(d.pageNumPending=null),d.pdfrenderopque-=1,d.pdfrenderopque<=0&&(d.pdfrenderopque=0),d.pdfisrendered=!0,d.pagecanvas.width=d.pagedrawCanvas.width,d.pagecanvas.height=d.pagedrawCanvas.height,d.pagectx.drawImage(d.pagedrawCanvas,0,0),d.pagedrawCanvas.width=1,d.pagedrawCanvas.height=1,0!=d.PDFPointArray.length&&(d.bpointlistSet=!0),d.pageloaded||(d.pdfisfirstrendered=!0,d.setPDFdim(d.dxpdf,d.dypdf,1)),d.backupScaleAndOffset();var e=(new Date).getTime(),t={page:d.pagenumber,start:a,end:e};null!=at&&at.RenderComplete(t),Y(),d.rendercallback=!0,d.DocRef.draw_mpagepdf(),d.renderPDFpagescaleTextnew()})).catch((function(e){d.renderTask=null,"RenderingCancelledException"===e.name&&(d.pagedrawCanvas=document.createElement("canvas"),d.pagedrawctx=d.pagedrawCanvas.getContext("2d"),d.pdfisrendered=!1)}))}}))}}},this.renderPDFMagnify=function(e){d.DocRef.pdfDoc.getPage(d.pagenumber+1).then((function(t){if(t.cleanupAfterRender=!0,0!=t.view[3])var a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),r=Math.abs(t.view[2]-t.view[0]);else a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),r=Math.abs(t.view[2]-t.view[0]);switch(t._pageInfo.rotate){case 0:break;case 90:a=i,i=r;break;case 180:break;case 270:a=i,i=r}var s=d.offscreenwidth*d.dscalepdf/a,n=d.offscreenheight*d.dscalepdf/i,o=Math.min(s,n);if((o*=e)>d.nPDFMaxFactor){var l=o/d.nPDFMaxFactor;o=d.nPDFMaxFactor,d.bMaxzoom=!0}else l=1,d.bMaxzoom=!1;if(d.magviewport=t.getViewport({scale:o}),isNaN(d.magviewport.height)||isNaN(d.magviewport.width))d.pageRendering=!1;else{d.magnifycanvas.height=d.magviewport.height,d.magnifycanvas.width=d.magviewport.width,d.magnifyrestscale=l;var c={canvasContext:d.magnifypagectx,viewport:d.magviewport},h=t.render(c);h.promise.then((function(){}))}}))},this.setPDFTextAra=function(t){const a=ll();d.PDFTextArea.id="PDFpage"+t,d.PDFTextArea.style.left=d.pdfdxtemp/a+"px",d.PDFTextArea.style.width=d.width/a+"px",d.PDFTextArea.style.height=d.height/a+"px",e.appendChild(d.PDFTextArea),1==t&&d.DocRef.textselect?d.PDFTextArea.style.display=Wa:d.PDFTextArea.style.display="none"},this.getPDFdimensions=function(e){var t=d.pagenumber+1;null!=d.DocRef&&null!=d.DocRef&&null!=d.DocRef.pdfDoc&&null!=d.DocRef.pdfDoc&&d.DocRef.pdfDoc.getPage(t).then((function(a){if(!mi){if(0!=a.view[3])var i=Math.abs(a.view[2]-a.view[0]),r=Math.abs(a.view[3]-a.view[1]),s=Math.abs(a.view[2]-a.view[0]);else i=Math.abs(a.view[2]-a.view[0]),r=Math.abs(a.view[3]-a.view[1]),s=Math.abs(a.view[2]-a.view[0]);switch(d.pdfpageref=a._pageInfo.ref,d.PDFpageRotate=a._pageInfo.rotate,a._pageInfo.rotate){case 0:break;case 90:i=r,r=s;break;case 180:break;case 270:i=r,r=s}d.pdfpagewidth=i,d.pdfpageheight=r,d.originalwidth=i,d.originalheight=r,d.nPDFMaxFactor=Math.sqrt(sr/(i*r)),d.pagescale,d.viewport=a.getViewport({scale:d.pagescale});var n=we/d.pdfpageheight,o=xe/d.pdfpagewidth;if(d.fixedScale=Math.min(o,n),d.viewport.height>Aa&&d.viewport.width>Na||wi||e){var l=(Na-16)/d.pdfpagewidth,c=Aa/r;d.pagescale=e?d.DocRef.PDFDocumentPageScale:wi?Math.min(l,c):Math.max(l,c),d.viewport=a.getViewport({scale:d.pagescale})}d.offscreenheight=d.viewport.height,d.offscreenwidth=d.viewport.width,d.width=d.viewport.width,d.height=d.viewport.height;var h=d.width/d.viewport.width,u=d.height/d.viewport.height;d.pdfdscaletemp=Math.min(h,u),d.pdfdxtemp=(Na-d.viewport.width)/2,d.pdfdytemp=(Aa-d.viewport.height)/2,d.curpagescale=d.pagescale,d.pdfdiminitset,d.setPDFTextAra(t),d.setPDFDiminit(d.pdfdxtemp,0,d.pdfdscaletemp)}}))},this.renderPDFpage=function(){if(!d.pdfisrendered&&!d.pdfisfirstrendered&&null!=d.DocRef.pdfDoc&&!d.pageRendering){d.pageRendering=!0;var e=d.pagenumber+1;d.DocRef.pdfDoc.getPage(e).then((function(t){if(g&&g.cancel(),t.cleanupAfterRender=!0,!mi){if(0!=t.view[3])var a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),r=Math.abs(t.view[2]-t.view[0]);else a=Math.abs(t.view[2]-t.view[0]),i=Math.abs(t.view[3]-t.view[1]),r=Math.abs(t.view[2]-t.view[0]);switch(d.pdfpageref=t._pageInfo.ref,d.PDFpageRotate=t._pageInfo.rotate,t._pageInfo.rotate){case 0:break;case 90:a=i,i=r;break;case 180:break;case 270:a=i,i=r}d.pdfpagewidth=a,d.pdfpageheight=i,d.originalwidth=a,d.originalheight=i,d.pdfpagewidth,d.pdfpageheight;var s=we/d.pdfpageheight,n=xe/d.pdfpagewidth;d.fixedScale=Math.min(n,s);var o=Na-16;if(d.nPDFMaxFactor=Math.sqrt(sr/(a*i)),d.pagescale,d.pdfdiminitset?d.viewport=t.getViewport({scale:d.pagescale*d.dscalepdf}):d.viewport=t.getViewport({scale:d.pagescale}),d.viewport.height>Aa&&d.viewport.width>Na||wi){var l=o/d.pdfpagewidth,c=Aa/d.pdfpageheight;d.pagescale=wi?Math.min(l,c):Math.max(l,c),d.viewport=t.getViewport({scale:d.pagescale})}d.setpagesize(d.viewport.width,d.viewport.height),d.width=d.offscreenwidth,d.height=d.offscreenheight;var h=d.offscreenwidth/d.viewport.width,u=d.offscreenheight/d.viewport.height;d.pdfdscaletemp=Math.min(h,u),d.pdfdxtemp=(Na-d.viewport.width)/2,d.pdfdytemp=(Aa-d.viewport.height)/2,d.curpagescale=d.pagescale,d.DocRef.PDFInitscaleSet||(d.DocRef.setDocumentpageScale(d.curpagescale),d.DocRef.PDFInitscaleSet=!0),d.setPDFTextAra(e);var p={canvasContext:d.pagedrawctx,viewport:d.viewport},g=t.render(p);d.pdfdiminitset||d.setPFDdimnodraw(d.pdfdxtemp,0,1,!0),Rr=!0,g.promise.then((function(){d.pageRendering=!1,Rr=!1,null!==d.pageNumPending&&(d.pageNumPending=null),d.pagecanvas.width=d.pagedrawCanvas.width,d.pagecanvas.height=d.pagedrawCanvas.height,d.pagectx.drawImage(d.pagedrawCanvas,0,0),d.pagedrawCanvas.width=1,d.pagedrawCanvas.height=1,d.bpointlistSet=!0,d.pdfSnapScale=d.pagescale,d.pdfisrendered=!0,d.pdfisfirstrendered=!0,d.setPDFdim(d.pdfdxtemp,0,d.pdfdscaletemp),d.renderPDFpagescaleTextnew()}))}}))}},this.drawpoints=function(e,t){d.PDFinternalScale.x>0&&d.PDFinternalScale.x,d.PDFinternalScale.y>0&&d.PDFinternalScale.y;var i=d.offscreenheight*d.dscalepdf,r=d.offscreenwidth*d.dscalepdf;d.PDFpageRotate;for(var s=0;s<e.length;s++){if(0!=d.PDFpageRotate)if(90==d.PDFpageRotate)var n=d.starty+-e[s].y*t,o=d.startx+e[s].x*t;else n=d.starty+(-e[s].y*t+i),o=d.startx+e[s].x*t+r;else n=e[s].y<0?d.starty+-e[s].y*t:d.starty+(-e[s].y*t+i),o=e[s].x<0?d.startx+e[s].x*t+r:d.startx+e[s].x*t;rd(a,0,{x:o,y:n})}},this.reindextextposremove=function(e,t){for(var a=!1,i=0;i<d.PDFTextArea.children.length;i++)if(null!=d.PDFTextArea.children[i]){if(d.PDFTextArea.children[i].tagName.toLowerCase(),"span"==d.PDFTextArea.children[i].tagName.toLowerCase())if(d.PDFTextArea.children[i].children.length>0)for(var r=0;r<d.PDFTextArea.children[i].children.length;r++)"span"==d.PDFTextArea.children[i].children[r].tagName.toLowerCase()&&(a=!0);else d.PDFTextArea.children[i].innerHTML;if(i>=e&&a)break}return i},this.reindextextpos=function(e,t){for(var a=0,i=0,r=0;r<d.PDFTextArea.children.length;r++)if(null!=d.PDFTextArea.children[r]){if("br"==d.PDFTextArea.children[r].tagName.toLowerCase()&&a++,"span"==d.PDFTextArea.children[r].tagName.toLowerCase()){var s=d.PDFTextArea.children[r].innerHTML;" "!=s&&""!=s||a++}if(r>=e&&t==s)break}return i=e+a,r>e+a&&(i=r),i},this.getdivpos=function(e){d.pan_update(0,0);const t=t=>{const a=t?.children[e],i=t.offsetLeft,r=t.offsetTop;return{x:a.offsetLeft+i,y:a.offsetTop+r,w:a.offsetWidth,h:a.offsetHeight}};return t(d.PDFTextArea)||t(d.TextSelectArea)||{x:0,y:0,w:0,h:0}},this.getdivposdebug=function(e){var t={x:0,y:0,w:0,h:0};if(d.PDFTextArea&&d.PDFTextArea.children[e]){var a=d.PDFTextArea.children[e],i=d.PDFTextArea.offsetTop,r=d.PDFTextArea.offsetLeft;t.y=a.offsetTop+i,t.x=a.offsetLeft+r,t.w=a.offsetWidth,t.h=a.offsetHeight,console.log("PDFTextArea divpos:",t)}if(d.TextSelectArea&&d.TextSelectArea.children[e]){var s=d.TextSelectArea.children[e],n=d.TextSelectArea.offsetTop,o=d.TextSelectArea.offsetLeft;t.y=s.offsetTop+n,t.x=s.offsetLeft+o,t.w=s.offsetWidth,t.h=s.offsetHeight,console.log("TextSelectArea divpos:",t)}return t},this.getdivposorg=function(e){var t={x:0,y:0,w:0,h:0};if(d.pan_update(0,0),null!=d.PDFTextArea&&null!=d.PDFTextArea.children[e]){var a=d.PDFTextArea.children[e],i=d.PDFTextArea.offsetTop,r=d.PDFTextArea.offsetLeft;t.y=a.offsetTop+i,t.x=a.offsetLeft+r,t.w=a.offsetWidth,t.h=a.offsetHeight}if(null!=d.TextSelectArea&&null!=d.TextSelectArea.children[e]){var s=d.TextSelectArea.children[e],n=d.TextSelectArea.offsetTop,o=d.TextSelectArea.offsetLeft;t.y=s.offsetTop+n,t.x=s.offsetLeft+o,t.w=s.offsetWidth,t.h=s.offsetHeight}return t},this.indexdivTexts=function(){var e=[];if(null!=d.PDFTextArea)for(var t=d.PDFTextArea.children,a=0;a<t.length;a++){t[a].style.backgroundColor=null;var i=t[a];e.push(i.textContent)}if(null!=d.TextSelectArea)for(var r=d.TextSelectArea.children,s=0;s<r.length;s++){r[s].style.backgroundColor=null;var n=r[s];e.push(n.textContent)}return e},this.clearmarktextdiv=function(e,t){if(null!=d.PDFTextArea&&null!=d.PDFTextArea.children[e]){d.PDFTextArea.children[e].innerHTML="";var a=document.createTextNode(t);d.PDFTextArea.children[e].appendChild(a)}if(null!=d.TextSelectArea&&null!=d.TextSelectArea.children[e]){d.TextSelectArea.children[e].innerHTML="";var i=document.createTextNode(t);d.TextSelectArea.children[e].appendChild(i)}},this.gettextdivrect=function(e,t,a,i){if(null!=d.PDFTextArea){var r=t.substring(a,i+a),s=t.split(" ");if(null!=d.PDFTextArea.children[e]){d.PDFTextArea.children[e].innerHTML="";for(var n=0;n<s.length;n++){var o=s[n].search(r);-1!=o&&(o>=0&&(foundword=!0))}}}if(null!=d.TextSelectArea){var l=t.substring(a,i+a),c=t.split(" ");if(null!=d.TextSelectArea.children[e]){d.TextSelectArea.children[e].innerHTML="";for(var h=0;h<c.length;h++)c[h].search(l)}}},this.testmarktextdiv=function(e){if(null!=d.PDFTextArea)for(var t=d.PDFTextArea.children,a=0;a<t.length;a++)t[a].innerHTML.toLowerCase().search(e)>=0&&G(t[a])},this.marktextdivNew=function(e,t,a,i){if(null!=d.PDFTextArea){var r=t.substring(a,i+a),s=t.split(" ");if(null!=d.PDFTextArea.children[e]){d.PDFTextArea.children[e].innerHTML="";for(var n=0,o=0;o<s.length;o++){var l=s[o].search(r);if(-1==l){if(n>0)var c=document.createTextNode(s[o]+" ");else c=document.createTextNode(s[o]);d.PDFTextArea.children[e].appendChild(c),n++}else if(l>=0){var h=document.createElement("span");h.className="highlight";var u=document.createTextNode(r);h.appendChild(u);var p=!1;s[o]!=r&&0!=l||p||(d.PDFTextArea.children[e].appendChild(h),p=!0);for(var g=s[o].split(r),m=0;m<g.length;m++){var f=s[o].search(g[m]);f>=0&&f<l?(c=document.createTextNode(g[m]),d.PDFTextArea.children[e].appendChild(c),p||(d.PDFTextArea.children[e].appendChild(h),p=!0)):f>l&&(p||(d.PDFTextArea.children[e].appendChild(h),p=!0),c=document.createTextNode(g[m]),d.PDFTextArea.children[e].appendChild(c))}n=0}}}}if(null!=d.TextSelectArea){var y=t.substring(a,i+a),v=t.split(" ");if(null!=d.TextSelectArea.children[e]){d.TextSelectArea.children[e].innerHTML="";for(var b=0,x=0;x<v.length;x++){var w=v[x].search(y);if(-1==w){if(b>0)var k=document.createTextNode(v[x]+" ");else k=document.createTextNode(v[x]);d.TextSelectArea.children[e].appendChild(k),b++}else if(w>=0){var D=document.createElement("span");D.className="highlight",k=document.createTextNode(y),D.appendChild(k),d.TextSelectArea.children[e].appendChild(D),b=0}}}}},this.marktextdivEx=function(e,t,a,i){const r=t.substring(a,a+i),s=t.substring(0,a),n=t.substring(a+i);if(d.PDFTextArea&&d.PDFTextArea.children[e]){const t=d.PDFTextArea.children[e];t.innerHTML="",s&&t.appendChild(document.createTextNode(s));const a=document.createElement("span");a.className="highlight",a.appendChild(document.createTextNode(r)),t.appendChild(a),n&&t.appendChild(document.createTextNode(n))}if(d.TextSelectArea&&d.TextSelectArea.children[e]){const t=d.TextSelectArea.children[e];t.innerHTML="",s&&t.appendChild(document.createTextNode(s));const a=document.createElement("span");a.className="highlight",a.appendChild(document.createTextNode(r)),t.appendChild(a),n&&t.appendChild(document.createTextNode(n))}},this.marktextdivExEx=function(e,t,a,i){if(null!=d.PDFTextArea){var r=t.substring(a,i+a),s=t.substring(0,a),n=t.substring(a,a+i),o=t.substring(a+i);if(null!=d.PDFTextArea.children[e]){d.PDFTextArea.children[e].innerHTML="",s&&d.PDFTextArea.children[e].appendChild(document.createTextNode(s));var l=document.createElement("span");if(l.className="highlight",l.appendChild(document.createTextNode(n)),d.PDFTextArea.children[e].appendChild(l),o&&d.PDFTextArea.children[e].appendChild(document.createTextNode(o)),splittext.length>1)for(var c=0;c<splittext.length;c++){var h=document.createTextNode(splittext[c]+" ");if(d.PDFTextArea.children[e].appendChild(h),c<splittext.length-1){var u=document.createElement("span");u.className="highlight",h=document.createTextNode(r),u.appendChild(h),d.PDFTextArea.children[e].appendChild(u)}}}}if(null!=d.TextSelectArea){var p=t.substring(a,i+a),g=t.split(p);if(null!=d.TextSelectArea.children[e]){d.TextSelectArea.children[e].innerHTML="";for(var m=0;m<g.length;m++){if(m>0){var f=document.createElement("span");f.className="highlight";var y=document.createTextNode(p);f.appendChild(y),d.TextSelectArea.children[e].appendChild(f)}""!=g[m]&&(y=document.createTextNode(g[m]),d.TextSelectArea.children[e].appendChild(y))}}}},this.marktextdiv=function(e,t,a,i){if(null!=d.PDFTextArea){var r=t.substring(a,i+a),s=t.split(" ");if(null!=d.PDFTextArea.children[e]){d.PDFTextArea.children[e].innerHTML="";for(var n=0,o=0;o<s.length;o++){var l=s[o].search(r);if(-1==l){if(n>0)var c=document.createTextNode(s[o]+" ");else c=document.createTextNode(s[o]);d.PDFTextArea.children[e].appendChild(c),n++}else if(l>=0){var h=document.createElement("span");h.className="highlight",c=document.createTextNode(r),h.appendChild(c),d.PDFTextArea.children[e].appendChild(h),n=0}}}}if(null!=d.TextSelectArea){var u=t.substring(a,i+a),p=t.split(" ");if(null!=d.TextSelectArea.children[e]){d.TextSelectArea.children[e].innerHTML="";for(var g=0,m=0;m<p.length;m++){var f=p[m].search(u);if(-1==f){if(g>0)var y=document.createTextNode(p[m]+" ");else y=document.createTextNode(p[m]);d.TextSelectArea.children[e].appendChild(y),g++}else if(f>=0){var v=document.createElement("span");v.className="highlight",y=document.createTextNode(u),v.appendChild(y),d.TextSelectArea.children[e].appendChild(v),g=0}}}}},this.getVectorSearchList=function(){d.getVectorSearchListSearch(d.DocRef.searchobj)},this.getVectorSearchListSearch=function(e){var t=d.indexdivTexts(),a=e.casesens,i=e.expr;if(""!==i)for(var r=0;r<t.length;r++){if(a)s=i,n=t[r];else var s=i.toLowerCase(),n=t[r].toLowerCase();var o=!1,l=n.search(s);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:d.pagenumber,indx:r,searchtext:t[r],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getVectorSearchListRect=function(e){for(var t=d.indexdivTexts(),a=e.casesens,i=e.expr,r=0;r<t.length;r++){if(a)s=i,n=t[r];else var s=i.toLowerCase(),n=t[r].toLowerCase();var o=!1,l=n.search(s);if(-1==l?o=!1:l>=0&&(o=!0),o){var c={page:d.pagenumber,indx:r,searchtext:t[r],pos:l,length:i.length,rect:{}};e.matcharray.push(c)}}},this.getPDFSearchList=function(){for(var e=d.indexdivTexts(),t=d.DocRef.searchobj.casesens,a=d.DocRef.searchobj.expr,i=0;i<e.length;i++){if(t)r=a,s=e[i];else var r=a.toLowerCase(),s=e[i].toLowerCase();var n=!1,o=s.search(r);if(-1==o?n=!1:o>=0&&(n=!0),n){var l={page:d.pagenumber,indx:i,searchtext:e[i],pos:o,length:a.length};d.DocRef.searchobj.matcharray.push(l)}}},this.getrotcoords=function(e,t,a,i,r){var s=Math.PI/180*r,n=Math.cos(s),o=Math.sin(s);return{x:n*(a-e)+o*(i-t)+e,y:n*(i-t)-o*(a-e)+t}},this.getPDFPageSearchList=function(){for(var e={},t=[],a=!1,i=d.indexdivTexts(),r=d.DocRef.searchobj.casesens,s=d.DocRef.searchobj.expr,n=0;n<i.length;n++){if(r)o=s,l=i[n];else var o=s.toLowerCase(),l=i[n].toLowerCase();var c=l.search(o);-1==c?a=!1:c>=0&&(a=!0),a&&(e={page:d.pagenumber,indx:n,searchtext:i[n],pos:c,length:s.length},t.push(e))}return{matcharr:t}},this.getSearchTextRect=function(){if(d.DocRef.extractsearchobj.page==d.pagenumber){if(d.usevectorxml){d.settextdivs();var e=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].searchtext,t=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].indx;d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].pos,d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].length}d.usepdfjs&&(e=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].searchtext,t=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].indx,d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].pos,d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].length,t=d.reindextextpos(t,e));var a=d.getdivpos(t);d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].rect=a}var i=Aa/2,r=Na/2;d.getpagerect(),0!=d.drotation&&d.getrotcoords(r,i,a.x,a.y,-d.drotation)},this.showSearchclean=function(){if(d.DocRef.searchobj.page!==d.pagenumber)return;const e=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx];if(!e)return;const{searchtext:t,indx:a,pos:i,length:r}=e;let s=a;d.usepdfjs?s=d.reindextextpos(s,t):d.usevectorxml&&d.settextdivs();const n=d.getdivpos(s);if(!n)return;const o=Na/2,l=Aa/2,c=d.getpagerect(),h=c.y>=0,u=n.y>=0&&n.y+n.h<=Aa&&n.x>=0&&n.x+n.w<=Na;let p=0,g=0;(n.x+n.w>Na||n.x<0)&&(p=n.x-o),(!u||!h||n.y<0)&&(g=n.y-l,c.y-g>0&&(g=c.y)),d.pan_update(p,g),d.marktextdivEx(s,t,i,r)},this.showSearch=function(e){if(d.DocRef.searchobj.page!==d.pagenumber)return;if(null==e&&(e=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx]),null==e)return;const{searchtext:t,indx:a,pos:i,length:r}=e;let s=a;d.usepdfjs?s=d.reindextextpos(s,t):d.usevectorxml&&d.settextdivs();const n=d.getdivpos(s),o=d.getpagerect(),l=Na/2,c=Aa/2,h=Na,u=Aa;if(0!=d.drotation){const e=d.getrotcoords(l,c,n.x,n.y,-d.drotation),{panx:t,pany:a}=function(e,t,a,i,r){let s=0,n=0;const o=Math.abs(e.x-i),l=Math.abs(e.x-0),c=Math.abs(e.y-r),h=Math.abs(e.y-0);return e.x>i||o<300?s=e.x-t:(e.x<0||l<100)&&(s=-(t-e.x)),e.y>r||c<100?n=e.y-a:(e.y<0||h<100)&&(n=-(a-e.y)),{panx:s,pany:n}}(e,l,c,h,u);d.pan_update(t,a)}else{const{panx:e,pany:t}=function(e,t,a,i,r,s,n,o){let l=0,c=0;const h=ll(),u=s/h;if(!H(e,r/h,u)){e.x,l=(e.x+.5*e.w)*h-a;const t=e.y,r=30,s=t*h,n=(e.y+e.h)*h;c=n>u?n-u:t<0?s-r:(e.y+.5*e.w)*h-i}return t.w<=r&&n&&(l=0),0===o&&n&&t.y>=0&&c<0&&(c=0),t.y-c>0&&(c=t.y),{panx:l,pany:c}}(n,o,l,c,h,u,d.usepdfjs,d.pagenumber);d.pan_update(e,t)}d.marktextdivEx(s,t,i,r)},this.showSearchorg=function(){if(d.DocRef.searchobj.page==d.pagenumber){if(d.usevectorxml){d.settextdivs();var e=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].searchtext,t=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].indx,a=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].pos,i=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].length}d.usepdfjs&&(e=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].searchtext,t=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].indx,a=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].pos,i=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].length,t=d.reindextextpos(t,e));var r=d.getdivpos(t),s=Aa/2,n=Na/2,o=Na,l=Aa,c=0,h=0,u=d.getpagerect();if(0!=d.drotation){var p=d.getrotcoords(n,s,r.x,r.y,-d.drotation);g=Math.max(p.x,Na)-Math.min(p.x,Na),(Math.max(p.x,Na)==p.x||g<300)&&(c=p.x-n),m=Math.max(p.y,Aa)-Math.min(p.y,Aa),(Math.max(p.y,Aa)==p.y||m<100)&&(h=p.y-s),f=Math.max(p.x,0)-Math.min(p.x,0),(Math.min(p.x,0)==p.x||f<100)&&(c=-(n-p.x)),y=Math.max(p.y,0)-Math.min(p.y,0),(Math.min(p.y,0)==p.y||y<100)&&(h=-(s-p.y)),d.pan_update(c,h)}else{var g=Math.max(r.x,o)-Math.min(r.x,o);(Math.max(r.x,o)==r.x||g<300)&&(c=r.x-n);var m=Math.max(r.y,l)-Math.min(r.y,l);(Math.max(r.y,l)==r.y||m<100)&&(h=r.y-s);var f=Math.max(r.x,0)-Math.min(r.x,0);(Math.min(r.x,0)==r.x||f<100)&&(c=-(n-r.x));var y=Math.max(r.y,0)-Math.min(r.y,0);(Math.min(r.y,0)==r.y||y<100)&&(h=-(s-r.y)),u.w<=o&&d.usepdfjs&&(c=0),0==d.pagenumber&&d.usepdfjs&&h<0&&(h=0),d.pan_update(c,h)}d.marktextdivEx(t,e,a,i)}},this.clearSearch=function(){if(d.DocRef.searchobj.page==d.pagenumber){var e=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].searchtext,t=d.DocRef.searchobj.matcharray[d.DocRef.searchobj.indx].indx;d.usepdfjs&&(t=d.reindextextposremove(t,e)),d.clearmarktextdiv(t,e)}},this.clearSearchRects=function(){if(d.DocRef.extractsearchobj.page==d.pagenumber){var e=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].searchtext,t=d.DocRef.extractsearchobj.matcharray[d.DocRef.extractsearchobj.indx].indx;d.usepdfjs&&(t=d.reindextextposremove(t,e)),d.clearmarktextdiv(t,e)}},this.loadfloorplan=function(){for(var e=0;e<d.floorplans.length;e++)d.floorplanlolad(e)},this.drawcamerapos=function(){d.bis3Dnavigator&&ar&&d.birdseyecamera()},this.setFloorNavScaleOffset=function(e){if(d.bis3Dnavigator){var t=e[0].scaleinfo.scaledDistance,a=e[1].scaleinfo.scaledDistance,i=e[0].scaleinfo.curscale,r=e[1].scaleinfo.curscale,s=(e[0].dist,e[0].pwidth,e[1].dist,e[1].pwidth,a*r/i/t),n=t/a;e[1].dist,e[1].pwidth,e[0].dist,e[0].pwidth,d.navfloorplan.RScale=n;var o=e[1].offset.x*n,l=e[1].offset.y*n,c=-(o-e[0].offset.x),h=-(l-e[0].offset.y);d.navfloorplan.offsetX=c,d.navfloorplan.offsetY=h,d.navfloorplan.replaceScale=s,d.navfloorplan.replaced=!0}},this.setAs3DNavigator=function(e,a){for(var i=[],r=0;r<e.length;r++)i.push({Elevation:e[r].Elevation,index:r});null!=a&&(d.bis3Dnavigator=!0,d.navfloorplan={index:e[a].index,SRC:e[a].SRC,Elevation:e[a].Elevation,Elevations:i,Scale:e[a].Scale,BScale:e[a].BScale,RScale:e[a].RScale,image:e[a].image,canvas:e[a].canvas,ctx:e[a].ctx,replaced:e[a].replaced,originalWidth:e[a].originalWidth,originalHeight:e[a].originalHeight,width:e[a].width,height:e[a].height,offsetX:e[a].offsetX,offsetY:e[a].offsetY,alignarray:e[a].alignarray},null==d.birdseyemarker&&(d.birdseyemarker=new Bl(t)))},this.birdseyecamera=function(){d.bis3Dnavigator&&d.DocRef.bActive&&d.navfloorplan&&(a.clearRect(0,0,t.width,t.height),d.birdseyemarker.drawme(a,!0))},this.getFloorLevel=function(){var e=null;return d.navfloorplan&&(e={floorindex:d.navfloorplan.index,replaced:d.navfloorplan.replaced}),e},this.get3DNavElevation=function(e){return d.navfloorplan.index==e.max},this.setcamerapos=function(e,t,a){d.camerapos=e.clone(),d.boxcenter=a.clone(),d.setbirdseyecamera(d.camerapos,t,a)},this.getnavcampos=function(e,t,a){if(d.DocRef.bActive&&d.navfloorplan&&null!=t){d.birdseyedispeye.distance=0,d.birdseyedispeye.rotation={degrees:90,radians:.5*Math.PI};var i=d.getpagedim();if(d.birdseyedispeye.r=32,d.navfloorplan.replaced){var r=i.scale/d.navfloorplan.RScale;d.birdseyedispeye.x=.5*d.navfloorplan.originalWidth*r+i.x,d.birdseyedispeye.y=.5*d.navfloorplan.originalHeight*r+i.y,d.birdseyedispeye.scale=r*d.navfloorplan.Scale,d.birdseyedispeye.x+=-d.navfloorplan.offsetX*r,d.birdseyedispeye.y+=-d.navfloorplan.offsetY*r}else d.birdseyedispeye.x=.5*i.w+i.x,d.birdseyedispeye.y=.5*i.h+i.y,d.birdseyedispeye.scale=i.scale*d.navfloorplan.Scale;d.birdseyedispeye.boxcenter=t,d.birdseyedispeye.camerapos=t;var s=d.navfloorplan.index,n=d.getCurfloorElevation(s,e),o=d.birdseyemarker.getcamera(d.birdseyedispeye,a.x,a.y);return o.z=n,o}},this.getfloorheight=function(e){return 1==e?1.8:0==e?1800:2==e?5.9:3==e?69:4==e?180:void 0},this.getCurfloorElevation=function(e,t){var a=null;if(null!=d.navfloorplan&&d.navfloorplan.index==e){var i=d.getfloorheight(t);a=d.navfloorplan.Elevation+i}return a},this.setbirdseyecamera=function(e,t,a){if(d.DocRef.bActive&&d.navfloorplan&&!(null==a&&null==a||null==e&&null==e)){null==t&&(t={degrees:90,radians:.5*Math.PI}),d.birdseyedispeye.distance=e.distanceTo(a),d.birdseyedispeye.rotation=t;var i=d.getpagedim();if(d.birdseyedispeye.r=32,d.navfloorplan.replaced){var r=i.scale/d.navfloorplan.RScale;d.birdseyedispeye.x=.5*d.navfloorplan.originalWidth*r+i.x,d.birdseyedispeye.y=.5*d.navfloorplan.originalHeight*r+i.y,d.birdseyedispeye.scale=r*d.navfloorplan.Scale,d.birdseyedispeye.x+=-d.navfloorplan.offsetX*r,d.birdseyedispeye.y+=-d.navfloorplan.offsetY*r}else d.birdseyedispeye.scale=i.scale*d.navfloorplan.Scale,d.birdseyedispeye.x=.5*i.w+i.x,d.birdseyedispeye.y=.5*i.h+i.y;d.birdseyedispeye.boxcenter=a,d.birdseyedispeye.camerapos=e,d.birdseyemarker.setcamera(d.birdseyedispeye)}},this.loadimages=function(){null!=Qt&&Qt.setDownload("show"),d.largeimageload()},this.setvectordim=function(t,a,i){if(null!=d.VectorPageObj){this.dxvector=t,this.dyvector=a,this.dscalevector=i,this.initialscale=i,this.vectorloaded=!0,d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),this.pagedimset=!0,d.draw_vector(!0),d.vectorpagetime=d.VectorPageObj.vectorpagetime,d.vectortimervar=setInterval((function(){d.vectortimer()}),d.vectorpagetime);var r=d.endx-d.startx,s=d.endy-d.starty;if(d.VectorPageObj.textlist.length>0&&d.settextdivs(!0),null!=d.TextSelectArea){var n=z(d.startx,d.starty,r,s);d.TextSelectArea.style.top=n.y+"px",d.TextSelectArea.style.left=n.x+"px",d.TextSelectArea.style.width=n.w+"px",d.TextSelectArea.style.height=n.h+"px",e.appendChild(d.TextSelectArea),o&&d.DocRef.textselect?d.TextSelectArea.style.display=Wa:d.TextSelectArea.style.display="none"}if(o&&!d.DocRef.markuploaded&&(zr?lc(l,d.DocRef):Wr?oc(d.DocRef):cc(l,d.DocRef)),ei?$h(d.DocRef.FileName):(iu(),d.DocRef.SetActive()),d.DocRef.bDoPrint&&d.DocRef.checkprintready()&&Uc(),Wu(),o){if(ee){if(null!=qe){var c={docindex:d.DocRef.fileindex,pageindex:d.pagenumber,floorindex:te};qe.loadComplete(d.DocRef.FileName,d.DocRef.bActive,c)}ee=!1,te=null}null!=Ve&&Ve.loadComplete(d.DocRef.FileName,d.DocRef.bActive)}null!=et&&et.loadComplete(d.pagenumber)}},this.removetext=function(){null!=d.TextSelectArea&&(d.TextSelectArea.removeEventListener("wheel",od,!0),d.TextSelectArea.remove())},this.selecttext=function(){null!=d.TextSelectArea&&(d.DocRef.textselect?d.TextSelectArea.style.display=Wa:d.TextSelectArea.style.display="none")},this.movetextdivs=function(){if(null!=d.TextSelectArea){ll();var e=Aa/2,t=Na/2;d.TextSelectArea.removeAttribute("style");var a=d.endx-d.startx,i=d.endy-d.starty,r=t-d.startx,s=e-d.starty,n=z(d.startx,d.starty,a,i);if(d.TextSelectArea.style.top=n.y+"px",d.TextSelectArea.style.left=n.x+"px",d.TextSelectArea.style.width=n.w+"px",d.TextSelectArea.style.height=n.h+"px",d.DocRef.textselect?d.TextSelectArea.style.display=Wa:d.TextSelectArea.style.display="none",0!=this.drotation){var o=r+"px "+s+"px";d.TextSelectArea.style.transformOrigin=o,d.TextSelectArea.style.transform="rotate("+this.drotation+"deg)"}}},this.settextdivs=function(){if(null!=d.TextSelectArea){d.TextSelectArea.removeAttribute("style");var e=_(),t=d.endx-d.startx,a=d.endy-d.starty,i=z(e.dx,e.dy,t,a);d.TextSelectArea.style.top=i.y+"px",d.TextSelectArea.style.left=i.x+"px",d.TextSelectArea.style.width=i.w+"px",d.TextSelectArea.style.height=i.h+"px",d.DocRef.textselect?d.TextSelectArea.style.display=Wa:d.TextSelectArea.style.display="none",0!=this.drotation&&(d.TextSelectArea.style.transformOrigin="50% 50%",d.TextSelectArea.style.transform="rotate("+this.drotation+"deg)");var r={textLayerDiv:d.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};d.VectorPageObj.TextLayerBuilder(r)}},this.cleartextdivs=function(){if(null!=d.TextSelectArea){var e={textLayerDiv:d.TextSelectArea,scale:this.dscalevector,dx:this.dxvector,dy:this.dyvector};d.VectorPageObj.TextLayerClear(e)}},this.setimagedimlarge=function(e,t,a){if(this.dx=e,this.dy=t,this.dscale=a,this.largeimageloaded=!0,o&&!d.DocRef.markuploaded&&(zr?lc(l,d.DocRef):Wr?oc(d.DocRef):cc(l,d.DocRef)),1==this.initialzoom||this.ZoomRealSize(),null!=Qt&&Qt.setDownload("hide"),ei?$h(d.DocRef.FileName):(iu(),d.DocRef.SetActive()),d.DocRef.bDoPrint&&d.DocRef.checkprintready()&&Uc(),Wu(),o){if(ee){if(null!=qe){var i={docindex:d.DocRef.fileindex,pageindex:d.pagenumber,floorindex:te};qe.loadComplete(d.DocRef.FileName,d.DocRef.bActive,i)}ee=!1,te=null}null!=Ve&&Ve.loadComplete(d.DocRef.FileName,d.DocRef.bActive)}null!=et&&et.loadComplete(d.pagenumber),null!=gt&&gt.setVectorBlocks([])},this.setimagedimsmall=function(e,t,a){this.dxextent=e,this.dyextent=t,this.dscaleextent=a,this.initialscale=a,d.setpagedimsize(this.dxextent,this.dyextent,this.SmallImageWidth*this.dscaleextent,this.SmallImageHeight*this.dscaleextent,!1),this.smallimageloaded=!0,this.pagedimset=!0,d.largeimageloaded?(d.dscale=d.smallimagecnv.width*d.dscaleextent/d.largeimagecnv.width,d.dx=d.dxextent,d.dy=d.dyextent,d.bitmapratio=d.dscale/d.dscaleextent):(d.dscale=d.dscaleextent,d.dx=d.dxextent,d.dy=d.dyextent,d.bitmapratio=1),this.draw_image(!0)},this.checkimageswitch=function(){this.dscale/d.bitmapratio<Za?this.currentimage=1:this.currentimage=0,d.setpagedimsize(this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale,!1)},this.ZoomRealSize=function(){var e=d.MainImageWidth/this.MainImageScaling/d.DPI*96;this.dscale=e/d.MainImageWidth,this.dx=(Na-this.MainImageWidth*this.dscale)/2,this.dy=0},this.getdx=function(){return this.usevectorxml?this.dxvector:this.usepdfjs?this.dxpdf:this.dx},this.getdy=function(){return this.usevectorxml?this.dyvector:this.usepdfjs?this.dypdf:this.dy},this.getdscale=function(){return this.usevectorxml?this.dscalevector:this.usepdfjs?this.dscalepdf*this.curpagescale:this.dscale},this.getClipRect=function(e){var t=void 0;if(d.usevector3DGLTF){var a=u.getContext();e.y=Aa-e.y-e.h;var i=new Uint8Array(e.w*e.h*4);a.readPixels(e.x,e.y,e.w,e.h,a.RGBA,a.UNSIGNED_BYTE,i);var s=new Uint8ClampedArray(i);t=function(e){var t=document.createElement("canvas"),a=document.createElement("canvas"),i=t.getContext("2d"),r=a.getContext("2d");return t.width=e.width,t.height=e.height,a.width=e.width,a.height=e.height,i.putImageData(e,0,0),r.save(),r.translate(0,t.height),r.scale(1,-1),r.drawImage(t,0,0),r.restore(),r.getImageData(0,0,e.width,e.height)}(t=new ImageData(s,e.w,e.h))}else t=r.getImageData(e.x,e.y,e.w,e.h);return t},this.screentoDocRect=function(e){return{x:(e.x-d.getdx())/d.getdscale(),y:(e.y-d.getdy())/d.getdscale(),w:e.w/d.getdscale(),h:e.h/d.getdscale()}},this.getcur3DView=function(){var e=null;return d.usevector3DGLTF&&d.Vector3DPageObj&&(e=d.Vector3DPageObj.getcur3DView()),e},this.setpagedim=function(e,t,a,i){var r=d.getpagedim(),s=t/r.w;r.h,s>1?d.ZoomIn(s,!0,!0):(s=1/s,d.ZoomOut(s,!0,!0)),d.pan_position(a,i)},this.getpagedim=function(){var e=d.DPI;d.usepdfjs&&(e=72);var t=d.getpagerect();return{x:t.x,y:t.y,w:t.w,h:t.h,origw:d.originalwidth,origh:d.originalheight,scale:d.getdscale(),dpi:e,rotation:d.drotation}},this.setpdfScale=function(e){d.dscalepdf=e},this.getpdfScale=function(){return d.dscalepdf},this.redraw=function(){this.usevectorxml?this.draw_vector(!0):this.usepdfjs?(d.pdfisrendered=!1,d.pdfrenderopque+=1,d.DocRef.draw_mpagepdf()):this.draw_image(!0),Y()},this.zoomall=function(e){if(null!=da&&null==e){var t={rect:d.getpagerect()};da.zoomUpdate(t,3)}if(!this.usevector3Dxml){if(this.usepdfjs)var a=d.offscreenheight,i=d.offscreenwidth;else W(function(e){var t=e.dscale,a=e.dscale;switch(d.drotation){case 0:t=Aa/e.height,a=Na/e.width;break;case 90:t=Aa/e.width,a=Na/e.height;break;case 180:t=Aa/e.height,a=Na/e.width;break;case 270:t=Aa/e.width,a=Na/e.height}e.dscale=Math.min(a,t),e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;var i=e.dx,r=e.dy,s=e.width*e.dscale+i,n=e.height*e.dscale+r;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:i,starty:r,endx:s,endy:n}}(_()),!1);if(this.usepdfjs){var r=this.dypdf,s=this.dxpdf;switch(this.drotation){case 0:r=Aa/a,s=Na/i,d.setpdfScale(Math.min(s,r));break;case 90:r=Aa/i,s=Na/a,d.setpdfScale(Math.min(s,r));break;case 180:r=Aa/a,s=Na/i,d.setpdfScale(Math.min(s,r));break;case 270:r=Aa/i,s=Na/a,d.setpdfScale(Math.min(s,r))}d.pdfisrendered=!1,d.pdfrenderopque+=1,this.dxpdf=(Na-i*this.dscalepdf)/2,this.dypdf=(Aa-a*this.dscalepdf)/2}if(this.usepdfjs&&(d.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber)){var n=i/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(n),d.DocRef.draw_mpagepdf()}Y(),null!=pa&&null==e&&(t={rect:d.getpagerect()},pa.zoomUpdate(t,3))}},this.getPageScale=function(){return d.curpagescale},this.enablepagetextCallback=function(){d.useTextCallback=!0},this.documentpageScale=function(e,t){d.usepdfjs&&d.pdfdiminitset&&e!=d.curpagescale&&(d.setpdfScale(e/(d.offscreenwidth/d.pdfpagewidth)),d.pdfrenderopque+=1,t&&(d.dxpdf=(Na-d.offscreenwidth*d.dscalepdf)/2),d.setpagedimsize(d.dxpdf,d.dypdf,d.offscreenwidth*d.dscalepdf,d.offscreenheight*d.dscalepdf,!1),d.pdfisrendered=!1)},this.ZoomPageUpdate=function(e,t){switch(t){case 0:d.ZoomIn(e.factor,e.center,!0,e.mousepos);break;case 1:d.ZoomOut(e.factor,e.center,!0,e.mousepos);break;case 2:d.zoom_update(e.sx,e.sy,e.sWide,e.sHi,!0);break;case 3:d.zoomall(!0);break;case 4:d.zoomwidth(!0);break;case 5:d.zoomheight(!0)}},this.vectorscrollbuffer=function(e,t,a){var i={s:e,x:t,y:a};d.vectordebounce_timer&&window.clearTimeout(d.vectordebounce_timer),d.vectordebounce_timer=window.setTimeout((function(){i&&(i.s,d.vectorischanged=!0,i=null)}),100)},this.getBlockCentroid=function(e){if(this.usevectorxml)var t=d.VectorPageObj.getblockcentroid(e,d.dscalevector,d.dxvector,d.dyvector);return t},this.ZoomToBlock=function(e){if(this.usevectorxml){var t=d.VectorPageObj.getBlockRect(e,d.dscalevector,d.dxvector,d.dyvector);t.found&&this.zoom_update(t.x-t.wp,t.y-t.hp,t.w+2*t.wp,t.h+2*t.hp)}},this.ZoomToBlockInsert=function(e){if(this.usevectorxml){var t=d.VectorPageObj.getBlockInsertRect(e,d.dscalevector,d.dxvector,d.dyvector),a=t;0!=d.getpageRotation()&&(a=function(e,t){var a=Na/2,i=Aa/2,r=a,s=i,n=0,o={x:e.x,y:e.y,w:e.w,h:e.h};switch(n=t*(Math.PI/180),t){case 0:n=t*(Math.PI/180);break;case 90:n=t*(Math.PI/180);var l=o.h;o.h=o.w,o.w=l;break;case 270:n=t*(Math.PI/180),l=o.h,o.h=o.w,o.w=l;break;case 180:n=t*(Math.PI/180)}var c=Math.cos(n),h=Math.sin(n),u=o.x-r,d=o.y-s;return(o={x:u*c-d*h,y:u*h+d*c,w:o.w,h:o.h}).x=a+o.x,o.y=i+o.y,o}(t,d.getpageRotation())),t.found&&(this.zoom_update(a.x,a.y,a.w,a.h,!0),.1*d.dscalevector>d.fixedScale?this.ZoomOut(10):this.ZoomOut(2))}},this.ZoomOutTest=function(e,t,a){if(!this.usevector3Dxml){if(a){var i={x:a.x,y:a.y};0!=d.drotation&&(i=on(a.x,a.y));var r=(Na/2-i.x)/e-(Na/2-i.x),s=(Aa/2-i.y)/e-(Aa/2-i.y)}var n=(Na-this.MainImageWidth*this.dscale)/2,o=(Aa-this.MainImageHeight*this.dscale)/2,l=(this.dx,this.dy,this.dscale/e);this.MainImageWidth,this.MainImageHeight;if(this.usevectorxml&&null!=d.VectorPageObj){var c=(Na-d.VectorPageObj.width*this.dscalevector)/2,h=(Aa-d.VectorPageObj.height*this.dscalevector)/2,u=c-this.dxvector,p=h-this.dyvector,g=this.dscalevector/e,m=(Na-d.VectorPageObj.width*g)/2,f=(Aa-d.VectorPageObj.height*g)/2;if(t)var y=m,v=f;else y=m-u/e,v=f-p/e;a&&(y+=r,v+=s)}if(this.usepdfjs){var b=d.offscreenheight,x=d.offscreenwidth,w=(Na-x*this.dscalepdf)/2,k=(Aa-b*this.dscalepdf)/2,D=w-this.dxpdf,C=k-this.dypdf,P=(this.dxpdf,this.dypdf,Aa/b),S=Na/x,R=Math.min(S,P),M=x*this.dscalepdf/d.pdfpagewidth*e,T=b*this.dscalepdf/d.pdfpageheight*e;if(Math.min(M,T),1==d.DocRef.pages.length){var E=this.dscalepdf/e;this.bMinzoom=!1}else E=this.dscalepdf/e<R?R:this.dscalepdf/e;var F=(Na-x*this.dscalepdf)/2,I=(Aa-b*this.dscalepdf)/2;if(t)var j=F,O=I;else j=F-D/e,O=I-C/e;if(x<=Na){j=F;var L=!0}x*this.dscalepdf<=Na&&(j=(Na-x*this.dscalepdf)/2,L=!0),a&&(L||(j+=r),O+=s)}if(this.usevectorxml)null!=d.VectorPageObj&&(V=y,N=v,A=d.VectorPageObj.width*g+V,B=d.VectorPageObj.height*g+N);else if(this.usepdfjs){var V=j,N=O,A=x*E+V,B=b*E+N;d.pagenumber,d.DocRef.pages[d.DocRef.currentpage].pagenumber}return d.getpagetestrect({startx:V,starty:N,endx:A,endy:B})}},this.ZoomIn=function(e,t,a,i){if(!this.usevector3Dxml){if(d.DocRef.textselect&&(i=void 0),null!=da&&0==a){var r={factor:e,center:t,mousepos:i,rect:d.getpagerect()};da.zoomUpdate(r,0)}if(i){var s={x:i.x,y:i.y};0!=d.drotation&&(s=on(i.x,i.y));var n=(Na/2-s.x)*e-(Na/2-s.x),o=(Aa/2-s.y)*e-(Aa/2-s.y)}if(this.usepdfjs){var l=d.offscreenheight,c=d.offscreenwidth;this.bMinzoom=!1;var h=(Na-c*this.dscalepdf)/2,u=(Aa-l*this.dscalepdf)/2,p=h-this.dxpdf,g=u-this.dypdf,m=c*this.dscalepdf/d.pdfpagewidth*e,f=l*this.dscalepdf/d.pdfpageheight*e;Math.min(m,f),d.setpdfScale(d.getpdfScale()*e);var y=(Na-c*this.dscalepdf)/2,v=(Aa-l*this.dscalepdf)/2;if(t?(this.dxpdf=y,this.dypdf=v):(this.dxpdf=y-p*e,this.dypdf=v-g*e),c<=Na){d.DocRef.pagelocked||(this.dxpdf=y);var b=!0}if(c*this.dscalepdf<=Na&&(d.DocRef.pagelocked||(d.dxpdf=(Na-c*this.dscalepdf)/2),b=!0),i&&((!b||d.DocRef.pagelocked&&!Di)&&(this.dxpdf+=n,this.startx+=n,this.endx+=n),this.dypdf+=o,this.starty+=o,this.endy+=o),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber){var x=c/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(x)}d.pdfrenderopque+=1,d.pdfisrendered=!1}else{var w=_();if(null!=w){var k=X(t,e,w,!0);i&&(k.dx+=n,k.dy+=o,k.startx+=n,k.endx+=n,k.starty+=o,k.endy+=o),W(k,!0)}}this.usepdfjs&&(d.setpagedimsize(this.dxpdf,this.dypdf,c*this.dscalepdf,l*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf()),Y(),null!=pa&&0==a&&(r={factor:e,center:t,mousepos:i,rect:d.getpagerect()},pa.zoomUpdate(r,0))}},this.ZoomOut=function(e,t,a,i){if(!this.usevector3Dxml){if(d.DocRef.textselect&&(i=void 0),null!=da&&0==a){var r={factor:e,center:t,mousepos:i,rect:d.getpagerect()};da.zoomUpdate(r,1)}if(i){var s={x:i.x,y:i.y};0!=d.drotation&&(s=on(i.x,i.y));var n=(Na/2-s.x)/e-(Na/2-s.x),o=(Aa/2-s.y)/e-(Aa/2-s.y)}if(this.usepdfjs){var l=d.offscreenheight,c=d.offscreenwidth,h=(Na-c*this.dscalepdf)/2,u=(Aa-l*this.dscalepdf)/2,p=h-this.dxpdf,g=u-this.dypdf,m=(this.dxpdf,this.dypdf,Aa/l),f=Na/c,y=Math.min(f,m),v=c*this.dscalepdf/d.pdfpagewidth*e,b=l*this.dscalepdf/d.pdfpageheight*e;Math.min(v,b),1==d.DocRef.pages.length?(d.setpdfScale(d.getpdfScale()/e),this.bMinzoom=!1):d.getpdfScale()/e<y?(d.setpdfScale(y),this.bMinzoom=!0):(d.setpdfScale(d.getpdfScale()/e),this.bMinzoom=!1);var x=(Na-c*this.dscalepdf)/2,w=(Aa-l*this.dscalepdf)/2;if(t?(this.dxpdf=x,this.dypdf=w):(this.dxpdf=x-p/e,this.dypdf=w-g/e),c<=Na){d.DocRef.pagelocked||(this.dxpdf=x);var k=!0}if(c*this.dscalepdf<=Na&&(d.DocRef.pagelocked||(d.dxpdf=(Na-c*this.dscalepdf)/2),k=!0),i&&((!k||d.DocRef.pagelocked&&!Di)&&(this.dxpdf+=n,this.startx+=n,this.endx+=n),this.dypdf+=o,this.starty+=o,this.endy+=o),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber){var D=c/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(D)}d.pdfrenderopque+=1,d.pdfisrendered=!1}else{var C=X(t,e,_(),!1);i&&(C.dx+=n,C.dy+=o,C.startx+=n,C.endx+=n,C.starty+=o,C.endy+=o),W(C,!0)}this.usepdfjs&&(d.setpagedimsize(this.dxpdf,this.dypdf,c*this.dscalepdf,l*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf()),Y(),null!=pa&&0==a&&(r={factor:e,center:t,mousepos:i,rect:d.getpagerect()},pa.zoomUpdate(r,1))}},this.zoomwidth=function(e){if(!this.usevector3Dxml){if(null!=da&&null==e){var t={rect:d.getpagerect()};da.zoomUpdate(t,4)}var a=0;if(this.usepdfjs)var i=d.offscreenheight,r=d.offscreenwidth;else W(function(e){var t=0;switch(d.drotation){case 0:t=Na/e.width,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 90:t=Na/e.height,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 180:t=Na/e.width,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 270:t=Na/e.height,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;default:t=Na/e.width,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2}var a=e.dx,i=e.dy,r=e.width*e.dscale+a,s=e.height*e.dscale+i;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:a,starty:i,endx:r,endy:s}}(_()),!1);if(this.usepdfjs){var s=Na-16;switch(this.drotation){case 0:a=s/r,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 90:a=s/i,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 180:a=s/r,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 270:a=s/i,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;default:a=s/r,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2}}if(this.usepdfjs){if(d.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,i*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber){var n=r/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(n),d.DocRef.draw_mpagepdf()}d.pdfrenderopque+=1,d.pdfisrendered=!1}Y(),null!=pa&&null==e&&(t={rect:d.getpagerect()},pa.zoomUpdate(t,4))}},this.zoomheight=function(e){if(!this.usevector3Dxml){if(null!=da&&null==e){var t={rect:d.getpagerect()};da.zoomUpdate(t,5)}var a=0;if(this.usepdfjs)var i=d.offscreenheight,r=d.offscreenwidth;if(this.usepdfjs)switch(this.drotation){case 0:a=Aa/i,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 90:a=Aa/r,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 180:a=Aa/i,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2;break;case 270:a=Aa/r,d.setpdfScale(a),this.dxpdf=(Na-r*this.dscalepdf)/2,this.dypdf=(Aa-i*this.dscalepdf)/2}else W(function(e){var t=0;switch(d.drotation){case 0:t=Aa/e.height,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 90:t=Aa/e.width,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 180:t=Aa/e.height,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2;break;case 270:t=Aa/e.width,e.dscale=t,e.dx=(Na-e.width*e.dscale)/2,e.dy=(Aa-e.height*e.dscale)/2}var a=e.dx,i=e.dy,r=e.width*e.dscale+a,s=e.height*e.dscale+i;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:a,starty:i,endx:r,endy:s}}(_()),!1);if(this.usepdfjs&&(d.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,i*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber)){var s=r/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(s),d.DocRef.draw_mpagepdf()}this.usepdfjs&&(d.pdfrenderopque+=1,d.pdfisrendered=!1),Y(),null!=pa&&null==e&&(t={rect:d.getpagerect()},pa.zoomUpdate(t,5))}},this.mtzoom_update=function(e,t,a){this.MainImageHeight,this.MainImageWidth;var i=Math.sqrt(Math.pow(this.MainImageHeight,2)+Math.pow(this.MainImageWidth,2)),r=Math.sqrt(Math.pow(Aa,2)+Math.pow(Na,2)),s=t*i-r;if(this.dscale=(r+s+e)/i,this.usevectorxml&&null!=d.VectorPageObj){d.VectorPageObj.height,d.VectorPageObj.width;var n=Math.sqrt(Math.pow(d.VectorPageObj.height,2)+Math.pow(d.VectorPageObj.width,2));s=a*n-r,this.dscalevector=(r+s+e)/n}if(this.usepdfjs){var o=d.offscreenheight,l=d.offscreenwidth,c=Math.sqrt(Math.pow(o,2)+Math.pow(o,2));s=a*c-r,d.setpdfScale((r+s+e)/c),d.pdfrenderopque+=1,d.pdfisrendered=!1}this.usevector3Dxml||(this.usevectorxml?null!=d.VectorPageObj&&(d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),d.draw_vector(!1),d.vectorischanged=!0):this.usepdfjs?(d.setpagedimsize(this.dxpdf,this.dypdf,l*this.dscalepdf,o*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf()):(this.checkimageswitch(),0==d.DocRef.Type?d.DocRef.draw_mpage():d.draw_image(!0)),Y())},this.getRotatedPoint=function(e,t,a,i,r){var s=Math.cos(r),n=Math.sin(r),o=a-e,l=i-t,c=new Gs(o*s-l*n,o*n+l*s);return c.x=e+c.x,c.y=t+c.y,c},this.zoom_update=function(e,t,a,i,r){if(!this.usevector3Dxml){var s=1/ll(),n={x:e,y:t,w:a,h:i};if(n.x=n.x*s,n.y=n.y*s,n.w=n.w*s,n.h=n.h*s,0!=this.drotation&&function(e,t){var a=Na/2,i=Aa/2,r=0,s={x:e.x,y:e.y,w:e.w,h:e.h};switch(t){case 0:return r=t*(Math.PI/180),s;case 90:r=(t+180)*(Math.PI/180);var n=s.h;s.h=s.w,s.w=n;break;case 270:r=(t-180)*(Math.PI/180),n=s.h,s.h=s.w,s.w=n;break;case 180:r=t*(Math.PI/180)}var o=Math.cos(r),l=Math.sin(r),c=s.x-a,h=s.y-i;(s={x:c*o-h*l,y:c*l+h*o,w:s.w,h:s.h}).x=a+s.x,s.y=i+s.y}(n,this.drotation),null!=da&&null==r){var o={sx:e,sy:t,sWide:a,sHi:i,rect:d.getpagerect()};da.zoomUpdate(o,2)}var l=1,c=0,h=Aa/2,u=Na/2,p=(this.drotation,Math.PI,e+a/2),g=t+i/2,m=e/this.dscalepdf,f=t/this.dscalepdf,y=(this.dscalepdf,this.dscalepdf,i/this.dscalepdf),v=a/this.dscalepdf,b=0,x=0;if(this.usepdfjs)var w=d.offscreenheight,k=d.offscreenwidth;if(this.usepdfjs)switch(this.drotation){case 90:f=this.dypdf+p-u,m=this.dxpdf-g+h,this.dxpdf=m,this.dypdf=f,y>0&&v>0&&(x=this.dscalepdf*Aa/i,b=this.dscalepdf*Na/a),c=(l=Math.min(x,b))/this.dscalepdf;var D=(Na-k*this.dscalepdf)/2,C=(Aa-w*this.dscalepdf)/2,P=D-this.dxpdf,S=C-this.dypdf;d.setpdfScale(l);var R=(Na-k*this.dscalepdf)/2,M=(Aa-w*this.dscalepdf)/2;this.dxpdf=R-P*c,this.dypdf=M-S*c;break;case 270:f=this.dypdf-p+u,m=this.dxpdf+g-h,this.dxpdf=m,this.dypdf=f,y>0&&v>0&&(x=this.dscalepdf*Aa/i,b=this.dscalepdf*Na/a),c=(l=Math.min(x,b))/this.dscalepdf,D=(Na-k*this.dscalepdf)/2,C=(Aa-w*this.dscalepdf)/2,P=D-this.dxpdf,S=C-this.dypdf,d.setpdfScale(l),R=(Na-k*this.dscalepdf)/2,M=(Aa-w*this.dscalepdf)/2,this.dxpdf=R-P*c,this.dypdf=M-S*c;break;case 180:f=this.dypdf+g-h,m=this.dxpdf+p-u,this.dxpdf=m,this.dypdf=f,y>0&&v>0&&(x=this.dscalepdf*Aa/i,b=this.dscalepdf*Na/a),c=(l=Math.min(x,b))/this.dscalepdf,D=(Na-k*this.dscalepdf)/2,C=(Aa-w*this.dscalepdf)/2,P=D-this.dxpdf,S=C-this.dypdf,d.setpdfScale(l),R=(Na-k*this.dscalepdf)/2,M=(Aa-w*this.dscalepdf)/2,this.dxpdf=R-P*c,this.dypdf=M-S*c;break;case 0:m=-(p-this.dxpdf)/this.dscalepdf,f=-(g-this.dypdf)/this.dscalepdf,y>0&&v>0&&(x=this.dscalepdf*Aa/i,b=this.dscalepdf*Na/a),d.setpdfScale(Math.min(x,b)),this.dxpdf=m*this.dscalepdf+Na/2,this.dypdf=f*this.dscalepdf+Aa/2}else{var T=function(e,t,a,i,r){var s=0,n=0,o=0,l=Aa/2,c=Na/2,h=(d.drotation,Math.PI,t+i/2),u=a+r/2,p=t/e.dscale,g=a/e.dscale,m=(e.dscale,e.dscale,r/e.dscale),f=i/e.dscale,y=Aa/e.height,v=Na/e.width;switch(e.height,e.dscale,d.drotation){case 90:n=h-c,o=u-l,g=e.dy+n,p=e.dx-o,e.dx=p,e.dy=g,m>0&&f>0&&(y=e.dscale*Aa/r,v=e.dscale*Na/i),s=Math.min(y,v)/e.dscale;var b={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy};W(b,!1),d.ZoomIn(s,!1,!1);break;case 270:n=h-c,o=u-l,g=e.dy-n,p=e.dx+o,e.dx=p,e.dy=g,m>0&&f>0&&(y=e.dscale*Aa/r,v=e.dscale*Na/i),s=Math.min(y,v)/e.dscale,W(b={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy},!1),d.ZoomIn(s,!1,!1);break;case 180:n=h-c,o=u-l,g=e.dy+o,p=e.dx+n,e.dx=p,e.dy=g,m>0&&f>0&&(y=e.dscale*Aa/r,v=e.dscale*Na/i),s=Math.min(y,v)/e.dscale,W(b={dscale:e.dscale,dx:e.dx,dy:e.dy,startx:e.dx,starty:e.dy,endx:e.width*e.dscale+e.dx,endy:e.height*e.dscale+e.dy},!1),d.ZoomIn(s,!1,!1);break;case 0:p=-(h-e.dx)/e.dscale,g=-(u-e.dy)/e.dscale,m>0&&f>0&&(y=e.dscale*Aa/r,v=e.dscale*Na/i),e.dscale=Math.min(y,v),e.dx=p*e.dscale+Na/2,e.dy=g*e.dscale+Aa/2}var x=e.dx,w=e.dy,k=e.width*e.dscale+x,D=e.height*e.dscale+w;return{dscale:e.dscale,dx:e.dx,dy:e.dy,startx:x,starty:w,endx:k,endy:D}}(_(),e,t,a,i);0==d.drotation&&W(T,!1)}if(this.usepdfjs&&(d.setpagedimsize(this.dxpdf,this.dypdf,k*this.dscalepdf,w*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber)){var E=k/d.pdfpagewidth*this.dscalepdf;d.DocRef.setDocumentpageScale(E),d.DocRef.draw_mpagepdf()}this.usepdfjs&&(d.pdfrenderopque+=1,d.pdfisrendered=!1),Y(),null!=pa&&null==r&&(o={sx:e,sy:t,sWide:a,sHi:i,rect:d.getpagerect()},pa.zoomUpdate(o,2))}},this.MarkupFindText=function(e){for(var t=[],a=0;a<d.DocRef.markuplist.length;a++)d.DocRef.markuplist[a].FindText(e)&&t.push(d.DocRef.markuplist[a]);return t},this.getMarkupPos=function(e){var t=e.hscaled,a=e.wscaled,i=e.xscaled,r=e.yscaled;switch(e.bisTextArrow&&null!=e.textBoxConnected&&(t=Math.max(e.hscaled,e.textBoxConnected.hscaled),a=Math.max(e.wscaled,e.textBoxConnected.wscaled),i=Math.min(e.xscaled,e.textBoxConnected.xscaled),r=Math.min(e.yscaled,e.textBoxConnected.yscaled)),e.pagenumber,this.drotation){case 0:switch(e.type){case 0:case 1:case 2:case 6:case 7:case 8:a-=i,t-=r;break;case 9:break;case 13:a-=i,t-=r}break;case 90:t=e.rotatedrect.h,a=e.rotatedrect.w;var s=i=e.rotatedrect.x;i=a,a=s,a-=i,t-=r=e.rotatedrect.y;break;case 180:t=e.rotatedrect.h,a=e.rotatedrect.w;var n=i=e.rotatedrect.x,o=r=e.rotatedrect.y;i=a,r=t,a=n,t=o,a-=i,t-=r;break;case 270:t=e.rotatedrect.h,a=e.rotatedrect.w,i=e.rotatedrect.x;var l=r=e.rotatedrect.y;r=t,t=l,a-=i,t-=r}return{x:i,y:r,w:a,h:t}},this.panToMarkup=function(e){e.selected||e.selectedit?e.drawmescaled(a):e.drawmescaled(n);var t=d.getMarkupPos(e);d.pan_update(0,0);var i=Aa/2,r=Na/2,s=0,o=0,l=d.getpagerect(),c=t.x+.5*t.w,h=t.y+.5*t.h;if(0!=d.drotation){var u=d.getrotcoords(r,i,c,h,-d.drotation);p=Math.max(u.x,Na)-Math.min(u.x,Na),(Math.max(u.x,Na)==u.x||p<300)&&(s=u.x-r),g=Math.max(u.y,Aa)-Math.min(u.y,Aa),(Math.max(u.y,Aa)==u.y||g<100)&&(o=u.y-i),m=Math.max(u.x,0)-Math.min(u.x,0),(Math.min(u.x,0)==u.x||m<100)&&(s=-(r-u.x)),f=Math.max(u.y,0)-Math.min(u.y,0),(Math.min(u.y,0)==u.y||f<100)&&(o=-(i-u.y)),d.pan_update(s,o)}else{var p=Math.max(c,Na)-Math.min(c,Na);(Math.max(c,Na)==c||p<300)&&(s=c-r);var g=Math.max(h,Aa)-Math.min(h,Aa);(Math.max(h,Aa)==h||g<100)&&(o=h-i);var m=Math.max(c,0)-Math.min(c,0);(Math.min(c,0)==c||m<100)&&(s=-(r-c));var f=Math.max(h,0)-Math.min(h,0);(Math.min(h,0)==h||f<100)&&(o=-(i-h)),l.w<=Na&&d.usepdfjs&&(s=0),d.pan_update(s,o)}},this.zoomToMarkup=function(e){this.zoomall();var t=d.getMarkupPos(e),a=t.h+100,i=t.w+50,r=t.x-50,s=t.y-50;this.zoom_update(r,s,i,a)},this.MarkupFind=function(e){for(var t=d.MarkupFindText(e);this.CurrentMarkup<t.length;)t[this.CurrentMarkup].FindText(e)&&d.zoomToMarkup(t[this.CurrentMarkup]),this.CurrentMarkup++;this.CurrentMarkup=0},this.SetMarkupZoom=function(e,t,a){if(this.usevectorxml&&null!=d.VectorPageObj)d.vectorloaded?(this.dscalevector=a,this.dxvector=e,this.dyvector=t,d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),this.draw_vector(!1)):d.loadbinvectors();else if(this.usepdfjs){var i=d.offscreenheight,r=d.offscreenwidth;d.setpdfScale(a),this.dxpdf=e,this.dypdf=t,d.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,i*this.dscalepdf,!1),d.pdfrenderopque+=1,d.pdfisrendered=!1,console.log("SetMarkupZoom invalidation"),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf()}else this.dscale=a,this.dx=e,this.dy=t,this.checkimageswitch(),0==d.DocRef.Type?d.DocRef.draw_mpage():d.draw_image(!0)},this.MarkupZoombyMarkup=function(e){this.zoomall(),this.dscale,e.scaling,this.usevectorxml?(this.dscalevector,e.scaling):this.usepdfjs?(this.dscalepdf,e.scaling):(this.dscale,e.scaling);var t=e.xscaled,a=e.wscaled,i=e.yscaled,r=e.hscaled;switch(this.drotation){case 0:switch(e.type){case 0:case 1:case 2:t=Math.min(e.xscaled,e.wscaled),a=Math.max(e.xscaled,e.wscaled),i=Math.min(e.yscaled,e.hscaled),r=Math.max(e.yscaled,e.hscaled),a-=t,r-=i;break;case 6:case 7:t=Math.min(e.xscaled,e.wscaled),a=Math.max(e.xscaled,e.wscaled),i=Math.min(e.yscaled,e.hscaled),r=Math.max(e.yscaled,e.hscaled),0==(r-=i)&&(r=1),0==(a-=t)&&(a=1);break;case 8:t=Math.min(e.xscaled,e.wscaled),a=Math.max(e.xscaled,e.wscaled),i=Math.min(e.yscaled,e.hscaled),r=Math.max(e.yscaled,e.hscaled),a-=t,r-=i;break;case 9:if(0==e.textrotate&&(t=e.rotatedrect.x,a=e.rotatedrect.w,i=e.rotatedrect.y,r=e.rotatedrect.h),e.textrotate/(Math.PI/180)==90){t=e.xscaled,i=e.yscaled;var s=a=e.wscaled;a=r=e.hscaled,r=s}e.textrotate/(Math.PI/180)==270&&(t=e.xscaled,i=e.yscaled,s=a=e.wscaled,t-=a=r=e.hscaled,i-=r=s),e.textrotate/(Math.PI/180)==180&&(t=e.xscaled,i=e.yscaled,t-=a=e.wscaled,i-=r=e.hscaled)}break;case 90:case 180:case 270:t=Math.min(e.rotatedrect.x,e.rotatedrect.w),a=Math.max(e.rotatedrect.x,e.rotatedrect.w),i=Math.min(e.rotatedrect.y,e.rotatedrect.h),r=Math.max(e.rotatedrect.y,e.rotatedrect.h),0==(r-=i)&&(r=1),0==(a-=t)&&(a=1)}this.zoom_update(t,i,a,r),this.ZoomOut(3,!1,!1)},this.MarkupZoom=function(){this.CurrentMarkup>d.DocRef.nummarkups-1&&(this.CurrentMarkup=0);for(var e=d.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup>=d.DocRef.nummarkups-1;)this.CurrentMarkup++,e=d.DocRef.markuplist[this.CurrentMarkup].pagenumber;if(this.CurrentMarkup<=d.DocRef.nummarkups-1&&(this.MarkupZoombyMarkup(d.DocRef.markuplist[this.CurrentMarkup]),this.CurrentMarkup++,this.CurrentMarkup<=d.DocRef.nummarkups-1)){for(e=d.DocRef.markuplist[this.CurrentMarkup].pagenumber;e!=this.pagenumber&&this.CurrentMarkup<=d.DocRef.nummarkups-1&&(this.CurrentMarkup++,!(this.CurrentMarkup>=d.DocRef.nummarkups-1));)e=d.DocRef.markuplist[this.CurrentMarkup].pagenumber;this.CurrentMarkup>=d.DocRef.nummarkups-1&&(this.CurrentMarkup=0)}},this.resize=function(){if(!this.usevector3Dxml){if(d.bDorescaleonsizeChange){var e=Aa/this.MainImageHeight,t=Na/this.MainImageWidth;this.dscale=Math.min(t,e),this.dx=(Na-this.MainImageWidth*this.dscale)/2,this.dy=(Aa-this.MainImageHeight*this.dscale)/2}if(this.usevectorxml&&d.bDorescaleonsizeChange&&null!=d.VectorPageObj&&(e=Aa/d.VectorPageObj.height,t=Na/d.VectorPageObj.width,this.dscalevector=Math.min(t,e),this.dxvector=(Na-d.VectorPageObj.width*this.dscalevector)/2,this.dyvector=(Aa-d.VectorPageObj.height*this.dscalevector)/2),this.usepdfjs){var a=d.offscreenheight,i=d.offscreenwidth;this.dxpdf>1&&this.pan_update((Na-i*this.dscalepdf)/2-this.dxpdf,0)}if(this.usevectorxml){if(null==d.VectorPageObj)return;null!=d.VectorPageObj&&(d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),d.draw_vector(!1))}else this.usepdfjs?(d.setpagedimsize(this.dxpdf,this.dypdf,i*this.dscalepdf,a*this.dscalepdf,!1),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&(Aa>a?this.zoomall():d.DocRef.draw_mpagepdf())):(this.checkimageswitch(),0==d.DocRef.Type?d.DocRef.draw_mpage():this.draw_image(!0));Y()}},this.pan_page=function(e,t,a){d.pan_update(e,t,a)},this.pan_page_pos=function(e,t,a){d.pan_position(e,t,a)},this.pan_position=function(e,t,a){var i=d.getpagedim(),r=i.x-e,s=i.y-t;d.pan_update(r,s,!0)},this.getpagetestrect=function(e){var t={x1:e.startx,y1:e.starty,x2:e.endx,y2:e.endy},a={x:t.x1,y:t.y1,w:t.x2-t.x1,h:t.y2-t.y1};if(0!=d.drotation)switch(t=nn(e.startx,e.starty,e.endx,e.endy),a.x=t.x1,a.y=t.y1,a.w=t.x2-t.x1,a.h=t.y2-t.y1,d.drotation){case 90:case 270:a.y=-(a.y+a.h-Aa),a.x=-(a.x+a.w-Na)}return a},this.getpagerectdirect=function(e){var t={x:this.startx,y:this.starty,w:this.endx,h:this.endy,usepixelscale:!1};if(e){var a=ll();t.x*=a,t.y*=a,t.w*=a,t.h*=a}return t},this.getpagerect=function(){var e={x1:d.startx,y1:d.starty,x2:d.endx,y2:d.endy},t={x:e.x1,y:e.y1,w:e.x2-e.x1,h:e.y2-e.y1};if(0!=d.drotation)switch(e=nn(d.startx,d.starty,d.endx,d.endy),t.x=e.x1,t.y=e.y1,t.w=e.x2-e.x1,t.h=e.y2-e.y1,d.drotation){case 90:case 270:t.y=-(t.y+t.h-Aa),t.x=-(t.x+t.w-Na)}return t},this.setPagePosBelow=function(e){d.setPagePos(d.startx,e.starty+e.offscreenheight*e.dscalepdf+10)},this.setPagePosAbove=function(e){d.setPagePos(d.startx,e.starty-d.offscreenheight*d.dscalepdf-10)},this.setpagerect=function(e,t,a,i){return d.startx=e,d.starty=t,d.endx=a+e,d.endy=i+t,{x:d.startx,y:d.starty,w:d.endx,h:d.endy}},this.setPagePos=function(e,t){const a=ll();switch(this.drotation){case 0:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 90:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e;break;case 180:this.dx=e,this.dy=t,this.dxvector=e,this.dyvector=t,this.dxpdf=e,this.dypdf=t;break;case 270:this.dx=t,this.dy=e,this.dxvector=t,this.dyvector=e,this.dxpdf=t,this.dypdf=e}if(this.usevectorxml)null!=d.VectorPageObj&&(i=d.setpagerect(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector),d.movetextdivs(),r=Math.max(0,i.x),s=Math.min(Na,i.w),n=Math.max(Aa,i.h),o=Math.min(0,i.y),r<s&&n>o?(d.visible=!0,d.DocRef.textselect&&(d.TextSelectArea.style.display=Wa),this.draw_vector(!1)):(d.visible=!1,d.DocRef.textselect&&(d.TextSelectArea.style.display="none")));else if(this.usepdfjs){var i=d.setpagerect(this.dxpdf,this.dypdf,d.offscreenheight*this.dscalepdf,d.offscreenwidth*this.dscalepdf);d.PDFTextArea.style.left=i.x/a+"px",d.PDFTextArea.style.top=i.y/a+"px";var r=Math.max(0,i.x),s=Math.min(Na,i.w),n=Math.max(Aa,i.h),o=Math.min(0,i.y);r<s&&n>o?(d.visible=!0,d.DocRef.textselect&&(d.PDFTextArea.style.display=Wa)):(d.visible=!1,d.DocRef.textselect&&(d.PDFTextArea.style.display="none"))}else this.checkimageswitch(),this.draw_image(!0);Y()},this.pan_update=function(e,t,a){if(this.usevector3Dxml)return;const i=ll();if(null!=ha&&null==a){var r=d.getpagerect();ha.panUpdate(e,t,r)}switch(this.dxpdf,this.drotation){case 0:this.dx=this.dx-e,this.dy=this.dy-t,this.dxvector-=e,this.dyvector-=t,this.dxpdf-=e,this.dypdf-=t;break;case 90:this.dx=this.dx-t,this.dy=this.dy+e,this.dxvector-=t,this.dyvector+=e,this.dxpdf-=t,this.dypdf+=e;break;case 180:this.dx=this.dx+e,this.dy=this.dy+t,this.dxvector+=e,this.dyvector+=t,this.dxpdf+=e,this.dypdf+=t;break;case 270:this.dx=this.dx+t,this.dy=this.dy-e,this.dxvector+=t,this.dyvector-=e,this.dxpdf+=t,this.dypdf-=e}if(this.usevectorxml)null!=d.VectorPageObj&&(d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),d.movetextdivs(),this.draw_vector(!1),o=Math.max(0,d.dxvector),l=Math.min(Na,d.endx),c=Math.max(Aa,d.endy),h=Math.min(0,d.dyvector),o<l&&c>h?(d.visible=!0,d.DocRef.textselect&&(d.TextSelectArea.style.display=Wa)):(d.visible=!1,d.DocRef.textselect&&(d.TextSelectArea.style.display="none")));else if(this.usepdfjs){var s=d.offscreenheight,n=d.offscreenwidth;d.setpagedimsize(this.dxpdf,this.dypdf,n*this.dscalepdf,s*this.dscalepdf,!1),d.PDFTextArea.style.left=d.startx/i+"px",d.PDFTextArea.style.top=d.starty/i+"px",d.DocRef.pagelocked&&!Di||n*this.dscalepdf<=Na&&0==this.drotation&&(d.dxpdf=(Na-n*this.dscalepdf)/2),d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&(d.DocRef.pan_update(e,t),d.DocRef.draw_mpagepdf());var o=Math.max(0,d.dxpdf),l=Math.min(Na,d.endx),c=Math.max(Aa,d.endy),h=Math.min(0,d.dypdf);o<l&&c>h?(d.visible=!0,d.DocRef.textselect&&(d.PDFTextArea.style.display=Wa)):(d.visible=!1,d.DocRef.textselect&&(d.PDFTextArea.style.display="none"))}else this.checkimageswitch(),0==d.DocRef.Type?d.DocRef.draw_mpage():this.draw_image(!0);Y(),null!=ua&&null==a&&(r=d.getpagerect(),ua.panUpdate(e,t,r))},this.rotateCanvas=function(){var e=0;r.save();var t=Na/2,a=Aa/2;switch(r.translate(t,a),r.rotate(this.drotation*(Math.PI/180)),r.translate(-t,-a),r.fillStyle="rgb(238,243,250)",r.fillRect(0,0,Na,Aa),this.currentimage){case 0:r.drawImage(this.largeimage,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale);break;case 1:e=this.dscale/d.bitmapratio,r.drawImage(this.smallimage,this.dx,this.dy,this.SmallImageWidth*e,this.SmallImageHeight*e)}r.restore(),Y()},this.forcerotate=function(e){const t=ll();var a=0;switch(this.drotation){case 0:if(90==e)for(a=0;a<=90;a+=10)this.drotation=a;if(180==e)for(a=0;a<=180;a+=10)this.drotation=a;if(270==e)for(a=0;a<=270;a+=10)this.drotation=a;break;case 90:if(0==e)for(a=90;a>=0;a-=10)this.drotation=a;if(180==e)for(a=90;a<=180;a+=10)this.drotation=a;if(270==e)for(a=90;a<=270;a+=10)this.drotation=a;break;case 180:if(0==e)for(a=180;a>=0;a-=10)this.drotation=a;if(270==e)for(a=180;a<=270;a+=10)this.drotation=a;if(90==e)for(a=180;a>=90;a-=10)this.drotation=a;break;case 270:if(0==e)for(a=270;a>=0;a-=10)this.drotation=a;if(180==e)for(a=270;a>=180;a-=10)this.drotation=a;if(90==e)for(a=270;a>=90;a-=10)this.drotation=a}if(!this.usevector3Dxml)if(this.usevectorxml)null!=d.VectorPageObj&&(d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),d.movetextdivs());else if(this.usepdfjs){var i=d.offscreenheight,r=d.offscreenwidth,s=Aa/2,n=Na/2;d.setpagedimsize(this.dxpdf,this.dypdf,r*this.dscalepdf,i*this.dscalepdf,!1),d.PDFTextArea.style.left=d.startx/t+"px",d.PDFTextArea.style.top=d.starty/t+"px";var o=n-d.startx,l=s-d.starty;d.PDFTextArea.style.transformOrigin=o+"px "+l+"px",d.PDFTextArea.style.transform="rotate("+this.drotation+"deg)",d.pagenumber,d.DocRef.pages[d.DocRef.currentpage].pagenumber}else d.DocRef.Type},this.rotateimage=function(e){var t=1==this.DocRef.pages.length;if(this.usepdfjs&&!this.DocRef.pagelocked&&this.usepdfjs&&!t)return void(this.pagelockrotation=e);const a=ll();var i=0;switch(this.drotation){case 0:if(90==e)for(i=0;i<=90;i+=10)d.drotation=i,this.rotateCanvas();if(180==e)for(i=0;i<=180;i+=10)d.drotation=i,this.rotateCanvas();if(270==e)for(i=0;i<=270;i+=10)d.drotation=i,this.rotateCanvas();break;case 90:if(0==e)for(i=90;i>=0;i-=10)d.drotation=i,this.rotateCanvas();if(180==e)for(i=90;i<=180;i+=10)d.drotation=i,this.rotateCanvas();if(270==e)for(i=90;i<=270;i+=10)d.drotation=i,this.rotateCanvas();break;case 180:if(0==e)for(i=180;i>=0;i-=10)d.drotation=i,this.rotateCanvas();if(270==e)for(i=180;i<=270;i+=10)d.drotation=i,this.rotateCanvas();if(90==e)for(i=180;i>=90;i-=10)d.drotation=i,this.rotateCanvas();break;case 270:if(0==e)for(i=270;i>=0;i-=10)d.drotation=i,this.rotateCanvas();if(180==e)for(i=270;i>=180;i-=10)d.drotation=i,this.rotateCanvas();if(90==e)for(i=270;i>=90;i-=10)d.drotation=i,this.rotateCanvas()}if(!this.usevector3Dxml){if(this.usevectorxml)null!=d.VectorPageObj&&(d.setpagedimsize(this.dxvector,this.dyvector,d.VectorPageObj.width*this.dscalevector,d.VectorPageObj.height*this.dscalevector,!1),d.movetextdivs(),this.draw_vector(!1));else if(this.usepdfjs){var r=d.offscreenheight,s=d.offscreenwidth,n=Aa/2,o=Na/2;d.setpagedimsize(this.dxpdf,this.dypdf,s*this.dscalepdf,r*this.dscalepdf,!1),d.PDFTextArea.style.left=d.startx/a+"px",d.PDFTextArea.style.top=d.starty/a+"px";var l=o-d.startx,c=n-d.starty;d.PDFTextArea.style.transformOrigin=l+"px "+c+"px",d.PDFTextArea.style.transform="rotate("+this.drotation+"deg)",d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.DocRef.draw_mpagepdf()}else 0==d.DocRef.Type?d.DocRef.draw_mpage():this.draw_image(!0);null!=ya&&ya.onRotate(e,d.pagenumber),d.DocRef.refreshBirdsEye(),d.DocRef.renderBirdsEye()}},this.get_layers_html=function(){return this.VectorPageObj.layerhtml},this.enableSnap=function(e){d.snapEnabled=e},this.getSnapState=function(){return d.snapEnabled},this.setpentableUnit=function(e){d.usevectorxml&&(d.VectorPageObj.setpentableUnit(e),d.draw_vector(!1),d.vectorischanged=!0)},this.setpentableScaled=function(e){d.usevectorxml&&(d.VectorPageObj.setpentableScaled(e),d.draw_vector(!1),d.vectorischanged=!0)},this.setPenTable=function(e){d.usevectorxml&&(d.VectorPageObj.setPenTable(e),d.draw_vector(!1),d.vectorischanged=!0)},this.getPenTableState=function(){var e=!1;return d.usevectorxml&&(e=d.VectorPageObj.getPenTableState()),e},this.setPenwidth=function(e){d.usevectorxml&&d.VectorPageObj.setPenwidth(e)},this.setPenTablepen=function(e){d.usevectorxml&&(d.VectorPageObj.setPenTablepen(e),d.draw_vector(!1),d.vectorischanged=!0)},this.resetPenTablepen=function(e){d.usevectorxml&&(d.VectorPageObj.resetPenTablepen(e),d.draw_vector(!1),d.vectorischanged=!0)},this.setpencolor=function(e,t){d.usevectorxml&&d.VectorPageObj.setpencolor(e,t)},this.resetpencolor=function(e){d.usevectorxml&&d.VectorPageObj.resetpencolor(e)},this.resetpenwidth=function(e){d.usevectorxml&&d.VectorPageObj.resetpenwidth(e)},this.setViewMode=function(e){d.usevectorxml&&(d.VectorPageObj.ViewMode(e),d.draw_vector(!1),d.vectorischanged=!0)},this.blockAttributes=function(e){if(d.usevectorxml)return d.VectorPageObj.blockAttributes(e)},this.markVectorBlock=function(e){d.usevectorxml&&d.VectorPageObj.markblockinsert(e,d.dscalevector,d.dxvector,d.dyvector)},this.selectBlock=function(e){d.usevectorxml&&(d.VectorPageObj.selectBlock(e),d.draw_vector(!1),d.vectorischanged=!0)},this.getpixeldist=function(e){return d.usevectorxml?e*d.VectorPageObj.scale*d.dscalevector:e},this.getpolygonPointsbyblockID=function(e){var t=[];return d.usevectorxml&&(t=d.VectorPageObj.getpathPointsBybId(e)),t},this.getpolygonPathbypathIndex=function(e){var t=null;return d.usevectorxml&&(t=d.VectorPageObj.getpathbyindex(e)),t},this.getpolygonPathbyblockID=function(e){var t=null;return d.usevectorxml&&(t=d.VectorPageObj.getpathbybId(e)),t},this.getpolygonPath=function(e,t){var a=null;return d.usevectorxml&&(a=d.VectorPageObj.getpath(e,t,d.dscalevector,d.dxvector,d.dyvector)),a},this.getpolygonPoints=function(e,t){var a=[];return d.usevectorxml&&(a=d.VectorPageObj.getpathPoints(e,t,d.dscalevector,d.dxvector,d.dyvector)),a},this.createAreaAttributes=function(e){d.usevectorxml&&d.VectorPageObj.createAreaAttributes(e)},this.setVectorBlockArea=function(e,t,a){d.usevectorxml&&d.VectorPageObj.setBlockArea(e,t,a)},this.getinsideHyperlink=function(e,t,a,i,r,s){var n=!1,o={x:e,y:t};if(null==d.VectorPageObj)return!1;0!=d.drotation&&(o=on(e,t)),e=o.x,t=o.y;for(var l=0;l<d.hyperlinks.length;l++)d.hyperlinks[l].insideHyperlink(e,t,a,i,r,d.VectorPageObj.x,d.VectorPageObj.y,d.VectorPageObj.h,d.pagenumber,s)&&(n=!0);return n},this.gethyperlink=function(e,t){var a=!1;return d.usevectorxml&&(a=d.getinsideHyperlink(e,t,d.dscalevector,d.dxvector,d.dyvector,!1)),a},this.gethyperlinkhover=function(e,t){var a=!1;return d.usevectorxml&&(a=d.getinsideHyperlink(e,t,d.dscalevector,d.dxvector,d.dyvector,!0)),a},this.getvectorentity=function(e,t){var a=!1;return d.usevectorxml&&(a=d.VectorPageObj.getvectorinformation(e,t,d.dscalevector,d.dxvector,d.dyvector,!1),d.draw_vector(!1),d.vectorischanged=!0),a},this.getvectorentityhover=function(e,t){var a=!1;return d.usevectorxml&&(a=d.VectorPageObj.getvectorinformation(e,t,d.dscalevector,d.dxvector,d.dyvector,!0),d.draw_vector(!1),d.vectorischanged=!0),a},this.getpolygonhover=function(e,t){var a=!1;return d.usevectorxml&&(a=d.VectorPageObj.getinsidePolygon(e,t,d.dscalevector,d.dxvector,d.dyvector,!1,!0),d.draw_vector(!1),d.vectorischanged=!0),a},this.getpolygon=function(e,t,a){var i=!1;return d.usevectorxml&&(i=d.VectorPageObj.getinsidePolygon(e,t,d.dscalevector,d.dxvector,d.dyvector,a,!1),d.draw_vector(!1),d.vectorischanged=!0),i},this.rendervectormouseover=function(){d.usevectorxml&&null!=d.VectorPageObj&&d.VectorPageObj.rendermouseonVectors(d.dscalevector,d.dxvector,d.dyvector,d.drotation)},this.renderSelectedBlocks=function(){d.usevectorxml&&null!=d.VectorPageObj&&d.VectorPageObj.renderSelectedBlocks(d.dscalevector,d.dxvector,d.dyvector,d.drotation)},this.getblockinserthover=function(e,t){var a=!1;return d.usevectorxml&&(a=d.VectorPageObj.getinsideblockinsert(e,t,d.dscalevector,d.dxvector,d.dyvector,d.drotation,!0),d.draw_vector(!1),d.vectorischanged=!0),a},this.getblockinsert=function(e,t){var a=!1;return d.usevectorxml&&(a=d.VectorPageObj.getinsideblockinsert(e,t,d.dscalevector,d.dxvector,d.dyvector,d.drotation,!1),d.draw_vector(!1),d.vectorischanged=!0),a},this.unSelectAllBlockInserts=function(){d.usevectorxml&&d.VectorPageObj.unSelectAllBlockInserts()},this.unSelectAllBlocks=function(e){d.usevectorxml&&(d.VectorPageObj.unSelectAllBlocks(e),d.draw_vector(!1),d.vectorischanged=!0)},this.getPDFsnapPoint=function(e,t){var a={found:!1,x:0,y:0,type:1},i=[],r={x:e,y:t};if(0!=d.drotation&&(r=on(e,t)),e=r.x,t=r.y,null==d.PDFPointArray)return a;d.PDFinternalScale.x>0?(d.pdfSnapScale,d.PDFinternalScale.x):d.pdfSnapScale,d.PDFinternalScale.y>0?(d.pdfSnapScale,d.PDFinternalScale.y):d.pdfSnapScale;for(var s=d.offscreenheight*d.dscalepdf,n=d.offscreenwidth*d.dscalepdf,o=0;o<d.PDFPointArray.length;o++){if(0!=d.PDFpageRotate)if(90==d.PDFpageRotate)var l=d.starty+-d.PDFPointArray[o].y*d.pdfSnapScale,c=d.startx+d.PDFPointArray[o].x*d.pdfSnapScale;else l=d.starty+(-d.PDFPointArray[o].y*d.pdfSnapScale+s),c=d.startx+d.PDFPointArray[o].x*d.pdfSnapScale+n;else l=d.PDFPointArray[o].y<0?d.starty+-d.PDFPointArray[o].y*d.pdfSnapScale:d.starty+(-d.PDFPointArray[o].y*d.pdfSnapScale+s),c=d.PDFPointArray[o].x<0?d.startx+d.PDFPointArray[o].x*d.pdfSnapScale+n:d.startx+d.PDFPointArray[o].x*d.pdfSnapScale;var h=e-c,u=t-l,p=Math.sqrt(h*h+u*u);p<10&&i.push({x:c,y:l})}if(i.length>0){h=e-i[0].x,u=t-i[0].y;var g=Math.sqrt(h*h+u*u);p=Math.sqrt(h*h+u*u);var m=0;for(o=0;o<i.length;o++)h=e-i[o].x,u=t-i[o].y,(p=Math.sqrt(h*h+u*u))<g&&(g=p,m=o);a={found:!0,x:i[m].x,y:i[m].y,type:1}}else a={found:!1,x:0,y:0,type:1};return a},this.getsnap=function(e){return d.usevectorxml&&d.snapEnabled?null!=d.VectorPageObj?d.VectorPageObj.getsnapPoint(e.x,e.y,d.dscalevector,d.dxvector,d.dyvector):{found:!1,x:0,y:0}:d.usepdfjs&&d.snapEnabled?d.getPDFsnapPoint(e.x,e.y):{found:!1,x:0,y:0}},this.draw_vectorPrint=function(){d.printobj.printctx.fillStyle="rgb(255,255,255)",d.printobj.printctx.fillRect(0,0,d.printobj.paperimage.width,d.printobj.paperimage.height),null!=this.VectorPageObj&&(this.VectorPageObj.drawallnew(d.printobj.printctx,d.printobj.pscale,d.printobj.pdx,d.printobj.pdy,!0,!0),Qo(d.printobj.printctx,d.pagenumber,d.printobj.pdx,d.printobj.pdy,d.printobj.pscale))},this.magnifyoff=function(){d.usevector3Dxml||(d.usevectorxml?d.draw_vector(!0):d.usepdfjs?d.DocRef.draw_mpagepdf():0==d.DocRef.Type?d.DocRef.draw_mpage():d.draw_image(!0))},this.drawmarkupcliprect=function(e,t){if(0==d.drotation)var a=e.x,i=e.y;else{var r=ln({x:e.x+.5*e.w,y:e.y+.5*e.h},Na/2,Aa/2,360-d.drotation);a=r.x-.5*e.w,i=r.y-.5*e.h}if(d.usevectorxml)var s=d.dscalevector,n=-a+d.dxvector,o=-i+d.dyvector;else if(d.usepdfjs)s=d.dscalepdf*d.curpagescale,n=-a+d.dxpdf,o=-i+d.dypdf;else{switch(d.currentimage){case 0:s=d.dscale,n=-a+d.dx,o=-i+d.dy;break;case 1:s=d.dscale/d.bitmapratio,n=-a+d.dx,o=-i+d.dy}s=d.dscale}Ko(t,d.pagenumber,n,o,s,d.drotation)},this.drawmagnify=function(e,t,a){if(!d.usevector3Dxml){if(0==d.drotation)var i=e.x-be.width/2/a,r=e.y-be.height/2/a;else{var s=ln(e,Na/2,Aa/2,360-d.drotation);i=s.x-be.width/2/a,r=s.y-be.height/2/a}t.fillStyle=d.DocRef.backgroundColor,t.fillRect(0,0,be.width,be.height);var n=be.width/2,o=be.height/2;if(d.usevectorxml){var l=d.dscalevector*a,c=-i+d.dxvector,h=-r+d.dyvector;c*=a,h*=a,0==d.drotation||(t.save(),t.translate(n,o),t.rotate(d.drotation*(Math.PI/180)),t.translate(-n,-o)),d.VectorPageObj.drawallmagnify(t,l,c,h)}else if(d.usepdfjs)l=d.dscalepdf*d.curpagescale*a,d.magnifycanvas.width,d.magnifyrestscale,d.magnifycanvas.height,d.magnifyrestscale,c=-i+d.dxpdf,h=-r+d.dypdf,c*=a,h*=a,0==d.drotation||(t.save(),t.translate(n,o),t.rotate(d.drotation*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(d.magnifycanvas,c,h);else{switch(d.currentimage){case 0:l=d.dscale*a,c=-i+d.dx,h=-r+d.dy,c*=a,h*=a,0==d.drotation||(t.save(),t.translate(n,o),t.rotate(d.drotation*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(d.largeimagecnv,c,h,d.MainImageWidth*l,d.MainImageHeight*l);break;case 1:l=d.dscale/d.bitmapratio*a,c=-i+d.dx,h=-r+d.dy,c*=a,h*=a,0==d.drotation||(t.save(),t.translate(n,o),t.rotate(d.drotation*(Math.PI/180)),t.translate(-n,-o)),t.drawImage(d.smallimagecnv,c,h,d.SmallImageWidth*l,d.SmallImageHeight*l)}l=d.dscale*a}0==d.drotation?Ko(t,d.pagenumber,c,h,l,d.drotation):(Ko(t,d.pagenumber,c,h,l,d.drotation),t.restore())}},this.refresh_vectorPath=function(e){d.backupScaleAndOffset(),r.fillRect(0,0,Na,Aa);var t=Na/2,a=Aa/2;null!=this.VectorPageObj&&(0==this.drotation?this.VectorPageObj.refreshPath(e,r,this.dscalevector,this.dxvector,this.dyvector):(r.save(),r.translate(t,a),r.rotate(this.drotation*(Math.PI/180)),r.translate(-t,-a),this.VectorPageObj.refreshPath(e,r,this.dscalevector,this.dxvector,this.dyvector),r.restore()))},this.draw_vector_selected=function(){d.backupScaleAndOffset(),r.fillRect(0,0,Na,Aa);var e=Na/2,t=Aa/2;null!=this.VectorPageObj&&(0==this.drotation?this.VectorPageObj.drawSelected(r,this.dscalevector,this.dxvector,this.dyvector):(r.save(),r.translate(e,t),r.rotate(this.drotation*(Math.PI/180)),r.translate(-e,-t),this.VectorPageObj.drawSelected(r,this.dscalevector,this.dxvector,this.dyvector),r.restore()))},this.invert_images=function(e){this.VectorPageObj.invert_images(e)},this.draw_vector=function(e){if(d.backupScaleAndOffset(),!d.DocRef.bSopenSilent&&d.DocRef.bActive){r.fillStyle=ir,r.fillRect(0,0,Na,Aa);var t=Na/2,a=Aa/2;Ka=!0,null!=this.VectorPageObj&&(ki||(0==this.drotation?this.VectorPageObj.drawallnew(r,this.dscalevector,this.dxvector,this.dyvector,e,!1):(r.save(),r.translate(t,a),r.rotate(this.drotation*(Math.PI/180)),r.translate(-t,-a),this.VectorPageObj.drawallnew(r,this.dscalevector,this.dxvector,this.dyvector,e,!1),r.restore())))}},this.draw_canvas_compare=function(e,t,a,i){if(d.pdfdiminitset){var r=d.pagecanvas.width,s=d.pagecanvas.height,n=t,o=a;e.drawImage(d.pagecanvas,n,o,r*d.dscalepdf,s*d.dscalepdf)}},this.pagelockrotatecheck=function(){1==this.DocRef.pages.length||d.DocRef.pagelocked||0!=d.drotation&&d.forcerotate(0)},this.draw_canvas=function(e){if(d.backupScaleAndOffset(),!d.DocRef.bSopenSilent&&d.DocRef.bActive){e&&(r.fillStyle=ir,r.fillRect(0,0,Na,Aa));var t=Na/2,a=Aa/2;Ka=!0,d.pagelockrotatecheck();var i=1==this.DocRef.pages.length;if(this.DocRef.pagelocked||i)var s=this.drotation;else s=0;if(!ki&&d.pdfdiminitset){if(0==s)if(d.pdfisfirstrendered)r.fillStyle="rgb(255,255,255)",r.fillRect(this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf),r.drawImage(this.pagecanvas,this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf);else if(!d.pdfisfirstrendered&&Si){if(r.fillStyle="rgb(255,255,255)",d.pdfisfirstrendered)n=this.dscalepdf;else var n=1;r.fillRect(this.dxpdf,this.dypdf,d.offscreenwidth*n,d.offscreenheight*n),r.drawImage(d.pagedrawCanvas,this.dxpdf,this.dypdf,d.offscreenwidth*n,d.offscreenheight*n)}else r.fillStyle="rgb(255,255,255)",r.fillRect(this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf);else r.save(),r.translate(t,a),r.rotate(s*(Math.PI/180)),r.translate(-t,-a),d.pdfisrendered&&!d.iscollapsed?r.drawImage(this.pagecanvas,this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf):(r.fillStyle="rgb(255,255,255)",r.fillRect(this.dxpdf,this.dypdf,d.offscreenwidth*this.dscalepdf,d.offscreenheight*this.dscalepdf)),r.restore();d.pagenumber==d.DocRef.pages[d.DocRef.currentpage].pagenumber&&d.rendercallback&&null!=it&&it.RenderComplete(d.pagenumber)}}},this.transparent=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]&&(e[t+3]=100)},this.setcolor=function(e,t){for(var a=gn(t),i=0;i<e.length;i+=4)255==e[i]&&255==e[i+1]&&255==e[i+2]?e[i+3]=100:(e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b)},this.setred=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]?e[t+3]=100:(e[t]=255,e[t+1]=128,e[t+2]=0)},this.setblue=function(e){for(var t=0;t<e.length;t+=4)255==e[t]&&255==e[t+1]&&255==e[t+2]||(e[t]=0,e[t+1]=0,e[t+2]=255)},this.setinvert=function(e){for(var t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]},this.invertpdfmagnify=function(e){try{var t=d.magnifypagectx.getImageData(0,0,d.magnifycanvas.width,d.magnifycanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.magnifycanvas.width,d.magnifycanvas.height),e=-1}var a=d.compositereference.getColors();switch(e){case 0:d.setinvert(t.data);break;case 1:d.setcolor(t.data,a.bg);break;case 2:d.setcolor(t.data,a.fg)}-1!=e&&d.magnifypagectx.putImageData(t,0,0)},this.invertpdfprint=function(e){switch(e){case 1:try{var t=d.compositePrintreference.bgpagectx.getImageData(0,0,d.compositePrintreference.bgpagecanvas.width,d.compositePrintreference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositePrintreference.bgpagecanvas.width,d.compositePrintreference.bgpagecanvas.height),e=-1}break;case 2:try{t=d.compositePrintreference.ovpagectx.getImageData(0,0,d.compositePrintreference.ovpagecanvas.width,d.compositePrintreference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositePrintreference.ovpagecanvas.width,d.compositePrintreference.ovpagecanvas.height),e=-1}}var a=d.compositereference.getColors();switch(e){case 0:d.setinvert(t.data);break;case 1:d.setcolor(t.data,a.bg);break;case 2:d.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:d.compositePrintreference.bgpagectx.putImageData(t,0,0);break;case 2:d.compositePrintreference.ovpagectx.putImageData(t,0,0)}},this.transparentpdf=function(e){switch(e){case 1:try{var t=d.compositereference.bgpagectx.getImageData(0,0,d.compositereference.bgpagecanvas.width,d.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositereference.bgpagecanvas.width,d.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=d.compositereference.ovpagectx.getImageData(0,0,d.compositereference.ovpagecanvas.width,d.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositereference.ovpagecanvas.width,d.compositereference.ovpagecanvas.height),e=-1}}switch(e){case 0:d.setinvert(t.data);break;case 1:case 2:d.transparent(t.data)}if(-1!=e)switch(e){case 1:d.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:d.compositereference.ovpagectx.putImageData(t,0,0)}},this.invertpdf=function(e){switch(e){case 1:try{var t=d.compositereference.bgpagectx.getImageData(0,0,d.compositereference.bgpagecanvas.width,d.compositereference.bgpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositereference.bgpagecanvas.width,d.compositereference.bgpagecanvas.height),e=-1}break;case 2:try{t=d.compositereference.ovpagectx.getImageData(0,0,d.compositereference.ovpagecanvas.width,d.compositereference.ovpagecanvas.height)}catch(t){alert("Error 1 - "+t),console.log(t,d.compositereference.ovpagecanvas.width,d.compositereference.ovpagecanvas.height),e=-1}}var a=d.compositereference.getColors();switch(e){case 0:d.setinvert(t.data);break;case 1:d.setcolor(t.data,a.bg);break;case 2:d.setcolor(t.data,a.fg)}if(-1!=e)switch(e){case 1:d.compositereference.bgpagectx.putImageData(t,0,0);break;case 2:d.compositereference.ovpagectx.putImageData(t,0,0)}},this.transparentimage=function(e){var t=d.largeimagectx.getImageData(0,0,d.largeimagecnv.width,d.largeimagecnv.height),a=d.smallimagectx.getImageData(0,0,d.smallimagecnv.width,d.smallimagecnv.height),i=a.data;switch(e){case 0:d.setinvert(i);break;case 1:case 2:d.transparent(i)}switch(d.smallimagectx.putImageData(a,0,0),i=t.data,e){case 0:d.setinvert(i);break;case 1:case 2:d.transparent(i)}d.largeimagectx.putImageData(t,0,0),d.largeimagectx.putImageData(t,0,0),this.draw_image(!0)},this.invert=function(e){var t=d.largeimagectx.getImageData(0,0,d.largeimagecnv.width,d.largeimagecnv.height),a=d.smallimagectx.getImageData(0,0,d.smallimagecnv.width,d.smallimagecnv.height),i=a.data,r=d.compositereference.getColors();switch(e){case 0:d.setinvert(i);break;case 1:d.setcolor(i,r.bg);break;case 2:d.setcolor(i,r.fg)}switch(d.smallimagectx.putImageData(a,0,0),i=t.data,e){case 0:d.setinvert(i);break;case 1:d.setcolor(i,r.bg);break;case 2:d.setcolor(i,r.fg)}d.largeimagectx.putImageData(t,0,0),this.draw_image(!0)},this.resetimage=function(){var e=d.MainImageWidth,t=d.MainImageHeight;d.largeimagecnv.width=e,d.largeimagecnv.height=t,d.largeimagectx.drawImage(d.largeimage,0,0,e,t),this.smallimagecreatefromlarge()},this.draw_imagePrint=function(){d.printobj.printctx.drawImage(this.largeimage,d.printobj.pdx,d.printobj.pdy,d.printobj.docwidth*d.printobj.pscale,d.printobj.docheight*d.printobj.pscale),Qo(d.printobj.printctx,d.pagenumber,d.printobj.pdx,d.printobj.pdy,d.printobj.pscale)},this.draw_image=function(e){if(d.backupScaleAndOffset(),!d.DocRef.bSopenSilent){e&&(r.fillStyle=ir,r.fillRect(0,0,Na,Aa));var t=Na/2,a=Aa/2;if(Ka=!0,!ki){switch(r.imageSmoothingQuality="high",r.imageSmoothingEnabled=!0,this.currentimage){case 0:0==this.drotation?r.drawImage(this.largeimagecnv,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale):(r.save(),r.translate(t,a),r.rotate(this.drotation*(Math.PI/180)),r.translate(-t,-a),r.drawImage(this.largeimagecnv,this.dx,this.dy,this.MainImageWidth*this.dscale,this.MainImageHeight*this.dscale),r.restore());break;case 1:var i=d.dscale/d.bitmapratio;0==this.drotation?r.drawImage(this.smallimagecnv,this.dx,this.dy,this.SmallImageWidth*i,this.SmallImageHeight*i):(r.save(),r.translate(t,a),r.rotate(this.drotation*(Math.PI/180)),r.translate(-t,-a),r.drawImage(this.smallimagecnv,this.dx,this.dy,this.SmallImageWidth*i,this.SmallImageHeight*i),r.restore())}r.imageSmoothingEnabled=!1}}}}}class Xl{constructor(t){var i=this,s=U,o=0,l=!1,c=0,h=!1;Q&&(s=ae),this.bRenderinProgress=!1,this.bcompare=!1,this.usepagesload=!1,this.bdelayedClose=!1,this.fileindex=0,this.relativepath=void 0,this.bActive=!0,this.bSopenSilent=!1,this.textselect=!1,this.id=Math.ceil(1e4*Math.random()),this.hastext=!1,this.markuploaded=!1,this.pagelocked=!1,this.lockedpage=i.currentpage,this.directPDF=!1,this.currentpage=0,this.restorecurpage=0,this.backgroundColor=Yi,this.monoChrome=!1,this.bMarkupchanged=!1,this.curcontrol3D="orbitControl",this.bMarkupLocked=!1,this.bDoPrint=!1,this.bLargePDF=!1,this.largePDFPagerange=4,this.endpagerange=4,this.startpagerange=0,this.pagerangelimit=1,this.pdfLoadingTask=null,this.PDFWrapper=null,this.bdestroyPDFonClose=!1,this.PDFpagescale={width:1,height:1,scale:1},this.PDFDocumentPageScale=1.5,this.PDFInitscaleSet=!1,this.PDFPassword=null,this.pdflayerlist=[],this.DocumentTextArray=[],this.DocumentTextArrayRect=[],this.markup3DSavepath=null,this.views3DSavepath=null,this.tempPage=void 0,this.markupsave=void 0,this.markupselectedChangeSaved=!1,this.xrefs=[],this.fonts=[],this.markupfileURLs=[],this.scalesOptions=[],this.markupsearchobj={matcharray:[],active:!1,forward:!0,casesens:!1,expr:"",indx:0,page:0,next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].pagenumber)},previous:function(){0!=this.matcharray.length&&(this.indx--,this.indx<0&&(this.indx=this.matcharray.length-1),this.page=this.matcharray[this.indx].pagenumber)},start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].pagenumber)}},this.searchobj={matcharray:[],active:!1,forward:!0,casesens:!1,expr:"",indx:0,page:0,showsearchpage:void 0,next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].page)},previous:function(){0!=this.matcharray.length&&(this.indx--,this.indx<0&&(this.indx=this.matcharray.length-1),this.page=this.matcharray[this.indx].page)},start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].page)}},this.extractsearchobj={matcharray:[],foundrects:[],active:!1,casesens:!1,expr:"",indx:0,page:0,start:function(){0!=this.matcharray.length&&(this.page=this.matcharray[this.indx].page)},next:function(){0!=this.matcharray.length&&(this.indx++,this.indx>this.matcharray.length-1&&(this.indx=0),this.page=this.matcharray[this.indx].page)}},this.Version=t.getElementsByTagName("Version")[0].firstChild.nodeValue,this.NumPages=t.getElementsByTagName("NumPages")[0].firstChild.nodeValue,this.NumLayouts=t.getElementsByTagName("NumLayouts")[0].firstChild.nodeValue,this.FileName=t.getElementsByTagName("FileName")[0].firstChild.nodeValue,this.FileName=decodeURIComponent(this.FileName),this.CacheFileName=this.FileName;var d=go(this.FileName);if(this.CachePath=po(this.FileName),Q&&(this.FileName=d),this.OriginalURL=t.getElementsByTagName("OriginalURL")[0].firstChild.nodeValue,this.OriginalURL=decodeURIComponent(this.OriginalURL),this.Format=t.getElementsByTagName("Format")[0].firstChild.nodeValue,this.Filter=t.getElementsByTagName("Filter")[0].firstChild.nodeValue,this.FileSizeLow=t.getElementsByTagName("FileSizeLow")[0].firstChild.nodeValue,this.FileSizeHigh=t.getElementsByTagName("FileSizeHigh")[0].firstChild.nodeValue,null!=t.getElementsByTagName("PublisherVersion")[0]&&(this.PublisherVersion=t.getElementsByTagName("PublisherVersion")[0].firstChild.nodeValue),this.Type=t.getElementsByTagName("Type")[0].firstChild.nodeValue,null!=t.getElementsByTagName("XREFS"))for(var p=t.getElementsByTagName("XREF"),g=0;g<p.length;g++)if(null!=p[g].getElementsByTagName("FileName")[0].firstChild){var m={path:p[g].getElementsByTagName("FileName")[0].firstChild.nodeValue,found:"true"==p[g].getElementsByTagName("Found")[0].firstChild.nodeValue};this.xrefs.push(m)}if(null!=t.getElementsByTagName("Fonts")){var f=t.getElementsByTagName("Font");for(g=0;g<f.length;g++){var y={path:f[g].getElementsByTagName("FileName")[0].firstChild.nodeValue,found:"true"==f[g].getElementsByTagName("Found")[0].firstChild.nodeValue};this.fonts.push(y)}}if(null!=t.getElementsByTagName("Summary")){var v=t.getElementsByTagName("Property");for(g=0;g<v.length;g++){if(null!=v[g].getElementsByTagName("Name")&&null!=v[g].getElementsByTagName("Name")[0].firstChild)var b=v[g].getElementsByTagName("Name")[0].firstChild.nodeValue;else b="";if(null!=v[g].getElementsByTagName("Value")&&null!=v[g].getElementsByTagName("Value")[0].firstChild)var x=v[g].getElementsByTagName("Value")[0].firstChild.nodeValue;else x="";"ACAD_MEASUREMENT"==b&&(this.CadMeasurement=parseInt(x))}}function w(e){var t=null==i.pages[e];if(t)var a=!1,r=!1,s=!1,n=!1;else s=i.pages[e].pageRendering,a=i.pages[e].pageloaded,r=i.pages[e].pdfdiminitset,n=i.pages[e].pdfisrendered;return{havepage:!t,loaded:a,pdfdimset:r,rendering:s,rendercomplete:n}}function k(e,t,a,i){r.fillStyle="rgb(255,255,255)",r.fillRect(e,t,a,i)}null!=t.getElementsByTagName("FileNameSRC")[0]&&(this.FileNameSRC=encodeURI(s+t.getElementsByTagName("FileNameSRC")[0].firstChild.nodeValue),this.CacheURL=uo(this.FileNameSRC)),this.thumbnailobects=[],this.thumbnails=[],this.hoverspace=null,this.Drawmarkup=!0,this.thumbnailhtmlsource="",this.layerhtmlsource="",this.layouts=[],this.pages=[],this.markuplist=[],this.markupdraworder=[],this.selectedmarkup={id:-1,selected:!1,edit:!1},this.rangeupdated={start:0,end:0,operation:"none"},this.markupdraworder=[],this.markupdraworderChange=!1,this.markupundolist=[],this.markupredolist=[],this.tempundolist=[],this.documentproperties=[],this.nummarkups=0,this.pdfDoc=null,this.contentgroupconfig=null,this.contentgroups=null,this.pdfURL="",this.pageNum=1,this.pageRendering=!1,this.pageNumPending=null,this.scale=.8,this.pdftimervar=null,this._pagesRefCache=Object.create(null),this.pdfoutline=void 0,this.scalecomparepage=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.scalecomparepage(e)},this.scalecompare=function(){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.scalecompare()},this.setColors=function(e,t){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.setColors(e,t)},this.getColors=function(){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.getColors()},this.nudgeRotate=function(e){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.nudgeRotate(e)},this.nudgeScale=function(e){if(i.bcompare&&i.pages[i.currentpage].VectorPageObj)return i.pages[i.currentpage].VectorPageObj.nudgeScale(e)},this.offsetdirect=function(e,t){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.offsetdirect(e,t)},this.nudgeoffset=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.nudgeoffset(e)},this.setcomparescale=function(e){i.bcompare&&i.pages[i.currentpage].VectorPageObj&&i.pages[i.currentpage].VectorPageObj.setcomparescale(e)},this.checkRender=function(){null!=_e&&_e.renderComplete(i.fileindex)},this.setMarkup3DSavefile=function(e){i.markup3DSavepath=e},this.getMarkup3DSavefile=function(){return i.markup3DSavepath},this.setViews3DSavefile=function(e){i.views3DSavepath=e},this.getViews3DSavefile=function(){return i.views3DSavepath},this.updateURL=function(e){null!=e.getElementsByTagName("OriginalURL")[0]&&(i.OriginalURL=e.getElementsByTagName("OriginalURL")[0].firstChild.nodeValue,i.OriginalURL=decodeURIComponent(i.OriginalURL)),null!=e.getElementsByTagName("FileNameSRC")[0]&&(i.FileNameSRC=encodeURI(s+e.getElementsByTagName("FileNameSRC")[0].firstChild.nodeValue),i.CacheURL=uo(i.FileNameSRC))},this.setPassword=function(e){i.PDFPassword=e},this.setfileindex=function(e){i.fileindex=e},this.setnummarkupfiles=function(e){o=e,l=!0},this.getnummarkupfiles=function(){return o},this.getmarkupfilesread=function(){return l},this.setmarkupfilesreceived=function(){c++},this.getmarkupfilesreceived=function(){return c},this.getmarkuplist=function(){return i.markuplist.filter((function(e){return!(8==e.type&&2==e.subtype)}))},this.endMarkupTextSearch=function(){i.markupsearchobj.matcharray=[],i.markupsearchobj.expr="",i.markupsearchobj.forward=!0,i.markupsearchobj.casesens=!1,i.markupsearchobj.active=!1,i.markupsearchobj.indx=0,i.markupsearchobj.page=0,null!=ka&&ka.numTextFound(i.markupsearchobj.matcharray.length)},this.textrectsearchend=function(){i.extractsearchobj.matcharray=[],i.extractsearchobj.expr="",i.extractsearchobj.forward=!0,i.extractsearchobj.casesens=!1,i.extractsearchobj.active=!1,i.extractsearchobj.indx=0,i.extractsearchobj.page=0,i.pages[i.currentpage].usepdfjs&&i.enableTextSelect(!1),i.pages[i.currentpage].usevectorxml&&i.enableTextSelect(!1),null!=Da&&Da.numTextFound(i.extractsearchobj,i.currentpage)},this.textsearchend=function(){i.searchobj.active&&i.pages[i.currentpage].clearSearch(),i.searchobj.matcharray=[],i.searchobj.expr="",i.searchobj.forward=!0,i.searchobj.casesens=!1,i.searchobj.active=!1,i.searchobj.indx=0,i.searchobj.page=0,i.pages[i.currentpage].usepdfjs&&i.enableTextSelect(!1),i.pages[i.currentpage].usevectorxml&&i.enableTextSelect(!1),null!=wa&&wa.numTextFound(i.searchobj.matcharray.length)},this.CreateSearchArrayRect=function(e,t){var a=i.extractsearchobj.casesens,r=i.extractsearchobj.expr;if(""!=r)for(var s=0;s<e.texts.length;s++){if(a)n=r,o=e.texts[s];else var n=r.toLowerCase(),o=e.texts[s].toLowerCase();var l=!1,c=o.search(n);if(-1==c?l=!1:c>=0&&(l=!0),l){var h={page:t,indx:s,searchtext:e.texts[s],pos:c,length:r.length,rect:{},transform:e.transforms[s]};i.extractsearchobj.matcharray.push(h)}}},this.drawselectedBlocks=function(){null!=i.pages[i.currentpage]&&(i.pages[i.currentpage].renderSelectedBlocks(),i.pages[i.currentpage].rendervectormouseover())},this.unselectallBlocks=function(){null!=i.pages[i.currentpage]&&i.pages[i.currentpage].unSelectAllBlockInserts()},this.CreateSearchArray=function(e,t){const a=i.searchobj.casesens,r=i.searchobj.expr;if(""===r)return;const s=new Set;let n=0;for(let o=0;o<e.length;o++){let l=a?e[o]:e[o].toLowerCase(),c=a?r:r.toLowerCase();const h=l.search(c);if(h>=0){const a=`${t}-${h}-${l}`;if(s.has(a)&&n<2)continue;const c={page:t,indx:o,searchtext:e[o],pos:h,length:r.length};i.searchobj.matcharray.push(c),s.add(a),n++}}},this.CreateSearchArrayold=function(e,t){var a=i.searchobj.casesens,r=i.searchobj.expr;if(""!=r)for(var s=0;s<e.length;s++){if(a)n=r,o=e[s];else var n=r.toLowerCase(),o=e[s].toLowerCase();var l=!1,c=o.search(n);if(-1==c?l=!1:c>=0&&(l=!0),l){var h={page:t,indx:s,searchtext:e[s],pos:c,length:r.length};i.searchobj.matcharray.push(h)}}},this.textExtractCompleteRect=function(){for(var e=0;e<i.pages.length;){for(var t=0;t<i.DocumentTextArrayRect.length;t++)i.DocumentTextArrayRect[t].page==e&&i.CreateSearchArrayRect(i.DocumentTextArrayRect[t],e);e++}i.searchCompleteRect()},this.textExtractComplete=function(){for(var e=0;e<i.pages.length;){for(var t=0;t<i.DocumentTextArray.length;t++)i.DocumentTextArray[t].page==e&&i.CreateSearchArray(i.DocumentTextArray[t].texts,e);e++}i.searchComplete()},this.markupSearchComplete=function(){null!=ka&&ka.numTextFound(i.markupsearchobj.matcharray.length),i.markupsearchobj.matcharray.length>0&&(i.markupsearchobj.active=!0,i.markupsearchobj.start(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx]))},this.testmarktextdiv=function(e){i.pages[i.currentpage].testmarktextdiv(e)},this.searchComplete=async function(){if(null!=wa&&wa.numTextFound(i.searchobj.matcharray.length),i.searchobj.matcharray.length>0){i.searchobj.active=!0,i.searchobj.start();let e=i.searchobj.matcharray[i.searchobj.indx];i.searchobj.page!=i.currentpage?(await i.GotoPageAsync(i.searchobj.page),i.pages[i.searchobj.page].showSearch(e)):i.pages[i.currentpage].showSearch(e)}},this.searchCompleteRect=function(){if(i.extractsearchobj.matcharray.length>0){for(i.extractsearchobj.active=!0,i.extractsearchobj.start(),i.pages[i.currentpage].getSearchTextRect(),i.extractsearchobj.next();0!=i.extractsearchobj.indx;)i.pages[i.currentpage].getSearchTextRect(),i.extractsearchobj.next();null!=Da&&Da.numTextFound(i.extractsearchobj,i.currentpage)}},this.searchTextPagesRect=function(e){null!=i.pdfDoc&&i.pdfDoc.getPage(e+1).then((function(e){e.getTextContent().then((function(t){var a=[],r=[],s=e._pageIndex;if(gi){var n=zl(t);t.items=n}for(var o=0;o<t.items.length;o++)" "!=t.items[o].str&&""!=t.items[o].str&&(a.push(t.items[o].str),r.push(t.items[o].transform));i.DocumentTextArrayRect.push({page:s,texts:a,transforms:r}),i.pages.length==i.DocumentTextArrayRect.length&&i.textExtractCompleteRect()}))}))},this.searchTextPages=function(e){null!=i.pdfDoc&&i.pdfDoc.getPage(e+1).then((function(e){e.getTextContent().then((function(t){var a=[];if(gi){var r=zl(t);t.items=r}var s=e._pageIndex;if(null!=t.items)for(var n=0;n<t.items.length;n++)" "!=t.items[n].str&&""!=t.items[n].str&&a.push(t.items[n].str);i.DocumentTextArray.push({page:s,texts:a}),i.pages.length==i.DocumentTextArray.length&&i.textExtractComplete()}))}))},this.getTextRects=function(e,t){if(i.extractsearchobj.active,i.extractsearchobj.matcharray=[],i.extractsearchobj.foundrects=[],i.extractsearchobj.expr=e,i.extractsearchobj.casesens=t,i.extractsearchobj.active=!1,i.extractsearchobj.indx=0,i.extractsearchobj.page=0,i.pages[i.currentpage].usepdfjs){i.textselect||i.enableTextSelect(!0),i.DocumentTextArrayRect=[];for(var a=0;a<i.pages.length;a++)i.pages.length,i.searchTextPagesRect(a)}if(i.pages[i.currentpage].usevectorxml){i.textselect||i.enableTextSelect(!0);for(var r=0;r<i.pages.length;r++)null!=i.pages[r]&&i.pages[r].getVectorSearchListRect(i.extractsearchobj);i.searchCompleteRect()}},this.textsearch=async function(e,t,a){if(e==i.searchobj.expr&&i.searchobj.active){if(t){i.pages[i.currentpage].clearSearch(),i.searchobj.next();let e=i.searchobj.matcharray[i.searchobj.indx];i.searchobj.page!=i.currentpage?(await i.GotoPageAsync(i.searchobj.page),e=i.searchobj.matcharray[i.searchobj.indx],i.pages[i.searchobj.page].showSearch(e)):(e=i.searchobj.matcharray[i.searchobj.indx],i.pages[i.currentpage].showSearch(e))}if(!t){i.pages[i.currentpage].clearSearch(),i.searchobj.previous();let e=i.searchobj.matcharray[i.searchobj.indx];i.searchobj.page!=i.currentpage?(await i.GotoPageAsync(i.searchobj.page),e=i.searchobj.matcharray[i.searchobj.indx],i.pages[i.searchobj.page].showSearch(e)):(e=i.searchobj.matcharray[i.searchobj.indx],i.pages[i.currentpage].showSearch(e))}}else{if(i.searchobj.active&&i.pages[i.currentpage].clearSearch(),i.searchobj.matcharray=[],i.searchobj.expr=e,i.searchobj.forward=t,i.searchobj.casesens=a,i.searchobj.active=!1,i.searchobj.indx=0,i.searchobj.page=0,i.pages[i.currentpage].usepdfjs){i.textselect||i.enableTextSelect(!0),i.DocumentTextArray=[];for(var r=0;r<i.pages.length;r++)this.searchTextPages(r)}if(i.pages[i.currentpage].usevectorxml){i.textselect||i.enableTextSelect(!0);for(var s=0;s<i.pages.length;s++)null!=i.pages[s]&&i.pages[s].getVectorSearchList();i.searchComplete()}}},this.ZoomToMarkup=function(e){el(e)||i.GotoPage(e.pagenumber),i.pages[i.currentpage].zoomToMarkup(e)},this.panToMarkup=function(e){el(e)||i.GotoPage(e.pagenumber),i.pages[i.currentpage].panToMarkup(e)},this.markupTextSearch=function(e,t,a){if(e==i.markupsearchobj.expr&&i.markupsearchobj.active)t&&(i.markupsearchobj.next(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx])),t||(i.markupsearchobj.previous(),i.markupsearchobj.page!=i.currentpage&&i.GotoPage(i.markupsearchobj.page),i.pages[i.currentpage].zoomToMarkup(i.markupsearchobj.matcharray[i.markupsearchobj.indx]));else if(i.markupsearchobj.matcharray=[],i.markupsearchobj.expr=e,i.markupsearchobj.forward=t,i.markupsearchobj.casesens=a,i.markupsearchobj.active=!1,i.markupsearchobj.indx=0,i.markupsearchobj.page=0,""!=i.markupsearchobj.expr){for(var r=0;r<i.markuplist.length;r++)i.markuplist[r].FindText(i.markupsearchobj.expr,i.markupsearchobj.casesens)&&i.markupsearchobj.matcharray.push(i.markuplist[r]);i.markupSearchComplete()}},this.getcurpageScale=function(e){return i.currentpage,(i.usepagesload?i.pages[i.pages[e].pagenumber]:i.pages[e]).curpagescale},this.getcur3DView=function(){var e=null;return null!=i.pages[i.currentpage]&&(e=i.pages[i.currentpage].getcur3DView()),e},this.getcurPage=function(){return i.currentpage,i.usepagesload?i.pages[i.currentpage].pagenumber:i.currentpage},this.getAllPageDim=function(){for(var e=[],t=0;t<i.pages.length;t++)null!=i.pages[t]&&e.push(i.pages[t].getpagedim());return e},this.getPageDim=function(e){var t=i.getPageObject(e);if(null!=t)var a=t.getpagedim();else a=void 0;return a},this.setPageDim=function(e,t,a,r,s){var n=i.getPageObject(e);null!=n&&n.setpagedim(t,a,r,s)},this.getFirstLoadedPage=function(){return i.pages[0]},this.getPageObjectLoad=function(e){var t=void 0;if(i.usepagesload)for(var a=0;a<i.pages.length;a++)null!=i.pages[a]&&i.pages[a].pagenumber==e&&(t=i.pages[a]);else t=i.pages[e];return null==t&&null!=i.tempPage&&(i.tempPage.movepage(e),t=i.tempPage),t},this.getPageObject=function(e){var t=void 0;if(i.usepagesload)for(var a=0;a<i.pages.length;a++)null!=i.pages[a]&&i.pages[a].pagenumber==e&&(t=i.pages[a]);else t=i.pages[e];return t},this.addProperties=function(e){if("Adobe PDF"==i.Format.substring(0,9))for(var t in e.info)"function"!=typeof e.info[t]&&i.documentproperties.push({name:t,value:e.info[t]})},this.inpagerange=function(e){var t=i.pagerange();return e>t.start&&e<t.end},this.loadPagetextEvt=function(e){null!=i.pages[i.currentpage]&&e===i.pages[i.currentpage].pagenumber&&console.log("page loaded",e)},this.loadPageEvt=function(e){null!=i.pages[i.currentpage]&&i.pages[i.currentpage].pagenumber},this.pgChangeLoop=function(){for(var e={pagenum:0,pagerange:i.pagerange(),bpageshort:!1},t=i.isNotCollapsed||[],a=e.pagerange.start;a<=e.pagerange.end;a++)-1==t.indexOf(a)&&t.push(a);for(var r=0;r<t.length;r++)e.pagenum=t[r]},this.pagerangearray=function(){var e=this.currentpage,t=i.largePDFPagerange/2,a=i.endpagerange-i.pagerangelimit,r=i.startpagerange+i.pagerangelimit;i.bLargePDF?e<=t?(i.startpagerange=0,i.endpagerange=i.largePDFPagerange):e>=i.pages.length-t?(i.startpagerange=i.pages.length-i.largePDFPagerange,i.endpagerange=i.pages.length):e==a?(i.startpagerange=a-t,i.endpagerange=a+t):e==r?(i.startpagerange=r-t,i.endpagerange=r+t):(e>i.endpagerange||e<i.startpagerange)&&(i.startpagerange=e-t,i.endpagerange=e+t):(i.startpagerange=0,i.endpagerange=i.pages.length);for(var s=[i.currentpage],n=1;n<t;n++)s.push(i.currentpage+n),i.currentpage-n>=0&&s.push(i.currentpage-n);return s},this.pagerange=function(){var e=this.currentpage,t=i.largePDFPagerange/2,a=i.endpagerange-i.pagerangelimit,r=i.startpagerange+i.pagerangelimit;return i.bLargePDF?e<=t?(i.startpagerange=0,i.endpagerange=i.largePDFPagerange):e>=i.pages.length-t?(i.startpagerange=i.pages.length-i.largePDFPagerange,i.endpagerange=i.pages.length):e==a?(i.startpagerange=a-t,i.endpagerange=a+t):e==r?(i.startpagerange=r-t,i.endpagerange=r+t):(e>i.endpagerange||e<i.startpagerange)&&(i.startpagerange=e-t,i.endpagerange=e+t):(i.startpagerange=0,i.endpagerange=i.pages.length),{start:i.startpagerange,end:i.endpagerange,nextstart:i.endpagerange+1,nextend:i.endpagerange+i.largePDFPagerange+1}},this.pagelock=function(e){e||i.pages[i.currentpage].rotateimage(0),i.pagelocked=e,i.lockedpage=i.currentpage},this.mpzoom=function(e,t,a){if(!i.pagelocked)for(var r=0;r<this.pages.length;r++)r!=i.currentpage&&null!=i.pages[r]&&(this.pages[r].dypdf=t,this.pages[r].dxpdf=e,this.pages[r].setpdfScale(a),this.pages[r].pdfisrendered=!1,console.log("mpzoom invalidation"))},this.zoom_update=function(e,t,a,r){if(!i.pagelocked)for(var s=0;s<this.pages.length;s++)s!=i.currentpage&&null!=i.pages[s]&&this.pages[s].zoom_update(e,t,a,r)},this.setDocumentpageScale=function(e){i.pagelocked||(i.PDFDocumentPageScale=e)},this.zoomall=function(){if(!i.pagelocked)for(var e=0;e<this.pages.length;e++)e!=i.currentpage&&null!=i.pages[e]&&this.pages[e].zoomall()},this.pan_position=function(e,t){if(!i.pagelocked){if(0==this.currentpage)var a=0;else a=this.currentpage-1;if(this.currentpage==this.pages.length-1)var r=this.pages.length-1;else r=this.currentpage+1;for(var s=a;s<r;s++)s!=i.currentpage&&null!=i.pages[s]&&(this.pages[s].pan_position(e,t),this.pages[s].usepdfjs&&this.textselect&&(this.pages[s].PDFTextArea.style.display="none"))}},this.pan_update=function(e,t){if(!i.pagelocked){if(0==this.currentpage)var a=0;else a=this.currentpage-1;if(this.currentpage==this.pages.length-1)var r=this.pages.length-1;else r=this.currentpage+1;for(var s=a;s<r;s++)s!=i.currentpage&&null!=i.pages[s]&&(this.pages[s].pan_update(e,t),this.pages[s].usepdfjs&&this.textselect&&(this.pages[s].PDFTextArea.style.display="none"))}},this.ZoomIn=function(e,t){if(!i.pagelocked)for(var a=0;a<this.pages.length;a++)a!=i.currentpage&&null!=i.pages[a]&&this.pages[a].ZoomIn(e,t,!1)},this.zoomheight=function(){if(!i.pagelocked)for(var e=0;e<this.pages.length;e++)e!=i.currentpage&&null!=i.pages[e]&&this.pages[e].zoomheight()},this.zoomwidth=function(){if(!i.pagelocked)for(var e=0;e<this.pages.length;e++)e!=i.currentpage&&null!=i.pages[e]&&this.pages[e].zoomwidth()},this.ZoomOut=function(e,t){if(!i.pagelocked)for(var a=0;a<this.pages.length;a++)a!=i.currentpage&&null!=i.pages[a]&&this.pages[a].ZoomOut(e,t,!1)},this.recalcPages=function(e,t,a){if(!i.pagelocked){null!=i.pages[i.currentpage]&&(this.pages[this.currentpage].dscalepdf,this.pages[this.currentpage].dxpdf,this.pages[this.currentpage].dypdf);for(var r=0;r<this.pages.length;r++)r!=i.currentpage&&null!=i.pages[r]&&(t?this.pages[r].setpdfScale(this.pages[r].dscalepdf*e):this.pages[r].setpdfScale(this.pages[r].dscalepdf/e),this.pages[r].dxpdf=this.pages[r].dxpdf-a,this.pages[r].pdfisrendered=!1,console.log("recalcPages invalidation"))}},this.renderPDFscale=function(){var e=i.getpagePositions(this.currentpage);if(this.pages[this.currentpage].dscalepdf,this.pages[this.currentpage].dxpdf,this.pages[this.currentpage].dypdf,i.pages.length>1&&!i.pagelocked)if(i.bLargePDF)for(var t=0;t<e.positions.length;t++)i.pages[e.positions[t]].pdfisrendered||i.pages[e.positions[t]].renderPDFpagescale(!0);else 0==this.currentpage?(this.pages[this.currentpage].renderPDFpagescale(!0),this.pages[this.currentpage+1].renderPDFpagescale(!0)):this.currentpage==this.pages.length-1?(this.pages[this.currentpage].renderPDFpagescale(!0),this.pages[this.currentpage-1].renderPDFpagescale(!0)):this.currentpage>0&&this.currentpage<this.pages.length-1&&(this.pages[this.currentpage].renderPDFpagescale(!0),this.pages[this.currentpage+1].renderPDFpagescale(!0),this.pages[this.currentpage-1].renderPDFpagescale(!0));else this.pages[this.currentpage].renderPDFpagescale(!0)},this.get_bookmark_pageref=function(e){for(var t=null,a=e[0],r=0;r<i.pages.length;r++)null!=i.pages[r]&&sn(a,i.pages[r].getpageRef())&&(t=i.pages[r].pagenumber);return t},this.getPDF_PageRef=function(e,t){i.pdfDoc.getPageIndex(e).then((function(a){var r=e.num+" "+e.gen+" R";i._pagesRefCache[r]=a,null!=ca&&ca.setPageRef(i._pagesRefCache),t&&null!=ca&&ca.setPDFBookmarks(i.pdfoutline)}))},this.getPDFDocument=function(){return i.pdfDoc},this.setLargePDF=function(e){e>nr&&(i.bLargePDF=!0)},this.loadPDFpages=function(){if(i.pages.length>nr){null!=i.pages[0]&&i.pages[0].renderPDFpage(),mi&&(console.log("page load terminated",e),mi=!1),i.bLargePDF=!0;for(var e=0;e<i.pages.length;e++)if(null!=i.pages[e]&&i.pages[e].getPDFdimensions(),mi){console.log("page load terminated",e),mi=!1;break}}else for(null!=i.pages[0]&&i.pages[0].renderPDFpage(),mi&&(console.log("page load terminated",e),mi=!1),e=0;e<i.pages.length;e++)if(null!=i.pages[e]&&i.pages[e].getPDFdimensions(),mi){console.log("page load terminated",e),mi=!1;break}i.pdfDoc.getMetadata().then((function(e){i.addProperties(e)})),i.pdfDoc.getOutline().then((function(e){e&&(i.pdfoutline=e,null!=ca&&ca.setPDFBookmarks(i.pdfoutline))})),i.SetActive()},this.sendPDFData=function(){var e=new XMLHttpRequest,t=po(Bs.OriginalURL),a=go(Bs.OriginalURL);if(Q)var r=N+"&"+t+"&"+a+"&PDF&200";else r=N+"?"+t+"&"+a+"&PDF&200";e.open("POST",r,!0),e.send(i.pdfDoc._transport._params.data.buffer)},this.setOCGVisibilityAll=function(e){if(null!=i.contentgroupconfig){for(var t=0;t<i.pdflayerlist.length;t++)i.contentgroupconfig.setVisibility(i.pdflayerlist[t].id,e);i.getCurrentpage().redraw()}},this.setOCGVisibility=function(e,t){null!=i.contentgroupconfig&&(i.contentgroupconfig.setVisibility(e,t),i.getCurrentpage().redraw())},this.setPDFContentGroups=function(e){if(i.contentgroupconfig=e,i.contentgroups=e.getGroups(),null!=i.contentgroups){i.pdflayerlist=[];for(const[e,a]of Object.entries(i.contentgroups)){var t={id:e,group:i.contentgroupconfig.getGroup(e)};i.pdflayerlist.push(t)}null!=dt&&dt.setVectorLayers(i.pdflayerlist)}},this.setPDFdocument=function(e,t){i.busesetpdfdoc=!0,i.pdfDoc=e,null!=i.PDFWrapper&&i.PDFWrapper.getOptionalContentGroups(),t&&i.loadPDFpages()},this.getThumb=function(e){for(var t=void 0,a=0;a<i.thumbnails.length;a++)i.thumbnails[a].pagenumber==e&&(t=i.thumbnails[a]);return t},this.loadThumbnail=function(e){if(!i.pages[0].usevector3Dbinary){var t=i.getThumb(e);null!=t&&(i.pages[0].usevectorxml?t.renderVector(1):i.pages[0].usepdfjs?t.renderPDF(1):t.renderImage(1))}},this.refreshThumbnails=function(){null!=st&&st.setThumbnails(i.thumbnails)},this.rotateThumbnail=function(e,t){var a=i.getThumb(e);null!=a&&(a.thumbnailobj.rotation=t)},this.setthumbnail=function(e,t,a){var r=i.getThumb(a);if(null!=r){var s=r.thumbnailobj.thumbnail.height/t,n=r.thumbnailobj.thumbnail.width/e,o=Math.min(n,s);r.setthumbnail(0,0,o),null!=i.pages[0]&&i.pages[0].usepdfjs&&r.setPDFdim(e,t)}},this.addthumbnail=function(e){i.thumbnails.push(e)},this.setBirdseyeTool=function(){var e=i.getThumb(i.currentpage);null!=e&&e.setBirdseyeTool()},this.refreshBirdsEye=function(){var e=i.getThumb(i.currentpage);null!=e&&e.refreshbirdseye()},this.draw3DNav=function(){var e=i.getThumb(i.currentpage);null!=e&&null!=i.pages[i.currentpage]&&null!=i.pages[i.currentpage]&&(i.pages[0].usevector3DGLTF?(i.pages[i.currentpage].Vector3DPageObj.checkcurfloor(),e.drawcamerapos()):i.pages[i.currentpage].bis3Dnavigator&&e.drawcamerapos())},this.setpagecamerapos=function(e,t,a){i.pages[i.currentpage].bis3Dnavigator&&i.pages[i.currentpage].setcamerapos(e,t,a)},this.getBoxcenter=function(){return i.pages[0].usevector3DGLTF?i.pages[i.currentpage].Vector3DPageObj.boxCenter:null},this.setthumbcamdirfunction=function(){var e=i.getThumb(i.currentpage);null!=e&&i.pages[0].usevector3DGLTF&&e.connectCampos(i.pages[i.currentpage].Vector3DPageObj)},this.setthumcamerapos=function(e,t){var a=i.getThumb(i.currentpage);null!=a&&i.pages[0].usevector3DGLTF&&a.setcamerapos(e,t,i.pages[i.currentpage].Vector3DPageObj.boxCenter)},this.setFloorNavScaleOffset=function(e,t){var a=i.getThumb(i.currentpage);null!=a&&i.pages[0].usevector3DGLTF&&a.setFloorNavScaleOffset(e,t)},this.setfloorplanNav=function(e,t){i.pages[0].usevector3DGLTF&&i.pages[0].replacefloorplan(e,t)},this.getFloorplans=function(){return i.pages[0].getFloorplans()},this.create3DFloorplan=function(e,t,a){i.pages[0].usevector3DGLTF&&i.pages[0].Vector3DPageObj.addfloorplanTexture(e,t,a)},this.get3DNavElevationPages=function(e){for(var t=[],a=0;a<i.pages.length;a++)i.pages[a].bis3Dnavigator&&i.pages[a].get3DNavElevation(e)&&t.push({index:a,replaced:i.pages[a].navfloorplan.replaced});return t},this.replaceFloorNav=function(e,t){if(!i.pages[0].usevector3Dbinary){var a=i.getThumb(i.currentpage);null!=a&&(i.pages[0].usevector3DGLTF||(a.removereplacefloornavCallback(),a.setreplacefloornavCallback(e,t)),i.refreshBirdsEye(),i.pages[0].usevectorxml?a.renderVector(4):i.pages[0].usepdfjs?a.renderPDF(4):i.pages[0].usevector3DGLTF||a.renderImage(4))}},this.renderFloorplan=function(e,t,a){if(!i.pages[0].usevector3Dbinary){var r=i.getThumb(i.currentpage);null!=r&&(r.removefloorplanCallback(),r.setfloorplanCallback(e,t,a),i.pages[0].usevectorxml?r.renderVector(3):i.pages[0].usepdfjs?r.renderPDF(3):r.renderImage(3))}},this.setbirdseyefloor=function(e){var t=i.getThumb(i.currentpage);null!=t&&i.pages[0].usevector3DGLTF&&t.setBirdseyeFloor(e)},this.renderBirdsEye=function(){if(!i.pages[0].usevector3Dbinary){var e=i.getThumb(i.currentpage);null!=e&&(i.pages[0].usevector3DGLTF?e.set3DNavImage(2,!1):i.pages[0].usevectorxml?e.renderVector(2):i.pages[0].usepdfjs?e.renderPDF(2):e.renderImage(2),null!=i.pages[i.currentpage]&&i.pages[i.currentpage].pan_update(0,0))}},this.removepage=function(e){for(var t=-1,a=0;a<i.pages.length;a++)i.pages[a].pagenumber==e.pagenumber&&(t=a);t>-1&&i.pages.splice(t,1),0==i.pages.length?(Ka=!0,uu(i.fileindex)):i.GotoPage(i.prevpage)},this.addpage=function(e,t){if(null!=e){if(e.DocRef=i,i.pages.push(e),i.pages.length,t)if(e.usevector3Dbinary)e.loadvectors3DBinary();else if(e.usevector3DGLTF)e.vector3DGltfload(),e.loadfloorplan();else if(e.usevector3Dxml);else if(e.usevectorbinary)gd(!1),i.bRenderinProgress=!0,e.loadbinvectors();else if(e.usevectorbinarycompare)gd(!1),i.bRenderinProgress=!0,e.loadcomparevectors();else if(e.usevectorxml&&null!=e.VectorPageObj)gd(!1),i.bRenderinProgress=!0,e.loadbinvectors(),0!=e.VectorPageObj.height&&0!=e.VectorPageObj.width||i.pages.pop();else if(e.usepdfjs){gd(!1),i.backgroundColor="#FFFFFF";var a=go(i.FileName),r=i.CacheURL;null!=i.relativepath&&(r=i.relativepath);var s=RxConfig.noCachFolder;i.pdfURL=s?RxConfig.xmlurlrel+i.FileNameSRC:r+a,e.firstpage&&(null!=i.pdfDoc&&i.busesetpdfdoc?i.loadPDFpages():(i.PDFWrapper=new Rl(i),i.PDFWrapper.initiate(RxConfig.PDFcmap),i.PDFWrapper.openDocument(i.pdfURL),i.bdestroyPDFonClose=!0))}else 0==i.Type&&(e.initialzoom=2),i.backgroundColor="#FFFFFF",gd(!0),e.loadimages(i.pageNum);e.usevectorbinary&&(e.usevectorxml=!0),e.usevectorbinarycompare&&(e.usevectorxml=!0),e.usevector3Dbinary&&(e.usevector3Dxml=!0),e.usevector3Dbinary&&(e.usevector3Dxml=!0),e.usevector3DGLTF&&(e.usevector3Dxml=!0)}else i.pages.push(e),i.pages.length},this.addlayout=function(e){i.layouts.push(e)},this.setmovepagesthird=function(e,t,a){e.push({from:t.midpage,to:a});for(var i=a+1,r=0;r<t.last.length;r++)e.push({from:t.last[r],to:i+r});i=a-t.first.length;for(var s=0;s<t.first.length;s++)e.push({from:t.first[s],to:i+s});return e},this.setmovepages=function(e,t,a,r){var s=i.pages.length<=60;if(r){var n=a;if(s){for(var o=t.positions.slice(),l=[];o.length>0&&n<i.pages.length;)(g=o.shift())!=n?e.push({from:g,to:n}):l.unshift(g),n++;if(a-o[o.length-1]>1){var c=a-o[o.length-1]-1,h=0;for(n=e[0].to-c;h<c;)(g=o.shift())!=n&&e.push({from:g,to:n}),n++,h++}}else{e.push({from:t.midpage,to:a});for(var u=a+1,d=0;d<t.last.length;d++)e.push({from:t.last[d],to:u+d});u=a-t.first.length;for(var p=0;p<t.first.length;p++)e.push({from:t.first[p],to:u+p})}}else if(n=a,s){for(o=t.positions.slice(),l=[];o.length>0&&n<i.pages.length;)(g=o.shift())!=n?e.push({from:g,to:n}):l.unshift(g),n++;if(a-o[o.length-1]>1)for(c=a-o[o.length-1]-1,h=0,n=e[0].to-c;h<c;){var g;(g=o.shift())!=n&&e.push({from:g,to:n}),n++,h++}}else{for(u=a-t.first.length,p=0;p<t.first.length;p++)e.push({from:t.first[p],to:u+p});for(e.push({from:t.midpage,to:a}),u=a+1,d=0;d<t.last.length;d++)e.push({from:t.last[d],to:u+d})}return e},this.getTargetPositions=function(e,t){for(var a=!1,r=!1,s=!1,n=0,o=[],l=i.pages.length-1,c=0;c<t.positions.length;c++)e==t.positions[c]&&(a=!0);if((n=Math.abs(e-t.midpage))>29&&(n=29),e-t.midpage<0?(r=!0,s=!1):(s=!0,r=!1),a)for(var h=0;h<n;h++){var u=h+1;s?t.positions[t.positions.length-1]+u<=l&&o.push({from:t.positions[0]+h,to:t.positions[t.positions.length-1]+u}):r&&t.positions[0]-u>=1&&o.push({from:t.positions[t.positions.length-1]-h,to:t.positions[0]-u})}else if(e>=or&&e<=i.pages.length-or){var d=e+1;o=i.setmovepages(o,t,e,s)}else if(e<or){d=1;for(var p=0;p<t.positions.length;p++)o.push({from:t.positions[p],to:d+p})}else if(e>i.pages.length-or){if(e>=i.pages.length-t.last.length)var g=i.pages.length-1-t.last.length;else g=e;o=i.pages.length<=60?i.setmovepages(o,t,e,s):i.setmovepages(o,t,g,s)}return g=1,{within:a,toend:s,tofront:r,pagestomove:n,fromto:o}},this.getpagePositions=function(e){for(var t=[],a=1;a<i.pages.length;)null!=i.pages[a]&&t.push(a),a++;for(var r=Math.floor(t.length/2),s=[],n=[],o=0;o<t.length;o++)o<r?s.push(t[o]):o>r&&n.push(t[o]);return{positions:t,midpage:t[r],first:s,last:n}},this.checkpageposnumbers=function(){for(var e=0;e<i.pages.length;e++)null!=i.pages[e]&&e!=i.pages[e].pagenumber&&i.pages[e].movepage(e)},this.movepage=function(e,t,a){var i=e[a];e[a]=e[t],e[t]=i,null!=e[t]&&e[t].movepage(t)},this.movePageObjects=function(e){if(i.bLargePDF){var t=i.getpagePositions(e);if(!(1==t.positions[0]&&e<t.midpage||t.positions[28]==i.pages.length-1&&e>t.midpage)){if(0!=t.positions.length)var a=i.getTargetPositions(e,t);if(a.within)for(var r=0;r<a.fromto.length;r++)i.movepage(this.pages,a.fromto[r].to,a.fromto[r].from);else{for(r=0;r<a.fromto.length;r++)i.movepage(this.pages,a.fromto[r].to,a.fromto[r].from);i.checkpageposnumbers()}}}},this.loadpage=function(e){if(this.pages[this.currentpage].usevectorxml||this.pages[this.currentpage].usevectorbinary)if(this.pages[this.currentpage].vectorloaded){if(null!=this.pages[this.currentpage].VectorPageObj){if(0==this.pages[this.currentpage].VectorPageObj.width||0==this.pages[this.currentpage].VectorPageObj.height)return;this.pages[this.currentpage].draw_vector(!0)}}else this.pages[this.currentpage].loadbinvectors();else 0!=e&&(this.pages[this.currentpage].usepdfjs?i.bLargePDF?null!=this.pages[e]&&this.pages[e].renderPDFpagescale(!0):i.pages[e].renderPDFpagescale(!0):this.pages[e].largeimageloaded&&this.pages[e].smallimageloaded||(0==this.Type&&(this.pages[e].initialzoom=2),this.pages[e].loadimages()))},this.getCurrentThumb=function(){return i.getThumb(i.currentpage)},this.getHoverSpace=function(){return i.hoverspace},this.addHoverSpace=function(e){null==i.hoverspace&&(i.hoverspace=e)},this.clearHoverSpace=function(){i.hoverspace=null},this.drawHoverSpace=function(e){if(null!=i.hoverspace){var t=i.getCurrentpage().dscalevector,a=i.getCurrentpage().dxvector,r=i.getCurrentpage().dyvector,s=i.getCurrentpage().VectorPageObj.x,n=(i.getCurrentpage().VectorPageObj.y,i.getCurrentpage().VectorPageObj.h),o=(i.hoverspace.path[0].x-s)*t,l=(n-i.hoverspace.path[0].y)*t;o+=a,l+=r,e.save(),e.lineWidth=0,e.fillStyle=i.hoverspace.color,e.beginPath(),e.moveTo(o,l);for(var c=1;c<i.hoverspace.path.length;c++)o=(i.hoverspace.path[c].x-s)*t,l=(n-i.hoverspace.path[c].y)*t,o+=a,l+=r,e.lineTo(o,l);e.closePath(),e.fill(),e.restore()}},this.movemultipage=function(e){var t="Adobe PDF"==i.Format.substring(0,9);i.pages.length>or&&t&&i.movePageObjects(e)},this.visiblepage=function(e){return null!=i.pages[e]&&i.pages[e].ispagevisible()},this.getCurrentpage=function(){return null!=i.pages[i.currentpage]||i.movemultipage(i.currentpage),i.pages[i.currentpage]},this.setCurrentpage=function(e){i.movemultipage(e),i.currentpage=e,i.pages[i.currentpage].visible=!0,i.pagelocked||0!=i.pages[i.currentpage].drotation&&i.pages[i.currentpage].forcerotate(0),Cr&&(-1!=i.selectedmarkup.id&&null!=i.markuplist[i.selectedmarkup.id]&&(i.markuplist[i.selectedmarkup.id].setselectedit(!1),i.markuplist[i.selectedmarkup.id].setselect(!1)),al(n),il(a))},this.checkprintready=function(){for(var e=!0,t=0;t<this.pages.length;t++)null!=this.pages[t]&&(this.pages[t].usevector3Dxml?e=!0:this.pages[t].usevectorxml?this.pages[t].vectorloaded||(e=!1):this.pages[t].usepdfjs?e=!0:this.pages[t].largeimageloaded&&this.pages[t].smallimageloaded||(e=!1));return e},this.loadAllPages=function(){this.bDoPrint=!0;for(var e=0;e<this.pages.length;e++)this.pages[e].usevectorxml?this.pages[e].vectorloaded||this.GotoPage(e):this.pages[e].usepdfjs||this.pages[e].largeimageloaded&&this.pages[e].smallimageloaded||this.GotoPage(e);this.GotoPage(0)},this.printDocument=function(e){var t=0;do{this.pages[t].printobj.setRes(300),this.pages[t].printobj.setPaperSize(e.width,e.height),this.pages[t].printobj.setScale(e.printrect),this.pages[t].printobj.print(),t++}while(t<this.pages.length);this.bDoPrint=!1},this.GotoPageAsync=function(e){return new Promise(t=>{i.loadPagetextEvt=a=>{a===e&&(i.loadPagetextEvt=()=>{},t())},i.GotoPage(e)})},this.GotoPage=function(e){if(!(isNaN(e)||e>this.pages.length-1||e<0||e==i.currentpage)){var t=this.currentpage;if(this.pages[this.currentpage].usepdfjs)for(var a=0;a<this.pages.length;a++)null!=this.pages[a]&&a!=this.currentpage&&(this.textselect&&this.pages[a].PDFTextArea&&(this.pages[a].PDFTextArea.style.display="none"),this.pages[a].visible=!1);if(i.setCurrentpage(e),null!=this.pages[this.currentpage])if(this.pages[this.currentpage].usevector3Dxml)null==this.pages[this.currentpage].Vector3DPageObj?this.pages[this.currentpage].loadvectors3DBinary():(this.restorecurpage=this.currentpage,this.SetActive());else if(this.pages[this.currentpage].usevectorxml)if(this.pages[this.currentpage].vectorloaded){if(null!=this.pages[this.currentpage].VectorPageObj){if(0==this.pages[this.currentpage].VectorPageObj.width||0==this.pages[this.currentpage].VectorPageObj.height)return void i.setCurrentpage(t);this.restorecurpage=this.currentpage,this.SetActive()}}else this.pages[this.currentpage].loadbinvectors();else this.pages[this.currentpage].usepdfjs?(this.pages[this.currentpage].enablepagetextCallback(),this.pages[this.currentpage].documentpageScale(i.PDFDocumentPageScale,!0),i.bLargePDF,i.pagelocked||this.pages[this.currentpage].setPFDdimnodraw(this.pages[0].dxpdf,0,1,!1),i.pages[i.currentpage].pageloaded||i.loadpage(i.currentpage),this.pages[this.currentpage].draw_canvas(!0),this.pages[this.currentpage].iscollapsed,i.bLargePDF?(i.pages[i.currentpage].rendercallback=!0,i.pages[i.currentpage].renderPDFpagescale()):i.pages[i.currentpage].rendercallback=!0,this.textselect&&(this.pages[this.currentpage].PDFTextArea.style.display=Wa)):(this.pages[this.currentpage].largeimageloaded&&this.pages[this.currentpage].smallimageloaded||(0==this.Type&&(this.pages[this.currentpage].initialzoom=2),this.pages[this.currentpage].loadimages()),0!=this.currentpage&&(this.pages[this.currentpage].dscale=this.pages[0].dscale,this.pages[this.currentpage].dx=this.pages[0].dx,this.pages[this.currentpage].dy=this.pages[0].dy,this.pages[this.currentpage].checkimageswitch()),this.pages[this.currentpage].draw_image(!0));al(n),Xs.length,this.pages[i.currentpage].usepdfjs,this.pages[i.currentpage].usevector3Dxml,this.pages[i.currentpage].usevectorxml,this.pages.length,this.currentpage,this.bActive;var r={numpages:this.pages.length,currentpage:this.currentpage};null!=Ht&&Ht.pageEvent(r),this.restorecurpage=this.currentpage}},this.getpage=function(e){return this.pages[e]},this.lockMarkupbyGUID=function(e,t){var a=0;for(a=0;a<this.markuplist.length;a++)this.markuplist[a].uniqueID==e&&(this.markuplist[a].locked=t)},this.getmarkupbyGUIDXML=function(e){var t=0,a="",r=!1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&(a=Dc(this.markuplist[t],i),r=!0);return{document:a,found:r}},this.getmarkupSelectedXML=function(e){return e.isempty?void 0:Dc(e,i)},this.getmarkupobjbyGUID=function(e){var t=0,a=-1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&(a=this.markuplist[t]);return a},this.selectmarkupbyGUIDs=function(e){var t=0,a=0;for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;)null!=e[a]&&this.markuplist[t].uniqueID==e[a]&&this.markuplist[t].selectSet(),a++},this.unselectmarkupbyGUIDs=function(e){var t=0,a=0;for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;)null!=e[a]&&this.markuplist[t].uniqueID==e[a]&&this.markuplist[t].unselect(),a++},this.getannotGUIDs=function(){var e=0,t=[];for(e=0;e<this.markuplist.length;e++)t.push(this.markuplist[e].uniqueID);return t},this.getmarkupbyGUIDs=function(e){var t=0,a=0,i=[];for(t=0;t<this.markuplist.length;t++)for(a=0;a<e.length;a++)this.markuplist[t].uniqueID==e[a]&&i.push(t);return i},this.getmarkupbyGUID=function(e){var t=0,a=-1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].uniqueID==e&&(a=t);return a},this.getmarkupbynumber=function(e){var t=0,a=-1;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupnumber==e&&(a=t);return a},this.getmarkupobjbynumber=function(e){var t=0,a=null;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupnumber==e&&(a=this.markuplist[t]);return a},this.getmarkupobjbyID=function(e){var t=0,a=null;for(t=0;t<this.markuplist.length;t++)this.markuplist[t].markupID==e&&(a=this.markuplist[t]);return a},this.setGroupSelectedMarkup=function(e){var t=0;if(e)for(t=0;t<this.markuplist.length;t++){this.markuplist[t].bhasArrow&&this.markuplist[t].type;var a=6==this.markuplist[t].subtype&&6==this.markuplist[t].type,r=a||a,s=this.markuplist[t].selectedit&&9!=this.markuplist[t].type,n=this.markuplist[t].selected||s;r&&n&&this.markuplist[t].pagenumber==i.getcurPage()&&(this.markuplist[t].bispartofGroup=!0,this.markuplist[t].groupRect=i.getmarkupGroupRect())}else for(t=0;t<this.markuplist.length;t++)this.markuplist[t].bispartofGroup=!1,this.markuplist[t].groupRect={x:0,y:0,w:0,h:0}},this.getNumSelectedMarkup=function(){var e=0,t=0;for(e=0;e<this.markuplist.length;e++)this.markuplist[e].isSelected(i.getcurPage())&&t++;return t},this.getMarkupMultiselected=function(){return h},this.setMarkupMultiselected=function(){h=i.getNumSelectedMarkup()>1,i.setGroupSelectedMarkup(h)},this.getmarkupGroupRect=function(){var e=0,t=0,a=[],r=0,s=0,n=0,o=0,l=i.getSelectedMarkup();if(l.length>1){if(3==l[0].type||4==l[0].type||5==l[0].type||9==l[0].type||10==l[0].type||11==l[0].type||12==l[0].type){if(0!=l[0].rotation)var c=l[0].rotrect(l[0].xscaled,l[0].yscaled,l[0].xscaled+l[0].wscaled,l[0].yscaled+l[0].hscaled);else c={x:l[0].xscaled,y:l[0].yscaled,w:l[0].wscaled,h:l[0].hscaled};if(r=c.x,s=c.y,n=c.x+c.w,o=c.y+c.h,4==l[0].type&&1==l[0].subtype){var h=Math.max(l[0].xscaled,l[0].wscaled)-Math.min(l[0].xscaled,l[0].wscaled),u=Math.max(l[0].yscaled,l[0].hscaled)-Math.min(l[0].yscaled,l[0].hscaled),d=l[0].getdiag(h,u);r=l[0].xscaled-d,s=l[0].yscaled-d,n=l[0].xscaled+d,o=l[0].yscaled+d}}else r=l[0].xscaled,s=l[0].yscaled,n=l[0].wscaled,o=l[0].hscaled;for(e=0;e<l.length;e++)3==l[e].type||4==l[e].type||5==l[e].type||9==l[e].type||10==l[e].type||11==l[e].type||12==l[e].type?(c=0!=l[e].rotation?l[e].rotrect(l[e].xscaled,l[e].yscaled,l[e].xscaled+l[e].wscaled,l[e].yscaled+l[e].hscaled):{x:l[e].xscaled,y:l[e].yscaled,w:l[e].wscaled,h:l[e].hscaled},4==l[e].type&&1==l[e].subtype?(h=Math.max(l[e].xscaled,l[e].wscaled)-Math.min(l[e].xscaled,l[e].wscaled),u=Math.max(l[e].yscaled,l[e].hscaled)-Math.min(l[e].yscaled,l[e].hscaled),d=l[e].getdiag(h,u),a.push({x:l[e].xscaled-d,y:l[e].yscaled-d}),a.push({x:l[e].xscaled+d,y:l[e].yscaled+d})):(a.push({x:c.x,y:c.y}),a.push({x:c.x+c.w,y:c.y+c.h}))):(a.push({x:l[e].xscaled,y:l[e].yscaled}),a.push({x:l[e].wscaled,y:l[e].hscaled}));for(t=0;t<a.length;t++)a[t].x<r&&(r=a[t].x),a[t].y<s&&(s=a[t].y),a[t].x>n&&(n=a[t].x),a[t].y>o&&(o=a[t].y)}return{x:r,y:s,w:n,h:o}},this.getSelectedMarkup=function(){var e=0;const t=[];for(e=0;e<this.markuplist.length;e++){var a=this.markuplist[e].selectedit&&9!=this.markuplist[e].type;(this.markuplist[e].selected||a)&&this.markuplist[e].pagenumber==i.getcurPage()&&(this.markuplist[e].bhasArrow&&null!=this.markuplist[e].markupArrowConnected?t.push(this.markuplist[e].markupArrowConnected):t.push(this.markuplist[e]))}return t},this.moveselected=function(e,t){var a=0;for(a=0;a<this.markuplist.length;a++){var r=this.markuplist[a].selectedit&&9!=this.markuplist[a].type;(this.markuplist[a].selected||r)&&this.markuplist[a].pagenumber==i.getcurPage()&&this.markuplist[a].move(e,t,!0)}},this.draw_mpage=function(){var e=Aa/2;switch(this.pages[this.currentpage].currentimage){case 0:this.pages[this.currentpage].dy>e&&this.currentpage>0?i.setCurrentpage(this.currentpage-1):this.pages[this.currentpage].endy<e&&this.currentpage<this.NumPages-1&&i.setCurrentpage(this.currentpage+1),this.pages[this.currentpage].draw_image(!0),this.pages[this.currentpage].endy<Aa&&this.currentpage<this.NumPages-1?this.pages[this.currentpage+1].largeimageloaded?(this.pages[this.currentpage+1].dy=this.pages[this.currentpage].endy+10,this.pages[this.currentpage+1].dx=this.pages[this.currentpage].dx,this.pages[this.currentpage+1].dscale=this.pages[this.currentpage].dscale,this.pages[this.currentpage+1].draw_image(!1)):(i.setCurrentpage(this.currentpage+1),this.loadpage(this.currentpage+1)):this.pages[this.currentpage].dy>10&&this.currentpage>0&&(this.pages[this.currentpage-1].largeimageloaded?(this.pages[this.currentpage-1].dy=this.pages[this.currentpage].dy-this.pages[this.currentpage].MainImageHeight*this.pages[this.currentpage].dscale-10,this.pages[this.currentpage-1].dx=this.pages[this.currentpage].dx,this.pages[this.currentpage-1].dscale=this.pages[this.currentpage].dscale,this.pages[this.currentpage-1].draw_image(!1)):(i.setCurrentpage(this.currentpage-1),this.loadpage(this.currentpage-1),rrentpage-=1));break;case 1:this.pages[this.currentpage].dyextent>e&&this.currentpage>0?i.setCurrentpage(this.currentpage-1):this.pages[this.currentpage].endy<e&&this.currentpage<this.NumPages-1&&i.setCurrentpage(this.currentpage+1),this.pages[this.currentpage].draw_image(!0),this.pages[this.currentpage].endy<Aa&&this.currentpage<this.NumPages-1?this.pages[this.currentpage+1].smallimageloaded?(this.pages[this.currentpage+1].dy=this.pages[this.currentpage].endy+10,this.pages[this.currentpage+1].dx=this.pages[this.currentpage].dx,this.pages[this.currentpage+1].dscale=this.pages[this.currentpage].dscale,this.pages[this.currentpage+1].draw_image(!1)):(i.setCurrentpage(this.currentpage+1),this.loadpage(this.currentpage+1)):this.pages[this.currentpage].dyextent>10&&this.currentpage>0&&(this.pages[this.currentpage-1].smallimageloaded?(this.pages[this.currentpage-1].dy=this.pages[this.currentpage].dy-this.pages[this.currentpage].MainImageHeight*this.pages[this.currentpage].dscale-10,this.pages[this.currentpage-1].dx=this.pages[this.currentpage].dx,this.pages[this.currentpage-1].dscale=this.pages[this.currentpage].dscale,this.pages[this.currentpage-1].draw_image(!1)):(this.loadpage(this.currentpage-1),i.setCurrentpage(this.currentpage-1)))}Xs.length,this.pages[this.currentpage].usepdfjs,this.pages[this.currentpage].usevector3Dxml,this.pages[this.currentpage].usevectorxml,this.pages.length,this.currentpage,this.bActive,this.restorecurpage=this.currentpage;var t={numpages:this.pages.length,currentpage:this.currentpage};null!=Ht&&Ht.pageEvent(t)},this.updateadjpages=function(){0==this.currentpage&&(this.pages[this.currentpage+1].pdfisrendered||this.pages[this.currentpage+1].renderPDFpagescale(!0)),this.currentpage==this.NumPages-1&&(this.pages[this.currentpage-1].pdfisrendered||this.pages[this.currentpage-1].renderPDFpagescale(!0)),this.currentpage>0&&this.currentpage<this.NumPages-1&&(this.pages[this.currentpage+1].pdfisrendered||this.pages[this.currentpage+1].renderPDFpagescale(!0),this.pages[this.currentpage-1].pdfisrendered||this.pages[this.currentpage-1].renderPDFpagescale(!0))},this.get_visible_pages=function(){},this.draw_mpagepdf=function(){if((!i.pages[i.currentpage].usepdfjs||null!=i.pdfDoc)&&i.bActive&&!$a){var e=this.currentpage;if(null!=i.pages[i.currentpage]){var t,a,r,s=i.pages[i.currentpage].dypdf+i.pages[i.currentpage].offscreenheight*i.pages[i.currentpage].dscalepdf,n=i.pages[i.currentpage].dypdf,o=i.pages[this.currentpage].dypdf-i.pages[0].offscreenheight*i.pages[0].dscalepdf-10,l=(i.pages[0].dxpdf,i.pages[0].offscreenwidth*i.pages[0].dscalepdf),c=i.pages[0].offscreenheight*i.pages[0].dscalepdf,h=function(e,t,a,i){var r=Aa/2;return{bt:e>10&&a>0,bc:e-10>r&&a>0,ab:t<Aa&&a<i,ac:t+10<r&&a<i}}(n,s,i.currentpage,i.pages.length-1),u=(t=h,a=this.currentpage,r=a,t.bc&&(r-=1),t.ac&&(r+=1),r);if(i.pages.length>1&&!i.pagelocked){if(i.pages[this.currentpage].draw_canvas(!0),h.ab?(d=w(this.currentpage+1),o=i.pages[this.currentpage].endy+10,l=i.pages[this.currentpage].offscreenwidth*i.pages[this.currentpage].dscalepdf,function(e,t,a,i,r,s,n){for(var o=t,l=r;l<=s;)o<Aa&&(n.rendercomplete||k(e,o,a,i),l),l+=1,o=o+i+10}(i.pages[this.currentpage].dxpdf,o,l,c,i.currentpage+1,i.pages.length-1,d),d.havepage?(d.loaded&&d.pdfdimset||d.rendering)&&(i.pages[this.currentpage+1].setPagePosBelow(i.pages[this.currentpage]),i.pages[this.currentpage+1].draw_canvas(!1)):i.loadpage(i.currentpage+1)):h.bt&&(d=w(i.currentpage-1),o=i.pages[i.currentpage].dypdf-10-c,l=i.pages[i.currentpage].offscreenwidth*i.pages[i.currentpage].dscalepdf,function(e,t,a,i,r,s,n){for(var o=r,l=s,c=t,h=c+i;o>=0;)h>10&&(n.rendercomplete||k(e,c,a,i),l=o),o-=1,h=(c=c-10-i)+i}(i.pages[i.currentpage].dxpdf,o,l,c,i.currentpage-1,i.pages.length-1,d),d.havepage?(d.loaded&&d.pdfdimset||d.rendering)&&(i.pages[i.currentpage-1].setPagePosAbove(i.pages[i.currentpage]),i.pages[i.currentpage-1].draw_canvas(!1)):i.loadpage(i.currentpage-1)),u!=this.currentpage){var d=w(u);d.havepage?d.loaded&&d.pdfdimset?(i.setCurrentpage(u),i.pages[i.currentpage].documentpageScale(i.PDFDocumentPageScale,!0)):d.rendering?(i.pages[i.currentpage].draw_canvas(!1),i.pages[i.currentpage].documentpageScale(i.PDFDocumentPageScale,!0)):(i.loadpage(u),i.pages[i.currentpage].documentpageScale(i.PDFDocumentPageScale,!0)):(i.loadpage(u),i.pages[i.currentpage].documentpageScale(i.PDFDocumentPageScale,!0))}}else i.pages[i.currentpage].draw_canvas(!0);this.textselect&&(this.pages[this.currentpage].PDFTextArea.style.display=Wa),Xs.length,this.pages[this.currentpage].usepdfjs,this.pages[this.currentpage].usevector3Dxml,this.pages[this.currentpage].usevectorxml,this.pages.length,this.currentpage,this.bActive,this.restorecurpage=this.currentpage;var p={numpages:this.pages.length,currentpage:this.currentpage};null!=Ht&&e!=this.currentpage&&Ht.pageEvent(p)}}},this.Suspend=function(){i.pages[i.currentpage].usevector3Dxml&&(i.pages[i.currentpage].clock.stop(),u.clippingPlanes=ye,u.domElement.style.visibility="hidden",Sr=!1,null!=mt&&(mt.isupdate=!1,mt.set3DParts([])))},this.SetActive=function(e){if(!i.bSopenSilent){var t=!1;if(i.setCurrentpage(i.restorecurpage),0==i.pages.length)return!1;if(e&&"Compare"==e.Type&&(t=!0,this.disableMenu=!0,this.Drawmarkup=!1,i.restorecurpage=i.currentpage,i.setCurrentpage(e.currentpage)),this.bActive=!0,u.clippingPlanes=ye,u.domElement.style.visibility="hidden",Sr=!1,$a=t,i.pages[i.currentpage].usevectorxml)gd(!1),!t&&i.pages[i.currentpage].VectorPageObj&&(i.pages[i.currentpage].restoreScaleAndOffset(),i.pages[i.currentpage].VectorPageObj.setActive(),this.bcompare?this.disableMenu=!0:this.disableMenu=!1,this.setactive=!1,this.Drawmarkup=!0,i.pages[i.currentpage].draw_vector(!0)),al(n),Wu();else if(i.pages[i.currentpage].usevector3Dxml)switch(i.pages[i.currentpage].clock.start(),u.domElement.style.visibility="visible",$a=!1,i.pages[i.currentpage].Vector3DPageObj.clippingOn?u.clippingPlanes=i.pages[i.currentpage].Vector3DPageObj.globalPlanes:u.clippingPlanes=ye,Sr=!0,null!=mt&&(mt.isupdate=!1,mt.set3DParts(i.pages[i.currentpage].Vector3DPageObj.navlist)),i.curcontrol3D){case"orbitControl":nd("orbitControl",{}),i.curcontrol3D="orbitControl",null!=ta&&lr&&ta.setWalkthroughGUI(!1);break;case"Walkthrough3D":nd("Walkthrough3D",{}),i.curcontrol3D="Walkthrough3D",null!=ta&&lr&&ta.setWalkthroughGUI(!0);break;case"markupedit":nd("markupedit",{p1:!1}),i.curcontrol3D="markupedit"}else i.pages[i.currentpage].usepdfjs?(gd(!1),t||(i.pages[i.currentpage].restoreScaleAndOffset(),i.pages[i.currentpage].draw_canvas(!0),this.disableMenu=!1,this.Drawmarkup=!0,al(n)),Wu()):i.pages[i.currentpage].usevectorbinarycompare||(gd(!0),t||(i.pages[i.currentpage].restoreScaleAndOffset(),i.pages[i.currentpage].resetimage(),this.disableMenu=!1,this.Drawmarkup=!0,al(n)),i.pages[i.currentpage].draw_image(!0),Wu());null!=Et&&Et.setMarkupList(i.getmarkuplist(),i.bActive),null!=st&&st.setThumbnails(i.thumbnails);var a={iscompare:$a,numOpenFiles:Xs.length,isPDF:this.pages[this.currentpage].usepdfjs,is3D:this.pages[this.currentpage].usevector3Dxml,markupOn3D:!1,is2D:this.pages[this.currentpage].usevectorxml,numpages:this.pages.length,currentpage:this.currentpage,activefile:this.bActive,disableMenu:this.disableMenu||!1};null!=Ye&&Ye.loadComplete(i.FileName,i.bActive),null!=Gt&&Gt.setGUIState(a),null!=ba&&(ba.hastext=i.hastext,ba.hasText(i.hastext,i.bActive));var r={numpages:this.pages.length,currentpage:this.currentpage};return null!=Ht&&Ht.pageEvent(r),!0}},this.enableTextSelect=function(e){i.textselect=e;for(var t=0;t<i.pages.length;)null!=i.pages[t]&&(i.pages[t].usepdfjs&&(e||(i.pages[t].PDFTextArea.style.display="none")),i.pages[t].usevectorxml&&(e||i.pages[t].TextSelectArea&&(i.pages[t].TextSelectArea.style.display="none"))),t++;e&&(i.pages[i.currentpage].usepdfjs&&(i.pages[i.currentpage].PDFTextArea.style.display=Wa,i.pages[i.currentpage].renderPDFpagescaleTextnew()),i.pages[i.currentpage].usevectorxml&&(i.pages[i.currentpage].cleartextdivs(),i.pages[i.currentpage].settextdivs(),i.pages[i.currentpage].TextSelectArea.style.display=Wa))},this.closePages=function(t){for(;0!=i.pages.length;){if(null!=i.pages[i.pages.length-1]){if(i.pages[i.pages.length-1].usepdfjs&&(i.pages[i.pages.length-1].PDFPointArray=[],i.pages[i.pages.length-1].pdfisfirstrendered&&(clearInterval(i.pages[i.pages.length-1].pdftimervar),null!=e&&null!=i.pages[i.pages.length-1].PDFTextArea&&(i.pages[i.pages.length-1].PDFTextArea.removeEventListener("wheel",od,!0),e.removeChild(i.pages[i.pages.length-1].PDFTextArea)))),i.pages[i.pages.length-1].usevectorxml){clearInterval(i.pages[i.pages.length-1].vectortimervar),i.textselect=!1,null!=e&&null!=i.pages[i.pages.length-1].TextSelectArea&&(e.appendChild(i.pages[i.pages.length-1].TextSelectArea),e.removeChild(i.pages[i.pages.length-1].TextSelectArea)),null!=i.pages[i.pages.length-1].VectorPageObj&&i.pages[i.pages.length-1].VectorPageObj.Close();var a=[];null!=ut&&ut.setVectorLayers(a),null!=pt&&pt.setVectorBlocks(a)}i.pages[i.pages.length-1].usevector3Dxml&&(u.domElement.style.visibility="hidden",null!=ta&&lr&&ta.setWalkthroughGUI(!1),Sr=!1,null!=i.pages[i.pages.length-1].Vector3DPageObj&&(i.pages[i.pages.length-1].Vector3DPageObj.Close(),i.pages[i.pages.length-1].Vector3DPageObj=null),null!=mt&&(mt.isupdate=!1,mt.set3DParts([])))}i.pages.pop()}if(t){for(;0!=i.markupundolist.length;)i.markupundolist.pop();for(;0!=i.markupredolist.length;)i.markupredolist.pop();for(;0!=i.markuplist.length;)i.markuplist.pop();for(;0!=i.markupdraworder.length;)i.markupdraworder.pop()}null!=Et&&Et.setMarkupList(i.getmarkuplist(),i.bActive),null!=st&&st.setThumbnails(i.thumbnails)},this.setdelayedClose=function(e){i.bdelayedClose=e},this.getdelayedClose=function(){return i.bdelayedClose},this.Close=function(){for(i.bActive=!1,Rr=!1;0!=i.pages.length;){if(null!=i.pages[i.pages.length-1]){if(i.pages[i.pages.length-1].usepdfjs&&(i.pages[i.pages.length-1].PDFPointArray=[],i.pages[i.pages.length-1].pdfisfirstrendered&&(clearInterval(i.pages[i.pages.length-1].pdftimervar),null!=e&&null!=i.pages[i.pages.length-1].PDFTextArea&&(i.pages[i.pages.length-1].PDFTextArea.removeEventListener("wheel",od,!0),e.removeChild(i.pages[i.pages.length-1].PDFTextArea)))),i.pages[i.pages.length-1].usevectorxml){clearInterval(i.pages[i.pages.length-1].vectortimervar),i.textselect=!1,null!=e&&null!=i.pages[i.pages.length-1].TextSelectArea&&(e.appendChild(i.pages[i.pages.length-1].TextSelectArea),e.removeChild(i.pages[i.pages.length-1].TextSelectArea)),null!=i.pages[i.pages.length-1].VectorPageObj&&i.pages[i.pages.length-1].VectorPageObj.Close();var t=[];null!=ut&&ut.setVectorLayers(t),null!=pt&&pt.setVectorBlocks(t)}i.pages[i.pages.length-1].usevector3Dxml&&(u.domElement.style.visibility="hidden",null!=ta&&lr&&ta.setWalkthroughGUI(!1),Sr=!1,null!=i.pages[i.pages.length-1].Vector3DPageObj&&(i.pages[i.pages.length-1].Vector3DPageObj.Close(),i.pages[i.pages.length-1].Vector3DPageObj=null),null!=mt&&(mt.isupdate=!1,mt.set3DParts([])))}i.pages.pop()}for(i.bdestroyPDFonClose&&(null!=i.pdfDoc&&i.pdfDoc.destroy(),i.pdfDoc=null);0!=this.markupundolist.length;)this.markupundolist.pop();for(;0!=this.markupredolist.length;)this.markupredolist.pop();for(;0!=this.markuplist.length;)this.markuplist.pop();for(;0!=this.markupdraworder.length;)this.markupdraworder.pop();for(;0!=this.layouts.length;)this.layouts.pop();for(;0!=this.thumbnails.length;)this.thumbnails.pop();null!=Et&&Et.setMarkupList(i.getmarkuplist(),i.bActive),null!=wt&&wt.setMarkupList([],i.bActive),null!=st&&st.setThumbnails(i.thumbnails)}}}class Yl{constructor(){var e=this;this.measurescale=Or,this.Unitofmeasure=Fr,this.unitname="Metric",this.SubmeasureUnit=qr,this.Unitlabel=Ir,this.AreaUnitlabel=jr,this.unitscale=_r,this.scaleValue="1:1",this.scaleLabel="1 Millimeter : 1 Millimeter",this.ndimprecision=ne,this.setUnit=function(e){switch(e){case 1:this.Unitlabel="mm",this.AreaUnitlabel="mmÂ²";break;case 2:this.Unitlabel="in.",this.AreaUnitlabel="sq.in.";break;case 3:this.Unitlabel="Units",this.AreaUnitlabel="UnitsÂ²"}this.Unitofmeasure=e},this.getUnitScale=function(){return e.unitscale},this.getUnit=function(){var t="Metric";switch(this.Unitofmeasure){case 1:t="Metric";break;case 2:t="Imperial";break;case 3:t="System"}return{unit:e.Unitofmeasure,unitname:t,subunit:e.SubmeasureUnit,label:e.Unitlabel,Arealabel:e.AreaUnitlabel}},this.imperialUnit=function(t){switch("Inch"==t&&(e.SubmeasureUnit=1),"Feet"==t&&(e.SubmeasureUnit=2),"Yard"==t&&(e.SubmeasureUnit=3),"Mile"==t&&(e.SubmeasureUnit=4),"Nautical Miles"==t&&(e.SubmeasureUnit=5),e.SubmeasureUnit){case 1:e.Unitlabel="in.",e.AreaUnitlabel="sq.in.",e.unitscale=1;break;case 2:e.Unitlabel="ft.",e.AreaUnitlabel="sq.ft.",e.unitscale=12;break;case 3:e.Unitlabel="yd.",e.AreaUnitlabel="sq.yd.",e.unitscale=36;break;case 4:e.Unitlabel="mi.",e.AreaUnitlabel="sq.mi",e.unitscale=63360;break;case 5:e.Unitlabel="nm",e.AreaUnitlabel="sq.nm",e.unitscale=72913.3858}},this.metricUnit=function(t){switch("Millimeter"==t&&(e.SubmeasureUnit=1),"Centimeter"==t&&(e.SubmeasureUnit=2),"Decimeter"==t&&(e.SubmeasureUnit=3),"Meter"==t&&(e.SubmeasureUnit=4),"Kilometer"==t&&(e.SubmeasureUnit=5),"Nautical Miles"==t&&(e.SubmeasureUnit=6),e.SubmeasureUnit){case 1:e.Unitlabel="mm",e.AreaUnitlabel="mmÂ²",e.unitscale=1;break;case 2:e.Unitlabel="cm",e.AreaUnitlabel="cmÂ²",e.unitscale=10;break;case 3:e.Unitlabel="dm",e.AreaUnitlabel="dmÂ²",e.unitscale=100;break;case 4:e.Unitlabel="m",e.AreaUnitlabel="mÂ²",e.unitscale=1e3;break;case 5:e.Unitlabel="km",e.AreaUnitlabel="kmÂ²",e.unitscale=1e6;break;case 6:e.Unitlabel="nmi",e.AreaUnitlabel="nmiÂ²",e.unitscale=1852e5}},this.setMeasureScaledirect=function(t){e.measurescale=t},this.getMeasureScale=function(){return e.measurescale},this.getScaleValue=function(){return e.scaleValue},this.setCalibration=function(t){return t?0!=Nr&&(Lr=1/(Lr=Vr/Nr),e.measurescale=Lr):Lr=1,Zh(),Lr},this.setCalibrateScale=function(t){e.measurescale=t,Zh()},this.setMeasureScale=function(t){e.scaleValue=t;var a=0,i=0;if("Calibration"!=t){var r=t.split(":");a=r[0],i=r[1],e.measurescale=Ts?i/a:a/i}else e.measurescale=Lr;Zh()},this.setDimPrecision=function(t){e.ndimprecision=t},this.getDimPrecision=function(t){return e.ndimprecision},this.setScaleLabel=function(t){e.scaleLabel=t},this.getScaleLabel=function(){return e.scaleLabel},this.resetToDefaultValue=function(){e.measurescale=Or,e.Unitofmeasure=Fr,e.unitname="Metric",e.SubmeasureUnit=qr,e.Unitlabel=Ir,e.AreaUnitlabel=jr,e.unitscale=_r,e.scaleValue="1:1",e.scaleLabel="1 Millimeter : 1 Millimeter",e.ndimprecision=ne}}}function ql(e){}function Zl(e){if(null!=Zt&&Zt.setUpload("hide"),200==e.currentTarget.status){var t=e.currentTarget.responseXML;null!=t&&null!=t.documentElement||(t=Jn(e.currentTarget.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;a=uo(Bs.FileNameSRC)+a,null!=je&&je.loadComplete(a)}else console.log("ImageUploadComplete",e.currentTarget.status)}function Jl(e){e.lengthComputable&&null!=Zt&&Zt.setUpload(Math.round(100*e.loaded/e.total))}function Kl(){var e=po(Bs.OriginalURL),t=go(Bs.OriginalURL);if(Q)var a=N+"&"+e+"&"+t+"&PDF&200";else a=N+"?"+e+"&"+t+"&PDF&200";var i=u.domElement.toDataURL();qc("POST",a,"",[{event:"load",func:Zl},{event:"progress",func:Jl,bupload:!0}],i)}function Ql(e){var t="";return t=(t=e.replace(/&(?!amp;)(?!quot;)(?!lt;)(?!gt;)(?!apos;)/g,"&amp;")).replace(/"/g,"&quot;"),m0=m0.replace(/'/g,"&apos;"),t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;")}function $l(e){e.consolidateonly,e.format,e.UPI,e.paperSize,e.markupFlag,e.useRaster;var t=po(Bs.OriginalURL),a=go(Bs.OriginalURL);if(Q)var i=L+"&"+t+"&"+a;else i=L+"?"+t+"&"+a;for(var r=[],s=$n(),n=0;n<s.length;n++)r.push({type:s[n].type,name:s[n].name,ptrn:s[n].ptrn,tilesize:s[n].tilesize,color:s[n].color,description:s[n].description,inuse:s[n].inuse});var o={pagerect:zh(),fillarray:r,layers:Wh(),filledblocks:_h()};for(n=0;n<o.fillarray.length;n++)if("hatch"==o.fillarray[n].type){var l=yn(o.fillarray[n].ptrn);o.fillarray[n].ptrn=l}var c=JSON.stringify(o);Kc("POST",i,"",c).then((function(t){var a=Jn(t);if(null!=a.getElementsByTagName("reference")[0]){var i=a.getElementsByTagName("reference")[0].firstChild.nodeValue;e.reference=i,function(e){var t=e.consolidateonly,a=(e.format,e.UPI,e.paperSize),i=(e.markupFlag,e.useRaster,e.reference),r=kc(!1,t,!0,hs,hs),s=po(Bs.OriginalURL),n=go(Bs.OriginalURL);if(Q)var o=V+"&"+s+"&"+n+"&"+i+"&"+a;else o=V+"?"+s+"&"+n+"&"+i+"&"+a;Jc("POST",o,r).then((function(e){if(null!=e.getElementsByTagName("PDF")[0]){var t=e.getElementsByTagName("PDF")[0].firstChild.nodeValue,a=uo(Bs.FileNameSRC);Q&&(a=ae),t=a+t,null!=je&&je.loadComplete(t)}})).catch((function(e){e.status?console.log("exportFilePrintFinal",e.status):console.log(e)}))}(e)}})).catch((function(e){e.status?console.log("exportFileSendPrintPDF",e.status):console.log(e)}))}function ec(e,t){if(!jh()){e.consolidateonly;var a=e.format,i=e.UPI,r=e.paperSize,s=e.markupFlag,n=e.singlepage,o=e.page,l=e.useRaster?"1":"0";if((new Date).getTime(),Bs.getCurrentpage().usevector3Dxml)Kl();else{Bs.getCurrentpage().usepdfjs&&(Bs.getCurrentpage().curpagescale,Bs.getCurrentpage().dscalepdf);var c=new XMLHttpRequest;if(c.withCredentials=fi,c.upload.addEventListener("progress",ql,!1),Bs.FileLocal)for(var h=0;h<Kr.length;h++)Kr[h].filenameonly==foxitdoc.filename&&ic(Kr[h],Bs.fileindex);var u=po(Bs.OriginalURL),d=go(Bs.OriginalURL);if(n&&null!=o)var p=O+"&"+u+"&"+d+"&"+o+"&"+a+"&"+i+"&"+r+"&"+s+"&"+l;else p=Q?j+"&"+u+"&"+d+"&"+a+"&"+i+"&"+r+"&"+s+"&"+l:j+"?"+u+"&"+d+"&"+a+"&"+i+"&"+r+"&"+s+"&"+l;try{c.open("POST",p,!0)}catch(e){alert("Error 1 - "+e)}try{c.responseType=""}catch(e){}if(ks){var g=Zc();g.authset&&c.setRequestHeader("Authorization",g.authString+g.baseuserstring)}c.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=Jn(this.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;null!=t.getElementsByTagName("isPDF")[0]&&t.getElementsByTagName("isPDF")[0].firstChild.nodeValue;var i=uo(Bs.FileNameSRC);Q&&(i=ae),li||(a=i+a),null!=je&&je.loadComplete(a)}else 404==this.status?console.log("unable to export file error 404"):503==this.status&&console.log("unable to export file error 503")},c.send(t)}}}function tc(e,i,s,o){if(mi=!1,ri){if(null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),null!=e.displayname)var l=e.displayname;else l=go(e.filename);var c,h=function(e){var t='<?xml version="1.0" encoding="UTF-8"?>';return t+="<RxViewServer>",t+="<Command>GetFile</Command>",t+="<LicenseID>"+_i+"</LicenseID>",t+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(t+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(t+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(t+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(t+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(t+="<password>"+e.password+"</password>"),t+"</RxViewServer>"}(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu(),Jc("POST",p,h,[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=Qt&&Qt.setDownload("hide");var r=0,n=0;Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.usepagesload=!0;var o=mo(Bs.OriginalURL),h=e.getElementsByTagName("Layout");for(t=0;t<h.length;t++){var u=h[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Bs.addlayout(u);var d=h[t].getElementsByTagName("Page");if(i.indexOf(t)>=0)for(a=0;a<d.length;a++)0==a&&0==t?(s&&i.indexOf(t),(i.indexOf(a)>=0||s)&&(c=new _l(d[a],u,!0,o,a,Bs),Bs.addpage(c,!0),Bs.addthumbnail(new Gl(d[a],u,Bs,a)),n++)):(i.indexOf(a)>=0||s)&&(0==n?(c=new _l(d[a],u,!0,o,a+r,Bs),Bs.addthumbnail(new Gl(d[a],u,Bs,a+r)),Bs.addpage(c,!0),n++):(c=new _l(d[a],u,!1,"",a+r,Bs),Bs.addthumbnail(new Gl(d[a],u,Bs,a+r)),Bs.addpage(c,!1),n++));r+=a}if(Ih()){Bs.FileName=l,Xs[Ws-1]=Bs,null!=st&&st.setThumbnails(Bs.thumbnails);var p={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive,source:"getfilepages"};null!=Gt&&Gt.setGUIState(p);var g={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(g)}else p={iscompare:$a,numOpenFiles:Xs.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:Bs.pages.length,currentpage:0,activefile:Bs.bActive},null!=Gt&&Gt.setGUIState(p)})).catch((function(e){Fh(e)}))}}function ac(e,i,s,o){if(mi=!1,ri){null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0));var l,c=go(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu();var h='<?xml version="1.0" encoding="UTF-8"?>';h+="<RxViewServer>",h+="<Command>GetFile</Command>",h+="<LicenseID>"+_i+"</LicenseID>",h+="<FileURL>"+e+"</FileURL>",Jc("POST",p,h+="</RxViewServer>",[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=Qt&&Qt.setDownload("hide");var r=0,n=0;null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.usepagesload=!0):(Ws=Xs.push(new Xl(e)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.usepagesload=!0);var o=mo(Bs.OriginalURL),h=e.getElementsByTagName("Layout");for(t=0;t<h.length;t++){var u=h[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Bs.addlayout(u);var d=h[t].getElementsByTagName("Page");if(i.indexOf(t)>=0)for(a=0;a<d.length;a++)0==a&&0==t?(s&&i.indexOf(t),(i.indexOf(a)>=0||s)&&(l=new _l(d[a],u,!0,o,a,Bs),Bs.addpage(l,!0),Bs.addthumbnail(new Gl(d[a],u,Bs,a)),n++)):(i.indexOf(a)>=0||s)&&(0==n?(l=new _l(d[a],u,!0,o,a+r,Bs),Bs.addthumbnail(new Gl(d[a],u,Bs,a+r)),Bs.addpage(l,!0),n++):(l=new _l(d[a],u,!1,"",a+r,Bs),Bs.addthumbnail(new Gl(d[a],u,Bs,a+r)),Bs.addpage(l,!1),n++));r+=a}if(Ih()){Bs.FileName=c,Xs[Ws-1]=Bs,null!=st&&st.setThumbnails(Bs.thumbnails);var p={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(p);var g={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(g)}else p={iscompare:$a,numOpenFiles:Xs.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:Bs.pages.length,currentpage:0,activefile:Bs.bActive},null!=Gt&&Gt.setGUIState(p)})).catch((function(e){Eh("getFilePages",e)}))}}function ic(e,t){if(mi=!1,ri){null!=e.displayname?e.displayname:go(e.filename);var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetFile</Command>",a+="<LicenseID>"+_i+"</LicenseID>",a+="<FileURL>"+e.filename+"</FileURL>",Jc("POST",p,a+="</RxViewServer>").then((function(e){Xs.length>0&&Xs[t].updateURL(e)})).catch((function(e){Eh("updatelocalDoc",e)}))}}function rc(e,t,a){if(mi=!1,ri){var i='<?xml version="1.0" encoding="UTF-8"?>';i+="<RxViewServer>",i+="<Command>GetFile</Command>",i+="<LicenseID>"+_i+"</LicenseID>",i+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(i+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(i+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(i+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(i+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(i+="<password>"+e.password+"</password>"),e.refresh&&(i+="<RefreshCache>1</RefreshCache>"),Jc("POST",p,i+="</RxViewServer>",[{event:"callback",func:t},{event:"progressCallBack",func:a}]).then((function(e){var t=(new XMLSerializer).serializeToString(e);null!=Xe&&Xe.setXMLreturn(e,t)})).catch((function(e){Eh("createContent",e)}))}else null!=Qt&&Qt.setDownload("hide")}function sc(e,i,s){if(mi=!1,ri){if(null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),null!=e.displayname)var o=e.displayname;else o=go(e.filename);var l;n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu();var c='<?xml version="1.0" encoding="UTF-8"?>';c+="<RxViewServer>",c+="<Command>GetFile</Command>",c+="<LicenseID>"+_i+"</LicenseID>",c+="<FileURL>"+e.filename+"</FileURL>",null!=e.xrefurl&&(c+="<XREFURL>"+e.xrefurl+"</XREFURL>"),null!=e.cacheid&&(c+="<CacheID>"+e.cacheid+"</CacheID>"),null!=e.mime&&(c+="<Mime>"+e.mime+"</Mime>"),null!=e.auth&&(c+="<AutHeader>"+e.auth+"</AutHeader>"),null!=e.password&&(c+="<password>"+e.password+"</password>"),Jc("POST",p,c+="</RxViewServer>",[{event:"callback",func:i},{event:"progressCallBack",func:s}]).then((function(t){var a,i=0;if(Ka&&bi&&du(),pe=t,0==t.getElementsByTagName("Error").length||null==t.getElementsByTagName("Error")[0].firstChild){var r=0;null==Bs||null==Bs?(Ws=Xs.push(new Xl(t)),(Bs=Xs[Ws-1]).setfileindex(Ws-1)):(Ws=Xs.push(new Xl(t)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1)),null!=e.password&&Bs.setPassword(e.password);var s=mo(Bs.OriginalURL),n="Adobe PDF"==Bs.Format.substring(0,9),c=t.getElementsByTagName("Layout");for(a=0;a<c.length;a++){var h=c[a].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Bs.addlayout(h);var u=c[a].getElementsByTagName("Page");for(i=0;i<u.length;i++)if(0==i&&0==a){l=new _l(u[i],h,!0,s,i,Bs);var d=u[i],p=h;Bs.addthumbnail(new Gl(u[i],h,Bs,i)),Bs.addpage(l,!0)}else Bs.addthumbnail(new Gl(u[i],h,Bs,i+r)),i<or||!n?(l=new _l(u[i],h,!1,"",i+r,Bs),Bs.addpage(l,!1)):Bs.addpage(void 0,!1);r+=i}if(Ih()){n&&d&&p&&(Bs.tempPage=new _l(d,p,!1,"",0,Bs)),Bs.FileName=o,Xs[Ws-1]=Bs,null!=st&&st.setThumbnails(Bs.thumbnails);var g={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(g);var m={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(m)}}else!function(e,t){null!=Qt&&Qt.setDownload("hide"),"Require Password"==e&&null!=rt&&rt.PassWordRequest(Jh,1,t)}(t.getElementsByTagName("Error")[0].firstChild.nodeValue,e)})).catch((function(e){Eh("getFile",e)}))}else null!=Qt&&Qt.setDownload("hide")}function nc(e,t,a){if(mi=!1,ri){null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!1));var i,r=go(e);Su(),Pu();var s='<?xml version="1.0" encoding="UTF-8"?>';s+="<RxViewServer>",s+="<Command>GetFile</Command>",s+="<LicenseID>"+_i+"</LicenseID>",s+="<FileURL>"+e+"</FileURL>",Jc("POST",p,s+="</RxViewServer>",[{event:"callback",func:t},{event:"progressCallBack",func:a}]).then((function(e){var t,a=0;Ka&&bi&&du(),pe=e;var s=0;null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1)):(Ws=Xs.push(new Xl(e)),Xs[Ws-1].setfileindex(Ws-1),Xs[Ws-1].bSopenSilent=!0);var n=mo(Xs[Ws-1].OriginalURL),o=e.getElementsByTagName("Layout");for(t=0;t<o.length;t++){var l=o[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Xs[Ws-1].addlayout(l);var c=o[t].getElementsByTagName("Page");for(a=0;a<c.length;a++)0==a&&0==t?(i=new _l(c[a],l,!0,n,a,Xs[Ws-1]),Xs[Ws-1].addthumbnail(new Gl(c[a],l,Xs[Ws-1],a)),Xs[Ws-1].addpage(i,!0)):(i=new _l(c[a],l,!1,"",a+s,Xs[Ws-1]),Xs[Ws-1].addthumbnail(new Gl(c[a],l,Xs[Ws-1],a+s)),Xs[Ws-1].addpage(i,!1));s+=a}if(null!=Xs[Ws-1]){Xs[Ws-1].FileName=r,null!=st&&st.setThumbnails(Xs[Ws-1].thumbnails);var h={iscompare:$a,numOpenFiles:Xs.length,isPDF:Xs[Ws-1].pages[Xs[Ws-1].currentpage].usepdfjs,is3D:Xs[Ws-1].pages[Xs[Ws-1].currentpage].usevector3Dxml,markupOn3D:!1,is2D:Xs[Ws-1].pages[Xs[Ws-1].currentpage].usevectorxml,numpages:Xs[Ws-1].pages.length,currentpage:Xs[Ws-1].getcurPage(),activefile:!1};null!=Gt&&Gt.setGUIState(h);var u={numpages:Xs[Ws-1].pages.length,currentpage:Xs[Ws-1].getcurPage()};null!=Ht&&Ht.pageEvent(u)}})).catch((function(e){Eh("getFileNotActive",e)}))}}function oc(e){e.setnummarkupfiles(Jr.length);for(var t=0;t<Jr.length;t++)Jr.length,fc(Jr[t],e);al(n),e.markuploaded=!0,0==markupfilepathobj.length&&null!=Et&&Et.setMarkupList(e.getmarkuplist(),e.bActive),Wr=!1}function lc(e,t){var a=U;Q&&(a=ae);var i=go(t.CacheFileName),r='<?xml version="1.0" encoding="UTF-8"?>';r+="<RxViewServer>",r+="<Command>GetMarkupByRef</Command>",r+="<LicenseID>"+_i+"</LicenseID>",r+="<FileURL>"+e+i+"</FileURL>",r+="<MARKUP_INFO>";for(var s=0;s<Jr.length;s++)r+="<MARKUP_URL>"+Jr[s]+"</MARKUP_URL>";r+="</MARKUP_INFO>",Jc("POST",p,r+="</RxViewServer>").then((function(e){var i=0,r=0,s=e.getElementsByTagName("File");for(t.setnummarkupfiles(s.length),r=0;r<s.length;r++)i=s[r].firstChild.nodeValue,i=a+i,s.length,fc(i,t);al(n),t.markuploaded=!0,0==s.length&&null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive),zr=!1})).catch((function(e){e.status?404==e.status?console.log("getMarkupbyReference error 404"):503==e.status?console.log("getMarkupbyReference error 503"):501==e.status&&console.log("getMarkupbyReference error 501"):console.log(e)}))}function cc(e,t){go(t.FileName);var a='<?xml version="1.0" encoding="UTF-8"?>';a+="<RxViewServer>",a+="<Command>GetMarkup</Command>",a+="<LicenseID>"+_i+"</LicenseID>",a+="<FileURL>"+e+"</FileURL>",Jc("POST",m,a+="</RxViewServer>").then((function(e){var a=0,i=0;try{var r=e.getElementsByTagName("readonlymarkup")[0].firstChild.nodeValue}catch(e){r=""}ws||(ws=""!=r&&"True"==r);var s=e.getElementsByTagName("File");for(t.setnummarkupfiles(s.length),t.pages[0].usevector3DGLTF&&t.pages[0].Vector3DPageObj&&t.pages[0].Vector3DPageObj.load3Dmarkupcheck(),i=0;i<s.length;i++)a=s[i].firstChild.nodeValue,a=Q?ae+a:G+a,t.pages[0].usevector3DGLTF,fc(a,t);al(n),t.markuploaded=!0,0==s.length&&(null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive),null!=Je&&Je.loadComplete(t.markuplist,t.fileindex,t.bActive))})).catch((function(e){e.status?404==e.status?console.log("getMarkupFilelist error 404"):503==e.status?console.log("getMarkupFilelist error 503"):501==e.status&&console.log("getMarkupFilelist error 501"):console.log(e)}))}function hc(e){localStorage.clear(),Tc(_i),uc(e,!1)}function uc(e,t){if("undefined"!=typeof Storage){if(t){var a=e.markupnumber;if(null!=localStorage.getItem("MarkupPostfixlist")){var i=localStorage.MarkupPostfixlist;localStorage.setItem("MarkupPostfixlist",i+","+a)}else localStorage.setItem("MarkupPostfixlist",a)}else a="";localStorage.setItem("Type"+a,e.type),localStorage.setItem("Subtype"+a,e.subtype),localStorage.setItem("Alternative"+a,e.alternative),localStorage.setItem("Redaction"+a,e.bRedact?1:0),localStorage.setItem("Rotation"+a,e.rotation),localStorage.setItem("fillcolor"+a,e.fillcolor),localStorage.setItem("strokecolor"+a,e.strokecolor),localStorage.setItem("textcolor"+a,e.textcolor),localStorage.setItem("markercolor"+a,e.markercolor),localStorage.setItem("Color"+a,e.color),localStorage.setItem("FontName"+a,e.font.fontName),localStorage.setItem("FontHeight"+a,e.font.height),localStorage.setItem("bold"+a,e.font.bold?1:0),localStorage.setItem("italic"+a,e.font.italic?1:0),localStorage.setItem("Transparency"+a,e.transparency),null!=e.leaderoffset&&localStorage.setItem("LeaderOffset"+a,e.leaderoffset),null!=e.labeloffsetx&&localStorage.setItem("LabelOffsetX"+a,e.labeloffsetx),null!=e.labeloffsety&&localStorage.setItem("LabelOffsetY"+a,e.labeloffsety),null!=e.arrowlength&&localStorage.setItem("Arrowlength"+a,e.arrowlength),""==e.text?localStorage.setItem("Text"+a,""):localStorage.setItem("Text"+a,e.text),""==localStorage.DimText?localStorage.setItem("DimText"+a,""):localStorage.setItem("DimText"+a,e.dimtext),localStorage.setItem("TextWidth"+a,e.textwidth),12==e.type&&localStorage.setItem("Stampsmalltheight"+a,e.stampsmalltheight),11==e.type&&localStorage.setItem("image"+a,e.image.src),localStorage.setItem("Scaling"+a,e.scaling),localStorage.setItem("Xoffset"+a,e.xoffset),localStorage.setItem("Yoffset"+a,e.yoffset),localStorage.setItem("Pageheight"+a,e.pageheight),localStorage.setItem("Pagewidth"+a,e.pagewidth),localStorage.setItem("LineWidth"+a,e.linewidth),localStorage.setItem("OuterRadius"+a,e.outerRadius),localStorage.setItem("InnerRadius"+a,e.innerRadius),e.points.length>0&&localStorage.setItem("Points"+a,JSON.stringify(e.points)),e.pointlist.length>0&&localStorage.setItem("Pointlist"+a,JSON.stringify(e.pointlist)),e.sides.length>0&&localStorage.setItem("Sides"+a,JSON.stringify(e.sides)),e.countshapes.length>0&&localStorage.setItem("Countshapes"+a,JSON.stringify(e.countshapes)),localStorage.setItem("Rect"+a,"x="+e.x+" y="+e.y+" w="+e.w+" h="+e.h)}}function dc(e,t){var a={type:5,data:e.image,index:t,width:e.width,height:e.height};null!=jt&&jt.onStampReceived(a)}function pc(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetGUID</Command>",t+="<LicenseID>"+_i+"</LicenseID>",Kc("POST",p,"",t+="</RxViewServer>").then((function(t){var a=t;e.setUniqueID(a)})).catch((function(e){e.status?console.log(e.status):console.log(e)}))}function gc(e,t){t.getCurrentpage()&&t.getCurrentpage().Vector3DPageObj&&Kc("GET",e,"").then((function(e){var a=JSON.parse(e);t.getCurrentpage().Vector3DPageObj.addCameraViews(a)})).catch((function(e){e.status||console.log(e)}))}function mc(e,t){t.getCurrentpage()&&t.getCurrentpage().Vector3DPageObj&&t.getCurrentpage().Vector3DPageObj.markupLoad(e)}function fc(e,t){Jc("GET",e).then((function(a){var i=0;t.setmarkupfilesreceived();var r=t.getmarkupfilesreceived(),s=t.getnummarkupfiles();if(null!=a.getElementsByTagName("FileVersion")&&0!=a.getElementsByTagName("FileVersion").length)var o=a.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=a.getElementsByTagName("Format")&&0!=a.getElementsByTagName("Format").length){a.getElementsByTagName("Format")[0].firstChild.nodeValue;var l=uo(e);if(null!=a.getElementsByTagName("Markup3D")&&0!=a.getElementsByTagName("Markup3D").length){var c=a.getElementsByTagName("Markup3D")[0].firstChild.nodeValue;mc(c=l+c,t)}if(null!=a.getElementsByTagName("Views3D")&&0!=a.getElementsByTagName("Views3D").length){var h=a.getElementsByTagName("Views3D")[0].firstChild.nodeValue;gc(h=l+h,t)}}if(null!=a.getElementsByTagName("User")&&0!=a.getElementsByTagName("User").length){var u=a.getElementsByTagName("User");for(i=0;i<u.length;i++){var d=u[i].getElementsByTagName("Name")[0].firstChild.nodeValue,p=u[i].getElementsByTagName("ID")[0].firstChild.nodeValue;if(null!=u[i].getElementsByTagName("Layer")[0])var g=u[i].getElementsByTagName("Layer")[0].firstChild.nodeValue;else g=rs;if(null!=u[i].getElementsByTagName("Color")[0])var m=u[i].getElementsByTagName("Color")[0].firstChild.nodeValue;else m=ss;es[0].Signature==p||es.push(new Dn(p,d,g,m,!1))}}else if(a.getElementsByTagName("Name").length>0){var f=a.getElementsByTagName("Name");es[0].Signature!=f[0].firstChild.nodeValue&&es.push(new Dn(f[0].firstChild.nodeValue,f[0].firstChild.nodeValue,rs,ss,!1))}if(a.getElementsByTagName("Entity").length>0){var y=a.getElementsByTagName("Entity");for(i=0;i<y.length;i++){var v=y[i].getElementsByTagName("Type")[0].firstChild.nodeValue,b=y[i].getElementsByTagName("Subtype")[0].firstChild.nodeValue,x=y[i].getElementsByTagName("Alternative")[0].firstChild.nodeValue,w=y[i].getAttribute("ID")?y[i].getAttribute("ID"):null;if(null!=y[i].getElementsByTagName("View")[0])var k=parseInt(y[i].getElementsByTagName("View")[0].firstChild.nodeValue);else k=0;for(var D=[197,186],C=0;C<D.length;C++);var P=9==v&&2==b;if(null!=y[i].getElementsByTagName("HaveLeader")[0])var S=1==parseInt(y[i].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(S||P){if(null==y[i].getElementsByTagName("Entity")[0])continue;var R=y[i].getElementsByTagName("Entity")[0],M=R.getElementsByTagName("Type")[0].firstChild.nodeValue,T=R.getElementsByTagName("Subtype")[0].firstChild.nodeValue,E=R.getElementsByTagName("Alternative")[0].firstChild.nodeValue;R.getAttribute("ID")&&R.getAttribute("ID"),M=parseInt(M),T=parseInt(T),E=parseInt(E);var F=new Fo(M,T,E),I=F.SetfromXML(t,R,o);I&&(y[i].removeChild(R),F.savemetolistLoad(t,!1))}v=parseInt(v),b=parseInt(b),x=parseInt(x);var j=new Fo(v,b,x);if(j.markupID=w,j.SetfromXML(t,y[i],o)){I&&S&&null!=F&&(j.bhasArrow=S,j.markupArrowConnected=F,F.bisTextArrow=!0,F.textBoxConnected=j,F.setArrowPoint(j),I=!1,S=!1,al(n));var O=i==y.length-1&&s==r;j.savemetolistLoad(t,O)}else console.log("adding markup failed ",k)}j&&j.notify(),0==y.length&&null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive),null!=Ce&&Ce.setUserlist(es,t.bActive),al(n)}else s==r&&(al(n),null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive))})).catch((function(e){e.status?console.log("getMarkup",e.status):console.log(e)}))}function yc(e,t,a,i){var r=e.ownerDocument.createElement(t);r.setAttribute(i.name,i.value),r.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(r)}function vc(e,t,a){var i=e.ownerDocument.createElement(t);i.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(i)}function bc(e,t,a,i,r){(new Date).getTime();var s=1,n=1,o=1,l={operation:null,Entity:{ID:e.markupnumber,Image:null,UniqueID:null,Imagehref:null,SvgContent:null,Type:null,Subtype:null,Alternative:null,Redaction:null,Layer:null,Rotation:null,TextRotation:null,PageRotation:null,FileName:null,Layout:null,View:null,ViewName3D:null,For3DView:null,PageHeight3D:null,PageWidth3D:null,ViewName:null,Handle:null,FillColor:null,LineColor:null,TextColor:null,Transparency:null,Consolidated:null,HaveLink:null,HaveLeader:null,LeaderReference:null,Entity:null,FixedScale:null,LineStyleScale:null,LinkURL:null,Font:null,Text:null,Status:null,SmallText:null,DimText:null,CustomLabelOn:null,CustomLabelText:null,TextWidth:null,Signature:null,Name:null,TimeStamp:null,Scaling:null,Printscale:null,Xoffset:null,Yoffset:null,LineWidth:null,LineWidthSegment:null,ArrowSize:null,LineStyle:null,MainImageScaling:null,MainImageOffsetX:null,MainImageOffsetY:null,DocScale:null,DocOffsetX:null,DocOffsetY:null,Points:{Point:[]},Line:[],Holes:[],outerRadius:null,innerRadius:null,LeaderLineOffset:null,LabelOffsetX:null,LabelOffsetY:null,LabelColor:null,Rect:null,Extended:[],Comments:[]}};if(0!=e.markupID&&null!=e.markupID||(e.markupID=e.markupnumber),r&&(l.operation=r),null!=e&&!e.pdfannotproxy){var c=null;i||e.bisTextArrow&&null!=e.textBoxConnected&&(c=JSON.parse(bc(e,t,a,!0)),e=e.textBoxConnected);var h=e.pagenumber,u=t.getThumb(h),d=null!=a,p=e.viewname,g=e.isdrawn();if(d){if(a.usepdfjs||a.usevectorxml?s=e.scaling:o=e.scaling,1==(n=a.fixedScale))if(0==a.pdfpageheight&&0==a.pdfpagewidth);else{var m=we/a.pdfpageheight,f=xe/a.pdfpagewidth;n=Math.min(f,m)}isFinite(s)||(s=1),isFinite(n)||(n=1),0==s&&(s=1),isNaN(s)&&(s=1),null==n&&(n=1),isNaN(n)&&(n=1),0==n&&(n=1);var y=3==e.type&&4==e.subtype;l.Entity.ID=e.markupnumber,11!=e.type&&20!=e.type||(l.Entity.Image={image:yn(e.image),type:"png",encoding:"base64"},12==e.subtype&&e.svgContent&&(l.Entity.SvgContent=e.svgContent)),l.Entity.UniqueID=e.uniqueID,11!=e.type&&20!=e.type||""==e.imagehref||(l.Entity.Imagehref=e.imagehref),l.Entity.Type=e.type,l.Entity.Subtype=e.subtype,l.Entity.Alternative=e.alternative,l.Entity.Redaction=e.bRedact?1:0,l.Entity.Layer=e.layer,l.Entity.Rotation=e.rotation,l.Entity.TextRotation=e.textrotate,l.Entity.PageRotation=e.pagerotation,l.Entity.FileName=e.documentName,l.Entity.Layout=a.LayoutName,l.Entity.View=h,null!=p&&(l.Entity.ViewName3D=p,l.Entity.For3DView=e.bfor3D?1:0,l.Entity.PageHeight3D=e.pageheight,l.Entity.PageWidth3D=e.pagewidth),l.Entity.ViewName=u.PageName,l.Entity.Handle=e.bfor3D?1:0,l.Entity.FillColor=e.fillcolor,l.Entity.LineColor=y?e.fillcolor:e.strokecolor,l.Entity.TextColor=e.textcolor,l.Entity.Transparency=e.transparency,l.Entity.Consolidated=e.consolidated?1:0,l.Entity.HaveLink=e.bhaveLink?1:0,l.Entity.HaveLeader=e.bhasArrow?1:0,e.bhasArrow&&null!=e.markupArrowConnected&&(l.Entity.LeaderReference=e.markupArrowConnected.markupnumber,null!=c||(c=JSON.parse(bc(e.markupArrowConnected,t,a,!0,r))),l.Entity.Entity=c);var v=null;if(e.holes.length>0)for(var b=0;b<e.holes.length;b++)v=JSON.parse(bc(e.holes[b],t,a,!1)),l.Entity.Holes.push(v);l.Entity.FixedScale=ui?1:0,l.Entity.LineStyleScale=n,l.Entity.LinkURL=e.linkURL;var x={Font:{facename:null,height:null,bold:null,italic:null}};x.Font.facename=e.font.fontName,g?a.usepdfjs||a.usevectorxml?12!=e.type?x.Font.height=ui?e.font.height/n:e.font.height/s:x.Font.height=e.font.height/s:12!=e.type?x.Font.height=ui?e.font.height/n:e.font.height/o:x.Font.height=e.font.height/o:x.Font.height=e.font.height,x.Font.bold=e.font.bold?1:0,x.Font.bold=e.font.italic?1:0,l.Entity.Font=x;var w=Pn(e.signature);l.Entity.Text=""==e.text?".":e.text,l.Entity.SmallText=""==e.smalltext?".":e.smalltext,l.Entity.DimText=""==e.dimtext?".":e.dimtext,l.Entity.Status=e.status,l.Entity.CustomLabelOn=e.busecustomlabel?1:0,l.Entity.CustomLabelText=e.signature,l.Entity.TextWidth=e.textwidth,l.Entity.Signature=e.signature,l.Entity.Name=w,l.Entity.TimeStamp=e.timestamp,isFinite(e.scaling)||(e.scaling=1),0==e.scaling&&(e.scaling=1),isNaN(e.scaling)&&(e.scaling=1),l.Entity.Scaling=e.scaling,l.Entity.Printscale=e.printscale;var k=isFinite(e.xoffset),D=isFinite(e.yoffset);k||(e.xoffset=0),D||(e.yoffset=0),isNaN(e.xoffset)&&(e.xoffset=0),isNaN(e.yoffset)&&(e.yoffset=0),g&&(a.usepdfjs||a.usevectorxml)?(l.Entity.Xoffset=e.xoffset/s,l.Entity.Yoffset=e.yoffset/s):(l.Entity.Xoffset=e.xoffset,l.Entity.Yoffset=e.yoffset);var C=e.linewidth,P=e.linewidthSegment;if(g)if(a.usepdfjs||a.usevectorxml)if(y)l.Entity.LineWidth=1;else if(ui){var S=C/n,R=P/n;l.Entity.LineWidth=S,l.Entity.LineWidthSegment=R}else l.Entity.LineWidth=C/s,l.Entity.LineWidthSegment=P/s;else y?l.Entity.LineWidth=1:ui?(S=C/n,R=P/n,l.Entity.LineWidth=S,l.Entity.LineWidthSegment=R):(l.Entity.LineWidth=C/o,l.Entity.LineWidthSegment=P/o);var M=e.arrowlength-e.linewidth;if(l.Entity.ArrowSize=M,l.Entity.LineStyle=e.linestyle,l.Entity.MainImageScaling=a.MainImageScaling,l.Entity.MainImageOffsetX=a.MainImageOffsetX,l.Entity.MainImageOffsetY=a.MainImageOffsetY,l.Entity.DocScale=e.docdscale,l.Entity.DocOffsetX=e.docdx,l.Entity.DocOffsetY=e.docdy,g){var T=1==e.type&&6==e.subtype;if(0==e.type||T){if(0!=e.pointlist.length){l.Entity.Line=[];for(var E=0;E<e.pointlist.length;E++)for(l.Entity.Line.push({Point:[]}),F=0;F<e.pointlist[E].length;F++)a.usepdfjs||a.usevectorxml?(I=(e.pointlist[E][F].x-e.xoffset)/s,j=(e.pointlist[E][F].y-e.yoffset)/s,l.Entity.Line[E].Point.push({x:I,y:j})):(I=(e.pointlist[E][F].x-e.xoffset)/o,j=(e.pointlist[E][F].y-e.yoffset)/o,l.Entity.Line[E].Point.push({x:I,y:j}))}}else if(-1!=e.points.length)for(var F=0;F<e.points.length;F++)if(a.usepdfjs||a.usevectorxml){var I=(e.points[F].x-e.xoffset)/s,j=(e.points[F].y-e.yoffset)/s;l.Entity.Points.Point.push({x:I,y:j})}else I=(e.points[F].x-e.xoffset)/o,j=(e.points[F].y-e.yoffset)/o,l.Entity.Points.Point.push({x:I,y:j})}else if(0!=e.type){if(-1!=e.points.length)for(F=0;F<e.points.length;F++)l.Entity.Points.Point.push({x:e.points[F].x,y:e.points[F].y})}else if(0!=e.pointlist.length)for(l.Entity.Line=[],E=0;E<e.pointlist.length;E++)for(l.Entity.Line.push({Point:[]}),F=0;F<e.pointlist[E].length;F++)l.Entity.Line[F].Point.push({x:e.pointlist[E][F].x,y:e.pointlist[E][F].y});if(g){if(13==e.type&&-1!=e.countshapes.length){var O=e.outerRadius,L=e.innerRadius;if(a.usepdfjs||a.usevectorxml)if(ui){var V=O/n,N=L/n;l.Entity.outerRadius=V,l.Entity.innerRadius=N}else l.Entity.outerRadius=O/s,l.Entity.innerRadius=L/s;else ui?(V=O/n,N=L/n,l.Entity.outerRadius=V,l.Entity.innerRadius=N):(l.Entity.outerRadius=O/o,l.Entity.innerRadius=L/o);for(F=0;F<e.countshapes.length;F++)a.usepdfjs||a.usevectorxml?(I=(e.countshapes[F].x-e.xoffset)/s,j=(e.countshapes[F].y-e.yoffset)/s,l.Entity.Points.Point.push({x:I,y:j})):(I=(e.countshapes[F].x-e.xoffset)/o,j=(e.countshapes[F].y-e.yoffset)/o,l.Entity.Points.Point.push({x:I,y:j}))}}else if(13==e.type&&-1!=e.countshapes.length)for(O=e.outerRadius,L=e.innerRadius,l.Entity.outerRadius=O,l.Entity.innerRadius=L,F=0;F<e.countshapes.length;F++)l.Entity.Points.Point.push({x:e.countshapes[F].x,y:e.countshapes[F].y});7==e.type&&(g&&(a.usepdfjs||a.usevectorxml)?l.Entity.LeaderLineOffset=e.leaderoffset/s:l.Entity.LeaderLineOffset=e.leaderoffset),8==e.type&&(g&&(a.usepdfjs||a.usevectorxml)?(l.Entity.LabelOffsetX=e.labeloffsetx/s,l.Entity.LabelOffsetY=e.labeloffsety/s):(l.Entity.LabelOffsetX=e.labeloffsetx,l.Entity.LabelOffsetY=e.labeloffsety),l.Entity.LabelColor=e.labelfillcolor);var A=isFinite(e.x),B=isFinite(e.y),U=isFinite(e.w),G=isFinite(e.h);if(A||(e.x=0),B||(e.y=0),U||(e.w=100),G||(e.h=100),isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.w)&&(e.w=100),isNaN(e.h)&&(e.h=100),g)if(a.usepdfjs||a.usevectorxml){var H=(e.x-e.xoffset)/s,z=(e.y-e.yoffset)/s,W=4==e.type&&e.subtype;if(0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||W)var _=(e.w-e.xoffset)/s,X=(e.h-e.yoffset)/s;else 9==e.type&&0==e.subtype?(_=e.w/s,X=e.textheight/s):10==e.type&&ui?(_=e.w/n,X=e.h/n):(_=e.w/s,X=e.h/s);var Y=isFinite(H),q=isFinite(z),Z=isFinite(_),J=isFinite(X);Y||(H=0),q||(z=0),Z||(_=100),J||(X=100),isNaN(H)&&(H=0),isNaN(z)&&(z=0),isNaN(_)&&(_=100),isNaN(X)&&(X=100),l.Entity.Rect={x:H,y:z,w:_,h:X}}else H=(e.x-e.xoffset)/o,z=(e.y-e.yoffset)/o,W=4==e.type&&e.subtype,0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||W?(_=(e.w-e.xoffset)/o,X=(e.h-e.yoffset)/o):9==e.type&&0==e.subtype?(_=e.w/o,X=e.textheight/o):10==e.type&&ui?(_=e.w/n,X=e.h/n):(_=e.w/o,X=e.h/o),(Y=isFinite(H))||(H=0),(q=isFinite(z))||(z=0),(Z=isFinite(_))||(_=100),(J=isFinite(X))||(X=100),isNaN(H)&&(H=0),isNaN(z)&&(z=0),isNaN(_)&&(_=100),isNaN(X)&&(X=100),l.Entity.Rect={x:H,y:z,w:_,h:X};else l.Entity.Rect={x:e.x,y:e.y,w:e.w,h:e.h};if(e.customattributes.length>0)for(var K={tagname:null,tagvalue:null},Q=0;Q<e.customattributes.length;Q++){var $=e.customattributes[Q].name,ee=e.customattributes[Q].value;K.tagname=$,K.tagvalue=ee,l.Entity.Extended.push(K)}if(e.comments.length>0){var te={id:null,signature:null,value:null};for(Q=0;Q<e.comments.length;Q++)te.id=e.comments[Q].id,te.signature=e.comments[Q].signature,te.value=e.comments[Q].value,l.Entity.Comments.push(te)}}}return JSON.stringify(l)}function xc(e,t,a,i,r){(new Date).getTime();var s=1,n=1,o=1,l=1,c=void 0;if(null!=e){var h=null;r||e.bisTextArrow&&null!=e.textBoxConnected&&(h=xc(e,t,a,i,!0),e=e.textBoxConnected);var u=e.pagenumber,d=t.getThumb(u),p=null!=i,g=e.viewname,m=e.isdrawn();if(p){if(i.usepdfjs||i.usevectorxml?s=e.scaling:o=e.scaling,n=i.fixedScale,l=i.MainImageScaling,1==n)if(0==i.pdfpageheight&&0==i.pdfpagewidth);else{var f=we/i.pdfpageheight,y=xe/i.pdfpagewidth;n=Math.min(y,f)}isFinite(s)||(s=1),isFinite(n)||(n=1),0==s&&(s=1),isNaN(s)&&(s=1),null==n&&(n=1),isNaN(n)&&(n=1),0==n&&(n=1);var v=3==e.type&&4==e.subtype;if((c=a.createElement("Entity")).setAttribute("ID",e.markupnumber),11==e.type){var b=function(e,t,a){var i=e.ownerDocument.createElement(t);return i.appendChild(e.ownerDocument.createTextNode(a)),e.appendChild(i),i}(c,"Image",yn(e.image));b.setAttribute("type","png"),b.setAttribute("encoding","base64")}vc(c,"UniqueID",e.uniqueID),11==e.type&&""!=e.imagehref&&vc(c,"Imagehref",e.imagehref),vc(c,"Type",e.type),vc(c,"Subtype",e.subtype),vc(c,"Alternative",e.alternative),vc(c,"Redaction",e.bRedact?1:0),vc(c,"Layer",e.layer),vc(c,"Rotation",e.rotation),vc(c,"TextRotation",e.textrotate),vc(c,"PageRotation",e.pagerotation),vc(c,"FileName",e.documentName),vc(c,"Layout",i.LayoutName),vc(c,"View",u),null!=g&&(vc(c,"ViewName3D",g),vc(c,"For3DView",e.bfor3D?1:0),vc(c,"PageHeight3D",e.pageheight),vc(c,"PageWidth3D",e.pagewidth)),vc(c,"ViewName",d.PageName),vc(c,"Handle",e.markupnumber),vc(c,"FillColor",e.fillcolor),vc(c,"LineColor",v?e.fillcolor:e.strokecolor),vc(c,"TextColor",e.textcolor),vc(c,"Transparency",e.transparency),vc(c,"Consolidated",e.consolidated?1:0),vc(c,"HaveLink",e.bhaveLink?1:0),vc(c,"HaveLeader",e.bhasArrow?1:0),e.bhasArrow&&null!=e.markupArrowConnected&&(vc(c,"LeaderReference",e.markupArrowConnected.markupnumber),null!=h&&c.appendChild(h)),vc(c,"FixedScale",ui?1:0),vc(c,"LineStyleScale",n),vc(c,"LinkURL",e.linkURL);var x=a.createElement("Font");x.setAttribute("facename",e.font.fontName),m?i.usepdfjs||i.usevectorxml?12!=e.type&&ui?x.setAttribute("height",e.font.height/n):x.setAttribute("height",e.font.height/s):12!=e.type&&ui?x.setAttribute("height",e.font.height/n):x.setAttribute("height",e.font.height/o/l):x.setAttribute("height",e.font.height),x.setAttribute("bold",e.font.bold?1:0),x.setAttribute("italic",e.font.italic?1:0),c.appendChild(x),vc(c,"Text",""==e.text?".":e.text),vc(c,"SmallText",""==e.smalltext?".":e.smalltext),vc(c,"DimText",""==e.dimtext?".":e.dimtext),vc(c,"CustomLabelOn",e.busecustomlabel?1:0),vc(c,"CustomLabelText",""==e.customlabeltext?".":e.customlabeltext),vc(c,"TextWidth",e.textwidth),vc(c,"Signature",e.signature),vc(c,"Name",Pn(e.signature)),vc(c,"TimeStamp",e.timestamp),isFinite(e.scaling)||(e.scaling=1),0==e.scaling&&(e.scaling=1),isNaN(e.scaling)&&(e.scaling=1),vc(c,"Scaling",e.scaling),vc(c,"Printscale",e.printscale);var w=isFinite(e.xoffset),k=isFinite(e.yoffset);w||(e.xoffset=0),k||(e.yoffset=0),isNaN(e.xoffset)&&(e.xoffset=0),isNaN(e.yoffset)&&(e.yoffset=0),m&&(i.usepdfjs||i.usevectorxml)?(vc(c,"Xoffset",e.xoffset/s),vc(c,"Yoffset",e.yoffset/s)):(vc(c,"Xoffset",e.xoffset),vc(c,"Yoffset",e.yoffset));var D=e.linewidth,C=e.linewidthSegment;if(m)if(i.usepdfjs||i.usevectorxml)if(v)vc(c,"LineWidth",1);else if(ui){var P=D/n,S=C/n;vc(c,"LineWidth",P),vc(c,"LineWidthSegment",S)}else vc(c,"LineWidth",D/s),vc(c,"LineWidthSegment",C/s);else v?vc(c,"LineWidth",1):ui?(S=C/n,vc(c,"LineWidth",P=D/n),vc(c,"LineWidthSegment",S)):(vc(c,"LineWidth",D/o/l),vc(c,"LineWidthSegment",C/o/l));else vc(c,"LineWidth",D),vc(c,"LineWidthSegment",C);vc(c,"ArrowSize",e.arrowlength-e.linewidth),vc(c,"LineStyle",e.linestyle),vc(c,"MainImageScaling",i.MainImageScaling),vc(c,"MainImageOffsetX",i.MainImageOffsetX),vc(c,"MainImageOffsetY",i.MainImageOffsetY),vc(c,"DocScale",e.docdscale),vc(c,"DocOffsetX",e.docdx),vc(c,"DocOffsetY",e.docdy),vc(c,"HasScale",e.hasScale);var R=i.scaleObject;if(e.hasScale&&(R=e.scaleObject),vc(c,"Measurescale",R.measurescale),vc(c,"ScaleLabel",R.scaleLabel),vc(c,"Unitofmeasure",R.Unitofmeasure),vc(c,"SubmeasureUnit",R.SubmeasureUnit),vc(c,"Unitlabel",R.Unitlabel),vc(c,"AreaUnitlabel",R.AreaUnitlabel),vc(c,"Unitscale",R.unitscale),vc(c,"ScaleValue",R.scaleValue),vc(c,"Ndimprecision",R.ndimprecision),m){var M=1==e.type&&6==e.subtype;if(0==e.type||M){if(0!=e.pointlist.length)for(var T=0;T<e.pointlist.length;T++){var E=a.createElement("Line");for(I=0;I<e.pointlist[T].length;I++)j=a.createElement("Point"),i.usepdfjs||i.usevectorxml?(O=(e.pointlist[T][I].x-e.xoffset)/s,L=(e.pointlist[T][I].y-e.yoffset)/s,j.setAttribute("x",O),j.setAttribute("y",L)):(O=(e.pointlist[T][I].x-e.xoffset)/o/l,L=(e.pointlist[T][I].y-e.yoffset)/o/l,j.setAttribute("x",O),j.setAttribute("y",L)),E.appendChild(j);c.appendChild(E)}}else if(-1!=e.points.length){for(var F=a.createElement("Points"),I=0;I<e.points.length;I++){var j=a.createElement("Point");if(i.usepdfjs||i.usevectorxml){var O=(e.points[I].x-e.xoffset)/s,L=(e.points[I].y-e.yoffset)/s;j.setAttribute("x",O),j.setAttribute("y",L)}else O=(e.points[I].x-e.xoffset)/o/l,L=(e.points[I].y-e.yoffset)/o/l,j.setAttribute("x",O),j.setAttribute("y",L);F.appendChild(j)}c.appendChild(F)}}else if(0!=e.type){if(-1!=e.points.length){for(F=a.createElement("Points"),I=0;I<e.points.length;I++)(j=a.createElement("Point")).setAttribute("x",e.points[I].x),j.setAttribute("y",e.points[I].y),F.appendChild(j);c.appendChild(F)}}else if(0!=e.pointlist.length)for(T=0;T<e.pointlist.length;T++){for(E=a.createElement("Line"),I=0;I<e.pointlist[T].length;I++)(j=a.createElement("Point")).setAttribute("x",e.pointlist[T][I].x),j.setAttribute("y",e.pointlist[T][I].y),E.appendChild(j);c.appendChild(E)}if(m){if(13==e.type&&-1!=e.countshapes.length){var V=e.outerRadius,N=e.innerRadius;if(i.usepdfjs||i.usevectorxml)if(ui){var A=V/n,B=N/n;vc(c,"outerRadius",A),vc(c,"innerRadius",B)}else vc(c,"outerRadius",V/s),vc(c,"innerRadius",N/s);else ui?(B=N/n,vc(c,"outerRadius",A=V/n),vc(c,"innerRadius",B)):(vc(c,"outerRadius",V/o/l),vc(c,"innerRadius",N/o/l));for(I=0;I<e.countshapes.length;I++)j=a.createElement("Point"),i.usepdfjs||i.usevectorxml?(O=(e.countshapes[I].x-e.xoffset)/s,L=(e.countshapes[I].y-e.yoffset)/s,j.setAttribute("x",O),j.setAttribute("y",L)):(O=(e.countshapes[I].x-e.xoffset)/o/l,L=(e.countshapes[I].y-e.yoffset)/o/l,j.setAttribute("x",O),j.setAttribute("y",L)),F.appendChild(j);c.appendChild(F)}}else if(13==e.type&&-1!=e.countshapes.length){for(V=e.outerRadius,N=e.innerRadius,vc(c,"outerRadius",V),vc(c,"innerRadius",N),I=0;I<e.countshapes.length;I++)(j=a.createElement("Point")).setAttribute("x",e.countshapes[I].x),j.setAttribute("y",e.countshapes[I].y),F.appendChild(j);c.appendChild(F)}7==e.type&&(m&&(i.usepdfjs||i.usevectorxml)?vc(c,"LeaderLineOffset",e.leaderoffset/s):vc(c,"LeaderLineOffset",e.leaderoffset)),8==e.type&&(m&&(i.usepdfjs||i.usevectorxml)?(vc(c,"LabelOffsetX",e.labeloffsetx/s),vc(c,"LabelOffsetY",e.labeloffsety/s)):(vc(c,"LabelOffsetX",e.labeloffsetx),vc(c,"LabelOffsetY",e.labeloffsety)),vc(c,"LabelColor",e.labelfillcolor));var U=a.createElement("Rect"),G=isFinite(e.x),H=isFinite(e.y),z=isFinite(e.w),W=isFinite(e.h);if(G||(e.x=0),H||(e.y=0),z||(e.w=100),W||(e.h=100),isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.w)&&(e.w=100),isNaN(e.h)&&(e.h=100),m)if(i.usepdfjs||i.usevectorxml){var _=(e.x-e.xoffset)/s,X=(e.y-e.yoffset)/s,Y=4==e.type&&e.subtype;if(0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||Y)var q=(e.w-e.xoffset)/s,Z=(e.h-e.yoffset)/s;else 9==e.type&&0==e.subtype?(q=e.w/s,Z=e.textheight/s):10==e.type&&ui?(q=e.w/n,Z=e.h/n):(q=e.w/s,Z=e.h/s);var J=isFinite(_),K=isFinite(X),Q=isFinite(q),$=isFinite(Z);J||(_=0),K||(X=0),Q||(q=100),$||(Z=100),isNaN(_)&&(_=0),isNaN(X)&&(X=0),isNaN(q)&&(q=100),isNaN(Z)&&(Z=100),U.setAttribute("x",_),U.setAttribute("y",X),U.setAttribute("w",q),U.setAttribute("h",Z)}else _=(e.x-e.xoffset)/o/l,X=(e.y-e.yoffset)/o/l,Y=4==e.type&&e.subtype,0==e.type||1==e.type||2==e.type||6==e.type||7==e.type||8==e.type||Y?(q=(e.w-e.xoffset)/o/l,Z=(e.h-e.yoffset)/o/l):9==e.type&&0==e.subtype?(q=e.w/o/l,Z=e.textheight/o/l):10==e.type&&ui?(q=e.w/n,Z=e.h/n):(q=e.w/o/l,Z=e.h/o/l),(J=isFinite(_))||(_=0),(K=isFinite(X))||(X=0),(Q=isFinite(q))||(q=100),($=isFinite(Z))||(Z=100),isNaN(_)&&(_=0),isNaN(X)&&(X=0),isNaN(q)&&(q=100),isNaN(Z)&&(Z=100),U.setAttribute("x",_),U.setAttribute("y",X),U.setAttribute("w",q),U.setAttribute("h",Z);else U.setAttribute("x",e.x),U.setAttribute("y",e.y),U.setAttribute("w",e.w),U.setAttribute("h",e.h);if(c.appendChild(U),e.customattributes.length>0){for(var ee=a.createElement("Extended"),te=0;te<e.customattributes.length;te++)vc(ee,ie=e.customattributes[te].name,e.customattributes[te].value);c.appendChild(ee)}if(e.comments.length>0){var ae=a.createElement("Comments");for(te=0;te<e.comments.length;te++){var ie="id_"+e.comments[te].id,re={name:"Signature",value:e.comments[te].signature};yc(ae,ie,e.comments[te].value,re)}c.appendChild(ae)}}}return c}function wc(e,t,a,i,r,s){if(!jh()){var n=[],o=0;if((new Date).getTime(),Bs.markuplist.length>0)for(o=0;o<Bs.markuplist.length;o++)if(null!=Bs.markuplist[o]&&!Bs.markuplist[o].pdfannotproxy){var l=Bs.markuplist[o].pagenumber,c=Bs.getPageObject(l),h=null!=c;if((Bs.markuplist[o].signature==i||a)&&(Bs.markuplist[o].display||e)&&(Bs.markuplist[o].consolidated||!t)){var u=8==Bs.markuplist[o].type&&2==Bs.markuplist[o].subtype;if(h){if(Bs.markuplist[o].bhasArrow&&null!=Bs.markuplist[o].markupArrowConnected);else if(u);else var d=JSON.parse(bc(Bs.markuplist[o],Bs,c,!1));null!=d&&n.push(d)}else null!=s&&s.addpage(l)}}return JSON.stringify(n)}}function kc(e,t,a,i,r,s){if(jh())return;var n=0,o=((new Date).getTime(),'<?xml version="1.0" encoding="UTF-8"?>\n');o+="<RasterexMarkup>\n",o+="<Header>\n",o+="<FileVersion>C370</FileVersion>\n",Bs.getCurrentpage().usepdfjs?o+="<Format>pdfjs</Format>\n":Bs.getCurrentpage().usevectorxml?o+="<Format>vector</Format>\n":Bs.getCurrentpage().usevector3Dxml?(null!=Bs.getCurrentpage().get3DMarkupJSON()&&(o+="<Markup3D>"+Bs.getMarkup3DSavefile()+"</Markup3D>\n"),null!=Bs.getCurrentpage().get3DCamerasJSON()&&(o+="<Views3D>"+Bs.getViews3DSavefile()+"</Views3D>\n"),o+="<Format>3D</Format>\n"):o+="<Format>image</Format>\n",o+="<Scale>1.0000</Scale>\n",o+="<OrigoX>0.0000</OrigoX>\n",o+="<OrigoY>0.0000</OrigoY>\n",o+="<DirectionY>1</DirectionY>\n",o+="<DirectionX>1</DirectionX>\n",o+="</Header>\n",o+="<Users>\n",o+="<User>\n",o+="<ID>"+i+"</ID>\n",o+="<Name>"+r+"</Name>\n",o+="<Color>"+ss+"</Color>\n",o+="<Layer>"+rs+"</Layer>\n",o+="</User>\n",o+="</Users>\n";var l=Jn(o+="<Entities/></RasterexMarkup>\n");if(Bs.markuplist.length>0)for(n=0;n<Bs.markuplist.length;n++)if(null!=Bs.markuplist[n]){var c=Bs.markuplist[n].pagenumber,h=Bs.getPageObject(c),u=null!=h;if((Bs.markuplist[n].signature==i||a)&&(Bs.markuplist[n].display||e)&&(Bs.markuplist[n].consolidated||!t))if(u){if(Bs.markuplist[n].bhasArrow&&null!=Bs.markuplist[n].markupArrowConnected);else var d=xc(Bs.markuplist[n],Bs,l,h,!1);null!=d&&l.getElementsByTagName("Entities")[0].appendChild(d)}else null!=s&&s.addpage(c)}const p=Bs.scalesOptions;if(p.length>0)for(var g=0;g<p.length;g++){var m=l.createElement("ScaleItem");vc(m,"Value",p[g].value),vc(m,"Label",p[g].label),vc(m,"Metric",p[g].metric),vc(m,"MetricUnit",p[g].metricUnit),vc(m,"DimPrecision",p[g].dimPrecision),vc(m,"IsSelected",p[g].isSelected),l.getElementsByTagName("Scales")[0].appendChild(m)}return l}function Dc(e,t,a){(new Date).getTime();var i=Jn('<?xml version="1.0" encoding="UTF-8"?>\n<RasterexMarkup>\n<FileVersion>C366</FileVersion>\n<Entities/></RasterexMarkup>\n');if(null!=e){var r=t.getPageObject(e.pagenumber);if(e.bhasArrow&&null!=e.markupArrowConnected);else{var s=xc(e,t,i,r,!1);null!=s&&i.getElementsByTagName("Entities")[0].appendChild(s)}}return i}function Cc(e,t,a,i){if(null!=Bs&&null!=Bs){var r=po(Bs.OriginalURL);if(vi)var s=e;else s=e+"&"+r+"&"+t;Kc("POST",s,"",i).then((function(e){Ms&&(Bs.markuplist=[],Su(),Pu(),Bs.nummarkups=0,cc("")),Bs&&(Bs.bMarkupchanged=!1,Bs.getdelayedClose()&&(Bs.setdelayedClose(!1),du())),null!=ga&&ga.markupSaved()})).catch((function(e){e.status?console.log("sendMarkupReq",e.status):console.log(e)}))}}function Pc(e,t,a){var i=new Js(Bs);i.setOncomplete((function(a){Cc(e,t,0,a)})),i.createxml(t,a)}function Sc(e,t,a){if(!jh()){if(Bs.getCurrentpage().usevector3Dxml){var i=Bs.getMarkup3DSavefile(),r=Bs.getViews3DSavefile();null==i&&Bs.setMarkup3DSavefile("markup.json"),null==r&&Bs.setViews3DSavefile("views.json");var s=po(Bs.OriginalURL);i=s+Bs.getMarkup3DSavefile(),r=s+Bs.getViews3DSavefile(),function(e,t){var a="";jh()||(Bs.getCurrentpage().usevector3Dxml&&(a=Bs.getCurrentpage().get3DMarkupJSON()),Kc("POST",e+"&"+t,"",a).then((function(e){})).catch((function(e){e.status?console.log("send3DMarkup",e.status):console.log(e)})))}(w,i),function(e,t){var a="";jh()||(Bs.getCurrentpage().usevector3Dxml&&(a=Bs.getCurrentpage().get3DCamerasJSON()),Kc("POST",e+"&"+t,"",a).then((function(e){})).catch((function(e){e.status?console.log("send3DViews",e.status):console.log(e)})))}(w,r)}Cc(e,t,0,kc(!0,!1,!1,t,a))}}function Rc(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetConfiguration</Command>",t+="<LicenseID>"+_i+"</LicenseID>",t+=Is?"<CallingPageUrl>"+H+js+"</CallingPageUrl>":"<CallingPageUrl>"+H+"</CallingPageUrl>",t+="</RxViewServer>",$?Jc("GET",e).then((function(e){dd(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)})):Jc("POST",e,t).then((function(e){dd(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)}))}function Mc(){if("undefined"!=typeof Storage)if(null!=localStorage.getItem("RxLic")){var e=localStorage.getItem("RxLic");localStorage.removeItem("RxLic"),Ic(e,!0)}else Fc()}function Tc(e){"undefined"!=typeof Storage&&localStorage.setItem("RxLic",e)}async function Ec(e){return new Promise((t,a)=>{const i=indexedDB.open("myAppDatabase",1);i.onupgradeneeded=function(t){const a=t.target.result;if(!a.objectStoreNames.contains(e))if("Rxlic"===e)a.createObjectStore(e,{keyPath:"id",autoIncrement:!0}).createIndex("Rxlic","Rxlic",{unique:!1});else if("User"===e){const t=a.createObjectStore(e,{keyPath:"id",autoIncrement:!0});t.createIndex("User","User",{unique:!1}),t.createIndex("UserName","UserName",{unique:!1})}},i.onsuccess=function(e){t(e.target.result)},i.onerror=function(e){a("Database error: "+e.target.errorCode)}})}function Fc(){if(oi)var e=f+"&RxView360&2.0&"+hs+"&"+_a;else e=y+"&RxView360"+Xi+"&2.0&"+hs;if("bypass"==Xi)return _i=50942768,void(ri=!0);Kc("GET",e,"").then((function(e){var t=e.split(":");if("OK"==t[0]){var a=t[1].split(",");Tc(_i=a[0]),ri=!0,ud()}else alert(e)})).catch((function(e){e.status?console.log("GetLicense",e.status):console.log(e)}))}function Ic(e,t){Kc("GET",v+"&"+e,"").then((function(e){ri=!1,t&&Fc()})).catch((function(e){e.status||console.log(e)}))}function jc(){return Wi}function Oc(){return Hi}function Lc(){return zi}function Vc(){return pe}function Nc(){for(var e=!0,t=0;t<Vi.length;t++)Vi[t]||(e=!1);e&&Bi&&(Bi=!1,window.print())}function Ac(e){Ni[e.pagenumber]=document.createElement("img"),Ni[e.pagenumber].src=e.paperimage.toDataURL(),Ni[e.pagenumber].addEventListener("load",(function(t){try{Li[e.pagenumber].drawImage(Ni[e.pagenumber],0,0)}catch(e){console.log(e.message)}Vi[e.pagenumber]=!0,Nc()}),!1)}function Bc(){if(Bi=!0,null!=ce&&null!=bd().docObj){!function(){if(null!=ce){for(;ce.firstChild;)ce.removeChild(ce.lastChild);Li=[],Vi=[],Ni=[],Ai=[]}}();try{zi=bd().getPaperHeight()}catch(e){zi=3480}try{Hi=bd().getPaperWidth()}catch(e){Hi=2460}try{Wi=bd().getPrintRect()}catch(e){Wi=void 0}for(var e={width:Hi,height:zi,printrect:Wi},t=e.width/25.4*96+"px",a=e.height/25.4*96+"px",i=e.width/25.4*300,r=e.height/25.4*300,s=bd().docObj.pages.length,n=0;n<s;n++){var o=document.createElement("canvas");if(!o)return void alert("Error: I cannot create a new canvas element!");o.id="page"+n,o.width=i,o.height=r,o.style.width=t,o.style.height=a,ce.appendChild(o),Vi[n]=!1;var l=o.getContext("2d");if(!l)return void alert("Error: failed to getContext!");Li.push(l)}if(bd().onPrintpage.connect(Ac),null!=bd().docObj.pdfDoc)for(var c=0;c<s;c++)Ai.push(new Hl(c,e)),Ai[c].queueRenderPage();else bd().docObj.printDocument(e)}}function Uc(e){Bc()}function Gc(){null!=Us&&null!=Us.printref&&Us.printClose(),(0).focus(),(0).close()}function Hc(){n.drawImage(t,0,0),a.clearRect(0,0,t.width,t.height)}function zc(e,t,a,i){var s=0,n=0,o=0;r.fillStyle="rgb(238,243,250)",r.fillRect(0,0,Na,Aa),s=t,n=a,o=i,r.drawImage(e,s,n,Ya*o,qa*o)}function Wc(){Ja=!0}function _c(e,i,s){var o=e.usevector3DGLTF||e.usevector3Dbinary||e.usevector3Dxml,l=i.usevector3DGLTF||i.usevector3Dbinary||i.usevector3Dxml;if(!(o||l||e.usevectorbinarycompare||i.usevectorbinarycompare)){var c=!e.usevectorbinary&&!e.usevectorxml,h=!i.usevectorbinary&&!i.usevectorxml,u=e.usepdfjs,d=i.usepdfjs,p=e.DocRef.OriginalURL,g=i.DocRef.OriginalURL,m=e.DocRef.FileNameSRC+" "+i.DocRef.FileNameSRC,f=(e.DocRef.FileNameSRC,i.DocRef.FileNameSRC,e.DocRef.fileindex),y=e.pagenumber,v=i.DocRef.fileindex,b=i.pagenumber,x=decodeURI(e.Vector2DBinarySRC),w=decodeURI(i.Vector2DBinarySRC);if(c){var k=e.MainImageSRC,D=e.SmallImageSRC,C=e.MainImageWidth,P=e.MainImageHeight,S=e.MainImageScaling;e.SmallImageWidth,e.SmallImageHeight,e.SmallImageScaling}if(h){var R=i.MainImageSRC,M=i.SmallImageSRC,T=i.MainImageWidth,E=i.MainImageHeight,F=i.MainImageScaling;i.SmallImageWidth,i.SmallImageHeight,i.SmallImageScaling}if(u)var I=e.originalwidth,j=e.originalheight;if(d)var O=i.originalwidth,L=i.originalheight;var V='<?xml version="1.0" encoding="UTF-8"?>\n';V+="<RxViewServer>\n",V+="<NumLayouts>1</NumLayouts>\n",V+="<Version>1</Version>\n",V+="<Format>Compare</Format>\n",V+="<FileName>Compare</FileName>\n",V+="<OriginalURL>"+p+" "+g+"</OriginalURL>\n",V+="<FileNameSRC>"+m+"</FileNameSRC>\n",V+="<Filter>Composite</Filter>\n",V+="<FileSizeLow>89192</FileSizeLow>\n",V+="<FileSizeHigh>0</FileSizeHigh>\n",V+="<Type>5</Type>\n",V+="<Layout>\n",V+="<LayoutName>Default</LayoutName>\n",V+="</Layout>\n";var N=Jn(V+="</RxViewServer>\n"),A=N.createElement("NumPages"),B=N.createElement("Page"),U=N.createTextNode("1");A.appendChild(U),N.getElementsByTagName("RxViewServer")[0].appendChild(A),vc(B,"PageName","Default"),vc(B,"Compression","---"),vc(B,"DPI","0.02540000"),vc(B,"OffsetX","0.00000"),vc(B,"OffsetY","0.00000"),vc(B,"OriginalScale","1.00000"),vc(B,"OriginalScale","1.00000"),vc(B,"BckGrndDocindex",f),vc(B,"BckGrndPageindex",y),vc(B,"FrGrndDocindex",v),vc(B,"FrGrndPageindex",b),vc(B,"OverlayComparemode",s),null!=x&&vc(B,"Vector2DBinarySRCBckGrnd",x),null!=w&&vc(B,"Vector2DBinarySRCFrGrnd",w),k&&(vc(B,"Vector2DImageSRCBckGrnd",k),D&&vc(B,"Vector2DImageSRCBckGrndSmall",D)),R&&(vc(B,"Vector2DImageSRCFrGrnd",R),M&&vc(B,"Vector2DImageSRCFrGrndSmall",M)),c&&(vc(B,"MainImageWidthBckGrnd",C),vc(B,"MainImageHeightBckGrnd",P),vc(B,"MainImageScalingBckGrnd",S),vc(B,"MainImageOffsetXBckGrnd","0.00000000"),vc(B,"MainImageOffsetYBckGrnd","0.00000000"),vc(B,"SmallImageWidthBckGrnd",C),vc(B,"SmallImageHeightBckGrnd",P)),h&&(vc(B,"MainImageWidthFrGrnd",T),vc(B,"MainImageHeightFrGrnd",E),vc(B,"MainImageScalingFrGrnd",F),vc(B,"MainImageOffsetXFrGrnd","0.00000000"),vc(B,"MainImageOffsetYFrGrnd","0.00000000"),vc(B,"SmallImageWidthFrGrnd",T),vc(B,"SmallImageHeightFrGrnd",E)),u&&(vc(B,"PDFBckGrnd",T),vc(B,"PDFWidthBckGrnd",I),vc(B,"PDFHeightBckGrnd",j)),d&&(vc(B,"PDFFrGrnd",T),vc(B,"PDFWidthFrGrnd",O),vc(B,"PDFHeightFrGrnd",L)),N.getElementsByTagName("Layout")[0].appendChild(B),function(e){if(mi=!1,ri){var i;null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu(),Ka&&bi&&du(),null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1)):(Ws=Xs.push(new Xl(e)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1)),Xs[Ws-1]=Bs;for(var s=e.getElementsByTagName("Page"),o=0;o<s.length;o++)0==o?(i=new _l(s[o],"Default",!0,"",o,Bs),Bs.addthumbnail(new Gl(s[o],"Default",Bs,o)),Bs.addpage(i,!0)):(Bs.addthumbnail(new Gl(s[o],"Default",Bs,o)),o<or?(i=new _l(s[o],"Default",!1,"",o,Bs),Bs.addpage(i,!1)):Bs.addpage(void 0,!1));if(Ih()){Bs.pages[0].firstpage=!0,Bs.bcompare=!0;var l={iscompare:!0,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(l);var c={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(c),null!=Ve&&Ve.loadComplete(Bs.OriginalURL,Bs.bActive),null!=Qt&&Qt.setDownload("hide")}}}(N)}}function Xc(e){var i='<?xml version="1.0" encoding="UTF-8"?>\n';i+="<RxViewServer>\n",i+="<NumLayouts>1</NumLayouts>\n",i+="<NumLayouts>1</NumLayouts>\n",i+="<Version>1</Version>\n",i+="<Format>IFC 2X3</Format>\n",i+="<FileName>"+e+"</FileName>\n",i+="<OriginalURL>"+e+"</OriginalURL>\n",i+="<FileNameSRC>"+e+"</FileNameSRC>\n",i+="<Filter>RxFilterIFC</Filter>\n",i+="<FileSizeLow>89192</FileSizeLow>\n",i+="<FileSizeHigh>0</FileSizeHigh>\n",i+="<Type>4</Type>\n",i+="<Layout>\n",i+="<LayoutName>Default</LayoutName>\n",i+="</Layout>\n";var s=Jn(i+="</RxViewServer>\n"),o=s.createElement("NumPages"),l=s.createElement("Page"),c=s.createTextNode("1");o.appendChild(c),s.getElementsByTagName("RxViewServer")[0].appendChild(o),vc(l,"PageName","Default"),vc(l,"Compression","---"),vc(l,"DPI","0.02540000"),vc(l,"OffsetX","0.00000"),vc(l,"OffsetY","0.00000"),vc(l,"OriginalScale","1.00000"),vc(l,"VectorGLTF3DSRC",e),vc(l,"MainImageWidth","0"),vc(l,"MainImageHeight","0"),vc(l,"MainImageScaling","1.00000000"),vc(l,"MainImageOffsetX","0.00000000"),vc(l,"MainImageOffsetY","0.00000000"),s.getElementsByTagName("Layout")[0].appendChild(l),function(e,i){if(mi=!1,ri){var s;null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu(),Ka&&bi&&du(),null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1)):(Ws=Xs.push(new Xl(e)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1)),Xs[Ws-1]=Bs;for(var o=e.getElementsByTagName("Page"),l=0;l<o.length;l++)0==l?(s=new _l(o[l],"Default",!0,"",l,Bs),Bs.addthumbnail(new Gl(o[l],"Default",Bs,l)),Bs.addpage(s,!0)):(Bs.addthumbnail(new Gl(o[l],"Default",Bs,l)),l<or?(s=new _l(o[l],"Default",!1,"",l,Bs),Bs.addpage(s,!1)):Bs.addpage(void 0,!1));if(Ih()){Bs.pages[0].firstpage=!0,Bs.bglTF=!0;var c={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(c);var h={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(h),null!=Ve&&Ve.loadComplete(Bs.OriginalURL,Bs.bActive),null!=Qt&&Qt.setDownload("hide")}}}(s)}function Yc(e){var i=new FileReader,s='<?xml version="1.0" encoding="UTF-8"?>\n';s+="<RxViewServer>\n",s+="<NumLayouts>1</NumLayouts>\n",s+="<Version>1</Version>\n",s+="<Format>Adobe PDF 1.2</Format>\n",s+="<FileName>"+e.name+"</FileName>\n",s+="<OriginalURL>"+e.name+"</OriginalURL>\n",s+="<FileNameSRC>"+e.name+"</FileNameSRC>\n",s+="<Filter>RxFilterDynaPDF</Filter>\n",s+="<FileSizeLow>89192</FileSizeLow>\n",s+="<FileSizeHigh>0</FileSizeHigh>\n",s+="<Type>0</Type>\n",s+="<Layout>\n",s+="<LayoutName>Default</LayoutName>\n",s+="</Layout>\n";var o=Jn(s+="</RxViewServer>\n"),l=o.createElement("NumPages");i.onloadend=function(e){var i=e.target.result,s=fe.getDocument({data:new Uint8Array(i),cMapUrl:RxConfig.PDFcmap,cMapPacked:!0});s.onPassword=ou,s.promise.then((function(e){var i=e._pdfInfo.numPages,s=o.createTextNode(i.toString());l.appendChild(s),o.getElementsByTagName("RxViewServer")[0].appendChild(l);for(var c=0;c<i;c++){var h=o.createElement("Page");vc(h,"PageName","Page "+(c+1)),vc(h,"Compression","---"),vc(h,"DPI","600"),vc(h,"OffsetX","0.00000"),vc(h,"OffsetY","0.00000"),vc(h,"OriginalScale","1.00000"),vc(h,"MainImageWidth","0"),vc(h,"MainImageHeight","0"),vc(h,"MainImageScaling","1.00000000"),vc(h,"MainImageOffsetX","0.00000000"),vc(h,"MainImageOffsetY","0.00000000"),o.getElementsByTagName("Layout")[0].appendChild(h)}!function(e,i){if(mi=!1,ri){var s;null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu(),Ka&&bi&&du(),null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1)):(Ws=Xs.push(new Xl(e)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1)),Xs[Ws-1]=Bs,Bs.PDFWrapper=new Rl(Bs),Bs.PDFWrapper.setfromreaddirect(i);for(var o=e.getElementsByTagName("Page"),l=0;l<o.length;l++)0==l?(s=new _l(o[l],"Default",!1,"",l,Bs),Bs.addthumbnail(new Gl(o[l],"Default",Bs,l)),Bs.addpage(s,!0)):(Bs.addthumbnail(new Gl(o[l],"Default",Bs,l)),l<or?(s=new _l(o[l],"Default",!1,"",l,Bs),Bs.addpage(s,!1)):Bs.addpage(void 0,!1));if(Ih()){Bs.pages[0].firstpage=!0,Bs.bdestroyPDFonClose=!0,Bs.loadPDFpages(),Bs.directPDF=!0;var c={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(c);var h={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(h),null!=Ve&&Ve.loadComplete(Bs.OriginalURL,Bs.bActive),null!=Qt&&Qt.setDownload("hide");for(var u=!1,d=0;d<Kr.length;d++)if(Kr[d].filenameonly==Bs.FileName.toLowerCase()){ic(Kr[d],Bs.fileindex),u=!0;break}u&&Kr.splice(d,1)}}}(o,e)}))},i.readAsArrayBuffer(e)}const qc=function(e,t,a,i,r){const s=new XMLHttpRequest;s.withCredentials=fi;for(var n=0;n<i.length;n++)"progress"==i[n].event&&i[n].bupload?s.upload.addEventListener(i[n].event,i[n].func,!1):s.addEventListener(i[n].event,i[n].func,!1);try{s.open(e,t)}catch(e){reject("Error 1 - "+e)}try{s.responseType=a}catch(e){reject("Error 2 - "+e)}if(ks){var o=Zc();o.authset&&s.setRequestHeader("Authorization",o.authString+o.baseuserstring)}r?s.send(r):s.send()};function Zc(){var e={authString:"",baseuserstring:"",authset:!1};if(ks)if(e.authString=Ps+" ",Ds)e.baseuserstring=Cs,e.authset=!0;else{var t=Ss;t+=":",t+=Rs,e.baseuserstring=window.btoa(t),e.authset=!0}return e}const Jc=function(e,t,a,i){return new Promise((function(r,s){const n=new XMLHttpRequest;n.withCredentials=fi;try{n.open(e,t)}catch(e){s("Error 1 - "+e)}try{n.responseType=""}catch(e){s("Error 2 - "+e)}if(ks){var o=Zc();o.authset&&n.setRequestHeader("Authorization",o.authString+o.baseuserstring)}n.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=Jn(this.responseText)),Os=this.getAllResponseHeaders(),null!=Fa&&Fa.setRespHeaders(Os),null==t||null==t.documentElement?s("Unable to get XML"):r(t)}else s(this);if(i)for(var a=0;a<i.length;a++)"callback"==i[a].event&&i[a].func&&"function"==typeof i[a].func&&i[a].func(this)},n.onerror=function(e){s("Failed to connect to "+t)},n.addEventListener("progress",(function(e){if(e.lengthComputable){var t=e.loaded/e.total;if(i)for(var a=0;a<i.length;a++)"progressCallBack"==i[a].event&&i[a].func&&"function"==typeof i[a].func&&i[a].func(t)}}),!1),n.send(a)}))},Kc=function(e,t,a,i,r){return new Promise((function(s,n){const o=new XMLHttpRequest;if(o.open(e,t),ks){var l=Zc();l.authset&&o.setRequestHeader("Authorization",l.authString+l.baseuserstring)}try{o.responseType=a}catch(e){n("Error 2 - "+e)}r&&o.setRequestHeader(r.name,r.value),o.onload=function(e){200==this.status?s(o.response):n(this)},o.onerror=function(e){n("Something went wrong")},i?o.send(i):o.send()}))};function Qc(e){console.log(Math.round(100*e.loaded/e.total))}function $c(e){e.lengthComputable&&null!=Zt&&Zt.setUpload(Math.round(100*e.loaded/e.total))}function eh(e){if(null!=document.getElementById("fileToUpload")){var t=document.getElementById("fileToUpload").files[0],a=(encodeURI(t.name),{filename:B+t.name,displayname:null,filenameonly:t.name.toLowerCase()});Kr.push(a)}else encodeURI(Xa),a={filename:B+Xa,displayname:null,filenameonly:Xa.toLowerCase()},Kr.push(a),Xa=""}function th(e){var t=document.getElementById("fileToUpload").files[0],a=(encodeURI(t.name),B+t.name);null!=Zt&&Zt.setUpload("hide"),null!=Qt&&Qt.setDownload("show"),sc({filename:a,displayname:null}),nd("markupedit",{p1:!1})}function ah(e){null!=Zt&&Zt.setUpload("hide"),alert("There was an error attempting to upload the file.")}function ih(e){null!=Zt&&Zt.setUpload("hide"),alert("The upload has been canceled by the user or the browser dropped the connection.")}function rh(e){if(lr){if(e.preventDefault(),null!=ta){var t=ta._wheelImg;if(null!=t)if(null==t.x)var a=t.getBoundingClientRect(),i=a.left+100,r=a.top+100;else i=t.x+100,r=t.y+100}else i=0,r=0;switch(e.type){case"mousedown":case"MSPointerDown":case"pointerdown":e.preventDefault(),fo(100,e.pageX-i,-e.pageY+r,1);break;case"mousemove":break;case"touchstart":e.preventDefault(),fo(100,e.targetTouches[0].pageX-i,-e.targetTouches[0].pageY+r,1);break;case"touchmove":break;case"mouseup":case"MSPointerUp":case"pointerup":fo(100,e.pageX-i,-e.pageY+r,0);break;case"mouseout":for(var s=1;s<7;s++)Bs.getCurrentpage().walkthroughcontrol.movedirection&&Bs.getCurrentpage().walkthroughcontrol.movedirection(s,!1);break;case"MSPointerOut":for(s=1;s<7;s++)Bs.getCurrentpage().walkthroughcontrol.movedirection(s,!1);break;case"pointerout":for(s=1;s<7;s++)Bs.getCurrentpage().walkthroughcontrol.movedirection(s,!1);break;case"touchcancel":for(e.preventDefault(),s=1;s<7;s++)Bs.getCurrentpage().walkthroughcontrol.movedirection(s,!1);break;case"touchend":for(e.preventDefault(),s=1;s<7;s++)Bs.getCurrentpage().walkthroughcontrol.movedirection(s,!1)}}}function sh(e){e.addEventListener("touchstart",rh),e.addEventListener("touchmove",rh),e.addEventListener("touchcancel",rh),e.addEventListener("touchend",rh),Ri?(e.addEventListener("mousemove",rh),e.addEventListener("mousedown",rh),e.addEventListener("mouseup",rh),e.addEventListener("mouseout",rh)):window.navigator.msPointerEnabled?(e.addEventListener("MSPointerMove",rh),e.addEventListener("MSPointerDown",rh),e.addEventListener("MSPointerUp",rh),e.addEventListener("MSPointerOut",rh)):(e.addEventListener("mousemove",rh),e.addEventListener("mousedown",rh),e.addEventListener("mouseup",rh),e.addEventListener("mouseout",rh))}class nh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onResize=function(e){"function"==typeof t.callback&&t.callback(e)}}}class oh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.zoomUpdate=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}}class lh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.zoomUpdate=function(e){"function"==typeof t.callback&&t.callback(e)}}}class ch{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.panUpdate=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}}class hh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.markupSaved=function(){"function"==typeof t.callback&&t.callback()}}}class uh{constructor(e){var t=this;this.hastext=!1,this.callback=e,this.connect=function(e){t.callback=e},this.numTextFound=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class dh{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.markupLink=function(e){"function"==typeof t.callback&&t.callback(e)}}}class ph{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupHover=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}}class gh{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupSelected=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class mh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setPentablelist=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class fh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.getCurrentPage=function(){return Bs.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<Bs.markuplist.length;a++)Bs.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.pageindex,this.thumbnail)},this.setThumbnail=function(e,t){this.thumbnail=t,this.pageindex=e,this.notify()}}}class yh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.getCurrentPage=function(){return Bs.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<Bs.markuplist.length;a++)Bs.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.thumbnails)},this.setThumbnails=function(e){this.thumbnails=e,this.notify()}}}class vh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.setVectorLayers=function(e){"function"==typeof t.callback&&t.callback(e)}}}class bh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.setVectorBlocks=function(e){"function"==typeof t.callback&&t.callback(e)}}}class xh{constructor(e){var t=this;this.connect=function(e){t.callback=e},this.readComplete=function(){"function"==typeof t.callback&&t.callback()}}}class wh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockID=function(e){"function"==typeof t.callback&&t.callback(e)}}}class kh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockInfo=function(e,a,i){this.info=e,"function"==typeof t.callback&&t.callback(e,a,i)}}}class Dh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set3DPartInfo=function(e){this.info=e,"function"==typeof t.callback&&t.callback(e)}}}class Ch{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.RenderComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}}class Ph{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}}class Sh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onDrawEvent=function(e){"function"==typeof t.callback&&t.callback(e)}}}class Rh{constructor(e){var t=this;this.callback=e,this.pageonly=!1,this.connect=function(e){t.callback=e},this.getDisplayName=function(e){return Pn(e)},this.getDisplayDate=function(e){return GetDateTime(e)},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setMarkupList=function(e,t,a){this.markupList=e,a||this.notify(e,t)}}}class Mh{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onClose=function(){"function"==typeof t.callback&&t.callback()}}}class Th{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.CompareDialog=function(){"function"==typeof t.callback&&t.callback(qs)}}}function Eh(e,t){t.status?console.log(e,t.status):console.log(e,t),null!=Qt&&Qt.setDownload("hide")}function Fh(e){e.status?404==e.status?(console.log("XML could not be found error 404"),null!=Qt&&Qt.setDownload("hide")):503==e.status?(console.log("Server is down error 503"),null!=Qt&&Qt.setDownload("hide")):501==e.status&&(console.log("Server is not responding refresh the page error 501"),null!=Qt&&Qt.setDownload("hide")):(console.log(e),null!=Qt&&Qt.setDownload("hide"))}function Ih(){var e=!0;return(null==Bs||null==Bs||null==Bs.getCurrentpage())&&(e=!1),e}function jh(){var e=!1;return Ka||(e=!0),(null==Bs||null==Bs||null==Bs.getCurrentpage())&&(e=!0),e}function Oh(){return[{label:"Freehand pen",typename:"PEN",type:0,subtype:0},{label:"Eraser",typename:"ERASE",type:0,subtype:1},{label:"Polyline",typename:"POLYLINE",type:1,subtype:1},{label:"Polygon",typename:"POLYGON",type:1,subtype:2},{label:"Measure path",typename:"PATH",type:1,subtype:3},{label:"Measure angle",typename:"ANGLE",type:1,subtype:4},{label:"Measure segment",typename:"SEGMENT",type:1,subtype:6},{label:"Rectangle",typename:"RECTANGLE",type:3,subtype:0},{label:"Rounded rectangle",typename:"ROUNDED_RECTANGLE",type:3,subtype:1},{label:"Marker",typename:"MARKER",type:3,subtype:3},{label:"Rectanglular Area",typename:"AREARECT",type:3,subtype:6},{label:"Oval",typename:"ELLIPSE",type:4,subtype:0},{label:"Circle",typename:"CIRCLE",type:4,subtype:1},{label:"Revision Cloud",typename:"CLOUD",type:5,subtype:0},{label:"Line",typename:"LINE",type:6,subtype:9},{label:"Arrow",typename:"ARROW",type:6,subtype:0},{label:"Dimension Line",typename:"DIMENSION",type:7,subtype:0},{label:"Space",typename:"SPACE",type:8,subtype:1},{label:"Area",typename:"AREA",type:8,subtype:0},{label:"Callout",typename:"CALLOUT",type:9,subtype:2},{label:"Text",typename:"TEXT",type:9,subtype:1},{label:"Note",typename:"NOTE",type:10,subtype:0},{label:"Image",typename:"IMAGE",type:11,subtype:0},{label:"Symbol",typename:"SYMBOL",type:11,subtype:1},{label:"Button",typename:"BUTTON",type:11,subtype:3},{label:"Signature",typename:"SIGNATURE",type:11,subtype:4},{label:"Signature",typename:"SIGNATUREMOVEABLE",type:11,subtype:5},{label:"Stamp",typename:"IMAGESTAMP",type:11,subtype:12},{label:"QRCode",typename:"IMAGEQR",type:11,subtype:13},{label:"link",typename:"link",type:11,subtype:20},{label:"interactiveStamp",typename:"interactiveStamp",type:11,subtype:21},{label:"Stamp",typename:"STAMP",type:12,subtype:0},{label:"Count",typename:"COUNT",type:13,subtype:0}]}function Lh(e){var t={lineColor:!1,fillColor:!1,textColor:!1,lineWidth:!1,lineStyle:!1,clockwise:!1,customlabel:!1,display:!0,countsize:!1,countshape:!1,showperimeter:!1,enablelink:!1,endpoint_open_single:!1,endpoint_open_both:!1,endpoint_filled_single:!1,endpoint_filled_both:!1,endpoints_bar:!1,endpoints_arrow:!1,lineSegmentWidth:!1,transpacency:!1,rotate:!1,snap:!1,fill:!1,fontName:!1,fontHeight:!1,labelsize:!1,fontBold:!1,fontItalic:!1};return"PEN"==e.typename&&(t.lineColor=!0,t.lineWidth=!0),"ERASE"==e.typename&&(t.lineWidth=!0,t.display=!1),"POLYLINE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0),"POLYGON"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0),"PATH"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.labelsize=!0),"ANGLE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.clockwise=!0,t.labelsize=!0),"SEGMENT"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.lineSegmentWidth=!0,t.snap=!0),"POLYCURVE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0),"RECTANGLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"ROUNDED_RECTANGLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"MARKER"==e.typename&&(t.fillColor=!0,t.rotate=!0),"AREARECT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.labelsize=!0),"ELLIPSE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"CIRCLE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0),"CLOUD"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.rotate=!0),"LINE"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0),"ARROW"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.endpoint_open_single=!0,t.endpoint_open_both=!0,t.endpoint_filled_single=!0,t.endpoint_filled_both=!0),"DIMENSION"==e.typename&&(t.lineColor=!0,t.lineWidth=!0,t.snap=!0,t.endpoints_bar=!0,t.endpoints_arrow=!0,t.labelsize=!0),"SPACE"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.customlabel=!0,t.labelsize=!0),"AREA"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.snap=!0,t.fill=!0,t.customlabel=!0,t.labelsize=!0,t.showperimeter=!0),"CALLOUT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.textColor=!0,t.fontName=!0,t.fontHeight=!0,t.fontBold=!0,t.fontItalic=!0),"TEXT"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.textColor=!0,t.rotate=!0,t.fontName=!0,t.fontHeight=!0,t.fontBold=!0,t.fontItalic=!0),e.typename,"IMAGE"!=e.typename&&"IMAGESTAMP"!=e.typename&&"SYMBOL"!=e.typename||(t.rotate=!0),e.typename,"STAMP"==e.typename&&(t.lineColor=!0,t.fillColor=!0,t.lineWidth=!0,t.transpacency=!0,t.fill=!0,t.rotate=!0),"COUNT"==e.typename&&(t.fillColor=!0,t.countsize=!0,t.countshape=!0),t}function Vh(e,t,i){jh()||$a||function(e,t,i){var r=0,s=!1;for(r=Bs.markuplist.length;r>0;r--)if(null!=Bs.markuplist[r-1]&&Bs.markuplist[r-1].display&&Bs.markuplist[r-1].pagenumber==Bs.getcurPage()&&8==Bs.markuplist[r-1].type&&1==Bs.markuplist[r-1].subtype){var o=e.toString();if(Bs.markuplist[r-1].findAttribute("SpaceID",o))if(s=!0,i){var l=ro(t);-1!=l&&(Bs.markuplist[r-1].alternative=l+3,Bs.markuplist[r-1].hatchStyle=l)}else Bs.markuplist[r-1].alternative=0}return al(n),il(a),s}(e,t,i)||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().setBlockHatch(e,t,i)}function Nh(e,t,a){jh()||$a||(Wo(e,t,a)||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().setBlockColor(e,t,a),Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().set3DBlockColor(e,t,a))}function Ah(){for(var e=!1,t=0;t<Xs.length;t++){e=!1;var a=!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usepdfjs&&!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevector3Dxml&&!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevectorxml;if("Compare"==Xs[t].Type){var i={index:Xs[t].pages[0].DocRef.fileindex,Name:Xs[t].pages[0].DocRef.FileName,Type:Xs[t].pages[0].DocRef.Type,Is2D:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevectorxml,is3D:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevector3Dxml,isImage:a,isPDF:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usepdfjs,state:1};qs.push(i),a=!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usepdfjs&&!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevector3Dxml&&!Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevectorxml,i={index:Xs[t].pages[1].DocRef.fileindex,Name:Xs[t].pages[1].DocRef.FileName,Type:Xs[t].pages[1].DocRef.Type,Is2D:Xs[t].pages[1].DocRef.pages[Xs[t].pages[1].DocRef.currentpage].usevectorxml,is3D:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usevector3Dxml,isImage:a,isPDF:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usepdfjs,state:2},qs.push(i)}else{for(var r=0,s=0;s<Ys.length;s++)Xs[t].FileName==Ys[s].Name&&(r=Ys[s].state);a=!Xs[t].pages[Xs[t].currentpage].usepdfjs&&!Xs[t].pages[Xs[t].currentpage].usevector3Dxml&&!Xs[t].pages[Xs[t].currentpage].usevectorxml,i={index:Xs[t].fileindex,Name:Xs[t].FileName,Type:Xs[t].Type,Is2D:Xs[t].pages[Xs[t].currentpage].usevectorxml,is3D:Xs[t].pages[Xs[t].currentpage].usevector3Dxml,isImage:a,isPDF:Xs[t].pages[0].DocRef.pages[Xs[t].pages[0].DocRef.currentpage].usepdfjs,state:r};for(var n=0;n<qs.length;n++)i.index==qs[n].index&&(e=!0);e||(qs.push(i),e=!1)}}return qs}function Bh(e){a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height);var i=function(){for(var e=null,t=0;t<Xs.length;t++)Xs[t].bActive&&(e=t);return e}();null!=i&&Xs[i].Type,Bs&&Bs.enableTextSelect(!1),Xs.length>=1&&null!=Xs[e]&&(Sr=!0,(Bs=Xs[e]).bSopenSilent=!1,Rr&&!Bs.pdfDoc&&(Rr=!1),Bs.pages&&Bs.pages.length&&(Bs.pages[0].usedincomposite=!1),Bs.getCurrentpage().usevector3Dxml||null!=ta&&lr&&ta.setWalkthroughGUI(!1),iu(),Bs.SetActive())}function Uh(){jh()||Bs.getCurrentpage().usevector3Dxml&&(null==As&&(nd("orbitControl",{}),Bs.curcontrol3D="orbitControl"),"Walkthrough3D"==As.name&&(Bs.getCurrentpage().walkthroughcontrol.isLocked=!1),null!=ta&&lr&&ta.setWalkthroughGUI(!1),nd("orbitControl",{}),Bs.curcontrol3D="orbitControl")}function Gh(e){jh()||Bs.getCurrentpage().usevector3Dxml&&(e?(null!=ta&&lr&&ta.setWalkthroughGUI(!0),nd("Walkthrough3D",{}),Bs.curcontrol3D="Walkthrough3D"):(Bs.getCurrentpage().walkthroughcontrol.firstxyrecieved=!1,Uh()))}function Hh(){if(!jh()){var e=Bs.getCurrentpage();e&&e.usevector3Dxml&&e.Vector3DPageObj.saveCamera()}}function zh(){var e=void 0;if(!jh())return Bs.getCurrentpage().usevectorxml&&(e=Bs.getCurrentpage().screentoDocRect({x:0,y:0,w:Na,h:Aa})),e}function Wh(){var e=void 0;if(!jh())return Bs.getCurrentpage().usevectorxml&&(e=Bs.getCurrentpage().getlayerlist()),e}function _h(){var e=void 0;if(!jh())return Bs.getCurrentpage().usevectorxml&&(e=Bs.getCurrentpage().getBlockswFill()),e}function Xh(){if(!jh()){var e=Bs.getCurrentpage();null!=e&&null!=e&&e.usevector3Dxml&&e.Vector3DPageObj.saveresetCamera()}}function Yh(){if(!jh()){var e=Bs.getCurrentpage();null!=e&&null!=e&&e.usevector3Dxml&&e.Vector3DPageObj.restoreresetCam()}}function qh(e,t){if(!jh()&&!ws&&null!=e&&"string"==typeof e){null!=e.match(/rgb/gi)&&(e=dn(e));var a=ss;switch(t){case 1:a=os,os=e,No(1),xs||(os=a);break;case 0:a=ns,ns=e,No(7),xs||(ns=a);break;case 2:a=ls,ls=e,No(8),xs||(ls=a)}}}function Zh(){jh()||(al(n),il(a))}function Jh(e,t){t.password=e,sc(t)}function Kh(e){var t=void 0;if("object"==typeof e){var a="";null!=e.filepath&&null!=e.filepath&&(a=e.filepath),null!=e.filename&&null!=e.filename&&(a=e.filename),t={filename:a,displayname:null,auth:null,xrefurl:null,cacheid:null},null!=e.mime&&null!=e.mime&&(t.mime=e.mime),null!=e.cacheid&&null!=e.cacheid&&(t.cacheid=e.cacheid),null!=e.auth&&null!=e.auth&&(t.auth=e.auth),null!=e.xrefurl&&null!=e.xrefurl&&(t.xrefurl=e.xrefurl),e.requestheaders,null!=e.displayname&&null!=e.displayname&&(t.displayname=e.displayname)}else"string"==typeof e&&(t={filename:e,displayname:null});return t}function Qh(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1;var i=!1,r=Kh(e);null!=r&&(null!=r.filename&&(i=!0),i?sc(r,t,a):null!=Qt&&Qt.setDownload("hide"))}function $h(e){for(var t=!0,a=0;a<Ys.length;a++)e==Ys[a].Name&&(Ys[a].loaded=!0),t&&(t=Ys[a].loaded);t&&(Ah(),ei=!1,Ys=[],0==ii?nu(!0):su(!0))}function eu(){for(var e=void 0,t=0;t<Xs.length;t++)if(Xs[t].bcompare){e=Xs[t];break}return e}function tu(e,t,a){ei=!0,ii=a;for(var i=0;i<Xs.length;i++)"Compare"==Xs[i].Type&&Xs.splice(i,1);var r={Name:go(e),loaded:!1,disableMenu:!0,state:1};Ys.push(r),r={Name:go(t),loaded:!1,disableMenu:!0,state:2},Ys.push(r),null!=Qt&&Qt.setDownload("show");var s={filename:t,displayname:null};sc({filename:e,displayname:null}),sc(s)}function au(e){return new Promise((function(t,a){it.connect((function(a){a==e&&(Bs.pages[a].rendercallback=!1,t(e))})),null!=Bs.pages[e]&&(Bs.pages[e].rendercallback=!0),Bs.GotoPage(e),Bs.draw_mpagepdf()}))}function iu(){for(var e=0;e<Xs.length;e++)Xs[e].bActive=!1}function ru(e,t){if(!jh()){var a=-1,i=-1;if(!$a)if(qs.length>1&&e){for(var r=0;r<qs.length;r++){if(1==qs[r].state){qs[r].Name;var s=qs[r].index}if(2==qs[r].state){qs[r].Name;var n=qs[r].index}}for(r=0;r<Xs.length;r++)Xs[r].fileindex==s&&(a=r,Xs[r].disableMenu=!0),Xs[r].fileindex==n&&(i=r,Xs[r].disableMenu=!0);if(-1!=a&&-1!=i&&a!=i){_c(Xs[a].pages[Xs[a].currentpage],Xs[i].pages[Xs[i].currentpage],t);var o={iscompare:!0,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive,source:"createcompareoverlay"};null!=Gt&&Gt.setGUIState(o),null!=Qt&&Qt.setDownload("hide"),null!=Ve&&Ve.loadComplete("compare",!0),null!=aa&&aa.CompareDialog()}}else qs=[]}}function su(e){ru(e,1)}function nu(e){ru(e,0)}function ou(e,t){null!=rt&&rt.PassWordRequest(e,t)}function lu(){if(Ka&&!ws)return Oo()}function cu(){if(!jh()&&Ka){var e=Math.floor(Bs.getCurrentpage().MainImageWidth/Bs.getCurrentpage().MainImageScaling),t=ko(Bs.getCurrentpage().MainImageWidth),a=Math.floor(Bs.getCurrentpage().MainImageHeight/Bs.getCurrentpage().MainImageScaling),i=ko(Bs.getCurrentpage().MainImageHeight),r=void 0,s=void 0;Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().VectorPageObj?(t=ko(e=Math.floor(Bs.getCurrentpage().VectorPageObj.width)),i=ko(a=Math.floor(Bs.getCurrentpage().VectorPageObj.height))):Bs.getCurrentpage().usepdfjs?(t=ko(e=Math.floor(Bs.getCurrentpage().pdfpagewidth)),i=ko(a=Math.floor(Bs.getCurrentpage().pdfpageheight))):Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj&&(Bs.getCurrentpage().usevector3DGLTF?(t=ko(e=Math.floor(Bs.getCurrentpage().Vector3DPageObj.curwidth)),i=ko(a=Math.floor(Bs.getCurrentpage().Vector3DPageObj.curheight)),s=ko(r=Math.floor(Bs.getCurrentpage().Vector3DPageObj.curdepth))):(t=ko(e=Math.floor(Bs.getCurrentpage().Vector3DPageObj.w)),i=ko(a=Math.floor(Bs.getCurrentpage().Vector3DPageObj.h))));var n=Bs.getCurrentpage().OffsetX,o=Bs.getCurrentpage().OffsetY,l=Bs.getCurrentpage().OriginalScale,c={FileFormat:Bs.Format,FileName:Bs.FileName,FileSize:Math.floor(Bs.FileSizeLow/1024),Compression:Bs.getCurrentpage().Compression,DPI:Bs.getCurrentpage().DPI,Pages:Bs.NumPages,ImageWidth:e,imagewidthunits:t,ImageHeight:a,imageheightunits:i,OffsetX:n,OffsetY:o,OriginalScale:l,XRefs:Bs.xrefs,Fonts:Bs.fonts,Properties:Bs.documentproperties};r&&(c.ImageDepth=r),s&&(c.ImageDepthunits=s),null!=Bs.CadMeasurement&&(c.CADMeasurement=Bs.CadMeasurement),$a&&(c={FileFormat:"Overlay Composite",FileName:Us.pages[0].DocRef.FileName+"-"+Us.pages[1].DocRef.FileName,FileSize:"-",Compression:"-",DPI:"-",Pages:"-",ImageWidth:"-",imagewidthunits:t,ImageHeight:"-",imageheightunits:i,OffsetX:"-",OffsetY:"-",OriginalScale:"-"}),null!=Le&&Le.setFileInfo(c)}}function hu(){$a=!1,qs=[],Us.Close();for(var e=0;e<Xs.length;e++)"Compare"==Xs[e].Type&&Xs.splice(e,1);Us={}}function uu(e){var i=Xs[e]||Bs,s=e||void 0;if(!Ka)return!1;if(i&&(s=i.fileindex),Bs&&i.bMarkupchanged&&!ws&&hi&&confirm("Save Markup?")&&Pc(b,hs,us),i===Bs&&(a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height)),"Compare"==Xs[Xs.length-1].Type?hu():(i.Close(),i===Bs&&(i=Bs=null),Xs.splice(s,1)),Bs&&(Bs.bMarkupchanged=!1),zr=!1,Wr=!1,Xs.length<1){if(Ka=!1,!J){Ya=zs.width,qa=zs.height,Ya=zs.naturalWidth,qa=zs.naturalHeight;var o=Aa/qa,l=Na/Ya,c=Math.min(l,o),h=(Na-Ya*c)/2,u=(Aa-qa*c)/2}Su(),Pu(),null!=Ce&&Ce.setUserlist(es,!0),J||zc(zs,h,u,c),nd("markupedit",{p1:!1});var d={iscompare:!1,numOpenFiles:Xs.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:0,currentpage:0,activefile:!1};null!=Gt&&Gt.setGUIState(d)}else"Compare"==Xs[Xs.length-1].Type?(Us=Xs[Xs.length-1],iu(),Us.bSopenSilent=!1,Us.SetActive()):(Bs||(Bs=Xs[Xs.length-1]),iu(),Bs.bSopenSilent=!1,Bs.SetActive());for(var p=0;p<Xs.length;p++)Xs[p].setfileindex(p);return!0}function du(e){var i=Xs[e]||Bs,s=e||void 0,o=s;if(!Ka)return null!=He&&He.closeComplete("no file open",!1),!1;if(i&&(o=s=i.fileindex),Bs&&(i.getdelayedClose()&&i.setdelayedClose(!1),i.bMarkupchanged&&!ws&&hi&&(confirm("Save Markup?")?Bs.bLargePDF?(i.setdelayedClose(!0),Pc(b,hs,us)):Sc(b,hs,us):i.setdelayedClose(!1))),i.getdelayedClose())return null!=He&&He.closeComplete("delayed",!1),!1;if(i===Bs&&(a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height)),"Compare"==Xs[Xs.length-1].Type)hu();else{i.Close(),i===Bs&&(i=Bs=null);for(var l=-1,c=0;c<qs.length;c++)s==qs[c].index&&(l=c);l>=0&&qs.splice(l,1),Xs.splice(s,1)}if(Bs&&(Bs.bMarkupchanged=!1),zr=!1,Wr=!1,Xs.length<1){if(Ka=!1,!J){Ya=zs.width,qa=zs.height,Ya=zs.naturalWidth,qa=zs.naturalHeight;var h=Aa/qa,u=Na/Ya,d=Math.min(u,h),p=(Na-Ya*d)/2,g=(Aa-qa*d)/2}Su(),Pu(),null!=Ce&&Ce.setUserlist(es,!0),J||zc(zs,p,g,d),nd("markupedit",{p1:!1});var m={iscompare:!1,numOpenFiles:Xs.length,isPDF:!1,is3D:!1,markupOn3D:!1,is2D:!1,numpages:0,currentpage:0,activefile:!1};null!=Gt&&Gt.setGUIState(m)}else"Compare"==Xs[Xs.length-1].Type?(Us=Xs[Xs.length-1],iu(),Us.bSopenSilent=!1,Us.SetActive()):(Bs||(Bs=Xs[Xs.length-1]),iu(),Bs.bSopenSilent=!1,Bs.SetActive());for(var f=0;f<Xs.length;f++)Xs[f].setfileindex(f);return null!=He&&He.closeComplete(o,!0),!0}function pu(e){Ka&&($a||Bs.getCurrentpage().setViewMode(e))}function gu(e,t){So(),Hi=t.width,zi=t.height,Wi=t.printrect,Bs.checkprintready()?Uc():Bs.loadAllPages()}function mu(){jh()||Ka&&(ws||$a||(Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().delete3DMarkup():Jo()))}function fu(e){navigator.clipboard&&window.isSecureContext?e.toBlob((function(e){return function(){if(!jh())if(Bs.getCurrentpage().usevector3Dxml)switch(Bs.curcontrol3D){case"Walkthrough3D":Gh(!0);break;case"orbitControl":Uh();break;case"markupedit":nd("markupedit",{p1:!1})}else nd("markupedit",{p1:!1})}(),navigator.clipboard.write([new ClipboardItem({"image/png":e})])})):console.log("no secure context")}function yu(e,t){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||Bs.getCurrentpage().pan_page_pos(e,t))}function vu(e){if(Ka&&!ws){var t=!1;Ho(),Uo(),e?(gr&&(Bs.markuplist[Dr].multipoint()?Bs.markuplist[Dr].setselectedit(!0):Bs.markuplist[Dr].setselect(!0),t=8==Bs.markuplist[Dr].type&&1==Bs.markuplist[Dr].subtype,al(n),il(a),gr=!1,Dr=-1),nd("markupedit",{p1:t})):nd("markupedit",{p1:!1})}}function bu(e,t,a){null==t&&(t=Bs);var i=0;t.setmarkupfilesreceived();var r,s=t.getmarkupfilesreceived(),o=t.getnummarkupfiles();if(null!=e.getElementsByTagName("FileVersion")&&0!=e.getElementsByTagName("FileVersion").length)var l=e.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=e.getElementsByTagName("Format")&&0!=e.getElementsByTagName("Format").length){if(e.getElementsByTagName("Format")[0].firstChild.nodeValue,null!=a)var c=uo(a);if(null!=e.getElementsByTagName("Markup3D")&&0!=e.getElementsByTagName("Markup3D").length){var h=e.getElementsByTagName("Markup3D")[0].firstChild.nodeValue;null!=a&&mc(h=c+h,t)}if(null!=e.getElementsByTagName("Views3D")&&0!=e.getElementsByTagName("Views3D").length){var u=e.getElementsByTagName("Views3D")[0].firstChild.nodeValue;null!=a&&gc(u=c+u,t)}}if(null!=e.getElementsByTagName("User")&&0!=e.getElementsByTagName("User").length){var d=e.getElementsByTagName("User");for(i=0;i<d.length;i++){var p=d[i].getElementsByTagName("Name")[0].firstChild.nodeValue,g=d[i].getElementsByTagName("ID")[0].firstChild.nodeValue;if(null!=d[i].getElementsByTagName("Layer")[0])var m=d[i].getElementsByTagName("Layer")[0].firstChild.nodeValue;else m=rs;if(null!=d[i].getElementsByTagName("Color")[0])var f=d[i].getElementsByTagName("Color")[0].firstChild.nodeValue;else f=ss;es[0].Signature==g||es.push(new Dn(g,p,m,f,!1))}}else if(e.getElementsByTagName("Name").length>0){var y=e.getElementsByTagName("Name");es[0].Signature!=y[0].firstChild.nodeValue&&es.push(new Dn(y[0].firstChild.nodeValue,y[0].firstChild.nodeValue,rs,ss,!1))}if(e.getElementsByTagName("Entity").length>0){var v=e.getElementsByTagName("Entity");for(i=0;i<v.length;i++){var b=v[i].getElementsByTagName("Type")[0].firstChild.nodeValue,x=v[i].getElementsByTagName("Subtype")[0].firstChild.nodeValue,w=v[i].getElementsByTagName("Alternative")[0].firstChild.nodeValue,k=v[i].getAttribute("ID")?v[i].getAttribute("ID"):null,D=9==b&&2==x;if(null!=v[i].getElementsByTagName("HaveLeader")[0])var C=1==parseInt(v[i].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(C||D){if(null==v[i].getElementsByTagName("Entity")[0])continue;var P=v[i].getElementsByTagName("Entity")[0],S=P.getElementsByTagName("Type")[0].firstChild.nodeValue,R=P.getElementsByTagName("Subtype")[0].firstChild.nodeValue,M=P.getElementsByTagName("Alternative")[0].firstChild.nodeValue;P.getAttribute("ID")&&P.getAttribute("ID"),S=parseInt(S),R=parseInt(R),M=parseInt(M);var T=new Fo(S,R,M),E=T.SetfromXML(t,P,l);E&&(v[i].removeChild(P),T.savemetolistLoad(t,!1))}if(null!=v[i].getElementsByTagName("Hole")[0])var F=!0;var I=[],j=[];if(F){if(null==v[i].getElementsByTagName("Entity")[0])continue;var O=v[i].getElementsByTagName("Entity");if(null==O.length){var L=O.getElementsByTagName("Type")[0].firstChild.nodeValue,V=O.getElementsByTagName("Subtype")[0].firstChild.nodeValue,N=O.getElementsByTagName("Alternative")[0].firstChild.nodeValue;O.getAttribute("ID")&&O.getAttribute("ID"),L=parseInt(L),V=parseInt(V),N=parseInt(N),I.push(new Fo(L,V,N)),j.push(I[A].SetfromXML(t,O[A],l)),j[0]&&(v[i].removeChild(O),I[0].savemetolistLoad(t,!1))}else for(var A=0;O.length>0;)L=O[0].getElementsByTagName("Type")[0].firstChild.nodeValue,V=O[0].getElementsByTagName("Subtype")[0].firstChild.nodeValue,N=O[0].getElementsByTagName("Alternative")[0].firstChild.nodeValue,O[0].getAttribute("ID")&&O[0].getAttribute("ID"),L=parseInt(L),V=parseInt(V),N=parseInt(N),I.push(new Fo(L,V,N)),j.push(I[A].SetfromXML(t,O[0],l)),j[A]&&(v[i].removeChild(O[0]),I[A].savemetolistLoad(t,!1)),A++}b=parseInt(b),x=parseInt(x),w=parseInt(w);var B=new Fo(b,x,w);if(B.markupID=k,B.SetfromXML(t,v[i],l)){if(E&&C&&null!=T&&(B.bhasArrow=C,B.markupArrowConnected=T,T.bisTextArrow=!0,T.textBoxConnected=B,T.setArrowPoint(B),E=!1,C=!1,al(n)),F)for(A=0;A<I.length;A++)j[A]&&(I[A].parent=B,B.holes.push(I[A]));var U=i==v.length-1&&o==s;B.savemetolistLoad(t,U)}else console.log("adding markup failed ",B.markupID)}B&&B.notify(),0==v.length&&null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive),null!=Ce&&Ce.setUserlist(es,t.bActive),al(n)}else o==s&&(al(n),null!=Et&&Et.setMarkupList(t.getmarkuplist(),t.bActive));if(e.getElementsByTagName("ScaleItem").length>0){var G=e.getElementsByTagName("ScaleItem");let t=[];for(i=0;i<G.length;i++){var H=G[i].getElementsByTagName("Value")[0].firstChild.nodeValue,z=G[i].getElementsByTagName("Label")[0].firstChild.nodeValue,W=G[i].getElementsByTagName("Metric")[0].firstChild.nodeValue,_=G[i].getElementsByTagName("MetricUnit")[0].firstChild.nodeValue,X=G[i].getElementsByTagName("DimPrecision")[0].firstChild.nodeValue,Y="true"===G[i].getElementsByTagName("IsSelected")[0].firstChild.nodeValue;const e={value:H,label:z,metric:W,metricUnit:_,dimPrecision:X,isSelected:Y};t.push(e),Y&&("0"===(r=e).metric?Cu(1):Cu(2),"0"===r.metric?Ru(r.metricUnit):Mu(r.metricUnit),Zu(r.dimPrecision),Tu(r.value),Eu(r.label))}Bs.scalesOptions=t}t.markuplist.length&&function(e,t){if(null!=t.getPageObject(t.markuplist[0].pagenumber)){if(void 0!==e.getElementsByTagName("HasScale")[0])for(var a=0;a<e.getElementsByTagName("HasScale").length;a++)"true"===e.getElementsByTagName("HasScale")[a].firstChild.nodeValue&&(t.markuplist[a].hasScale=e.getElementsByTagName("HasScale")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.measurescale=parseFloat(e.getElementsByTagName("Measurescale")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.scaleLabel=e.getElementsByTagName("ScaleLabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.Unitofmeasure=parseFloat(e.getElementsByTagName("Unitofmeasure")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.SubmeasureUnit=parseFloat(e.getElementsByTagName("SubmeasureUnit")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.Unitlabel=e.getElementsByTagName("Unitlabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.AreaUnitlabel=e.getElementsByTagName("AreaUnitlabel")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.unitscale=parseFloat(e.getElementsByTagName("Unitscale")[a].firstChild.nodeValue),t.markuplist[a].scaleObject.scaleValue=e.getElementsByTagName("ScaleValue")[a].firstChild.nodeValue,t.markuplist[a].scaleObject.ndimprecision=e.getElementsByTagName("Ndimprecision")[a].firstChild.nodeValue);Zh()}}(e,t),tt.loadComplete()}function xu(e,i,r,s){var o=Oo();if(!o.isempty)if(o.anglelengthsupport||o.setRadiusSupport){o.w,o.h,o.x,o.y;var l=o.setAngleLenghtEdit(i,e,s);if(a.clearRect(0,0,t.width,t.height),4==o.type&&1==o.subtype)var c=Nn({x:o.x,y:o.y},{x:l.w,y:l.h});else c=Bn({x:l.w,y:l.h});c?(o.w=l.w,o.h=l.h,al(n),il(a),o.lengthangleCallbackSelect()):(al(n),il(a),null!=Ea&&Ea.onDrawError("outside"))}else if(o.setPointSupport){l=o.setAngleLengthPointsEdit(i,e,s);var h=1==o.type&&(1==o.subtype||3==o.subtype);a.clearRect(0,0,t.width,t.height),Bn({x:l.w,y:l.h})?(r||(0!=l.p||h?o.setCurPoint(l.p-1):o.setCurPoint(o.points.length-1)),o.movepoint(l.w,l.h,l.p),o.lengthangleCallbackPointSelect(),al(n),il(a)):(al(n),il(a),null!=Ea&&Ea.onDrawError("outside")),o.findrectangle()}}function wu(e){Er=e,Ti&&(Ei=!e),e||ku(0,!0)}function ku(e,t){if(Ka&&!ws){var i=0;for(i=0;i<Bs.markuplist.length;i++)(Bs.markuplist[i].spaceselected||t)&&8==Bs.markuplist[i].type&&1==Bs.markuplist[i].subtype&&(Bs.markuplist[i].linestyle=e);al(n),function(e){if(null!=Bs&&null!=Bs){var t=rl();if(ti&&t)e.clearRect(0,0,Na,Aa);else{var a=0,i=!1;if(e.clearRect(0,0,Na,Aa),Bs.Drawmarkup)for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&el(Bs.markuplist[a])&&Bs.markuplist[a].spaceselected&&(i=8==Bs.markuplist[a].type&&1==Bs.markuplist[a].subtype,Bs.markuplist[a].display&&i&&Bs.markuplist[a].drawmescaled(e));else for(a=0;a<Bs.markuplist.length;a++)null!=Bs.markuplist[a]&&el(Bs.markuplist[a])&&0==Bs.markuplist[a].type&&1==Bs.markuplist[a].subtype&&Bs.markuplist[a].display&&Bs.markuplist[a].drawmescaled(e)}}}(a),il(a)}}function Du(){if(jh()){var e="Metric";switch(Fr){case 1:e="Metric";break;case 2:e="Imperial";break;case 3:e="System"}return{unit:Fr,unitname:e,subunit:qr,label:Ir,Arealabel:jr}}return Bs.getCurrentpage().getUnit()}function Cu(e){if(jh()){switch(e){case 1:Ir="mm",jr="mmÂ²";break;case 2:Ir="in.",jr="sq.in.";break;case 3:Ir="Units",jr="UnitsÂ²"}Fr=e}else Bs.getCurrentpage().scaleObject.setUnit(e)}function Pu(){for(var e=!1,t=0;t<es.length;t++)es[t].Signature==hs&&(e=!0,es[t].DisplayName=us);e||es.push(new Dn(hs,us,rs,ss,!1))}function Su(){for(var e=hs,t=us,a=0;a<es.length;a++)es[a].default&&(e=es[a].Signature,t=es[a].DisplayName);(es=[]).push(new Dn(e,t,rs,ss,!0))}function Ru(e){if(jh())switch("Millimeter"==e&&(qr=1),"Centimeter"==e&&(qr=2),"Decimeter"==e&&(qr=3),"Meter"==e&&(qr=4),"Kilometer"==e&&(qr=5),"Nautical Miles"==e&&(qr=6),qr){case 1:Ir="mm",jr="mmÂ²",_r=1;break;case 2:Ir="cm",jr="cmÂ²",_r=10;break;case 3:Ir="dm",jr="dmÂ²",_r=100;break;case 4:Ir="m",jr="mÂ²",_r=1e3;break;case 5:Ir="km",jr="kmÂ²",_r=1e6;break;case 6:Ir="nmi",jr="nmiÂ²",_r=1852e5}else Bs.getCurrentpage().scaleObject.metricUnit(e)}function Mu(e){if(jh())switch("Inch"==e&&(qr=1),"Feet"==e&&(qr=2),"Yard"==e&&(qr=3),"Mile"==e&&(qr=4),"Nautical Miles"==e&&(qr=5),qr){case 1:Ir="in.",jr="sq.in.",_r=1;break;case 2:Ir="ft.",jr="sq.ft.",_r=12;break;case 3:Ir="yd.",jr="sq.yd.",_r=36;break;case 4:Ir="mi.",jr="sq.mi",_r=63360;break;case 5:Ir="nm",jr="sq.nm",_r=72913.3858}else Bs.getCurrentpage().scaleObject.imperialUnit(e)}function Tu(e){var t=0,a=0;if(jh())if("Calibration"!=e){var i=e.split(":");t=i[0],a=i[1],Or=Ts?a/t:t/a}else Or=Lr;else Bs.getCurrentpage().scaleObject.setMeasureScale(e),Bs.bMarkupchanged=!0}function Eu(e){Bs.getCurrentpage().scaleObject.setScaleLabel(e)}function Fu(e){lu().scaleObject.setDimPrecision(e)}function Fu(e){lu().scaleObject.setDimPrecision(e)}function Iu(e,t,i,r,s,o){var l={x:e+i,y:t+r};if(Bn({x:e,y:t})&&Bn(l)){if(null!=s){var c=new Fo(9,2,0);c.settxtboxArrow(s)}else c=new Fo(9,1,0);switch(c.x=e,c.y=t,Bs.getCurrentpage().drotation){case 0:case 90:case 180:case 270:c.w=i,c.h=r}c.pagerotation=Bs.getCurrentpage().drotation,c.pagenumber=Bs.getcurPage(),c.viewname=Bs.getcur3DView(),null!=c.viewname&&(c.bfor3D=!0,c.pageheight=Aa,c.pagewidth=Na),c.font.setFontname(tn.fontName),c.font.setHeight(tn.height),c.font.setBold(tn.bold),c.font.setItalic(tn.italic),c.fillcolor="rgba(255,255,255, 0.9)",c.scaling=Ln();var h=jn();return c.xoffset=h.x,c.yoffset=h.y,c.seteditaction(0),c.setselectedit(!0),c.setselect(!1),c.text=o,c.savemetolistDraw(),Cr&&(-1!=Bs.selectedmarkup.id&&null!=Bs.markuplist[Bs.selectedmarkup.id]&&(Bs.markuplist[Bs.selectedmarkup.id].setselectedit(!1),Bs.markuplist[Bs.selectedmarkup.id].setselect(!1)),al(n),il(a)),Bs.selectedmarkup.id=Bs.getmarkupbynumber(c.markupnumber),Bs.selectedmarkup.edit=!0,Bs.selectedmarkup.selected=!0,c}}function ju(e,a,i,r,s){if(i<20&&(i=20),r<12&&(r=12),Bn({x:e+i,y:a+r})){var n=Iu(e,a,i,r,s,"");if(null!=Bt){var o=t.getBoundingClientRect();e+=.5*i,a+=.5*r,e+=o.left,a+=o.top,Bt.operation.start=!0,Bt.operation.create=!1,Bt.operation.edit=!1,Bt.operation.save=!1,Bt.operation.markup=n;var l=new kn(e,a,i,r);l.rotation=Bs.getCurrentpage().drotation;var c=ll();l.x=(l.x-o.left)/c+o.left,l.y=(l.y-o.top)/c+o.top,l.w=l.w/c,l.h=l.h/c,Bt.setTextInput(l)}Cr||nd("markupedit",{p1:!1})}}function Ou(e,t,i,r,s){if(i<200&&(i=200),r<124&&(r=124),Bn({x:e+i,y:t+r})){for(var n,o=0,l=0;l<ts.length;l++)ts[l]==s&&(o=l);(n=new Fo(12,o,1)).fillcolor="rgba(255,0,0,0.3)",n.transparency=30,o<ts.length-2?n.text=ts[o]:("Date"==ts[o]&&(n.text=n.GetDateTime(!1)),"User Name"==ts[o]&&(n.text=Pn(n.signature))),n.w=i,n.h=r,n.scaling=Ln();var c=jn();n.xoffset=c.x,n.yoffset=c.y,c.x,Bs.getCurrentpage().endx,c.y,Bs.getCurrentpage().endy,n.font.setFontname("Times New Roman"),n.font.setBold(!0),n.pagenumber=Bs.getcurPage(),n.viewname=Bs.getcur3DView(),null!=n.viewname&&(n.bfor3D=!0,n.pageheight=Aa,n.pagewidth=Na),n.seteditaction(0),.6*n.w>=n.h?n.font.setHeight(n.h/4):n.font.setHeight(.16*n.w),n.stampsmalltheight=16,n.x=e,n.y=t,Cr||(gr=!0),Dr=Bs.markuplist.length,n.drawme(a),n.savemetolistDraw(),Hc(),Bs&&(Bs.bMarkupchanged=!0),n=null,Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}}function Lu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.arc(t,a,i,0,2*Math.PI),e.closePath(),e.lineWidth=s,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Vu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t,a-i),e.lineTo(t+i,a),e.lineTo(t,a+i),e.lineTo(t-i,a),e.lineTo(t,a-i),e.closePath(),e.lineWidth=s,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Nu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a-i),e.lineTo(t,a+i),e.lineTo(t-i,a-i),e.closePath(),e.lineWidth=s,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Au(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a-i),e.lineTo(t+i,a+i),e.lineTo(t-i,a+i),e.lineTo(t-i,a-i),e.closePath(),e.lineWidth=s,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}function Bu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t-i,a-i),e.lineTo(t+i,a+i),e.moveTo(t-i,a+i),e.lineTo(t+i,a-i),e.lineWidth=s,e.strokeStyle=o,e.stroke(),e.restore()}function Uu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t,a-i),e.lineTo(t,a+i),e.moveTo(t-i,a),e.lineTo(t+i,a),e.lineWidth=s,e.strokeStyle=o,e.stroke(),e.restore()}function Gu(e,t,a,i,r,s,n,o){e.save(),e.beginPath(),e.moveTo(t-r,a),e.lineTo(t,a+r),e.lineTo(t+i,a-r),e.lineWidth=s,e.strokeStyle=o,e.stroke(),e.restore()}function Hu(e,t,a,i,r,s,n,o){e.save();var l=0,c=Math.PI/2*3,h=t,u=a,d=Math.PI/5;for(e.beginPath(),e.moveTo(t,a-i),l=0;l<5;l++)h=t+Math.cos(c)*i,u=a+Math.sin(c)*i,e.lineTo(h,u),c+=d,h=t+Math.cos(c)*r,u=a+Math.sin(c)*r,e.lineTo(h,u),c+=d;e.lineTo(t,a-i),e.closePath(),e.lineWidth=s,e.fillStyle=n,e.strokeStyle=o,e.fill(),e.stroke(),e.restore()}const zu=function(e,t){return new Promise((function(a,i){var r=document.createElement("img"),s=document.createElement("canvas");r.onload=function(i){var n=i.target||i.srcElement;if(s.width=n.naturalWidth,s.height=n.naturalHeight,s.width>0)var o=t/s.width;else o=1;s.getContext("2d").drawImage(r,0,0);var l=mn(s,o);e.thumbnail=l,e.width=l.width,e.height=l.height,a(e)},r.onerror=function(e){i()},r.src=e.image.src}))};function Wu(){if(Ka&&!jh()){var e=rl();Bs.getCurrentpage().usevector3Dxml&&e||nd("markupedit",{p1:!1})}}function _u(e){i.style.cursor=e,u.domElement.style.cursor=e,s.style.cursor=e,t.style.cursor=e}function Xu(e,a,r){if(Ka&&!jh()&&Bs.getCurrentpage().usevector3Dxml)if("Walkthrough3D"!=Bs.curcontrol3D&&"orbitControl"!=Bs.curcontrol3D||"select3d"!=a){var n=e?a:Bs.curcontrol3D;i.style.cursor="default",u.domElement.style.cursor="default",s.style.cursor="default",t.style.cursor="default","select3d"!=n&&Bs.getCurrentpage().unselect3DBlockAll(),Ho(),Uo(),Bs.getCurrentpage().unSelect3DmarkupAll(),"markupedit"==n&&(r={p1:!1}),nd(n,null==r?{}:r)}else e||Bs.getCurrentpage().unselect3DBlockAll(),As&&As.setSelect(e,r.p1)}function Yu(e){for(var t="default",a=0;a<Qr.length;a++)e==Qr[a].name&&(t=Qr[a].cursor);return t}function qu(e,t,a,i){Ls.push(new Ks(e,t,a,i))}function Zu(e){Bs.getCurrentpage().scaleObject.setDimPrecision(e)}function Ju(e,t){if(Ka){if(t){var i=e;if(null==Bs.markuplist[i])return}else i=Bs.getmarkupbynumber(e);Bs.markuplist.length-1<i||Bs.markuplist[i].locked||(t?function(e){null!=Bs.markuplist[e]&&(Bs.markuplist[e].selected&&(Bs.markuplist[e].setselect(!1),Bs.markuplist[e].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[e])),Bs.markuplist[e].selectedit&&(Bs.markuplist[e].setselectedit(!1),Bs.markuplist[e].bpointEdit=!1,Bs.markuplist[e].bUsemouseinput=!0,null!=Yt&&Yt.setMarkupunSelected(Bs.markuplist[e])))}(e):Ao(e),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n),il(a))}}function Ku(e,t,a,i){var s,n;if(e&&(Ya=e.width,qa=e.height,!Ka))if(s=(Na-1*Ya*t)/2+a,n=0+i,1==t)r.drawImage(e,s,n,Ya*t,qa*t);else{var o=mn(e,t);r.drawImage(o,s,n,Ya*t,qa*t),o=null}}function Qu(e){Bs.getcurPage()!=e.pagenumber?au(e.pagenumber).then((function(t){Bs.panToMarkup(e)})):Bs.panToMarkup(e)}function $u(e,t){if(!jh()){var i=!0;if(t){var r=e;if(null==Bs.markuplist[r])return}else r=Bs.getmarkupbynumber(e);if(-1!=r){var s=Bs.markuplist[r].selected||Bs.markuplist[r].selectedit;if(!Bs.markuplist[r].locked&&(As&&(i="markupedit"!=As.name),!i)){if(Vs.isactive?(Ao(e),$i||Bs.getMarkupMultiselected()||(Ho(),Uo())):$i||Bs.getMarkupMultiselected()||(Ho(),Uo()),null!=Bs.markuplist[r].viewname&&Bs.markuplist[r].bfor3D&&Bs.getcur3DView()!=Bs.markuplist[r].viewname&&Bs.getCurrentpage().restoreCameraByName(Bs.markuplist[r].viewname),Bs.markuplist[r].signature!=hs)return Bs.markuplist[r].setmarked(!0),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n),il(a),void(er&&Qu(Bs.markuplist[r]));Bs.markuplist[r].multipoint()?s||Bs.markuplist[r].setselectedit(!0):s||(Bs.markuplist[r].setselect(!0),Bs.markuplist[r].lengthangleCallbackSelect()),null!=_t&&null!=Bs.markuplist[r]&&(9==Bs.markuplist[r].type&&2==Bs.markuplist[r].subtype?_t.setMarkupSelected(Bs.markuplist[r].markupArrowConnected,{created:!1,modified:!1,deleted:!1}):_t.setMarkupSelected(Bs.markuplist[r],{created:!1,modified:!1,deleted:!1})),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n),il(a),er&&Qu(Bs.markuplist[r])}}}}function ed(e,t,a){const i=ll();var r,s,n=e.getBoundingClientRect();return t&&t.targetTouches&&t.targetTouches[a]?(r=t.targetTouches[a].pageX-n.left,s=t.targetTouches[a].pageY-n.top):t&&t.changedTouches&&t.changedTouches[a]&&(r=t.changedTouches[a].pageX-n.left,s=t.changedTouches[a].pageY-n.top),{x:r*i,y:s*i,xus:r,yus:s,xpadding:r*i,ypadding:s*i,busepadding:!1}}function td(e,t){const a=ll();var i=e.getBoundingClientRect();return{x:(t.clientX-i.left)*a,y:(t.clientY-i.top)*a,xus:t.clientX-i.left,yus:t.clientY-i.top,xpadding:(t.clientX-i.left)*a,ypadding:(t.clientY-i.top)*a,busepadding:!1}}function ad(e,t,a,i,r){var s=Math.cos(r),n=Math.sin(r),o=a-e,l=i-t,c=new Gs(o*s-l*n,o*n+l*s);return c.x=e+c.x,c.y=t+c.y,c}function id(e){if(!Ka)return e;var t=Na/2,a=Aa/2,i=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var r=ad(t,a,e.x,e.y,i);e.x=r.x,e.y=r.y}return e}function rd(e,t,a){if(0!=Bs.getCurrentpage().drotation){var i=Na/2,r=Aa/2;e.translate(i,r),e.rotate(Bs.getCurrentpage().drotation*(Math.PI/180)),e.translate(-i,-r)}0!=t&&(i=Na/2,r=Aa/2,e.translate(i,r),e.rotate(t*(Math.PI/180)),e.translate(-i,-r)),e.lineWidth=1,e.strokeStyle="blue",e.strokeRect(a.x-5,a.y-5,10,10)}function sd(e,t){if(e.save(),0!=Bs.getCurrentpage().drotation){var a=Na/2,i=Aa/2;e.translate(a,i),e.rotate(Bs.getCurrentpage().drotation*(Math.PI/180)),e.translate(-a,-i)}e.lineWidth=1,e.strokeStyle="blue",e.clearRect(t.x-50,t.y-50,100,100),1==t.type&&e.strokeRect(t.x-5,t.y-5,10,10),2==t.type&&(e.beginPath(),e.moveTo(t.x-5,t.y-5),e.lineTo(t.x+5,t.y+5),e.moveTo(t.x+5,t.y-5),e.lineTo(t.x-5,t.y+5),e.stroke()),3==t.type&&(e.beginPath(),e.moveTo(t.x,t.y-5),e.lineTo(t.x+5,t.y+5),e.lineTo(t.x-5,t.y+5),e.lineTo(t.x,t.y-5),e.stroke()),e.restore()}function nd(e,t){As&&"pencil"==As.name&&As.started&&(As.apply(),Ho(),Uo());var a=rl(),i=function(){var e=!1;return jh()||null!=Bs.getCurrentpage()&&(e=Bs.getCurrentpage().usevector3Dxml),e}();a&&i&&"markupedit"==e&&(e=Bs.curcontrol3D),"orbitControl"==e||"Walkthrough3D"==e?(ti=!0,null!=Bs.getCurrentpage().Vector3DPageObj&&Bs.getCurrentpage().Vector3DPageObj.setcur3DViewnull()):ti=!(!a||!i),"orbitControl"==(As=new _s[e](t)).name&&null!=Bs.getCurrentpage().Vector3DPageObj&&Bs.getCurrentpage().Vector3DPageObj.setControl(As),"Walkthrough3D"==As.name&&null!=Bs.getCurrentpage().Vector3DPageObj&&Bs.getCurrentpage().Vector3DPageObj.setControl(As)}function od(e){if(e.layerX||0==e.layerY?(e._x=e.layerX,e._y=e.layerY):(e.offsetX||0==e.offsetY)&&(e._x=e.offsetX,e._y=e.offsetY),null!=As){var t=As[e.type];t&&t(e)}}function ld(e){console.log("we are connected")}function cd(e){console.log("connection closed")}function hd(e){console.log("message received")}function ud(){if(re&&ri){if(console.log("rxcorejs 36.3"),null!=fa&&(fa.setupComplete(pr),se=!0),null!=la){var e={consolidate:bs};la.UserPermissions(e)}re=!1}}function dd(e){try{e.getElementsByTagName("Context")[0].firstChild.nodeValue}catch(e){}try{var t=e.getElementsByTagName("Licensemode")[0].firstChild.nodeValue}catch(e){t=""}try{var a=e.getElementsByTagName("CompanyFeature")[0].firstChild.nodeValue}catch(e){a=""}""!=a&&(oi=!0,_a=a);try{var i=e.getElementsByTagName("ImgSwitchFactor")[0].firstChild.nodeValue}catch(e){Za=1.5}try{var r=e.getElementsByTagName("CurrentUserName")[0].firstChild.nodeValue}catch(e){r=""}try{var s=e.getElementsByTagName("DisplayName")[0].firstChild.nodeValue}catch(e){s=""}try{var n=e.getElementsByTagName("MarkupLayer")[0].firstChild.nodeValue}catch(e){n=""}try{var o=e.getElementsByTagName("MarkupColor")[0].firstChild.nodeValue}catch(e){o=""}try{var l=e.getElementsByTagName("XmlUrl")[0].firstChild.nodeValue}catch(e){l=""}try{var c=e.getElementsByTagName("XmlUrlmarkup")[0].firstChild.nodeValue}catch(e){c=""}try{var h=e.getElementsByTagName("MarkupSavePOSTOnly")[0].firstChild.nodeValue}catch(e){h=""}vi=""!=h&&"True"==h;try{var u=e.getElementsByTagName("XmlUrlRel")[0].firstChild.nodeValue}catch(e){u=""}try{var d=e.getElementsByTagName("MarkupSaveUrl")[0].firstChild.nodeValue}catch(e){d=""}try{var g=e.getElementsByTagName("ExportFile")[0].firstChild.nodeValue}catch(e){g=""}try{var f=e.getElementsByTagName("Image3DSave")[0].firstChild.nodeValue}catch(e){f=""}try{var y=e.getElementsByTagName("UseAuth")[0].firstChild.nodeValue}catch(e){y=""}try{var v=e.getElementsByTagName("AuthType")[0].firstChild.nodeValue}catch(e){v=""}try{var x=e.getElementsByTagName("AuthName")[0].firstChild.nodeValue}catch(e){x=""}try{var w=e.getElementsByTagName("AuthPass")[0].firstChild.nodeValue}catch(e){w=""}try{var k=e.getElementsByTagName("PrintPageURL")[0].firstChild.nodeValue}catch(e){k="printcanvas.htm"}try{e.getElementsByTagName("EnableMarkupEdit")[0].firstChild.nodeValue}catch(e){}try{var D=e.getElementsByTagName("CanChangeSignature")[0].firstChild.nodeValue}catch(e){D=""}try{var C=e.getElementsByTagName("CanConsolidate")[0].firstChild.nodeValue}catch(e){C=""}try{var P=e.getElementsByTagName("CanChangeLayer")[0].firstChild.nodeValue}catch(e){P=""}try{var S=e.getElementsByTagName("Readonlymarkup")[0].firstChild.nodeValue}catch(e){S=""}try{e.getElementsByTagName("EnableFileOpen")[0].firstChild.nodeValue}catch(e){}try{var R=e.getElementsByTagName("ReverseScale")[0].firstChild.nodeValue}catch(e){R=""}try{var M=e.getElementsByTagName("DefaultPenTable")[0].firstChild.nodeValue}catch(e){M=""}try{var E=e.getElementsByTagName("InitialDocument")[0].firstChild.nodeValue}catch(e){E=""}try{var F=e.getElementsByTagName("UseCustom")[0].firstChild.nodeValue}catch(e){F=""}try{var I=e.getElementsByTagName("Paperwidth")[0].firstChild.nodeValue}catch(e){I="794"}try{var O=e.getElementsByTagName("Paperheight")[0].firstChild.nodeValue}catch(e){O="1122"}try{var L=e.getElementsByTagName("ArrowSize")[0].firstChild.nodeValue}catch(e){L="20"}Ar=parseInt(L);try{var V=e.getElementsByTagName("LabelSize")[0].firstChild.nodeValue}catch(e){V="12"}Ur=parseInt(V);try{var A=e.getElementsByTagName("RefreshMarkup")[0].firstChild.nodeValue}catch(e){A=""}try{var B=e.getElementsByTagName("PDFZoomAll")[0].firstChild.nodeValue}catch(e){B=""}wi=""!=B&&"True"==B;try{var G=e.getElementsByTagName("PDFAnimateRender")[0].firstChild.nodeValue}catch(e){G=""}Si=""!=G&&"True"==G;try{var H=e.getElementsByTagName("NoRotateMarkup")[0].firstChild.nodeValue}catch(e){H=""}try{var z=e.getElementsByTagName("layer");if(z.length>0)for(var W=0;W<z.length;W++){var _=z[W].getElementsByTagName("name")[0].firstChild.nodeValue,X=z[W].getElementsByTagName("color")[0].firstChild.nodeValue,Y=z[W].getElementsByTagName("number")[0].firstChild.nodeValue;if("on"==z[W].getElementsByTagName("state")[0].firstChild.nodeValue)var q=!0;else q=!1;as[W]=new Cn(Y,X,_,q)}}catch(e){Zn()}try{var Z=e.getElementsByTagName("stamp");if(Z.length>0){for(var J=0;J<Z.length;J++)ts[J]=Z[J].firstChild.nodeValue;ts[J]="Date",ts[J+1]="User Name"}else ts=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"]}catch(e){ts=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"]}var K;ts.length>0&&null!=It&&It.setMarkupStamps(ts),""!=t&&(Xi=t),""!=i&&(Za=parseFloat(i)),""!=r&&(hs=r),""!=s&&(us=s),""!=n&&(rs=parseInt(n)),""!=o&&(ss=o,os=o,ls=o),es[0]=new Dn(hs,us,rs,ss),null!=Ce&&Ce.setUserlist(es,!0),""!=l&&(p=l),""!=c&&(m=c),""!=u&&(U=u),""!=d&&(b=d),""!=g&&(j=g),""!=f&&(N=f),""!=k&&k,ws=""!=S&&"True"==S,pi=""!=H&&"True"==H,""!=y&&(ks="True"==y),""!=v&&(Ps=v),""!=x&&(Ss=x),""!=w&&(Rs=w),vs=""!=D&&"True"==D,bs=""!=C&&"True"==C,ys=""!=P&&"True"==P,Ts=""!=R&&"True"==R,Ms=""!=A&&"True"==A,""!=M&&(mr=!0,K=M,null!=T&&Kc("GET",T+"&"+K,"").then((function(e){var t=e.substr(0,e.length-2);fr=Object.freeze(JSON.parse(t)),null!=Se&&Se.setPentablelist(fr,!0)})).catch((function(e){e.status?console.log("defaultpentable",e.status):console.log(e)}))),""!=E&&(ur=!0,dr=E,pr.open=ur,pr.url=dr),pr.custom=""!=F&&"True"==F,new wn(I,O),re=!0,Mc(),ud()}function pd(e,t){t&&(t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)}function gd(e){r&&(r.imageSmoothingQuality="high",r.imageSmoothingEnabled=e,r.mozImageSmoothingEnabled=e,r.msImageSmoothingEnabled=e)}function md(e,t,a){var i,r,s=t,n=a;const o=ll();var l=e.style;return e.width=Math.floor(t*o),e.height=Math.floor(a*o),i=Math.floor(t*o),r=Math.floor(a*o),1!=o&&(l.width=t+"px",l.height=a+"px",s=t,n=a),{awidth:i,aheight:r,swidth:s,sheight:n}}function fd(t,a){if(ll(),t=t||ve.offsetWidth,a=a||ve.offsetHeight,e.offsetParent&&(ve.absolute||(t+=e.offsetParent.offsetLeft,a+=e.offsetParent.offsetTop)),ve.absolute){var r=md(i,t,a);Na=r.awidth,Aa=r.aheight,Ba=r.swidth,Ua=r.sheight}else r=md(i,window.innerWidth-t,window.innerHeight-a),Na=r.awidth,Aa=r.aheight,Ba=r.swidth,Ua=r.sheight;if(!jh()){if(Ka&&!Bs.getCurrentpage().usevector3Dxml){i.width;window.innerWidth,Bs.getCurrentpage().usevectorxml}Ka&&Bs.getCurrentpage().usepdfjs,gd(!1)}}function yd(e,o,l){if(i){if(fd(o,l),md(s,Ba,Ua),md(t,Ba,Ua),md(u.domElement,Ba,Ua),jh()){if(!J){Ya=zs.naturalWidth,qa=zs.naturalHeight;var c=i.height/qa,h=Na/Ya,d=Math.min(h,c),p=(Na-Ya*d)/2,g=(i.height-qa*d)/2;a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),zc(zs,p,g,d)}}else Bs.getCurrentpage().usevector3Dxml&&(u.setSize(Ba,Ua),Bs.getCurrentpage().camera&&(Bs.getCurrentpage().camera.aspect=Ba/Ua,Bs.getCurrentpage().camera.updateProjectionMatrix())),Bs.getCurrentpage().resize();if(e){if(null!=$t){var m={w:Na,h:Aa};$t.onResize(m)}}else null!=ea&&(m={w:Na,h:Aa},ea.onResize(m))}}function vd(){if(null!=Bt&&Bs&&Bs.selectedmarkup&&Bs.selectedmarkup.edit){Bt.operation.edit=!1,Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.save=!0,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var e=t.getBoundingClientRect(),a=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+e.left,i=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+e.top,r=Bs.markuplist[Bs.selectedmarkup.id].wscaled,s=Bs.markuplist[Bs.selectedmarkup.id].hscaled,n=new kn(a,i,r,s);n.rotation=Bs.getCurrentpage().drotation;var o=ll();n.x=(n.x-e.left)/o+e.left,n.y=(n.y-e.top)/o+e.top,n.w=n.w/o,n.h=n.h/o,Bt.setTextInput(n),Bs.markuplist[Bs.selectedmarkup.id].setselectedit(!1),Bs.markuplist[Bs.selectedmarkup.id].setselect(!1),Bs.selectedmarkup.edit=!1}}function bd(){return{areaUnitlabel:jr,bMarkupNoLabel:Es,compareObj:Us,docObj:Bs,bdirectPDF:Bs.directPDF,onPrintpage:Pa,onPrintCompare:Sa,documentcompare:$a,getDisplayName:Pn,getHatch:co,getPageObject:Vc,getPaperHeight:Lc,getPaperWidth:Oc,getPrintRect:jc,markupprintlist:$r,measureScale:Or,printfocus:Gc,stampList:ts,Userlist:es,unitLabel:Ir,unitOfMeasure:Fr,unitscale:_r,getUnitArea:vo,xmlurlrel:U,bUseCustomrelpath:Q,xmlurlrelcustom:ae,noteimage:Ns,bUseFixedScale:ui,fixedScale:Bs.getCurrentpage().fixedScale}}function xd(){return{getUnitLabel:function(){return Bs.getCurrentpage().scaleObject.AreaUnitlabel},getAreaUnitLabel:function(){return Bs.getCurrentpage().AreaUnitlabel},getLength:function(e){return ko(e/Ln())}}}return De=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setActiveFile=function(e){"function"==typeof t.callback&&t.callback(e)}}},Mt=new wh,Tt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockID=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Dt=new wh,Ct=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.set2DBlockInfo=function(e){this.info=e,"function"==typeof t.callback&&t.callback(e)}}},Pt=new kh,St=new kh,Rt=new kh,yt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setCameraSave=function(e,t,a){a||this.notify(e,t)}}},Ge=new xh,vt=new Dh,bt=new Dh,xt=new Dh,_e=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.renderComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},Xe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setXMLreturn=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},mt=new class{constructor(e){var t=this;this.listheight=0,this.isupdate=!1,this.scrollto=0,this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.setlistHeight=function(e){t.listheight=e},this.set3DParts=function(e){this.parts=e,"function"==typeof t.callback&&t.callback(e)}}},ft=new xh,ta=new class{constructor(e){var t=this;this.callback=e,this.elementSet=!1,this._wheelImg=void 0,this.connect=function(e){t.callback=e},this.setDivElement=function(e){sh(e),this.elementSet=!0},this.setWalkthroughGUI=function(e){"function"==typeof t.callback&&t.callback(e)}}},Vt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getUnitlabel=function(){return Bs.getCurrentpage().scaleObject.Unitlabel},this.setCalibration=function(e){var t=-1;Ka?(Lr=Bs.getCurrentpage().scaleObject.setCalibration(e),t=Bs.getCurrentpage().pagenumber):e?0!=Nr&&(Or=Lr=1/(Lr=Vr/Nr)):Lr=1;var a={calibratescale:Lr,pagenumber:t};null!=Nt&&Nt.onCalibrate(a)},this.SetTempCal=function(e){Nr=e},this.setCalibrateScaleByLength=function(){0!=Nr&&(Lr=1/(Lr=Vr/Nr))},this.setCalibrateScale=function(e){Lr=e},this.getMeasureScale=function(){return Lr},this.setCalibrate=function(e){"function"==typeof t.callback&&t.callback(e)}}},Nt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onCalibrate=function(e){"function"==typeof t.callback&&t.callback(e)}}},aa=new Th,Jt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.cameraPos=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},Kt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.drawbirdseye=function(){"function"==typeof t.callback&&t.callback()}}},ra=new Th,sa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.AlignComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ra=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.AlignMeasure=function(e,a,i,r,s){"function"==typeof t.callback&&t.callback(e,a,i,r,s)}}},na=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.Consolidatevt=function(){"function"==typeof t.callback&&t.callback(Vs)}}},oa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.Consolidatevt=function(e){"function"==typeof t.callback&&t.callback(e)}}},la=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.UserPermissions=function(e){"function"==typeof t.callback&&t.callback(e)}}},ca=new class{constructor(e){var t=this;this._pagesRefCache=Object.create(null),this.callback=e,this.connect=function(e){t.callback=e},this.getPageRef=function(e){var a=-1;if(Bs.getCurrentpage().usepdfjs){var i=e.num+" "+e.gen+" R";null!=t._pagesRefCache[i]&&(a=t._pagesRefCache[i])}return a},this.setPageRef=function(e){t._pagesRefCache=e},this.setPDFBookmarks=function(e){"function"==typeof t.callback&&t.callback(e)}}},Qt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setDownload=function(e){"function"==typeof t.callback&&t.callback(e)}}},je=new Ph,Oe=new Ph,Le=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getUnitlabel=function(){return Bs.getCurrentpage().scaleObject.Unitlabel},this.setFileInfo=function(e){this.fileinfo=e,"function"==typeof t.callback&&t.callback(e)}}},ia=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setEvent=function(e){"function"==typeof t.callback&&e.addEventListener("contextmenu",t.callback,!1)}}},He=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.closeComplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},ze=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.guidcomplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},Ve=new Ph,he=new Ph,Ne=new Ph,Ye=new Ph,Ue=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.compareComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},qe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},Ze=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setFloorLevel=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},Qe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.navClick=function(e){"function"==typeof t.callback&&t.callback(e)}}},ht=new Ph,Je=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},Ie=new ph,Ae=new ph,Be=new dh,zt=new gh,_t=new gh,kt=new gh,Wt=new gh,ue=new yh,$e=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.viewEvent=function(e){"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},Ee=new hh,Fe=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getCurMarkupLayer=function(){return rs},this.getCanChangelayer=function(){return ys},this.SetLayerMarkupdisplay=function(e,t){var i=0;for(as[e].display=t,i=0;i<Bs.markuplist.length;i++){var r=Sn(Bs.markuplist[i].signature);Bs.markuplist[i].layer==as[e].Layer&&r&&Bs.markuplist[i].setdisplay(as[e].display)}al(n),il(a)},this.setMarkupLayers=function(e){"function"==typeof t.callback&&t.callback(e)}}},Et=new Rh,Ft=new Rh,wt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getDisplayName=function(e){return Pn(e)},this.getDisplayDate=function(e){return GetDateTime(e)},this.notify=function(e,a){"function"==typeof t.callback&&t.callback(e,a)},this.setMarkupList=function(e,t,a){this.markupList=e,a||this.notify(e,t)}}},Xt=new dh,qt=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setdimtext=function(e){"function"==typeof t.callback&&t.callback(e)}}},Yt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setMarkupunSelected=function(e){"function"==typeof t.callback&&t.callback(e)}}},Lt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getLength=function(e){return xd.getLength(e)},this.getUnitlabel=function(){return Bs.getCurrentpage().scaleObject.Unitlabel},this.getAreaUnitlabel=function(){return Bs.getCurrentpage().scaleObject.AreaUnitlabel},this.setMeasureresult=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ut=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.isAvailable=function(){return null!=yo()&&-1!=yo().id&&10==Bs.markuplist[yo().id].type},this.getText=function(){return t.isAvailable?Bs.markuplist[yo().id]:null},this.setText=function(e){t.isAvailable&&(null!=Bs.markuplist[yo().id]&&(Bs.markuplist[yo().id].text=e),al(n),il(a))},this.setNotediag=function(e,a){if("function"==typeof t.callback)if(""==e||"."==e){if(null==yo())return;Bs.markuplist[yo().id].text=t.callback("")}else t.callback(e,a)}}},et=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},tt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.loadComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},at=new Ch,it=new Ch,rt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.PassWordRequest=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},st=new yh,ot=new fh,lt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setFloorCanvas=function(e,a,i){"function"==typeof t.callback&&t.callback(e,a,i)}}},nt=new fh,ct=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getHeight=function(){return Aa},this.getCurrentPage=function(){return Bs.getcurPage()},this.hasmarkup=function(e){for(var t=!1,a=0;a<Bs.markuplist.length;a++)Bs.markuplist[a].pagenumber==e&&(t=!0);return t},this.notify=function(){"function"==typeof t.callback&&t.callback(this.pageindex,this.thumbnail)},this.setThumbnail=function(e,t){this.thumbnail=t,this.pageindex=e,this.notify()}}},$t=new nh,ea=new nh,It=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setMarkupStamps=function(e){"function"==typeof t.callback&&t.callback(e)}}},jt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onStampReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ot=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onSymbolReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Gt=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setGUIState=function(e){this.state=e,"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},Ht=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.pageEvent=function(e){"function"==typeof t.callback&&void 0!==t.callback&&t.callback(e)}}},de=new ch,ha=new ch,ua=new ch,At=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setText=function(e){null!=Bs.markuplist[yo().id]&&(Bs.markuplist[yo().id].text=e,Bs.markuplist[yo().id].AdjustForRotation(!1),al(n),il(a))},this.setTextdiag=function(e){"function"==typeof t.callback&&(""==e||"."==e?(Bs.markuplist[yo().id].text=t.callback(""),Bs.markuplist[yo().id].AdjustForRotation(!1),al(n),il(a)):t.callback(e))}}},Bt=new class{constructor(e){var t=this;this.callback=e,this.operation={start:!1,create:!1,edit:!1,save:!1,markup:void 0},this.connect=function(e){t.callback=e},this.getText=function(e){return null==Bs||null==Bs.markuplist?null:null!=Bs.markuplist[yo().id]?Bs.markuplist[yo().id]:null},this.getTextinitset=function(){return null!=Bs&&null!=Bs.markuplist&&(null!=Bs.markuplist[yo().id]?Bs.markuplist[yo().id].intialtextset:void 0)},this.setText=function(e){null!=Bs&&null!=Bs.markuplist&&null!=Bs.markuplist[yo().id]&&(t.operation.edit=!1,t.operation.start=!1,t.operation.create=!1,t.operation.save=!1,Bs.markuplist[yo().id].text=e,Bs.markuplist[yo().id].intialtextset=!0)},this.setSize=function(e){null!=Bs&&null!=Bs.markuplist&&null!=Bs.markuplist[yo().id]&&(t.operation.edit=!1,t.operation.start=!1,t.operation.create=!1,t.operation.save=!1,Bs.markuplist[yo().id].setSize(e))},this.setTextInput=function(e){"function"==typeof t.callback&&t.callback(e,t.operation)}}},Zt=new class{constructor(e){var t=this;this.callback=e,this.progress=0,this.connect=function(e){t.callback=e},this.setUpload=function(e){"function"==typeof t.callback&&t.callback(e)}}},We=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.listempty=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Ce=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.getSignature=function(){return hs},this.setSignature=function(e){hs=e},this.getCanChangeSign=function(){return vs},this.SetUserMarkupdisplay=function(e,t){var i=0;for(es[e].display=t,i=0;i<Bs.markuplist.length;i++){var r=Mn(Bs.markuplist[i].layer);Bs.markuplist[i].signature==es[e].Signature&&r&&Bs.markuplist[i].setdisplay(es[e].display)}al(n),il(a)},this.setUserlist=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},Pe=new mh,Se=new mh,Re=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setAutoPenLoad=function(){"function"==typeof t.callback&&t.callback()}}},Me=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onSignReceived=function(e){"function"==typeof t.callback&&t.callback(e)}}},Te=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.oncomplete=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},pt=new bh,gt=new bh,ut=new vh,dt=new vh,da=new oh,pa=new oh,va=new lh,new lh,ga=new hh,fa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setupComplete=function(e){"function"==typeof t.callback&&t.callback(e)}}},ya=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onRotate=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},ba=new class{constructor(e){var t=this;this.hastext=!1,this.callback=e,this.connect=function(e){t.callback=e},this.hasText=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},wa=new uh,ka=new uh,Da=new uh,xa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setHatchchange=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ca=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setInput=function(e){"function"==typeof t.callback&&t.callback(e)}}},Pa=new class{constructor(){var e=this;this.callback=void 0,this.connect=function(t){e.callback=t},this.printpageComplete=function(t){"function"==typeof e.callback&&void 0!==e.callback&&e.callback(t)}}},Sa=new class{constructor(){var e=this;this.callback=void 0,this.connect=function(t){e.callback=t},this.printCompareComplete=function(t){"function"==typeof e.callback&&void 0!==e.callback&&e.callback(t)}}},Ma=new Sh,Ta=new Sh,Ea=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.onDrawError=function(e){"function"==typeof t.callback&&t.callback(e)}}},Fa=new class{constructor(e){var t=this;this.callback=e,this.connect=function(e){t.callback=e},this.setRespHeaders=function(e){"function"==typeof t.callback&&t.callback(e)}}},Ia=new class{constructor(e){var t=this;this.callback=e,this.showContext=!1,this.connect=function(e){t.callback=e},this.setMarkupMeasureRealTimeData=function(e,a){"function"==typeof t.callback&&t.callback(e,a)}}},{abortPDFload:function(e){mi=e,du()},add3Dsymbol:function(e,t){Xu(e,"add3dsymbol",{p1:t})},addGltftoDoc:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&function(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="<RxViewServer>",t+="<Command>GetFile</Command>",t+="<LicenseID>"+_i+"</LicenseID>",t+="<FileURL>"+e+"</FileURL>",Jc("POST",p,t+="</RxViewServer>").then((function(e){var t,a=0,i=U,r=e.getElementsByTagName("Layout");for(t=0;t<r.length;t++){r[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;var s=r[t].getElementsByTagName("Page");for(a=0;a<s.length;a++)if(0==a&&0==t&&null!=s[a].getElementsByTagName("VectorGLTF3DSRC")[0]){var n=encodeURI(i+s[a].getElementsByTagName("VectorGLTF3DSRC")[0].firstChild.nodeValue),o=encodeURI(i+s[a].getElementsByTagName("VectorMetadataSRC")[0].firstChild.nodeValue);Bs.getCurrentpage().addtoGLTFScene(n,o)}}})).catch((function(e){Eh("getFileaddtoGLTF",e)}))}(e)},addSignature:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("symbol",{p1:4}):nd("markupedit",{p1:!1})))},addMovableSignature:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("symbol",{p1:5}):nd("markupedit",{p1:!1})))},updateScaleList:function(e){Bs.scalesOptions=e},allowPolygonMove:function(e){Oi=e},autoHyperlink:function(e){La=e},measure3D:function(e){Xu(e,"measure3D",null)},create3DTexture:qu,addMarkup:function(e){var t=Jn(e);if(null!=t.getElementsByTagName("FileVersion")&&0!=t.getElementsByTagName("FileVersion").length)var a=t.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=t.getElementsByTagName("Entity")){for(var i=t.getElementsByTagName("Entity"),r=0;r<i.length;r++){var s=i[r].getElementsByTagName("Type")[0].firstChild.nodeValue,o=i[r].getElementsByTagName("Subtype")[0].firstChild.nodeValue,l=i[r].getElementsByTagName("Alternative")[0].firstChild.nodeValue,c=i[r].getAttribute("ID")?i[r].getAttribute("ID"):null;if(null!=i[r].getElementsByTagName("HaveLeader")[0])var h=1==parseInt(i[r].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(h&&null!=i[r].getElementsByTagName("Entity")[0]){var u=i[r].getElementsByTagName("Entity")[0],d=u.getElementsByTagName("Type")[0].firstChild.nodeValue,p=u.getElementsByTagName("Subtype")[0].firstChild.nodeValue,g=u.getElementsByTagName("Alternative")[0].firstChild.nodeValue;u.getAttribute("ID")&&u.getAttribute("ID"),d=parseInt(d),p=parseInt(p),g=parseInt(g);var m=new Fo(d,p,g),f=m.SetfromXML(Bs,u,a);f&&(i[r].removeChild(u),m.savemetolistLoad(Bs,!1))}s=parseInt(s),o=parseInt(o),l=parseInt(l);var y=new Fo(s,o,l);if(y.markupID=c,y.SetfromXML(Bs,i[r],a)&&(f&&h&&null!=m&&(y.bhasArrow=h,y.markupArrowConnected=m,m.bisTextArrow=!0,m.textBoxConnected=y,m.setArrowPoint(y),f=!1,h=!1),y.savemetolistLoad(Bs)),null!=i[r].getElementsByTagName("Signature")[0].firstChild.nodeValue){var v=i[r].getElementsByTagName("Signature")[0].firstChild.nodeValue;if(null!=i[r].getElementsByTagName("Name")[0].firstChild.nodeValue)var b=i[r].getElementsByTagName("Name")[0].firstChild.nodeValue;if(v&&b&&"default user"==Pn(v)){es.length;var x=Rn(y.layer);es.push(new Dn(v,b,y.layer,x,!1)),es.length}}}y&&y.notify(),0==i.length&&null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n)}},addHoverforBlock:function(e,t){if(!jh()&&e&&Bs.getCurrentpage().usevectorxml){var a=Bs.getCurrentpage().getpolygonPathbypathIndex(e);if(null!=a){var i=function(e,t){var a=t.points[0],i=t.points[1],r=[];r.push({x:a,y:i});for(var s=0,n=0,o=2;o<t.points.length;o+=2)s=t.points[o],n=t.points[o+1],r.push({x:s,y:n});var l=qn(r),c=[];if(t.gotsubpath)for(var h=0;h<t.subpaths.length;h++){for(o=0;o<t.subpaths[h].points.length;o+=2)s=t.subpaths[h].points[o],n=t.subpaths[h].points[o+1],c.push({x:s,y:n});var u=qn(c);u>l&&(r=c.slice(),c=[],l=u)}return{path:r,color:e}}(t,a);Bs.addHoverSpace(i),al(n)}}},alignCompare:function(e){if(!jh()){Ho(),Uo();var t=eu();null!=t&&t.scalecomparepage(e)}},alignCompareEx:function(e,t){if(!jh()){Ho(),Uo();for(var a=0;a<Xs.length;a++)if(Xs[a].fileindex==t){Xs[a].scalecomparepage(e);break}}},appendCustomBlockAttribute:function(e,t,a){jh()||$a||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().appendCustomBlockAttribute(e,t,a)},animateLineStyle:wu,applyAngleLength:function(e,t,a,i){As.anglelengthsupport&&As.started&&As.setAngleLength(e,t,a,i)},applyAngleLengthSelected:xu,applyMarkup:function(){As.anglelengthsupport&&As.started&&As.apply()},applyRadiusSelected:function(e){xu(0,e)},applyWidthHeight:function(e,t){As.anglelengthsupport&&As.started&&As.setWidthHeight(e,t)},applyWidthHeightSelected:function(e,i){var r=Oo();if(!r.isempty&&r.widthHeightsupport){r.w,r.h;var s=r.setWidthHeightEdit(e,i),o={x:r.x+s.w,y:r.y+s.h};a.clearRect(0,0,t.width,t.height),Bn(o)?(r.w=s.w,r.h=s.h,al(n),il(a),r.lengthangleCallbackSelect()):(al(n),il(a),null!=Ea&&Ea.onDrawError("outside"))}},attributeMask:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().filterAttributes(e)},autoLoadThumbnails:function(e){Mi=e},backgroundColor:function(e){Yi=e},backgroundCustomColor:function(e){Ka&&(Ki=e,Qi=!0,Bs.backgroundColor=Ki,Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().draw_vector(!0),al(n))},blockhoverevent:function(e){Ii=e},blockLoadMask:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().filterBlocks(e)},calibrate:function(e){Ka&&(Ho(),Uo(),e?(Bs.getCurrentpage().enableSnap(!0),nd("calibrate",{})):(Bs.getCurrentpage().enableSnap(!0),nd("markupedit",{p1:!1})))},canvToImage:function(){jh()||Ka&&(Ho(),Uo(),Bs.getCurrentpage().usevector3Dxml&&Kl())},change3DVectorBlock:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().turn3DBlockOnOff(e,!1)},set3DBlockState:function(e,t){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().state3dBlock(e,t,!1)},set3DBlockStateAll:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().state3dBlockAll(e,!1)},changeFillColor:function(e){qh(e,0)},changeFillColorByIndex:function(e,t){!function(e,t,a){if(!jh()&&!ws&&null!=t&&"string"==typeof t){null!=t.match(/rgb/gi)&&(t=dn(t));var i=ss;switch(a){case 1:i=os,os=t,Lo(e,1),xs||(os=i);break;case 0:i=ns,ns=t,Lo(e,7),xs||(ns=i);break;case 2:i=ls,ls=t,Lo(e,8),xs||(ls=i)}}}(e,t,0)},changeMarkupLayer:function(e){if(Ka&&!$a){var t=rs,a=ss,i=os,r=ls;rs=e,ss=as[e].Color,os=ss,ls=ss,No(0),xs||(rs=t,ss=a,os=i,ls=r)}},changeSnapState:function(e){jh()||Bs.getCurrentpage().enableSnap(e)},changeStrokeColor:function(e){ys&&qh(e,1)},changeTextColor:function(e){ys&&qh(e,2)},changeColor:qh,clearMarkupComments:function(){var e=Oo();e.isempty||e.ClearComments()},changeColorAll:function(e,t){if(!jh()&&!ws&&null!=e&&"string"==typeof e){null!=e.match(/rgb/gi)&&(e=dn(e));var a=ss;switch(t){case 1:a=os,os=e,No(1,!0),xs||(os=a);break;case 0:a=ns,ns=e,No(7,!0),xs||(ns=a);break;case 2:a=ls,ls=e,No(8,!0),xs||(ls=a)}}},changeColorMarkup:function(e,t,a){if(!jh()&&!ws&&null!=t&&"string"==typeof t){null!=t.match(/rgb/gi)&&(t=dn(t));var i=ss;switch(a){case 1:i=os,os=t,Vo(e,1),xs||(os=i);break;case 0:i=ns,ns=t,Vo(e,7),xs||(ns=i);break;case 2:i=ls,ls=t,Vo(e,8),xs||(ls=i)}}},changeLabelTransp:function(e){if(!jh()&&!ws){var t=cs;cs=e,No(12),xs||(cs=t)}},changeTransp:function(e){var t=cs;cs=e,jh()||ws||(No(6),xs||(cs=t))},changeTranspMarkup:function(e,t){var a=cs;cs=t,jh()||ws||e&&(Vo(e,6),xs||(cs=a))},changeVectorBlock:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().turnBlockOnOff(e)},changePDFLayer:function(e,t){jh()||Bs.setOCGVisibility(e,t)},changeVectorLayer:function(e){jh()||Bs.getCurrentpage().turnLayerOnOff(e)},clearMarkup:function(){jh()||(Bs.markuplist=[],Bs.markupdraworder=[],Su(),Pu(),Bs.nummarkups=0,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=Ce&&Ce.setUserlist(es,Bs.bActive),al(n),il(a))},clearHover:function(){jh()||Bs.getCurrentpage().usevectorxml&&(Bs.clearHoverSpace(),al(n))},clipping3D:function(e,t,a){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.clipping(t,a,e)},closeAll:function(){if(Ka)for(;Xs.length>0;)du()},closeDocument:function(e){return uu(e)},closeDocumentEx:function(e){return new Promise((function(t,a){He.connect((function(e,a){a&&t(e)})),du(e)}))},compare:function(e){ru(e,0)},compareEx:nu,compareDialog:function(){null!=aa&&(0==qs.length&&Ah(),aa.CompareDialog())},compareFiles:function(e,t){tu(e,t,0)},compareOverlayServer:function(e,t,a){if(null!=x){var i=[{Command:"Compare",LicenseID:_i,BackURL:e,FrontURL:t,CompareDPI:200,BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)",ReturnData:"text"}];null!=a&&a.length>1&&(i.push(a[0]),i.push(a[1]));var r=JSON.stringify(i);Kc("POST",x,"",r).then((function(e){var t=U+e;null!=Oe&&Oe.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareOverlayServerJSON:function(e,t,a,i,r){if(null!=x){null==a&&(a={BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)"}),null==i&&(i=200);var s=[{Command:"Compare",LicenseID:_i,BackURL:e,FrontURL:t,CompareDPI:i,BackColor:a.BackColor,FrontColor:a.FrontColor,EqualColor:a.EqualColor,ReturnData:"text"}];null!=r&&r.length>1&&(s.push(r[0]),s.push(r[1]));var n=JSON.stringify(s);Kc("POST",x,"",n).then((function(e){var t=U+e;null!=Oe&&Oe.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareOverlaySaveTo:function(e,t,a,i,r,s,n){if(null!=x){null==r&&(r={BackColor:"rgb(255,0,0)",FrontColor:"rgb(0,0,255)",EqualColor:"rgb(128,128,128)"}),null==s&&(s=200);var o=[{Command:"Compare",LicenseID:_i,BackURL:e,FrontURL:t,DestFolder:a,OutputName:i,CompareDPI:s,BackColor:r.BackColor,FrontColor:r.FrontColor,EqualColor:r.EqualColor,ReturnData:"text"}];null!=n&&n.length>1&&(o.push(n[0]),o.push(n[1]));var l=JSON.stringify(o);Kc("POST",x,"",l).then((function(e){var t=U+e;null!=Oe&&Oe.loadComplete(t,!0)})).catch((function(e){e.status?alert(e.status):alert(e)}))}},compareMeasure:function(e){jh()||$a||(Bs.getCurrentpage().enableSnap(!0),nd("getoverlayscale",{p1:Bs.getCurrentpage(),p2:e}))},compareNudgeOffset:function(e){if(!jh()){Ho(),Uo();var t=eu();null!=t&&t.nudgeoffset(e)}},compareNudgeRotate:function(e){if(!jh()){Ho(),Uo();var t=eu();null!=t&&t.nudgeRotate(e)}},compareNudgeScale:function(e){if(!jh()){Ho(),Uo();var t=eu();null!=t&&t.nudgeScale(e)}},compareOffset:function(e,t){if(!jh()){Ho(),Uo();var a=eu();null!=a&&a.offsetdirect(e,t)}},compareScale:function(){if(!jh()){Ho(),Uo();var e=eu();null!=e&&e.scalecompare()}},consolidate:function(e){bs&&(Vs.isactive=e,null!=na&&na.Consolidatevt())},consolidatedOnly:function(e){if(!jh()){for(var t=0;t<Bs.markuplist.length;t++)Bs.markuplist[t].consolidated||(Bs.markuplist[t].display=e);al(n),il(a)}},copyMarkUp:function(){jh()||$a||function(){var e=0;for("undefined"!=typeof Storage&&(localStorage.clear(),Tc(_i)),e=0;e<Bs.markuplist.length;e++)(1==Bs.markuplist[e].selected||Bs.markuplist[e].selectedit)&&($i||Bs.getMarkupMultiselected()?uc(Bs.markuplist[e],!0):hc(Bs.markuplist[e]))}()},create3Dfloorplan:function(e,t,a){jh()||Xs[t].pages[0].usevector3DGLTF&&Xs[e].renderFloorplan(Xs[t].create3DFloorplan,a,null)},get3dFloorplanCanvas:function(e,t){jh()||null!=lt&&Bs.renderFloorplan(lt.setFloorCanvas,e,t)},create3DfloorplanfromPage:function(e,t){jh()||Xs[e].pages[0].usevector3DGLTF&&Bs.renderFloorplan(Xs[e].create3DFloorplan,t,null)},create3DfloorplanfromCanvas:function(e,t,a){jh()||Bs.pages[0].usevector3DGLTF&&Bs.create3DFloorplan(e,t,a)},replacefloorplan:function(e,t,a){jh()||Xs[t].pages[0].usevector3DGLTF&&Xs[e].replaceFloorNav(Xs[t].setfloorplanNav,a)},replacefloorplanfromPage:function(e,t){jh()||Xs[e].pages[0].usevector3DGLTF&&Bs.replaceFloorNav(Xs[e].setfloorplanNav,t)},createAreaAttributes:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().createAreaAttributes(e)},create3DMarkup:function(e){if(!jh()){var t=rl();return t?Hh():function(e){if(!jh()&&Bs.getCurrentpage().usevector3Dxml){var t=Bs.getCurrentpage().Vector3DPageObj.getRestoreControl();if(t)switch(t){case"Walkthrough3D":Gh(!0);break;case"orbitControl":Uh()}}}(),!t}},createCustomStamps:function(e){var t={type:2,data:"Custom Stamps"};null!=jt&&jt.onStampReceived(t),t={type:3,data:e.numstamps},null!=jt&&jt.onStampReceived(t);for(var a=0;a<e.numstamps;a++)dc(e.stamps[a],a)},createHatchStyles:function(){lo(0,ss),lo(1,ss),lo(2,ss),lo(3,ss),lo(4,ss),lo(5,ss)},gethatchimagebyType:function(e,t){return function(e,t){var a=document.createElement("canvas");a.width=16,a.height=16;var i=a.getContext("2d"),r=so(e);return oo(i,e,t),{image:a,name:r,size:{w:16,h:16},color:t,description:"no description"}}(e,t)},createServerContent:function(e,t,a,i){if(Q=!1,"object"==typeof e){var r="",s=!1;null!=e.filepath&&null!=e.filepath&&(r=e.filepath,s=!0);var n={filename:r,displayname:null,auth:null,xrefurl:null,cacheid:null,refresh:!1};t&&(n.refresh=!0),null!=e.mime&&null!=e.mime&&(n.mime=e.mime),null!=e.cacheid&&null!=e.cacheid&&(n.cacheid=e.cacheid),null!=e.auth&&null!=e.auth&&(n.auth=e.auth),null!=e.xrefurl&&null!=e.xrefurl&&(n.xrefurl=e.xrefurl),e.requestheaders,null!=e.displayname&&null!=e.displayname&&(n.displayname=e.displayname),s&&rc(n,a,i)}else"string"==typeof e&&(n={filename:e,displayname:null,refresh:!1},t&&(n.refresh=!0),rc(n,a,i))},createTextRect:function(e,t,a,i,r){Iu(e,t,a,i,null,r)},createImageMarkup:function(e,i,r){if(Ka&&!ws&&!$a){Ho(),Uo(),function(e){var t=0,i=0,r=[];for(Bs.markupdraworder=[],t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&(11==Bs.markuplist[t].type&&Bs.markuplist[t].subtype==e?(Mo(Bs.markuplist[t].markupnumber,3),null!=zt&&zt.setMarkupSelected(Bs.markuplist[t],{created:!1,modified:!1,deleted:!0})):(r[i]=Bs.markuplist[t],Bs.markupdraworder[i]=i,i++));Bs.markuplist=r,Bs.nummarkups=Bs.markuplist.length,null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),null!=st&&st.setThumbnails(Bs.thumbnails),al(n),il(a)}(2);var s=new Fo(11,2,0);s.scaling=Ln();var o=jn();s.xoffset=o.x,s.yoffset=o.y,s.printscale=e.scale,s.pagenumber=Bs.getcurPage(),s.viewname=Bs.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=Aa,s.pagewidth=Na),s.seteditaction(0),s.x=i,s.y=r,s.w=e.width,s.h=e.height,s.image=new Image,a.clearRect(0,0,t.width,t.height),pd(!1,n),Cr||(gr=!0),Dr=Bs.markuplist.length,s.savemetolistDraw();var l,c,h=(l=s.image,c=e,new Promise((function(e,t){l.onload=function(t){e()},l.onerror=function(e){t()},l.src=c.src})));if(Hc(),s=null,Pr){if(null!=zt){var u={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],u)}}else Cr||null==zt||(u={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],u));return h}},createSpaceFromPolygon:function(e){Ka&&($a||(e?(Ho(),nd("pickPolygon",{p1:!1,p2:!0,p3:!0})):nd("markupedit",{p1:!1})))},createSpacefromBlock:function(e){if(!jh()&&Bs.getCurrentpage().usevectorxml){var t=Bs.getCurrentpage().dscalevector,a=Bs.getCurrentpage().dxvector,i=Bs.getCurrentpage().dyvector,r=Bs.getCurrentpage().VectorPageObj.x,s=(Bs.getCurrentpage().VectorPageObj.y,Bs.getCurrentpage().VectorPageObj.h),o=Bs.getCurrentpage().blockAttributes(e),l=Bs.getCurrentpage().getpolygonPathbyblockID(e);null!=l&&function(e,t,a,i,r,s,o,l,c){var h=(t.points[0]-o)*i,u=(c-t.points[1])*i;h+=r,u+=s;var d=new Fo(8,1,0);d.linewidth=1;for(var p=0;p<a.length;p++)d.AddAttribute(a[p].name,a[p].value);d.AddAttribute("Rx_Area","0");var g=e.toString();d.AddAttribute("SpaceID",g),d.scaling=i,d.xoffset=r,d.yoffset=s,d.addpoint(h,u);for(var m=0,f=0,y=2;y<t.points.length;y+=2)m=(t.points[y]-o)*i,f=(c-t.points[y+1])*i,m+=r,f+=s,d.addpoint(m,f);var v=d.PolygonArea(),b=[];if(t.gotsubpath)for(var x=0;x<t.subpaths.length;x++){for(y=0;y<t.subpaths[x].points.length;y+=2)m=(t.subpaths[x].points[y]-o)*i,f=(c-t.subpaths[x].points[y+1])*i,m+=r,f+=s,b.push({x:m,y:f});var w=qn(b);w>v&&(d.points=b.slice(),b=[],v=w)}d.findrectangle(),gr=!0,Dr=Bs.markuplist.length,d.markupID=$o(),d.savemetolistLoad(Bs),Hc(),al(n),null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}(e,l,o,t,a,i,r,0,s)}},deleteMarkUp:mu,deletemarkupbyID:Yo,deleteVectorAttribute:function(e){jh()||$a||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().deleteVectorAttribute(e)},change3DMarkup:function(e){jh()||Ka&&(ws||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().change3DMarkup(e))},change3DMarkupSize:function(e){jh()||Ka&&(ws||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().change3DMarkupSize(e))},deleteCamera:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.deleteCameraView(e)},deleteMarkupbyGUID:function(e){Ka&&(ws||$a||(Bo(e),al(n),il(a)))},deletePoint:function(){"markupedit"==As.name&&As.enablePointDelete()},forceUniqueMarkup:function(e){Va=e},disablewelcome:function(e){J=e},displayFloorplan:function(e,t,a){jh()||Ka&&(ws||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().displayfloorplan(e,t,a))},documentOpened:function(){return void 0!==Ka&&Ka},doResize:yd,doResizeEx:function(e,o){if(i){if(function(e,t){if(ve.absolute){e=e||ve.offsetWidth,t=t||ve.offsetHeight;var a=md(i,e,t);Na=a.swidth,Aa=a.sheight,Ba=a.awidth,Ua=a.aheight,Ka&&Bs.getCurrentpage().usepdfjs,gd(!1)}}(e,o),jh()){if(!J){Ya=zs.naturalWidth,qa=zs.naturalHeight;var l=i.height/qa,c=i.width/Ya,h=Math.min(c,l),d=(i.width-Ya*h)/2,p=(i.height-qa*h)/2;a.clearRect(0,0,t.width,t.height),n.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),zc(zs,d,p,h)}}else Bs.getCurrentpage().usevector3Dxml&&(u.setSize(i.width,i.height),Bs.getCurrentpage().camera&&(Bs.getCurrentpage().camera.aspect=i.width/i.height,Bs.getCurrentpage().camera.updateProjectionMatrix())),Bs.getCurrentpage().resize();md(s,Ba,Ua),md(t,Ba,Ua),md(u.domElement,Ba,Ua)}},downloadSignature:function(e,t){if(null!=S&&(!t||null!=M)){var a=S+"&"+e;t&&(a=M+"&"+e),Kc("GET",a,"arraybuffer").then((function(a){var i=new Blob([a],{type:"image/png"});if(a){const a=new Image;a.src=URL.createObjectURL(i),a.onload=function(){var r={data:i,width:a.width,height:a.height,username:e,initials:t};null!=Me&&Me.onSignReceived(r)}}})).catch((function(e){e.status?console.log("signatureload",e.status):console.log("signatureload",e)}))}},drawPoints:function(){Ka&&Bs.getCurrentpage().usepdfjs&&Bs.getCurrentpage().drawpoints(Bs.getCurrentpage().PDFPointArray,Bs.getCurrentpage().pdfSnapScale)},drawCanvas:function(e,t){r.fillStyle="rgb(238,243,250)",r.fillRect(0,0,Na,Aa);var a=0;if(e.length&&e.length>0)for(var i=0;i<e.length;i++)"canvas"==e[i].tagName.toLowerCase()&&(Ku(e[i],t,a,0),a+=e[i].width)},drawmarkupToCanvas:function(e,t,i,r){if(!jh()){var s=0;if(Bs&&Bs.getCurrentpage().usevector3Dxml)for(s=0;s<Bs.markuplist.length;s++)null!=Bs.markuplist[s]&&Bs.markuplist[s].display&&Bs.markuplist[s].bfor3D&&Bs.markuplist[s].viewname==r&&Bs.markuplist[s].drawWidthHeight(e,t,i);al(n),il(a)}},endMarkupTextSearch:function(){jh()||Ka&&($a||Bs.endMarkupTextSearch())},endTextSearch:function(){jh()||Ka&&($a||Bs.textsearchend())},endGetTextRects:function(){jh()||Ka&&($a||Bs.textrectsearchend())},enableCamNavDraw:function(e){ar=e},getTextRects:function(e,t){jh()||Ka&&($a||Bs.getTextRects(e,t))},getPDFintialScale:function(e,t){var a=Aa/t,i=Na/e;return Math.min(i,a)},getmarkupbyNumber:function(e){if(Ka&&!(Bs.markuplist.length-1<indx))return Bs.getmarkupobjbynumber(e)},exicompareMeasure:function(){jh()||$a||(Bs.getCurrentpage().enableSnap(!1),nd("markupedit",{p1:!1}))},explode3D:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&(Bs.getCurrentpage().Vector3DPageObj.doexplode=e)},explode3DDistance:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.doexplode&&Bs.getCurrentpage().Vector3DPageObj.newExplode(e)},exportFile:function(e,t,a,i,r){Ka&&(Ho(),Uo(),Bs.bLargePDF?function(e,t,a,i,r,s,n){var o={consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:r,useRaster:!1},l=new Js(Bs);l.setOncomplete((function(e){ec(o,e)})),l.createxmlexport(s,n,e)}(e,t,a,i,r,hs,us):function(e,t,a,i,r){ec({consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:r,useRaster:!1},kc(!1,e,ci,hs,hs))}(e,t,a,i,r))},exportFilePage:function(e,t,a,i,r,s){Ka&&(Ho(),Uo(),function(e,t,a,i,r,s){ec({consolidateonly:e,format:a,UPI:i,paperSize:r,markupFlag:s,page:t,useRaster:!1,singlepage:!0},kc(!1,e,ci,hs,hs))}(e,t,a,i,r,s))},exportFileRaster:function(e,t,a,i,r){Ka&&(Ho(),Uo(),function(e,t,a,i,r){ec({consolidateonly:e,format:t,UPI:a,paperSize:i,markupFlag:r,useRaster:!0},kc(!1,e,ci,hs,hs))}(e,t,a,i,r))},exportPDF:function(){Ka&&(Ho(),Uo(),function(){if(!jh())if((new Date).getTime(),Bs.getCurrentpage().usevector3Dxml)Kl();else{Bs.getCurrentpage().usepdfjs&&(Bs.getCurrentpage().curpagescale,Bs.getCurrentpage().dscalepdf);var e=new XMLHttpRequest;e.withCredentials=fi,e.upload.addEventListener("progress",ql,!1);var t=kc(!1,!1,!0,hs,hs),a=po(Bs.OriginalURL),i=go(Bs.OriginalURL),r=j+"?"+a+"&"+i+"&PDF&200";try{e.open("POST",r,!0)}catch(e){alert("Error 1 - "+e)}try{e.responseType=""}catch(e){}if(ks){var s=Zc();s.authset&&e.setRequestHeader("Authorization",s.authString+s.baseuserstring)}e.onload=function(e){if(200==this.status){var t=this.responseXML;null!=t&&null!=t.documentElement||(t=Jn(this.responseText));var a=t.getElementsByTagName("File")[0].firstChild.nodeValue;a=uo(Bs.FileNameSRC)+a,null!=je&&je.loadComplete(a,!0)}else 404==this.status?console.log("unable to export file error 404"):503==this.status&&console.log("unable to export file error 503")},e.send(t)}}())},exportFilePrintPDF:function(e){Ka&&(Ho(),Uo(),$l({consolidateonly:!1,format:"PDF",UPI:"0",paperSize:e,markupFlag:"1",useRaster:!1}))},exportPDFBinary:function(){Ka&&Bs.getCurrentpage().usepdfjs&&Bs.sendPDFData()},exportSettings:function(e){ci=e.includeAllMarkup},fileInfoDialog:cu,fileSelected:function(){Ha?(Ha=!1,function(){if(null!=C){var e=document.getElementById("fileToUpload").files[0];null!=Zt&&Zt.setUpload("show"),Kc("POST",C,"",e).then((function(e){var t=e.substr(0,e.length-2),a=Object.freeze(JSON.parse(t));null!=Zt&&Zt.setUpload("hide"),null!=Se&&Se.setPentablelist(a,Bs.bActive)})).catch((function(e){e.status?(null!=Zt&&Zt.setUpload("hide"),console.log("uploadpentable",e.status)):(null!=Zt&&Zt.setUpload("hide"),console.log(e))}))}}()):za?(za=!1,function(){if(null!=F){var e=document.getElementById("fileToUpload").files[0];null!=Zt&&Zt.setUpload("show"),Kc("POST",F,"",e).then((function(e){null!=Zt&&Zt.setUpload("hide");var t=d+e;null!=je&&je.loadComplete(t)})).catch((function(e){e.status?(null!=Zt&&Zt.setUpload("hide"),console.log("uploadconvert",e.status)):(null!=Zt&&Zt.setUpload("hide"),console.log(e))}))}}()):function(){var e=document.getElementById("fileToUpload").files[0];if(Xa=e.name,"application/pdf"==e.type&&(null!=Qt&&Qt.setDownload("show"),Yc(e)),"application/pdf"==e.type){var t=[{event:"progress",func:Qc,bupload:!0},{event:"load",func:eh},{event:"error",func:ah},{event:"abort",func:ih}];qc("POST",k+"&"+A+"&"+e.name+"&"+e.lastModified+"&"+e.size,"",t,e)}else null!=Zt&&Zt.setUpload("show"),t=[{event:"progress",func:$c,bupload:!0},{event:"load",func:th},{event:"error",func:ah},{event:"abort",func:ih}],qc("POST",k+"&"+A+"&"+e.name+"&"+e.lastModified+"&"+e.size,"",t,e)}()},findBlockByAttr:function(e,t){if(!jh())return Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().FindBlockByAttr(e,t):void 0},findMarkUp:function(){if(!jh()&&Ka&&!$a){Ho(),Uo();var e=prompt("Search markup text","");null!=e&&""!=e&&Bs.getCurrentpage().MarkupFind(e)}},forceMarkupCallback:function(e){Pr=e},freeLicense:function(){ri&&Ic(_i,!1)},get2DVectorBlocks:function(){if(!jh())return Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().getBlocks():void 0},get3DVectorBlocks:function(){if(!jh())return Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().get3dVectorBlocks():void 0},get2DVectorfilterAttributes:function(){if(!jh())return Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().getFilteredAttributes():void 0},get2DVectorPentable:function(){if(!jh())return Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().getPenTable():void 0},getActiveFileFloorlevel:function(){var e=null;return Ka&&Bs.getCurrentpage().bis3Dnavigator&&(e=Bs.getCurrentpage().getFloorLevel()),e},getAllPageDimensions:function(){if(!jh())return Bs.getAllPageDim()},getBlockAttributes:function(e){if(!jh())return Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().blockAttributes(e):void 0},getBookMarkPage:function(e){if(!jh())return Bs.get_bookmark_pageref(e)},getCacheURL:function(){if(!jh())return Bs.CacheURL},getCameraimage:function(e){var t=null;return jh()||Bs.getCurrentpage().usevector3Dxml&&(t=Bs.getCurrentpage().Vector3DPageObj.getCameraimage(e)),t},getCameraView:function(e){var t=void 0;return jh()||Bs.getCurrentpage().usevector3Dxml&&(t=Bs.getCurrentpage().Vector3DPageObj.getCameraView(e)),t},get3DResetView:function(){if(!jh())return Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().get3DResetView():void 0},getCurrentPageScale:Ln,getCurrentPageOffset:jn,getCanvasContextMenuEvent:function(){null!=ia&&ia.setEvent(t)},getCanvasFont:function(e,t,a,i){return new en(e,t,a,i).fontstringpx},getCanvasSize:function(){var e=ll();return{w:Na/e,h:Aa/e}},getColor:function(){return ss},getCompareColors:function(){var e={bg:cr,fg:hr},t=eu();return null!=t&&(e=t.getColors()),e},getcurPage:function(){return Ka?Bs.getcurPage():0},getPage:function(e){return jh()?void 0:Bs.getPageObject(e)},getPageScaleObject:function(e){return jh()?void 0:Bs.getPageObject(index).scaleObject},getfloorplanDocs:function(e){for(var t=[],a=null,i=0;i<Xs.length;i++)if(Xs[i].pages.length>0)for(var r=0;r<Xs[i].pages.length;r++)a=Xs[i].pages[r].getFloorLevel(),e.floorindex==a.floorindex&&t.push({docindex:i,pageindex:r,floorindex:a.floorindex,replaced:a.replaced});return t},getFloorplanList:function(e){var t=[];return Ka?(Xs[e].pages[0].usevector3DGLTF&&(t=Xs[e].getFloorplans()),t):t},getPageScale:function(e){return Ka?Bs.getcurpageScale(e):null},getDisplayName:Pn,getdivcontainer:function(){return e},getDocFileName:function(){return Bs?Bs.FileName:"empty"},getPDFDocobj:function(){return Ka?Bs.getPDFDocument():null},getdocInfo:function(){if(!jh())return Ka?{iscompare:$a,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),type:Bs.Type}:{iscompare:!1,isPDF:!1,is3D:!1,is2D:!1,numpages:0,currentpage:0}},pasteClipboard:function(){!async function(){try{if("denied"===(await navigator.permissions.query({name:"clipboard-read"})).state)throw new Error("Not allowed to read clipboard.");const e=await navigator.clipboard.read();for(const t of e){if(!t.types.includes("image/png"))throw new Error("Clipboard contains non-image data.");const e=await t.getType("image/png");nd("clipboardimage",{p1:1}),"clipboardimage"===As.name&&As.setimage(e)}}catch(e){console.error(e.message)}}()},getClipRect:function(e){jh()||(Ho(),Uo(),e?nd("zoomwindow",{p1:!1,p2:!0}):nd("markupedit",{p1:!1}))},getDocRect:function(e){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||(Ho(),Uo(),e?nd("zoomwindow",{p1:!1,p2:!1}):nd("markupedit",{p1:!1})))},getCamNavPosition:function(e,t,a,i){if(!jh())return Xs[e].pages[t].getnavcampos(a.unit,a.boxCenter,i)},getcentrepoint:function(){return{x:.5*Na,y:.5*Aa}},getFillColor:function(){return ns},getFillStyle:function(){return ms},getFixedScale:function(){if(!Ka)return 1;var e=Ln()/Bs.getCurrentpage().fixedScale;return ui?e:1},getFont:function(){return tn},getFileInfo:function(e){return Le.callback=e,cu(),Le.fileinfo},getLayout:function(){return ve},getLineColor:function(){return os},getLineWidth:function(){return ds},getMarkupTypes:Oh,getMarkupTypebyname:function(e){for(var t=[{label:"Freehand pen",typename:"PEN",type:0,subtype:0},{label:"Eraser",typename:"ERASE",type:0,subtype:1},{label:"Polyline",typename:"POLYLINE",type:1,subtype:1},{label:"Polygon",typename:"POLYGON",type:1,subtype:2},{label:"Measure path",typename:"PATH",type:1,subtype:3},{label:"Measure angle",typename:"ANGLE",type:1,subtype:4},{label:"Measure segment",typename:"SEGMENT",type:1,subtype:6},{label:"Rectangle",typename:"RECTANGLE",type:3,subtype:0},{label:"Rounded rectangle",typename:"ROUNDED_RECTANGLE",type:3,subtype:1},{label:"Marker",typename:"MARKER",type:3,subtype:3},{label:"Rectanglular Area",typename:"AREARECT",type:3,subtype:6},{label:"Oval",typename:"ELLIPSE",type:4,subtype:0},{label:"Circle",typename:"CIRCLE",type:4,subtype:1},{label:"Revision Cloud",typename:"CLOUD",type:5,subtype:0},{label:"Line",typename:"LINE",type:6,subtype:9},{label:"Arrow",typename:"ARROW",type:6,subtype:0},{label:"Dimension Line",typename:"DIMENSION",type:7,subtype:0},{label:"Space",typename:"SPACE",type:8,subtype:1},{label:"Area",typename:"AREA",type:8,subtype:0},{label:"Callout",typename:"CALLOUT",type:9,subtype:2},{label:"Text",typename:"TEXT",type:9,subtype:1},{label:"Note",typename:"NOTE",type:10,subtype:0},{label:"Image",typename:"IMAGE",type:11,subtype:0},{label:"Symbol",typename:"SYMBOL",type:11,subtype:1},{label:"Button",typename:"BUTTON",type:11,subtype:3},{label:"Signature",typename:"SIGNATURE",type:11,subtype:4},{label:"Signature",typename:"SIGNATUREMOVEABLE",type:11,subtype:5},{label:"Stamp",typename:"IMAGESTAMP",type:11,subtype:12},{label:"QRCode",typename:"IMAGEQR",type:11,subtype:13},{label:"link",typename:"link",type:11,subtype:20},{label:"interactiveStamp",typename:"interactiveStamp",type:11,subtype:21},{label:"Stamp",typename:"STAMP",type:12,subtype:0},{label:"Count",typename:"COUNT",type:13,subtype:0}],a=void 0,i=0;i<t;i++)t[i].typename==e&&(a=t[i]);return a},getMarkupType:function(e,t){var a={label:"",type:"",groups:[]};switch(e){case 0:0==t&&(a.label="Freehand pen",a.type="PEN"),1==t&&(a.label="Eraser",a.type="ERASER");break;case 1:0==t&&(a.label="Polygon",a.type="POLYGON"),1==t&&(a.label="Polyline",a.type=["PEN","POLYLINE"]),2==t&&(a.label="Polygon",a.type="POLYGON"),3==t&&(a.label="Measure Path",a.type="PATH");break;case 2:a.label="Polycurve",a.type=["SHAPE","POLYCURVE"];break;case 3:0==t&&(a.label="Rectangle",a.type=["SHAPE","RECTANGLE"]),1==t&&(a.label="Rounded Rectangle",a.type=["SHAPE","ROUNDED_RECTANGLE"]),1==t&&(a.label="Marker",a.type="MARKER");break;case 4:0==t&&(a.label="Oval",a.type=["SHAPE","ELLIPSE"]),1==t&&(a.label="Circle",a.type=["SHAPE","CIRCLE"]);break;case 5:a.label="Revision Cloud",a.type=["SHAPE","CLOUD"];break;case 6:9==t?(a.label="Line",a.type=["ARROW","NO_ENDS"]):6==t?(a.label="Callout",a.type="TEXT"):0==t?(a.label="Arrow",a.type=["ARROW","OPEN_SINGLE_END"]):1==t?(a.label="Arrow",a.type=["ARROW","FILLED_SINGLE_END"]):2==t?(a.label="Arrow",a.type=["ARROW","OPEN_BOTH_ENDS"]):3==t?(a.label="Arrow",a.type=["ARROW","FILLED_BOTH_ENDS"]):a.label="Arrow";break;case 7:a.label="Dimension Line",0==t?a.type=["DIMENSION","BAR"]:1==t&&(a.type=["DIMENSION","OPEN_ARROW"]);break;case 8:1==t?(a.label="Space",a.type="SPACE"):(a.label="Area",a.type="AREA");break;case 9:1==t?(a.label="Text",a.type="TEXT"):2==t&&(a.label="Callout",a.type="CALLOUT");break;case 11:switch(t){case 0:a.label="Image",a.type="IMAGE";break;case 1:a.label="Symbol",a.type="SYMBOL";break;case 3:a.label="Button",a.type="BUTTON";break;case 4:a.label="Signature",a.type="SIGNATURE";break;case 12:a.label="Stamp",a.type="IMAGESTAMP";break;case 20:a.label="Link",a.type="LINK";break;case 21:a.label="InteractiveStamp",a.type="InteractiveStamp"}break;case 10:a.label="Note",a.type="NOTE";break;case 12:a.label="Stamp",a.type="STAMP";break;case 13:a.label="Count",a.type="COUNT"}return a},getMarkupControlProperties:function(e,t,a){var i={lineColor:!1,fillColor:!1,textColor:!1,lineWidth:!1,lineStyle:!1,clockwise:!1,customlabel:!1,display:!0,countsize:!1,countshape:!1,showperimeter:!1,enablelink:!1,endpoint_open_single:!1,endpoint_open_both:!1,endpoint_filled_single:!1,endpoint_filled_both:!1,endpoints_bar:!1,endpoints_arrow:!1,lineSegmentWidth:!1,transpacency:!1,rotate:!1,snap:!1,fill:!1,fontName:!1,fontHeight:!1,labelsize:!1,fontBold:!1,fontItalic:!1};switch(e){case 0:0==t&&(i.lineColor=!0,i.lineWidth=!0),1==t&&(i.lineWidth=!0);break;case 1:1==t&&(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),2==t&&(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0),3==t&&(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),4!=t&&5!=t||(i.lineColor=!0,i.lineWidth=!0,i.snap=!0),6==t&&(i.lineColor=!0,i.lineWidth=!0,i.lineSegmentWidth=!0,i.snap=!0);break;case 2:i.lineColor=!0,i.lineWidth=!0;break;case 3:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0,i.rotate=!0;break;case 4:0==t&&(i.rotate=!0),i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0;break;case 5:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0,i.rotate=!0;break;case 6:9==t?(i.lineColor=!0,i.lineWidth=!0,i.snap=!0):6==t||(i.lineColor=!0,i.lineWidth=!0,i.snap=!0,i.endpoint_open_single=!0,i.endpoint_open_both=!0,i.endpoint_filled_single=!0,i.endpoint_filled_both=!0);break;case 7:labelType="Dimension Line",i.lineColor=!0,i.lineWidth=!0,i.snap=!0,i.endpoints_bar=!0,i.endpoints_arrow=!0;break;case 8:1==t||(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.snap=!0,i.fill=!0);break;case 9:1==t&&(i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.fill=!0,i.textColor=!0,i.rotate=!0,i.fontName=!0,i.fontHeight=!0,i.fontBold=!0,i.fontItalic=!0);break;case 11:0!=t&&1!=t&&12!=t&&20!=t&&21!=t||(i.rotate=!0);break;case 10:labelType="Note";break;case 12:i.lineColor=!0,i.fillColor=!0,i.lineWidth=!0,i.transpacency=!0,i.fill=!0,i.rotate=!0;break;case 13:i.fillColor=!0}return i},markVectorBlock:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().markVectorBlock(e)},markupDisplayOnload:function(e){I=e},getMarkupLayers:function(){return as},getmarkupGUIDs:function(){if(Ka)return Bs.getannotGUIDs()},getMarkupProperties:Lh,getMarkupXMLData:function(){if(!jh()&&!$a)return kc(!0,!1,!0,hs,us)},getmarkupobjByGUID:function(e){if(Ka)return Bs.getmarkupobjbyGUID(e)},getMarkupSearchPadding:function(){return ke},getMarkupXMLByGUID:function(e){if(Ka){for(var t="",a=0;a<Xs.length;a++){var i=Xs[a].getmarkupbyGUIDXML(e);i.found&&(t=i.document)}return t}},getMarkupXMLSelected:function(){if(Ka){var e=Oo();return Bs.getmarkupSelectedXML(e)}},getNoteDiag:function(e){function t(e){Ut.connect(e)}return e&&"function"==typeof e&&t(e),{getText:function(){return Ut.getText().text},setText:function(e){Ut.setText(e)},connect:t}},getnumSymbols:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Numsymbols")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","",t).then((function(e){var t={type:3,data:e};null!=Ot&&Ot.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("getnumSymbols error 404"):503==e.status?console.log("getnumSymbols error 503"):501==e.status&&console.log("getnumSymbols error 501"):console.log(e)}))}(e)},getOpenFiles:Ah,getOpenFilesList:function(){for(var e=[],t=0;t<Xs.length;t++)e.push({index:Xs[t].fileindex,name:Xs[t].FileName||Xs[t].Type,isActive:Xs[t].bActive});return e},getOriginalPath:function(){if(!jh())return Bs.OriginalURL},get3DmodelcurFloor:function(){if(!jh())return Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().Vector3DPageObj.checkcurfloor():void 0},getModelCenter:function(){if(!jh())return Bs.getCurrentpage().usevector3DGLTF?Bs.getCurrentpage().Vector3DPageObj.getModelCenter():void 0},getModelBox:function(){if(!jh())return Bs.getCurrentpage().usevector3DGLTF?Bs.getCurrentpage().Vector3DPageObj.getmodelBox():void 0},getmodelUnit:function(){if(!jh())return Bs.getCurrentpage().usevector3DGLTF?Bs.getCurrentpage().Vector3DPageObj.getmodelUnit():void 0},getPageDimensions:function(e){if(!jh())return Bs.getPageDim(e)},getPageRotation:function(){return jh()?0:Bs.getCurrentpage().drotation},getpagethumbnail:function(e){if(!jh())return Bs.pages[e].thumbnailobj},getCurrentVectorPageObject:function(){return Bs.getCurrentpage().getVectorPageObject()},getCurrentPageScaleValue:function(){if(!jh())return Bs.getCurrentpage().scaleObject.getScaleValue()},getCurrentPageScaleLabel:function(){if(!jh())return Bs.getCurrentpage().scaleObject.getScaleLabel()},getReadOnly:function(){return ws},getAllSelectedMarkup:function(){if(Ka&&!ws)return Bs.getSelectedMarkup()},getSelectedMarkup:lu,getSnapState:function(){if(!jh())return Bs.getCurrentpage().getSnapState()},getStoreyNames:function(){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().getstoreyNames():void 0},getStoreyAttributes:function(e){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().getStoreyAttributes(e):void 0},getStoreyAttributesEx:function(e,t,a){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?a?Bs.getCurrentpage().searchStoreyAttributes(e,t):Bs.getCurrentpage().searchStoreyAttributesEx(e,t):void 0},getStoreyIDs:function(e){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().getStoreyIDs(e):void 0},getStoreyRealIDs:function(e){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().getStoreyRealIDs(e):void 0},getSymbolLibNum:function(){var e,t;(t=[]).push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),t.push(encodeURIComponent("Command")+"="+encodeURIComponent("Numlibs")),e=t.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","",e).then((function(e){var t={type:1,data:e};null!=Ot&&Ot.onSymbolReceived(t)})).catch((function(e){e.status?console.log("getNumSymblibs",e.status):console.log(e)}))},getSymbolLibPNGData:function(e,t){!function(e,t){var a,i=[];i.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),i.push(encodeURIComponent("Command")+"="+encodeURIComponent("symbolpng")),i.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),i.push(encodeURIComponent("Symbolnumber")+"="+encodeURIComponent(t)),a=i.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","arraybuffer",a).then((function(e){var a={type:5,data:new Blob([e],{type:"image/png"}),index:t};null!=Ot&&Ot.onSymbolReceived(a)})).catch((function(e){e.status?404==e.status?console.log("getSymbolPNGData error 404"):503==e.status?console.log("getSymbolPNGData error 503"):501==e.status&&console.log("getSymbolPNGData error 501"):console.log(e)}))}(e,t)},getSymbolName:function(e,t){!function(e,t){var a,i=[];i.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),i.push(encodeURIComponent("Command")+"="+encodeURIComponent("Symbolname")),i.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),i.push(encodeURIComponent("Symbolnumber")+"="+encodeURIComponent(t)),a=i.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","",a).then((function(e){var t={type:4,data:e};null!=Ot&&Ot.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("getSymbolName error 404"):503==e.status?console.log("getSymbolName error 503"):501==e.status&&console.log("getSymbolName error 501"):console.log(e)}))}(e,t)},getTextColor:function(){return ls},getUnit:Du,getUser:function(){Jc("GET",K).then((function(e){null!=e.getElementsByTagName("ID")[0]&&(hs=Ql(hs=e.getElementsByTagName("ID")[0].firstChild.nodeValue)),null!=e.getElementsByTagName("name")[0]&&(us=Ql(us=e.getElementsByTagName("name")[0].firstChild.nodeValue)),null!=e.getElementsByTagName("color")[0]&&(ss=e.getElementsByTagName("color")[0].firstChild.nodeValue),null!=e.getElementsByTagName("layer")[0]&&(rs=e.getElementsByTagName("layer")[0].firstChild.nodeValue),null!=e.getElementsByTagName("canChangeLayer")[0]&&(ys="1"==e.getElementsByTagName("canChangeLayer")[0].firstChild.nodeValue),es[0]=new Dn(hs,us,rs,ss),null!=Ce&&Ce.setUserlist(es,!0)})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},getUsers:function(){return es},gotoPage:function(e){Ka&&!$a&&(Ho(),Uo(),Bs.GotoPage(e))},getHatchStyle:function(){return gs},getHatchbyName:io,getHatches:$n,getTextInput:function(e){function t(e){Bt.connect(e)}return e&&"function"==typeof e&&t(e),{getText:function(){return Bt.getText().text},setText:function(e){Bt.setText(e)},connect:t}},helper:xd,handlePDFPassword:ou,hideMarkUp:function(){jh()||(rl(),Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().unSelect3DmarkupAll(),Ho(),Uo(),Bs.Drawmarkup?(Bs.Drawmarkup=!1,Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().show3Dmarkup(!1),tl(!1),al(n),Bs.bMarkupLocked=!0):(Bs.Drawmarkup=!0,Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().show3Dmarkup(!0),tl(!0),al(n),Bs.bMarkupLocked=!1))},hideLabels:function(e){Es=e},hideTextInput:vd,hideMarkupByMarkupNumbers:function(e,t){var a=0;for(a=0;a<e.length;a++)null!=Bs.markuplist[e[a]-1]&&Bs.markuplist[e[a]-1].setdisplay(t)},imperialUnit:Mu,elementImperialUnit:function(e){lu().scaleObject.imperialUnit(e)},initialize:function(d,p,g){if(!ie){ie=!0,oe=window.devicePixelRatio,ve=d||ve,navigator.userAgent.match(/Trident.*rv\:11\./)?(Ga=!0,Wa=""):(Ga=!1,Wa="initial");var m=function(){_s.hide3d=function(){var e=this;this.name="hide3d",this.anglelengthsupport=!1,this.refreshSupport=!1;var a=new THREE.Raycaster,i=new THREE.Vector2;new THREE.Vector3,_u(Yu("hide3d")),this.getInterSects=function(e){if(a.setFromCamera(e,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var t=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren();if(0==t.length)return;var i=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==i.length)var r=[];else{r=[];for(var s=0;s<i.length;s++)r.push(a.intersectObjects(i[s],!0))}var n=a.intersectObjects(t,!0)}else n=a.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(r.length>0)for(var o=0;o<r.length;o++)for(;0<r[o].length;o++)if("LineSegments"!=r[o][0].object.type){var l=null,c=!0,h=!0,u=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(c=r[o][0].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,h=r[o][0].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,u=r[o][0].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),r[o][0].object.visible&&c&&h&&u){l=r[o][0];break}}if(n.length>0)for(o=0;o<n.length;o++)if("LineSegments"!=n[o].object.type&&(c=!0,h=!0,u=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(c=n[o].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,h=n[o].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,u=n[o].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),n[o].object.visible&&c&&h&&u)){var d=!1;if(null!=l&&(d=l.distance<n[o].distance),d)var p=l;else p=n[o];if((null==p.object.userData.visible||p.object.userData.tempvisible)&&(p.object.userData.visible=p.object.visible?1:0,p.object.userData.tempvisible=p.object.visible),p.object.visible){var g=p.object.name,m=p.object.type;g=Bs.getCurrentpage().getMeshName(g,m),Bs.getCurrentpage().turn3DBlockOnOff(g,!0);break}}},this.mousedown=function(t){t.preventDefault(),t.stopPropagation(),e.started=!0;var a=td(u.domElement,t);Ka&&Bs.getCurrentpage().usevector3Dxml&&(i.x=a.x/Na*2-1,i.y=-a.y/Aa*2+1,e.getInterSects(i))},this.mouseup=function(t){t.preventDefault(),t.stopPropagation(),e.started&&(e.started=!1)},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var r=td(t,a);e.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml&&(i.x=r.x/Na*2-1,i.y=-r.y/Aa*2+1,e.getInterSects(i))},this.touchstart=function(t){t.preventDefault(),e.started=!0;var a=ed(u.domElement,t,0);Ka&&Bs.getCurrentpage().usevector3Dxml&&(i.x=a.x/Na*2-1,i.y=-a.y/Aa*2+1,e.getInterSects(i))},this.touchcancel=function(t){t.preventDefault(),e.started&&(e.started=!1)},this.touchend=function(t){t.preventDefault(),e.started&&(e.started=!1)}},_s.add3dsymbol=function(e){var a=this,i=new THREE.Raycaster,r=new THREE.Vector2;new THREE.Vector3,this.color=e.p1,this.name="add3dsymbol",this.anglelengthsupport=!1,this.refreshSupport=!1,this.getInterSects=function(e,t){if(i.setFromCamera(e,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var a=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),r=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==a.length)return;if(0==r.length)var s=[];else{s=[];for(var n=0;n<r.length;n++)s.push(i.intersectObjects(r[n],!0))}var o=i.intersectObjects(a,!0)}else o=i.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(s.length>0)for(var l=0;l<s.length;l++)if(s[l].length>0)for(;0<s[l].length;l++)if("LineSegments"!=s[l][0].object.type){var c=null,h=!0,u=!0,d=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(h=s[l][0].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,u=s[l][0].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,d=s[l][0].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),s[l][0].object.visible&&h&&u&&d){c=s[l][0];break}}if(o.length>0)for(l=0;l<o.length;l++)if("LineSegments"!=o[l].object.type&&(h=!0,u=!0,d=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(h=o[l].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,u=o[l].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,d=o[l].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),o[l].object.visible&&h&&u&&d)){var p=!1;if(null!=c&&(p=c.distance<o[l].distance),p)var g=c;else g=o[l];Bs.getCurrentpage().add3DSymbol(g,t);break}},this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();for(var t=td(u.domElement,e),i=JSON.parse(e.dataTransfer.getData("Text")),s=!0,n=0;n<Ls.lenght;n++)Ls[n].id==i.id&&(s=!1);s&&qu(i.src,i.width,i.height,i.id),Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=t.x/Na*2-1,r.y=-t.y/Aa*2+1,a.getInterSects(r,i.id))},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),a.started=!0;var t=td(u.domElement,e);Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=t.x/Na*2-1,r.y=-t.y/Aa*2+1,a.getInterSects(r,a.color))},this.mouseup=function(e){e.preventDefault(),e.stopPropagation(),a.started&&(a.started=!1)},this.pointerdown=function(e){a.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var i=td(t,e);a.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=i.x/Na*2-1,r.y=-i.y/Aa*2+1,a.getInterSects(r))},this.MSPointerUp=function(e){a.started&&(a.started=!1)},this.touchstart=function(e){e.preventDefault(),a.started=!0;var t=ed(u.domElement,e,0);Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=t.x/Na*2-1,r.y=-t.y/Aa*2+1,a.getInterSects(r))},this.touchcancel=function(e){e.preventDefault(),a.started&&(a.started=!1)},this.touchend=function(e){e.preventDefault(),a.started&&(a.started=!1)}},_s.measure3D=function(){var e=this,i=new THREE.Raycaster,r=new THREE.Vector2;new THREE.Vector3,this.name="measure3D",this.anglelengthsupport=!1,this.refreshSupport=!1,this.numpoints=0,this.screenPoints=[];var s=[];_u(Yu("measure3D")),this.drawLine=function(e,t){a.strokeStyle="black",a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(t.x,t.y),a.closePath(),a.stroke()},this.drawLabel=function(e,i){i&&a.clearRect(0,0,t.width,t.height)},this.drawPoints=function(e,i){i&&a.clearRect(0,0,t.width,t.height),a.save(),a.fillStyle="rgba(0, 0, 255, 0.5)",a.beginPath(),a.arc(e.x,e.y,8,0,2*Math.PI),a.closePath(),a.arc(e.x,e.y,4,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()},this.handlePoints=function(t,i){if(t){var r=Bs.getCurrentpage().Vector3DPageObj.pointToScreen(i);e.drawPoints(r,!0);var n=i.point.clone();if(s.length>0){var o=Bs.getCurrentpage().Vector3DPageObj.pointToScreen(s[0]);e.drawPoints(o,!1),e.drawLine(o,r);var l=s[0].point.clone().distanceTo(n),c=Bs.getCurrentpage().Vector3DPageObj.setdimvalue(l);Bs.getCurrentpage().Vector3DPageObj.dimvaluedraw(r,a,"black",c,!0)}}else s.push(i),e.screenPoints.push(r),e.numpoints+=1,2==e.numpoints&&(Bs.getCurrentpage().Vector3DPageObj.add2DPoints(s,e.numpoints),s=[],e.numpoints=0,e.started=!1,Xu(!1,"measure3D",null))},this.getInterSects=function(r,s,n){if(i.setFromCamera(r,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var o=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),l=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==o.length)return;if(0==l.length)var c=[];else{c=[];for(var h=0;h<l.length;h++)c.push(i.intersectObjects(l[h],!0))}var u=i.intersectObjects(o,!0)}else u=i.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(c.length>0)for(var d=0;d<c.length;d++)if(c[d].length>0)for(;0<c[d].length;d++)if("LineSegments"!=c[d][0].object.type){var p=null,g=!0,m=!0,f=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(g=c[d][0].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=c[d][0].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,f=c[d][0].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),c[d][0].object.visible&&g&&m&&f){p=c[d][0];break}}if(u.length>0)for(d=0;d<u.length;d++)if("LineSegments"!=u[d].object.type&&(g=!0,m=!0,f=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(g=u[d].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,m=u[d].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,f=u[d].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),u[d].object.visible&&g&&m&&f)){var y=!1;null!=p&&(y=p.distance<u[d].distance),y?e.handlePoints(n,p):e.handlePoints(n,u[d]),e.started&&a.clearRect(0,0,t.width,t.height);break}},this.mousemove=function(t){t.preventDefault(),t.stopPropagation();var a=td(u.domElement,t);e.started||(r.x=a.x/Na*2-1,r.y=-a.y/Aa*2+1,e.getInterSects(r,e.color,!0))},this.mousedown=function(t){t.preventDefault(),t.stopPropagation();var a=td(u.domElement,t);Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=a.x/Na*2-1,r.y=-a.y/Aa*2+1,e.numpoints<2?e.getInterSects(r,e.color,!1):(t.target.style.cursor="default",e.started=!1))},this.mouseup=function(e){},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=td(t,a);e.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=i.x/Na*2-1,r.y=-i.y/Aa*2+1,e.numpoints<2?e.getInterSects(r,e.color,!1):e.started=!1)},this.MSPointerUp=function(e){},this.touchstart=function(t){t.preventDefault(),e.started=!0;var a=ed(u.domElement,t,0);Ka&&Bs.getCurrentpage().usevector3Dxml&&(r.x=a.x/Na*2-1,r.y=-a.y/Aa*2+1,e.numpoints<2?e.getInterSects(r,e.color,!1):e.started=!1)},this.touchcancel=function(e){},this.touchend=function(e){}},_s.select3d=function(e){var a,i=this,r=new THREE.Raycaster,s=new THREE.Vector2,o=(new THREE.Vector3,!1),l=null;a=Bs.getCurrentpage().Vector3DPageObj.pointTreshold,r.params.Points.threshold=a,this.selectType=e.p1,this.name="select3d",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,_u(Yu("select3d")),this.getInterSects=function(e,t){var a=null;if(r.setFromCamera(e,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var s=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),n=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),c=Bs.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==s.length)return;var h=[];if(0==n.length)h=[];else for(var u=0;u<n.length;u++)h.push(r.intersectObjects(n[u],!0));if(0==c.length)var d=null;else d=r.intersectObjects(c);var p=r.intersectObjects(s,!0)}else p=r.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(d)if(d.length>0)for(var g=0;g<d.length;g++){var m=!0,f=!0,y=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=d[g].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=d[g].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=d[g].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),d[g].object.visible&&m&&f&&y){if("LineSegments"==d[g].object.type)continue;if("floorplan"==d[g].object.userData.type)o=!0;else if("Points"==d[g].object.type)o=t,a=d[g].object.uuid,t||1==i.selectType&&(Bs.getCurrentpage().select3Dmarkup(a,!0),l=d[g].index);else{if("symbol"==d[g].object.userData.type){a=d[g].object.uuid,o=t,t||1==i.selectType&&Bs.getCurrentpage().select3Dmarkup(a,!0);break}if("camera"==d[g].object.userData.type){a=d[g].object.uuid,1==i.selectType&&Bs.getCurrentpage().select3Dmarkup(a,!0);break}}}else o=!0}else o=!0;else o=!0;if(h.length>0&&o)for(g=0;g<h.length;g++)if(h[g].length>0&&o)for(var v=0;v<h[g].length;v++)if("LineSegments"!=h[g][v].object.type){var b=null;if(m=!0,f=!0,y=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=h[g][v].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=h[g][v].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=h[g][v].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[g][v].object.visible&&m&&f&&y){if(t){Bs.getCurrentpage().moveSelected3DMarkup(h[g][v].point,l);break}if(0==i.selectType){b=h[g][v];break}}}if(p.length>0&&o){for(g=0;g<p.length;g++)if("LineSegments"!=p[g].object.type&&(m=!0,f=!0,y=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=p[g].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=p[g].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=p[g].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),p[g].object.visible&&m&&f&&y)){if(t){Bs.getCurrentpage().moveSelected3DMarkup(p[g].point,l);break}if(0==i.selectType){var x=!1;if(null!=b&&(x=b.distance<p[g].distance),x)var w=b.object.name,k=b.object.type;else w=p[g].object.name,k=p[g].object.type;w=Bs.getCurrentpage().getMeshName(w,k),Bs.getCurrentpage().select3DBlock(w,!0,x),l=null;break}}}else null!=b&&(w=b.object.name,k=b.object.type,w=Bs.getCurrentpage().getMeshName(w,k),Bs.getCurrentpage().select3DBlock(w,!0,x),l=null)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),Bs.getCurrentpage().camera.updateProjectionMatrix(),i.started=!0;var t=td(u.domElement,e);Ka&&Bs.getCurrentpage().usevector3Dxml&&(s.x=t.x/Na*2-1,s.y=-t.y/Aa*2+1,i.getInterSects(s,!1))},this.mouseup=function(e){e.preventDefault(),e.stopPropagation(),i.started&&(i.started=!1)},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var t=td(u.domElement,e);Ka&&Bs.getCurrentpage().usevector3Dxml&&(s.x=t.x/Na*2-1,s.y=-t.y/Aa*2+1,i.started&&i.getInterSects(s,!0),"markupedit"==Bs.curcontrol3D&&al(n))},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation(),Bs.getCurrentpage().camera.updateProjectionMatrix();var a=td(t,e);i.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml&&(s.x=a.x/Na*2-1,s.y=-a.y/Aa*2+1,i.getInterSects(s))},this.MSPointerUp=function(e){i.started&&(i.started=!1)},this.touchstart=function(e){e.preventDefault(),i.started=!0,Bs.getCurrentpage().camera.updateProjectionMatrix();var t=ed(u.domElement,e,0);Ka&&Bs.getCurrentpage().usevector3Dxml&&(s.x=t.x/Na*2-1,s.y=-t.y/Aa*2+1,i.getInterSects(s))},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1)},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1)},this.keydown=function(e){if(null!=Bs&&null!=Bs&&Ka&&!Bs.bMarkupLocked)switch(ws&&(Bs.bMarkupLocked=ws),e.keyCode){case 13:case 8:break;case 46:Bs.getCurrentpage().delete3DMarkup()}}},_s.Walkthrough3D=function(){var e=this;this.name="Walkthrough3D",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.enabled=!0,this.noZoom=!1,this.enableSelect=!1,this.selectType=null;var t,a=new THREE.Raycaster,i=new THREE.Vector2,r=(new THREE.Vector3,!1),s=null;t=Bs.getCurrentpage().Vector3DPageObj.pointTreshold,a.params.Points.threshold=t,Bs.getCurrentpage().walkthroughcontrol.isLocked=!0,_u(Yu("Walkthrough3D")),this.setSelect=function(t,a){e.enableSelect=t,e.selectType=a},this.getInterSects=function(t,i){var n=null;if(a.setFromCamera(t,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var o=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),l=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),c=Bs.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==o.length)return;var h=[];if(0==l.length)h=[];else for(var u=0;u<l.length;u++)h.push(a.intersectObjects(l[u],!0));if(0==c.length)var d=null;else d=a.intersectObjects(c);var p=a.intersectObjects(o,!0)}else p=a.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(d)if(d.length>0)for(var g=0;g<d.length;g++){var m=!0,f=!0,y=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=d[g].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=d[g].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=d[g].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),d[g].object.visible&&m&&f&&y){if("LineSegments"==d[g].object.type)continue;if("floorplan"==d[g].object.userData.type)r=!0;else if("Points"==d[g].object.type)r=i,n=d[g].object.uuid,i||1==e.selectType&&(Bs.getCurrentpage().select3Dmarkup(n,!0),s=d[g].index);else{if("symbol"==d[g].object.userData.type){n=d[g].object.uuid,r=i,i||1==e.selectType&&Bs.getCurrentpage().select3Dmarkup(n,!0);break}if("camera"==d[g].object.userData.type){n=d[g].object.uuid,1==e.selectType&&Bs.getCurrentpage().select3Dmarkup(n,!0);break}}}else r=!0}else r=!0;else r=!0;if(h.length>0&&r)for(g=0;g<h.length;g++)if(h[g].length>0&&r)for(var v=0;v<h[g].length;v++)if("LineSegments"!=h[g][v].object.type){var b=null;if(m=!0,f=!0,y=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=h[g][v].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=h[g][v].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=h[g][v].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[g][v].object.visible&&m&&f&&y){if(i){Bs.getCurrentpage().moveSelected3DMarkup(h[g][v].point,s);break}if(0==e.selectType){b=h[g][v];break}}}if(p.length>0&&r){for(g=0;g<p.length;g++)if("LineSegments"!=p[g].object.type&&(m=!0,f=!0,y=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(m=p[g].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,f=p[g].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,y=p[g].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),p[g].object.visible&&m&&f&&y)){if(i){Bs.getCurrentpage().moveSelected3DMarkup(p[g].point,s);break}if(0==e.selectType){var x=!1;if(null!=b&&(x=b.distance<p[g].distance),x)var w=b.object.name,k=b.object.type;else w=p[g].object.name,k=p[g].object.type;w=Bs.getCurrentpage().getMeshName(w,k),Bs.getCurrentpage().select3DBlock(w,!0,x),s=null;break}}}else null!=b&&(w=b.object.name,k=b.object.type,w=Bs.getCurrentpage().getMeshName(w,k),Bs.getCurrentpage().select3DBlock(w,!0,x),s=null)},this.commonMouseDown=function(t,a){if(Ka&&Bs.getCurrentpage().usevector3Dxml){var r=Bs.getCurrentpage().walkthroughcontrol;if(e.started?r.onMouseDown(a):(r.onMouseDown(a),e.started=!0),e.enableSelect){e.selectstarted=!0;var s=td(u.domElement,t);Bs.getCurrentpage().camera.updateProjectionMatrix(),i.x=s.x/Na*2-1,i.y=-s.y/Aa*2+1,e.getInterSects(i,!1)}}},this.commonMouseMove=function(t,a,r){Ka&&Bs.getCurrentpage().usevector3Dxml&&(Bs.getCurrentpage().walkthroughcontrol.onMouseMove(t),e.enableSelect&&(i.x=a/Na*2-1,i.y=-r/Aa*2+1,e.selectstarted&&e.getInterSects(i,!0)))},this.commonMouseOut=function(){if(Ka&&Bs.getCurrentpage().usevector3Dxml)for(var e=1;e<7;e++)Bs.getCurrentpage().walkthroughcontrol.movedirection(e,!1)},this.commonMouseUp=function(t){Ka&&Bs.getCurrentpage().usevector3Dxml&&(e.selectstarted=!1,Bs.getCurrentpage().walkthroughcontrol.onMouseUp(t.button))},this.mousedown=function(t){t.preventDefault(),e.commonMouseDown(t,t.button)},this.touchstart=function(t){t.preventDefault(),e.commonMouseDown(t,0)},this.pointerdown=function(e){scope.MSPointerDown(e)},this.MSPointerDown=function(t){t.preventDefault(),e.commonMouseDown(t,t.button)},this.pointermove=function(e){scope.MSPointerMove(e)},this.mousemove=function(t){var a=td(u.domElement,t);e.commonMouseMove(t,a.x,a.y)},this.MSPointerMove=function(t){t.preventDefault();var a=td(u.domElement,t);e.commonMouseMove(t,a.x,a.y)},this.touchmove=function(t){t.preventDefault();var a=ed(u.domElement,t,0);e.commonMouseMove(t,a.x,a.y)},this.mouseup=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.pointerup=function(e){scope.MSPointerUp(e)},this.MSPointerUp=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.pointerout=function(e){scope.MSPointerOut(e)},this.touchcancel=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.touchend=function(t){t.preventDefault(),e.commonMouseUp(t),e.commonMouseMove(0,0)},this.MSPointerOut=function(t){t.preventDefault(),e.commonMouseOut()},this.mouseout=function(t){t.preventDefault(),e.commonMouseOut()},this.keydown=function(e){if(!e.altKey&&Ka&&Bs.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:Bs.getCurrentpage().walkthroughcontrol.quickspeed(!0);break;case 87:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 83:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 65:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 68:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!0);break;case 82:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 70:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 33:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 34:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 38:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 40:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 37:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 39:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!0)}},this.keyup=function(e){if(Ka&&Bs.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:Bs.getCurrentpage().walkthroughcontrol.quickspeed(!1);break;case 87:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 83:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 65:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 68:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!1);break;case 82:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 70:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 33:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 34:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 38:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 40:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 37:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 39:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!1)}},this.mousewheel=function(t){e.onMouseWheel(t)},this.wheel=function(t){e.onMouseWheel(t)},this.DOMMouseScroll=function(e){},this.onMouseWheel=function(t){if(!1!==e.enabled&&!0!==e.noZoom&&(t.preventDefault(),t.stopPropagation(),Ka&&Bs.getCurrentpage().usevector3Dxml)){var a=0;void 0!==t.wheelDelta?a=t.wheelDelta:void 0!==t.deltaY&&(a=-t.deltaY),a>0?Bs.getCurrentpage().walkthroughcontrol.scrollforward(1):Bs.getCurrentpage().walkthroughcontrol.scrollbackward(1)}}},_s.Walk3D=function(){var e=this;this.name="Walkthrough3D",this.anglelengthsupport=!1,this.started=!1,Bs.getCurrentpage().walkthroughcontrol.enabled=!0,new THREE.Vector2,this.setPos=function(){Bs.getCurrentpage().walkthroughcontrol.setPos()},this.keydown=function(e){if(!e.altKey&&Ka&&Bs.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:Bs.getCurrentpage().walkthroughcontrol.mouseMove=!0;break;case 87:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 83:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 65:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 68:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!0);break;case 82:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 70:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 33:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!0);break;case 34:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!0);break;case 38:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!0);break;case 40:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!0);break;case 37:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!0);break;case 39:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!0)}},this.keyup=function(e){if(Ka&&Bs.getCurrentpage().usevector3Dxml)switch(e.keyCode){case 16:Bs.getCurrentpage().walkthroughcontrol.mouseMove=!1;break;case 87:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 83:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 65:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 68:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!1);break;case 82:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 70:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 33:Bs.getCurrentpage().walkthroughcontrol.movedirection(5,!1);break;case 34:Bs.getCurrentpage().walkthroughcontrol.movedirection(6,!1);break;case 38:Bs.getCurrentpage().walkthroughcontrol.movedirection(1,!1);break;case 40:Bs.getCurrentpage().walkthroughcontrol.movedirection(2,!1);break;case 37:Bs.getCurrentpage().walkthroughcontrol.movedirection(3,!1);break;case 39:Bs.getCurrentpage().walkthroughcontrol.movedirection(4,!1)}},this.mousedown=function(t){t.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&(e.started?Bs.getCurrentpage().walkthroughcontrol.onMouseDown(t.button):(Bs.getCurrentpage().walkthroughcontrol.onMouseDown(t.button),e.started=!0))},this.mousemove=function(e){if(Ka&&Bs.getCurrentpage().usevector3Dxml){var t=td(u.domElement,e);Bs.getCurrentpage().walkthroughcontrol.onMouseMove(t.x,t.y)}},this.mouseup=function(e){e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().walkthroughcontrol.onMouseUp(e.button)},this.mouseout=function(e){if(e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml)for(var t=1;t<7;t++)Bs.getCurrentpage().walkthroughcontrol.movedirection(t,!1)},this.touchstart=function(t){t.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&(ed(u.domElement,t,0),e.started?Bs.getCurrentpage().walkthroughcontrol.onMouseDown(0):(Bs.getCurrentpage().walkthroughcontrol.onMouseDown(0),Bs.getCurrentpage().walkthroughcontrol.enabled=!0,e.started=!0))},this.touchmove=function(e){if(e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml){var t=ed(u.domElement,e,0);Bs.getCurrentpage().walkthroughcontrol.onMouseMove(t.x,t.y)}},this.touchcancel=function(e){e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&(Bs.getCurrentpage().walkthroughcontrol.onMouseUp(0),Bs.getCurrentpage().walkthroughcontrol.onMouseMove(0,0))},this.touchend=function(e){e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&(Bs.getCurrentpage().walkthroughcontrol.onMouseUp(0),Bs.getCurrentpage().walkthroughcontrol.onMouseMove(0,0))},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(e){e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml&&(td(u.domElement,e),Bs.getCurrentpage().walkthroughcontrol.onMouseDown(e.button))},this.pointermove=function(t){e.MSPointerMove(t)},this.MSPointerMove=function(e){if(e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml){var t=td(u.domElement,e);Bs.getCurrentpage().walkthroughcontrol.onMouseMove(t.x,t.y)}},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerUp=function(e){e.preventDefault(),Bs.getCurrentpage().walkthroughcontrol.onMouseUp(e.button)},this.pointerout=function(t){e.MSPointerOut(t)},this.MSPointerOut=function(e){if(e.preventDefault(),Ka&&Bs.getCurrentpage().usevector3Dxml)for(diri=1;diri<7;diri++)Bs.getCurrentpage().walkthroughcontrol.movedirection(diri,!1)}},_s.orbitControl=function(){var e=this,t=-1,a=[];this.name="orbitControl",this.anglelengthsupport=!1,this.refreshSupport=!1,this.object=Bs.getCurrentpage().camera,this.domElement=u.domElement,this.enabled=!0,this.target=new THREE.Vector3,this.navtarget=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=.5,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.curmousepos={x:0,y:0,xus:0,yus:0},this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var i=this,r=1e-6,s=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,d=new THREE.Vector3,p=new THREE.Vector3,g=(new THREE.Vector3,new THREE.Vector2),m=new THREE.Vector2,f=new THREE.Vector2,y=0,v=0,b=1,x=new THREE.Vector3,w=new THREE.Vector3,k=new THREE.Quaternion,D=(new THREE.Vector3,new THREE.Quaternion,-1),C=0,P=1,S=2,R=3,M=4,T=5,E=D,F=(new THREE.Quaternion).setFromUnitVectors(Bs.getCurrentpage().camera.up,new THREE.Vector3(0,1,0));if(parseInt(THREE.REVISION)<=127)var I=F.clone().inverse();else I=F.clone().invert();this.selectstarted=!1,this.enableSelect=!1,this.selectType=null;var j,O=new THREE.Raycaster,L=new THREE.Vector2,V=(new THREE.Vector3,!1),N=null;function A(){return 2*Math.PI/60/60*i.autoRotateSpeed}function B(){return Math.pow(.95,i.zoomSpeed)}j=Bs.getCurrentpage().Vector3DPageObj.pointTreshold,O.params.Points.threshold=j,_u(Yu("orbitControl")),this.setSelect=function(t,a){e.enableSelect=t,e.selectType=a},this.getInterSects=function(t,a){var i=null;if(O.setFromCamera(t,Bs.getCurrentpage().camera),Bs.getCurrentpage().usevector3DGLTF){var r=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),s=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren(),n=Bs.getCurrentpage().Vector3DPageObj.getMarkupChildren();if(0==r.length)return;var o=[];if(0==s.length)o=[];else for(var l=0;l<s.length;l++)o.push(O.intersectObjects(s[l],!0));if(0==n.length)var c=null;else c=O.intersectObjects(n);var h=O.intersectObjects(r,!0)}else h=O.intersectObjects(Bs.getCurrentpage().Vector3DPageObj.scene.children);if(c)if(c.length>0)for(var u=0;u<c.length;u++){var d=!0,p=!0,g=!0;if(Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(d=c[u].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,p=c[u].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=c[u].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),c[u].object.visible&&d&&p&&g){if("LineSegments"==c[u].object.type)continue;if("floorplan"==c[u].object.userData.type)V=!0;else if("Points"==c[u].object.type)V=a,i=c[u].object.uuid,a||1==e.selectType&&(Bs.getCurrentpage().select3Dmarkup(i,!0),N=c[u].index);else{if("symbol"==c[u].object.userData.type){i=c[u].object.uuid,V=a,a||1==e.selectType&&Bs.getCurrentpage().select3Dmarkup(i,!0);break}if("camera"==c[u].object.userData.type){i=c[u].object.uuid,1==e.selectType&&Bs.getCurrentpage().select3Dmarkup(i,!0);break}}}else V=!0}else V=!0;else V=!0;if(o.length>0&&V)for(u=0;u<o.length;u++)if(o[u].length>0&&V)for(var m=0;m<o[u].length;m++)if("LineSegments"!=o[u][m].object.type&&!o[u][m].object.userData.temptransparent){var f=null;if(d=!0,p=!0,g=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(d=o[u][m].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,p=o[u][m].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=o[u][m].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),o[u][m].object.visible&&d&&p&&g){if(a){Bs.getCurrentpage().moveSelected3DMarkup(o[u][m].point,N);break}if(0==e.selectType){f=o[u][m];break}}}if(h.length>0&&V){for(u=0;u<h.length;u++)if("LineSegments"!=h[u].object.type&&!h[u].object.userData.temptransparent&&(d=!0,p=!0,g=!0,Bs.getCurrentpage().Vector3DPageObj.clippingOn&&(d=h[u].point.x>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneX.constant,p=h[u].point.y>-Bs.getCurrentpage().Vector3DPageObj.globalPlaneY.constant,g=h[u].point.z<Bs.getCurrentpage().Vector3DPageObj.globalPlaneZ.constant),h[u].object.visible&&d&&p&&g)){if(a){Bs.getCurrentpage().moveSelected3DMarkup(h[u].point,N);break}if(0==e.selectType){var y=!1;if(null!=f&&(y=f.distance<h[u].distance),y)var v=f.object.name,b=f.object.type;else v=h[u].object.name,b=h[u].object.type;v=Bs.getCurrentpage().getMeshName(v,b),Bs.getCurrentpage().select3DBlock(v,!0,y),N=null;break}}}else null!=f&&(v=f.object.name,b=f.object.type,v=Bs.getCurrentpage().getMeshName(v,b),Bs.getCurrentpage().select3DBlock(v,!0,y),N=null)},this.resetCam=function(e){null!=e&&(this.object.matrix.fromArray(e),this.object.matrix.decompose(e,this.object.quaternion,this.object.scale))},this.restorelast=function(){this.object.position.copy(w),this.object.quaternion.copy(k)},this.setDimensions=function(t,a,i,r){e.maxDistance=t,e.target.copy(a),null!=r&&e.object.position.copy(r),e.update()},this.setinit=function(){e.target.set(0,5,0),e.update()},this.rotateLeft=function(e){void 0===e&&(e=A()),v-=e},this.rotateUp=function(e){void 0===e&&(e=A()),y-=e},this.panLeft=function(e){var t=this.object.matrix.elements;d.set(t[0],t[1],t[2]),d.multiplyScalar(-e),x.add(d)},this.panUp=function(e){var t=this.object.matrix.elements;d.set(t[4],t[5],t[6]),d.multiplyScalar(e),x.add(d)},this.pan=function(e,t){var a=i.domElement===document?i.domElement.body:i.domElement;if(void 0!==i.object.fov){var r=i.object.position.clone().sub(i.target).length();r*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*e*r/a.clientHeight),i.panUp(2*t*r/a.clientHeight)}else void 0!==i.object.top?(i.panLeft(e*(i.object.right-i.object.left)/a.clientWidth),i.panUp(t*(i.object.top-i.object.bottom)/a.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=B()),b/=e},this.dollyOut=function(e){void 0===e&&(e=B()),b*=e},this.update=function(){var e=this.object.position;p.copy(e).sub(this.target),p.applyQuaternion(F);var t=Math.atan2(p.x,p.z),a=Math.atan2(Math.sqrt(p.x*p.x+p.z*p.z),p.y);this.autoRotate&&this.rotateLeft(A()),t+=v,a+=y,a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a)),a=Math.max(r,Math.min(Math.PI-r,a));var i=p.length()*b;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(x),p.x=i*Math.sin(a)*Math.sin(t),p.y=i*Math.cos(a),p.z=i*Math.sin(a)*Math.cos(t),p.applyQuaternion(I),e.copy(this.target).add(p),this.object.lookAt(this.target),v=0,y=0,b=1,x.set(0,0,0),(w.distanceToSquared(this.object.position)>r||8*(1-k.dot(this.object.quaternion))>r)&&(w.copy(this.object.position),k.copy(this.object.quaternion))},this.reset=function(){E=D,null!=e.target0&&e.target.copy(e.target0),null!=e.position0&&e.object.position.copy(e.position0),this.enabled=!0,this.update()},this.mousedown=function(t){if(!1!==i.enabled){t.preventDefault(),t.stopPropagation(),e.started=!0;var a=td(i.domElement,t);if(Ka&&Bs.getCurrentpage().usevector3Dxml){if(0===t.button){if(!0===i.noRotate)return;E=C,s.set(a.x,a.y)}else if(1===event.button){if(!0===i.noZoom)return;E=P,g.set(a.x,a.y)}else if(2===event.button){if(!0===i.noPan)return;E=S,l.set(a.x,a.y)}e.enableSelect&&(e.selectstarted=!0,a=td(u.domElement,t),Bs.getCurrentpage().camera.updateProjectionMatrix(),L.x=a.x/Na*2-1,L.y=-a.y/Aa*2+1,e.getInterSects(L,!1))}}},this.mousemove=function(t){if(!1!==i.enabled){t.preventDefault();var a=td(i.domElement,t);e.curmousepos=a;var r=i.domElement===document?i.domElement.body:i.domElement;if(Ka&&Bs.getCurrentpage().usevector3Dxml){if(E===C){if(!0===i.noRotate)return;n.set(a.x,a.y),o.subVectors(n,s),i.rotateLeft(2*Math.PI*o.x/r.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/r.clientHeight*i.rotateSpeed),s.copy(n)}else if(E===P){if(!0===i.noZoom)return;m.set(a.x,a.y),f.subVectors(m,g),f.y>0?i.dollyIn():i.dollyOut(),g.copy(m)}else if(E===S){if(!0===i.noPan)return;c.set(a.x,a.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)}i.update(),e.enableSelect&&(L.x=0/Na*2-1,L.y=-0/Aa*2+1,e.selectstarted&&e.getInterSects(L,!0))}}},this.mouseup=function(t){!1!==i.enabled&&(t.preventDefault(),t.stopPropagation(),e.started&&(e.started=!1,E=D),e.selectstarted=!1)},this.mousewheel=function(e){i.onMouseWheel(e)},this.wheel=function(e){i.onMouseWheel(e)},this.DOMMouseScroll=function(e){},this.panscroll=function(){var t=.5*Ua,a=.5*Ba-e.curmousepos.xus,r=t-e.curmousepos.yus;l.set(a*b,r*b),c.set(a,r),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)},this.onMouseWheel=function(e){if(!1!==i.enabled&&!0!==i.noZoom&&(e.preventDefault(),e.stopPropagation(),Ka&&Bs.getCurrentpage().usevector3Dxml)){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=-e.deltaY),t>0?(i.dollyOut(),i.panscroll()):(i.dollyIn(),i.panscroll()),i.update()}},this.keydown=function(e){if(!1!==i.enabled&&!0!==i.noKeys&&!0!==i.noPan&&Ka&&Bs.getCurrentpage().usevector3Dxml)switch(e.keyCode){case i.keys.UP:i.pan(0,i.keyPanSpeed),i.update();break;case i.keys.BOTTOM:i.pan(0,-i.keyPanSpeed),i.update();break;case i.keys.LEFT:i.pan(i.keyPanSpeed,0),i.update();break;case i.keys.RIGHT:i.pan(-i.keyPanSpeed,0),i.update()}},this.pointerdown=function(t){e.MSPointerDown(t)},this.MSPointerDown=function(r){r.preventDefault(),r.stopPropagation();var n=td(i.domElement,r);if(t++,a[t]=new $s(r.pointerId,n.x,n.y),e.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml)switch(t){case 0:if(0===r.button){if(!0===i.noRotate)return;E=C,s.set(n.x,n.y)}else if(1===event.button){if(!0===i.noZoom)return;E=P,g.set(n.x,n.y)}else if(2===event.button){if(!0===i.noPan)return;E=S,l.set(n.x,n.y)}break;case 1:if(!0===i.noZoom)return;E=M;var o=Math.max(a[0].x,a[1].x)-Math.min(a[0].x,a[1].x),c=Math.max(a[0].y,a[1].y)-Math.min(a[0].y,a[1].y),h=Math.sqrt(o*o+c*c);g.set(0,h)}},this.pointermove=function(t){e.MSPointerMove(t)},this.MSPointerMove=function(e){if(Ka&&!1!==i.enabled){e.preventDefault();for(var r=td(i.domElement,e),u=-1;u<t;)u++,a[u].pointID==e.pointerId&&(a[u].x=r.x,a[u].y=r.y);var d=i.domElement===document?i.domElement.body:i.domElement;if(Ka&&Bs.getCurrentpage().usevector3Dxml)switch(t){case 0:if(E===C){if(!0===i.noRotate)return;n.set(r.x,r.y),o.subVectors(n,s),i.rotateLeft(2*Math.PI*o.x/d.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/d.clientHeight*i.rotateSpeed),s.copy(n)}else if(E===P){if(!0===i.noZoom)return;m.set(r.x,r.y),f.subVectors(m,g),f.y>0?i.dollyIn():i.dollyOut(),g.copy(m)}else if(E===S){if(!0===i.noPan)return;c.set(r.x,r.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)}i.update();break;case 1:if(!0===i.noZoom)return;if(E!==M)return;var p=Math.max(a[0].x,a[1].x)-Math.min(a[0].x,a[1].x),y=Math.max(a[0].y,a[1].y)-Math.min(a[0].y,a[1].y),v=Math.sqrt(p*p+y*y);m.set(0,v),f.subVectors(m,g),f.y>0?i.dollyOut():f.y<0&&i.dollyIn(),g.copy(m),i.update();break;case 2:if(!0===i.noPan)return;if(E!==T)return;c.set(a[0].x,a[0].y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c),i.update();break;default:E=D}}},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerUp=function(a){t--,a.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))},this.touchstart=function(t){if(!1!==i.enabled&&(t.preventDefault(),e.started=!0,Ka&&Bs.getCurrentpage().usevector3Dxml)){var a=ed(u.domElement,t,0);switch(t.touches.length){case 1:if(!0===i.noRotate)return;E=R,s.set(a.x,a.y);break;case 2:if(!0===i.noZoom)return;var r=ed(u.domElement,t,1);E=M;var n=Math.max(a.x,r.x)-Math.min(a.x,r.x),o=Math.max(a.y,r.y)-Math.min(a.y,r.y),c=Math.sqrt(n*n+o*o);g.set(0,c);break;case 3:if(!0===i.noPan)return;E=T,l.set(a.x,a.y);break;default:E=D}}},this.touchmove=function(e){if(!1!==i.enabled){e.preventDefault(),e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;if(Ka&&Bs.getCurrentpage().usevector3Dxml){var a=ed(u.domElement,e,0);switch(event.touches.length){case 1:if(!0===i.noRotate)return;if(E!==R)return;n.set(a.x,a.y),o.subVectors(n,s),i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed),s.copy(n),i.update();break;case 2:var r=ed(u.domElement,e,1);if(!0===i.noZoom)return;if(E!==M)return;var d=Math.max(a.x,r.x)-Math.min(a.x,r.x),p=Math.max(a.y,r.y)-Math.min(a.y,r.y),y=Math.sqrt(d*d+p*p);m.set(0,y),f.subVectors(m,g),f.y>0?i.dollyOut():f.y<0&&i.dollyIn(),g.copy(m),i.update();break;case 3:if(!0===i.noPan)return;if(E!==T)return;c.set(a.x,a.y),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c),i.update();break;default:E=D}}}},this.touchcancel=function(t){t.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))},this.touchend=function(t){t.preventDefault(),!1!==i.enabled&&(E=D,e.started&&(e.started=!1))}},_s.magnify=function(){var e=this,a=0,i=0,r=0,s=0,c=0,h=0,u=0,d=0,p=0,g=0,m=0,f=0,y=0,v=0,b=0,x=0,w=0;this.name="magnify",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var k=1.5;_u(Yu("magnify")),Bs.getCurrentpage().usepdfjs&&Bs.getCurrentpage().renderPDFMagnify(k),this.drawMagnify=function(e){Bs.getCurrentpage().drawmagnify(e,l,k)},this.wheel=function(a){if(e.started&&Ka){var i=0;void 0!==a.wheelDelta?i=a.wheelDelta:void 0!==a.deltaY&&(i=Ga?-a.deltaY:50*-a.deltaY),i<0?k>1.5&&(k-=.2):k<10&&(k+=.2);var r=td(t,a);e.x0=r.x,e.y0=r.y,Bs.getCurrentpage().usepdfjs&&Bs.getCurrentpage().renderPDFMagnify(k),e.drawMagnify({x:e.x0,y:e.y0},l,k)}},this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=td(t,a);e.started=!0,e.x0=i.x,e.y0=i.y,e.x0,e.y0,o.style.top=i.yus-be.height/2+"px",o.style.left=i.xus-be.width/2+"px",o.style.visibility="visible"},this.mousedown=function(a){a.preventDefault(),a.stopPropagation(),e.started=!0;var i=td(t,a);e.x0=i.x,e.y0=i.y,e.x0,e.y0,o.style.top=i.yus-be.height/2+"px",o.style.left=i.xus-be.width/2+"px",o.style.visibility="visible"},this.touchstart=function(a){a.preventDefault(),e.started=!0;var i=ed(t,a,0);if(a.targetTouches.length>1)var r=ed(t,a,1);else r=ed(t,a,0);p=i.x,g=i.y,m=r.x,f=r.y,y=Math.abs(m-p),v=Math.abs(f-g);var s=Math.pow(y,2),n=Math.pow(v,2);b=Math.sqrt(s+n),x=b,w=b;var l=i.x+be.width/2,c=i.y-be.height/2;o.style.top=i.yus-be.height+"px",o.style.left=i.xus+"px",o.style.visibility="visible",e.drawMagnify({x:l,y:c})},this.MSPointerMove=function(a){if(e.started){var i=td(t,a);i.x,i.y,o.style.top=i.yus-be.height/2+"px",o.style.left=i.xus-be.width/2+"px",e.drawMagnify(i),i.x,i.y}},this.mousemove=function(a){if(e.started){var i=td(t,a);i.x,i.y,o.style.top=i.yus-be.height/2+"px",o.style.left=i.xus-be.width/2+"px",e.drawMagnify(i),i.x,i.y}},this.touchmove=function(n){if(n.preventDefault(),e.started){var l=ed(t,n,0);if(n.targetTouches.length>1)var p=ed(t,n,1);else p=ed(t,n,0);c=l.x,u=l.y,h=p.x,d=p.y,a=Math.min(c,h),i=Math.min(u,d),r=Math.abs(h-c),s=Math.abs(d-u),a+r/2,i+s/2;var g=l.x+be.width/2,m=l.y-be.height/2;o.style.top=l.yus-be.height+"px",o.style.left=l.xus+"px",e.drawMagnify({x:g,y:m});var f=Math.pow(r,2),y=Math.pow(s,2);b=Math.sqrt(f+y),w>=b?k=1.5:x-b>0?k>1.5&&(k-=.2):k<10&&(k+=.2),x=b}},this.MSPointerUp=function(t){e.started&&(e.mousemove(t),e.started=!1,o.style.visibility="hidden",Bs.getCurrentpage().magnifyoff(),al(n))},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,o.style.visibility="hidden",Bs.getCurrentpage().magnifyoff(),al(n))},this.touchcancel=function(t){t.preventDefault(),e.started&&t.targetTouches.length<1&&(e.started=!1,o.style.visibility="hidden",Bs.getCurrentpage().magnifyoff(),al(n))},this.touchend=function(t){t.preventDefault(),e.started&&t.targetTouches.length<1&&(e.started=!1,o.style.visibility="hidden",Bs.getCurrentpage().magnifyoff(),al(n))}},_s.note=function(){var e,i=this;this.started=!1,this.name="note",this.anglelengthsupport=!1,this.refreshSupport=!1,Bs.markuplist.length,this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(r){i.started=!0,Bs&&(Bs.bMarkupchanged=!0);var s=td(t,r);if(!Bn(s))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));i.x0=s.x,i.y0=s.y,(e=new Fo(10,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.scaling=Ln();var n=jn();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),Bs.selectedmarkup.id=Bs.markuplist.length-1,Cr||(gr=!0),Dr=Bs.markuplist.length-1,Hc(),i.started=!1,e=null,null!=Ut&&Ut.setNotediag(Bs.markuplist[Dr].text,!0),Pr){if(null!=zt){var o={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],o)}}else Cr||null==zt||(o={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],o))},this.mousedown=function(r){i.started=!0,Bs&&(Bs.bMarkupchanged=!0);var s=td(t,r);if(!Bn(s))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));i.x0=s.x,i.y0=s.y,(e=new Fo(10,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.scaling=Ln();var n=jn();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),Bs.selectedmarkup.id=Bs.markuplist.length-1,Dr=Bs.markuplist.length-1,Cr||(gr=!0),Dr=Bs.markuplist.length-1,Hc(),i.started=!1,e=null,null!=Ut&&Ut.setNotediag(Bs.markuplist[Dr].text,!0),Pr){if(null!=zt){var o={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],o)}}else Cr||null==zt||(o={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],o))},this.touchstart=function(r){i.started=!0,Bs&&(Bs.bMarkupchanged=!0);var s=ed(t,r,0);if(!Bn(s))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));i.x0=s.x,i.y0=s.y,(e=new Fo(10,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.scaling=Ln();var n=jn();if(e.xoffset=n.x,e.yoffset=n.y,e.x=i.x0,e.y=i.y0,e.seteditaction(0),e.drawme(a),e.savemetolistDraw(),Bs.selectedmarkup.id=Bs.markuplist.length-1,Cr||(gr=!0),Dr=Bs.markuplist.length-1,Hc(),i.started=!1,e=null,null!=Ut&&Ut.setNotediag(Bs.markuplist[Dr].text,!0),Pr){if(null!=zt){var o={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],o)}}else Cr||null==zt||(o={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],o))},this.mouseup=function(e){},this.touchend=function(e){}},_s.text=function(){var e,a=this;this.name="text",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,Bs.markuplist.length,this.pointerdown=function(e){a.MSPointerDown(e)},this.MSPointerDown=function(i){i.preventDefault(),i.stopPropagation(),a.started=!0,Bs&&(Bs.bMarkupchanged=!0);var r=td(t,i);if(!Bn(r))return a.started=!1,Bs&&(Bs.bMarkupchanged=!1),void(i.target.style.cursor="default");a.x0=r.x,a.y0=r.y,(e=new Fo(9,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.font.setFontname(tn.fontName),e.scaling=Ln();var s=jn();e.xoffset=s.x,e.yoffset=s.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.text="",e.savemetolistDraw(),Bs.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=At&&At.setTextdiag("")},this.mousedown=function(i){i.preventDefault(),i.stopPropagation(),a.started=!0,Bs&&(Bs.bMarkupchanged=!0);var r=td(t,i);if(!Bn(r))return a.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));a.x0=r.x,a.y0=r.y,(e=new Fo(9,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.font.setFontname(tn.fontName),e.scaling=Ln();var s=jn();e.xoffset=s.x,e.yoffset=s.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.savemetolistDraw(),Bs.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=At&&At.setTextdiag("")},this.touchstart=function(i){a.started=!0,Bs&&(Bs.bMarkupchanged=!0);var r=ed(t,i,0);if(!Bn(r))return a.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));a.x0=r.x,a.y0=r.y,(e=new Fo(9,0,0)).pagenumber=Bs.getcurPage(),e.viewname=Bs.getcur3DView(),null!=e.viewname&&(e.bfor3D=!0,e.pageheight=Aa,e.pagewidth=Na),e.font.setFontname(tn.fontName),e.scaling=Ln();var s=jn();e.xoffset=s.x,e.yoffset=s.y,e.x=a.x0,e.y=a.y0,e.seteditaction(0),e.savemetolistDraw(),Bs.selectedmarkup.id=e.markupnumber,a.started=!1,e=null,null!=At&&At.setTextdiag("")},this.mouseup=function(e){a.started},this.touchend=function(e){}},_s.pencil=function(e){var i=this;this.started=!1,this.name="pencil",this.anglelengthsupport=!1,this.refreshSupport=!1,this.draw=!1,Bs.markuplist.length;var r,s=0,n=e.p1;_u(Yu("pencil")),this.newpencil=function(e,t){(r=new Fo(0,e,0)).pagenumber=Bs.getcurPage(),r.viewname=Bs.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=Aa,r.pagewidth=Na),r.scaling=Ln();var a=jn();r.xoffset=a.x,r.yoffset=a.y,r.x=t.x,r.y=t.y,r.seteditaction(0)},this.mousedown=function(e){var a=td(t,e);i.draw=!0,0==s?(i.newpencil(n,a),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)):(r.addline(),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)),s++},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){var a=td(t,e);i.draw=!0,0==s?(i.newpencil(n,a),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)):(r.addline(),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)),s++},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var s=td(t,e);i.started&&i.draw&&(r.addpoint(s.x,s.y),r.drawme(a))},this.pointermove=function(e){i.MSPointerMove(e)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var s=td(t,e);i.started&&i.draw&&(r.addpoint(s.x,s.y),r.drawme(a))},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerUp=function(e){e.preventDefault(),i.draw=!1},this.mouseup=function(e){e.preventDefault(),i.draw=!1},this.touchstart=function(e){e.preventDefault(),i.draw=!0;var a=ed(t,e,0);0==s?(i.newpencil(n,a),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)):(r.addline(),i.started=!0,r.addpoint(a.x,a.y),Bs&&(Bs.bMarkupchanged=!0)),s++},this.touchmove=function(e){if(e.preventDefault(),i.started&&i.draw){var s=ed(t,e,0);r.addpoint(s.x,s.y),r.drawme(a)}},this.touchcancel=function(e){e.preventDefault(),i.draw=!1},this.touchend=function(e){e.preventDefault(),i.draw=!1},this.apply=function(){if(i.draw=!1,Cr||(gr=!0),Dr=Bs.markuplist.length,r.addline(),r.findrectangle(),r.savemetolistDraw(),Hc(),i.started=!1,r=null,Pr){if(null!=zt){var e={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],e)}}else Cr||null==zt||(e={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],e))}},_s.rect=function(e){var i,r,s=this,o=0,l=0,c=(Bs.markuplist.length,!1);this.name="rect",this.anglelengthsupport=!0,this.refreshSupport=!1,this.bUsemouseinput=!0,this.started=!1;var h=e.p1,u=e.p2,d=e.redact;_u(Yu("rect")),this.setWidthHeight=function(e,r){if(s.bUsemouseinput=!1,null!=i){i.x=s.x0,i.y=s.y0;var n=i.w,o=i.h,l=i.setWidthHeight(e,r),c={x:i.x+l.w,y:i.y+l.h};a.clearRect(0,0,t.width,t.height),Bn(c)?(i.w=l.w,i.h=l.h,i.drawme(a)):(i.w=n,i.h=o,s.bUsemouseinput=!0,i.drawme(a),i.bUsemouseinput=!0,null!=Ea&&Ea.onDrawError("outside"))}},this.apply=function(){a.clearRect(0,0,t.width,t.height),i.drawme(a),s.endRect()},this.pointermove=function(e){s.MSPointerMove(e)},this.pointerdown=function(e){s.MSPointerDown(e)},this.pointerup=function(e){s.MSPointerUp(e)},this.startRect=function(e){if(s.started=!0,Bs&&(Bs.bMarkupchanged=!0),c){if(0!=Bs.getCurrentpage().drotation)var t=rn(r);else t=r;s.x0=t.x,s.y0=t.y}else s.x0=e.x,s.y0=e.y;(i=new Fo(h,u,ms)).bRedact=d,3==u&&(i.transparency=30,i.fillcolor=hn(i.fillcolor,i.transparency)),i.scaling=Ln();var a=jn();i.xoffset=a.x,i.yoffset=a.y,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0)},this.drawRect=function(e){if(s.bUsemouseinput)if(c){if(0!=Bs.getCurrentpage().drotation)var t=rn(r);else t=r;i.x=Math.min(t.x,s.x0),i.y=Math.min(t.y,s.y0),i.w=Math.abs(t.x-s.x0),i.h=Math.abs(t.y-s.y0),o=t.x,l=t.y}else i.x=Math.min(e.x,s.x0),i.y=Math.min(e.y,s.y0),i.w=Math.abs(e.x-s.x0),i.h=Math.abs(e.y-s.y0),o=e.x,l=e.y},this.endRect=function(){if(s.started=!1,Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),i=null,Hc(),al(n),Pr){if(null!=zt){var e={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],e)}}else Cr||null==zt||(e={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],e))},this.setSnap=function(e){null==(r=Bs.getCurrentpage().getsnap(e))&&(c=!1,a.clearRect(0,0,t.width,t.height)),r.found?(c=!0,sd(a,r)):(c=!1,a.clearRect(0,0,t.width,t.height))},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation(),s.started=!0,Bs&&(Bs.bMarkupchanged=!0);var a=td(t,e);if(!Bn(a))return s.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));s.startRect(a)},this.mousedown=function(e){if(e.preventDefault(),e.stopPropagation(),s.started)s.mousemove(e),s.endRect(),s.started=!1;else{s.started=!0,Bs&&(Bs.bMarkupchanged=!0);var a=td(t,e);if(!Bn(a))return s.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));s.startRect(a)}},this.touchstart=function(e){e.preventDefault(),s.started=!0,Bs&&(Bs.bMarkupchanged=!0);var a=ed(t,e,0);if(!Bn(a))return s.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));s.x0=a.x,s.y0=a.y,(i=new Fo(h,u,ms)).bRedact=d,3==u&&(i.transparency=30,i.fillcolor=hn(i.fillcolor,i.transparency)),i.scaling=Ln();var r=jn();i.xoffset=r.x,i.yoffset=r.y,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.setSnap(n),s.started&&(Bn(n)?s.drawRect(n):s.bUsemouseinput&&(i.x=Math.min(o,s.x0),i.y=Math.min(l,s.y0),i.w=Math.abs(o-s.x0),i.h=Math.abs(l-s.y0)),a.clearRect(0,0,t.width,t.height),c&&sd(a,r),i.w&&i.h&&i.drawme(a))},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.setSnap(n),s.started&&(Bn(n)?s.drawRect(n):s.bUsemouseinput&&(i.x=Math.min(o,s.x0),i.y=Math.min(l,s.y0),i.w=Math.abs(o-s.x0),i.h=Math.abs(l-s.y0)),a.clearRect(0,0,t.width,t.height),c&&sd(a,r),i.drawme(a),i.w&&i.h)},this.touchmove=function(e){if(e.preventDefault(),s.started){var r=ed(t,e,0);if(Bn(r)){var n=Math.min(r.x,s.x0),c=Math.min(r.y,s.y0),h=Math.abs(r.x-s.x0),u=Math.abs(r.y-s.y0);o=r.x,l=r.y}else n=Math.min(o,s.x0),c=Math.min(l,s.y0),h=Math.abs(o-s.x0),u=Math.abs(l-s.y0);s.bUsemouseinput&&(i.x=n,i.y=c,i.w=h,i.h=u),a.clearRect(0,0,t.width,t.height),h&&u&&i.drawme(a)}},this.MSPointerUp=function(e){s.started&&(s.mousemove(e),s.endRect(),s.started=!1)},this.mouseup=function(e){},this.touchcancel=function(e){e.preventDefault(),s.started&&(s.endRect(),s.started=!1)},this.touchend=function(e){e.preventDefault(),s.started&&(s.endRect(),s.started=!1)}},_s.count=function(e){var i,r=this,s=0,n=0;this.draw=!1,this.name="count",this.anglelengthsupport=!1,this.refreshSupport=!1,Bs.markuplist.length;var o=e.p1,l=e.p2,c=0;this.curmousepos={x:0,y:0,xus:0,yus:0},_u(Yu("count")),this.setdimoffset=function(e){if(null!=i){if(e){i.scaling=Ln();var t=jn();i.xoffset=t.x,i.yoffset=t.y,r.orgscale=i.scaling,r.orgdx=i.xoffset,r.orgdy=i.yoffset}i.countshapes.length>0&&i.drawme(a)}},this.newshape=function(e,t){(i=new Fo(o,e,0)).strokecolor=i.fillcolor,i.outerRadius=Gr,i.innerRadius=.4*Gr,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),r.setdimoffset(!0),i.seteditaction(0),i.addcount(t),i.countshapes.length>0&&i.drawme(a),c++},this.apply=function(){if(r.draw=!1,Cr||(gr=!0),Dr=Bs.markuplist.length,i.findrectangle(),i.savemetolistDraw(),Hc(),r.started=!1,i=null,c=0,Pr){if(null!=zt){var e={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],e)}}else Cr||null==zt||(e={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],e))},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),i=Na-60,s=Aa-60;a.w/e<i&&a.h/e<s&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,r.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.scrollhandling=function(e){if(Ka&&!Bs.getCurrentpage().usevector3Dxml){var a=Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1;e<0?!a&&!br||Bs.pagelocked?(r.belowlimitExtent(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1,r.curmousepos),r.started&&r.setdimoffset(!1)):(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):!a&&!br||Bs.pagelocked?(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,r.curmousepos),r.started&&r.setdimoffset(!1)):(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e))}},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),r.scrollhandling(t)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var o=td(t,e),h=Bn(o);if(r.draw=!0,0==e.button){if(!h)return r.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));0==c?(r.started=!0,r.newshape(l,o)):(i.addcount(o),i.countshapes.length>0&&i.drawme(a),c++)}else s=o.x,n=o.y},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);r.curmousepos=a;var i=s-a.x,o=n-a.y;2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(i,o),r.setdimoffset(!1),s=a.x,n=a.y)},this.pointerdown=function(e){r.MSPointerDown(e)},this.pointermove=function(e){r.MSPointerMove(e)},this.MSPointerDown=function(e){var o=td(t,e),h=Bn(o);if(r.draw=!0,0==e.button){if(!h)return r.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));0==c?(r.started=!0,r.newshape(l,o)):(i.addcount(o),i.countshapes.length>0&&i.drawme(a),c++)}else s=o.x,n=o.y},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);r.curmousepos=a;var i=s-a.x,o=n-a.y;2==e.buttons&&(Bs.getCurrentpage().pan_update(i,o),s=a.x,n=a.y)},this.touchstart=function(e){e.preventDefault(),e.stopPropagation();var s=ed(t,e,0),n=Bn(s);if(r.draw=!0,!n)return r.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));0==c?(r.started=!0,r.newshape(l,s)):(i.addcount(s),i.countshapes.length>0&&i.drawme(a),c++)},this.touchmove=function(e){e.preventDefault();var a=ed(t,e,0);s=a.x,n=a.y}},_s.clipboardimage=function(e){var i,r=this,s=(t.offsetLeft,t.offsetTop,{width:1,height:1}),n={x:0,y:0,w:s.width,h:s.height};Bs.markuplist.length,this.name="clipboardimage",this.anglelengthsupport=!1,this.started=!1,this.clipboardimage=void 0,null!=e.p1?this.subtype=e.p1:this.subtype=1,this.setimage=function(e){var t=new Image;(i=new Fo(11,r.subtype,0)).scaling=Ln();var a=jn();i.xoffset=a.x,i.yoffset=a.y,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0),i.markupimageblob(e,t).then((function(e){s={width:e.naturalWidth,height:e.naturalHeight},n={x:0,y:0,w:s.width,h:s.height}}))},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i)if(i.imageloaded){var r=td(t,e),o=An(n={x:r.x,y:r.y,w:s.width,h:s.height});e.target.style.cursor=o?"copy":"not-allowed",a.clearRect(0,0,t.width,t.height),a.beginPath(),a.rect(n.x,n.y,n.w,n.h),a.stroke()}else e.target.style.cursor="default"},this.mousedown=function(e){if(e.preventDefault(),i&&i.imageloaded){var r=td(t,e),o=An(n);o&&(i.x=r.x,i.y=r.y,i.w=s.width,i.h=s.height,a.clearRect(0,0,t.width,t.height),Cr||(gr=!0,Dr=Bs.markuplist.length),i.savemetolistDraw()),Hc(),i=null,!Cr&&o&&null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}}},_s.symbol=function(e){var i,r=this;t.offsetLeft,t.offsetTop,Bs.markuplist.length,this.name="symbol",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,null!=e.p1?this.subtype=e.p1:this.subtype=1,_u(Yu("symbol")),this.dragover=function(e){e.preventDefault()},this.drop=function(e){e.preventDefault();var s=td(t,e),n=JSON.parse(e.dataTransfer.getData("Text"));(i=new Fo(11,r.subtype,0)).scaling=Ln();var o=jn();i.xoffset=o.x,i.yoffset=o.y,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0);var l=Bn(s);if(l=An({x:s.x-n.width/2,y:s.y-n.height/2,w:n.width,h:n.height})){i.x=s.x-n.width/2,i.y=s.y-n.height/2,i.w=n.width,i.h=n.height,n.svgContent&&(i.svgContent=n.svgContent);var c=new Image;c.src=n.src,i.image=c,i.imageloaded=!0,a.clearRect(0,0,t.width,t.height),Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw()}if(l||null!=Ee&&Ee.markupSaved(),Hc(),i=null,Pr&&l){if(null!=zt){var h={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],h)}}else!Cr&&l&&null!=zt&&(h={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],h))},this.mousedown=function(e){}},_s.rectText=function(){var e=this;this.x=0,this.y=0,this.w=0,this.h=0;var i=0,r=0,s=0,o=0;this.name="rectText",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var l="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=l,a.fillStyle=l,_u(Yu("rectText")),this.scrollhandling=function(a){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(a<0?Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(a=0),Bs.getCurrentpage().pan_update(0,-a)):(e.belowlimitExtent(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1,e.curmousepos),e.started&&e.setdimoffset(!1)):Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(a=0),Bs.getCurrentpage().pan_update(0,-a)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,e.curmousepos),e.started&&e.setdimoffset(!1)))},this.belowlimitExtent=function(t){var a=!0,i=Bs.getCurrentpage().getpagedim(),r=Na-60,s=Aa-60;i.w/t<r&&i.h/t<s&&(a=!1);var n=Bs.getCurrentpage().ZoomOutTest(t,!1,e.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(a=!1):n.w<=l&&(a=!1),Ci||(a=!0),a},this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(a){a.preventDefault(),a.stopPropagation();var i=td(t,a);if(!Bn(i))return e.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));2!=a.button&&(e.started=!0,e.x0=i.x,e.y0=i.y)},this.mousedown=function(a){a.preventDefault(),a.stopPropagation();var i=td(t,a);if(!Bn(i))return e.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));2!=a.button&&(e.started=!0,e.x0=i.x,e.y0=i.y)},this.touchstart=function(a){a.preventDefault(),e.started=!0;var i=ed(t,a,0);if(!Bn(i))return e.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));e.x0=i.x,e.y0=i.y},this.MSPointerMove=function(n){if(n.preventDefault(),n.stopPropagation(),e.started){var c=td(t,n);Bn(c)?(i=Math.min(c.x,e.x0),r=Math.min(c.y,e.y0),s=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),r=Math.min(r,e.y0),s=Math.abs(i-e.x0),o=Math.abs(r-e.y0)),s&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(i,r,s,o))}},this.mousemove=function(n){if(n.preventDefault(),n.stopPropagation(),e.started){var c=td(t,n);Bn(c)?(i=Math.min(c.x,e.x0),r=Math.min(c.y,e.y0),s=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),r=Math.min(r,e.y0),s=Math.abs(i-e.x0),o=Math.abs(r-e.y0)),s&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(i,r,s,o))}},this.touchmove=function(n){if(n.preventDefault(),e.started){var c=ed(t,n,0);Bn(c)?(i=Math.min(c.x,e.x0),r=Math.min(c.y,e.y0),s=Math.abs(c.x-e.x0),o=Math.abs(c.y-e.y0)):(i=Math.min(i,e.x0),r=Math.min(r,e.y0),s=Math.abs(i-e.x0),o=Math.abs(r-e.y0)),s&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(i,r,s,o))}},this.MSPointerUp=function(n){if(n.preventDefault(),2!=n.button&&e.started){if(e.started=!1,!s||!o)return;ju(i,r,s,o,null),e.x=i,e.y=r,e.w=s,e.h=o,a.clearRect(0,0,t.width,t.height)}},this.mouseup=function(l){if(l.preventDefault(),2!=l.button&&e.started){if(e.started=!1,!s||!o)return void(Cr&&function(){if(-1!=Bs.selectedmarkup.id&&null!=Bs.markuplist[Bs.selectedmarkup.id]&&9==Bs.markuplist[Bs.selectedmarkup.id].type&&null!=Bt&&Bs.selectedmarkup.edit){Bt.operation.edit=!1,Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.save=!0,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var e=t.getBoundingClientRect(),i=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+e.left,r=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+e.top,s=Bs.markuplist[Bs.selectedmarkup.id].wscaled,o=Bs.markuplist[Bs.selectedmarkup.id].hscaled,l=Na/2,c=Aa/2,h=i+.5*s,u=r+.5*o,d=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var p=Bs.markuplist[Bs.selectedmarkup.id].getRotatedMarkup(l,c,h,u,d);h=p.x,u=p.y}h+=e.left,u+=e.top;var g=new kn(i,r,s,o);g.rotation=Bs.getCurrentpage().drotation;var m=ll();g.x=(g.x-e.left)/m+e.left,g.y=(g.y-e.top)/m+e.top,g.w=g.w/m,g.h=g.h/m,Bt.setTextInput(g),Bs.selectedmarkup.edit=!1}-1!=Bs.selectedmarkup.id&&null!=Bs.markuplist[Bs.selectedmarkup.id]&&(Bs.markuplist[Bs.selectedmarkup.id].setselectedit(!1),Bs.markuplist[Bs.selectedmarkup.id].setselect(!1)),al(n),il(a)}());ju(i,r,s,o,null),e.w=0,e.h=0,s=0,o=0,a.clearRect(0,0,t.width,t.height)}},this.touchcancel=function(n){if(n.preventDefault(),e.started){if(e.started=!1,!s||!o)return;ju(i,r,s,o,null),e.x=i,e.y=r,e.w=s,e.h=o,a.clearRect(0,0,t.width,t.height)}},this.touchend=function(n){if(n.preventDefault(),e.started){if(e.started=!1,!s||!o)return;ju(i,r,s,o,null),e.x=i,e.y=r,e.w=s,e.h=o,a.clearRect(0,0,t.width,t.height)}}},_s.rectStamp=function(e){var i=this,r=0,s=0,n=0,o=0;this.name="rectStamp",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1;var l="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=l,a.fillStyle=l;var c=e.p1;_u(Yu("rectStamp")),this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(!Bn(a))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(!Bn(a))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.touchstart=function(e){e.preventDefault(),i.started=!0;var a=ed(t,e,0);if(!Bn(a))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));i.x0=a.x,i.y0=a.y},this.MSPointerMove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var c=td(t,e);Bn(c)?(r=Math.min(c.x,i.x0),s=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(r=Math.min(r,i.x0),s=Math.min(s,i.y0),n=Math.abs(r-i.x0),o=Math.abs(s-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(r,s,n,o))}},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var c=td(t,e);Bn(c)?(r=Math.min(c.x,i.x0),s=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(r=Math.min(r,i.x0),s=Math.min(s,i.y0),n=Math.abs(r-i.x0),o=Math.abs(s-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(r,s,n,o))}},this.touchmove=function(e){if(e.preventDefault(),i.started){var c=ed(t,e,0);Bn(c)?(r=Math.min(c.x,i.x0),s=Math.min(c.y,i.y0),n=Math.abs(c.x-i.x0),o=Math.abs(c.y-i.y0)):(r=Math.min(r,i.x0),s=Math.min(s,i.y0),n=Math.abs(r-i.x0),o=Math.abs(s-i.y0)),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=l,a.fillRect(r,s,n,o))}},this.MSPointerUp=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;Ou(r,s,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.mouseup=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;Ou(r,s,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.touchcancel=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;Ou(r,s,n,o,c),a.clearRect(0,0,t.width,t.height)}},this.touchend=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;Ou(r,s,n,o,c),a.clearRect(0,0,t.width,t.height)}}},_s.zoomwindow=function(e){var i=this,r=0,s=0,n=0,o=0,l=e.p1,u=e.p2;this.name="zoomwindow",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.curcliprect={x:0,y:0,w:0,h:0};var d="rgba(175, 175, 175, 0.3)";a.lineWidth=2,a.strokeStyle=d,a.fillStyle=d,_u(Yu("zoomwindow")),this.zoomUpdate=function(e,r,s,n){if(l){var o=Bs.getCurrentpage().screentoDocRect({x:e,y:r,w:s,h:n});null!=va&&va.zoomUpdate(o)}else if(u){var d=Bs.getCurrentpage().getClipRect({x:e,y:r,w:s,h:n});i.curcliprect.x=e,i.curcliprect.y=r,i.curcliprect.w=s,i.curcliprect.h=n,null!=d&&(c.width=d.width,c.height=d.height,h.putImageData(d,0,0),Bs.getCurrentpage().drawmarkupcliprect({x:e,y:r,w:s,h:n},h),fu(c))}else $a?Us.zoom_update(e,r,s,n):Bs.getCurrentpage().zoom_update(e,r,s,n);a.clearRect(0,0,t.width,t.height)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);2!=e.button&&(i.started=!0,i.x0=a.x,i.y0=a.y)},this.touchstart=function(e){e.preventDefault(),i.started=!0;var a=ed(t,e,0);i.x0=a.x,i.y0=a.y},this.MSPointerMove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var l=td(t,e);r=Math.min(l.x,i.x0),s=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=d,a.fillRect(r,s,n,o))}},this.mousemove=function(e){if(e.preventDefault(),e.stopPropagation(),i.started){var l=td(t,e);r=Math.min(l.x,i.x0),s=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=d,a.fillRect(r,s,n,o))}},this.touchmove=function(e){if(e.preventDefault(),i.started){var l=ed(t,e,0);r=Math.min(l.x,i.x0),s=Math.min(l.y,i.y0),n=Math.abs(l.x-i.x0),o=Math.abs(l.y-i.y0),n&&o&&(a.clearRect(0,0,t.width,t.height),a.lineWidth=1,a.strokeStyle=d,a.fillRect(r,s,n,o))}},this.MSPointerUp=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(r,s,n,o)}},this.mouseup=function(e){if(e.preventDefault(),2!=e.button&&i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(r,s,n,o)}},this.mouseout=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(r,s,n,o)}},this.touchcancel=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(r,s,n,o)}},this.touchend=function(e){if(e.preventDefault(),i.started){if(i.started=!1,!n||!o)return;i.zoomUpdate(r,s,n,o)}}},_s.pickPolygon=function(e){var i=this,r=0,s=0;this.started=!1;var o=e.p1;this.multiselect=o,this.createSpaceMarkup=e.p2,this.allowVectorSelect=e.p3,this.useVectorInfoSelect=e.p4,this.useBlockSelect=e.p5,this.name="PickPolygon",this.anglelengthsupport=!1,this.refreshSupport=!1,this.curmousepos={x:0,y:0,xus:0,yus:0},this.curkey=null,_u(Yu("PickPolygon")),this.findvectorentityhover=function(e){Ii&&Bs.getCurrentpage().getvectorentityhover(e.x,e.y)},this.findvectorentity=function(e){Bs.getCurrentpage().getvectorentity(e.x,e.y)},this.findBlockhover=function(e){Bs.getCurrentpage().getblockinserthover(e.x,e.y)},this.findBlock=function(e){Bs.getCurrentpage().getblockinsert(e.x,e.y)},this.findspacehover=function(e){i.useVectorInfoSelect?i.findvectorentityhover(e):i.useBlockSelect?i.findBlockhover(e):i.allowVectorSelect&&Ii&&Bs.getCurrentpage().getpolygonhover(e.x,e.y)},this.findspace=function(e){if(i.useVectorInfoSelect)i.findvectorentity(e);else{if(!i.useBlockSelect){var t=function(e,t,i){var r=0,s=!1,o=!1,l=-1,c=[],h={isempty:!0};for(r=Bs.markupdraworder.length;r>0;r--)null!=Bs.markuplist[r-1]&&8==Bs.markuplist[r-1].type&&1==Bs.markuplist[r-1].subtype&&(Bs.markuplist[r-1].iswithin(e,t)&&Bs.markuplist[r-1].display&&Bs.markuplist[r-1].pagenumber==Bs.getcurPage()?(o=!0,l=Bs.markuplist[r-1].markupnumber,Bs.markuplist[r-1].spaceselected=!Bs.markuplist[r-1].spaceselected,s=Bs.markuplist[r-1].spaceselected,Bs.markuplist[r-1].linewidth=s?2:1,h={id:l,attr:Bs.markuplist[r-1].GetAttributes(),isempty:!1}):i||(Bs.markuplist[r-1].spaceselected=!1,Bs.markuplist[r-1].linewidth=1));for(r=Bs.markuplist.length;r>0;r--)null!=Bs.markuplist[r-1]&&8==Bs.markuplist[r-1].type&&1==Bs.markuplist[r-1].subtype&&(i||h.id==Bs.markuplist[r-1].markupnumber||(Bs.markuplist[r-1].spaceselected=!1),i&&Bs.markuplist[r-1].spaceselected&&(s=Bs.markuplist[r-1].spaceselected,h={id:l=Bs.markuplist[r-1].markupnumber,attr:Bs.markuplist[r-1].GetAttributes(),isempty:!1},c.push(h)));return i?null!=Dt&&Dt.set2DBlockID(c):null!=Dt&&Dt.set2DBlockID(h),Er||(al(n),il(a)),{found:s,within:o}}(e.x,e.y,i.multiselect);if(t.found?(i.multiselect||Bs.getCurrentpage().unSelectAllBlocks(!1),wu(!0)):wu(!1),!t.within&&i.allowVectorSelect)var r=Bs.getCurrentpage().getpolygon(e.x,e.y,i.multiselect);return r||t}i.findBlock(e)}},this.createSpace=function(e){var t=Bs.getCurrentpage().getpolygonPath(e.x,e.y);if(null!=t&&t.points.length>0&&Bs.getCurrentpage().VectorPageObj){var a=Bs.getCurrentpage().dscalevector,i=Bs.getCurrentpage().dxvector,r=Bs.getCurrentpage().dyvector,s=Bs.getCurrentpage().VectorPageObj.x;Bs.getCurrentpage().VectorPageObj.y,function(e,t,a,i,r,s,o){var l=(e.points[0]-r)*t,c=(o-e.points[1])*t;l+=a,c+=i;var h=new Fo(8,1,0);h.linewidth=1,h.AddAttribute("Rx_Area","0"),h.AddAttribute("SpaceID","0"),h.scaling=t,h.xoffset=a,h.yoffset=i,h.addpoint(l,c);for(var u=0,d=0,p=2;p<e.points.length;p+=2)u=(e.points[p]-r)*t,d=(o-e.points[p+1])*t,u+=a,d+=i,h.addpoint(u,d);var g=h.PolygonArea(),m=[];if(e.gotsubpath)for(var f=0;f<e.subpaths.length;f++){for(p=0;p<e.subpaths[f].points.length;p+=2)u=(e.subpaths[f].points[p]-r)*t,d=(o-e.subpaths[f].points[p+1])*t,u+=a,d+=i,m.push({x:u,y:d});var y=qn(m);y>g&&(h.points=m.slice(),m=[],g=y)}h.findrectangle(),gr=!0,Dr=Bs.markuplist.length,h.savemetolistLoad(Bs),Hc(),al(n),null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}(t,a,i,r,s,0,Bs.getCurrentpage().VectorPageObj.h)}},this.set3DModelPos=function(e){var t=Bs.getCurrentpage();if(t.bis3Dnavigator&&null!=Qe){var a={docindex:Bs.fileindex,pageindex:t.pagenumber,cameraPos:e};Qe.navClick(a)}},this.panlimit=function(){var e=Bs.getCurrentpage().getpagedim();e.w/e.h<Na/Aa?(e.y+e.h<Aa-Br&&(e.h,yu(e.x,e.y)),e.y>Br&&yu(e.x,Br)):(e.x+e.w<Na-Br&&yu(-15,e.y),e.x>Br&&yu(Br,e.y))},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),r=Na-60,s=Aa-60;a.w/e<r&&a.h/e<s&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,i.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.scrollhandling=function(e){if(Ka&&!Bs.getCurrentpage().usevector3Dxml)if(e<0)if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked){if(Bs.currentpage==Bs.pages.length-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e),Bs.getCurrentpage().pagenumber==Bs.pages.length-1&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().endy<t.height;)Bs.getCurrentpage().pan_update(0,-1)}else vr?i.scrollkeyOn&&Pi&&i.belowlimitExtent(1.1)&&(Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Di&&i.panlimit()):
//!DocObj.getCurrentpage().usedincomposite ||
Pi&&i.belowlimitExtent(1.1)&&(Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Di&&i.panlimit());else if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked){if(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e),0==Bs.getCurrentpage().pagenumber&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().starty>0;)Bs.getCurrentpage().pan_update(0,1)}else vr?i.scrollkeyOn&&Pi&&Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos):
//!DocObj.getCurrentpage().usedincomposite ||
Pi&&Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos)},this.mousewheel=function(e){i.wheel(e)},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=Ga?-e.deltaY:50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(null!=Ca){var n={mousepos:a,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,r=i.x0,s=i.y0},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(null!=Ca){var n={mousepos:a,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,r=i.x0,s=i.y0},this.touchstart=function(e){e.preventDefault();var a=ed(t,e,0);if(null!=Ca){var n={mousepos:a,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(n)}i.createSpaceMarkup?i.createSpace(a):i.findspace(a),i.started=!i.started,i.x0=a.x,i.y0=a.y,r=i.x0,s=i.y0,i.x0,i.y0},this.MSPointerMove=function(e){var a=td(t,e);if(i.findspacehover(a),i.curmousepos=a,i.started){var n=r-a.x,o=s-a.y;Bs.getCurrentpage().pan_update(n,o),r=a.x,s=a.y}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(i.findspacehover(a),i.curmousepos=a,i.started){var n=r-a.x,o=s-a.y;Bs.getCurrentpage().pan_update(n,o),r=a.x,s=a.y}},this.touchmove=function(e){e.preventDefault();var a=ed(t,e,0);if(i.curmousepos=a,i.started){var n=r-a.x,o=s-a.y;Bs.getCurrentpage().pan_update(n,o),r=a.x,s=a.y}},this.MSPointerUp=function(e){i.started&&(i.MSPointerMove(e),i.started=!1)},this.mouseup=function(e){i.started&&(i.mousemove(e),i.started=!1)},this.touchend=function(e){e.preventDefault(),i.started&&(i.touchmove(e),i.started=!1)},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.touchmove(e),i.started=!1)},this.keyup=function(e){i.curkey=null},this.keydown=function(e){if(i.curkey=e.keyCode,null!=Ca){var t={mousepos:null,mousebutton:null,dblclick:!1,key:i.curkey,keylocation:e.location,tool:i.name};Ca.setInput(t)}}},_s.pan=function(){var e=this,a=0,i=0;this.started=!1,this.name="pan",this.anglelengthsupport=!1,this.refreshSupport=!1,_u(Yu("pan")),this.pointermove=function(t){e.MSPointerMove(t)},this.pointerdown=function(t){e.MSPointerDown(t)},this.pointerup=function(t){e.MSPointerUp(t)},this.MSPointerDown=function(r){r.preventDefault(),r.stopPropagation();var s=td(t,r);e.started=!0,e.x0=s.x,e.y0=s.y,a=e.x0,i=e.y0},this.mousedown=function(r){r.preventDefault(),r.stopPropagation(),e.started=!0;var s=td(t,r);e.x0=s.x,e.y0=s.y,a=e.x0,i=e.y0},this.touchstart=function(r){r.preventDefault(),e.started=!0;var s=ed(t,r,0);e.x0=s.x,e.y0=s.y,a=e.x0,i=e.y0,e.x0,e.y0},this.MSPointerMove=function(r){if(e.started){var s=td(t,r),n=a-s.x,o=i-s.y;Bs.getCurrentpage().pan_update(n,o),a=s.x,i=s.y}},this.mousemove=function(r){if(e.started){var s=td(t,r),n=a-s.x,o=i-s.y;Bs.getCurrentpage().pan_update(n,o),a=s.x,i=s.y}},this.touchmove=function(r){if(r.preventDefault(),e.started){var s=ed(t,r,0),n=a-s.x,o=i-s.y;Bs.getCurrentpage().pan_update(n,o),a=s.x,i=s.y}},this.MSPointerUp=function(t){e.started&&(e.mousemove(t),e.started=!1)},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1)},this.touchcancel=function(t){t.preventDefault(),e.started&&(e.touchmove(t),e.started=!1)},this.touchend=function(t){t.preventDefault(),e.started&&(e.touchmove(t),e.started=!1)}},_s.markupedit=function(e){var i=this,r=0,s=0,o=0,l=0,c=0,h=0,u=0,d=0,p=0,g=0,m=0,f=0,y=0,v=0,b=0,x=0,w=0,k=0,D=0,C=0,P=0,S=0,R=0,M=0,T=0,E=0,F=0,I=-1,j={},O=-1,L=[],V=!1,N=!1,A=0,B=0,U=0,G=0,H=0,z=e.p1;this.LastTouchdata=-1,this.started=!1,this.name="markupedit",this.anglelengthsupport=!1,this.refreshSupport=!1,this.savestate=!0,this.changedstate=!1,this.scrollkeyOn=!1,this.curkey=null,this.curmousepos={x:0,y:0,xus:0,yus:0};var W,_=!1;this.bdeletepoint=!1,this.binsertpoint=!1,this.bmovemousebutton=!1,_u(Yu("markupedit")),this.findspacehover=function(e){Ii&&Bs.getCurrentpage().getpolygonhover(e.x,e.y)},this.enablePointDelete=function(){i.bdeletepoint=!0},this.enablePointInsert=function(){i.binsertpoint=!0},this.disablePointInsert=function(){i.binsertpoint=!1},this.enableMoveLabel=function(e){i.bmovelabel=e},this.scrollhandling=function(e){if(!jh()&&Ka&&!Bs.getCurrentpage().usevector3Dxml)if(vd(),e<0)if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked){if(Bs.currentpage==Bs.pages.length-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e),Bs.getCurrentpage().pagenumber==Bs.pages.length-1&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().endy<t.height;)Bs.getCurrentpage().pan_update(0,-1)}else vr?i.scrollkeyOn&&Pi&&i.belowlimitExtent(1.1)&&(Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Di&&i.panlimit()):
//!DocObj.getCurrentpage().usedincomposite ||
Pi&&i.belowlimitExtent(1.1)&&(Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),Di&&i.panlimit());else if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked){if(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e),0==Bs.getCurrentpage().pagenumber&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().starty>0;)Bs.getCurrentpage().pan_update(0,1)}else vr?i.scrollkeyOn&&Pi&&Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos):
//!DocObj.getCurrentpage().usedincomposite ||
Pi&&Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos)},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),r=Ba-60,s=Ua-60;a.w/e<r&&a.h/e<s&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,i.curmousepos),o=Ua-30,l=Ba-30;return n.y,n.h,n.y,n.w/n.h<Ba/Ua?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.set3DModelPos=function(e){var t=Bs.getCurrentpage();if(t.bis3Dnavigator&&null!=Qe){var a={docindex:Bs.fileindex,pageindex:t.pagenumber,cameraPos:e};Qe.navClick(a)}},this.panlimit=function(){var e=Bs.getCurrentpage().getpagedim();if(e.w/e.h<Na/Aa){if(e.y+e.h<Aa-Br){var t=Aa-Br-e.h;yu(e.x,t)}e.y>Br&&yu(e.x,Br)}else e.x+e.w<Na-Br&&yu(-15,e.y),e.x>Br&&yu(Br,e.y)},this.limitPan=function(e,t){var a=Bs.getCurrentpage().getpagedim(),i={up:!1,down:!1,left:!1,right:!1};i.down=t<0,i.up=t>0,i.left=e>0,i.right=e<0;var r=a.y-t,s=a.x-e,n=r+a.h,o=s+a.w,l={x:!0,y:!0,diffx:e,diffy:t};return Di?(a.h<=Aa-1?l.y=!1:(a.y>15&&i.down&&(l.y=!1),a.y+a.h<Aa-15&&i.up&&(l.y=!1)),a.w<=Na-1?l.x=!1:(a.x>15&&i.right&&(l.x=!1),a.x+a.w<Na-15&&i.left&&(l.x=!1)),i.up&&l.y&&n<Aa-15&&t>0&&(l.diffy=t-(Aa-15-n)),i.down&&l.y&&r>15&&t<0&&(l.diffy=t+(r-15)),i.left&&l.x&&o<Na-15&&e>0&&(l.diffx=e-(Na-15-o)),i.right&&l.x&&s>15&&e<0&&(l.diffx=e+(s-15)),l):l},this.limitExtent=function(e){if(Bs.getCurrentpage().usepdfjs){var t=Bs.getCurrentpage().getpagedim();t.w*e<Na&&t.h*e<Aa&&Bs.getCurrentpage().zoomall()}else Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().initialscale>Bs.getCurrentpage().dscalevector&&Bs.getCurrentpage().zoomall():Bs.getCurrentpage().initialscale>Bs.getCurrentpage().dscale/Bs.getCurrentpage().bitmapratio&&Bs.getCurrentpage().zoomall()},this.DOMMouseScroll=function(e){},this.mousewheel=function(e){i.wheel(e)},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=Ga?-e.deltaY:50*-e.deltaY),i.scrollhandling(t)},this.mousedownhandling=function(e,t){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(e.target.style.cursor="move",N=!0,i.started=!0,i.x0=t.x,i.y0=t.y,c=i.x0,h=i.y0,i.set3DModelPos(t))},this.mouseuphandler=function(e){if(Ka&&(e.target.style.cursor="default",(i.started||N)&&(i.started=!1,N=!1,0==Bs.Type&&!$a&&!Bs.pagelocked))){if(0==Bs.currentpage&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().starty>0;)Bs.getCurrentpage().pan_update(0,1);if(Bs.currentpage==Bs.NumPages-1&&0==Bs.getCurrentpage().drotation)for(;Bs.getCurrentpage().endy<t.height;)Bs.getCurrentpage().pan_update(0,-1)}},this.movehandler=function(e,o){if(Ka&&null!=Bs&&null!=Bs)if(i.started||N){var l=c-e.x,u=h-e.y;if(0!=Bs.Type||$a||Bs.pagelocked){var d=i.limitPan(l,u),p=d.x?d.diffx:0,g=d.y?d.diffy:0;if(null==Bs.getCurrentpage())return;Bs.getCurrentpage().pan_update(p,g)}else{if(null==Bs.getCurrentpage())return;Bs.getCurrentpage().startx<0||Bs.getCurrentpage().endx>t.width?Bs.getCurrentpage().pan_update(l,u):0==Bs.getCurrentpage().drotation?Bs.getCurrentpage().pan_update(0,u):Bs.getCurrentpage().pan_update(l,u)}c=e.x,h=e.y}else{n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),I=jo(e.x,e.y);var m=Bs.getmarkupbynumber(I);-1!=I&&Bs.markuplist[m].pagenumber==Bs.getcurPage()&&Bs.markuplist[m].display&&Bs.Drawmarkup?-1!=I&&Bs.markuplist[m].bhaveLink&&(Bs.bMarkupLocked||Bs.markuplist[m].locked)?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),Bs.markuplist[m].displayurl(a,e.x,e.y)):-1!=I&&10==Bs.markuplist[m].type?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),Bs.markuplist[m].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),Bs.markuplist[m].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),null!=Ie&&Ie.setMarkupHover(null,r,s))}},this.panhandle=function(e,a){Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().initialscale<Bs.getCurrentpage().dscalevector&&e<50&&a<50&&Bs.getCurrentpage().pan_update(e,a):(0==Bs.Type&&(Bs.getCurrentpage().startx<0||Bs.getCurrentpage().endx>t.width?e<50&&a<50&&Bs.getCurrentpage().pan_update(e,a):$a?Bs.getCurrentpage().pan_update(e,a):Bs.getCurrentpage().pan_update(0,a)),Bs.getCurrentpage().initialscale<Bs.getCurrentpage().dscale/Bs.getCurrentpage().bitmapratio&&(0==Bs.Type?$a?Bs.getCurrentpage().pan_update(e,a):Bs.getCurrentpage().pan_update(0,a):e<50&&a<50&&Bs.getCurrentpage().pan_update(e,a)))},this.labelhandler=function(e,o){if(Ka&&null!=Bs&&null!=Bs&&!i.started){var l=Bs.getCurrentpage().gethyperlinkhover(e.x,e.y);I=jo(e.x,e.y);var c=Bs.getmarkupbynumber(I);-1!=I&&Bs.markuplist[c].pagenumber==Bs.getcurPage()&&Bs.markuplist[c].display&&Bs.Drawmarkup?(-1!=I&&Bs.markuplist[c].bhaveLink&&(Bs.bMarkupLocked||Bs.markuplist[c].locked)?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),al(n),il(a),Bs.markuplist[c].displayurl(a,e.x,e.y)):-1!=I&&10==Bs.markuplist[c].type?(o.target.style.cursor="pointer",a.clearRect(0,0,t.width,t.height),al(n),il(a),Bs.markuplist[c].displaylabel(a,e.x,e.y)):(o.target.style.cursor="default",a.clearRect(0,0,t.width,t.height),al(n),il(a),Bs.markuplist[c].displaylabel(a,e.x,e.y)),Bs.draw3DNav()):(l?o.target.style.cursor="pointer":(o.target.style.cursor="default",null!=Ae&&Ae.setMarkupHover(null,r,s)),a.clearRect(0,0,t.width,t.height),null!=Ie&&Ie.setMarkupHover(null,r,s),al(n),il(a),Bs.draw3DNav())}},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws),e.preventDefault(),e.stopPropagation(),i.started=!0;var r=td(t,e),s=Bn(r);if(i.x0=r.x,i.y0=r.y,c=i.x0,h=i.y0,null!=Ca){var o={mousepos:r,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(o)}if(Bs.bMarkupLocked){if(j=_o(i.x0,i.y0,z),I=j.id,j.blink)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}else{if(i.binsertpoint&&s&&Go(r),j=_o(i.x0,i.y0,z),I=j.id,j.locked&&j.blink)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}switch(L.push(new $s(e.pointerId,r.x,r.y)),L.length){case 1:if(-1==I)al(n),il(a),i.mousedownhandling(e,r),Bs.selectedmarkup.selected=!1,Bs.selectedmarkup.edit=!1;else{if(i.savestate&&Ro(I,1),i.savestate=!1,al(n),il(a),Bs&&(Bs.bMarkupchanged=!0),10==Bs.markuplist[O].type&&(Bs.selectedmarkup.id=O,Bs.selectedmarkup.selected=!0),9==Bs.markuplist[O].type){if(null!=Bt&&Bs.selectedmarkup.edit){Bt.operation.edit=!1,Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.save=!0,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var l=t.getBoundingClientRect(),u=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+l.left,d=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+l.top,p=Bs.markuplist[Bs.selectedmarkup.id].wscaled,g=Bs.markuplist[Bs.selectedmarkup.id].hscaled,D=Na/2,C=Aa/2,S=u+.5*p,M=d+.5*g,T=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var N=Bs.markuplist[Bs.selectedmarkup.id].getRotatedMarkup(D,C,S,M,T);S=N.x,M=N.y}S+=l.left,M+=l.top;var A=new kn(u,d,p,g);A.rotation=Bs.getCurrentpage().drotation;var B=ll();A.x=(A.x-l.left)/B+l.left,A.y=(A.y-l.top)/B+l.top,A.w=A.w/B,A.h=A.h/B,Bt.setTextInput(A),Bt.operation.edit=!1,Bs.selectedmarkup.edit=!1}Bs.selectedmarkup.id=O}4==Bs.markuplist[O].editaction&&i.bdeletepoint&&(Bs.markuplist[O].deletepoint(Bs.markuplist[O].selectedpoint),al(n),il(a),i.bdeletepoint=!1),7==Bs.markuplist[O].editaction&&i.binsertpoint&&(Bs.markuplist[O].locked||(Bs.markuplist[O].insertpoint(),al(n),il(a),i.binsertpoint=!1))}1!=e.button||i.started||(i.started=!0);break;case 2:V=!0,m=L[0].x,f=L[0].y,y=L[1].x,v=L[1].y;var U=Math.min(m,y),G=Math.min(f,y);b=Math.abs(y-m),x=Math.abs(v-f),w=Math.pow(b,2),k=Math.pow(x,2),P=Math.sqrt(w+k),R=P,E=U+b/2,F=G+x/2,Ln(),Ln()}}},this.mousedown=function(e){if(e.preventDefault(),e.stopPropagation(),!jh()){ws&&(Bs.bMarkupLocked=ws);var r=rl();if(!Bs.getCurrentpage().usevector3Dxml||!r){i.started=!0;var s=td(t,e),o=Bn(s);if(i.x0=s.x,i.y0=s.y,c=i.x0,h=i.y0,null!=Ca){var l={mousepos:s,mousebutton:e.button,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(l)}if(Bs.getCurrentpage().gethyperlink(i.x0,i.y0),Bs.bMarkupLocked){if(j=_o(i.x0,i.y0,z),I=j.id,j.blink)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}else{if(i.binsertpoint&&o&&Go(s),j=_o(i.x0,i.y0,z),I=j.id,j.locked&&j.blink)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}if(-1==I)i.started=!1,null!=zt&&(zt.showContext=!1),Bs.selectedmarkup.edit=!1,Bs.selectedmarkup.selected=!1,al(n),il(a),i.mousedownhandling(e,s);else{if(i.savestate&&($i||Ro(I,1)),$i&&function(e){var t=0,a=ai+=1;for(t=0;t<Bs.markuplist.length;t++)if(null!=Bs.markuplist[t]){var i=Bs.markuplist[t].selectedit&&9!=Bs.markuplist[t].type;if(Bs.markuplist[t].selected||i){if(Bs.markuplist[t].bisTextArrow)continue;Bs.markuplist[t].setmultiValues(a),Bs.markuplist[t].savemarkupstateChanged(Bs,e)}}}(1),i.savestate=!1,al(n),il(a),Bs&&(Bs.bMarkupchanged=!0),-1!=Bs.selectedmarkup.id&&null!=Bs.markuplist[Bs.selectedmarkup.id]&&9==Bs.markuplist[Bs.selectedmarkup.id].type){if(null!=Bt&&Bs.selectedmarkup.edit){Bt.operation.edit=!1,Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.save=!0,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var u=t.getBoundingClientRect(),d=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+u.left,p=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+u.top,g=Bs.markuplist[Bs.selectedmarkup.id].wscaled,m=Bs.markuplist[Bs.selectedmarkup.id].hscaled,f=Na/2,y=Aa/2,v=d+.5*g,b=p+.5*m,x=Bs.getCurrentpage().drotation*(Math.PI/180);if(0!=Bs.getCurrentpage().drotation){var w=Bs.markuplist[Bs.selectedmarkup.id].getRotatedMarkup(f,y,v,b,x);v=w.x,b=w.y}v+=u.left,b+=u.top;var k=new kn(d,p,g,m);k.rotation=Bs.getCurrentpage().drotation;var D=ll();k.x=(k.x-u.left)/D+u.left,k.y=(k.y-u.top)/D+u.top,k.w=k.w/D,k.h=k.h/D,Bt.setTextInput(k),Bs.selectedmarkup.edit=!1}Bs.selectedmarkup.id=O}4==Bs.markuplist[O].editaction&&i.bdeletepoint&&(Bs.markuplist[O].deletepoint(Bs.markuplist[O].selectedpoint),al(n),il(a),i.bdeletepoint=!1),7==Bs.markuplist[O].editaction&&i.binsertpoint&&(Bs.markuplist[O].locked||(Bs.markuplist[O].insertpoint(),al(n),il(a),i.binsertpoint=!1)),10==Bs.markuplist[O].type&&(Bs.selectedmarkup.id=O)}1!=e.button||i.started||(i.started=!0),2==e.button&&i.started&&(i.bmovemousebutton=!0)}}},this.dblclick=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws),i.started=!0;var r=td(t,e);if(i.x0=r.x,i.y0=r.y,null!=Ca){var s={mousepos:r,mousebutton:e.button,dblclick:!0,key:i.curkey,tool:i.name};Ca.setInput(s)}var o=rl();Bs.getCurrentpage().usevector3Dxml&&o||(Bs.bMarkupLocked?I=-1:(I=Io(i.x0,i.y0),O=Bs.getmarkupbynumber(I)),-1==I||Bs.markuplist[O].locked?(i.started=!1,i.savestate=!0):(Ro(I,1),Bs&&(Bs.bMarkupchanged=!0),9==Bs.markuplist[O].type&&(Bs.markuplist[O].text,Bs.selectedmarkup.id=O,Bs.selectedmarkup.edit=!0,null!=At&&At.setTextdiag(Bs.markuplist[Bs.selectedmarkup.id].text),Bs.markuplist[Bs.selectedmarkup.id].editTextmarkupRect(),il(a),al(n),i.started=!1),10==Bs.markuplist[O].type&&(Bs.selectedmarkup.id=O)))}},this.doubletap=function(e){if(!jh()){if(ws&&(Bs.bMarkupLocked=ws),null!=Ca){var r={mousepos:e,mousebutton:null,dblclick:!0,key:i.curkey,tool:i.name};Ca.setInput(r)}if(Bs.bMarkupLocked?I=-1:(I=Io(e.x,e.y),O=Bs.getmarkupbynumber(I)),-1!=I||Bs.markuplist[O].locked){if(i.savestate&&(Ro(I,1),Bs&&(Bs.bMarkupchanged=!0)),i.savestate=!1,9==Bs.markuplist[O].type&&(Bs.markuplist[O].text,null!=Bt)){Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.edit=!0,Bt.operation.save=!1,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var s=t.getBoundingClientRect(),n=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+s.left,o=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+s.top,l=Bs.markuplist[Bs.selectedmarkup.id].wscaled,c=Bs.markuplist[Bs.selectedmarkup.id].hscaled,h=new kn(n,o,l,c);h.rotation=Bs.getCurrentpage().drotation;var u=ll();h.x=(h.x-s.left)/u+s.left,h.y=(h.y-s.top)/u+s.top,h.w=h.w/u,h.h=h.h/u,Bt.setTextInput(h),Bs.selectedmarkup.edit=!1}10==Bs.markuplist[O].type&&(Bs.selectedmarkup.id=O)}else i.started=!1,a.clearRect(0,0,t.width,t.height),i.savestate=!0}},this.touchstart=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws),e.preventDefault(),i.started=!0;var o=ed(t,e,0),l=Bn(o),u=o.x,d=o.y;if(null!=Ca){var p={mousepos:o,mousebutton:null,dblclick:!1,key:i.curkey,tool:i.name};Ca.setInput(p)}m=o.x,f=o.y,c=u,h=d,r=u,s=d;var g=(new Date).getTime(),D=g-(-1==i.LastTouchdata?g+1:i.LastTouchdata);switch(i.LastTouchdata=g,e.targetTouches.length){case 1:if(D<500&&D>0)i.doubletap(o);else{if(Bs.bMarkupLocked){if(j=_o(u,d,z),I=j.id,j.blink)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}else{if(i.binsertpoint&&l&&Go(o),j=_o(u,d,z),I=j.id,j.blink&&j.locked)return i.started=!1,void(null!=Xt&&Xt.markupLink(Bs.markuplist[j.index]));O=Bs.getmarkupbynumber(I)}if(-1==I)i.started=!1,al(n),il(a),i.mousedownhandling(e,o),i.savestate=!0;else{if(i.savestate&&(Ro(I,1),Bs&&(Bs.bMarkupchanged=!0)),i.savestate=!1,al(n),il(a),9==Bs.markuplist[O].type){if(null!=Bt&&Bs.selectedmarkup.edit){Bt.operation.edit=!1,Bt.operation.start=!1,Bt.operation.create=!1,Bt.operation.save=!0,Bt.operation.markup=Bs.markuplist[Bs.selectedmarkup.id];var C=t.getBoundingClientRect(),S=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.x+C.left,M=Bs.markuplist[Bs.selectedmarkup.id].rotatedrect.y+C.top,T=Bs.markuplist[Bs.selectedmarkup.id].wscaled,L=Bs.markuplist[Bs.selectedmarkup.id].hscaled,V=new kn(S,M,T,L);V.rotation=Bs.getCurrentpage().drotation;var N=ll();V.x=(V.x-C.left)/N+C.left,V.y=(V.y-C.top)/N+C.top,V.w=V.w/N,V.h=V.h/N,Bt.setTextInput(V)}Bs.selectedmarkup.id=O}4==Bs.markuplist[O].editaction&&i.bdeletepoint&&(Bs.markuplist[O].deletepoint(Bs.markuplist[O].selectedpoint),al(n),il(a),i.bdeletepoint=!1),7==Bs.markuplist[O].editaction&&i.binsertpoint&&(Bs.markuplist[O].locked||(Bs.markuplist[O].insertpoint(),al(n),il(a),i.binsertpoint=!1)),10==Bs.markuplist[O].type&&(Bs.selectedmarkup.id=O)}}break;case 2:var U=ed(t,e,1);y=U.x,v=U.y,b=Math.abs(y-m),x=Math.abs(v-f),A=y-m,B=v-f,G=180*Math.atan2(B,A)/Math.PI,w=Math.pow(b,2),k=Math.pow(x,2),P=Math.sqrt(w+k),R=P,E=m+b/2,F=f+x/2,Ln(),Ln()}}},this.MSPointerMove=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws);var n=!1,m=0,f=td(t,e);for(i.findspacehover(f),i.curmousepos=f;m<L.length;)L[m].pointID==e.pointerId&&(L[m].x=f.x,L[m].y=f.y),m++;switch(L.length){case 0:if(i.labelhandler(f,e),!i.started)return;break;case 1:if(!i.started)return;var y=c-f.x,v=h-f.y;if(1==e.buttons){if(-1==I||Bs.bMarkupLocked||Bs.markuplist[O].locked)i.movehandler(f,e);else{W=Bs.getCurrentpage().getsnap(f),_=!(!W||!W.found||null==W)&&(W.found||null!=W),4==Bs.markuplist[O].editaction&&(_&&(w=0!=Bs.getCurrentpage().drotation?rn(W):W,y=c-w.x,v=h-w.y,n=!0),Bn(f)&&(Bs.markuplist[O].editpoint(y,v,Bs.markuplist[O].selectedpoint),null!=Ta&&8==Bs.markuplist[O].type&&Ta.onDrawEvent(Bs.markuplist[O].dimtext)),il(a),i.changedstate=!0);var b=!i.binsertpoint&&7==Bs.markuplist[O].editaction,x=!i.bmovelabel&&8==Bs.markuplist[O].editaction;if((1==Bs.markuplist[O].editaction||b||x)&&(e.target.style.cursor="move",$i||Bs.getMarkupMultiselected()?Bs.moveselected(y,v):Bs.markuplist[O].move(y,v),il(a),i.changedstate=!0),2==Bs.markuplist[O].editaction){if(_){if(0!=Bs.getCurrentpage().drotation)var w=rn(W);else w=W;y=c-w.x,v=h-w.y,n=!0}e.target.style.cursor="nw-resize",Bs.markuplist[O].scale(y,v,Bs.markuplist[O].scalecorner,a),il(a),i.changedstate=!0}3==Bs.markuplist[O].editaction&&(Bs.markuplist[O].rotate(f.x,f.y,Bs.markuplist[O].scalecorner),il(a),i.changedstate=!0),6==Bs.markuplist[O].editaction&&(e.target.style.cursor="move",Bs.markuplist[O].dimextend(f.x,f.y),il(a),i.changedstate=!0),8==Bs.markuplist[O].editaction&&i.bmovelabel&&!Es&&(e.target.style.cursor="move",Bs.markuplist[O].movelabel(y,v),il(a),i.changedstate=!0)}n&&_?(w=0!=Bs.getCurrentpage().drotation?rn(W):W,c=w.x,h=w.y):(c=f.x,h=f.y)}else 4==e.buttons&&(Bs.getCurrentpage().pan_update(y,v),c=f.x,h=f.y,il(a));break;case 2:if(!V)return;u=L[0].x,p=L[0].y,d=L[1].x,g=L[1].y,r=Math.min(u,d),s=Math.min(p,g),o=Math.abs(d-u),l=Math.abs(g-p),D=Math.pow(o,2),C=Math.pow(l,2);var k=(S=Math.sqrt(D+C))-R,P=S*(1/R);y=E-(M=r+o/2),v=F-(T=s+l/2),(k>2||k<-2)&&Bs.getCurrentpage().ZoomIn(P,!1,!1),R=S,E=M,F=T}}},this.mouseout=function(e){i.bmovemousebutton=!1,i.mouseuphandler(e),I=-1},this.mousemove=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws);var r=!1,s=td(t,e);if(i.findspacehover(s),i.curmousepos=s,i.labelhandler(s,e),i.started){var n=c-s.x,o=h-s.y;if(0==e.button){if(-1==I||Bs.bMarkupLocked||Bs.markuplist[O].locked||i.bmovemousebutton)i.movehandler(s,e);else{if(W=Bs.getCurrentpage().getsnap(s),_=!(!W||!W.found||null==W)&&(W.found||null!=W),4==Bs.markuplist[O].editaction){if(_&&(p=0!=Bs.getCurrentpage().drotation?rn(W):W,n=c-p.x,o=h-p.y,r=!0),Bn(s)){if(0==Bs.getCurrentpage().drotation)Bs.markuplist[O].snapTo(s.x,s.y,Bs.markuplist[O].selectedpoint);else{var l=on(s.x,s.y);Bs.markuplist[O].snapTo(l.x,l.y,Bs.markuplist[O].selectedpoint)}_?(Bs.getCurrentpage().drotation,p=W,Bs.markuplist[O].snapTo(p.x,p.y,Bs.markuplist[O].selectedpoint)):(Bs.markuplist[O].editpoint(n,o,Bs.markuplist[O].selectedpoint),null!=Ta&&8==Bs.markuplist[O].type&&Ta.onDrawEvent(Bs.markuplist[O].dimtext))}il(a),i.changedstate=!0}var u=!i.binsertpoint&&7==Bs.markuplist[O].editaction,d=!i.bmovelabel&&8==Bs.markuplist[O].editaction;if((1==Bs.markuplist[O].editaction||u||d)&&(e.target.style.cursor="move",$i||Bs.getMarkupMultiselected()?Bs.moveselected(n,o):Bs.markuplist[O].move(n,o),il(a),i.changedstate=!0),2==Bs.markuplist[O].editaction){if(_){if(0!=Bs.getCurrentpage().drotation)var p=rn(W);else p=W;n=c-p.x,o=h-p.y,r=!0}1==Bs.markuplist[O].scalecorner||4==Bs.markuplist[O].scalecorner?e.target.style.cursor="nw-resize":e.target.style.cursor="ne-resize",!_||6!=Bs.markuplist[O].type&&7!=Bs.markuplist[O].type?Bs.markuplist[O].scale(n,o,Bs.markuplist[O].scalecorner,a):Bs.markuplist[O].snapToCorner(W.x,W.y,Bs.markuplist[O].scalecorner),il(a),i.changedstate=!0}3==Bs.markuplist[O].editaction&&(Bs.markuplist[O].rotate(s.x,s.y,Bs.markuplist[O].scalecorner),il(a),i.changedstate=!0),6==Bs.markuplist[O].editaction&&(e.target.style.cursor="move",Bs.markuplist[O].dimextend(s.x,s.y),il(a),i.changedstate=!0),8==Bs.markuplist[O].editaction&&i.bmovelabel&&!Es&&(e.target.style.cursor="move",Bs.markuplist[O].movelabel(n,o),il(a),i.changedstate=!0)}r&&_?(p=0!=Bs.getCurrentpage().drotation?rn(W):W,c=p.x,h=p.y):(c=s.x,h=s.y)}else 1==e.button&&(Bs.getCurrentpage().pan_update(n,o),c=s.x,h=s.y,il(a))}}},this.touchmove=function(e){if(!jh()){ws&&(Bs.bMarkupLocked=ws),e.preventDefault();var r=ed(t,e,0),s=r.x,m=r.y;u=r.x,p=r.y;var f,y,v=c-u,b=h-p;switch(e.targetTouches.length){case 1:if(-1==I||Bs.bMarkupLocked||Bs.markuplist[O].locked)Bs.getCurrentpage().usevectorxml?Bs.getCurrentpage().initialscale<Bs.getCurrentpage().dscalevector&&v<50&&b<50&&Bs.getCurrentpage().pan_update(v,b):(0==Bs.Type&&(Bs.getCurrentpage().startx<0||Bs.getCurrentpage().endx>t.width?v<50&&b<50&&Bs.getCurrentpage().pan_update(v,b):$a?Bs.getCurrentpage().pan_update(v,b):Bs.getCurrentpage().pan_update(0,b)),Bs.getCurrentpage().initialscale<Bs.getCurrentpage().dscale/Bs.getCurrentpage().bitmapratio&&(0==Bs.Type?$a?Bs.getCurrentpage().pan_update(v,b):Bs.getCurrentpage().pan_update(0,b):v<50&&b<50&&Bs.getCurrentpage().pan_update(v,b)));else{if(!i.started)return;var x=!i.binsertpoint&&7==Bs.markuplist[O].editaction,w=!i.bmovelabel&&8==Bs.markuplist[O].editaction;(1==Bs.markuplist[O].editaction||x||w)&&($i||Bs.getMarkupMultiselected()?Bs.moveselected(v,b):Bs.markuplist[O].move(v,b),il(a),i.changedstate=!0),2==Bs.markuplist[O].editaction&&(Bs.markuplist[O].scale(v,b,Bs.markuplist[O].scalecorner,a),il(a),i.changedstate=!0),3==Bs.markuplist[O].editaction&&(Bs.markuplist[O].rotate(s,m,Bs.markuplist[O].scalecorner),il(a),i.changedstate=!0),4==Bs.markuplist[O].editaction&&(Bs.markuplist[O].editpoint(v,b,Bs.markuplist[O].selectedpoint),null!=Ta&&8==Bs.markuplist[O].type&&Ta.onDrawEvent(Bs.markuplist[O].dimtext),il(a),i.changedstate=!0),6==Bs.markuplist[O].editaction&&(e.target.style.cursor="move",Bs.markuplist[O].dimextend(r.x,r.y),il(a),i.changedstate=!0),8==Bs.markuplist[O].editaction&&i.bmovelabel&&!Es&&(e.target.style.cursor="move",Bs.markuplist[O].movelabel(v,b),il(a),i.changedstate=!0)}c=r.x,h=r.y;break;case 2:var k=ed(t,e,1);d=k.x,g=k.y,o=Math.abs(d-u),l=Math.abs(g-p),D=Math.pow(o,2),C=Math.pow(l,2);var P=(S=Math.sqrt(D+C))-R,j=S*(1/R),L=d-u,V=g-p;H=180*Math.atan2(V,L)/Math.PI,U=H-G,M=u+o/2,T=p+l/2;var N=(f=r,y=k,{x:Math.round(.5*(f.x+y.x)),y:Math.round(.5*(f.y+y.y))});if(n.lineWidth=4,n.strokeStyle="blue",n.beginPath(),n.arc(N.x,N.y,50,0,2*Math.PI),n.stroke(),M=N.x,T=N.y,P>2||P<-2){if(j<1)var A=1/j,B=!0;else A=j,B=!1;B?!!i.belowlimitExtent(A)&&Bs.getCurrentpage().ZoomOut(A,!1,!1,N):Bs.getCurrentpage().ZoomIn(A,!1,!1,N),R=S}Math.abs(U)}E=M,F=T,c=u,h=p}},this.keyup=function(e){switch("function"==typeof rr.indexOf&&rr.indexOf(e.keyCode)>=0&&(i.scrollkeyOn=!1),e.keyCode){case rr:i.scrollkeyOn=!1}i.curkey=null},this.keydown=function(e){if(!jh()){if(i.curkey=e.keyCode,null!=Ca){var t={mousepos:null,mousebutton:null,dblclick:!1,key:i.curkey,keylocation:e.location,tool:i.name};Ca.setInput(t)}if(ws&&(Bs.bMarkupLocked=ws),Ka&&!Bs.bMarkupLocked)switch("function"==typeof rr.indexOf&&rr.indexOf(e.keyCode)>=0&&(i.scrollkeyOn=!0),e.keyCode){case rr:i.scrollkeyOn=!0;break;case 13:case 8:break;case 46:if(-1!=O){if(null==Bs.markuplist[O])break;if(9==Bs.markuplist[O].type&&Bs.markuplist[O].selectedit)break}if(yr)break;Jo()}}},this.MSPointerUp=function(e){jh()||(i.bmovemousebutton=!1,L.pop(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==Bs.markuplist[O].editaction&&Bs.markuplist[O].findrectangle(),i.started=!1):i.mouseuphandler(e)))},this.mouseup=function(e){jh()||(i.bmovemousebutton=!1,i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==Bs.markuplist[O].editaction&&Bs.markuplist[O].findrectangle(),i.started=!1):i.mouseuphandler(e)))},this.touchcancel=function(e){jh()||(e.preventDefault(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==Bs.markuplist[O].editaction&&Bs.markuplist[O].findrectangle(),i.started=!1,0!=Bs.Type||$a||(Bs.currentpage,Bs.currentpage,Bs.NumPages)):i.mouseuphandler(e)))},this.touchend=function(e){jh()||(e.preventDefault(),i.started&&(-1!=I?(i.changedstate&&(i.savestate=!0),4==Bs.markuplist[O].editaction&&Bs.markuplist[O].findrectangle(),i.started=!1,0!=Bs.Type||$a||(Bs.currentpage,Bs.currentpage,Bs.NumPages)):i.mouseuphandler(e)))}},_s.arrow=function(e){var i,r=this,s=0,n=0,o=0,l=0;Bs.markuplist.length,this.started=!1,this.name="arrow",this.anglelengthsupport=!0,this.refreshSupport=!1;var c,h=!1,u=!1,d=e.p1;this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.bUsemouseinput=!0,this.curmousepos={x:0,y:0,xus:0,yus:0},_u(Yu(6==d?"callout":"arrow")),this.setAngleLength=function(e,s,n,o){if(this.bUsemouseinput=!1,null!=i){i.x=r.x0,i.y=r.y0;var l=i.w,c=i.h,h=i.setAnglelength(s,e,o);a.clearRect(0,0,t.width,t.height),Bn({x:h.w,y:h.h})?(i.w=h.w,i.h=h.h,r.setdimoffset(!1),i.drawme(a)):(i.w=l,i.h=c,this.bUsemouseinput=!0,i.drawme(a),i.bUsemouseinput=!0,null!=Ea&&Ea.onDrawError("outside"))}},this.apply=function(){a.clearRect(0,0,t.width,t.height),r.setdimoffset(!1),i.drawme(a),Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),i=null,r.started=!1,Hc(),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})},this.scrollhandling=function(e){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(e<0?Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(r.belowlimitExtent(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1,r.curmousepos),r.started&&r.setdimoffset(!1)):Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,r.curmousepos),r.started&&r.setdimoffset(!1)))},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),i=Na-60,s=Aa-60;a.w/e<i&&a.h/e<s&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,r.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),r.scrollhandling(t)},this.setdimoffset=function(e){if(e){i.scaling=Ln();var t=jn();i.xoffset=t.x,i.yoffset=t.y,r.orgscale=i.scaling,r.orgdx=i.xoffset,r.orgdy=i.yoffset}var a=Bs.getCurrentpage().getdscale();Bs.getCurrentpage().getdx(),Bs.getCurrentpage().getdy();if(i){i.scaling;i.w,i.xoffset,i.h,i.yoffset}},this.pointermove=function(e){r.MSPointerMove(e)},this.pointerdown=function(e){r.MSPointerDown(e)},this.pointerup=function(e){r.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);i&&(a=i.getPadding(a));var o=Bn(a);0==e.button?r.started?r.completeArrow(o,a):r.startArrow(o,a):(s=a.x,n=a.y)},this.startArrow=function(e,t){if(e){if(r.started=!0,Bs&&(Bs.bMarkupchanged=!0),h){if(0!=Bs.getCurrentpage().drotation)var a=rn(c);else a=c;r.x0=a.x,r.y0=a.y}else r.x0=t.x,r.y0=t.y;10==d?i=new Fo(4,1,ms):(i=new Fo(6,d,0)).pagerotation=Bs.getCurrentpage().drotation,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),r.setdimoffset(!0),r.startx=r.x0,r.starty=r.y0,i.seteditaction(0)}},this.completeArrow=function(e,s){if(r.bfirstpointset){var n={x:r.x0,y:r.y0};if(4==i.type&&1==i.subtype)var o=Nn(n,s);else o=!0;if(xr&&(xr=!1,u=!0),e&&o){if(r.started=!1,h){if(0!=Bs.getCurrentpage().drotation)var l=rn(c);else l=c;r.bUsemouseinput&&(i.w=l.x,i.h=l.y)}else r.bUsemouseinput&&(Bs.getCurrentpage().drotation,i.w=s.x,i.h=s.y);if(a.clearRect(0,0,t.width,t.height),r.setdimoffset(!1),i.drawme(a),Cr||(gr=!0),Dr=Bs.markuplist.length,6==d){xr&&(xr=!0,u=!1);var p=i.getdrawBox(s)}if(i.savemetolistDraw(),u){var g=i.calculateOrthoDraw({x:i.x,y:i.y},{x:i.w,y:i.h});i.w=g.w,i.h=g.h}i=null,Hc(),6==d&&ju(p.x,p.y,p.w,p.h,Bs.markuplist[Dr]),Zh(),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}),u&&(xr=!0,u=!1)}}},this.drawArrow=function(e){if(r.bUsemouseinput&&(i.x=r.x0,i.y=r.y0,r.bfirstpointset=!0),h){if(0!=Bs.getCurrentpage().drotation)var t=rn(c);else t=c;r.bUsemouseinput&&(i.w=t.x,i.h=t.y,r.bfirstpointset=!0),o=t.x,l=t.y}else r.bUsemouseinput&&(i.w=e.x,i.h=e.y,r.bfirstpointset=!0),o=e.x,l=e.y},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);i&&(a=i.getPadding(a));var o=Bn(a);0==e.button?r.started?r.completeArrow(o,a):r.startArrow(o,a):(s=a.x,n=a.y)},this.touchstart=function(e){e.preventDefault();var a=ed(t,e,0);i&&(a=i.getPadding(a));var s=Bn(a);if(r.started=!0,Bs&&(Bs.bMarkupchanged=!0),!s)return r.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));r.x0=a.x,r.y0=a.y,10==d?i=new Fo(4,1,ms):(i=new Fo(6,d,0)).pagerotation=Bs.getCurrentpage().drotation,i.scaling=Ln();var n=jn();i.xoffset=n.x,i.yoffset=n.y,i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var u=td(t,e);r.curmousepos=u;var d=s-u.x,p=n-u.y;if((c=Bs.getCurrentpage().getsnap(u)).found&&null!=c?(h=!0,sd(a,c)):(h=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(Bs.getCurrentpage().pan_update(d,p),r.setdimoffset(!1),s=u.x,n=u.y),r.started){i&&(u=i.getPadding(u));var g=Bn(u),m={x:r.x0,y:r.y0};if(4==i.type&&1==i.subtype)var f=Nn(m,u);else f=!0;if(g&&f){if(a.clearRect(0,0,t.width,t.height),i.x=r.x0,i.y=r.y0,h){if(0!=Bs.getCurrentpage().drotation)var y=rn(c);else y=c;r.bUsemouseinput&&(i.w=y.x,i.h=y.y),o=y.x,l=y.y,sd(a,c)}else r.bUsemouseinput&&(i.w=u.x,i.h=u.y),o=u.x,l=u.y;r.setdimoffset(!1),i.drawme(a)}else a.clearRect(0,0,t.width,t.height),i.x=r.x0,i.y=r.y0,r.bUsemouseinput&&(i.w=o,i.h=l),r.setdimoffset(!1),i.drawme(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var u=td(t,e);r.curmousepos=u;var d=s-u.x,p=n-u.y;if((c=Bs.getCurrentpage().getsnap(u)).found&&null!=c?(h=!0,sd(a,c)):(h=!1,a.clearRect(0,0,t.width,t.height)),2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(d,p),r.setdimoffset(!1),s=u.x,n=u.y),r.started){i&&(u=i.getPadding(u));var g=Bn(u),m={x:r.x0,y:r.y0};if(4==i.type&&1==i.subtype)var f=Nn(m,u);else f=!0;g&&f?(a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&(i.x=r.x0,i.y=r.y0),r.drawArrow(u),r.setdimoffset(!1),h&&sd(a,c),i.drawme(a)):(a.clearRect(0,0,t.width,t.height),r.bUsemouseinput&&(i.x=r.x0,i.y=r.y0),r.bUsemouseinput&&(i.w=o,i.h=l),r.setdimoffset(!1),i.drawme(a))}},this.touchmove=function(e){if(e.preventDefault(),r.started){var o=ed(t,e,0);i&&(o=i.getPadding(o)),Bn(o)?(i.x=r.x0,i.y=r.y0,r.bUsemouseinput&&(i.w=o.x,i.h=o.y),r.bfirstpointset=!0,s=o.x,n=o.y):(i.x=r.x0,i.y=r.y0,r.bUsemouseinput&&(i.w=s,i.h=n),r.bfirstpointset=!0),a.clearRect(0,0,t.width,t.height),i.drawme(a)}},this.MSPointerUp=function(e){e.preventDefault()},this.mouseup=function(e){e.preventDefault()},this.touchcancel=function(e){if(e.preventDefault(),r.started){if(Cr||(gr=!0),Dr=Bs.markuplist.length,6==d){i.h,tn.height,tn.height;var t=i.getdrawBox()}i.savemetolistDraw(),Hc(),r.touchmove(e),r.started=!1,i=null,6==d&&ju(t.x,t.y,t.w,t.h,Bs.markuplist[Dr]),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}},this.touchend=function(e){if(e.preventDefault(),r.started){if(Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),Hc(),r.touchmove(e),6==d){i.h,tn.height,tn.height;var t=i.getdrawBox()}r.started=!1,i=null,6==d&&ju(t.x,t.y,t.w,t.h,Bs.markuplist[Dr]),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}}},_s.Polycurve=function(e){var i=this,r=0,s=0;this.started=!1,this.name="Polycurve",this.anglelengthsupport=!1,this.refreshSupport=!1,this.terminated=!1,this.LastTouchdata=-1,Bs.markuplist.length;var n,o=e.p1;_u("crosshair"),this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var r=td(t,e);if(!Bn(r))return i.started=!1,Bs&&(Bs.bMarkupchanged=!1),void(e.target.style.cursor="default");if(i.started)n.addpoint(r.x,r.y);else{(n=new Fo(2,o,0)).pagenumber=Bs.getcurPage(),n.viewname=Bs.getcur3DView(),null!=n.viewname&&(n.bfor3D=!0,n.pageheight=Aa,n.pagewidth=Na),n.scaling=Ln();var s=jn();n.xoffset=s.x,n.yoffset=s.y,n.x=r.x,n.y=r.y,n.seteditaction(0),n.addpoint(r.x,r.y),i.started=!0,Bs&&(Bs.bMarkupchanged=!0),n.startdraw(a),n.addpoint(r.x,r.y)}},this.mousedown=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var r=td(t,e);if(!Bn(r))return i.started=!1,Bs&&(Bs.bMarkupchanged=!1),void(e.target.style.cursor="default");if(i.started)n.addpoint(r.x,r.y);else{(n=new Fo(2,o,0)).pagenumber=Bs.getcurPage(),n.viewname=Bs.getcur3DView(),null!=n.viewname&&(n.bfor3D=!0,n.pageheight=Aa,n.pagewidth=Na),n.scaling=Ln();var s=jn();n.xoffset=s.x,n.yoffset=s.y,n.x=r.x,n.y=r.y,n.seteditaction(0),n.addpoint(r.x,r.y),i.started=!0,Bs&&(Bs.bMarkupchanged=!0),n.startdraw(a),n.addpoint(r.x,r.y)}},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var o=td(t,e),l=Bn(o);i.started&&(l?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),r=o.x,s=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(r,s),n.drawme(a)))},this.mousemove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var o=td(t,e);i.started&&(Bn(o)?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),r=o.x,s=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(r,s),n.drawme(a)))},this.mouseup=function(e){},this.dblclick=function(e){i.started&&(i.mousemove(e),i.started=!1,n.points.splice(n.numpoints-1,2),n.findrectangle(),n.savemetolistDraw(),n=null,Hc(),e.target.style.cursor="default")},this.doubletap=function(e){i.started&&(i.started=!1,n.points.splice(n.points.length-1,1),n.findrectangle(),n.savemetolistDraw(),n=null,Hc())},this.touchstart=function(e){e.preventDefault();var r=ed(t,e,0),s=r.x,l=r.y,c=(new Date).getTime(),h=c-(-1==i.LastTouchdata?c+1:i.LastTouchdata);if(i.LastTouchdata=c,h<500&&h>0)i.doubletap(e);else{if(!Bn(r))return i.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));if(i.started)n.addpoint(s,l);else{(n=new Fo(2,o,0)).pagenumber=Bs.getcurPage(),n.viewname=Bs.getcur3DView(),null!=n.viewname&&(n.bfor3D=!0,n.pageheight=Aa,n.pagewidth=Na),n.scaling=Ln();var u=jn();n.xoffset=u.x,n.yoffset=u.y,n.x=s,n.y=l,n.seteditaction(0),n.addpoint(s,l),n.startdraw(a),n.addpoint(s,l),i.started=!0,Bs&&(Bs.bMarkupchanged=!0)}}},this.touchmove=function(e){e.preventDefault();var o=ed(t,e,0);o.x,o.y,i.started&&(Bn(o)?(a.clearRect(0,0,t.width,t.height),n.setlastpoint(o.x,o.y),n.drawme(a),r=o.x,s=o.y):(a.clearRect(0,0,t.width,t.height),n.setlastpoint(r,s),n.drawme(a)))},this.touchcancel=function(e){e.preventDefault();var a=ed(t,e,0),r=a.x,s=a.y;i.started&&Bn(a)&&n.addpoint(r,s)},this.touchend=function(e){e.preventDefault();var a=ed(t,e,0),r=a.x,s=a.y;i.started&&Bn(a)&&n.addpoint(r,s)}},_s.area=function(e){var i,r,s=this,o=0,l=0,c=0,h=0,u=!1,d=(Bs.markuplist.length,e.p1),p=e.p2;this.subtype=e.p2,this.markupobject=e.p3,this.name="area",this.anglelengthsupport=!0,this.refreshSupport=!0,this.multipoint=!0,this.bUsemouseinput=!0,this.started=!1,this.terminated=!1,this.LastTouchdata=-1,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0},this.scaleoffset=void 0,_u(Yu("area")),this.getdimoffset=function(){var e={scale:void 0,xoffset:void 0,yoffset:void 0};e.scale=Ln();var t=jn();return e.xoffset=t.x,e.yoffset=t.y,e},this.setAngleLength=function(e,i,n,o){this.bUsemouseinput=!1;var l=r.points.length>=2;if(null!=r&&l){var c=r.points[r.points.length-1].x,h=r.points[r.points.length-1].y,u=r.setAnglelengthPoints(i,e,o);a.clearRect(0,0,t.width,t.height),Bn({x:u.w,y:u.h})?(r.setlastpoint(u.w,u.h),n&&r.addpoint(u.w,u.h),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a)):(r.setlastpoint(c,h),this.bUsemouseinput=!0,r.getnumpoints()>0&&r.drawme(a),r.bUsemouseinput=!0,null!=Ea&&Ea.onDrawError("outside"))}},this.useMouseInput=function(){s.bUsemouseinput=!0},this.removelastPoint=function(){null!=r&&(a.clearRect(0,0,t.width,t.height),r.getnumpoints()>0&&r.drawme(a),r.points.splice(r.points.length-1,1),r.setlastpoint(s.curmousepos.x,s.curmousepos.y),a.clearRect(0,0,t.width,t.height),r.getnumpoints()>0&&r.drawme(a))},this.newsegment=function(){r.addline()},this.apply=function(){1==r.type&&6==r.subtype?s.applySegment():(a.clearRect(0,0,t.width,t.height),s.started&&(s.started=!1,s.setdimoffset(!1),r.points.length>0&&r.drawme(a),r.points.splice(r.points.length-1,1),r.findrectangle(),r.resetcupoint(),Cr||(gr=!0),Dr=Bs.markuplist.length,r.savemetolistDraw(),r=null,al(n),Hc(),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})))},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),i=Na-60,r=Aa-60;a.w/e<i&&a.h/e<r&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,s.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.scrollhandling=function(e){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(e<0?Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(s.belowlimitExtent(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1,s.curmousepos),s.started&&(s.setdimoffset(!1),s.bUsemouseinput&&r.setlastpoint(s.curmousepos.x,s.curmousepos.y),r.points.length>0&&r.drawme(a))):Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,s.curmousepos),s.started&&(s.setdimoffset(!1),s.bUsemouseinput&&r.setlastpoint(s.curmousepos.x,s.curmousepos.y),r.points.length>0&&r.drawme(a))))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),s.scrollhandling(t)},this.setdimoffset=function(e){e&&(s.scaleoffset=s.getdimoffset(),r.scaling=s.scaleoffset.scale,r.xoffset=s.scaleoffset.xoffset,r.yoffset=s.scaleoffset.yoffset,s.orgscale=s.scaleoffset.scale,s.orgdx=s.scaleoffset.xoffset,s.orgdy=s.scaleoffset.yoffset),s.scaleoffset=s.getdimoffset();Bs.getCurrentpage().getdscale();Bs.getCurrentpage().getdx(),Bs.getCurrentpage().getdy(),r&&r.scaling},this.pointermove=function(e){s.MSPointerMove(e)},this.pointerdown=function(e){s.MSPointerDown(e)},this.pointerup=function(e){s.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);if(0==e.button){if(!Bn(n))return;if(s.started)u?(c=0!=Bs.getCurrentpage().drotation?rn(i):i,s.bUsemouseinput&&r.addpoint(c.x,c.y)):s.bUsemouseinput&&r.addpoint(n.x,n.y);else if(r=new Fo(d,p,ms),1==p&&(r.linewidth=1,r.AddAttribute("Rx_Area","0"),r.AddAttribute("SpaceID","0")),r.pagenumber=Bs.getcurPage(),r.viewname=Bs.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=Aa,r.pagewidth=Na),s.setdimoffset(!0),u){if(0!=Bs.getCurrentpage().drotation)var c=rn(i);else c=i;r.x=c.x,r.y=c.y,r.seteditaction(0),r.addpoint(c.x,c.y),s.started=!0,Bs&&(Bs.bMarkupchanged=!0),r.startdraw(a),r.addpoint(c.x,c.y)}else r.x=n.x,r.y=n.y,r.seteditaction(0),r.addpoint(n.x,n.y),s.started=!0,Bs&&(Bs.bMarkupchanged=!0),r.startdraw(a),r.addpoint(n.x,n.y)}else o=n.x,l=n.y},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);if(2==s.subtype&&null!=s.markupobject){let e=!0;for(let t=0;t<s.markupobject.points.length;t++)if(s.markupobject.points[t],!1===s.markupobject.ispointwithinarea(n.x,n.y)){e=!1;break}if(!1===e)return}if(0==e.button){if(!Bn(n))return;if(s.started){var c=1==r.type&&(4==r.subtype||5==r.subtype);u?(h=0!=Bs.getCurrentpage().drotation?rn(i):i,s.bUsemouseinput&&(c?r.points.length<3?r.addpoint(h.x,h.y):s.completeArea(0):r.addpoint(h.x,h.y))):s.bUsemouseinput&&(c?r.points.length<3?r.addpoint(n.x,n.y):s.completeArea(0):r.addpoint(n.x,n.y))}else if(r=new Fo(d,p,ms),8==d&&1==p&&(r.linewidth=1,r.AddAttribute("Rx_Area","0"),r.AddAttribute("SpaceID","0")),r.pagenumber=Bs.getcurPage(),r.viewname=Bs.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=Aa,r.pagewidth=Na),s.setdimoffset(!0),u){if(0!=Bs.getCurrentpage().drotation)var h=rn(i);else h=i;r.x=h.x,r.y=h.y,r.seteditaction(0),r.addpoint(h.x,h.y),s.started=!0,Bs&&(Bs.bMarkupchanged=!0),r.startdraw(a),r.addpoint(h.x,h.y)}else r.x=n.x,r.y=n.y,r.seteditaction(0),r.addpoint(n.x,n.y),s.started=!0,Bs&&(Bs.bMarkupchanged=!0),r.startdraw(a),r.addpoint(n.x,n.y)}else o=n.x,l=n.y},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.curmousepos=n;var d=o-n.x,p=l-n.y;(i=Bs.getCurrentpage().getsnap(n)).found&&null!=i?(u=!0,s.started||sd(a,i)):(u=!1,s.started||a.clearRect(0,0,t.width,t.height));var g=Bn(n);if(2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(d,p),o=n.x,l=n.y,s.started&&s.setdimoffset(!1)),s.started)if(g){if(a.clearRect(0,0,t.width,t.height),u){if(0!=Bs.getCurrentpage().drotation)var m=rn(i);else m=i;sd(a,i),s.bUsemouseinput&&r.setlastpoint(m.x,m.y),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a),c=m.x,h=m.y}else s.bUsemouseinput&&r.setlastpoint(n.x,n.y),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a),c=n.x,h=n.y;2==e.button||e.buttons}else a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&r.setlastpoint(c,h),r.getnumpoints()>0&&r.drawme(a)},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.curmousepos=n;var c=o-n.x,h=l-n.y;(i=Bs.getCurrentpage().getsnap(n)).found&&null!=i?(u=!0,s.started||(a.clearRect(0,0,t.width,t.height),sd(a,i))):(u=!1,s.started||a.clearRect(0,0,t.width,t.height));var d=Bn(n);if(2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(c,h),o=n.x,l=n.y,s.started&&s.setdimoffset(!1)),s.started){if(2==s.subtype&&null!=s.markupobject){let e=!0;for(let t=0;t<s.markupobject.points.length;t++)if(s.markupobject.points[t],!1===s.markupobject.ispointwithinarea(n.x,n.y)){e=!1;break}if(!1===e)return}if(d)if(a.clearRect(0,0,t.width,t.height),u){if(0!=Bs.getCurrentpage().drotation)var p=rn(i);else p=i;sd(a,i),s.bUsemouseinput&&r.setlastpoint(p.x,p.y),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a),o=p.x,l=p.y}else s.bUsemouseinput&&r.setlastpoint(n.x,n.y),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a),o=n.x,l=n.y;else a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&r.setlastpoint(o,l),s.setdimoffset(!1),r.getnumpoints()>0&&r.drawme(a)}},this.MSPointerUp=function(e){},this.mouseup=function(e){},this.completeSegment=function(e){null!=r&&(e>0&&r.points.splice(r.points.length-e,e),1==r.type&&6==r.subtype&&r.points.length<2||r.addline())},this.applySegment=function(){if(s.started&&null!=r&&1==r.type&&6==r.subtype){s.started=!1,r.findrectangle(),Cr||(gr=!0,Dr=Bs.markuplist.length),r.savemetolistDraw();var e=r.saved;r=null,Hc(),al(n),e?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):(gr=e,Dr=-1,Cr||vu(!0))}},this.completeArea=function(e){if(null!=r){s.started=!1,e>0&&r.points.splice(r.points.length-e,e);var t=1==r.type&&2==r.subtype||8==r.type,a=1==r.type&&3==r.subtype||1==r.type&&1==r.subtype;if(t&&r.points.length<3)r=null;else if(a&&r.points.length<2)r=null;else{r.findrectangle(),Cr||(gr=!0),Dr=Bs.markuplist.length,2==s.subtype&&null!=s.markupobject&&(r.parent=s.markupobject,s.markupobject.holes.push(r),r.isStartedHole=!1),r.savemetolistDraw();var i=r.saved;r=null,Hc(),al(n),Pr&&i?null!=zt&&(2==s.subtype&&null!=s.markupobject?zt.setMarkupSelected(s.markupobject,{created:!0,modified:!1,deleted:!1,multi:Cr}):zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr})):!Cr&&i&&null!=zt&&(2==s.subtype&&null!=s.markupobject?zt.setMarkupSelected(s.markupobject,{created:!0,modified:!1,deleted:!1}):zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}))}}},this.dblclick=function(e){var t=1==r.type&&(4==r.subtype||5==r.subtype),a=1==r.type&&6==r.subtype;t||s.bUsemouseinput&&s.started&&(a?s.completeSegment(2):s.completeArea(2))},this.doubletap=function(e){var t=1==r.type&&(4==r.subtype||5==r.subtype),a=1==r.type&&6==r.subtype;t||s.bUsemouseinput&&s.started&&(a?s.completeSegment(1):s.completeArea(1))},this.touchstart=function(e){e.preventDefault();var i=ed(t,e,0),n=i.x,o=i.y,l=(new Date).getTime(),c=l-(-1==s.LastTouchdata?l+1:s.LastTouchdata);if(s.LastTouchdata=l,c<500&&c>0)s.doubletap(e);else if(Bn(i))if(s.started){var h=1==r.type&&(4==r.subtype||5==r.subtype);s.bUsemouseinput&&(h?r.points.length<3?r.addpoint(n,o):s.completeArea(0):r.addpoint(n,o))}else r=new Fo(d,p,ms),8==d&&1==p&&(r.linewidth=1,r.AddAttribute("Rx_Area","0"),r.AddAttribute("SpaceID","0")),r.pagenumber=Bs.getcurPage(),r.viewname=Bs.getcur3DView(),null!=r.viewname&&(r.bfor3D=!0,r.pageheight=Aa,r.pagewidth=Na),s.setdimoffset(!0),r.x=n,r.y=o,r.seteditaction(0),r.addpoint(n,o),r.startdraw(a),r.addpoint(n,o),s.started=!0,Bs&&(Bs.bMarkupchanged=!0)},this.touchmove=function(e){e.preventDefault();var i=ed(t,e,0);i.x,i.y,s.started&&(Bn(i)?(a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&r.setlastpoint(i.x,i.y),r.getnumpoints()>0&&r.drawme(a),o=i.x,l=i.y):(a.clearRect(0,0,t.width,t.height),s.bUsemouseinput&&r.setlastpoint(o,l),r.getnumpoints()>0&&r.drawme(a)))},this.touchcancel=function(e){e.preventDefault();var a=ed(t,e,0),i=a.x,n=a.y;if(s.started){var o=1==r.type&&(4==r.subtype||5==r.subtype);s.bUsemouseinput&&(o?r.points.length<3?r.addpoint(i,n):s.completeArea(0):r.addpoint(i,n))}},this.touchend=function(e){e.preventDefault();var a=ed(t,e,0),i=a.x,n=a.y;if(s.started&&s.bUsemouseinput){var o=1==r.type&&(4==r.subtype||5==r.subtype);s.bUsemouseinput&&(o?r.points.length<3?r.addpoint(i,n):s.completeArea(0):r.addpoint(i,n))}},this.keydown=function(e){if(!jh()&&null!=r&&null!=r){var t=1==r.type&&(4==r.subtype||5==r.subtype),a=1==r.type&&6==r.subtype;switch(ws&&(Bs.bMarkupLocked=ws),e.keyCode){case 13:e.stopPropagation(),a?s.completeSegment(1):(s.started=!1,t||s.completeArea(1));break;case 8:s.removelastPoint()}}}},_s.measuretool=function(e){var i=this;this.name="measuretool",this.anglelengthsupport=!1,this.refreshSupport=!1,this.started=!1,this.Area=0,this.totaldistance=0,this.LastTouchdata=-1;var r,s=!1,n=e.twoopoints;this.points=[],this.numpoints=-1,this.lines=[],this.numlines=-1,this.lengths=[],this.numlengths=-1,this.angles=[],this.numangles=-1,this.result={points:[],lines:[],lengths:[],angles:[],numpoints:-1,numlines:-1,numlengths:-1,numangles:-1,area:0,totaldistance:0},_u(Yu("measuretool")),this.addToTable=function(){var e=Bs.getCurrentpage().dscale*Bs.getCurrentpage().dscale;Bs.getCurrentpage().usevectorxml?e=Bs.getCurrentpage().dscalevector*Bs.getCurrentpage().dscalevector:Bs.getCurrentpage().usepdfjs&&(e=Bs.getCurrentpage().curpagescale*Bs.getCurrentpage().dscalepdf*(Bs.getCurrentpage().curpagescale*Bs.getCurrentpage().dscalepdf)),i.result.area=i.PolygonArea(),i.result.area=vo(i.result.area/e),Bs.getCurrentpage().usevectorxml?i.result.totaldistance=ko(i.result.totaldistance/Bs.getCurrentpage().dscalevector):Bs.getCurrentpage().usepdfjs?i.result.totaldistance=ko(i.result.totaldistance/(Bs.getCurrentpage().curpagescale*Bs.getCurrentpage().dscalepdf)):i.result.totaldistance=ko(i.result.totaldistance/Bs.getCurrentpage().dscale)},this.PolygonArea=function(){var e=0,t=0,a=i.result.points.length;for(e=0;e<a-1;e++)t+=i.result.points[e].x*i.result.points[e+1].y-i.result.points[e+1].x*i.result.points[e].y;return t+=i.result.points[a-1].x*i.result.points[0].y-i.result.points[0].x*i.result.points[a-1].y,Math.abs(t/2)},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.addpoint=function(e,r){i.result.points.push(new Gs(e,r)),i.result.numpoints++,n&&2===i.result.numpoints&&null!=Lt&&(i.started=!1,i.result.points.splice(2,1),i.result.totaldistance=0,i.calculatedistance(),i.addToTable(),Lt.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height),Wu())},this.setlastpoint=function(e,t){i.result.points[i.result.points.length-1].x=e,i.result.points[i.result.points.length-1].y=t},this.startdraw=function(e){e.beginPath(),e.moveTo(i.result.points[i.result.points.length-1].x,i.result.points[i.result.points.length-1].y)},this.getangleofline=function(e,t,a,i,r){var s=0,n=0;return r?(s=Math.abs(a-e),n=Math.abs(i-t)):(s=a-e,n=i-t),Math.atan2(n,s)},this.findanglebetweenlines=function(){var e=0,t=0,a=0,r=0;for(e=0;e<i.result.lines.length;e++)e>0&&(i.result.lines[e-1].height<=0&&i.result.lines[e-1].width>=0||i.result.lines[e-1].width<=0&&i.result.lines[e-1].height>=0?t=i.result.lines[e-1].rewangle:(i.result.lines[e-1].width>=0&&i.result.lines[e-1].height>=0||i.result.lines[e-1].width<=0&&i.result.lines[e-1].height<=0)&&(t=i.result.lines[e-1].angle),i.result.lines[e].height<=0&&i.result.lines[e].width>=0||i.result.lines[e].width<=0&&i.result.lines[e].height>=0?a=i.result.lines[e].rewangle:(i.result.lines[e].width>=0&&i.result.lines[e].height>=0||i.result.lines[e].width<=0&&i.result.lines[e].height<=0)&&(a=i.result.lines[e].angle),r=Math.PI-Math.abs(t+a),i.result.angles.push(Math.abs(r)),i.result.numangles++)},this.calculatedistance=function(){var e,t=0,a=0,r=0,s=0,n=0,o=0,l=0,c=0;if(i.result.points.length>=2){for(a=i.result.points[0].x,r=i.result.points[0].y,t=1;t<i.result.points.length;t++)s=i.result.points[t].x,n=i.result.points[t].y,t!=i.result.points.length&&(o=Math.abs(s-a),l=Math.abs(n-r),0!=(c=i.getdiag(o,l))&&(i.result.lengths.push(c),i.result.numlengths++,e=new Qs(a,r,s,n),i.result.lines.push(e),i.result.numlines++,i.result.totaldistance=i.result.totaldistance+c)),a=s,r=n;i.result.points.length>=3&&(s=i.result.points[0].x,n=i.result.points[0].y,o=Math.abs(s-a),l=Math.abs(n-r),c=i.getdiag(o,l),e=new Qs(a,r,s,n),i.result.lines.push(e),i.result.numlines++,i.result.lengths.push(c),i.result.numlengths++,i.result.totaldistance=i.result.totaldistance+c)}},this.draw=function(e){var t=0,a=0,r=0,s=0,n=0,o=0,l=0,c=0,h=0,u=!1;for(e.strokeStyle="red",e.beginPath(),e.moveTo(i.result.points[0].x,i.result.points[0].y),t=1;t<i.result.points.length;t++)e.lineTo(i.result.points[t].x,i.result.points[t].y),t>1&&(s=i.result.points[t-1].x,n=i.result.points[t-1].y,o=i.result.points[t].x,l=i.result.points[t].y,a=i.getangleofline(s,n,o,l,!1),s=i.result.points[t-2].x,n=i.result.points[t-2].y,c=o=i.result.points[t-1].x,h=l=i.result.points[t-1].y,r=i.getangleofline(s,n,o,l,!1),r-=Math.PI,u=!0);e.strokeStyle="red",e.lineWidth=1,e.closePath(),e.stroke(),u&&(e.beginPath(),e.arc(c,h,50,a,r,!1),e.strokeStyle="blue",e.lineWidth=4,e.stroke())},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(i.started)s?(n=0!=Bs.getCurrentpage().drotation?rn(r):r,i.addpoint(n.x,n.y)):i.addpoint(a.x,a.y);else{if(s){if(0!=Bs.getCurrentpage().drotation)var n=rn(r);else n=r;i.addpoint(n.x,n.y),i.addpoint(n.x,n.y)}else i.addpoint(a.x,a.y),i.addpoint(a.x,a.y);i.started=!0}},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e);if(i.started)s?(n=0!=Bs.getCurrentpage().drotation?rn(r):r,i.addpoint(n.x,n.y)):i.addpoint(a.x,a.y);else{if(s){if(0!=Bs.getCurrentpage().drotation)var n=rn(r);else n=r;i.addpoint(n.x,n.y),i.addpoint(n.x,n.y)}else i.addpoint(a.x,a.y),i.addpoint(a.x,a.y);i.started=!0}},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);if((r=Bs.getCurrentpage().getsnap(n)).found&&null!=r?(s=!0,sd(a,r)):(s=!1,a.clearRect(0,0,t.width,t.height)),i.started){if(a.clearRect(0,0,t.width,t.height),s){if(0!=Bs.getCurrentpage().drotation)var o=rn(r);else o=r;i.setlastpoint(o.x,o.y),sd(a,r)}else i.setlastpoint(n.x,n.y);i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);if((r=Bs.getCurrentpage().getsnap(n)).found&&null!=r?(s=!0,sd(a,r)):(s=!1,a.clearRect(0,0,t.width,t.height)),i.started){if(a.clearRect(0,0,t.width,t.height),s){if(0!=Bs.getCurrentpage().drotation)var o=rn(r);else o=r;i.setlastpoint(o.x,o.y),sd(a,r)}else i.setlastpoint(n.x,n.y);i.draw(a)}},this.MSPointerUp=function(e){},this.mouseup=function(e){},this.dblclick=function(e){i.started&&(i.mousemove(e),i.started=!1,i.result.points.splice(i.result.numpoints-1,2),i.result.totaldistance=0,i.calculatedistance(),i.findanglebetweenlines(),i.addToTable(),null!=Lt&&Lt.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height))},this.doubletap=function(e){i.started&&(i.started=!1,i.result.points.splice(i.result.numpoints-1,1),i.result.totaldistance=0,i.calculatedistance(),i.findanglebetweenlines(),i.addToTable(),null!=Lt&&Lt.setMeasureresult(i.result),i.result.points=[],i.result.numpoints=-1,i.result.lengths=[],i.result.numlengths=-1,i.result.angles=[],i.result.numangles=-1,i.result.lines=[],i.result.numlines=-1,a.clearRect(0,0,t.width,t.height))},this.touchstart=function(e){e.preventDefault();var a=ed(t,e,0),r=(a.x,a.y,(new Date).getTime()),s=r-(-1==i.LastTouchdata?r+1:i.LastTouchdata);i.LastTouchdata=r,s<500&&s>0?i.doubletap(e):i.started?i.addpoint(a.x,a.y):(i.addpoint(a.x,a.y),i.addpoint(a.x,a.y),i.started=!0)},this.touchmove=function(e){e.preventDefault();var r=ed(t,e,0);i.started&&(a.clearRect(0,0,t.width,t.height),i.setlastpoint(r.x,r.y),i.draw(a))},this.touchcancel=function(e){e.preventDefault();var a=ed(t,e,0);a.x,a.y,i.started},this.touchend=function(e){e.preventDefault();var a=ed(t,e,0);a.x,a.y,i.started}},_s.measure=function(e){var i,r,s=this,o=0,l=0,c=0,h=0,u=!1,d=!1,p=e.p1,g=e.p1;this.started=!1,this.name="measure",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0},_u(Yu("measure")),this.scrollhandling=function(e){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(e<0?Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(s.belowlimitExtent(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1,s.curmousepos),s.started&&(s.setdimoffset(!1),s.drawDimension({x:s.curmousepos.x,y:s.curmousepos.y}),null!=i&&(a.clearRect(0,0,t.width,t.height),i.drawme(a)))):Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,s.curmousepos),s.started&&(s.setdimoffset(!1),s.drawDimension({x:s.curmousepos.x,y:s.curmousepos.y}),null!=i&&i.drawme(a))))},this.belowlimitExtent=function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),i=Na-60,r=Aa-60;a.w/e<i&&a.h/e<r&&(t=!1);var n=Bs.getCurrentpage().ZoomOutTest(e,!1,s.curmousepos),o=Aa-30,l=Na-30;return n.y,n.h,n.y,n.w/n.h<Na/Aa?n.h<=o&&(t=!1):n.w<=l&&(t=!1),Ci||(t=!0),t},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),s.scrollhandling(t)},this.setdimoffset=function(e){if(e){i.scaling=Ln();var t=jn();i.xoffset=t.x,i.yoffset=t.y,s.orgscale=i.scaling,s.orgdx=i.xoffset,s.orgdy=i.yoffset}var a=Bs.getCurrentpage().getdscale();Bs.getCurrentpage().getdx(),Bs.getCurrentpage().getdy();if(i){i.scaling;i.w,i.xoffset,i.h,i.yoffset}},this.pointermove=function(e){s.MSPointerMove(e)},this.pointerdown=function(e){s.MSPointerDown(e)},this.pointerup=function(e){s.MSPointerUp(e)},this.MSPointerDown=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e),c=Bn(n);if(0==e.button)if(s.started)c&&(u?(h=0!=Bs.getCurrentpage().drotation?rn(r):r,i.w=h.x,i.h=h.y):(i.w=n.x,i.h=n.y),a.clearRect(0,0,t.width,t.height),s.setdimoffset(!1),i.drawme(a),Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),i=null,s.started=!1,Hc(),e.target.style.cursor="default",Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}));else{if(s.started=!0,Bs&&(Bs.bMarkupchanged=!0),!c)return s.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));if(u){if(0!=Bs.getCurrentpage().drotation)var h=rn(r);else h=r;s.x0=h.x,s.y0=h.y}else s.x0=n.x,s.y0=n.y;(i=new Fo(7,g,0)).pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.pagerotation=Bs.getCurrentpage().drotation,s.setdimoffset(!0),s.startx=s.x0,s.starty=s.y0,i.seteditaction(0)}else o=n.x,l=n.y},this.startDimension=function(e,t){if(e){if(s.started=!0,Bs&&(Bs.bMarkupchanged=!0),u){if(0!=Bs.getCurrentpage().drotation)var a=rn(r);else a=r;s.x0=a.x,s.y0=a.y}else s.x0=t.x,s.y0=t.y;(i=new Fo(7,g,0)).pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.pagerotation=Bs.getCurrentpage().drotation,s.setdimoffset(!0),s.startx=s.x0,s.starty=s.y0,i.seteditaction(0)}},this.completeDimension=function(e,n){if(xr&&(xr=!1,d=!0),e){if(s.started=!1,u){if(0!=Bs.getCurrentpage().drotation)var o=rn(r);else o=r;i.w=o.x,i.h=o.y}else Bs.getCurrentpage().drotation,i.w=n.x,i.h=n.y;if(a.clearRect(0,0,t.width,t.height),s.setdimoffset(!1),i.drawme(a),Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),d){var l=i.calculateOrthoDraw({x:i.x,y:i.y},{x:i.w,y:i.h});i.w=l.w,i.h=l.h}i=null,Hc(),Zh(),Pr?null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1,multi:Cr}):Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}),d&&(xr=!0,d=!1)}},this.drawDimension=function(e){if(u){if(0!=Bs.getCurrentpage().drotation)var t=rn(r);else t=r;i.x=s.x0,i.y=s.y0,i.w=t.x,i.h=t.y,3==p&&(i.w=i.w-i.x,i.h=i.h-i.y),s.bfirstpointset=!0,c=t.x,h=t.y}else i.x=s.x0,i.y=s.y0,i.w=e.x,i.h=e.y,3==p&&(i.w=i.w-i.x,i.h=i.h-i.y),s.bfirstpointset=!0,c=e.x,h=e.y},this.startRect=function(e,t){if(e){if(s.started=!0,Bs&&(Bs.bMarkupchanged=!0),u){if(0!=Bs.getCurrentpage().drotation)var a=rn(r);else a=r;s.x0=a.x,s.y0=a.y}else s.x0=t.x,s.y0=t.y;i=new Fo(p,g,ms),s.setdimoffset(!0),i.pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.seteditaction(0)}},this.drawRect=function(e){if(u){if(0!=Bs.getCurrentpage().drotation)var t=rn(r);else t=r;i.x=Math.min(t.x,s.x0),i.y=Math.min(t.y,s.y0),i.w=Math.abs(t.x-i.x),i.h=Math.abs(t.y-i.y),s.bfirstpointset=!0,c=t.x,h=t.y}else i.x=Math.min(e.x,s.x0),i.y=Math.min(e.y,s.y0),i.w=Math.abs(e.x-i.x),i.h=Math.abs(e.y-i.y),s.bfirstpointset=!0,c=e.x,h=e.y},this.endRect=function(e){if(e)if(s.started=!1,Cr||(gr=!0),Dr=Bs.markuplist.length,i.savemetolistDraw(),i=null,s.bfirstpointset=!1,Hc(),al(n),Pr){if(null!=zt){var t={created:!0,modified:!1,deleted:!1,multi:Cr};zt.setMarkupSelected(Bs.markuplist[Dr],t)}}else Cr||null==zt||(t={created:!0,modified:!1,deleted:!1},zt.setMarkupSelected(Bs.markuplist[Dr],t))},this.mousedown=function(e){e.preventDefault(),e.stopPropagation();var a=td(t,e),i=Bn(a);0==e.button?s.started?(s.bfirstpointset&&(3==p?s.endRect(i):s.completeDimension(i,a)),s.started):3==p?s.startRect(i,a):s.startDimension(i,a):(o=a.x,l=a.y)},this.touchstart=function(e){s.started=!0,Bs&&(Bs.bMarkupchanged=!0);var a=ed(t,e,0);if(!Bn(a))return s.started=!1,void(Bs&&(Bs.bMarkupchanged=!1));s.x0=a.x,s.y0=a.y,(i=new Fo(7,0,0)).pagenumber=Bs.getcurPage(),i.viewname=Bs.getcur3DView(),null!=i.viewname&&(i.bfor3D=!0,i.pageheight=Aa,i.pagewidth=Na),i.pagerotation=Bs.getCurrentpage().drotation,s.setdimoffset(!0),i.seteditaction(0)},this.MSPointerMove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.curmousepos=n;var d=o-n.x,p=l-n.y;if((r=Bs.getCurrentpage().getsnap(n)).found&&null!=r?(u=!0,sd(a,r)):(u=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(Bs.getCurrentpage().pan_update(d,p),s.setdimoffset(!1),o=n.x,l=n.y),s.started){if(Bn(n))if(u){if(0!=Bs.getCurrentpage().drotation)var g=rn(r);else g=r;i.x=s.x0,i.y=s.y0,i.w=g.x,i.h=g.y,c=g.x,h=g.y}else i.x=s.x0,i.y=s.y0,i.w=n.x,i.h=n.y,c=n.x,h=n.y;else i.x=s.x0,i.y=s.y0,i.w=c,i.h=h;a.clearRect(0,0,t.width,t.height),u&&sd(a,r),i.w-i.x!=0&&(s.setdimoffset(!1),i.drawme(a))}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation();var n=td(t,e);s.curmousepos=n;var d=o-n.x,p=l-n.y;(r=Bs.getCurrentpage().getsnap(n)).found&&null!=r?(u=!0,sd(a,r)):(u=!1,a.clearRect(0,0,t.width,t.height)),2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(d,p),s.setdimoffset(!1),o=n.x,l=n.y),s.started&&(Bn(n)?s.drawDimension(n):(i.x=s.x0,i.y=s.y0,i.w=c,i.h=h),a.clearRect(0,0,t.width,t.height),u&&sd(a,r),i.w-i.x!=0&&(s.setdimoffset(!1),i.drawme(a)))},this.touchmove=function(e){if(e.preventDefault(),s.started){var r=ed(t,e,0);Bn(r)?(i.x=s.x0,i.y=s.y0,i.w=r.x,i.h=r.y,o=r.x,l=r.y):(i.x=s.x0,i.y=s.y0,i.w=o,i.h=l),a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.drawme(a)}},this.MSPointerUp=function(e){},this.mouseup=function(e){},this.touchcancel=function(e){e.preventDefault(),s.started&&(s.started=!1,Cr||(gr=!0,Dr=Bs.markuplist.length),i.savemetolistDraw(),Hc(),i=null,Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}))},this.touchend=function(e){e.preventDefault(),s.started&&(s.started=!1,Cr||(gr=!0,Dr=Bs.markuplist.length),i.savemetolistDraw(),Hc(),i=null,Cr||null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1}))}},_s.getoverlayscale=function(e){var i=this,r=e.p1,s=e.p2;this.started=!1,this.points=[],this.pageobject=r,this.pageindex=s,this.name="getoverlayscale",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0};var n=document.createElement("canvas");n.width=30,n.height=30;var o=n.getContext("2d");o.strokeStyle="gray",o.lineWidth=1,o.strokeRect(0,0,30,30),o.beginPath(),o.moveTo(15,0),o.lineTo(15,14),o.moveTo(15,30),o.lineTo(15,16),o.moveTo(0,15),o.lineTo(14,15),o.moveTo(30,15),o.lineTo(16,15),o.closePath(),o.stroke();var l,c=0,h=0,u=!1;this.dialogfieldtext="",this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.getangleofline=function(e,t,a,i,r){var s=0,n=0;return r?(s=Math.abs(a-e),n=Math.abs(i-t)):(s=a-e,n=i-t),Math.atan2(n,s)},this.dialogtext=function(){var e=i.w-i.x,t=i.h-i.y,a=(i.x+i.w)/2,r=(i.y+i.h)/2;a-=i.pageobject.getdx(),r-=i.pageobject.getdy();var s=i.getdiag(e,t),n=i.getangleofline(i.x,i.y,i.w,i.h,!1),o=0,l=i.x-i.pageobject.getdx(),c=i.y-i.pageobject.getdy(),h=i.pageobject.getpagedim(),u=h.scale;if(i.distance=s,i.pageobject.usevectorxml&&null!=i.pageobject.VectorPageObj){var d=u*i.pageobject.VectorPageObj.width;i.pageobject.VectorPageObj.width,i.pageobject.VectorPageObj.height,l/=i.pageobject.dscalevector,c/=i.pageobject.dscalevector,a/=i.pageobject.dscalevector,r/=i.pageobject.dscalevector,o=i.distance/i.pageobject.dscalevector}else if(i.pageobject.usepdfjs){i.pageindex,d=i.pageobject.offscreenwidth;var p=i.pageobject.offscreenwidth*i.pageobject.dscalepdf;d=p;var g=p/i.pageobject.pdfpagewidth;i.pageobject.pdfpagewidth,i.pageobject.pdfpageheight,l/=g,c/=g,a/=g,r/=g,o=i.distance/g}else d=u*i.pageobject.MainImageWidth,i.pageobject.MainImageWidth,i.pageobject.MainImageHeight,l/=i.pageobject.dscale,c/=i.pageobject.dscale,a/=i.pageobject.dscale,r/=i.pageobject.dscale,o=i.distance/i.pageobject.dscale;var m={scaledDistance:o,pagedim:h,linecenter:{x:a,y:r}};null!=Ra&&Ra.AlignMeasure(i.distance,n,{x:l,y:c},d,m)},this.drawCross=function(e,a){e.clearRect(0,0,t.width,t.height),e.strokeStyle="gray",e.lineWidth=1,e.beginPath(),e.moveTo(0,a.y),e.lineTo(a.x-1,a.y),e.moveTo(a.x+1,a.y),e.lineTo(t.width,a.y),e.moveTo(a.x,0),e.lineTo(a.x,a.y-1),e.moveTo(a.x,a.y+1),e.lineTo(a.x,t.height),e.closePath(),e.stroke()},this.draw=function(e){var t=Ar,a=22.5/(180/Math.PI),r=i.w-i.x,s=i.h-i.y;Math.atan2(s,r),Math.abs(t/Math.cos(a)),e.strokeStyle="blue",e.lineWidth=2,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.strokeRect(this.x-15,this.y-15,30,30),e.beginPath(),e.moveTo(this.x,this.y-15),e.lineTo(this.x,this.y-1),e.moveTo(this.x,this.y+15),e.lineTo(this.x,this.y+1),e.moveTo(this.x-15,this.y),e.lineTo(this.x-1,this.y),e.moveTo(this.x+15,this.y),e.lineTo(this.x+1,this.y),e.closePath(),e.stroke(),e.strokeRect(this.w-15,this.h-15,30,30),e.beginPath(),e.moveTo(this.w,this.h-15),e.lineTo(this.w,this.h-1),e.moveTo(this.w,this.h+15),e.lineTo(this.w,this.h+1),e.moveTo(this.w-15,this.h),e.lineTo(this.w-1,this.h),e.moveTo(this.w+15,this.h),e.lineTo(this.w+1,this.h),e.closePath(),e.stroke()},this.scrollhandling=function(e){if(Ka&&!Bs.getCurrentpage().usevector3Dxml)if(e<0)if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked)Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e);else{Bs.getCurrentpage().ZoomOut(1.1,!1,!1);var a=Bs.getCurrentpage().getdscale(),r=Bs.getCurrentpage().getdx(),s=Bs.getCurrentpage().getdy();if(i.started){var n=a/i.orgscale,o=(i.startx-i.orgdx)*n,l=(i.starty-i.orgdy)*n;o+=r,l+=s,i.x=o,i.y=l}}else Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1&&!Bs.pagelocked?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1),a=Bs.getCurrentpage().getdscale(),r=Bs.getCurrentpage().getdx(),s=Bs.getCurrentpage().getdy(),i.started&&(n=a/i.orgscale,o=(i.startx-i.orgdx)*n,l=(i.starty-i.orgdy)*n,o+=r,l+=s,i.x=o,i.y=l))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){var r=td(t,e);if(null!=Bs&&null!=Bs)if(0==e.button)if(i.started)u?(s=0!=Bs.getCurrentpage().drotation?rn(l):l,i.w=s.x,i.h=s.y):(i.w=r.x,i.h=r.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair",i.started=!0,u){if(0!=Bs.getCurrentpage().drotation)var s=rn(l);else s=l;i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y}else i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y;i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else c=r.x,h=r.y},this.mousedown=function(e){var r=td(t,e);if(0==e.button)if(i.started)u?(s=0!=Bs.getCurrentpage().drotation?rn(l):l,i.w=s.x,i.h=s.y):(i.w=r.x,i.h=r.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+n.toDataURL()+")15 15, auto",i.started=!0,u){if(0!=Bs.getCurrentpage().drotation)var s=rn(l);else s=l;i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y}else i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y;i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else c=r.x,h=r.y},this.touchstart=function(e){if(!i.started){var a=ed(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y,i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy()}},this.MSPointerMove=function(e){var r=td(t,e);i.curmousepos=r,e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var s=c-r.x,n=h-r.y;if((l=Bs.getCurrentpage().getsnap(r)).found?(u=!0,sd(a,l)):(u=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(Bs.getCurrentpage().pan_update(s,n),c=r.x,h=r.y),i.started){if(u){if(0!=Bs.getCurrentpage().drotation)var o=rn(l);else o=l;i.w=o.x,i.h=o.y}else i.w=r.x,i.h=r.y;a.clearRect(0,0,t.width,t.height),2==e.buttons&&(i.x-=s,i.y-=n),i.w-i.x!=0&&i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+n.toDataURL()+")15 15, auto";var r=td(t,e);i.curmousepos=r,i.drawCross(a,r);var s=c-r.x,o=h-r.y;if((l=Bs.getCurrentpage().getsnap(r)).found?(u=!0,sd(a,l)):u=!1,2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(s,o),c=r.x,h=r.y),i.started){if(u){if(0!=Bs.getCurrentpage().drotation)var d=rn(l);else d=l;i.w=d.x,i.h=d.y}else i.w=r.x,i.h=r.y;a.clearRect(0,0,t.width,t.height),2!=e.button&&2!=e.buttons||(i.x-=s,i.y-=o),i.w-i.x!=0&&i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var r=ed(t,e,0);i.curmousepos=r,i.w=r.x,i.h=r.y,a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))}},_s.calibrate=function(){var e,i=this,r=0,s=0,n=!1;this.started=!1,this.name="calibrate",this.anglelengthsupport=!1,this.refreshSupport=!1,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.startx=0,this.starty=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0},this.dialogfieldtext="",_u(Yu("calibrate")),this.scrollhandling=function(e){Ka&&!Bs.getCurrentpage().usevector3Dxml&&(e<0?Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos),i.started&&i.setdimoffset(!1)):Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos),i.started&&i.setdimoffset(!1)))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.setdimoffset=function(e){e&&(i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y);var t=Bs.getCurrentpage().getdscale(),a=Bs.getCurrentpage().getdx(),r=Bs.getCurrentpage().getdy(),s=t/i.orgscale;if(i.started){var n=(i.startx-i.orgdx)*s,o=(i.starty-i.orgdy)*s;n+=a,o+=r,i.x=n,i.y=o}},this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.dialogtext=function(){var e=i.w-i.x,t=i.h-i.y,a=i.getdiag(e,t),r=Bs.getCurrentpage().getMeasureScale();Or=1,i.distance=ko(a/Ln()),Bs.getCurrentpage().setMeasureScaledirect(1),Vr=ko(a/Ln()),Bs.getCurrentpage().setMeasureScaledirect(r),Or=r},this.draw=function(e){var t=Bs.getCurrentpage().getdscale()/Bs.getCurrentpage().fixedScale,a=Ar*t,r=22.5/(180/Math.PI),s=i.w-i.x,n=i.h-i.y,o=Math.atan2(n,s),l=Math.abs(a/Math.cos(r)),c=Math.PI+o,h=c+r,u=c-r,d=this.w+Math.cos(h)*l,p=this.h+Math.sin(h)*l,g=this.w+Math.cos(u)*l,m=this.h+Math.sin(u)*l,f=o+r,y=o-r,v=this.x+Math.cos(f)*l,b=this.y+Math.sin(f)*l,x=this.x+Math.cos(y)*l,w=this.y+Math.sin(y)*l;"#000000"==Bs.backgroundColor?e.strokeStyle="white":e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(v,b),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(x,w),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.w,this.h),e.lineTo(d,p),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(this.w,this.h),e.lineTo(g,m),e.closePath(),e.stroke()},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(o){var l=td(t,o);if(0==o.button)if(i.started)n?(c=0!=Bs.getCurrentpage().drotation?rn(e):e,i.w=c.x,i.h=c.y):(i.w=l.x,i.h=l.y),i.started=!1,i.dialogtext(),null!=Vt&&Vt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height);else{if(o.preventDefault(),o.stopPropagation(),i.started=!0,n){if(0!=Bs.getCurrentpage().drotation)var c=rn(e);else c=e;i.x=c.x,i.y=c.y,i.w=c.x,i.h=c.y}else i.x=l.x,i.y=l.y,i.w=l.x,i.h=l.y;i.setdimoffset(!0)}else r=l.x,s=l.y},this.mousedown=function(o){var l=td(t,o);if(0==o.button)if(i.started)n?(c=0!=Bs.getCurrentpage().drotation?rn(e):e,i.w=c.x,i.h=c.y):(i.w=l.x,i.h=l.y),i.started=!1,i.dialogtext(),null!=Vt&&Vt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height);else{if(o.preventDefault(),o.stopPropagation(),i.started=!0,n){if(0!=Bs.getCurrentpage().drotation)var c=rn(e);else c=e;i.x=c.x,i.y=c.y,i.w=c.x,i.h=c.y}else i.x=l.x,i.y=l.y,i.w=l.x,i.h=l.y;i.setdimoffset(!0)}else r=l.x,s=l.y},this.touchstart=function(e){if(!i.started){var a=ed(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y}},this.MSPointerMove=function(o){var l=td(t,o);o.preventDefault(),o.stopPropagation(),i.curmousepos=l;var c=r-l.x,h=s-l.y;if((e=Bs.getCurrentpage().getsnap(l)).found&&null!=e?(n=!0,sd(a,e)):(n=!1,a.clearRect(0,0,t.width,t.height)),2==o.buttons&&(Bs.getCurrentpage().pan_update(c,h),r=l.x,s=l.y),i.started){if(n){if(0!=Bs.getCurrentpage().drotation)var u=rn(e);else u=e;i.w=u.x,i.h=u.y}else i.w=l.x,i.h=l.y;a.clearRect(0,0,t.width,t.height),2==o.buttons&&(i.x-=c,i.y-=h),i.setdimoffset(!1),sd(a,e),i.draw(a)}},this.mousemove=function(o){o.preventDefault(),o.stopPropagation();var l=td(t,o);i.curmousepos=l;var c=r-l.x,h=s-l.y;if((e=Bs.getCurrentpage().getsnap(l)).found&&null!=e?(n=!0,sd(a,e)):(n=!1,a.clearRect(0,0,t.width,t.height)),2!=o.button&&2!=o.buttons||(Bs.getCurrentpage().pan_update(c,h),r=l.x,s=l.y),i.started){if(n){if(0!=Bs.getCurrentpage().drotation)var u=rn(e);else u=e;i.w=u.x,i.h=u.y}else i.w=l.x,i.h=l.y;a.clearRect(0,0,t.width,t.height),2!=o.button&&2!=o.buttons||(i.x-=c,i.y-=h),i.setdimoffset(!1),sd(a,e),i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var r=ed(t,e,0);i.w=r.x,i.h=r.y,a.clearRect(0,0,t.width,t.height),i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),null!=Vt&&Vt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),null!=Vt&&Vt.setCalibrate(i.distance),a.clearRect(0,0,t.width,t.height))}},_s.overlayscale=function(e){var i=this,r=e.p1;this.started=!1,this.points=[],this.compareref=r,this.name="overlayscale",this.anglelengthsupport=!1,this.refreshSupport=!1,this.startx=0,this.starty=0,this.x=0,this.y=0,this.w=0,this.h=0,this.distance=0,this.orgscale=1,this.orgdx=0,this.orgdy=0,this.curmousepos={x:0,y:0,xus:0,yus:0};var s=document.createElement("canvas");s.width=30,s.height=30;var n=s.getContext("2d");n.strokeStyle="gray",n.lineWidth=1,n.strokeRect(0,0,30,30),n.beginPath(),n.moveTo(15,0),n.lineTo(15,14),n.moveTo(15,30),n.lineTo(15,16),n.moveTo(0,15),n.lineTo(14,15),n.moveTo(30,15),n.lineTo(16,15),n.closePath(),n.stroke();var o,l=0,c=0,h=!1;this.dialogfieldtext="",this.getdiag=function(e,t){var a=Math.pow(e,2),i=Math.pow(t,2);return Math.sqrt(a+i)},this.dialogtext=function(){var e=Bs.getCurrentpage().scaleObject.Unitlabel;Unit=e;var t=i.w-i.x,a=i.h-i.y,r=i.getdiag(t,a),s=i.x-i.compareref.pages[i.compareref.scaleindex].getdx(),n=i.y-i.compareref.pages[i.compareref.scaleindex].getdy(),o=i.compareref.pages[i.compareref.scaleindex].getdscale();if(i.distance=r,i.compareref.pages[i.compareref.scaleindex].usevectorxml&&null!=i.compareref.pages[i.compareref.scaleindex].VectorPageObj){var l=o*i.compareref.pages[i.compareref.scaleindex].VectorPageObj.width;s/=i.compareref.pages[i.compareref.scaleindex].dscalevector,n/=i.compareref.pages[i.compareref.scaleindex].dscalevector}else if(i.compareref.pages[i.compareref.scaleindex].usepdfjs){switch(i.compareref.scaleindex){case 0:var c=i.compareref.backgroundgpage.getPageScale();l=i.compareref.backgroundgpage.getwidth();break;case 1:c=i.compareref.overlaypage.getPageScale(),l=i.compareref.overlaypage.getwidth()}s/=c,n/=c}else l=o*i.compareref.pages[i.compareref.scaleindex].MainImageWidth,s/=i.compareref.pages[i.compareref.scaleindex].dscale,n/=i.compareref.pages[i.compareref.scaleindex].dscale;i.compareref.setdistance(i.distance,{x:s,y:n},l)},this.draw=function(e){e.strokeStyle="blue",e.lineWidth=2,e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.w,this.h),e.closePath(),e.stroke(),e.strokeRect(this.x-15,this.y-15,30,30),e.beginPath(),e.moveTo(this.x,this.y-15),e.lineTo(this.x,this.y-1),e.moveTo(this.x,this.y+15),e.lineTo(this.x,this.y+1),e.moveTo(this.x-15,this.y),e.lineTo(this.x-1,this.y),e.moveTo(this.x+15,this.y),e.lineTo(this.x+1,this.y),e.closePath(),e.stroke(),e.strokeRect(this.w-15,this.h-15,30,30),e.beginPath(),e.moveTo(this.w,this.h-15),e.lineTo(this.w,this.h-1),e.moveTo(this.w,this.h+15),e.lineTo(this.w,this.h+1),e.moveTo(this.w-15,this.h),e.lineTo(this.w-1,this.h),e.moveTo(this.w+15,this.h),e.lineTo(this.w+1,this.h),e.closePath(),e.stroke()},this.scrollhandling=function(e){if(Ka&&!Bs.getCurrentpage().usevector3Dxml)if(e<0)if(Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1)Bs.currentpage==Bs.NumPages-1&&Bs.getCurrentpage().endy<=t.height&&(e=0),Bs.getCurrentpage().pan_update(0,-e);else{Bs.getCurrentpage().ZoomOut(1.1,!1,!1,i.curmousepos);var a=Bs.getCurrentpage().getdscale(),r=Bs.getCurrentpage().getdx(),s=Bs.getCurrentpage().getdy();if(i.started){var n=a/i.orgscale,o=(i.startx-i.orgdx)*n,l=(i.starty-i.orgdy)*n;o+=r,l+=s,i.x=o,i.y=l}}else Bs.getCurrentpage().usepdfjs&&Bs.pages.length>1?(0==Bs.currentpage&&Bs.getCurrentpage().starty>=0&&(e=0),Bs.getCurrentpage().pan_update(0,-e)):(Bs.getCurrentpage().ZoomIn(1.1,!1,!1,i.curmousepos),a=Bs.getCurrentpage().getdscale(),r=Bs.getCurrentpage().getdx(),s=Bs.getCurrentpage().getdy(),i.started&&(n=a/i.orgscale,o=(i.startx-i.orgdx)*n,l=(i.starty-i.orgdy)*n,o+=r,l+=s,i.x=o,i.y=l))},this.wheel=function(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.deltaY&&(t=50*-e.deltaY),i.scrollhandling(t)},this.pointermove=function(e){i.MSPointerMove(e)},this.pointerdown=function(e){i.MSPointerDown(e)},this.pointerup=function(e){i.MSPointerUp(e)},this.MSPointerDown=function(e){var r=td(t,e);if(0==e.button)if(i.started)h?(s=0!=Bs.getCurrentpage().drotation?rn(o):o,i.w=s.x,i.h=s.y):(i.w=r.x,i.h=r.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair",i.started=!0,h){if(0!=Bs.getCurrentpage().drotation)var s=rn(o);else s=o;i.x=s.x,i.y=s.y,i.w=s.x,i.h=s.y}else i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y;i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else l=r.x,c=r.y},this.mousedown=function(e){var r=td(t,e);if(0==e.button)if(i.started)h?(n=0!=Bs.getCurrentpage().drotation?rn(o):o,i.w=n.x,i.h=n.y):(i.w=r.x,i.h=r.y),i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height),e.target.style.cursor="default";else{if(e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+s.toDataURL()+")15 15, auto",i.started=!0,h){if(0!=Bs.getCurrentpage().drotation)var n=rn(o);else n=o;i.x=n.x,i.y=n.y,i.w=n.x,i.h=n.y}else i.x=r.x,i.y=r.y,i.w=r.x,i.h=r.y;i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy(),i.startx=i.x,i.starty=i.y}else l=r.x,c=r.y},this.touchstart=function(e){if(!i.started){var a=ed(t,e,0);i.started=!0,i.x=a.x,i.y=a.y,i.w=a.x,i.h=a.y,i.orgscale=Bs.getCurrentpage().getdscale(),i.orgdx=Bs.getCurrentpage().getdx(),i.orgdy=Bs.getCurrentpage().getdy()}},this.MSPointerMove=function(e){var r=td(t,e);e.preventDefault(),e.stopPropagation(),e.target.style.cursor="crosshair";var s=l-r.x,n=c-r.y;if((o=Bs.getCurrentpage().getsnap(r)).found?(h=!0,sd(a,o)):(h=!1,a.clearRect(0,0,t.width,t.height)),2==e.buttons&&(Bs.getCurrentpage().pan_update(s,n),l=r.x,c=r.y),i.started){if(h){if(0!=Bs.getCurrentpage().drotation)var u=rn(o);else u=o;i.w=u.x,i.h=u.y}else i.w=r.x,i.h=r.y;a.clearRect(0,0,t.width,t.height),2==e.buttons&&(i.x-=s,i.y-=n),i.w-i.x!=0&&i.draw(a)}},this.mousemove=function(e){e.preventDefault(),e.stopPropagation(),e.target.style.cursor="url("+s.toDataURL()+")15 15, auto";var r=td(t,e),n=l-r.x,u=c-r.y;if((o=Bs.getCurrentpage().getsnap(r)).found?(h=!0,sd(a,o)):(h=!1,a.clearRect(0,0,t.width,t.height)),2!=e.button&&2!=e.buttons||(Bs.getCurrentpage().pan_update(n,u),l=r.x,c=r.y),i.started){if(h){if(0!=Bs.getCurrentpage().drotation)var d=rn(o);else d=o;i.w=d.x,i.h=d.y}else i.w=r.x,i.h=r.y;a.clearRect(0,0,t.width,t.height),2!=e.button&&2!=e.buttons||(i.x-=n,i.y-=u),i.w-i.x!=0&&i.draw(a)}},this.touchmove=function(e){if(e.preventDefault(),i.started){var r=ed(t,e,0);i.w=r.x,i.h=r.y,a.clearRect(0,0,t.width,t.height),i.w-i.x!=0&&i.draw(a)}},this.MSPointerUp=function(){i.started},this.mouseup=function(){i.started},this.touchcancel=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))},this.touchend=function(e){e.preventDefault(),i.started&&(i.started=!1,i.dialogtext(),a.clearRect(0,0,t.width,t.height))}},function(){(e=null!=p?document.getElementById(p):document.getElementById("rxcontainer")).className=null!=g?g:"rxcontainer";const d=ll();if((navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i))&&(lr=!0,sr=16777216),i=document.createElement("canvas"),null!=p?(i.id=p+"rxcanvas",i.className="rxcanvas"):i.id="rxcanvas",i)if(i.innerHTML="<p>Unfortunately, your browser is currently unsupported by our web \n",i.innerHTML+="application.  We are sorry for the inconvenience. Please use one of the\n",i.innerHTML+="supported browsers listed below, or draw the image you want using an\n",i.innerHTML+="offline tool.</p>\n",i.innerHTML+="<p>Supported browsers: <a href='http://www.opera.com'>Opera</a>,\n",i.innerHTML+="<a href='http://www.mozilla.com'>Firefox</a>,\n",i.innerHTML+="<a href='http://www.apple.com/safari'>Safari</a>, and\n",i.innerHTML+="<a href='https://www.google.com/chrome'>Chrome</a>.</p>",fd(),e.appendChild(i),i.getContext)if(i.oncontextmenu=function(){return!1},r=i.getContext("2d")){r.scale(d,d),gd(!1);var m=i.parentNode;if(function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?((u=new THREE.WebGLRenderer({alpha:!0,antialias:!0,precision:"highp",preserveDrawingBuffer:!0})).clippingPlanes=ye,u.localClippingEnabled=!1,null!=p?(u.domElement.id=p+"canv3D",u.domElement.className="canv3D"):u.domElement.id="canv3D",console.log("webgl enabled"),u.physicallyCorrectLights=!0):(console.log("webgl not available"),console.log("No 3D support")),m.appendChild(u.domElement),u.domElement.oncontextmenu=function(){return!1},u.setSize(Na,Aa),u.setPixelRatio(d),u.domElement.style.visibility="hidden",s=document.createElement("canvas"))if(null!=p?(s.id=p+"imageDisp",s.className="imageDisp"):s.id="imageDisp",md(s,Ba,Ua),m.appendChild(s),s.oncontextmenu=function(){return!1},(n=s.getContext("2d")).scale(d,d),t=document.createElement("canvas"))if(null!=p?(t.id=p+"imageTemp",t.className="imageTemp"):t.id="imageTemp",md(t,Ba,Ua),m.appendChild(t),t.oncontextmenu=function(){return!1},(a=t.getContext("2d")).scale(d,d),o=document.createElement("canvas")){var f,y;null!=p?(o.id=p+"imagemag",o.className="imagemag"):o.id="imagemag",be.width=be.width/d,be.height=be.height/d,md(o,be.width,be.height),m.appendChild(o),o.oncontextmenu=function(){return!1},(l=o.getContext("2d")).scale(d,d),l.fillStyle="white",l.fillRect(0,0,be.width,be.height),o.style.visibility="hidden",(c=document.createElement("canvas"))||alert("Error: I cannot create a new canvas element!"),h=c.getContext("2d"),J||(f=z,(y=zs).addEventListener("load",Wc,!1),y.src=f,function e(){Ja?function(){Ya=zs.width,qa=zs.height,Ya=zs.naturalWidth,qa=zs.naturalHeight;var e=Aa/qa,t=Na/Ya,a=Math.min(t,e),r=(Na-Ya*a)/2,s=(i.height-qa*a)/2;Ka||(zc(zs,r,s,a),yd(!0))}():window.setTimeout(e,500)}()),t.addEventListener("touchstart",od,!1),u.domElement.addEventListener("touchstart",od,!1),t.addEventListener("touchmove",od,!0),u.domElement.addEventListener("touchmove",od,!0),t.addEventListener("touchend",od,!1),t.addEventListener("touchcancel",od,!1),u.domElement.addEventListener("touchend",od,!1),u.domElement.addEventListener("touchcancel",od,!1),t.addEventListener("dbltap",od,!1),t.addEventListener("dblclick",od,!1),window.addEventListener("keydown",od,!0),window.addEventListener("keyup",od,!0),window.addEventListener("keypress",od,!0),t.addEventListener("wheel",od,!0),t.addEventListener("mousewheel",od,!0),u.domElement.addEventListener("wheel",od,!0),u.domElement.addEventListener("mousewheel",od,!0),t.addEventListener("DOMMouseScroll",od,!0),u.domElement.addEventListener("DOMMouseScroll",od,!0),u.domElement.addEventListener("drop",od,!1),u.domElement.addEventListener("dragover",od,!1),t.addEventListener("drop",od,!1),t.addEventListener("dragover",od,!1),Ri?(t.addEventListener("mousemove",od,!1),u.domElement.addEventListener("mousemove",od,!1),t.addEventListener("mousedown",od,!1),u.domElement.addEventListener("mousedown",od,!1),t.addEventListener("mouseup",od,!1),u.domElement.addEventListener("mouseup",od,!1),t.addEventListener("mouseout",od,!1),u.domElement.addEventListener("mouseout",od,!1)):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerMove",od,!1),u.domElement.addEventListener("MSPointerMove",od,!1),t.addEventListener("MSPointerDown",od,!1),u.domElement.addEventListener("MSPointerDown",od,!1),t.addEventListener("MSPointerUp",od,!1),u.domElement.addEventListener("MSPointerUp",od,!1),t.addEventListener("MSPointerOut",od,!1),u.domElement.addEventListener("MSPointerOut",od,!1)):(t.addEventListener("mousemove",od,!1),u.domElement.addEventListener("mousemove",od,!1),t.addEventListener("mousedown",od,!1),u.domElement.addEventListener("mousedown",od,!1),t.addEventListener("mouseup",od,!1),u.domElement.addEventListener("mouseup",od,!1),t.addEventListener("mouseout",od,!1),u.domElement.addEventListener("mouseout",od,!1)),_?(""!=(js=location.search)&&(Is=!0),q&&function(){if(null==E)return!1;if(null==Z)return!1;var e=JSON.stringify(Z);return Jc("POST",E,e).then((function(e){dd(e)})).catch((function(e){e.status?console.log(e.status):console.log(e)})),!0}()||Rc(Y)):(Zn(),ts=["Approved","Draft","Received","Rejected","Reviewed","Revised","Date","User Name"],null!=It&&It.setMarkupStamps(ts),es[0]=new Dn(hs,us,rs,ss),re=!0,Mc())}else alert("Error: I cannot create a new canvas element!");else alert("Error: I cannot create a new canvas element!");else alert("Error: I cannot create a new canvas element!")}else alert("Error: failed to getContext!");else alert("Error: no canvas.getContext!");else alert("Error: I cannot find the canvas element!")}(),function e(){requestAnimationFrame(e),Rr&&!$a&&Si&&Bs.draw_mpagepdf(),Er&&(10==++Tr&&ku(5,!1),20==Tr&&(ku(6,!1),Tr=0),!Sr)||Ka&&!Qa&&null!=Bs.getCurrentpage()&&Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj&&(u.render(Bs.getCurrentpage().Vector3DPageObj.scene,Bs.getCurrentpage().camera),ti&&Bs.getCurrentpage().Vector3DPageObj.renderMarkupPoints(n),Bs.getCurrentpage().walkthroughcontrol.update&&"Walkthrough3D"==Bs.curcontrol3D&&Bs.getCurrentpage().walkthroughcontrol.update())}()};"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?m():document.addEventListener("DOMContentLoaded",m),window.addEventListener("resize",(function(){ve.absolute||yd(!0)}),!1)}},insertPoint:function(){"markupedit"==As.name&&As.enablePointInsert()},instanceReset:function(){ie=!1},keepvectorColor:function(e){Bs.getCurrentpage().usevectorxml&&(yi=!Bs.getCurrentpage().getPenTableState()&&e)},limitZoomOut:function(e){Ci=e},loadIFCSpaces:function(){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().loadGLTFSpaces()},loadThumbnails:function(){if(Ka){for(var e=0;e<Bs.thumbnails.length;e++)Bs.thumbnails[e].thumbnailobj.source=Bs.thumbnails[e].ThumbnailImageSRC,Bs.thumbnails[e].thumbloaded=!0,Bs.thumbnails[e].thumbload();null!=st&&st.setThumbnails(Bs.thumbnails)}},loadThumbnail:function(e){jh()||Bs.loadThumbnail(e)},lockMarkupbyGUID:function(e,t){if(Ka)for(var a=0;a<Xs.length;a++)Xs[a].lockMarkupbyGUID(e,t)},lockMarkup:function(e){jh()||(Bs.bMarkupLocked=e)},loadMarkupJSON:function(e,t,a){if(!jh()&&null!=x){null==a&&(a=Bs);var i=[{Command:"GetMarkup",LicenseID:_i,FileName:t,Folder:e}],r=JSON.stringify(i);Jc("POST",x,r).then((function(e){bu(e,a)})).catch((function(e){e.status?404==e.status?console.log("Get Markup failed, error 404"):503==e.status?console.log("Get Markup failed, error 503"):console.log(e.status):console.log(e)}))}},magnifyGlass:function(e){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||(Ho(),Uo(),e?(o.addEventListener("mousemove",od,!1),o.addEventListener("mousedown",od,!1),o.addEventListener("mouseup",od,!1),o.addEventListener("mouseout",od,!1),o.addEventListener("wheel",od,!1),nd("magnify",{})):(o.style.visibility="hidden",o.removeEventListener("mousemove",od,!1),o.removeEventListener("mousedown",od,!1),o.removeEventListener("mouseup",od,!1),o.removeEventListener("mouseout",od,!1),o.removeEventListener("wheel",od,!1),nd("markupedit",{p1:!1}))))},markupAddBlockText:function(e,t,a,i){if(Ka&&!ws&&!$a){if(Bs.getCurrentpage().usevectorxml){var r=Bs.getCurrentpage().getBlockCentroid(e),s=.75*Bs.getCurrentpage().getpixeldist(t),o=new Fo(9,1,0);o.scaling=Bs.getCurrentpage().getdscale(),o.xoffset=Bs.getCurrentpage().getdx(),o.yoffset=Bs.getCurrentpage().getdy(),o.font.setFontname(tn.fontName),o.font.setHeight(s),o.font.setBold(tn.bold),o.font.setItalic(tn.italic);var l=function(e,t,a){var i=0,r=a.height,s=t.split("\n");e.save(),e.font=a.fontstringScaled;for(var n=0;n<s.length;n++){var o=e.measureText(s[n]);i<o.width&&(i=o.width)}return r=r*n+r/2*n,i+=10,e.restore(),{w:i,h:r}}(n,a,o.font);o.linewidth=.5,o.w=l.w,o.h=l.h,o.x=r.x-o.w/2,o.y=r.y-o.h/2,o.text=a,o.fillcolor="rgba(255,255,255, 0.9)",o.textcolor=i,o.strokecolor=i,o.pagerotation=Bs.getCurrentpage().drotation,o.pagenumber=Bs.getcurPage(),o.viewname=Bs.getcur3DView(),null!=o.viewname&&(o.bfor3D=!0,o.pageheight=Aa,o.pagewidth=Na),o.savemetolistDraw()}al(n)}},markupAddMulti:function(e){Cr=e},markupAngleSwitch:function(){jh()||ws||No(18)},markUpArea:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("area",{p1:8,p2:0}):nd("markupedit",{p1:!1})))},markUpAreaHole:function(e){if(!jh()&&!ws&&!$a){var t=Oo();if(t.isempty||8!=t.type)return nd("markupedit",{p1:!1}),Ho(),void Uo();Ho(),Uo(),e?nd("area",{p1:8,p2:2,p3:t}):nd("markupedit",{p1:!1})}},markupAreaRect:function(e){jh()||ws||$a||(Ho(),Uo(),e?nd("measure",{p1:3,p2:6}):nd("markupedit",{p1:!1}))},markupRectToAreaSwitch:function(e){jh()||ws||$a||(mu(),function(e){var t=8,a=0,i=e.rotatedrect,r={x:i.x,y:i.y},s=new Fo(t,a,ms);s.pagenumber=Bs.getcurPage(),s.viewname=Bs.getcur3DView(),null!=s.viewname&&(s.bfor3D=!0,s.pageheight=Aa,s.pagewidth=Na);var o={scale:void 0,xoffset:void 0,yoffset:void 0};o.scale=Ln();var l=jn();o.xoffset=l.x,o.yoffset=l.y,s.scaling=o.scale,s.xoffset=o.xoffset,s.yoffset=o.yoffset,s.x=r.x,s.y=r.y,s.seteditaction(0),Bs&&(Bs.bMarkupchanged=!0),function(e,t){if(null==t)return;let a=e.rotatedrect,i=[{x:a.x,y:a.y},{x:a.x+a.w,y:a.y},{x:a.x+a.w,y:a.y+a.h},{x:a.x,y:a.y+a.h}];t.points=i,t.findrectangle(),Cr||(gr=!0),Dr=Bs.markuplist.length,t.savemetolistDraw(),t.saved,t=null,Hc(),al(n),zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}(e,s)}(e))},markUpArrow:function(e,t){Ka&&(ws||$a||(Ho(),Uo(),e?nd("arrow",{p1:t}):nd("markupedit",{p1:!1})))},markupButton:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("symbol",{p1:3}):nd("markupedit",{p1:!1})))},markupChanged:function(){if(!jh())return!(!Bs.bMarkupchanged||ws)},markupCircle:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("arrow",{p1:10}):nd("markupedit",{p1:!1})))},markupCount:function(e,t){Ka&&(ws||$a||(Ho(),Uo(),e?("count"==As.name&&As.started&&As.apply(),nd("count",{p1:13,p2:t})):("count"==As.name&&As.started&&As.apply(),nd("markupedit",{p1:!1}))))},markUpDimension:function(e,t){Ka&&(ws||$a||jh()||(Ho(),Uo(),e?Bs.getCurrentpage().usevector3Dxml?Xu(e,"measure3D",null):nd("measure",{p1:t}):Bs.getCurrentpage().usevector3Dxml?Xu(e,"measure3D",null):nd("markupedit",{p1:!1})))},markupDisplay:function(e){jh()||ws||No(e?15:14)},markUpEdged:function(){if(Ka&&!ws&&!$a){var e=ms;ms=2,No(3),xs||(ms=e)}},markUpErase:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("pencil",{p1:1}):("pencil"==As.name&&As.started&&As.apply(),nd("markupedit",{p1:!1}))))},markUpFilled:function(e){if(Ka&&!ws&&!$a){var t=ms;ms=1,e?Vo(e,3):No(3),xs||(ms=t)}},markUpFreePen:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("pencil",{p1:0}):("pencil"==As.name&&As.started&&As.apply(),nd("markupedit",{p1:!1}))))},markUpHatched:function(){if(Ka&&!ws&&!$a){var e=ms;ms=3+gs,No(3),xs||(ms=e)}},markUpHighlight:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("rect",{p1:3,p2:3,redact:!1}):nd("markupedit",{p1:!1})))},markuphoverevent:function(e){Fi=e},markUpLayerDialog:function(){Ka&&($a||null!=Fe&&Fe.setMarkupLayers(as))},markupLine:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("arrow",{p1:9}):nd("markupedit",{p1:!1})))},markupLinkRect:function(e,t,a,i,r){if(Ka&&!ws&&!$a){Ho(),Uo();var s=0;e&&(s=3);var o=new Fo(3,s,0);e&&(o.transparency=30,o.fillcolor=hn(o.fillcolor,o.transparency)),o.scaling=Ln();var l,c=jn();o.xoffset=c.x,o.yoffset=c.y,o.pagenumber=a,o.viewname=(l=null,jh()||Bs.getCurrentpage().usevector3Dxml&&(l=Bs.getCurrentpage().getcur3DView()),l),null!=o.viewname&&(o.bfor3D=!0,o.pageheight=Aa,o.pagewidth=Na),r?(o.x=t.x-r.left,o.y=t.y-r.top,o.w=t.w+r.right,o.h=t.h+r.bottom):(o.x=t.x,o.y=t.y,o.w=t.w,o.h=t.h),o.savemetolistDraw(),i&&""!=i&&o.setLink(i,!0),Hc(),al(n),o=null}},markupAngle:function(e,t){jh()||ws||$a||(Ho(),Uo(),e?nd("area",t?{p1:1,p2:5}:{p1:1,p2:4}):nd("markupedit",{p1:!1}))},markupMeasurePath:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("area",{p1:1,p2:3}):nd("markupedit",{p1:!1})))},markupMeasureSegment:function(e){jh()||ws||$a||(Ho(),Uo(),e?nd("area",{p1:1,p2:6}):(6==As.subtype&&As.started&&As.apply(),nd("markupedit",{p1:!1})))},markupMultiselect:function(e){$i=e},multiselect3Dpart:function(e){tr=e},markUpNote:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("note",{}):nd("markupedit",{p1:!1})))},markUpOutlined:function(e){if(Ka&&!ws&&!$a){var t=ms;ms=0,e?Vo(e,3):No(3),xs||(ms=t)}},markUpPolycurve:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("Polycurve",{p1:1}):nd("markupedit",{p1:!1})))},markUpPolyline:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("area",{p1:1,p2:1}):nd("markupedit",{p1:!1})))},markUpRedraw:Zh,redactRect:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("rect",{p1:3,p2:4,redact:!0}):nd("markupedit",{p1:!1})))},markUpRotate:function(e){if(!jh()&&!ws){var t=Oo();t.isempty||(t.rotation=e*(Math.PI/180)),al(n),il(a)}},markUpSave:function(e){jh()||Ka&&(ws||$a||(Bs.getCurrentpage().usevector3Dxml?(e||(Ho(),Uo()),Sc(b,hs,us)):(e||(Ho(),Uo()),Bs.bLargePDF?Pc(b,hs,us):Sc(b,hs,us))))},markupGetJSON:function(e){jh()||ws||$a||(e||(Ho(),Uo()),Bs.bLargePDF?function(e,t){var a=new Zs(Bs);a.setOncomplete((function(e){Ft.setMarkupList(e,Bs.bActive)})),a.createjson(e,t)}(hs,us):function(e,t){if(!jh()){var a=wc(!0,!1,!0,e);Ft.setMarkupList(a,Bs.bActive)}}(hs))},markupSaveJSON:function(e,t){if(!jh()&&null!=x){var a=kc(!0,!1,!1,hs,us),i=(new XMLSerializer).serializeToString(a),r=window.btoa(i),s=[{Command:"SaveMarkup",LicenseID:_i,OutputName:t,DestFolder:e,MarkupData:r}],n=JSON.stringify(s);Kc("POST",x,"",n).then((function(e){null!=ga&&ga.markupSaved()})).catch((function(e){e.status?404==e.status?console.log("Markup save failed, error 404"):503==e.status?console.log("Markup save failed, error 503"):console.log(e.status):console.log(e)}))}},setMarkupfromJSON:function e(t,a){null!=a&&null!=a||(a=Bs);var i=!1,r=!1,s=!1,o=JSON.parse(t);null!=o.operation?o.operation.created?i=!0:o.operation.deleted?r=!0:s=!0:s=!0;var l=o.Entity.Type,c=o.Entity.Subtype,h=o.Entity.Alternative;if(i){if(null!=o.Entity.Signature){var u=o.Entity.Signature;es[0].Signature!=u&&(ss=as[o.Entity.Layer].Color,es.push(new Dn(u,o.Entity.Name,o.Entity.Layer,ss,!1)))}var d=o.Entity.ID?o.Entity.ID:null,p=9==l&&2==c;if(null!=o.Entity.HaveLeader)var g=1==o.Entity.HaveLeader;if((g||p)&&null!=o.Entity.Entity){var m=(E=o.Entity.Entity).Entity.Type,f=E.Entity.Subtype,y=E.Entity.Alternative,v=E.Entity.ID?E.Entity.ID:null,b=new Fo(m,f,y);E=JSON.stringify(E),(F=b.setfromJSON(a,E))&&(b.savemetolistLoad(a,!1),b.markupnumber=v)}if(null!=o.Entity.Hole)var x=!0;var w=[],k=[];if(x&&null!=o.Entity.Holes)for(var D=o.Entity.Holes,C=0;D.length>0;){var P=D[0].Type,S=D[0].Subtype,R=D[0].Alternative,M=D[0].ID?D[0].ID:null;P=parseInt(P),S=parseInt(S),R=parseInt(R),w.push(new Fo(P,S,R)),k.push(w[C].setfromJSON(a,D[0],fileVersion)),k[C]&&(w[C].savemetolistLoad(a,!1),w[C].markupnumber=M),C++}var T=new Fo(l,c,h);if(T.markupID=d,T.setfromJSON(a,t)){if(F&&g&&null!=b){if(T.bhasArrow=g,T.markupArrowConnected=b,b.bisTextArrow=!0,b.textBoxConnected=T,b.setArrowPoint(T),F=!1,g=!1,x)for(C=0;C<w.length;C++)k[C]&&(w[C].parent=T,T.holes.push(w[C]));al(n)}T.savemetolistLoad(a,!1)}else console.log("adding markup failed ",T.markupID)}else if(r)Yo(o.Entity.ID);else if(s){if(null==(T=a.getmarkupobjbyID(o.Entity.ID)))return null==o.operation&&(o.operation={}),o.operation.created=!0,o.operation.deleted=!1,o.operation.modified=!1,void e(JSON.stringify(o),a);if(T.subtype=c,T.alternative=h,T.setfromJSON(a,t),p=9==T.type&&2==T.subtype,T.bhasArrow&&(g=1==o.Entity.HaveLeader),(T.bhasArrow||p)&&null!=o.Entity.Entity){var E=o.Entity.Entity;b=T.markupArrowConnected,E=JSON.stringify(E);var F=b.setfromJSON(a,E);b.setfromJSON(a,E),b.setArrowPoint(T)}}null!=Et&&Et.setMarkupList(a.getmarkuplist(),a.bActive),null!=Ce&&Ce.setUserlist(es,a.bActive),al(n)},setUniqueMarkupfromJSON:function e(t,a){null!=a&&null!=a||(a=Bs);var i=!1,r=!1,s=!1,o=JSON.parse(t);null!=o.operation?o.operation.created?i=!0:o.operation.deleted?r=!0:s=!0:s=!0;var l=o.Entity.Type,c=o.Entity.Subtype,h=o.Entity.Alternative;if(i){if(null!=o.Entity.Signature){var u=o.Entity.Signature;es[0].Signature!=u&&(ss=as[o.Entity.Layer].Color,es.push(new Dn(u,o.Entity.Name,o.Entity.Layer,ss,!1)))}var d=o.Entity.ID?o.Entity.ID:null,p=o.Entity.UniqueID?o.Entity.UniqueID:null;if(null!=(k=a.getmarkupobjbyGUID(p)))return;var g=9==l&&2==c;if(null!=o.Entity.HaveLeader)var m=1==o.Entity.HaveLeader;if((m||g)&&null!=o.Entity.Entity){var f=(I=o.Entity.Entity).Entity.Type,y=I.Entity.Subtype,v=I.Entity.Alternative,b=I.Entity.ID?I.Entity.ID:null,x=I.Entity.UniqueID?I.Entity.UniqueID:null,w=new Fo(f,y,v);I=JSON.stringify(I),(j=w.setfromJSON(a,I))&&(w.savemetolistLoad(a,!1),w.markupnumber=b,w.uniqueID=x)}var k=new Fo(l,c,h);if(k.markupID=d,k.uniqueID=p,k.setfromJSON(a,t)?(j&&m&&null!=w&&(k.bhasArrow=m,k.markupArrowConnected=w,w.bisTextArrow=!0,w.textBoxConnected=k,w.setArrowPoint(k),j=!1,m=!1,al(n)),k.savemetolistLoad(a,!1)):console.log("adding markup failed ",k.uniqueID),null!=o.Entity.Hole)var D=!0;var C=[],P=[];if(D){if(null!=o.Entity.Holes)for(var S=o.Entity.Holes,R=0;S.length>0;){var M=(O=S[0].Entity).Type,T=O.Subtype,E=O.Alternative,F=O.ID?O.ID:null;M=parseInt(M),T=parseInt(T),E=parseInt(E),C.push(new Fo(M,T,E)),O=JSON.stringify(O),P.push(C[R].setfromJSON(a,O)),P[R]&&(C[R].savemetolistLoad(a,!1),C[R].setDrawdim(),C[R].markupnumber=F),R++}for(k.holes=[],R=0;R<C.length;R++)P[R]&&(C[R].parent=k,k.holes.push(C[R]))}}else if(r){if(0==o.Entity.UniqueID)return void console.log("not a unique markup id");Bo(o.Entity.UniqueID)}else if(s){if(0==o.Entity.UniqueID)return void(k=null);if(null!=(k=a.getmarkupobjbyGUID(o.Entity.UniqueID))){if(k.subtype=c,k.alternative=h,k.setfromJSON(a,t),g=9==k.type&&2==k.subtype,k.bhasArrow&&(m=1==o.Entity.HaveLeader),(k.bhasArrow||g)&&null!=o.Entity.Entity){var I=o.Entity.Entity;w=k.markupArrowConnected,I=JSON.stringify(I);var j=w.setfromJSON(a,I);w.setfromJSON(a,I),w.setArrowPoint(k)}if(null!=o.Entity.Holes&&(D=!0),C=[],P=[],D){if(null!=o.Entity.Holes)for(S=o.Entity.Holes,R=0;S.length>R;){var O;M=(O=S[0]).Entity.Type,T=O.Entity.Subtype,E=O.Entity.Alternative,F=O.Entity.ID?O.Entity.ID:null,M=parseInt(M),T=parseInt(T),E=parseInt(E),C.push(new Fo(M,T,E)),O=JSON.stringify(O),P.push(C[R].setfromJSON(a,O)),P[R]&&(C[R].savemetolistLoad(a,!1),C[R].setDrawdim(),C[R].markupnumber=F),R++}for(k.holes=[],R=0;R<C.length;R++)P[R]&&(C[R].parent=k,k.holes.push(C[R]))}}else{if(0!=o.Entity.UniqueID)return o.operation.created=!0,o.operation.deleted=!1,o.operation.modified=!1,void e(JSON.stringify(o),a);console.log("adding or modifying markup failed ",k.markupID)}}null!=Et&&Et.setMarkupList(a.getmarkuplist(),a.bActive),null!=Ce&&Ce.setUserlist(es,a.bActive),al(n)},setMarkup3DSavefile:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.setMarkup3DSavefile(e)},setMarkupCursor:function(e,t){for(var a=0;a<Qr.length;a++)e==Qr[a].name&&(Qr[a].cursor=t)},setViews3DSavefile:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.setViews3DSavefile(e)},markupSaveCheck:function(e){hi=e},markUpSelected:function(e){e&&"function"==typeof e&&zt.connect(e)},markUpShape:function(e,t,a){if(Ka&&!ws&&!$a&&!jh())if(Ho(),Uo(),e)switch(t){case 0:nd("rect",{p1:3,p2:a,redact:!1});break;case 1:nd("rect",{p1:4,p2:a,redact:!1});break;case 2:nd("rect",{p1:5,p2:a,redact:!1});break;case 3:nd("area",{p1:1,p2:2})}else if(Bs.getCurrentpage().usevector3Dxml)switch(Bs.curcontrol3D){case"Walkthrough3D":Gh(!0);break;case"orbitControl":Uh();break;case"markupedit":nd("markupedit",{p1:!1})}else nd("markupedit",{p1:!1})},markupSpace:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("area",{p1:8,p2:1}):nd("markupedit",{p1:!1})))},markUpStamp:function(e){Ka&&(ws||$a||(Ho(),Uo(),nd("rectStamp",{p1:e})))},markupSymbol:function(e){!Ka||ws||$a||jh()||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("symbol",{p1:1}):nd("markupedit",{p1:!1})))},markupImageStamp:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("symbol",{p1:12}):nd("markupedit",{p1:!1})))},markupQRCode:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("symbol",{p1:13}):nd("markupedit",{p1:!1})))},markupinteractiveStamp:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("interactiveStamp",{p1:21}):nd("markupedit",{p1:!1})))},markupLink:function(e){jh()||ws||$a||(Bs.getCurrentpage().usevector3Dxml?Xu(e,"add3dsymbol",{p1:"drag"}):(Ho(),Uo(),e?nd("link",{p1:20}):nd("markupedit",{p1:!1})))},markUpSubType:function(e){if(!jh()&&!ws){var t=Oo();t.isempty||(t.subtype=e),al(n),il(a)}},markUpText:function(e){Ka&&(ws||$a||(Ho(),Uo(),e?nd("text",{}):nd("markupedit",{p1:!1})))},markUpTextRect:function(e,t){Ka&&(ws||$a||(e?(Ho(),Uo(),nd("rectText",{})):nd("markupedit",{p1:!1}),Bt&&t&&"function"==typeof t&&Bt.connect(t)))},markUpTextRectArrow:function(e){Ka&&(ws||$a||(e?(Ho(),Uo(),nd("arrow",{p1:6})):nd("markupedit",{p1:!1})))},markUpRedo:function(){jh()||$a||(Ho(),Uo(),function(){if(null!=Bs&&null!=Bs){var e=Bs.markupredolist.pop();if(e)for(;e.bcurstate&&Bs.markupredolist.length>0;)Bs.markupundolist.push(e),e=Bs.markupredolist.pop();if(e)if(e.bMultiOp){Do(e);var t=[],a=e.multiOpId,i=0;for(i=0;i<Bs.markupredolist.length;i++)Bs.markupredolist[i].bMultiOp&&Bs.markupredolist[i].multiOpId==a?Do(Bs.markupredolist[i]):t.push(Bs.markupredolist[i]);Bs.markupredolist=t}else Do(e);0==Bs.markupredolist.length&&null!=We&&We.listempty(!1,!0)}}(),al(n),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive))},markUpUndo:function(){jh()||$a||(Ho(),Uo(),function(){if(null!=Bs&&null!=Bs){var e=Bs.markupundolist.pop();if(e)if(e.bMultiOp){Po(e);var t=[],a=e.multiOpId,i=0;for(i=0;i<Bs.markupundolist.length;i++)Bs.markupundolist[i].bMultiOp&&Bs.markupundolist[i].multiOpId==a?Po(Bs.markupundolist[i]):t.push(Bs.markupundolist[i]);Bs.markupundolist=t}else Po(e);0==Bs.markupundolist.length&&null!=We&&We.listempty(!0,!1)}}(),al(n),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive))},markUpUserDialog:function(){Ka&&null!=Ce&&Ce.setUserlist(es,Bs.bActive)},measure:function(e){Ka&&(Ho(),Uo(),e?nd("measuretool",{twoopoints:!1}):nd("markupedit",{p1:!1}))},measuredistance:function(e){Ka&&(Ho(),Uo(),e?nd("measuretool",{twoopoints:!0}):nd("markupedit",{p1:!1}))},metricUnit:Ru,elementMetricUnit:function(e){lu().scaleObject.metricUnit(e)},modifyMarkup:function(e,t){var a=function(e){for(var t={isempty:!0},a=0;a<Xs.length;a++)for(var i=0;i<Xs[a].markuplist.length;i++)null!=Xs[a].markuplist[i]&&Xs[a].markuplist[i].getUniqueID()==e&&(t=Xs[a].markuplist[i]);return t}(e);if(!a.isempty){To(a);var i=Jn(t);if(null!=i.getElementsByTagName("FileVersion")&&0!=i.getElementsByTagName("FileVersion").length)var r=i.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=i.getElementsByTagName("Entity")){for(var s=i.getElementsByTagName("Entity"),o=0;o<s.length;o++){if(null!=s[o].getElementsByTagName("HaveLeader")[0])var l=1==parseInt(s[o].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(l&&null!=s[o].getElementsByTagName("Entity")[0]){var c=s[o].getElementsByTagName("Entity")[0],h=c.getElementsByTagName("Alternative")[0].firstChild.nodeValue;a.SetfromXML(Bs,c,r)&&(s[o].removeChild(c),a.alternative=h,null!=a.textBoxConnected&&(a=a.textBoxConnected))}var u=s[o].getElementsByTagName("Alternative")[0].firstChild.nodeValue;u=parseInt(u),a.SetfromXML(Bs,s[o],r)&&(a.alternative=u)}a&&a.notify(),0==s.length&&null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n)}}},moveimageMarkup:function(e,t){if(Ka&&!ws&&!$a){Ho(),Uo();var a=function(e){var t=0,a=null;for(t=0;t<Bs.markuplist.length;t++)null!=Bs.markuplist[t]&&11==Bs.markuplist[t].type&&Bs.markuplist[t].subtype==e&&(a=Bs.markuplist[t]);return a}(2);null!=a&&a.movedirect(e,t)}},moveLabelEnable:function(e){"markupedit"==As.name&&As.enableMoveLabel(e)},moveTo3DNavPos:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&(null!=ta&&lr&&ta.setWalkthroughGUI(!0),nd("Walkthrough3D",{}),Bs.curcontrol3D="Walkthrough3D",Bs.getCurrentpage().walkthroughcontrol.setCameraXYPos(e))},moveTo3DPart:function(){if(!jh())if(Bs.getCurrentpage().usevector3DGLTF)!function(){if(Bs.getCurrentpage().usevector3Dxml){if(null!=Bs.getCurrentpage().Vector3DPageObj.getcur3DView())return;var e=Bs.getCurrentpage().Vector3DPageObj.getMeshChildren(),t=Bs.getCurrentpage().Vector3DPageObj.getMarkupChildren(),a=Bs.getCurrentpage().Vector3DPageObj.getAddedMeshChildren();if(0==e.length)return;var i=Bs.getCurrentpage().Vector3DPageObj.getSelectedPart();if(-1!=i.index){new THREE.Raycaster,Bs.getCurrentpage().Vector3DPageObj.scene.updateMatrixWorld(),Bs.getCurrentpage().Vector3DPageObj.scene.position.x,Bs.getCurrentpage().Vector3DPageObj.scene.position.y,Bs.getCurrentpage().Vector3DPageObj.scene.position.z,Bs.getCurrentpage().Vector3DPageObj.scale;var r=Bs.getCurrentpage().Vector3DPageObj.getmminUnit(2500),s=Bs.getCurrentpage().Vector3DPageObj.getmminUnit(10),n=(Bs.getCurrentpage().Vector3DPageObj.getfloorheight(),[]);if(i.isadded)if(i.group)var o=a[i.addedmeshindex][i.index].children[i.groupindex].geometry.boundingSphere.center.clone();else o=a[i.addedmeshindex][i.index].geometry.boundingSphere.center.clone();else o=i.group?e[i.index].children[i.groupindex].geometry.boundingSphere.center.clone():i.markup?t[i.index].position.clone():e[i.index].geometry.boundingSphere.center.clone();var l=new THREE.Vector3(1,0,0).normalize(),c=new THREE.Vector3(-1,0,0).normalize(),h=new THREE.Vector3(0,-1,0).normalize(),u=new THREE.Vector3(0,1,0).normalize(),d=Bs.getCurrentpage().camera.far;n.push({direction:c,raycaster:new THREE.Raycaster(o,c,s,d),intersects:null,distance:0}),n.push({direction:l,raycaster:new THREE.Raycaster(o,l,s,d),intersects:null,distance:0}),n.push({direction:h,raycaster:new THREE.Raycaster(o,h,s,d),intersects:null,distance:0}),n.push({direction:u,raycaster:new THREE.Raycaster(o,u,s,d),intersects:null,distance:0});for(var p=0,g=0,m=0;m<n.length;m++)if(i.isadded?n[m].intersects=n[m].raycaster.intersectObjects(a,!0):n[m].intersects=n[m].raycaster.intersectObjects(e,!0),n[m].intersects.length>0)for(var f=0;f<n[m].intersects.length;f++)if(n[m].intersects[f].object.visible&&null!=n[m].intersects[f].face){if(i.markup){n[m].distance=n[m].intersects[f].distance,n[m].distance>p&&(p=n[m].distance,g=m);break}if(!n[m].intersects[f].object.userData.selected){n[m].distance=n[m].intersects[f].distance,n[m].distance>p&&(p=n[m].distance,g=m);break}}Bs.getCurrentpage().camera.position.copy(o),Bs.getCurrentpage().camera.lookAt(o),(new THREE.Vector3).subVectors(Bs.getCurrentpage().camera.position,o).normalize(),n[g].distance>=r?Bs.getCurrentpage().camera.position.copy(n[g].direction.multiplyScalar(r).add(o)):Bs.getCurrentpage().camera.position.copy(n[g].direction.multiplyScalar(n[g].distance).add(o)),Bs.getCurrentpage().camera.lookAt(o);var y=Bs.getCurrentpage().Vector3DPageObj.checkfloorheight();null!=y&&(Bs.getCurrentpage().camera.position.copy(y),Bs.getCurrentpage().camera.lookAt(o),Bs.getCurrentpage().walkthroughcontrol.setTempWalkHeight(y.z),Bs.getCurrentpage().camera.lookAt(o),Bs.getCurrentpage().Vector3DPageObj.checkcurfloor(),Bs.getCurrentpage().Vector3DPageObj.getfloorElevation(0)),new THREE.Vector3(o.x,o.y,o.z),Bs.getCurrentpage().camera.rotation.x,Bs.getCurrentpage().camera.rotation.y,Bs.getCurrentpage().camera.rotation.z}}null!=ta&&lr&&ta.setWalkthroughGUI(!0),nd("Walkthrough3D",{}),Bs.curcontrol3D="Walkthrough3D"}();else{if(Bs.getCurrentpage().usevector3Dxml){var e=Bs.getCurrentpage().Vector3DPageObj.getSelectedPart();if(-1!=e){Bs.getCurrentpage().Vector3DPageObj.scene.updateMatrixWorld();var t=Bs.getCurrentpage().Vector3DPageObj.scene.position.x,a=Bs.getCurrentpage().Vector3DPageObj.scene.position.y,i=Bs.getCurrentpage().Vector3DPageObj.scene.position.z,r=Bs.getCurrentpage().Vector3DPageObj.scale,s=-Bs.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.x*r,n=-Bs.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.y*r,o=-Bs.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.z*r,l=Bs.getCurrentpage().Vector3DPageObj.partlist[e].vcentroid.z-Bs.getCurrentpage().Vector3DPageObj.partlist[e].minz,c=t-s,h=a-n,u=i-o,d=new THREE.Vector3(c,h,u);"IFC"==Bs.Format.substring(0,3)?Bs.getCurrentpage().camera.up.set(0,0,1):Bs.getCurrentpage().camera.up.set(0,1,0);var p=Bs.getCurrentpage().Vector3DPageObj.getfloorheight(),g=r*Bs.getCurrentpage().Vector3DPageObj.getmeterunit(),m=(p-l)*r;Bs.getCurrentpage().camera.position.x=c,Bs.getCurrentpage().camera.position.y=h-g,Bs.getCurrentpage().camera.position.z=u+m,Bs.getCurrentpage().camera.lookAt(d);var f=Bs.getCurrentpage().camera.rotation.x;Bs.getCurrentpage().camera.rotation.y,Bs.getCurrentpage().camera.rotation.z,Bs.getCurrentpage().walkthroughcontrol.setInitial(-f*(180/Math.PI),90,0,0)}}null!=ta&&lr&&ta.setWalkthroughGUI(!0),nd("Walkthrough3D",{}),Bs.curcontrol3D="Walkthrough3D"}},mSIEeventCheck:function(e){Ri=e},nav3Dreplacediag:function(){null!=ra&&(0==qs.length&&Ah(),ra.CompareDialog())},nextMarkup:function(){jh()||Ka&&($a||(Ho(),Uo(),Bs.getCurrentpage().MarkupZoom()))},nextPage:function(){Ka&&!$a&&(Ho(),Uo(),Bs.GotoPage(Bs.currentpage+1),nd("markupedit",{p1:!1}))},noteFocus:function(e){Ka&&(yr=e)},noSelect3D:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.setNoSelectAll(e)},onNotePlaced:function(e){Ut.callback=e},onTextPlaced:function(e){At.callback=e},openFile:Qh,openFloorplanFile:function(e,t){if(!jh()&&Xs[e].pages[0].usevector3DGLTF){var a=Xs[e].getFloorplans();if(a.length>0)for(var i=0;i<a.length;i++)if(a[i].index==t){RxCore_openFile(a[i].SRC);break}}},openFileCustom:function(e){null!=Qt&&Qt.setDownload("show"),Q=!0,ae=e,function(e){var i;mi=!1,ri&&(null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu(),Jc("GET",e+"data.xml").then((function(t){var a,r=0;Ka&&bi&&du(),pe=t;var s=0;null==Bs||null==Bs?(Ws=Xs.push(new Xl(t)),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.relativepath=e):(Ws=Xs.push(new Xl(t)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.relativepath=e);var n=mo(Bs.OriginalURL),o="Adobe PDF"==Bs.Format.substring(0,9),l=t.getElementsByTagName("Layout");for(a=0;a<l.length;a++){var c=l[a].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Bs.addlayout(c);var h=l[a].getElementsByTagName("Page");for(r=0;r<h.length;r++)0==r&&0==a?(i=new _l(h[r],c,!0,n,r,Bs),Bs.addthumbnail(new Gl(h[r],c,Bs,r)),Bs.addpage(i,!0)):(Bs.addthumbnail(new Gl(h[r],c,Bs,r+s)),r<or||!o?(i=new _l(h[r],c,!1,"",r+s,Bs),Bs.addpage(i,!1)):Bs.addpage(void 0,!1));s+=r}if(Ih()){Xs[Ws-1]=Bs,null!=st&&st.setThumbnails(Bs.thumbnails);var u={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(u);var d={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(d)}})).catch((function(e){Eh("getFileCustom",e)})))}(e)},openFileLayouts:function(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1,ac(e,t,!0,a)},openFileLayoutsEx:function(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1;var i=!1,r=Kh(e);null!=r&&(null!=r.filename&&(i=!0),i?tc(r,t,!0,a):null!=Qt&&Qt.setDownload("hide"))},openFilePages:function(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1,ac(e,t,!1,a)},openFilePagesPDFdoc:function(e,i,s,o){null!=Qt&&Qt.setDownload("show"),Q=!1,function(e,i,s,o){if(mi=!1,ri){null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0));var l=go(e);n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height),Su(),Pu();var c='<?xml version="1.0" encoding="UTF-8"?>';c+="<RxViewServer>",c+="<Command>GetFile</Command>",c+="<LicenseID>"+_i+"</LicenseID>",c+="<FileURL>"+e+"</FileURL>",Jc("POST",p,c+="</RxViewServer>",[{event:"callback",func:o}]).then((function(e){var t,a=0;null!=Qt&&Qt.setDownload("hide");var r=0,n=0;null==Bs||null==Bs?(Ws=Xs.push(new Xl(e)),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.usepagesload=!0):(Ws=Xs.push(new Xl(e)),Bs.enableTextSelect(!1),(Bs=Xs[Ws-1]).setfileindex(Ws-1),Bs.usepagesload=!0),Bs.setPDFdocument(i,!1);var o=mo(Bs.OriginalURL),c=e.getElementsByTagName("Layout");for(t=0;t<c.length;t++){var h=c[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue;Bs.addlayout(h);var u=c[t].getElementsByTagName("Page");for(a=0;a<u.length;a++)0==a&&0==t?s.indexOf(a)>=0&&(Bs.addthumbnail(new Gl(u[a],h,Bs,a)),Bs.addpage(new _l(u[a],h,!0,o,a,Bs),!0),n++):s.indexOf(a)>=0&&(0==n?(Bs.addpage(new _l(u[a],h,!0,o,a+r,Bs),!0),Bs.addthumbnail(new Gl(u[a],h,Bs,a+r)),n++):(Bs.addpage(new _l(u[a],h,!1,"",a+r,Bs),!1),Bs.addthumbnail(new Gl(u[a],h,Bs,a+r)),n++));r+=a}if(Ih()){Bs.FileName=l,Xs[Ws-1]=Bs,null!=st&&st.setThumbnails(Bs.thumbnails);var d={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(d);var p={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(p)}})).catch((function(e){Eh("getfilePagesPDFdoc",e)}))}}(e,i,s,o)},openFileSilent:function(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1,nc(e,t,a)},open3DFloorplan:function(e,t,a){null!=Qt&&Qt.setDownload("show"),Q=!1,ee=!0,nc(e,t,a)},open3DFloorplanPage:function(e,t){null!=Qt&&Qt.setDownload("show"),Q=!1,ee=!0,te=t,"string"==typeof e&&sc({filename:e,displayname:null})},openFileGLTF:function(e){if(null!=Qt&&Qt.setDownload("show"),"object"==typeof e){var t="",a=!1;null!=e.filepath&&null!=e.filepath&&(t=e.filepath,a=!0),null!=e.mime&&null!=e.mime&&(t=t+"?x-mimetype="+e.mime),null!=e.cacheid&&null!=e.cacheid&&(t=t+"&amp;cacheid="+e.cacheid);var i={filename:t,displayname:null};null!=e.displayname&&null!=e.displayname&&(i.displayname=e.displayname),a?Xc(e.filepath):null!=Qt&&Qt.setDownload("hide")}else"string"==typeof e&&(i={filename:e,displayname:null},Xc(e))},openMarkup:function(e){jh()||fc(e,Bs)},openRecent:function(e){null!=Qt&&Qt.setDownload("show"),retval=sc({filename:e,displayname:null}),null!=retvar&&"Require Password"==retval&&console.log("Require Password")},orbit3D:Uh,overlayFiles:function(e,t){tu(e,t,1)},overlay:su,overlaymode:function(e){return Fs=!Fs},overrideLinewidth:function(e,t){ja=e,Oa=t},penTabledialog:function(){if(!jh()&&Ka&&Bs.getCurrentpage().usevectorxml&&null!=Pe){var e=Bs.getCurrentpage().getPenTable();Pe.setPentablelist(e.pens,Bs.bActive)}},setPenTable:function(e){Ka&&($a||(e&&(yi=!1),Bs.getCurrentpage().setPenTable(e)))},setpentablePen:function(e,t){Ka&&($a||(t?Bs.getCurrentpage().resetPenTablepen(e):Bs.getCurrentpage().setPenTablepen(e)))},setPenTableScaled:function(e){Ka&&($a||Bs.getCurrentpage().setpentableScaled(e))},setPenwidth:function(e){Ka&&($a||Bs.getCurrentpage().setPenwidth(e))},setinitFile:function(e){var t=Kh(e);null!=t&&null!=t.filename&&(t.filepath=t.filename,pr.open=!0,pr.openfileobj=t,se&&(pr.open=!1,Qh(pr.openfileobj)))},pageLock:function(e){jh()||Bs.pagelock(e)},pageOnlyMarkup:function(e){jh()||Ka&&null!=Et&&(e&&Et.pageonly?Et.pageonly=!1:Et.pageonly=!0,Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive))},pagePos:yu,panPage:function(e,t){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||Bs.getCurrentpage().pan_page(e,t,!0))},panTomarkup:function(e){jh()||Ka&&($a||Bs.panToMarkup(e))},panWindow:function(e){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||(Ho(),Uo(),e?nd("pan",{}):nd("markupedit",{p1:!1})))},pasteMarkUp:function(){jh()||Ka&&($a||(function(){if("undefined"!=typeof Storage){if(null!=localStorage.getItem("MarkupPostfixlist"))var e=localStorage.MarkupPostfixlist.split(",");else e=[""];var t=!1;e.length>1&&(t=!0,ai+=1);var a=Bs.getCurrentpage();if(a)var i=a.getpagerect();for(var r=10,s=10,n=0;n<e.length;n++){var o=e[n];if(null!=localStorage.getItem("Type"+o)){var l=parseInt(localStorage.getItem("Type"+o));if(null!=localStorage.getItem("Subtype"+o)){var c=parseInt(localStorage.getItem("Subtype"+o));if(null!=localStorage.getItem("Alternative"+o)&&null!=localStorage.getItem("Rect"+o)){var h=parseInt(localStorage.getItem("Alternative"+o)),u=new Fo(l,c,h);if(u.bRedact=1==parseInt(localStorage.getItem("Alternative"+o)),u.pagenumber=Bs.getcurPage(),u.viewname=Bs.getcur3DView(),null==u.viewname?u.bfor3D=!1:(u.bfor3D=!0,u.pageheight=Aa,u.pagewidth=Na),u.fillcolor=localStorage.getItem("fillcolor"+o),u.strokecolor=localStorage.getItem("strokecolor"+o),u.textcolor=localStorage.getItem("textcolor"+o),u.markercolor=localStorage.getItem("markercolor"+o),u.color=localStorage.getItem("Color"+o),u.dimtext=localStorage.getItem("DimText"+o),u.font.setFontname(localStorage.getItem("FontName"+o)),u.font.setHeight(localStorage.getItem("FontHeight"+o)),u.font.bold=1==parseInt(localStorage.getItem("bold"+o)),u.font.italic=1==parseInt(localStorage.getItem("italic"+o)),u.transparency=localStorage.getItem("Transparency"+o),u.rotation=localStorage.getItem("Rotation"+o),12==l&&(u.stampsmalltheight=localStorage.getItem("Stampsmalltheight"+o)),11==l){var d=new Image;u.markupcdataload(d,localStorage.getItem("image"+o))}null!=localStorage.getItem("LeaderOffset"+o)&&(u.leaderoffset=parseFloat(localStorage.getItem("LeaderOffset"+o))),null!=localStorage.getItem("LabelOffsetX"+o)&&(u.labeloffsetx=parseFloat(localStorage.getItem("LabelOffsetX"+o))),null!=localStorage.getItem("LabelOffsetY"+o)&&(u.labeloffsety=parseFloat(localStorage.getItem("LabelOffsetY"+o))),null!=localStorage.getItem("LabelColor"+o)&&(u.labelfillcolor=localStorage.getItem("LabelColor"+o)),null!=localStorage.getItem("Arrowlength"+o)&&(u.arrowlength=parseFloat(localStorage.getItem("Arrowlength"+o))),u.text=localStorage.getItem("Text"+o),u.dimtext=localStorage.getItem("DimText"+o),u.textwidth=parseFloat(localStorage.getItem("TextWidth"+o)),u.scaling=parseFloat(localStorage.getItem("Scaling"+o)),u.xoffset=parseFloat(localStorage.getItem("Xoffset"+o)),u.yoffset=parseFloat(localStorage.getItem("Yoffset"+o)),u.pageheight=parseFloat(localStorage.getItem("Pageheight"+o)),u.pagewidth=parseFloat(localStorage.getItem("Pagewidth"+o)),u.linewidth=parseInt(localStorage.getItem("LineWidth"+o)),u.outerRadius=parseInt(localStorage.getItem("OuterRadius"+o)),u.innerRadius=parseInt(localStorage.getItem("InnerRadius"+o));var p=localStorage.getItem("Rect"+o).split(" "),g=p[0].split("="),m=p[1].split("="),f=p[2].split("="),y=p[3].split("=");if(u.x=parseInt(g[1]),u.y=parseInt(m[1]),u.w=parseInt(f[1]),u.h=parseInt(y[1]),i){var v=.5*i.w,b=.5*i.h;v+=i.x,b+=i.y,r=u.x<v&&u.w<v?10:-10,s=u.y<b&&u.h<b?10:-10}var x=4==u.type&&0==u.subtype;if(3==u.type||x||5==u.type||9==u.type||10==u.type||11==u.type||12==u.type?(u.x+=r,u.y+=s):(u.x+=r,u.y+=s,u.w+=r,u.h+=s),null!=localStorage.getItem("Points"+o)){var w=localStorage.getItem("Points"+o);u.points=JSON.parse(w);for(var k=0;k<u.points.length;k++)u.points[k].x+=r,u.points[k].y+=s}if(null!=localStorage.getItem("Countshapes"+o)){var D=localStorage.getItem("Countshapes"+o);for(u.countshapes=JSON.parse(D),k=0;k<u.countshapes.length;k++)u.countshapes[k].x+=r,u.countshapes[k].y+=s}if(null!=localStorage.getItem("Pointlist"+o)&&(w=localStorage.getItem("Pointlist"+o),u.pointlist=JSON.parse(w)),null!=localStorage.getItem("Sides"+o)){var C=localStorage.getItem("Sides"+o);u.sides=JSON.parse(C)}Dr=Bs.markuplist.length,u.savemetolistLoad(Bs),u.setfirstDraw(),t&&Bs.markuplist[Dr].setmultiValues(ai),Bs.markuplist[Dr].savemarkupstate(Bs,2),gr=!0,null!=zt&&zt.setMarkupSelected(Bs.markuplist[Dr],{created:!0,modified:!1,deleted:!1})}}}}}}(),al(n)))},getBlockInsert:function(e){if(!jh()&&!$a){if(!e)return nd("markupedit",{p1:!1}),void Bs.unselectallBlocks();Ho(),nd("pickPolygon",{p1:!1,p2:!1,p3:!0,p4:!1,p5:!0})}},getVectorEntity:function(e){jh()||$a||(e?(Ho(),nd("pickPolygon",{p1:!1,p2:!1,p3:!0,p4:!0,p5:!1})):nd("markupedit",{p1:!1}))},pickPolygon:function(e,t){Ka&&($a||(e?(Ho(),nd("pickPolygon",{p1:t,p2:!1,p3:!0})):nd("markupedit",{p1:!1})))},pickRxSpace:function(e,t){Ka&&($a||(e?(Ho(),nd("pickPolygon",{p1:t,p2:!1,p3:!1})):nd("markupedit",{p1:!1})))},prevPage:function(){Ka&&!$a&&(Ho(),Uo(),Bs.GotoPage(Bs.currentpage-1),nd("markupedit",{p1:!1}))},print:function(){Ka&&(parseInt(Bs.getCurrentpage().height)>parseInt(Bs.getCurrentpage().width)?(Hi=210,zi=297):(Hi=297,zi=210),So(),$a||(Bs.checkprintready()?Uc():Bs.loadAllPages()))},printDoc:function(){return Bs},printEx:function(e){if(Ka){if(Bs.getCurrentpage().height>Bs.getCurrentpage().width)var t=210,a=297;else t=297,a=210;gu(0,{width:t,height:a})}},printSizeEx:function(e,t){if(Ka){if(0==t.mode)if(Bs.getCurrentpage().height>Bs.getCurrentpage().width){if(t.width>t.height){var a=t.width;t.width=t.height,t.height=a}}else t.height>t.width&&(a=t.width,t.width=t.height,t.height=a);else 1==t.mode?t.width>t.height&&(a=t.width,t.width=t.height,t.height=a):2==t.mode&&t.height>t.width&&(a=t.width,t.width=t.height,t.height=a);gu(0,t)}},printhelper:bd,refreshThumbnails:function(){jh()||Bs.refreshThumbnails()},redrawPage:function(e){jh()||null!=Bs.getPageObject(e)&&Bs.getPageObject(e).redraw()},removeFloorplan:function(e){jh()||Ka&&(ws||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().removefloorplan(e))},removeLastPoint:function(){As.multipoint&&As.started&&As.removelastPoint()},reset3DModel:function(){jh()||Bs.getCurrentpage().usevector3Dxml&&(Bs.getCurrentpage().reset3DParts(),Bs.getCurrentpage().Vector3DPageObj.active3DView=!1,Bs.getCurrentpage().Vector3DPageObj.doexplode=!0,Bs.getCurrentpage().Vector3DPageObj.newExplode(0),Bs.getCurrentpage().Vector3DPageObj.doexplode=!1,Bs.getCurrentpage().Vector3DPageObj.resetTransparency(),Bs.getCurrentpage().Vector3DPageObj.clipping(-1,0,!1),Bs.curcontrol3D="orbitControl",Uh(),Yh())},restoreStartCam:function(){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.restorestartcam()},saveresetCam:Xh,setresetCam:Yh,resetBlocks:function(){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().resetBlocks()},resetLayers:function(){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().resetLayers()},restoreBlockStates:function(){jh()||(function(){var e=0;for(e=Bs.markuplist.length;e>0;e--)null!=Bs.markuplist[e-1]&&Bs.markuplist[e-1].display&&Bs.markuplist[e-1].pagenumber==Bs.getcurPage()&&8==Bs.markuplist[e-1].type&&1==Bs.markuplist[e-1].subtype&&(Bs.markuplist[e-1].alternative=0);al(n),il(a)}(),Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().restoreBlockStates())},restoreCamera:function(){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.restoreCamera()},restoreCameraByName:function(e){if(!jh()){var t=Bs.getCurrentpage();t&&(t.usevector3Dxml&&t.unSelect3DmarkupAll(),t.usevector3Dxml&&t.restoreCameraByName(e))}},restoreDefault:Wu,reverseNavMouse:function(e){ji=e},birdseyetool:function(){Ka&&(jh()||Bs.getCurrentpage().usevector3Dxml||Bs.setBirdseyeTool())},restoreMouseInput:function(){As.anglelengthsupport&&As.started&&"area"==As.name&&As.useMouseInput()},restrictPan:function(e){Di=e},renderBirdseye:function(){jh()||Bs.renderBirdsEye()},rotate:function(e,t){if(!jh())if($a)Us.rotateimage(e,t);else if(e)switch(Bs.getCurrentpage().drotation){case 0:Bs.getCurrentpage().rotateimage(90);break;case 90:Bs.getCurrentpage().rotateimage(180);break;case 270:Bs.getCurrentpage().rotateimage(0);break;case 180:Bs.getCurrentpage().rotateimage(270)}else"0"==t&&Bs.getCurrentpage().rotateimage(0),"90"==t&&Bs.getCurrentpage().rotateimage(90),"180"==t&&Bs.getCurrentpage().rotateimage(180),"270"==t&&Bs.getCurrentpage().rotateimage(270)},rotatePage:function(e,t){jh()||null!=Bs.getPageObject(e)&&(Bs.getPageObject(e).rotateimage(t),0==e&&Bs.getPageObject(e).redraw())},saveTop3DCamera:function(){if(!jh()){var e=Bs.getCurrentpage();e&&e.usevector3Dxml&&e.Vector3DPageObj.saveResetCam()}},save3DCamera:Hh,find3DViewAttribute:function(e,t,a){if(!jh()){var i=Bs.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.findViewAttribute(e,t,a)}},update3DViewAttribute:function(e,t,a){if(!jh()){var i=Bs.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.updateViewAttribute(e,t,a)}},delete3DViewAttribute:function(e,t){if(!jh()){var a=Bs.getCurrentpage();a&&a.usevector3Dxml&&a.Vector3DPageObj.deleteViewAttribute(e,t)}},get3DViewAttributes:function(e){if(!jh()){var t=Bs.getCurrentpage(),a=void 0;return t&&t.usevector3Dxml&&(a=t.Vector3DPageObj.getViewAttributes(e)),a}},add3DViewAttribute:function(e,t,a){if(!jh()){var i=Bs.getCurrentpage();i&&i.usevector3Dxml&&i.Vector3DPageObj.addViewAttribute(e,t,a)}},get3DViewAttribute:function(e,t){if(!jh()){var a=Bs.getCurrentpage();a&&a.usevector3Dxml&&a.Vector3DPageObj.getViewAttribute(e,t)}},scale:Tu,elementScale:function(e){var t=lu();t.scaleObject.setMeasureScale(e),t.hasScale=!0,Bs.bMarkupchanged=!0},setScaleLabel:Eu,setElementScaleLabel:function(e){lu().scaleObject.setScaleLabel(e)},setElementDimPrecision:Fu,resetToDefaultScaleValueForMarkup:function(e){for(var t=Bs.markuplist,a=0;a<t.length;a++){var i=t[a];i.hasScale&&i.scaleObject.scaleLabel===e&&(i.scaleObject.resetToDefaultValue(),i.hasScale=!1)}Bs.bMarkupchanged=!0,Zh()},setElementDimPrecision:Fu,scaleOnResize:function(e){xi=e},select3D:function(e){Xu(e,"select3d",{p1:0})},select3DMarkup:function(e){Xu(e,"select3d",{p1:1})},search3dAttribute:function(e){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().search3DAttribute(e):void 0},search3dAttributes:function(e){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().search3DAttributes(e):void 0},search3dAttributesEx:function(e,t){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?t?Bs.getCurrentpage().search3DAttributes(e):Bs.getCurrentpage().search3DAttributesEx(e):void 0},select3DVectorBlock:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().select3DBlock(e,!0)},selectMarkUp:vu,SearchStoreyAttributes:function(e,t){return jh()?-1:Bs.getCurrentpage().usevector3Dxml?Bs.getCurrentpage().searchStoreyAttributes(e,t):void 0},selectMarkupbyGUID:function(e){if(Ka){var t=Bs.getmarkupbyGUID(e);-1==t||null==Bs.markuplist[t].markupnumber?$u(-1):$u(Bs.markuplist[t].markupnumber)}},selectMarkupbyGUIDs:function(e){Ka&&$i&&(Bs.selectmarkupbyGUIDs(e),al(n),il(a),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive))},select3DMarkUpByID:function(e){Ka&&(jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().select3Dmarkup(e))},selectMarkUpByIndex:$u,selectSymbName:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Libname")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","",t).then((function(e){var t={type:2,data:e};null!=Ot&&Ot.onSymbolReceived(t)})).catch((function(e){e.status?404==e.status?console.log("selectSymbname error 404"):503==e.status?console.log("selectSymbname error 503"):501==e.status&&console.log("selectSymbname error 501"):console.log(e)}))}(e)},selectSymblib:function(e){!function(e){var t,a=[];a.push(encodeURIComponent("MfcISAPICommand")+"="+encodeURIComponent("FormRequest")),a.push(encodeURIComponent("Command")+"="+encodeURIComponent("Selectlib")),a.push(encodeURIComponent("Libnumber")+"="+encodeURIComponent(e)),t=a.join("&").replace(/%20/g,"+"),Kc("POST",g+"?FormRequest","",t).then((function(t){var a={type:6,data:e};null!=Ot&&Ot.onSymbolReceived(a)})).catch((function(e){e.status?404==e.status?console.log("selectSymblib error 404"):503==e.status?console.log("selectSymblib error 503"):501==e.status&&console.log("selectSymblib error 501"):console.log(e)}))}(e)},selectVectorBlock:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().selectBlock(e)},selectRxSpace:function(e,t){jh()||Ka&&!$a&&(Bs.getCurrentpage().usevector3Dxml||function(e,t){var i=[],r=[],s={isempty:!0},o=0,l=-1,c=zo(e),h=null!=c;for(o=Bs.markuplist.length;o>0;o--){if(h)var u=c.markupnumber==Bs.markuplist[o-1].markupnumber;else u=!1;null==Bs.markuplist[o-1]||u||8==Bs.markuplist[o-1].type&&1==Bs.markuplist[o-1].subtype&&(t&&Bs.markuplist[o-1].spaceselected?(s={id:l=Bs.markuplist[o-1].markupnumber,attr:i=Bs.markuplist[o-1].GetAttributes(),isempty:!1},r.push(s)):(Bs.markuplist[o-1].spaceselected=!1,Bs.markuplist[o-1].linewidth=1))}h&&(l=c.markupnumber,c.spaceselected=!c.spaceselected,i=c.GetAttributes(),c.spaceselected?(c.linewidth=2,s={id:l,attr:i,isempty:!1},r.push(s)):c.linewidth=1),0!=r.length||c.spaceselected?wu(!0):wu(!1),t?null!=Dt&&Dt.set2DBlockID(r):null!=Dt&&Dt.set2DBlockID(s),al(n),il(a)}(e,t))},selectRxSpaceEdit:function(e){if(!jh()&&Ka&&!$a&&!Bs.getCurrentpage().usevector3Dxml){var t=zo(e);if(null!=t){var i=t.selectedit;if($i||Bs.getMarkupMultiselected()||(Ho(),Uo()),Bs.getcurPage()!=t.pagenumber&&Bs.GotoPage(t.pagenumber),i){t.setselectedit(!1);var r=-1}else t.setselectedit(!0),r=Bs.getmarkupbynumber(t.markupnumber),null!=zt&&zt.setMarkupSelected(Bs.markuplist[r],{created:!1,modified:!0,deleted:!1});al(n),il(a),null!=Et&&Et.setMarkupList(Bs.getmarkuplist())}}},set3DBlockDistance:function(e,t,a,i){jh()||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().set3DBlockDistance(e,t,a,i)},set3DBlockPosition:function(e,t,a){jh()||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().set3DBlockPosition(e,t,a)},set3DmodelcurFloor:function(e){jh()||Bs.setbirdseyefloor(e)},setActiveFile:Bh,setActiveFileEx:function(e){new Promise((function(e,t){_e.connect((function(t){for(var a=!1,i=0;i<Xs.length;i++)Xs[i].bRenderinProgress&&(a=!0);a||e(t)}));for(var a=0;a<Xs.length;a++)Xs[a].checkRender()})).then(Bh(e))},setAreaPerimeter:function(e){Ka&&(ws||No(e?16:17))},setArrowSize:function(e){var t=Ar;Ar=e,Ka&&(ws||(No(10),xs||(Ar=t)))},setTextheightFactor:function(e){Yr=e},setAuthorization:function(e,t){ks=!0,Ds=!0,Ps=e,Cs=t},setBirdseyeFloor:function(e){jh()||Bs.setbirdseyefloor(e)},set3DViewSelectedMesh:function(e){if(!jh()){var t=Bs.getCurrentpage();t&&t.usevector3Dxml&&t.set3DViewSelectedMesh(e)}},setMarkupMarkedColor:function(e){qi=e},setBlockColor:Nh,setBlockFill:function(e,t,a){if(!jh()&&!$a){var i=to(t);if("hatch"==i)Vh(e,t,a);else if("color"==i){var r=ao(t);eo(t,a),Nh(e,r,a)}}},setBlockHatch:Vh,setCalibration:function(e){jh()||Bs.getCurrentpage().setCalibrateScale(e)},setCompareFiles:function(e,t){if(null!=e){qs.length<e+1||0==qs.length?Ah().length>e&&(qs[e].state=t):qs[e].state=t;for(var a=0;a<qs.length;a++)qs[a].state==t&&a!=e&&(qs[a].state=0);null!=aa&&aa.CompareDialog()}},setCompareColors:function(e,t){if(!jh()){cr=e,hr=t;var a=eu();null!=a&&a.setColors(e,t)}},changeSpaceCustomLabel:function(e,t){if(!jh()&&!$a&&!Bs.getCurrentpage().usevector3Dxml){var i=zo(e);i&&i.busecustomlabel&&(i.customlabeltext=t),al(n),il(a)}},setCompareScale:function(e){if(!jh()){Ho(),Uo();var t=eu();null!=t&&t.setcomparescale(e)}},setJSONConfiguration:function(e){q=!0,Z=e},setConfiguration:function(e){Y=e,$=!0},setCustomLabelText:function(e,t){if(!jh()&&!ws){var i=Oo();i.isempty||(i.customlabeltext=e,i.busecustomlabel=t),al(n),il(a)}},setDimOffset:function(e){if(Ka&&!ws){var t=Oo();t.isempty||7!=t.type||(t.leaderoffset=e),al(n),il(a)}},setdisplayBackground:function(e){ir=e,Ka&&(Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().draw_vector(!0),al(n))},setdisplay:function(e){Ka&&(ws||function(e){var t=0;for(t=0;t<Bs.markuplist.length;t++)(Bs.markuplist[t].selected||Bs.markuplist[t].selectedit)&&(e?Bs.markuplist[t].show():Bs.markuplist[t].hide());al(n),il(a)}(e))},setFont:function(e){var t=tn.fontName;tn.setFontname(e),Ka&&(ws||(No(4),xs||tn.setFontname(t)))},setFontFull:function(e){var t={name:tn.fontName,size:tn.height,bold:tn.bold,italic:tn.italic};tn.setFontname(e.font),tn.setHeight(e.size),tn.setBold(e.style.bold),tn.setItalic(e.style.italic),Ka&&(ws||(No(4),xs||(tn.setFontname(t.name),tn.setHeight(t.size),tn.setBold(t.bold),tn.setItalic(t.italic))))},setFontBold:function(e){var t=tn.bold;tn.setBold(e),Ka&&(ws||(No(4),xs||tn.setBold(t)))},setFontHeight:function(e){var t=tn.height;tn.setHeight(e),Ka&&(ws||(No(4),xs||tn.setHeight(t)))},setFontItalic:function(e){var t=tn.italic;tn.setItalic(e),Ka&&(ws||(No(4),xs||tn.setItalic(t)))},setGlobalStyle:function(e){xs=e},setGUIDMarkupSelected:function(){if(Ka&&!ws){var e=Oo();e.isempty||e.setRxUniqueID()}},setHatch:Qn,addFill:function(e,t,a,i,r,s){"color"==e?Kn(t,r,s):"hatch"==e&&Qn(a,t,i,r,s)},addHatch:Qn,addColorFill:Kn,setHatchDescription:function(e,t){for(var a=0;a<is.length;a++)if(e==is[a].name){is[a].description=t;break}},setCameraTumbWidth:function(e){Hr=e},setCountSize:function(e){var t=Gr;Gr=e,Ka&&(ws||(No(13),xs||(Gr=t)))},setCountSizeAll:function(e){var t=Gr;Gr=e,Ka&&(ws||(No(13,!0),xs||(Gr=t)))},setLabelSize:function(e){var t=Ur;Ur=e,Ka&&(ws||(No(11),xs||(Ur=t)))},setLabelSizeAll:function(e){var t=Ur;Ur=e,Ka&&(ws||(No(11,!0),xs||(Ur=t)))},setRotateOffsetbirdseye:function(e,t){},setLargePDFpageLimit:function(e){nr=e},setLayout:function(e,t,a){null!=e&&(ve.offsetWidth=e),null!=t&&(ve.offsetHeight=t),null!=a&&(ve.absolute=a)},setLineStyle:function(e){var t=fs;fs=e,Ka&&(ws||(No(9),xs||(ds=t)))},setLineWidth:function(e){var t=ds;ds=e,Ka&&(ws||(No(2),xs||(ds=t)))},setLineWidthAll:function(e){var t=ds;ds=e,Ka&&(ws||(No(2,!0),xs||(ds=t)))},setLineWidthMarkup:function(e,t){var a=ds;ds=t,Ka&&(ws||(Vo(e,2),xs||(ds=a)))},setLineWidthUnits:function(e,t){var a=ds,i=Bs.getCurrentpage().fixedScale;ds=bo(e),ds*=i,Ka&&(ws||(No(2),xs||(ds=a)))},setSegmentLineWidthUnits:function(e){var t=ps,a=Bs.getCurrentpage().fixedScale;ps=bo(e),ps*=a,jh()||ws||(No(19),xs||(ps=t))},setMarkupLayer:function(e){Ka&&($a||(rs=e,ss=as[e].Color,os=ss,ls=ss))},setmarkupRxGUID:function(){var e=0;for(e=0;e<Bs.markuplist.length;e++)if(null!=Bs.markuplist[e]&&!Bs.markuplist[e].isempty)if("0"==Bs.markuplist[e].getUniqueID())Bs.markuplist[e].setRxUniqueID();else{var t=Bs.markuplist[e].getUniqueID();8==Bs.markuplist[e].type&&1==Bs.markuplist[e].subtype&&Bs.markuplist[e].updateAttribute("SpaceID",t)}},setMarkupSearchPadding:function(e){ke.x=e.x,ke.y=e.y,ke.w=e.w,ke.h=e.h},setMarkupXMLData:function(e){jh()||$a||function(e){var t=0,a=XMLParser(e);if(null!=a.getElementsByTagName("FileVersion")&&0!=a.getElementsByTagName("FileVersion").length)var i=a.getElementsByTagName("FileVersion")[0].firstChild.nodeValue;if(null!=a.getElementsByTagName("User")&&0!=a.getElementsByTagName("User").length){var r=a.getElementsByTagName("User");for(t=0;t<r.length;t++){var s=r[t].getElementsByTagName("Name")[0].firstChild.nodeValue,o=r[t].getElementsByTagName("ID")[0].firstChild.nodeValue;if(null!=r[t].getElementsByTagName("Layer")[0])var l=r[t].getElementsByTagName("Layer")[0].firstChild.nodeValue;else l=rs;if(null!=r[t].getElementsByTagName("Color")[0])var c=r[t].getElementsByTagName("Color")[0].firstChild.nodeValue;else c=ss;es[0].Signature==o||es.push(new Dn(o,s,l,c,!1))}}else if(null!=a.getElementsByTagName("Name")){var h=a.getElementsByTagName("Name");es[0].Signature!=h[0].firstChild.nodeValue&&es.push(new Dn(h[0].firstChild.nodeValue,h[0].firstChild.nodeValue,rs,ss,!1))}if(null!=a.getElementsByTagName("Entity")){var u=a.getElementsByTagName("Entity");for(t=0;t<u.length;t++){var d=u[t].getElementsByTagName("Type")[0].firstChild.nodeValue,p=u[t].getElementsByTagName("Subtype")[0].firstChild.nodeValue,g=u[t].getElementsByTagName("Alternative")[0].firstChild.nodeValue,m=u[t].getAttribute("ID")?u[t].getAttribute("ID"):null;if(null!=u[t].getElementsByTagName("HaveLeader")[0])var f=1==parseInt(u[t].getElementsByTagName("HaveLeader")[0].firstChild.nodeValue);if(f&&null!=u[t].getElementsByTagName("Entity")[0]){var y=u[t].getElementsByTagName("Entity")[0],v=y.getElementsByTagName("Type")[0].firstChild.nodeValue,b=y.getElementsByTagName("Subtype")[0].firstChild.nodeValue,x=y.getElementsByTagName("Alternative")[0].firstChild.nodeValue;y.getAttribute("ID")&&y.getAttribute("ID"),v=parseInt(v),b=parseInt(b),x=parseInt(x);var w=new Fo(v,b,x),k=w.SetfromXML(Bs,y,i);k&&(u[t].removeChild(y),w.savemetolistLoad(Bs,!1))}d=parseInt(d),p=parseInt(p),g=parseInt(g);var D=new Fo(d,p,g);D.markupID=m,D.SetfromXML(Bs,u[t],i)&&(k&&f&&null!=w&&(D.bhasArrow=f,D.markupArrowConnected=w,w.bisTextArrow=!0,w.textBoxConnected=D,w.setArrowPoint(D),k=!1,f=!1),D.savemetolistLoad(Bs))}D&&D.notify(),0==u.length&&null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n)}}(e)},setMaxImageArea:function(e){sr=e},setMonoChrome:function(e){Ka&&($a||(Bs.getCurrentpage().usevectorxml&&(pu(e),"#FFFFFF"!=Bs.backgroundColor&&"#000000"!=Bs.backgroundColor||Bs.getCurrentpage().invert_images(Bs.backgroundColor),Bs.refreshBirdsEye(),Bs.renderBirdsEye()),al(n)))},setpageAs3DNavigator:function(e,t){jh()||Xs[e.docindex].pages[e.pageindex]&&Xs[e.docindex].pages[e.pageindex].setAs3DNavigator(t,e.floorindex)},draw3DBirdseye:function(){jh()||Bs.getCurrentpage().bis3Dnavigator&&Bs.getCurrentpage().drawcamerapos()},setnavigationScaleOffset:function(e,t,a){jh()||null!=e&&null!=t&&Xs[e].pages[0].usevector3DGLTF&&Xs[e].setFloorNavScaleOffset(t,a)},setnavScaleOffsetPage:function(e){jh()||Bs.getCurrentpage().setFloorNavScaleOffset(e)},get3DmodelboxCenter:function(e){var t=null;return jh()||Xs[e].pages[0].usevector3DGLTF&&(t=Xs[e].pages[0].Vector3DPageObj.boxCenter),t},set3dNavcameraPos:function(e,t,a){jh()||a&&Bs.setpagecamerapos(e,t,a)},setPageDimensions:function(e,t,a,i,r){jh()||Bs.setPageDim(e,t,a,i,r)},setPDFAnimateRender:function(e){Si=e},setPDFinitalZoomAll:function(e){wi=e},setrxprintdiv:function(e){ce=e},setRxSpaceColor:function(e,t,a){jh()||$a||Wo(e,t,a)},setscrollZoomKey:function(e,t){vr=e,rr=t},singlePageScrollPan:function(e){br=e},setSingleDocument:function(e){bi=e},setSpaceID:function(e){!function(e,t){var a=0;for(a=0;a<Bs.markuplist.length;a++)(Bs.markuplist[a].selected||Bs.markuplist[a].selectedit)&&8==Bs.markuplist[a].type&&1==Bs.markuplist[a].subtype&&Bs.markuplist[a].updateAttribute(e,t)}("SpaceID",e.toString())},setText:function(e){At.setText(e)},setUnit:Cu,setElementUnit:function(e){var t=lu();t.isempty||t.scaleObject.setUnit(e)},setVectorBlockArea:function(e,t,a){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().setVectorBlockArea(e,t,a)},showMarkupLabels:function(e){Ei=e,Ti=e},show3DViewMarkers:function(e){if(!jh()){var t=Bs.getCurrentpage();t&&t.usevector3Dxml&&t.show3DViewMarker(e)}},spaceEdit:function(){Ka&&(jh()||Bs.getCurrentpage().usevector3Dxml||nd("markupedit",{p1:!0}))},suspendDraw:function(e){if(ki=e,!e&&Ka){var t=Bs.getcurPage();if(null==Bs.getPageObject(pagenum))return;Bs.getPageObject(t).redraw()}},switchPages:function(e,i,s){null!=Qt&&Qt.setDownload("show"),Q=!1,function(e,i,s){var o;null!=ba&&(ba.hastext=!1,ba.hasText(ba.hastext,!0)),go(e),n.clearRect(0,0,t.width,t.height),a.clearRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height);var l='<?xml version="1.0" encoding="UTF-8"?>';l+="<RxViewServer>",l+="<Command>GetFile</Command>",l+="<LicenseID>"+_i+"</LicenseID>",l+="<FileURL>"+e+"</FileURL>",Jc("POST",p,l+="</RxViewServer>",[{event:"callback",func:s}]).then((function(e){var t,a=0;null!=Qt&&Qt.setDownload("hide");var r=0,s=0;if(null!=Bs&&null!=Bs){Bs.closePages(!1);var n=mo(Bs.OriginalURL),l=e.getElementsByTagName("Layout");for(t=0;t<l.length;t++){var c=l[t].getElementsByTagName("LayoutName")[0].firstChild.nodeValue,h=l[t].getElementsByTagName("Page");for(a=0;a<h.length;a++)0==a&&0==t?i.indexOf(a)>=0&&(o=new _l(h[a],c,!1,n,a,Bs),Bs.addthumbnail(new Gl(h[a],c,Bs,a)),Bs.addpage(o,!0),s++):i.indexOf(a)>=0&&(0==s?(o=new _l(h[a],c,!1,n,a+r,Bs),Bs.addthumbnail(new Gl(h[a],c,Bs,a+r)),Bs.addpage(o,!0),s++):(o=new _l(h[a],c,!1,"",a+r,Bs),Bs.addthumbnail(new Gl(h[a],c,Bs,a+r)),Bs.addpage(o,!1),s++));r+=a}if(Ih()){o.usepdfjs&&Bs.loadPDFpages(),null!=st&&st.setThumbnails(Bs.thumbnails);var u={iscompare:$a,numOpenFiles:Xs.length,isPDF:Bs.getCurrentpage().usepdfjs,is3D:Bs.getCurrentpage().usevector3Dxml,markupOn3D:!1,is2D:Bs.getCurrentpage().usevectorxml,numpages:Bs.pages.length,currentpage:Bs.getcurPage(),activefile:Bs.bActive};null!=Gt&&Gt.setGUIState(u);var d={numpages:Bs.pages.length,currentpage:Bs.getcurPage()};null!=Ht&&Ht.pageEvent(d)}}})).catch((function(e){Eh("switchDocPages",e)}))}(e,i,s)},textSearch:function(e,t,a){jh()||Ka&&($a||Bs.textsearch(e,t,a))},testmarktext:function(e){jh()||Ka&&($a||Bs.testmarktextdiv(e))},markupTextSearch:function(e,t,a){Ka&&($a||Bs.markupTextSearch(e,t,a))},textSelect:function(e){jh()||Ka&&($a||Bs.enableTextSelect(e))},toggle3DVisible:function(e){Xu(e,"hide3d",null)},toggleBackground:function(e){if(Ka){var t=!1;Bs.getCurrentpage().usepdfjs?Bs.backgroundColor="#FFFFFF":(Bs.getCurrentpage().usevectorxml&&(Bs.getCurrentpage().getPenTableState()?(t=!1,yi=!1):t=!0),Qi?Bs.backgroundColor==Ki?Bs.backgroundColor="#A0A0A0":"#A0A0A0"==Bs.backgroundColor?Bs.backgroundColor="#FFFFFF":"#FFFFFF"==Bs.backgroundColor?Bs.backgroundColor="#000000":"#000000"==Bs.backgroundColor&&(Bs.backgroundColor=Ki,t&&e&&(yi=!yi)):"#A0A0A0"==Bs.backgroundColor?Bs.backgroundColor="#FFFFFF":"#FFFFFF"==Bs.backgroundColor?Bs.backgroundColor="#000000":"#000000"==Bs.backgroundColor&&(Bs.backgroundColor="#A0A0A0",t&&e&&(yi=!yi))),Bs.getCurrentpage().usevectorxml&&("#FFFFFF"!=Bs.backgroundColor&&"#000000"!=Bs.backgroundColor||Bs.getCurrentpage().invert_images(Bs.backgroundColor),Bs.getCurrentpage().draw_vector(!0),Bs.refreshBirdsEye(),Bs.renderBirdsEye()),al(n)}},transparency3D:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.setTransparency(e)},transparency3DEx:function(e){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.setTransparencyEx(e)},unSelectAllMarkup:function(){Ka&&(Ho(),Uo(),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive))},unSelectMarkupbyGUID:function(e){if(Ka){var t=Bs.getmarkupbyGUID(e);-1!=t&&Ju(Bs.markuplist[t].markupnumber)}},unSelectMarkupbyGUIDs:function(e){Ka&&(Bs.unselectmarkupbyGUIDs(e),null!=Et&&Et.setMarkupList(Bs.getmarkuplist(),Bs.bActive),al(n),il(a))},unSelectMarkupbyIndex:Ju,uploadSignature:function(e,t,a){if(null!=P&&(!a||null!=R)){var i=P+"&"+t;a&&(i=R+"&"+t),yn(e),Kc("POST",i,"",e).then((function(e){null!=Te&&Te.oncomplete(t,a)})).catch((function(e){e.status?console.log("uploadSignature",e.status):console.log("uploadSignature",e)}))}},useCompanyFeature:function(e){oi=!0,_a=e},useCredentials:function(e){fi=e},useFixedScale:function(e){ui=e},useMarkupscaling:function(e){ni=e},setDimPrecisionForPage:Zu,setPDFLib:function(e){fe=e},usePanToMarkup:function(e){er=e},usePentableUpload:function(){Ha=!0},useConvertUpload:function(){za=!0},usetextscale:function(e){gi=e},useNoScale:function(e){di=e},useFraction:function(e){Zr=e},useOrtho:function(e,t){xr=e,kr=t},userFromLocalStorage:function(){var e=void 0,t=void 0;return"undefined"!=typeof Storage&&(null!=localStorage.getItem("User")&&(e=localStorage.getItem("User")),null!=localStorage.getItem("UserName")&&(t=localStorage.getItem("UserName"))),{user:e,displayname:t}},userToLocalStorage:function(e,t,a){"undefined"!=typeof Storage&&(a?(localStorage.setItem("User",t),localStorage.setItem("UserName",t)):(localStorage.setItem("User",hs),localStorage.setItem("UserName",Pn(hs)),Ec("User").then(()=>{!async function(e){const t=(await Ec(e.store)).transaction(e.store,"readwrite"),a=t.objectStore(e.store).add({fileData:e});a.onsuccess=function(){console.log("Data successfully saved to IndexedDB!")},a.onerror=function(e){console.error("Error saving data to IndexedDB: ",e.target.errorCode)}}({store:"User",User:hs,UserName:Pn(hs)})}).catch(e=>console.error("Error opening database:",e))))},vectorBlocksAll:function(e){jh()||Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().turnBlockAllOnOff(e)},vectorLayersAll:function(e){jh()||(Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().turnLayerAllOnOff(e),Bs.getCurrentpage().usepdfjs&&Bs.setOCGVisibilityAll(e))},viewMode:pu,walkThrough3D:Gh,WebsocketConnect:function(){null!=D&&((me=new WebSocket(D)).addEventListener("open",ld),me.addEventListener("close",cd),me.addEventListener("message",hd))},xmlurl:function(e){mi=!1,Jc("GET",e).then((function(e){e.getElementsByTagName("IMAGE_INFO");for(var t=e.getElementsByTagName("URL")[0].firstChild.nodeValue,a=e.getElementsByTagName("MARKUP_URL"),i=(e.getElementsByTagName("USER_MARKUPPOSTURL"),0);i<a.length;i++)Jr[i]=a[i].firstChild.nodeValue;zr=!0,null!=Qt&&Qt.setDownload("show"),sc({filename:t,displayname:null})})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},xmlurlEx:function(e){mi=!1,Jc("GET",e).then((function(e){e.getElementsByTagName("IMAGE_INFO");for(var t=e.getElementsByTagName("URL")[0].firstChild.nodeValue,a=e.getElementsByTagName("MARKUP_URL"),i=(e.getElementsByTagName("USER_MARKUPPOSTURL"),0);i<a.length;i++)Jr[i]=a[i].firstChild.nodeValue;Wr=!0,null!=Qt&&Qt.setDownload("show"),sc({filename:t,displayname:null})})).catch((function(e){e.status?404==e.status?console.log("XML could not be found"):503==e.status&&console.log("Server is down"):console.log(e)}))},zoomToBlock:function(e){if(!jh()&&Ka&&!$a&&!Bs.getCurrentpage().usevector3Dxml){var t=zo(e);t?Bs.getCurrentpage().MarkupZoombyMarkup(t):Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().ZoomToBlock(e)}},zoomToBlockInsert:function(e){if(!jh()&&!$a&&!Bs.getCurrentpage().usevector3Dxml){var t=zo(e);t?Bs.getCurrentpage().MarkupZoombyMarkup(t):Bs.getCurrentpage().usevectorxml&&Bs.getCurrentpage().ZoomToBlockInsert(e)}},zoomFit:function(){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||($a?Us.zoomall():Bs.getCurrentpage().zoomall()))},zoomHeight:function(){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||($a?Us.zoomheight():Bs.getCurrentpage().zoomheight()))},zoomWidth:function(){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||($a?Us.zoomwidth():Bs.getCurrentpage().zoomwidth()))},zoomIn:function(){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||($a?Us.ZoomIn(1.1,!1,!1):Bs.getCurrentpage().ZoomIn(1.1,!1,!1)))},zoomOut:function(){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||($a?Us.ZoomOut(1.1,!1,!1):function(e){var t=!0,a=Bs.getCurrentpage().getpagedim(),i=Na-30,r=Aa-30;return a.w/e<i&&a.h/e<r&&(t=!1),Ci||(t=!0),t}(1.1)&&Bs.getCurrentpage().ZoomOut(1.1,!1,!1)))},zoomPageUpdate:function(e,t){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||Bs.getCurrentpage().ZoomPageUpdate(e,t))},zoomWindow:function(e){jh()||Ka&&(Bs.getCurrentpage().usevector3Dxml||(Ho(),Uo(),e?nd("zoomwindow",{p1:!1,p2:!1}):nd("markupedit",{p1:!1})))},setEndPoints:function(e,t,a,i,r){m=e,b=t,j=a,N=i,K=r,li=!0},setMarkUpHatch:function(e){if(Ka&&!ws&&!$a){var t=gs;gs=e,No(3),xs||(gs=t)}},setBirdseyeCanvas:function(e,t,a){if(!jh()){var i=Bs.getThumb(Bs.currentpage);null!=i&&i.setGUIbirdseyeCnv(e,t,a)}},setdimPrecision:function(e){ne=e},setNoteText:function(e){Ut.setText(e)},setTextInputText:function(e){return Bt.setText(e)},getTextMarkup:function(){return Bt.getText()},getBirdseyeDim:function(e,t,a){if(!jh())return Bs.thumbnails[e].getBirdseyeDim(t,a)},getTextInputText:function(){return Bt.getText().text},setThumbnailctx:function(e,t){if(!jh()){var a=Bs.getThumb(t);null!=a&&(a.thumbctx=e)}},setThumbnailSize:function(e,t){Ui=e,Gi=t},transparent3DOn:function(){jh()||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().Vector3DPageObj.setTransparency(.5)},set3DBlockTransparency:function(e,t,a){jh()||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().set3DBlockTransparency(e,t,a)},set3DBlockNoSelect:function(e,t){jh()||$a||Bs.getCurrentpage().usevector3Dxml&&Bs.getCurrentpage().set3DBlockNoSelect(e,t)},zoomMarkup:function(e,t,a){jh()||Ka&&($a||Bs.getCurrentpage().SetMarkupZoom(e,t,a))},GUI_ActivateFile:De,GUI_2DBlockID:Dt,GUI_2DBlock:Mt,GUI_2DBlockHover:Tt,GUI_2DBlockInfo:Ct,GUI_2DBlockInfoPos:Pt,GUI_2DEntityInfoScreen:St,GUI_2DEntityInfo:Rt,GUI_3DCameraSave:yt,GUI_3DPartInfo:vt,GUI_3DPartState:bt,GUI_3DMarkupInfo:xt,GUI_3DMarkup:kt,GUI_3DCameraSaves:ue,GUI_3DParts:mt,GUI_3DWalkthrough:ta,GUI_3DView:$e,GUI_Calibratediag:Vt,GUI_CalibrateComplete:Nt,GUI_CameraPos:Jt,GUI_CanSaveTop3DView:Ge,GUI_CreationComplete:Xe,GUI_ContextMenuEvt:ia,GUI_UpdatebirdsEye:Kt,GUI_CompareDiag:aa,GUI_Nav3DreplaceDiag:ra,GUI_compareLoadComplete:Ue,GUI_CompareMeasure:Ra,GUI_CompareAlign:sa,GUI_Consolidate:na,GUI_ConsolidateMarkup:oa,GUI_Download:Qt,GUI_exportComplete:je,GUI_Servercompare:Oe,GUI_FileInfo:Le,GUI_FileLoadComplete:Ve,GUI_fileLoadError:he,GUI_search3Denabled:Ne,GUI_FileActivated:Ye,GUI_floorLoadComplete:qe,GUI_3DNavPosition:Qe,GUI_floorlevel:Ze,GUI_getResponsHeaders:Fa,GUI_HasText:ba,GUI_MarkupHover:Ie,GUI_Markup:zt,GUI_HyperlinkHover:Ae,GUI_Hyperlink:Be,GUI_MarkupChanged:Wt,GUI_MarkupDrawValue:qt,GUI_MarkupIndex:_t,GUI_MarkupLayers:Fe,GUI_MarkupLink:Xt,GUI_Markuplist:Et,GUI_3DMarkupList:wt,GUI_MarkuplistJSON:Ft,GUI_MarkupLoadComplete:Je,GUI_markupdrawParams:Ma,GUI_markupParamsError:Ea,GUI_MarkupAreaEdit:Ta,GUI_inputEvent:Ca,GUI_HatchChange:xa,GUI_MarkupSave:ga,GUI_MarkupPaths:ma,GUI_MarkupUnselect:Yt,GUI_Measurediag:Lt,GUI_Notediag:Ut,GUI_NumMathces:wa,GUI_NumMathcesMarkup:ka,GUI_NumMathcesRect:Da,GUI_pageLoadComplete:et,GUI_scaleListLoadComplete:tt,GUI_pagedimLoadComplete:ht,GUI_pagethumbs:st,GUI_pagethumb:nt,GUI_floorthumb:ot,GUI_FloorplanCanvas:lt,GUI_birdseye:ct,GUI_PagePosition:de,GUI_Page:Ht,GUI_PanUpdate:ha,GUI_PanUpdated:ua,GUI_PDFBookmarks:ca,GUI_PDFRenderComplete:at,GUI_PDFPassWord:rt,GUI_Permissions:la,GUI_PrintRect:va,GUI_Read3DComplete:ft,GUI_Ready:fa,GUI_RotatePage:ya,GUI_Resize:$t,GUI_Resize_ext:ea,GUI_Stamps:It,GUI_CustomStamps:jt,GUI_State:Gt,GUI_Symbols:Ot,GUI_Textdiag:At,GUI_TextInput:Bt,GUI_Upload:Zt,GUI_UndoRedoEmpty:We,GUI_Users:Ce,GUI_penTable:Pe,GUI_penTableJSON:Se,GUI_autopenTable:Re,GUI_getsignatureComplete:Me,GUI_putsignatureComplete:Te,GUI_VectorBlocks:pt,GUI_VectorBlocksLoaded:gt,GUI_VectorLayers:ut,GUI_PDFLayers:dt,GUI_ZoomUpdate:da,GUI_ZoomUpdated:pa,GUI_MarkupMeasureRealTimeData:Ia}},RxCore=RxCoreMulti();